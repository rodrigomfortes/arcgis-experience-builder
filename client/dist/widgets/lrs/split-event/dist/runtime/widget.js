System.register(["jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-arcgis","jimu-core/react","calcite-components","esri/layers/GraphicsLayer"],(function(e,t){var n={},a={},o={},r={},i={},s={},l={};return{setters:[function(e){n.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceStatus=e.DataSourceStatus,n.Immutable=e.Immutable,n.MessageManager=e.MessageManager,n.React=e.React,n.RecordSetChangeType=e.RecordSetChangeType,n.SessionManager=e.SessionManager,n.WidgetState=e.WidgetState,n.css=e.css,n.focusElementInKeyboardMode=e.focusElementInKeyboardMode,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.jsx=e.jsx},function(e){a.AttributeTable=e.AttributeTable,a.GetUnits=e.GetUnits,a.InlineEditableDropdown=e.InlineEditableDropdown,a.Intellisense=e.Intellisense,a.LockAction=e.LockAction,a.LockManagerComponent=e.LockManagerComponent,a.LrsLayerType=e.LrsLayerType,a.QueryMapPointWithMeasureOnRoute=e.QueryMapPointWithMeasureOnRoute,a.QueryMeasureOnRoute=e.QueryMeasureOnRoute,a.QueryRouteMeasures=e.QueryRouteMeasures,a.RoutePicker=e.RoutePicker,a.RoutePickerPopup=e.RoutePickerPopup,a.convertStationToNumber=e.convertStationToNumber,a.flash=e.flash,a.formatMessage=e.formatMessage,a.getCalciteBasicTheme=e.getCalciteBasicTheme,a.getDateToUTC=e.getDateToUTC,a.getDateWithTZOffset=e.getDateWithTZOffset,a.getDateWithoutTZOffset=e.getDateWithoutTZOffset,a.getGeometryGraphic=e.getGeometryGraphic,a.getInitialRouteInfoState=e.getInitialRouteInfoState,a.getIntialLocksInfo=e.getIntialLocksInfo,a.getNetworkOutFields=e.getNetworkOutFields,a.getRouteFromEndMeasures=e.getRouteFromEndMeasures,a.getSimpleLineGraphic=e.getSimpleLineGraphic,a.getSimplePointGraphic=e.getSimplePointGraphic,a.getSuggestions=e.getSuggestions,a.isDate=e.isDate,a.isDefined=e.isDefined,a.isInWidgetController=e.isInWidgetController,a.isNumber=e.isNumber,a.isWithinTolerance=e.isWithinTolerance,a.queryEventsByEventObjectIds=e.queryEventsByEventObjectIds,a.queryEventsByRouteIdOrEventObjectId=e.queryEventsByRouteIdOrEventObjectId,a.queryLineId=e.queryLineId,a.queryRouteIdOrName=e.queryRouteIdOrName,a.requestService=e.requestService,a.setRouteInfoByRouteIdOrName=e.setRouteInfoByRouteIdOrName,a.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,a.validateField=e.validateField,a.validateRangeDomain=e.validateRangeDomain},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.Label=e.Label,o.Select=e.Select,o.TextInput=e.TextInput,o.Tooltip=e.Tooltip,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.useImperativeHandle=e.useImperativeHandle},function(e){s.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){l.default=e.default}],execute:function(){e((()=>{var e={14321:e=>{"use strict";e.exports=o},19027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M9 1h1v1H9zm0 2H8V0h3v3h-1v14h1v3H8v-3h1zm0 15h1v1H9zM8 4H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h6v-1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6zm0 5.5H3.5v-2h-1v3H8zm9 6.5h-6v-1h6a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-6V4h6a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2m-6-5.5h4.5v2h1v-3H11z" clip-rule="evenodd"></path></svg>'},47626:e=>{"use strict";e.exports=a},59620:e=>{"use strict";e.exports=l},62686:e=>{"use strict";e.exports=r},68972:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=n},99037:e=>{"use strict";e.exports=s}},t={};function c(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,c),o.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{__set_webpack_public_path__:()=>ga,default:()=>ya});var e=c(79244),t=c(47626);const n={_widgetLabel:"Split Event",routeIdLabel:"Route ID",eventOidLabel:"Event OID",routeNameLabel:"Route Name",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",measureWithUnits:"Measure ({units}) *",splitMeasureWithUnits:"Split Measure ({units}) *",selectRouteLabel:"Select Route",routePicker:"Route Picker",splitDateLabel:"Split Date *",useStartDateLabel:"Use route start date",attributeLabel:"Attribute",valueLabel:"Value",resetForm:"Reset",nullLabel:"null",trueLabel:"true",falseLabel:"false",attributeError:"{fieldValue}: {message} ({event1or2})",eventSplit:"Event Split",splitLabel:"Split",routeNotFound:"Route not found",invalidFromDateBefore:"From date is before route's from date",invalidFromDateAfter:"From date is after route's to date",invalidToDateBefore:"To date is before route's from date",invalidToDateAfter:"To date is after route's to date",invalidDatesOrder:"Selected from date is greater than selected to date",invalidDatesSameDay:"From and to dates cannot be the same",measureLessError:"Selected measure is less than route's from measure",measureGreaterError:"Selected measure is greater than route's to measure",invalidMeasureError:"Input measure is invalid",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Valid exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",noResult:"No results",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Inches",event1Label:"Event 1",event2Label:"Event 2",noEventFound:"Event does not exist for the selected event layer in this location.",multipleEventsFound:"More than one event exists at the split location.",unableToSplitAtStartOrEnd:"Unable to split at the start or end of an event.",chooseEventLocationFromMap:"(Choose event location from map)",invalidContingentValues:"Attribute do not satisfy a required Contingent Value: {groupNames}",contingentValueError:"Invalid contingent value in the field"};var a=c(14321),o=c(19027),r=c.n(o),i=c(62686);function s(){const t=e.hooks.useTranslation(n);return(0,e.jsx)("div",{className:"split-event-form-header"},(0,e.jsx)("div",{className:"split-event-form-header__header pt-3 px-3 align-items-center"},(0,e.jsx)("div",{className:"split-event_title d-flex align-items-center text-truncate",css:e.css`font-weight: 500; font-size: 14px;`},(0,e.jsx)("div",{className:"text-truncate"},t("_widgetLabel")))))}const l=function(){this.__data__=[],this.size=0};const d=function(e,t){return e===t||e!=e&&t!=t};const f=function(e,t){for(var n=e.length;n--;)if(d(e[n][0],t))return n;return-1};var v=Array.prototype.splice;const p=function(e){var t=this.__data__,n=f(t,e);return!(n<0)&&(n==t.length-1?t.pop():v.call(t,n,1),--this.size,!0)};const m=function(e){var t=this.__data__,n=f(t,e);return n<0?void 0:t[n][1]};const h=function(e){return f(this.__data__,e)>-1};const b=function(e,t){var n=this.__data__,a=f(n,e);return a<0?(++this.size,n.push([e,t])):n[a][1]=t,this};function y(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}y.prototype.clear=l,y.prototype.delete=p,y.prototype.get=m,y.prototype.has=h,y.prototype.set=b;const g=y;const D=function(){this.__data__=new g,this.size=0};const I=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const S=function(e){return this.__data__.get(e)};const R=function(e){return this.__data__.has(e)};const j="object"==typeof global&&global&&global.Object===Object&&global;var w="object"==typeof self&&self&&self.Object===Object&&self;const k=j||w||Function("return this")();const E=k.Symbol;var N=Object.prototype,O=N.hasOwnProperty,x=N.toString,L=E?E.toStringTag:void 0;const T=function(e){var t=O.call(e,L),n=e[L];try{e[L]=void 0;var a=!0}catch(e){}var o=x.call(e);return a&&(t?e[L]=n:delete e[L]),o};var M=Object.prototype.toString;const F=function(e){return M.call(e)};var A=E?E.toStringTag:void 0;const _=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":A&&A in Object(e)?T(e):F(e)};const C=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const P=function(e){if(!C(e))return!1;var t=_(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const G=k["__core-js_shared__"];var V,U=(V=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||""))?"Symbol(src)_1."+V:"";const W=function(e){return!!U&&U in e};var q=Function.prototype.toString;const z=function(e){if(null!=e){try{return q.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var B=/^\[object .+?Constructor\]$/,H=Function.prototype,Q=Object.prototype,$=H.toString,Z=Q.hasOwnProperty,J=RegExp("^"+$.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const K=function(e){return!(!C(e)||W(e))&&(P(e)?J:B).test(z(e))};const Y=function(e,t){return null==e?void 0:e[t]};const X=function(e,t){var n=Y(e,t);return K(n)?n:void 0};const ee=X(k,"Map");const te=X(Object,"create");const ne=function(){this.__data__=te?te(null):{},this.size=0};const ae=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var oe=Object.prototype.hasOwnProperty;const re=function(e){var t=this.__data__;if(te){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return oe.call(t,e)?t[e]:void 0};var ie=Object.prototype.hasOwnProperty;const se=function(e){var t=this.__data__;return te?void 0!==t[e]:ie.call(t,e)};const le=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=te&&void 0===t?"__lodash_hash_undefined__":t,this};function ce(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}ce.prototype.clear=ne,ce.prototype.delete=ae,ce.prototype.get=re,ce.prototype.has=se,ce.prototype.set=le;const ue=ce;const de=function(){this.size=0,this.__data__={hash:new ue,map:new(ee||g),string:new ue}};const fe=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const ve=function(e,t){var n=e.__data__;return fe(t)?n["string"==typeof t?"string":"hash"]:n.map};const pe=function(e){var t=ve(this,e).delete(e);return this.size-=t?1:0,t};const me=function(e){return ve(this,e).get(e)};const he=function(e){return ve(this,e).has(e)};const be=function(e,t){var n=ve(this,e),a=n.size;return n.set(e,t),this.size+=n.size==a?0:1,this};function ye(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}ye.prototype.clear=de,ye.prototype.delete=pe,ye.prototype.get=me,ye.prototype.has=he,ye.prototype.set=be;const ge=ye;const De=function(e,t){var n=this.__data__;if(n instanceof g){var a=n.__data__;if(!ee||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new ge(a)}return n.set(e,t),this.size=n.size,this};function Ie(e){var t=this.__data__=new g(e);this.size=t.size}Ie.prototype.clear=D,Ie.prototype.delete=I,Ie.prototype.get=S,Ie.prototype.has=R,Ie.prototype.set=De;const Se=Ie;const Re=function(e,t){for(var n=-1,a=null==e?0:e.length;++n<a&&!1!==t(e[n],n,e););return e};const je=function(){try{var e=X(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const we=function(e,t,n){"__proto__"==t&&je?je(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var ke=Object.prototype.hasOwnProperty;const Ee=function(e,t,n){var a=e[t];ke.call(e,t)&&d(a,n)&&(void 0!==n||t in e)||we(e,t,n)};const Ne=function(e,t,n,a){var o=!n;n||(n={});for(var r=-1,i=t.length;++r<i;){var s=t[r],l=a?a(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),o?we(n,s,l):Ee(n,s,l)}return n};const Oe=function(e,t){for(var n=-1,a=Array(e);++n<e;)a[n]=t(n);return a};const xe=function(e){return null!=e&&"object"==typeof e};const Le=function(e){return xe(e)&&"[object Arguments]"==_(e)};var Te=Object.prototype,Me=Te.hasOwnProperty,Fe=Te.propertyIsEnumerable,Ae=Le(function(){return arguments}())?Le:function(e){return xe(e)&&Me.call(e,"callee")&&!Fe.call(e,"callee")};const _e=Ae;const Ce=Array.isArray;const Pe=function(){return!1};var Ge="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ve=Ge&&"object"==typeof module&&module&&!module.nodeType&&module,Ue=Ve&&Ve.exports===Ge?k.Buffer:void 0;const We=(Ue?Ue.isBuffer:void 0)||Pe;var qe=/^(?:0|[1-9]\d*)$/;const ze=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&qe.test(e))&&e>-1&&e%1==0&&e<t};const Be=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var He={};He["[object Float32Array]"]=He["[object Float64Array]"]=He["[object Int8Array]"]=He["[object Int16Array]"]=He["[object Int32Array]"]=He["[object Uint8Array]"]=He["[object Uint8ClampedArray]"]=He["[object Uint16Array]"]=He["[object Uint32Array]"]=!0,He["[object Arguments]"]=He["[object Array]"]=He["[object ArrayBuffer]"]=He["[object Boolean]"]=He["[object DataView]"]=He["[object Date]"]=He["[object Error]"]=He["[object Function]"]=He["[object Map]"]=He["[object Number]"]=He["[object Object]"]=He["[object RegExp]"]=He["[object Set]"]=He["[object String]"]=He["[object WeakMap]"]=!1;const Qe=function(e){return xe(e)&&Be(e.length)&&!!He[_(e)]};const $e=function(e){return function(t){return e(t)}};var Ze="object"==typeof exports&&exports&&!exports.nodeType&&exports,Je=Ze&&"object"==typeof module&&module&&!module.nodeType&&module,Ke=Je&&Je.exports===Ze&&j.process;const Ye=function(){try{var e=Je&&Je.require&&Je.require("util").types;return e||Ke&&Ke.binding&&Ke.binding("util")}catch(e){}}();var Xe=Ye&&Ye.isTypedArray;const et=Xe?$e(Xe):Qe;var tt=Object.prototype.hasOwnProperty;const nt=function(e,t){var n=Ce(e),a=!n&&_e(e),o=!n&&!a&&We(e),r=!n&&!a&&!o&&et(e),i=n||a||o||r,s=i?Oe(e.length,String):[],l=s.length;for(var c in e)!t&&!tt.call(e,c)||i&&("length"==c||o&&("offset"==c||"parent"==c)||r&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ze(c,l))||s.push(c);return s};var at=Object.prototype;const ot=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||at)};const rt=function(e,t){return function(n){return e(t(n))}};const it=rt(Object.keys,Object);var st=Object.prototype.hasOwnProperty;const lt=function(e){if(!ot(e))return it(e);var t=[];for(var n in Object(e))st.call(e,n)&&"constructor"!=n&&t.push(n);return t};const ct=function(e){return null!=e&&Be(e.length)&&!P(e)};const ut=function(e){return ct(e)?nt(e):lt(e)};const dt=function(e,t){return e&&Ne(t,ut(t),e)};const ft=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var vt=Object.prototype.hasOwnProperty;const pt=function(e){if(!C(e))return ft(e);var t=ot(e),n=[];for(var a in e)("constructor"!=a||!t&&vt.call(e,a))&&n.push(a);return n};const mt=function(e){return ct(e)?nt(e,!0):pt(e)};const ht=function(e,t){return e&&Ne(t,mt(t),e)};var bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,yt=bt&&"object"==typeof module&&module&&!module.nodeType&&module,gt=yt&&yt.exports===bt?k.Buffer:void 0,Dt=gt?gt.allocUnsafe:void 0;const It=function(e,t){if(t)return e.slice();var n=e.length,a=Dt?Dt(n):new e.constructor(n);return e.copy(a),a};const St=function(e,t){var n=-1,a=e.length;for(t||(t=Array(a));++n<a;)t[n]=e[n];return t};const Rt=function(e,t){for(var n=-1,a=null==e?0:e.length,o=0,r=[];++n<a;){var i=e[n];t(i,n,e)&&(r[o++]=i)}return r};const jt=function(){return[]};var wt=Object.prototype.propertyIsEnumerable,kt=Object.getOwnPropertySymbols;const Et=kt?function(e){return null==e?[]:(e=Object(e),Rt(kt(e),(function(t){return wt.call(e,t)})))}:jt;const Nt=function(e,t){return Ne(e,Et(e),t)};const Ot=function(e,t){for(var n=-1,a=t.length,o=e.length;++n<a;)e[o+n]=t[n];return e};const xt=rt(Object.getPrototypeOf,Object);const Lt=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ot(t,Et(e)),e=xt(e);return t}:jt;const Tt=function(e,t){return Ne(e,Lt(e),t)};const Mt=function(e,t,n){var a=t(e);return Ce(e)?a:Ot(a,n(e))};const Ft=function(e){return Mt(e,ut,Et)};const At=function(e){return Mt(e,mt,Lt)};const _t=X(k,"DataView");const Ct=X(k,"Promise");const Pt=X(k,"Set");const Gt=X(k,"WeakMap");var Vt="[object Map]",Ut="[object Promise]",Wt="[object Set]",qt="[object WeakMap]",zt="[object DataView]",Bt=z(_t),Ht=z(ee),Qt=z(Ct),$t=z(Pt),Zt=z(Gt),Jt=_;(_t&&Jt(new _t(new ArrayBuffer(1)))!=zt||ee&&Jt(new ee)!=Vt||Ct&&Jt(Ct.resolve())!=Ut||Pt&&Jt(new Pt)!=Wt||Gt&&Jt(new Gt)!=qt)&&(Jt=function(e){var t=_(e),n="[object Object]"==t?e.constructor:void 0,a=n?z(n):"";if(a)switch(a){case Bt:return zt;case Ht:return Vt;case Qt:return Ut;case $t:return Wt;case Zt:return qt}return t});const Kt=Jt;var Yt=Object.prototype.hasOwnProperty;const Xt=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Yt.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const en=k.Uint8Array;const tn=function(e){var t=new e.constructor(e.byteLength);return new en(t).set(new en(e)),t};const nn=function(e,t){var n=t?tn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var an=/\w*$/;const on=function(e){var t=new e.constructor(e.source,an.exec(e));return t.lastIndex=e.lastIndex,t};var rn=E?E.prototype:void 0,sn=rn?rn.valueOf:void 0;const ln=function(e){return sn?Object(sn.call(e)):{}};const cn=function(e,t){var n=t?tn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const un=function(e,t,n){var a=e.constructor;switch(t){case"[object ArrayBuffer]":return tn(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return nn(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return cn(e,n);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return on(e);case"[object Symbol]":return ln(e)}};var dn=Object.create;const fn=function(){function e(){}return function(t){if(!C(t))return{};if(dn)return dn(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const vn=function(e){return"function"!=typeof e.constructor||ot(e)?{}:fn(xt(e))};const pn=function(e){return xe(e)&&"[object Map]"==Kt(e)};var mn=Ye&&Ye.isMap;const hn=mn?$e(mn):pn;const bn=function(e){return xe(e)&&"[object Set]"==Kt(e)};var yn=Ye&&Ye.isSet;const gn=yn?$e(yn):bn;var Dn="[object Arguments]",In="[object Function]",Sn="[object Object]",Rn={};Rn[Dn]=Rn["[object Array]"]=Rn["[object ArrayBuffer]"]=Rn["[object DataView]"]=Rn["[object Boolean]"]=Rn["[object Date]"]=Rn["[object Float32Array]"]=Rn["[object Float64Array]"]=Rn["[object Int8Array]"]=Rn["[object Int16Array]"]=Rn["[object Int32Array]"]=Rn["[object Map]"]=Rn["[object Number]"]=Rn[Sn]=Rn["[object RegExp]"]=Rn["[object Set]"]=Rn["[object String]"]=Rn["[object Symbol]"]=Rn["[object Uint8Array]"]=Rn["[object Uint8ClampedArray]"]=Rn["[object Uint16Array]"]=Rn["[object Uint32Array]"]=!0,Rn["[object Error]"]=Rn[In]=Rn["[object WeakMap]"]=!1;const jn=function e(t,n,a,o,r,i){var s,l=1&n,c=2&n,u=4&n;if(a&&(s=r?a(t,o,r,i):a(t)),void 0!==s)return s;if(!C(t))return t;var d=Ce(t);if(d){if(s=Xt(t),!l)return St(t,s)}else{var f=Kt(t),v=f==In||"[object GeneratorFunction]"==f;if(We(t))return It(t,l);if(f==Sn||f==Dn||v&&!r){if(s=c||v?{}:vn(t),!l)return c?Tt(t,ht(s,t)):Nt(t,dt(s,t))}else{if(!Rn[f])return r?t:{};s=un(t,f,l)}}i||(i=new Se);var p=i.get(t);if(p)return p;i.set(t,s),gn(t)?t.forEach((function(o){s.add(e(o,n,a,o,t,i))})):hn(t)&&t.forEach((function(o,r){s.set(r,e(o,n,a,r,t,i))}));var m=d?void 0:(u?c?At:Ft:c?mt:ut)(t);return Re(m||t,(function(o,r){m&&(o=t[r=o]),Ee(s,r,e(o,n,a,r,t,i))})),s};const wn=function(e){return jn(e,5)};var kn=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((a=a.apply(e,t||[])).next())}))};const En="#00FFFF";var Nn=c(68972);var On;!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(On||(On={}));Object.assign({},{eventRequiredLabel:"Event *",networkRequiredLabel:"Network *",routeIdRequiredLabel:"Route ID *",routeNameRequiredLabel:"Route Name *",startDateRequiredLabel:"Start Date *",nullLabel:"null",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",attributeError:"{fieldValue}: {message}",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Value exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",contingentValueError:"Invalid contingent value in the field",selectRouteLabel:"Select Route",routePicker:"Route Picker",routeNameLabel:"Route Name",routeIdLabel:"Route ID",fromRouteNameLabel:"From Route Name",fromRouteIdLabel:"From Route ID",toRouteNameLabel:"To Route Name",toRouteIdLabel:"To Route ID",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",fromMeasureLabel:"From Measure",toMeasureLabel:"To Measure",noResult:"No Results",copyAttributes:"Copy Attributes",noLrsLayersTips:"No LRS layers are present in the selected map. Select a map with LRS Network and Event layers present in the webmap.",multipleServicesTips:"Map contains layers from more than one feature service. Select a map with LRS Network and Event layers coming from a single feature service.",noNetworkLayersTips:"No LRS Network layers are present in the selected map. Select a map with at least one LRS network layer present in the web map.",noMapSelectedTips:"Select a map.",displaySettings:"Display Settings",hideNetwork:"Hide Network",hideEvent:"Hide Event",hideMethod:"Hide Method",hideRoute:"Hide Route in Search by Line",hideType:"Hide Type",hideAttributeSet:"Hide Attribute Set",hideMeasures:"Hide Measures",hideDates:"Hide Dates",useRoutesStartEndDates:"Use Routes Start and End Dates",useRoutesStartEndDatesTooltip:"Routes start/end dates will be used for new events. If disabled, the current date will be used.",selectMap:"Select Map",loadLayers:"Load layers",clearLayers:"Clear layers",removeLayer:"Remove",missingParentNetwork:"Parent network is missing",inches:"Inches (US Survey)",feet:"Feet (US Survey)",yards:"Yards (US Survey)",miles:"Miles (US Survey)",nauticalMiles:"Nautical miles (US Survey)",points:"Points",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal degrees",decimeters:"Decimeters",intFeet:"Feet (International)",intMiles:"Statute miles",esriUnknownUnits:"esriUnknownUnits",invalidRouteField:"Route could not be found with provided value",CannotAcquireLockUserAndVersion:"Cannot acquire lock because {user} has the lock in version {version}.",UnavailableLockOnLine:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnRoute:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnLineWithoutVersion:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",UnavailableLockOnRouteWithoutVersion:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",YouAcquiredLockOnLine:"You have acquired a lock on line {nameOrId} ({networkName}) in version {version}.",YouAcquiredLockOnRoute:"You have acquired a lock on route {nameOrId} ({networkName}) in version {version}.",ReconcileRequired:"The default version has changed. Reconcile this version with the default version in order to acquire locks."},a.defaultMessages);function xn(e){return null!=e}var Ln=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((a=a.apply(e,t||[])).next())}))};let Tn=[],Mn=[];const Fn=e.React.forwardRef(((o,r)=>{const i=e.hooks.useTranslation(n),{widgetId:s,resetClick:l,networkDS:c,network:u,eventDS:d,eventLayer:f,routeInfo:v,table1Label:p,table2Label:m,onUpdateEventOid:h,networkLayer:b,onSubmit:y,flashGraphic:g,onUpdateToastMsgType:D,onUpdateToastMsg:I,onUpdateToastOpen:S,intl:R,selectedEventObjectId:j,lockAquired:w,conflictPreventionEnabled:k,onValidationChanged:E,revalidateRouteFromDataAction:N,routeInfoFromDataAction:O,resetEventOid:x,currentEventOid:L}=o,[T,M]=e.React.useState(),[F,A]=e.React.useState(),[_,C]=e.React.useState(!1),[P,G]=e.React.useState(""),[V,U]=e.React.useState(!0),[W,q]=e.React.useState(!1),[z,B]=e.React.useState(!1),[H,Q]=e.React.useState(null),[$,Z]=e.React.useState(null),[J,K]=e.React.useState(),[Y,X]=e.React.useState(!1),[ee,te]=e.React.useState(!1),[ne,ae]=e.React.useState(null);(0,Nn.useImperativeHandle)(r,(()=>({onSubmitClicked:pe}))),e.React.useEffect((()=>{N&&ie()}),[N]),e.React.useEffect((()=>{E(!_&&!Y&&!ee&&w)}),[_,w,Y,ee,E]),e.React.useEffect((()=>{(0,t.isDefined)(v)&&((0,t.isDefined)(v.selectedPoint)||j)&&ie()}),[v]),e.React.useEffect((()=>{oe(),X(!1),te(!1)}),[d,f]),e.React.useEffect((()=>{l&&oe()}),[l]),e.React.useEffect((()=>{if(k){const e=Object.assign({},J);(0,t.isDefined)(u)&&(e.networkId=[u.networkInfo.lrsNetworkId]),(0,t.isDefined)(f)&&(e.eventServiceLayerIds=[f.serviceId]),(0,t.isDefined)(v)&&(e.routeInfo=v),K(e)}}),[c,u,f,v]);const oe=()=>{const e=se();re(e,!0),re(e,!1)},re=(e,t)=>{t?M(e):A(e)},ie=()=>Ln(void 0,void 0,void 0,(function*(){let e=[];if((0,t.isDefined)(f)&&(0,t.isDefined)(d)&&(0,t.isDefined)(f.eventInfo)&&(0,t.isDefined)(f.eventInfo.attributeFields)&&((0,t.isDefined)(v)||(0,t.isDefined)(O))){const n=d,a=N?O:v,o=c,r=[];f.eventInfo.canSpanRoutes&&(yield(0,t.queryLineId)(o,b.networkInfo,a.lineId).then((e=>{e.forEach((e=>{const t=e.getFieldValue(b.networkInfo.routeIdFieldSchema.name);r.push(t)}))}))),(0,t.queryEventsByRouteIdOrEventObjectId)(b.networkInfo.xyTolerance,n,f,a,r,j).then((n=>{const o=d,r=(null==o?void 0:o.getLayerDefinition()).fields.find((e=>"esriFieldTypeOID"===e.type)).name;let s=!1,l=!1,c=!1;if(1===n.length){const i=n[0].attributes[r];G(i),h(i);const s=(null==o?void 0:o.layer).fields;f.eventInfo.attributeFields.forEach((o=>{if(o.enabled){const r=s.find((e=>e.name===o.field.name));if(r&&r.editable){let i,s=n[0].attributes[r.name];(0,t.isDate)(r.type)&&(0,t.isDefined)(s)?s=new Date(s):i=(0,t.isDate)(r.type)?(0,t.isDefined)(r.defaultValue)?new Date(r.defaultValue):null:r.defaultValue;const l={index:e.length,name:r.name,alias:r.alias,type:r.type,hasDomain:(0,t.isDefined)(r.domain),value:s,error:"",nullable:r.nullable,default:"number"==typeof i?Number(i).toString():i,length:r.length,editable:o.editable};e.push(l);const u=n[0].attributes[f.eventInfo.fromMeasureFieldName],d=n[0].attributes[f.eventInfo.toMeasureFieldName];if(f.eventInfo.canSpanRoutes){const e=n[0].attributes[f.eventInfo.routeIdFieldName],o=n[0].attributes[f.eventInfo.toRouteIdFieldName];a.routeId===e&&(0,t.isWithinTolerance)(a.selectedMeasure,u,b.networkInfo.mTolerance)||a.routeId===o&&(0,t.isWithinTolerance)(a.selectedMeasure,d,b.networkInfo.mTolerance)?(c=!0,B(!0)):(c=!1,B(!1))}else(0,t.isWithinTolerance)(a.selectedMeasure,u,b.networkInfo.mTolerance)||(0,t.isWithinTolerance)(a.selectedMeasure,d,b.networkInfo.mTolerance)?(c=!0,B(!0)):(c=!1,B(!1));Q(n[0].attributes[f.eventInfo.fromDateFieldName]),Z(n[0].attributes[f.eventInfo.toDateFieldName])}}})),U(!1),l=!1,q(!1)}else if(n.length>1){for(let e=0;e<n.length;e++){const t=n[e].attributes[r];if(L===t){s=!0;break}}s||(e=se(),U(!1),l=!0,q(!0),G(null),x())}else a.isNearestCoordinate||(e=se(),U(!0),l=!1,q(!1),s=!1,G(null),x());if(s||a.isNearestCoordinate||(setTimeout((()=>{re(e,!0)}),500),setTimeout((()=>{re(e,!1)}),500)),l||c){const e=i(l?"multipleEventsFound":"unableToSplitAtStartOrEnd");D("error"),I(e),S(!0),setTimeout((()=>{S(!1)}),5e3)}}))}})),se=()=>{const e=[];if((0,t.isDefined)(f)&&(0,t.isDefined)(d)&&(0,t.isDefined)(f.eventInfo)&&(0,t.isDefined)(f.eventInfo.attributeFields)){const n=d,a=(null==n?void 0:n.layer).fields;f.eventInfo.attributeFields.forEach((n=>{if(n.enabled){const o=a.find((e=>e.name===n.field.name));if(o){let a;a=(0,t.isDate)(o.type)?(0,t.isDefined)(o.defaultValue)?new Date(o.defaultValue):null:o.defaultValue;const r={index:e.length,name:o.name,alias:o.alias,type:o.type,hasDomain:(0,t.isDefined)(o.domain),value:a,error:"",nullable:o.nullable,default:"number"==typeof a?Number(a).toString():a,length:o.length,editable:n.editable};e.push(r)}}}))}return e},le=(e,t)=>e.findIndex((e=>e.error.length>0))>-1||t.findIndex((e=>e.error.length>0))>-1,ce=e=>{const t=wn(e);re(t,!0),C(le(t,F))},ue=e=>{const t=wn(e);re(t,!1),C(le(t,T))},de=(e,n,a,o)=>{const r=wn(e);let s=!1;return r.forEach(((e,n)=>{let l;if(l=e.hasDomain?(0,t.validateRangeDomain)(e.value,e.name,d):((0,t.isDate)(e.type),(0,t.validateField)(e.value,e.name,d)),(0,t.isDefined)(o)){let t=[];const i=function(e,t,n,a,o,r,i){const s={};if(xn(a))if(-1===e&&-1===n)a.forEach((e=>{s[e.name]=e.value}));else{const t=a[n];a.forEach((n=>{s[n.name]=n.value,n.name===t.name&&(s[n.name]=e)}))}else i.forEach((e=>{const t=r.attributes[e.name],n=e.alias.split(".")[1];s[n]=t}));const l=[];for(const e of o){const t=e.isEditingRestrictive?"error":"warning";let n=!1;const a=e.contingencies.filter((e=>!e.isRetired));if(!a||0===a.length)return[];for(const e of a){let t=!0;for(const n in e.values){const a=e.values[n];if("any"!==a.objectType)if("null"===a.objectType){if(null!=s[n]){t=!1;break}}else if("code"===a.objectType){if(null!=a.codedValue&&s[n]!==a.codedValue.code){t=!1;break}}else if("range"===a.objectType){const e=s[n];if(null!=a.minValue&&null!=a.maxValue&&(e<a.minValue||e>a.maxValue)){t=!1;break}}}if(t){n=!0;break}}n||l.push({fieldGroup:e,type:t})}return l}(e.value,0,n,r,o);(null==i?void 0:i.length)>0&&(i.forEach((e=>{var n;const a=null===(n=null==e?void 0:e.fieldGroup)||void 0===n?void 0:n.fields;t.push(a)})),t=t.flat(),t.includes(e.name)&&(a?X(!0):te(!0),l={hasError:!0,message:"contingentValueError"}))}if(l.hasError){let n;if("contingentValueError"===l.message){const t=[];o.forEach((e=>{(null==e?void 0:e.name)&&t.push(e.name)}));let a=i("invalidContingentValues");a=a.replace("{groupNames}",t.join(",")),n=a,e.error=i(l.message),ae(n)}else{const o=f.useFieldAlias?e.alias:e.name;n=(0,t.formatMessage)(R,"attributeError",{fieldValue:o,message:(0,t.formatMessage)(R,l.message),event1or2:i(a?"event1Label":"event2Label")}),e.error=(0,t.formatMessage)(R,l.message)}D("error"),I(n),S(!0),setTimeout((()=>{S(!1)}),5e3),s=!0}})),s&&(a?ce(r):ue(r)),s},fe=()=>Ln(void 0,void 0,void 0,(function*(){var t;const n=d,a=n.getPopupInfo(),o=n.getLayerDefinition(),r=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==o?void 0:o.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==a?void 0:a.fieldInfos)||[]).filter((e=>e.visible))),i=n.mergeQueryParams(null!==(t=n.getCurrentQueryParams())&&void 0!==t?t:{},{where:"1=1",sqlExpression:null}),l=Object.assign({returnGeometry:!0},i);yield n.load(l,{widgetId:s});const c=new e.DataRecordSetChangeMessage(s,e.RecordSetChangeType.CreateUpdate,[{records:n.getRecords(),fields:r.map((e=>e.fieldName)),dataSource:n,name:n.id}]);e.MessageManager.getInstance().publishMessage(c)})),ve=n=>Ln(void 0,void 0,void 0,(function*(){const a={},o=de(T,0,!0,Tn),r=de(F,0,!1,Mn);if(o||r)return;if(!(()=>{let e="";return(0,t.isDefined)($)?e="Event must have null To Date.":(0,t.isDefined)(H)&&H>(0,t.getDateToUTC)(new Date(Date.now()))&&(e="Event must be active today."),!(e.length>0&&(D("error"),I(e),S(!0),setTimeout((()=>{S(!1)}),5e3),1))})())return;let s=!1;const l=v.selectedFromDate.getTime();if(s=!!((0,t.isDefined)(H)&&l<H||(0,t.isDefined)($)&&l>$),V||W||z||s){const e=i(V||s?"noEventFound":W?"multipleEventsFound":"unableToSplitAtStartOrEnd");return D("error"),I(e),S(!0),void setTimeout((()=>{S(!1)}),5e3)}if((0,t.isDefined)(f)){const e={};T.forEach((n=>{const a=n.name;if((0,t.isDefined)(n.value)&&(0,t.isDate)(n.type)){const o=(0,t.getDateWithoutTZOffset)(n.value.valueOf(),d);e[a]=(0,t.getDateToUTC)(o)}else(0,t.isNumber)(n.type)?!(0,t.isDefined)(n.value)||isNaN(Number(n.value))?e[a]=null:e[a]=Number(n.value):e[a]=n.value}));const n={};if(F.forEach((a=>{const o=a.name;if((0,t.isDefined)(a.value)&&(0,t.isDate)(a.type)){const n=(0,t.getDateWithoutTZOffset)(a.value.valueOf(),d);e[o]=(0,t.getDateToUTC)(n)}else(0,t.isNumber)(a.type)?!(0,t.isDefined)(a.value)||isNaN(Number(a.value))?n[o]=null:n[o]=Number(a.value):n[o]=a.value})),a.attributes=e,a.attributes2=n,a.eventOid=P,a.routeId=v.routeId,a.measure=v.selectedMeasure,(0,t.isDefined)(v.selectedFromDate)){const e=(0,t.getDateWithoutTZOffset)(v.selectedFromDate.valueOf(),d);a.fromDate=e}else a.fromDate=v.selectedFromDate;a.measure=v.selectedMeasure}const u=d;yield function(n,a,o){return kn(this,void 0,void 0,(function*(){const r=a.lrsUrl,i=`${r}/applyEdits`,s=yield e.SessionManager.getInstance().getSessionByUrl(r).getToken(r),l=[],c={id:a.serviceId,splitEvent:{objectId:o.eventOid,routeId:o.routeId,measure:o.measure,fromDate:o.fromDate?(0,t.getDateToUTC)(o.fromDate):null,attributes:o.attributes,attributes2:o.attributes2}};l.push(c);let u=n.getGDBVersion();u||(u="");const d={f:"json",token:s,gdbVersion:u,edits:l};return(0,t.requestService)({method:"GET",url:i,params:d}).then((e=>{const t={success:!1,editResults:[],code:0,message:"",details:""};return e.hasOwnProperty("success")?(t.success=!0,t.editResults=e.editResults):(t.success=!1,t.code=e.code,t.message=e.message,t.details=e.response.error.details[0]),t}))}))}(u,f,a).then((e=>{if(e.success){if((0,t.isDefined)(f)&&(0,t.isDefined)(d)){const n=d;(0,t.queryEventsByEventObjectIds)(n,e.editResults[0].splitEventResult.objectIds).then((e=>{e.forEach(((e,n)=>Ln(void 0,void 0,void 0,(function*(){const a=e.geometry;(0,t.isDefined)(a)&&(0===n?(0,t.flash)(g,yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(a),En)):setTimeout((()=>Ln(void 0,void 0,void 0,(function*(){(0,t.flash)(g,yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(a),En))}))),5e3))}))))}))}D("success"),I(i("eventSplit")),S(!0),fe(),setTimeout((()=>Ln(void 0,void 0,void 0,(function*(){if(S(!1),k&&(0,t.isDefined)(n)){yield(0,t.tryReleaseLockOnDefault)(c,n);const e=Object.assign(Object.assign({},J),{lockAction:t.LockAction.Clear});K(e)}else oe(),y()}))),5e3)}else D("error"),I(e.message),S(!0),setTimeout((()=>{S(!1)}),5e3)}))})),pe=()=>{if(k){const e=Object.assign(Object.assign({},J),{lockAction:t.LockAction.QueryAndAcquire});K(e)}else ve()};return(0,e.jsx)("div",{className:"split-event-edit-attributes__content",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .split-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .split-event-edit-attributes__action {
      height: 100%;
    }
  `},(0,e.jsx)("div",{className:"h-100"},k&&(0,e.jsx)(t.LockManagerComponent,{intl:R,featureDS:c,lockInfo:J,showAlert:!1,conflictPreventionEnabled:k,onQueryAndAcquireComplete:(e,n,a)=>{const o=Object.assign(Object.assign({},e),{lockAction:t.LockAction.None});K(o),a&&ve(o)},onMessageClear:()=>{const e=Object.assign(Object.assign({},J),{lockAction:t.LockAction.None});K(e),y()}}),(Y||ee)&&(0,e.jsx)("div",{style:{marginTop:"1.2rem"}},(0,e.jsx)(a.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){Y&&X(!1),ee&&te(!1)},open:Y||ee,text:ne,type:"warning",closable:!0,withIcon:!0})),(0,e.jsx)(t.AttributeTable,{tableIndex:0,collapable:!1,eventDS:d,eventLayer:f,fieldInfos:T,useAlias:!(0,t.isDefined)(f)||f.useFieldAlias,onUpdateItem:(e,t,n)=>{const a=wn(T);a[n].value=e,a[n].error=t,re(a,!0),C(le(a,T))},onUpdateAll:ce,tableLabel:p,onFieldGrpUpdated:(e,t)=>{Tn=e,Tn&&0!==(null==Tn?void 0:Tn.length)||X(!1)}}),(0,e.jsx)(t.AttributeTable,{tableIndex:1,collapable:!1,eventDS:d,eventLayer:f,fieldInfos:F,useAlias:!(0,t.isDefined)(f)||f.useFieldAlias,onUpdateItem:(e,t,n)=>{const a=wn(F);a[n].value=e,a[n].error=t,re(a,!1),C(le(a,T))},onUpdateAll:ue,tableLabel:m,onFieldGrpUpdated:(e,t)=>{Mn=e,Mn&&0!==(null==Mn?void 0:Mn.length)||te(!1)}})))}));function An(t){const{network:n,event:a,dataSourcesReady:o,onCreateNetworkDs:r,onCreateEventDs:i}=t,[s,l]=e.React.useState(null!=n?n:null),[c,u]=e.React.useState(null!=a?a:null),[d,f]=e.React.useState(!1),[v,p]=e.React.useState(!1);e.React.useEffect((()=>{n&&l(n)}),[n]),e.React.useEffect((()=>{a&&u(a)}),[a]),e.React.useEffect((()=>{o(d&&v)}),[o,v,d]);const m=e.React.useCallback((e=>{r(e)}),[r]),h=e.React.useCallback((e=>{i(e)}),[i]),b=e.React.useCallback((t=>{if(t){const{status:n,instanceStatus:a}=t;a===e.DataSourceStatus.NotCreated||a===e.DataSourceStatus.CreateError||n===e.DataSourceStatus.LoadError||n===e.DataSourceStatus.NotReady?f(!1):f(!0)}}),[f]),y=e.React.useCallback((t=>{if(t){const{status:n,instanceStatus:a}=t;a===e.DataSourceStatus.NotCreated||a===e.DataSourceStatus.CreateError||n===e.DataSourceStatus.LoadError||n===e.DataSourceStatus.NotReady?p(!1):p(!0)}}),[p]),g=e.React.useCallback((()=>{f(!1)}),[f]),D=e.React.useCallback((()=>{p(!1)}),[p]);return(0,e.jsx)("div",null,s&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:s.useDataSource,onDataSourceInfoChange:b,onCreateDataSourceFailed:g,onDataSourceCreated:m}),c&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:c.useDataSource,onDataSourceInfoChange:y,onCreateDataSourceFailed:D,onDataSourceCreated:h}))}const _n=function(){return k.Date.now()};var Cn=/\s/;const Pn=function(e){for(var t=e.length;t--&&Cn.test(e.charAt(t)););return t};var Gn=/^\s+/;const Vn=function(e){return e?e.slice(0,Pn(e)+1).replace(Gn,""):e};const Un=function(e){return"symbol"==typeof e||xe(e)&&"[object Symbol]"==_(e)};var Wn=/^[-+]0x[0-9a-f]+$/i,qn=/^0b[01]+$/i,zn=/^0o[0-7]+$/i,Bn=parseInt;const Hn=function(e){if("number"==typeof e)return e;if(Un(e))return NaN;if(C(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=C(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Vn(e);var n=qn.test(e);return n||zn.test(e)?Bn(e.slice(2),n?2:8):Wn.test(e)?NaN:+e};var Qn=Math.max,$n=Math.min;const Zn=function(e,t,n){var a,o,r,i,s,l,c=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var n=a,r=o;return a=o=void 0,c=t,i=e.apply(r,n)}function p(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-c>=r}function m(){var e=_n();if(p(e))return h(e);s=setTimeout(m,function(e){var n=t-(e-l);return d?$n(n,r-(e-c)):n}(e))}function h(e){return s=void 0,f&&a?v(e):(a=o=void 0,i)}function b(){var e=_n(),n=p(e);if(a=arguments,o=this,l=e,n){if(void 0===s)return function(e){return c=e,s=setTimeout(m,t),u?v(e):i}(l);if(d)return clearTimeout(s),s=setTimeout(m,t),v(l)}return void 0===s&&(s=setTimeout(m,t)),i}return t=Hn(t)||0,C(n)&&(u=!!n.leading,r=(d="maxWait"in n)?Qn(Hn(n.maxWait)||0,t):r,f="trailing"in n?!!n.trailing:f),b.cancel=function(){void 0!==s&&clearTimeout(s),c=0,a=l=o=s=void 0},b.flush=function(){return void 0===s?i:h(_n())},b};var Jn=1/0;const Kn=function(e){return e?(e=Hn(e))===Jn||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Yn=function(e){var t=Kn(e),n=t%1;return t==t?n?t-n:t:0};const Xn=function(e,t){for(var n=-1,a=null==e?0:e.length,o=Array(a);++n<a;)o[n]=t(e[n],n,e);return o};var ea=E?E.prototype:void 0,ta=ea?ea.toString:void 0;const na=function e(t){if("string"==typeof t)return t;if(Ce(t))return Xn(t,e)+"";if(Un(t))return ta?ta.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const aa=function(e){return null==e?"":na(e)};var oa=k.isFinite,ra=Math.min;const ia=function(e){var t=Math[e];return function(e,n){if(e=Hn(e),(n=null==n?0:ra(Yn(n),292))&&oa(e)){var a=(aa(e)+"e").split("e"),o=t(a[0]+"e"+(+a[1]+n));return+((a=(aa(o)+"e").split("e"))[0]+"e"+(+a[1]-n))}return t(e)}}("round");var sa=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((a=a.apply(e,t||[])).next())}))};function la(o){const r=e.hooks.useTranslation(n),{intl:i,widgetId:s,isReady:l,network:c,networkDS:u,routeInfo:d,jimuMapView:f,hoverGraphic:v,reset:p,routeInfoFromDataAction:m,revalidateRouteFromDataAction:h,onResetDataAction:b,clearPickedGraphic:y,onRouteInfoUpdated:g,measureLabelId:D}=o,[I,S]=e.React.useState(!1),[R,j]=e.React.useState(""),[w,k]=e.React.useState(!1),[E,N]=e.React.useState([]),[O,x]=e.React.useState(),L=e.React.useRef(null),T=e.React.useRef((e=>{})),M=e.React.useRef(null),F=e.React.useRef(null),A=e.React.useRef(null),_=e.React.useRef(null),C=e.React.useRef(null),P=e.React.useRef(!1),G=e.React.useRef(!1),[V,U]=e.React.useState(null),[W,q]=e.React.useState(!1),[z,B]=e.React.useState([]);e.React.useEffect((()=>{T.current=Zn(H,400)}),[]),e.React.useEffect((()=>{p&&Y()}),[p]);const H=e.hooks.useEventCallback((e=>{const n=c.useRouteName?c.routeNameFieldSchema.jimuName:c.routeIdFieldSchema.jimuName,a=(0,t.getSuggestions)(n,e,u);Promise.all([a]).then((e=>{const t=null==e?void 0:e[0];t&&B(t),M.current&&q(!0)}))})),Q=e=>{U(e),M.current=e},$=()=>{(0,e.focusElementInKeyboardMode)(F.current),Z(!0,!1)},Z=(e=!1,t=!0)=>{e||(G.current=!1)};e.React.useEffect((()=>{h&&(Q(c.useRouteName?m.routeName:m.routeId),j(""),g(m),Y(),b())}),[h]),e.React.useEffect((()=>{(0,t.isDefined)(c)&&(U(""),j(""),S(!1),y())}),[c]),e.React.useEffect((()=>{(0,t.isDefined)(f)&&x(null==f?void 0:f.view.popupEnabled)}),[f]),e.React.useEffect((()=>{(0,t.isDefined)(c)&&c.useRouteName?U(d.routeName):U(d.routeId),isNaN(d.selectedMeasure)?j(""):j(d.selectedMeasure.toString())}),[c,d]),e.React.useEffect((()=>{isNaN(d.selectedMeasure)?j(""):j(d.selectedMeasure.toString())}),[c,d.selectedMeasure]);const J=(e,n)=>sa(this,void 0,void 0,(function*(){const n=(0,t.getNetworkOutFields)(c),a=c.useRouteName?e.attributes[n.routeNameFieldName]:"",o=e.attributes[n.routeIdFieldName],r=e.attributes[n.fromDateFieldName],i=e.attributes[n.toDateFieldName],s=e.geometry,l=(0,t.getRouteFromEndMeasures)(s),f=e.attributes[n.lineIdFieldName],v=e.attributes[n.lineNameFieldName];let p=new Date(Date.now());(0,t.isDefined)(i)&&p>i?p=(0,t.getDateWithTZOffset)(r,u):p.setHours(0,0,0,0);let m=new Date(Date.now());return(0,t.isDefined)(i)&&m>i?m=(0,t.getDateWithTZOffset)(i,u):m.setHours(0,0,0,0),(0,t.isDefined)(i)||(m=null),yield(0,t.QueryRouteMeasures)(u,c,l,r,o).then((e=>{const n=Math.min(...e),l=Math.max(...e);return Object.assign(Object.assign({},d),{routeName:a,routeId:o,fromDate:(0,t.isDefined)(r)?(0,t.getDateWithTZOffset)(r,u):null,toDate:(0,t.isDefined)(i)?(0,t.getDateWithTZOffset)(i,u):null,selectedPolyline:s,fromMeasure:ia(n,c.measurePrecision),toMeasure:ia(l,c.measurePrecision),validRoute:!0,selectedFromDate:p,selectedToDate:m,lineName:v,lineId:f})}))})),K=(e,n)=>(0,t.QueryMeasureOnRoute)(u,c,e.routeId,e.fromDate,R).then((t=>{if(t){return Object.assign(Object.assign({},e),{selectedPoint:t,selectedMeasure:parseFloat(n?e.selectedMeasure.toString():R)})}return Object.assign(Object.assign({},e),{selectedPoint:null})})),Y=()=>{setTimeout((()=>{F.current.select(),(0,e.focusElementInKeyboardMode)(F.current,!0),F.current.blur(),A.current.select(),(0,e.focusElementInKeyboardMode)(A.current,!0),A.current.blur()}),200)},X=e.React.useCallback(((e,t=!1)=>{g(e,t),C.current=null,Y()}),[g]),ee=e=>{j(e)},te=e.React.useCallback((e=>{e.length&&(k(!0),N(e))}),[]),ne=e.React.useCallback((e=>{(0,t.isDefined)(e)&&(g(e,!0),C.current=null,Y()),k(!1)}),[g]),ae=e.React.useCallback((()=>{k(!1)}),[]);return(0,e.jsx)("div",{className:"route-and-measure-form d-flex w-100 px-3"},c&&(0,e.jsx)("div",{className:"w-100"},(0,e.jsx)(a.Label,{size:"sm",className:"w-100 mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},c.useRouteName?(0,t.formatMessage)(i,"routeNameRequiredLabel"):(0,t.formatMessage)(i,"routeIdRequiredLabel")),(0,e.jsx)("div",{ref:L,className:"d-flex w-100"},(0,e.jsx)(a.TextInput,{"aria-label":c.useRouteName?(0,t.formatMessage)(i,"routeNameRequiredLabel"):(0,t.formatMessage)(i,"routeIdRequiredLabel"),type:"text",className:"w-100",size:"sm",allowClear:!0,disabled:!l,onBlur:()=>{_.current=setTimeout((()=>{P.current||q(!1),G.current||Z(!1)}),200)},value:V||"",ref:F,onChange:e=>{var t;C.current=null;const n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,a=(null==n?void 0:n.length)>2;if(Q(n),!a)return q(!1),!1;T.current(n)},checkValidityOnAccept:(e,n=!1)=>new Promise((a=>{setTimeout((()=>{C.current&&(e=C.current);const o=[],r=(0,t.queryRouteIdOrName)(e,c,u).then((a=>sa(this,void 0,void 0,(function*(){if((0,t.isDefined)(a)){if(!n&&(p||e===d.routeId||e===d.routeName))return{valid:!0};if(yield Promise.all(a.features.map((t=>sa(this,void 0,void 0,(function*(){const n=J(t,e);o.push(yield n)}))))),o.length>1&&!n)te(o);else{if(R.length>0||n&&!isNaN(d.selectedMeasure))return K(o[0],n).then((e=>(g(e,!0),{valid:!0})));g(o[0],!0)}return{valid:!0}}})))).catch((t=>{if(c.useRouteName){const t=Object.assign(Object.assign({},d),{routeName:e,validRoute:!1});g(t)}else{const t=Object.assign(Object.assign({},d),{routeId:e,validRoute:!1});g(t)}if(e.length){return{valid:!1,msg:"Route '"+e.replace(/ /g,"\xa0")+"' not found"}}return{valid:!0}}));a(r)}),200)}))}),V&&(0,e.jsx)(t.Intellisense,{isOpen:(W||(P.current=!1),W),reference:L,searchText:V,searchSuggestion:z,onRecordItemClick:(e,t)=>{if(t)return $(),!1;C.current=e,Q(e)},id:s,searchInputRef:F}),(0,e.jsx)(t.RoutePicker,{type:"route-measure",active:I,networkDs:u,network:c,routeInfo:d,disabled:!l,jimuMapView:f,symbolColor:null,hoverGraphic:v,isFrom:!0,onActiveChange:()=>{const e=!I;S(e),e?f.view.popupEnabled=!1:setTimeout((()=>{f.view.popupEnabled=O}),800)},onRouteInfoUpdated:X,onMultiRouteSelect:te})),(0,e.jsx)(a.Label,{size:"sm",className:"w-100 mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},r(D||"measureWithUnits",{units:(0,t.GetUnits)(c.unitsOfMeasure,i)})),(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(a.TextInput,{ref:A,"aria-label":r("measureWithUnits",{units:(0,t.GetUnits)(c.unitsOfMeasure,i)}),className:"w-100",size:"sm",value:R,disabled:!l,onChange:e=>{ee(e.target.value)},checkValidityOnAccept:e=>sa(this,void 0,void 0,(function*(){let n=NaN;if(""===e){n=NaN;const e=Object.assign(Object.assign({},d),{selectedMeasure:NaN,selectedPoint:null});return g(e),ee(""),{valid:!0}}if(n=isNaN(Number(e))?(0,t.convertStationToNumber)(e):Number(e),isNaN(n)){y();const e=Object.assign(Object.assign({},d),{selectedMeasure:NaN,selectedPoint:null});return g(e),ee(""),{valid:!0}}if((0,t.isDefined)(d.selectedPolyline)){n=ia(n,c.measurePrecision);let e=Object.assign(Object.assign({},d),{selectedMeasure:n});if(n<d.fromMeasure)return g(e),{valid:!1,msg:r("measureLessError")};if(n>d.toMeasure)return g(e),{valid:!1,msg:r("measureGreaterError")};e.routeId.length?yield(0,t.QueryMapPointWithMeasureOnRoute)(u,c,e.routeId,e.fromDate,n.toString()).then((n=>{(0,t.isDefined)(n)&&(e=Object.assign(Object.assign({},e),{selectedPoint:n,isNearestCoordinate:!1}),g(e))})):g(e)}return{valid:!0}}))})),(0,e.jsx)(t.RoutePickerPopup,{isOpen:w,routeInfos:E,useRouteName:c.useRouteName,onRouteSelect:ne,onRouteSelectCancel:ae,measurePrecision:c.measurePrecision,isFrom:!0,jimuMapView:f,graphicLayer:v})))}var ca=c(99037);function ua(o){const r=e.hooks.useTranslation(n),{routeInfo:i,reset:s,onUpdateRouteInfo:l,hideDate:c,useRouteStartDate:u,revalidateRouteFromDataAction:d}=o,[f,v]=e.React.useState(!1),[p,m]=e.React.useState(!1),[h,b]=e.React.useState("idle"),[y,g]=e.React.useState("idle"),[D,I]=e.React.useState(""),[S,R]=e.React.useState("");e.React.useEffect((()=>{d&&(v(!1),m(!1),I(""),R(""))}),[d]),e.React.useEffect((()=>{v(u),m(u)}),[c]),e.React.useEffect((()=>{s&&(v(u),m(u),b("idle"),g("idle"),I(""),R(""))}),[s]),e.React.useEffect((()=>{let e=!1;const n=Object.assign({},i);"idle"===h&&I(""),"idle"===y&&R(""),(0,t.isDefined)(i.selectedFromDate)&&f&&i.selectedFromDate!==i.fromDate&&(n.selectedFromDate=i.fromDate,e=!0),p&&i.selectedToDate!==i.toDate&&(n.selectedToDate=i.toDate,e=!0),e&&l(n)}),[l,i,f,p]);const j=(e,n)=>{const a=e;if(!(0,t.isDefined)(a))return n?b("idle"):g("idle"),n?I(""):R(""),!0;let o=!0;return(0,t.isDefined)(i.fromDate)&&a<i.fromDate?(n?b("invalid"):g("invalid"),n?I(r("invalidFromDateBefore")):R(r("invalidToDateBefore")),o=!1,!1):(0,t.isDefined)(i.toDate)&&a>i.toDate?(n?b("invalid"):g("invalid"),n?I(r("invalidFromDateAfter")):R(r("invalidToDateAfter")),o=!1,!1):((0,t.isDefined)(i.selectedToDate)&&n&&(a>i.selectedToDate&&(b("invalid"),n?I(r("invalidDatesOrder")):R(r("invalidDatesOrder")),o=!1),S===r("invalidDatesOrder")?a<i.selectedToDate&&(g("idle"),R("")):S===r("invalidDatesSameDay")&&a!==i.selectedFromDate&&(g("idle"),R(""))),(0,t.isDefined)(i.selectedToDate)&&n&&a.getTime()===i.selectedToDate.getTime()&&(b("invalid"),n?I(r("invalidDatesSameDay")):R(r("invalidDatesSameDay")),o=!1),(0,t.isDefined)(i.selectedFromDate)&&(n||(a<i.selectedFromDate&&(g("invalid"),n?I(r("invalidDatesOrder")):R(r("invalidDatesOrder")),o=!1),D===r("invalidDatesOrder")?a>i.selectedFromDate&&(b("idle"),I("")):D===r("invalidDatesSameDay")&&a!==i.selectedFromDate&&(b("idle"),I("")))),(0,t.isDefined)(i.selectedFromDate)&&(n||a.getTime()!==i.selectedFromDate.getTime()||(g("invalid"),n?I(r("invalidDatesSameDay")):R(r("invalidDatesSameDay")),o=!1)),o&&(n?b("idle"):g("idle"),n?I(""):R("")),!0)};return(0,e.jsx)("div",{className:"split-event-date-form px-3 w-100",css:(0,t.getCalciteBasicTheme)()},!c&&(0,e.jsx)("div",null,(0,e.jsx)(a.Label,{size:"sm",className:"mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},r("splitDateLabel")),(0,e.jsx)(a.Tooltip,{title:D},(0,e.jsx)(ca.CalciteInputDatePicker,{scale:"s",disabled:!!f||void 0,valueAsDate:i.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const n=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;j(n,!0);const a=Object.assign(Object.assign({},i),{selectedFromDate:n});l(a)}},status:h,placement:"top",overlayPositioning:"fixed"})),(0,e.jsx)(a.Label,{size:"sm",className:"w-100 pt-2",centric:!0,check:!0},(0,e.jsx)(a.Checkbox,{checked:f,className:"mr-2",onChange:(e,t)=>{j(i.fromDate,!0),v(t)}}),r("useStartDateLabel"))))}var da=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((a=a.apply(e,t||[])).next())}))};function fa(n){const{widgetId:a,network:o,networkDS:r,reset:i,jimuMapView:s,hoverGraphic:l,pickedGraphic:c,flashGraphic:u,onUpdateRouteInfo:d,intl:f,hideDate:v,useRouteStartDate:p,routeInfoFromDataAction:m,revalidateRouteFromDataAction:h,onResetDataAction:b,isReady:y,onValidationChanged:g}=n,[D,I]=e.React.useState((0,t.getInitialRouteInfoState)());e.React.useEffect((()=>{(0,t.isDefined)(o)&&!h&&(I((0,t.getInitialRouteInfoState)()),S())}),[o]),e.React.useEffect((()=>{i&&(I((0,t.getInitialRouteInfoState)()),S())}),[i]);const S=()=>{(0,t.isDefined)(c)&&c.removeAll()},R=(e,n)=>da(this,void 0,void 0,(function*(){var a;(0,t.isDefined)(e.selectedPolyline)&&n&&(0,t.flash)(u,yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(e.selectedPolyline),En)),(0,t.isDefined)(e.selectedPoint)?(a=yield(0,t.getGeometryGraphic)(yield(0,t.getSimplePointGraphic)(e.selectedPoint),"#008000"),(0,t.isDefined)(a)?(c.removeAll(),c.add(a)):S()):S()})),j=(e,t=!1)=>{I(e),d(e),R(e,t)},w=e.React.useCallback((()=>{var e;if(!D.validRoute)return!1;if(0===(null===(e=D.routeId)||void 0===e?void 0:e.length))return!1;if(isNaN(D.selectedMeasure))return!1;if(isNaN(D.fromMeasure))return!1;if(D.selectedMeasure<D.fromMeasure)return!1;if(!(0,t.isDefined)(D.selectedFromDate)&&!(0,t.isDefined)(D.selectedToDate))return!1;if((0,t.isDefined)(D.selectedFromDate)&&!(0,t.isDefined)(D.selectedToDate)){if((0,t.isDefined)(D.fromDate)&&D.selectedFromDate<D.fromDate)return!1;if((0,t.isDefined)(D.toDate)&&D.selectedFromDate>D.toDate)return!1}return!0}),[D]);return e.React.useEffect((()=>{g(w()&&y)}),[y,w,g]),(0,e.jsx)("div",{className:"split-event-route-selection-form__content d-flex",css:e.css`
    display: flex;
    flex-direction: column;

    .split-event-route-selection-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .split-event-route-selection-form__actions {
      height: 100%;
    }
  `},(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(la,{widgetId:a,isReady:y,network:o,networkDS:r,routeInfo:D,jimuMapView:s,hoverGraphic:l,reset:i,clearPickedGraphic:S,onRouteInfoUpdated:j,routeInfoFromDataAction:m,revalidateRouteFromDataAction:h,onResetDataAction:b,intl:f,measureLabelId:"splitMeasureWithUnits"})),(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(ua,{routeInfo:D,reset:i,onUpdateRouteInfo:j,hideDate:v,useRouteStartDate:p,revalidateRouteFromDataAction:h})))}function va(o){var r;const i=e.hooks.useTranslation(n),{widgetId:l,hideTitle:c,lrsLayers:u,eventLayers:d,networkLayers:f,defaultEvent:v,JimuMapView:p,hoverGraphic:m,pickedGraphic:h,flashGraphic:b,conflictPreventionEnabled:y,onClearGraphic:g,hideEvent:D,hideNetwork:I,hideDate:S,useRouteStartDate:R,intl:j,selectedEventLyr:w,selectedEventObjectId:k,routeInfoFromDataAction:E,onUpdateNetworkDS:N,onResetDataAction:O}=o,[x,L]=e.React.useState(null),[T,M]=e.React.useState(null),[F,A]=e.React.useState(null),[_,C]=e.React.useState(null),[P,G]=e.React.useState(!1),[V,U]=e.React.useState(!1),[W,q]=e.React.useState(null),[z,B]=e.React.useState(i("chooseEventLocationFromMap")),[H,Q]=e.React.useState(!1),[$,Z]=e.React.useState(),[J,K]=e.React.useState(""),[Y,X]=e.React.useState((0,t.getIntialLocksInfo)()),[ee,te]=e.React.useState(!y),[ne,ae]=e.React.useState(!0),[oe,re]=e.React.useState(!1),ie=e.React.useRef(null);e.React.useEffect((()=>{(0,t.isDefined)(k)&&(C(w),B(null==k?void 0:k.toString())),re((0,t.isDefined)(E))}),[E]),e.React.useEffect((()=>{(0,t.isDefined)(w)&&w.id!==(null==_?void 0:_.id)&&(0,t.isDefined)(w)&&pe(w.name)}),[w]);const se=e.React.useCallback((e=>{L(e),N(e)}),[L,N]),le=e.React.useCallback((e=>{M(e)}),[M]),ce=e.React.useCallback((()=>{G(!0)}),[G]),ue=e.React.useCallback((()=>{B(i("chooseEventLocationFromMap"))}),[i]),de=e.React.useCallback((()=>{g(),fe()}),[]),fe=e.React.useCallback((()=>{q((0,t.getInitialRouteInfoState)()),ve(t.LockAction.Clear,(0,t.getInitialRouteInfoState)()),ue(),U(!0),setTimeout((()=>{U(!1)}),800)}),[]);e.React.useEffect((()=>{if(_){const n=u.find((e=>(0,t.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===_.eventInfo.parentNetworkId));n&&n.layerType===t.LrsLayerType.network&&A((0,e.Immutable)(n))}else{const t=u.find((e=>e.name===v.name));C((0,e.Immutable)(t))}fe()}),[v,u,_,fe]),e.React.useEffect((()=>{ve(t.LockAction.None)}),[x,_,F]);const ve=(e=t.LockAction.None,n)=>{if(y){const a=Object.assign({},Y);(0,t.isDefined)(F)&&(a.networkId=[F.networkInfo.lrsNetworkId]),(0,t.isDefined)(_)&&(a.eventServiceLayerIds=[_.serviceId]),(0,t.isDefined)(n)&&(a.routeInfo=n),a.lockAction=e,X(a)}},pe=e.React.useCallback((n=>{const a=u.find((e=>e.name===n));if(a){const n=u.find((e=>(0,t.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===a.eventInfo.parentNetworkId));n&&n.layerType===t.LrsLayerType.network&&A((0,e.Immutable)(n)),C((0,e.Immutable)(a))}}),[u]),me=e.React.useCallback((n=>{const a=u.find((e=>e.name===n));(0,t.isDefined)(a)&&A((0,e.Immutable)(a))}),[u]),he=e.React.useMemo((()=>!!(P&&(0,t.isDefined)(p)&&(0,t.isDefined)(null==p?void 0:p.view))),[p,P]),be=e.React.useCallback(((e,t,n)=>{te(!!n),X(e)}),[]),ye=e.React.useCallback((e=>{ae(e)}),[]);return(0,e.jsx)("div",{className:"split-event h-100 d-flex",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .split-event-form {
      height: 100%;
    }

    .split-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .split-event__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .split-event__toast {
      position: relative;
      top: 4%;
    }
    .split-event-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},!c&&(0,e.jsx)(s,null),(0,e.jsx)("div",{className:"split-event__content"},(0,e.jsx)(An,{network:F,event:_,dataSourcesReady:ce,onCreateNetworkDs:se,onCreateEventDs:le}),y&&(0,e.jsx)(t.LockManagerComponent,{intl:j,showAlert:!0,featureDS:x,lockInfo:Y,networkName:null===(r=null==F?void 0:F.networkInfo)||void 0===r?void 0:r.datasetName,conflictPreventionEnabled:y,onQueryAndAcquireComplete:be,onMessageClear:()=>{ve(t.LockAction.None)}}),!D&&(0,e.jsx)("div",null,(0,e.jsx)(a.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100",style:{fontWeight:500}},(0,t.formatMessage)(j,"eventRequiredLabel")),(0,e.jsx)(a.Select,{"aria-label":(0,t.formatMessage)(j,"eventRequiredLabel"),className:"w-100 px-3",size:"sm",value:_?_.name:"",disabled:1===d.length,onChange:e=>{pe(e.target.value)}},d.map(((t,n)=>(0,e.jsx)("options",{key:n,value:t},t))))),!I&&(0,e.jsx)("div",null,(0,e.jsx)(t.InlineEditableDropdown,{label:(0,t.formatMessage)(j,"networkRequiredLabel"),isDisabled:!0,defaultItem:(0,t.isDefined)(F)?F.name:"",listItems:f,onSelectionChanged:me})),(0,e.jsx)(fa,{widgetId:l,network:F?F.networkInfo:null,isReady:he&&(null==p?void 0:p.view.ready),reset:V,networkDS:x,jimuMapView:p,hoverGraphic:m,pickedGraphic:h,flashGraphic:b,onUpdateRouteInfo:e=>{q(e),ve(t.LockAction.QueryAndAcquire,e)},hideDate:S,useRouteStartDate:R,intl:j,routeInfoFromDataAction:E,revalidateRouteFromDataAction:oe,onResetDataAction:O,onValidationChanged:ye}),(0,e.jsx)(a.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100",style:{fontWeight:500}},i("eventOidLabel")+" *"),(0,e.jsx)("div",{className:"d-flex w-100 px-3"},(0,e.jsx)(a.Label,{size:"sm",className:"d-flex mb-0 w-100",style:{width:100,alignItems:"center"}},z)),(0,e.jsx)(Fn,{resetClick:V,ref:ie,intl:j,table1Label:i("event1Label"),table2Label:i("event2Label"),widgetId:l,networkDS:x,network:F,eventDS:T,eventLayer:_,routeInfo:W,onUpdateEventOid:e=>{B(e)},networkLayer:F,flashGraphic:b,onSubmit:de,onUpdateToastMsgType:Z,onUpdateToastMsg:K,onUpdateToastOpen:Q,selectedEventObjectId:k,lockAquired:ee,conflictPreventionEnabled:y,onValidationChanged:ye,revalidateRouteFromDataAction:oe,routeInfoFromDataAction:E,resetEventOid:ue,currentEventOid:z})),(0,e.jsx)("div",{className:"split-event-footer w-100"},(0,e.jsx)("div",{className:"split-event-footer__action w-100 d-flex"},(0,e.jsx)(a.Label,{size:"sm",className:" mt-auto mr-auto",style:{fontWeight:500,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--sys-color-primary-main)"},onClick:fe},"Reset"),(0,e.jsx)(a.Tooltip,{title:i("splitLabel")},(0,e.jsx)("div",{className:"mt-auto ml-auto"},(0,e.jsx)(a.Button,{type:"primary",className:"active","aria-label":i("splitLabel"),size:"sm",disabled:!ne||!(0,t.isDefined)(z)||z===i("chooseEventLocationFromMap"),onClick:()=>{var e;null===(e=ie.current)||void 0===e||e.onSubmitClicked()}},i("splitLabel")))))),H&&(0,e.jsx)("div",{className:"split-event__toast-container px-3 w-100"},(0,e.jsx)(a.Alert,{className:"split-event__toast w-100",type:$,text:J,closable:!0,withIcon:!0,open:H,onClose:()=>{Q(!1)}})))}var pa=c(59620),ma=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((a=a.apply(e,t||[])).next())}))};const ha=e.css`
  background-color: var(--ref-palette-white);
`;class ba extends e.React.PureComponent{constructor(o){super(o),this.componentDidMount=()=>{var e,n,a,o;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedEventLyr)&&this.setState({selectedEventLyr:this.props.selectedEventLyr}),(null===(n=this.props.mutableStatePropsVersion)||void 0===n?void 0:n.selectedEventObjectId)&&this.setState({selectedEventObjectId:this.props.selectedEventObjectId}),(null===(a=this.props.mutableStatePropsVersion)||void 0===a?void 0:a.selectedEventRouteId)&&this.setState({selectedEventRouteId:this.props.selectedEventRouteId}),(null===(o=this.props.mutableStatePropsVersion)||void 0===o?void 0:o.selectedEventFromDate)&&this.setState({selectedEventFromDate:this.props.selectedEventFromDate});const r=(0,t.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:r})},this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))},this.waitForChildDataSourcesReady=t=>ma(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const n=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==n?void 0:n.isDataSourceSet())&&!n.areChildDataSourcesCreated()?n.childDataSourcesReady().then((()=>n)).catch((e=>n)):Promise.resolve(n)})),this.getI18nMessage=(e,t)=>{const o=Object.assign({},n,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:o[e]},t)},this.state={hideTitle:!1,jimuMapView:void 0,hoverGraphic:null,pickedGraphic:null,flashGraphic:null,selectedEventLyr:null,selectedEventObjectId:null,selectedEventRouteId:null,selectedEventFromDate:null,routeInfoFromDataAction:null,networkDataSourceFromDataAction:null},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(n,a){var o,r,i,s,l,c,u,d,f,v,p,m,h,b,y;a.jimuMapView!==this.state.jimuMapView&&(0,t.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers());const g=null===(i=null===(r=null===(o=(0,e.getAppStore)())||void 0===o?void 0:o.getState())||void 0===r?void 0:r.widgetsRuntimeInfo[this.props.id])||void 0===i?void 0:i.state;if(g===e.WidgetState.Opened||!g){let e=!1;(null===(s=this.props)||void 0===s?void 0:s.selectedEventLyr)&&(n&&n.mutableStatePropsVersion&&n.mutableStatePropsVersion.selectedEventLyr&&(null===(l=null==n?void 0:n.mutableStatePropsVersion)||void 0===l?void 0:l.selectedEventLyr)===(null===(c=this.props.mutableStatePropsVersion)||void 0===c?void 0:c.selectedEventLyr)||(this.setState({selectedEventLyr:this.props.selectedEventLyr}),e=!0)),(null===(u=this.props)||void 0===u?void 0:u.selectedEventObjectId)&&(n&&n.mutableStatePropsVersion&&n.mutableStatePropsVersion.selectedEventObjectId&&(null===(d=null==n?void 0:n.mutableStatePropsVersion)||void 0===d?void 0:d.selectedEventObjectId)===(null===(f=this.props.mutableStatePropsVersion)||void 0===f?void 0:f.selectedEventObjectId)||(this.setState({selectedEventObjectId:this.props.selectedEventObjectId}),e=!0)),(null===(v=this.props)||void 0===v?void 0:v.selectedEventRouteId)&&(n&&n.mutableStatePropsVersion&&n.mutableStatePropsVersion.selectedEventRouteId&&(null===(p=null==n?void 0:n.mutableStatePropsVersion)||void 0===p?void 0:p.selectedEventRouteId)===(null===(m=this.props.mutableStatePropsVersion)||void 0===m?void 0:m.selectedEventRouteId)||(this.setState({selectedEventRouteId:this.props.selectedEventRouteId}),e=!0)),(null===(h=this.props)||void 0===h?void 0:h.selectedEventFromDate)&&(n&&n.mutableStatePropsVersion&&n.mutableStatePropsVersion.selectedEventFromDate&&(null===(b=null==n?void 0:n.mutableStatePropsVersion)||void 0===b?void 0:b.selectedEventRouteId)===(null===(y=this.props.mutableStatePropsVersion)||void 0===y?void 0:y.selectedEventRouteId)||(this.setState({selectedEventFromDate:this.props.selectedEventFromDate}),e=!0)),e&&this.setRouteInfoFromDataAction(this.props.selectedEventLyr,this.props.selectedEventRouteId,this.props.selectedEventFromDate)}}removeGraphicLayers(){(0,t.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,t.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,t.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,n;if((0,t.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const t=new pa.default({listMode:"hide"}),a=new pa.default({listMode:"hide"}),o=new pa.default({listMode:"hide"});null===(n=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===n||n.map.addMany([a,o,t]),this.setState({hoverGraphic:t}),this.setState({pickedGraphic:a}),this.setState({flashGraphic:o})}}clearGraphics(){(0,t.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,t.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,t.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}resetDataAction(){this.setState({selectedEventLyr:null,selectedEventObjectId:null,selectedEventRouteId:null,selectedEventFromDate:null,routeInfoFromDataAction:null})}setRouteInfoFromDataAction(n,a,o){if((0,t.isDefined)(n)&&(0,t.isDefined)(a)&&(0,t.isDefined)(o)){const r=this.props.config.lrsLayers.find((e=>(0,t.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===n.eventInfo.parentNetworkId));r&&r.layerType===t.LrsLayerType.network&&(0,t.queryRouteIdOrName)(a.trim(),(0,e.Immutable)(r.networkInfo),this.state.networkDataSourceFromDataAction,!1,!0,"",o,!0).then((e=>ma(this,void 0,void 0,(function*(){(0,t.isDefined)(e)&&(yield Promise.all(e.features.map((e=>ma(this,void 0,void 0,(function*(){const n=(0,t.getInitialRouteInfoState)(),a=yield(0,t.setRouteInfoByRouteIdOrName)(n,r.networkInfo,this.state.networkDataSourceFromDataAction,e);this.setState({routeInfoFromDataAction:a})}))))))}))))}}onUpdateNetworkDS(e){this.setState({networkDataSourceFromDataAction:e})}render(){var t;const{config:n,id:o}=this.props,{lrsLayers:s,networkLayers:l,eventLayers:c,defaultEvent:u,conflictPreventionEnabled:d,hideEvent:f,hideNetwork:v,hideDate:p,useRouteStartDate:m}=n,{jimuMapView:h}=this.state;return(null==l?void 0:l.length)&&(null==c?void 0:c.length)?(0,e.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-split-event surface-1 border-0",css:ha},(0,e.jsx)(i.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(va,{widgetId:o,hideTitle:this.state.hideTitle,lrsLayers:s,JimuMapView:h,eventLayers:c,networkLayers:l,defaultEvent:u,hoverGraphic:this.state.hoverGraphic,pickedGraphic:this.state.pickedGraphic,flashGraphic:this.state.flashGraphic,conflictPreventionEnabled:d,onClearGraphic:this.clearGraphics.bind(this),hideEvent:f,hideNetwork:v,hideDate:p,useRouteStartDate:m,intl:this.props.intl,selectedEventLyr:this.state.selectedEventLyr,selectedEventObjectId:this.state.selectedEventObjectId,selectedEventRouteId:this.state.selectedEventRouteId,selectedEventFromDate:this.state.selectedEventFromDate,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onUpdateNetworkDS:this.onUpdateNetworkDS.bind(this)})):(0,e.jsx)(a.WidgetPlaceholder,{icon:r(),widgetId:o,message:this.getI18nMessage("_widgetLabel")})}}ba.mapExtraStateProps=(e,t)=>{var n,a,o,r;return{selectedEventLyr:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.selectedEventLyr,selectedEventObjectId:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedEventObjectId,selectedEventRouteId:null===(o=null==t?void 0:t.mutableStateProps)||void 0===o?void 0:o.selectedEventRouteId,selectedEventFromDate:null===(r=null==t?void 0:t.mutableStateProps)||void 0===r?void 0:r.selectedEventFromDate}};const ya=ba;function ga(e){c.p=e}})(),u})())}}}));