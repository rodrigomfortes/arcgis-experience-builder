System.register(["jimu-core","widgets/shared-code/lrs"],(function(e,t){var r={},a={};return{setters:[function(e){r.AbstractDataAction=e.AbstractDataAction,r.DataLevel=e.DataLevel,r.DataSourceStatus=e.DataSourceStatus,r.DataSourceTypes=e.DataSourceTypes,r.Immutable=e.Immutable,r.MutableStoreManager=e.MutableStoreManager,r.getAppStore=e.getAppStore},function(e){a.isDefined=e.isDefined}],execute:function(){e((()=>{var e={47626:e=>{"use strict";e.exports=a},79244:e=>{"use strict";e.exports=r}},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var i={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(i),o.d(i,{default:()=>r});var e=o(79244),t=o(47626);class r extends e.AbstractDataAction{isSupported(r,o){var i;if(r.length>1)return Promise.resolve(!1);const n=r[0];if(1!==n.records.length)return Promise.resolve(!1);const{dataSource:s,records:u}=n,d=s.type===e.DataSourceTypes.FeatureLayer||s.type===e.DataSourceTypes.SceneLayer,l=s.isDataSourceSet(),c=o!==e.DataLevel.Records,p=n.dataSource,v=(null==p?void 0:p.supportSpatialInfo)&&(null==p?void 0:p.supportSpatialInfo()),S=o===e.DataLevel.Records&&0===(null==u?void 0:u.length),g=!s.isInAppConfig()&&!d;if(l||c||S||g||!v)return Promise.resolve(!1);if(!s||s.getStatus()===e.DataSourceStatus.NotReady)return Promise.resolve(!1);const f=s;if(!(0,t.isDefined)(f))return Promise.resolve(!1);const m=a();let y,D;return(null===(i=null==m?void 0:m.widgets)||void 0===i?void 0:i[this.widgetId]).config.lrsLayers.forEach((e=>{e.id===f.id&&(D=e,y=e.eventInfo)})),(0,t.isDefined)(D)&&"NETWORK"===D.layerType?Promise.resolve(!1):y?Promise.resolve(!0):Promise.resolve(!1)}onExecute(t,r){var o;const i=t[0],n=i.dataSource,s=a();let u;return(null===(o=null==s?void 0:s.widgets)||void 0===o?void 0:o[this.widgetId]).config.lrsLayers.forEach((e=>{e.id===n.id&&(u=e)})),setTimeout((()=>{e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventLyr",(0,e.Immutable)(u));const t=i.records[0].getData();e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventObjectId",t[i.dataSource.getSchema().idField]),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventRouteId",t[u.eventInfo.routeIdFieldName]),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventFromDate",new Date(t[u.eventInfo.fromDateFieldName]))}),1e3),Promise.resolve(!0)}}function a(){var t,r,a;return window.jimuConfig.isBuilder?null===(r=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===r?void 0:r.appConfig:null===(a=(0,e.getAppStore)().getState())||void 0===a?void 0:a.appConfig}})(),i})())}}}));