System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/layers/GraphicsLayer","widgets/shared-code/lrs","esri/TimeExtent","calcite-components","esri/Graphic"],(function(e,t){var i={},l={},o={},n={},a={},d={},r={},u={};return{setters:[function(e){i.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.Immutable=e.Immutable,i.MessageManager=e.MessageManager,i.React=e.React,i.ReactRedux=e.ReactRedux,i.RecordSetChangeType=e.RecordSetChangeType,i.css=e.css,i.hooks=e.hooks,i.jsx=e.jsx,i.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule},function(e){l.Button=e.Button,l.CollapsablePanel=e.CollapsablePanel,l.DataActionList=e.DataActionList,l.DataActionListStyle=e.DataActionListStyle,l.FloatingPanel=e.FloatingPanel,l.Icon=e.Icon,l.Label=e.Label,l.Pagination=e.Pagination,l.Select=e.Select,l.WidgetPlaceholder=e.WidgetPlaceholder,l.defaultMessages=e.defaultMessages},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default},function(e){a.GetUnits=e.GetUnits,a.QueryRouteMeasures=e.QueryRouteMeasures,a.formatMessage=e.formatMessage,a.getCalciteBasicTheme=e.getCalciteBasicTheme,a.getDateWithTZOffset=e.getDateWithTZOffset,a.getGeometryGraphic=e.getGeometryGraphic,a.getHoverGraphic=e.getHoverGraphic,a.getRouteFromEndMeasures=e.getRouteFromEndMeasures,a.getSimpleLineGraphic=e.getSimpleLineGraphic,a.getSimplePointGraphic=e.getSimplePointGraphic,a.isDefined=e.isDefined},function(e){d.default=e.default},function(e){r.CalciteTable=e.CalciteTable,r.CalciteTableHeader=e.CalciteTableHeader,r.CalciteTableRow=e.CalciteTableRow},function(e){u.default=e.default}],execute:function(){e((()=>{var e={14321:e=>{"use strict";e.exports=l},22089:e=>{"use strict";e.exports=u},46678:e=>{"use strict";e.exports=d},47626:e=>{"use strict";e.exports=a},59620:e=>{"use strict";e.exports=n},62686:e=>{"use strict";e.exports=o},66454:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3.5 4.5H1v1h12.5V10h1V5.5H17v-1H4.5V0h-1zM6 11v-1H5v1zM6 14v-2H5v2H4v1h3v-1z"></path><path fill="#000" fill-rule="evenodd" d="M5 17.978A5.5 5.5 0 1 1 10.793 14H20v6H5zm5-5.478a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0m.4 2.5a5.5 5.5 0 0 1-4.407 2.978H6V19h3.5v-1h1v1h2v-4zm6.1 2h-1v2h-2v-4H19v4h-2.5z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},99037:e=>{"use strict";e.exports=r}},t={};function s(i){var l=t[i];if(void 0!==l)return l.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var v={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(v),s.d(v,{__set_webpack_public_path__:()=>ve,default:()=>se});var e=s(79244);const t={_widgetLabel:"LRS Identify",method:"Method",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",network:"Network",referent:"Referent",routeIdLabel:"Route Id",routeNameLabel:"Route Name",invalidMeasure:"Invalid measure value",invalidRouteField:"Route could not be found with provided value",fromMeasureWithUnits:"From Measure ({units})",toMeasureWithUnits:"To Measure ({units})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",backLabel:"Back",checkResult:"Check results",clearResult:"Clear results",resultsDisplay:"Results:",searchLabel:"Search",results:"Results",searchDisabled:"Provide route",typeStr:"Type:",routeStr:"Route",measureLabel:"Measure:",startMeasure:"Start Measure:",endMeasure:"End Measure:",dateStr:"Date:",networkLabel:"Network:",routeId:"Route ID:",routeName:"Route Name:",identifyResults:"Identify Routes",eventInformation:"Event Information",attr:"Attribute",val:"Value",toStr:"to",layerField:"{layerName}.{fieldName}",identifyWidget:"LRS Identify",routePicker:"Route Picker",nullStr:"null",lineEvent:"Line Events",pointEvent:"Point Events"};var i=s(14321),l=s(66454),o=s.n(l),n=s(62686),a=s(59620),d=s(47626);const r=new Map;function u(t){const{widgetId:i,lrsLayers:l,selectedNetwork:o,dataSourcesReady:n,onCreatePointDs:a,handleSetDataSources:u}=t,[s,v]=e.React.useState(null!=l?l:null),[c,f]=e.React.useState([]);e.React.useEffect((()=>{if(l){v(l);const e=Array(l.length).fill(!1);f(e)}}),[l]);const h=e.React.useCallback(((e,t)=>{const i=c;i[e]=t,f(i),i.every((e=>e))&&n(!0)}),[n,c]),p=e.React.useCallback(((e,t)=>{r[i]||(r[i]=[]),r[i].push(e),(null==l?void 0:l.length)===r[i].length&&u(r[i]),h(t,!0)}),[i,null==l?void 0:l.length,h,u]),m=e.React.useCallback(((t,i)=>{if(t){const{status:l,instanceStatus:o}=t;o===e.DataSourceStatus.NotCreated||o===e.DataSourceStatus.CreateError||l===e.DataSourceStatus.LoadError||l===e.DataSourceStatus.NotReady?h(i,!1):h(i,!0)}}),[h]),y=e.React.useCallback((e=>{h(e,!1)}),[h]),g=e=>{a(e)},w=e.React.useMemo((()=>(0,e.Immutable)({dataSourceId:null==o?void 0:o.outputPointDsId,mainDataSourceId:null==o?void 0:o.outputPointDsId})),[null==o?void 0:o.outputPointDsId]);return(0,e.jsx)("div",null,(0,d.isDefined)(s)&&s.map(((t,i)=>{var l;const o=null===(l=null==t?void 0:t.layerType)||void 0===l?void 0:l.toLocaleLowerCase();return(0,e.jsx)("div",null,"network"===o&&(0,d.isDefined)(w)&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:w,onDataSourceCreated:g}),(0,e.jsx)(e.DataSourceComponent,{key:i,useDataSource:t.useDataSource,onDataSourceInfoChange:e=>{m(e,i)},onCreateDataSourceFailed:e=>{y(i)},onDataSourceCreated:e=>{p(e,i)}}))})))}var c,f;!function(e){e.network="NETWORK",e.event="EVENT",e.intersection="INTERSECTION",e.nonLrs="NONLRS"}(c||(c={})),function(e){e.measure="ROUTEANDMEASURE",e.coordinate="COORDINATE",e.locationOffset="LOCATIONOFFSET"}(f||(f={}));var h=s(46678);const p="object"==typeof global&&global&&global.Object===Object&&global;var m="object"==typeof self&&self&&self.Object===Object&&self;const y=p||m||Function("return this")();var g=/\s/;const w=function(e){for(var t=e.length;t--&&g.test(e.charAt(t)););return t};var S=/^\s+/;const b=function(e){return e?e.slice(0,w(e)+1).replace(S,""):e};const D=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const I=y.Symbol;var x=Object.prototype,R=x.hasOwnProperty,j=x.toString,k=I?I.toStringTag:void 0;const M=function(e){var t=R.call(e,k),i=e[k];try{e[k]=void 0;var l=!0}catch(e){}var o=j.call(e);return l&&(t?e[k]=i:delete e[k]),o};var G=Object.prototype.toString;const C=function(e){return G.call(e)};var L=I?I.toStringTag:void 0;const N=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":L&&L in Object(e)?M(e):C(e)};const P=function(e){return null!=e&&"object"==typeof e};const F=function(e){return"symbol"==typeof e||P(e)&&"[object Symbol]"==N(e)};var T=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,A=/^0o[0-7]+$/i,O=parseInt;const V=function(e){if("number"==typeof e)return e;if(F(e))return NaN;if(D(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=D(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=b(e);var i=E.test(e);return i||A.test(e)?O(e.slice(2),i?2:8):T.test(e)?NaN:+e};var U=1/0;const W=function(e){return e?(e=V(e))===U||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const H=function(e){var t=W(e),i=t%1;return t==t?i?t-i:t:0};const z=function(e,t){for(var i=-1,l=null==e?0:e.length,o=Array(l);++i<l;)o[i]=t(e[i],i,e);return o};const B=Array.isArray;var _=I?I.prototype:void 0,Z=_?_.toString:void 0;const J=function e(t){if("string"==typeof t)return t;if(B(t))return z(t,e)+"";if(F(t))return Z?Z.call(t):"";var i=t+"";return"0"==i&&1/t==-1/0?"-0":i};const Q=function(e){return null==e?"":J(e)};var K=y.isFinite,$=Math.min;const q=function(e){var t=Math[e];return function(e,i){if(e=V(e),(i=null==i?0:$(H(i),292))&&K(e)){var l=(Q(e)+"e").split("e"),o=t(l[0]+"e"+(+l[1]+i));return+((l=(Q(o)+"e").split("e"))[0]+"e"+(+l[1]-i))}return t(e)}}("round");var Y=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{r(l.next(e))}catch(e){n(e)}}function d(e){try{r(l.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}r((l=l.apply(e,t||[])).next())}))};const X=e.css`
    .route-picker-btn {
      background-color: var(--sys-color-primary-main);
      color: var(--ref-palette-neutral-200);
      width: 32px;
      height: 32px;
      border-radius: 0px;

      &:hover {
        color: var(--ref-palette-neutral-200);
      }
    }
    .route-picker-btn-disabled {
      color: var(--ref-palette-neutral-1200);
      background-color: var(--ref-palette-neutral-200);
      width: 32px;
      height: 32px;
      border-radius: 0px;

      &:hover {
        color: var(--sys-color-primary-main);
      }
    }
  `;function ee(t){const{intl:l,isReady:n,active:a,jimuMapView:r,hoverGraphic:u,allDataSources:s,lrsLayers:v,config:f,onActiveChange:p,clearFlashGraphic:m,clearPickedGraphic:y,handleShowPp:g}=t;let{eventDataRecords:w}=t;const S=e.React.useRef(null),b=e.React.useRef(null),D=e.React.useRef(!1),I=e.React.useRef(!1),[x,R]=e.React.useState(!1),j=e.React.useRef(null);e.React.useEffect((()=>{a?k():M()}),[a]);const k=()=>{n&&(S.current=null==r?void 0:r.view.on("pointer-move",N),b.current=null==r?void 0:r.view.on("pointer-down",P))},M=()=>{(0,d.isDefined)(S.current)&&(S.current.remove(),S.current=null),(0,d.isDefined)(b.current)&&(b.current.remove(),b.current=null),I.current&&(I.current=!1),D.current&&(D.current=!1)},G=()=>{(0,d.isDefined)(u)&&u.removeAll()},C=e=>{G(),(0,d.isDefined)(e)&&u.add(e)},L=()=>Y(this,void 0,void 0,(function*(){return null===j.current&&(j.current=yield(0,e.loadArcGISJSAPIModule)("esri/geometry/operators/proximityOperator")),j.current})),N=e=>Y(this,void 0,void 0,(function*(){D.current||(yield Promise.all(s.map((t=>Y(this,void 0,void 0,(function*(){const i=yield L(),l=t,o=null==l?void 0:l.layer,n=v.find((e=>e.serviceId===o.layerId));if((0,d.isDefined)(n)&&n.layerType.toLocaleLowerCase()===c.network.toLocaleLowerCase()&&(0,d.isDefined)(o)){D.current=!0;const t=o.spatialReference,n=o.createQuery(),a=null==r?void 0:r.view.toMap(e),u="degrees"===t.unit?4:Math.max(3*t.metersPerUnit,3);n.geometry=a,n.units="meters",n.returnM=!0,n.distance=(null==r?void 0:r.view.resolution)*u,n.spatialRelationship="intersects",n.returnGeometry=!0;const s=l.getCurrentQueryParams();(null==s?void 0:s.time)&&(n.timeExtent=new h.default({start:s.time[0],end:s.time[1]})),n.gdbVersion=s.gdbVersion,n.outFields=["*"],o.queryFeatures(n).then((e=>Y(this,void 0,void 0,(function*(){if(e&&e.features.length>0&&D.current){const t=e.features[0].geometry,l=i.getNearestCoordinate(t,a),o=i.getNearestVertex(t,a);o.distance<3*n.distance&&(l.coordinate=o.coordinate),C(yield(0,d.getHoverGraphic)(yield(0,d.getSimplePointGraphic)(l.coordinate))),D.current=!1}else C(null),D.current=!1}))))}}))))))})),P=e=>Y(this,void 0,void 0,(function*(){if(e.stopPropagation(),I.current)return;const i=[],o=[];let n;w=[],yield Promise.all(s.map((t=>Y(this,void 0,void 0,(function*(){const a=yield L(),u=t,s=null==u?void 0:u.layer,p=(e=>{const t={routeIdFieldName:null,routeNameFieldName:null,layer:null};for(let i=0;i<v.length;i++){const l=v[i];if((null==l?void 0:l.serviceId)===(null==e?void 0:e.layerId)){const e=null==l?void 0:l.layerType;if(e.toLocaleLowerCase()===c.event.toLocaleLowerCase()){const e=null==l?void 0:l.eventInfo;t.routeIdFieldName=e.routeIdFieldName,t.routeNameFieldName=null==e?void 0:e.routeNameFieldName,t.layer=l}else if(e.toLocaleLowerCase()===c.network.toLocaleLowerCase()){const e=null==l?void 0:l.networkInfo,i=null==e?void 0:e.routeIdFieldSchema;t.routeIdFieldName=null==i?void 0:i.jimuName,t.layer=l}break}}return t})(s);if((0,d.isDefined)(s)){const v=s.popupEnabled;s.popupEnabled=!1,I.current=!0;const m=s.spatialReference,y=s.createQuery(),g=null==r?void 0:r.view.toMap(e),S="degrees"===m.unit?4:Math.max(3*m.metersPerUnit,3);y.geometry=g,y.units="meters",y.distance=(null==r?void 0:r.view.resolution)*S,y.spatialRelationship="intersects",y.returnGeometry=!0,y.returnM=!0,y.returnZ=!0,y.outFields=["*"];const b=u.getCurrentQueryParams();(null==b?void 0:b.time)&&(y.timeExtent=new h.default({start:b.time[0],end:b.time[1]})),y.gdbVersion=b.gdbVersion;const D=[];yield s.queryFeatures(y).then((e=>Y(this,void 0,void 0,(function*(){var r;yield Promise.all(null===(r=null==e?void 0:e.features)||void 0===r?void 0:r.map((e=>Y(this,void 0,void 0,(function*(){var r,v,h,m,S,b,I,x,R,j,k,M,G,C,L,N,P,F;const T=(0,d.getRouteFromEndMeasures)(e.geometry),E=e.geometry,A=a.getNearestCoordinate(E,g),O=a.getNearestVertex(E,g);O.distance<3*y.distance&&(A.coordinate=O.coordinate),n||(n=A.coordinate,n.hasZ=!0);const V=null==e?void 0:e.attributes;if((null===(v=null===(r=null==p?void 0:p.layer)||void 0===r?void 0:r.layerType)||void 0===v?void 0:v.toLocaleLowerCase())===c.network.toLocaleLowerCase()){const a=null===(h=null==p?void 0:p.layer)||void 0===h?void 0:h.networkInfo;yield((e,t,i)=>{if(e)return new Promise(((l,o)=>{var n,a,d,r,u,s;const v=e.getCurrentQueryParams();if(!(null===(a=null===(n=null==i?void 0:i.layer)||void 0===n?void 0:n.networkInfo)||void 0===a?void 0:a.supportsLines))return l([]),[];{const o=null===(r=null===(d=null==i?void 0:i.layer)||void 0===d?void 0:d.networkInfo)||void 0===r?void 0:r.lineIdFieldName,n=null===(s=null===(u=null==i?void 0:i.layer)||void 0===u?void 0:u.networkInfo)||void 0===s?void 0:s.lineOrderFieldName,a={where:`${o} LIKE '%${t[o]}'`,outFields:["*"],orderByFields:[n]};(null==v?void 0:v.time)&&(a.time=[v.time[0],v.time[1]]),a.gdbVersion=v.gdbVersion,e.query(a).then((e=>(l(e),e)))}}))})(u,V,p).then((r=>Y(this,void 0,void 0,(function*(){var v,c,f,h,m,y;yield(0,d.QueryRouteMeasures)(u,a,T,V[null===(f=null===(c=null===(v=null==p?void 0:p.layer)||void 0===v?void 0:v.networkInfo)||void 0===c?void 0:c.fromDateFieldSchema)||void 0===f?void 0:f.name],V[null===(y=null===(m=null===(h=null==p?void 0:p.layer)||void 0===h?void 0:h.networkInfo)||void 0===m?void 0:m.routeIdFieldSchema)||void 0===y?void 0:y.name]).then((v=>Y(this,void 0,void 0,(function*(){var c,f,h,m,y,g;const w=Math.min(...v),S=Math.max(...v);yield(0,d.QueryRouteMeasures)(u,a,[A.coordinate],V[null===(h=null===(f=null===(c=null==p?void 0:p.layer)||void 0===c?void 0:c.networkInfo)||void 0===f?void 0:f.fromDateFieldSchema)||void 0===h?void 0:h.name],V[null===(g=null===(y=null===(m=null==p?void 0:p.layer)||void 0===m?void 0:m.networkInfo)||void 0===y?void 0:y.routeIdFieldSchema)||void 0===g?void 0:g.name]).then((a=>{var v,c,f,h,m,y,g,b,I,x,R,j,k,M,G,C,L,N,P,F,T,E,A,O,U,W,H,z,B,_,Z,J,Q,K,$,Y,X,ee,te,ie,le,oe,ne,ae,de,re,ue,se,ve;const ce=[];a.forEach((e=>{var t,i;ce.push(q(e,null===(i=null===(t=null==p?void 0:p.layer)||void 0===t?void 0:t.networkInfo)||void 0===i?void 0:i.measurePrecision))}));const fe={objectIdFieldName:null===(c=null===(v=null==p?void 0:p.layer)||void 0===v?void 0:v.networkInfo)||void 0===c?void 0:c.objectIdFieldName,ds:t,records:r,featureDS:u,supportsLines:null===(h=null===(f=null==p?void 0:p.layer)||void 0===f?void 0:f.networkInfo)||void 0===h?void 0:h.supportsLines,routeId:V[null===(g=null===(y=null===(m=null==p?void 0:p.layer)||void 0===m?void 0:m.networkInfo)||void 0===y?void 0:y.routeIdFieldSchema)||void 0===g?void 0:g.name],routeIdFieldName:null===(x=null===(I=null===(b=null==p?void 0:p.layer)||void 0===b?void 0:b.networkInfo)||void 0===I?void 0:I.routeIdFieldSchema)||void 0===x?void 0:x.name,routeName:V[null===(k=null===(j=null===(R=null==p?void 0:p.layer)||void 0===R?void 0:R.networkInfo)||void 0===j?void 0:j.routeNameFieldSchema)||void 0===k?void 0:k.name],routeNameFieldName:null===(C=null===(G=null===(M=null==p?void 0:p.layer)||void 0===M?void 0:M.networkInfo)||void 0===G?void 0:G.routeNameFieldSchema)||void 0===C?void 0:C.name,lineOrderFieldName:null===(N=null===(L=null==p?void 0:p.layer)||void 0===L?void 0:L.networkInfo)||void 0===N?void 0:N.lineOrderFieldName,fromDate:V[null===(T=null===(F=null===(P=null==p?void 0:p.layer)||void 0===P?void 0:P.networkInfo)||void 0===F?void 0:F.fromDateFieldSchema)||void 0===T?void 0:T.name],toDate:V[null===(O=null===(A=null===(E=null==p?void 0:p.layer)||void 0===E?void 0:E.networkInfo)||void 0===A?void 0:A.toDateFieldSchema)||void 0===O?void 0:O.name],selectedPoint:n,selectedPolyline:e.geometry,validRoute:!0,measureUnit:(0,d.GetUnits)(null===(W=null===(U=null==p?void 0:p.layer)||void 0===U?void 0:U.networkInfo)||void 0===W?void 0:W.unitsOfMeasure,l),timeDependedInfo:[{objectId:V[null===(z=null===(H=null==p?void 0:p.layer)||void 0===H?void 0:H.networkInfo)||void 0===z?void 0:z.objectIdFieldName],fromDate:V[null===(Z=null===(_=null===(B=null==p?void 0:p.layer)||void 0===B?void 0:B.networkInfo)||void 0===_?void 0:_.fromDateFieldSchema)||void 0===Z?void 0:Z.name],toDate:V[null===(K=null===(Q=null===(J=null==p?void 0:p.layer)||void 0===J?void 0:J.networkInfo)||void 0===Q?void 0:Q.toDateFieldSchema)||void 0===K?void 0:K.name],fromMeasure:q(w,null===(Y=null===($=null==p?void 0:p.layer)||void 0===$?void 0:$.networkInfo)||void 0===Y?void 0:Y.measurePrecision),toMeasure:q(S,null===(ee=null===(X=null==p?void 0:p.layer)||void 0===X?void 0:X.networkInfo)||void 0===ee?void 0:ee.measurePrecision),selectedMeasures:ce,attributes:V}],fieldInfos:null==s?void 0:s.fields};if(null==i?void 0:i.includes(null===(te=null==p?void 0:p.layer)||void 0===te?void 0:te.serviceId)){const e=o.find((e=>{var t;return e.id===(null===(t=null==p?void 0:p.layer)||void 0===t?void 0:t.serviceId)})),t=null==e?void 0:e.routes;let i=!1;t.forEach((e=>{var t,o,n,a,r,u,s,v,c,f,h,m,y,g;if((null==e?void 0:e.routeId)===V[null==p?void 0:p.routeIdFieldName]){i=!0;const b=e;b.timeDependedInfo.push({objectId:V[null===(o=null===(t=null==p?void 0:p.layer)||void 0===t?void 0:t.networkInfo)||void 0===o?void 0:o.objectIdFieldName],measureUnit:(0,d.GetUnits)(null===(a=null===(n=null==p?void 0:p.layer)||void 0===n?void 0:n.networkInfo)||void 0===a?void 0:a.unitsOfMeasure,l),fromMeasure:q(w,null===(u=null===(r=null==p?void 0:p.layer)||void 0===r?void 0:r.networkInfo)||void 0===u?void 0:u.measurePrecision),toMeasure:q(S,null===(v=null===(s=null==p?void 0:p.layer)||void 0===s?void 0:s.networkInfo)||void 0===v?void 0:v.measurePrecision),selectedMeasures:ce,fromDate:V[null===(h=null===(f=null===(c=null==p?void 0:p.layer)||void 0===c?void 0:c.networkInfo)||void 0===f?void 0:f.fromDateFieldSchema)||void 0===h?void 0:h.name],toDate:V[null===(g=null===(y=null===(m=null==p?void 0:p.layer)||void 0===m?void 0:m.networkInfo)||void 0===y?void 0:y.toDateFieldSchema)||void 0===g?void 0:g.name],attributes:V}),b.timeDependedInfo.sort(((e,t)=>e.fromDate-t.fromDate))}})),i||null===(ie=null==e?void 0:e.routes)||void 0===ie||ie.push(fe)}else{const e={id:null===(le=null==p?void 0:p.layer)||void 0===le?void 0:le.serviceId,networkId:null===(ne=null===(oe=null==p?void 0:p.layer)||void 0===oe?void 0:oe.networkInfo)||void 0===ne?void 0:ne.lrsNetworkId,layerName:null===(ae=null==p?void 0:p.layer)||void 0===ae?void 0:ae.name,configFields:null===(re=null===(de=null==p?void 0:p.layer)||void 0===de?void 0:de.networkInfo)||void 0===re?void 0:re.attributeFields,useFieldAlias:null===(se=null===(ue=null==p?void 0:p.layer)||void 0===ue?void 0:ue.networkInfo)||void 0===se?void 0:se.useFieldAlias,routes:[fe]};o.push(e),i.push(null===(ve=null==p?void 0:p.layer)||void 0===ve?void 0:ve.serviceId)}D.push(fe)}))}))))}))))}else(null===(S=null===(m=null==p?void 0:p.layer)||void 0===m?void 0:m.layerType)||void 0===S?void 0:S.toLocaleLowerCase())===c.event.toLocaleLowerCase()&&w.push({parentNetworkId:null===(I=null===(b=null==p?void 0:p.layer)||void 0===b?void 0:b.eventInfo)||void 0===I?void 0:I.parentNetworkId,attributes:V,attributeSets:null==f?void 0:f.attributeSets,defaultLineAttributeSet:null==f?void 0:f.defaultLineAttrbuteSet,defaultPointAttributeSet:null==f?void 0:f.defaultPointAttributeSet,eventLayerId:null===(x=null==p?void 0:p.layer)||void 0===x?void 0:x.serviceId,fromDate:null===(j=null===(R=null==p?void 0:p.layer)||void 0===R?void 0:R.eventInfo)||void 0===j?void 0:j.fromDateFieldName,toDate:null===(M=null===(k=null==p?void 0:p.layer)||void 0===k?void 0:k.eventInfo)||void 0===M?void 0:M.toDateFieldName,fieldInfos:null==s?void 0:s.fields,routeIdFieldName:null===(C=null===(G=null==p?void 0:p.layer)||void 0===G?void 0:G.eventInfo)||void 0===C?void 0:C.routeIdFieldName,toRouteIdFieldName:null===(N=null===(L=null==p?void 0:p.layer)||void 0===L?void 0:L.eventInfo)||void 0===N?void 0:N.toRouteIdFieldName,canSpanRoutes:null===(F=null===(P=null==p?void 0:p.layer)||void 0===P?void 0:P.eventInfo)||void 0===F?void 0:F.canSpanRoutes})})))))})))).finally((()=>{v&&(s.popupEnabled=!1),I.current=!1})).catch((e=>{console.error(e)}))}}))))).then((()=>{t.setSelectedPoint(n),t.setRouteDetails(o),t.setEventDetails(w)}))}));return(0,e.jsx)("div",{css:X},(0,e.jsx)(i.Button,{className:a?"route-picker-btn":"route-picker-btn-disabled",size:"sm",tabIndex:-1,type:"tertiary",icon:!0,disabled:!n,onClick:()=>{p(),y(),m(),G(),g(!x),R(!x),x||(t.setRouteDetails([]),t.setEventDetails([]))}},(0,e.jsx)(i.Icon,{size:"m",icon:o(),className:"border-0"})))}const te="#008000";var ie=s(99037),le=s(22089);const oe=[{value:"Measure",label:"Measure"},{value:"ToMeasure",label:"To Measure"}];function ne(l){var o;const{intl:n,widgetId:a,config:r,outputDS:u,networkLayers:s,selectedLocationInfo:v,eventDetails:c,jimuMapView:f,allDataSources:h,measuresOids:p,isNetworkChange:m,selectedPoint:y,onRouteInfoUpdated:g,clearPickedGraphic:w,handleSelectedNetworkChange:S}=l,b=e.React.useRef(null),[D,I]=e.React.useState(!0),[x,R]=e.React.useState({x:0,y:0}),[j,k]=e.React.useState({width:400,height:500}),[M,G]=e.React.useState(null),[C,L]=e.React.useState(),[N,P]=e.React.useState(),[F,T]=e.React.useState(0),[E,A]=e.React.useState(null),[O,V]=e.React.useState(null),[U,W]=e.React.useState(null),H=C&&(null==C?void 0:C[F]),z=null==r?void 0:r.lineEventToggle,B=null==r?void 0:r.pointEventToggle,_=e.hooks.useTranslation(t);e.React.useEffect((()=>{var e,t,i,o;const n=v,a=null==f?void 0:f.view.toScreen(n.routes[0].selectedPoint);if(v&&(I(!0),b.current=n,a&&!m)){const e=x;e.x=a.x+16,e.y=a.y+16;const t=Y(a.x,a.y,null==f?void 0:f.view);t&&(e.x=t.x+16,e.y=t.y+16),R(e)}(()=>{var e,t,i,o,n,d,r,c,f,h;const m=null===(t=null===(e=null==v?void 0:v.routes)||void 0===e?void 0:e[0])||void 0===t?void 0:t.objectIdFieldName;try{const e=l.dataRecords,t=[];e.forEach(((e,i)=>{var l;const o=null===(l=s[i])||void 0===l?void 0:l.id;t[o]=e})),W(t);const y=[].concat.apply([],t[null==v?void 0:v.id]),g=[];u&&(null==y||y.forEach((e=>{var t,i;const l=p[null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[m]],o=Z(a,null===(i=null==e?void 0:e.feature)||void 0===i?void 0:i.attributes,l),n=null==u?void 0:u.buildRecord(o);g.push(n)})));const w=null===(n=null===(o=null===(i=null==v?void 0:v.routes)||void 0===i?void 0:i[0])||void 0===o?void 0:o.timeDependedInfo)||void 0===n?void 0:n[0].objectId,S=null===(f=null===(c=null===(r=null===(d=null==v?void 0:v.routes)||void 0===d?void 0:d[0])||void 0===r?void 0:r.timeDependedInfo)||void 0===c?void 0:c[0])||void 0===f?void 0:f.selectedMeasures[0];A([].concat.apply([],e));const b=Q(y,w,m),D=Z(a,null===(h=null==b?void 0:b.feature)||void 0===h?void 0:h.attributes,S),I=null==u?void 0:u.buildRecord(D);V(I),J(g,I,w)}catch(e){console.error("Error fetching data:",e)}})(),T(0),G(n),S(n,!1),L(null==n?void 0:n.routes),P(null===(i=null===(t=null===(e=null==n?void 0:n.routes)||void 0===e?void 0:e[0])||void 0===t?void 0:t.timeDependedInfo)||void 0===i?void 0:i[0]),g(null===(o=null==n?void 0:n.routes)||void 0===o?void 0:o[0],!0)}),[null==f?void 0:f.view,v,s,u]);const Z=(e,t,i)=>{i&&(t[oe.at(0).value]=i);return new le.default({geometry:y,attributes:t})},J=(t,i,l)=>{null==u||u.clearRecords(),null==u||u.clearSelection(),null==u||u.setCountStatus(e.DataSourceStatus.NotReady),null==u||u.setStatus(e.DataSourceStatus.NotReady),null==u||u.setStatus(e.DataSourceStatus.Unloaded),null==u||u.setCountStatus(e.DataSourceStatus.Unloaded),null==u||u.setSourceRecords(t),null==u||u.setRecords(t),null==u||u.selectRecordById(l),q(u,a)},Q=(e,t,i)=>{for(let l=0;l<(null==e?void 0:e.length);l++){if(e[l].getData()[i]===t)return e[l]}},K=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets[a].enableDataAction)||void 0===t||t})),$=e.React.useMemo((()=>({dataSource:u,type:"selected",records:[O],name:null==M?void 0:M.layerName})),[u,O,M]),q=(t,i)=>{if(!t)return;const l=t.getOriginDataSources()[0],o=l.getPopupInfo(),n=l.getLayerDefinition(),a=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==n?void 0:n.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==o?void 0:o.fieldInfos)||[]).filter((e=>e.visible))),d=new e.DataRecordSetChangeMessage(i,e.RecordSetChangeType.CreateUpdate,[{records:t.getRecords(),fields:a.map((e=>e.fieldName)),dataSource:t,name:t.id}]);e.MessageManager.getInstance().publishMessage(d)},Y=(e,t,i)=>{if(!i)return;const l=j.width,o=j.height;return e>=0&&t>=0&&e+l<=window.innerWidth&&t+o<=window.innerHeight?null:(e+l>window.innerWidth&&(e=window.innerWidth-l),t+o>window.innerHeight&&(t=window.innerHeight-o),e<0&&(e=0),t<0&&(t=0),{x:e,y:t})},X=e.React.useCallback((e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,l=null==s?void 0:s.find((e=>e.id===i)),o=U[i];null==s||s.forEach(((e,t)=>{var n,a,d,r,s,c,h,m,y,w,b,D,I,x,R,j;if((null==e?void 0:e.id)===i){const t=null===(r=null===(d=null===(a=null===(n=null==e?void 0:e.routes)||void 0===n?void 0:n[0])||void 0===a?void 0:a.timeDependedInfo)||void 0===d?void 0:d[0])||void 0===r?void 0:r.objectId,k=null===(y=null===(m=null===(h=null===(c=null===(s=null==e?void 0:e.routes)||void 0===s?void 0:s[0])||void 0===c?void 0:c.timeDependedInfo)||void 0===h?void 0:h[0])||void 0===m?void 0:m.selectedMeasure)||void 0===y?void 0:y[0],M=null===(b=null===(w=null==e?void 0:e.routes)||void 0===w?void 0:w[0])||void 0===b?void 0:b.objectIdFieldName,C=Q(E,t,M),N=Z(null==f?void 0:f.view.toScreen(null==e?void 0:e.routes[0].selectedPoint),null===(D=null==C?void 0:C.feature)||void 0===D?void 0:D.attributes,k),F=null==u?void 0:u.buildRecord(N);G(l),S(l,!0),L(null==e?void 0:e.routes),P(null===(R=null===(x=null===(I=null==e?void 0:e.routes)||void 0===I?void 0:I[0])||void 0===x?void 0:x.timeDependedInfo)||void 0===R?void 0:R[0]),T(0),g(null===(j=null==e?void 0:e.routes)||void 0===j?void 0:j[0],!0),V(F);const A=[].concat.apply([],o),O=[],U=null==f?void 0:f.view.toScreen(v.routes[0].selectedPoint);u&&(null==A||A.forEach((e=>{var t,i;const l=p[null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[M]],o=Z(U,null===(i=null==e?void 0:e.feature)||void 0===i?void 0:i.attributes,l),n=null==u?void 0:u.buildRecord(o);O.push(n)}))),J(O,F,i)}}))}),[E,S,U,g,u,v,a]),ee=e.React.useCallback((e=>{R(e)}),[]),te=e.React.useCallback(((e,t)=>{k(e),R(t)}),[]),ne=(e,t,i)=>{const l=null==i?void 0:i.find((t=>t.name===e));if((0,d.isDefined)(l)&&(0,d.isDefined)(l.domain)&&"coded-value"===l.domain.type){const e=l.domain.codedValues.find((e=>"string"==typeof e.code&&"string"==typeof t?e.code.toLowerCase()===t.toLowerCase():e.code===t));if(e)return`${e.code} - ${e.name}`}},ae=e=>{if(!M)return;const t=864e13,i=-864e13,l=[],o=null==M?void 0:M.networkId,n=null!==(null==N?void 0:N.fromDate)?null==N?void 0:N.fromDate:i,a=null!==(null==N?void 0:N.toDate)?null==N?void 0:N.toDate:t;return c.sort(((e,t)=>{const i=null==e?void 0:e.attributes,l=null==t?void 0:t.attributes;return i[e.fromDate]-l[t.fromDate]})),null==c||c.forEach((r=>{var u,s,v,c,f,p,m,y,g,w;const S=null==r?void 0:r.fieldInfos,b=null==r?void 0:r.attributes,D=null==r?void 0:r.fromDate,I=null==r?void 0:r.toDate,x=b[null==r?void 0:r.routeIdFieldName],R=b[D],j=(0,d.isDefined)(R)?(0,d.getDateWithTZOffset)(R,M.routes[F].ds).toLocaleDateString():_("nullStr"),k=b[I],G=(0,d.isDefined)(k)?(0,d.getDateWithTZOffset)(k,M.routes[F].ds).toLocaleDateString():_("nullStr");let L=null==r?void 0:r.defaultLineAttributeSet;"point"===e&&(L=null==r?void 0:r.defaultPointAttributeSet);let P=!1;if((null==r?void 0:r.parentNetworkId)===o)if("line"===e&&M&&(null===(u=C[F])||void 0===u?void 0:u.supportsLines)&&(null==r?void 0:r.canSpanRoutes)){const e=null===(v=null===(s=null==M?void 0:M.routes)||void 0===s?void 0:s[F])||void 0===v?void 0:v.routeIdFieldName,t=r.routeIdFieldName,i=r.toRouteIdFieldName,l=null===(f=null===(c=null==M?void 0:M.routes)||void 0===c?void 0:c[F])||void 0===f?void 0:f.lineOrderFieldName,o=null===(y=null===(m=null===(p=null==M?void 0:M.routes)||void 0===p?void 0:p[F])||void 0===m?void 0:m.records)||void 0===y?void 0:y.records;if(o){const n=null==N?void 0:N.attributes[l],a=o.find((i=>i.feature.attributes[e]===r.attributes[t])),d=o.find((t=>t.feature.attributes[e]===r.attributes[i]));d&&d.feature.attributes[l]>=n&&n>=a.feature.attributes[l]&&(P=!0)}}else(null==r?void 0:r.parentNetworkId)===o&&(null===(g=C[F])||void 0===g?void 0:g.routeId)===x&&(P=!0);if(P){const e=null===(w=r.attributeSets)||void 0===w?void 0:w.attributeSet.find((e=>e.title===L)),o=null==e?void 0:e.layers;null==o||o.forEach((e=>{const o=[],u=(e=>{const t=h.find((t=>{var i,l;return(null===(l=null===(i=null==t?void 0:t.getLayerDefinition)||void 0===i?void 0:i.call(t))||void 0===l?void 0:l.id)===(null==e?void 0:e.layerId)}));return t})(e);if(u){const s=(null==u?void 0:u.layer).fields,v=null!==b[D]?b[D]:i,c=null!==b[I]?b[I]:t;if((null==e?void 0:e.layerId)===r.eventLayerId&&(n<=v<=a||n<=c<=a)){(null==e?void 0:e.fields).forEach((t=>{const i=s.find((e=>e.name===t.name)),l=null==t?void 0:t.name,n=null==i?void 0:i.type,a=ne(l,b[l],S);let r;a?r=a:(r=b[l],"date"===(null==n?void 0:n.toLowerCase())&&(r=(0,d.isDefined)(r)?(0,d.getDateWithTZOffset)(r,M.routes[F].ds).toLocaleDateString():null)),"date"===(null==n?void 0:n.toLowerCase())&&(r=(0,d.isDefined)(r)?(0,d.getDateWithTZOffset)(r,M.routes[F].ds).toLocaleDateString():null),o.push({name:l,val:r,layerName:null==e?void 0:e.layerName,fromDate:j,toDate:G})})),l.push(re(o)),l.push(de())}}else;}))}})),l},de=()=>(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}}),re=t=>{var l,o,a;const r=null===(l=null==t?void 0:t[0])||void 0===l?void 0:l.fromDate,u=null===(o=null==t?void 0:t[0])||void 0===o?void 0:o.toDate,s=(null===(a=null==t?void 0:t[0])||void 0===a?void 0:a.layerName)+" ("+r+" - "+u+")";return(0,e.jsx)(i.CollapsablePanel,{label:s,level:0,type:"default"},(0,e.jsx)(ie.CalciteTable,{className:"w-100 h-100",caption:_("routePicker"),bordered:!0,scale:"s",layout:"fixed"},(0,e.jsx)(ie.CalciteTableRow,null,(0,e.jsx)(ie.CalciteTableHeader,{heading:(0,d.formatMessage)(n,"attribute")}),(0,e.jsx)(ie.CalciteTableHeader,{heading:(0,d.formatMessage)(n,"value")})),null==t?void 0:t.map(((t,i)=>(0,e.jsx)(ie.CalciteTableRow,null,(0,e.jsx)("calcite-table-cell",{itemKey:i},t.name),(0,e.jsx)("calcite-table-cell",{itemKey:i},t.val))))))},ue=()=>{var t;return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,_("dateStr"))),(0,e.jsx)("div",null,(0,e.jsx)(i.Select,{size:"sm",value:N,onChange:e=>{(e=>{var t,i,l,o,n;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;P(a);const d=null==a?void 0:a.objectId,r=null===(l=null===(i=null==v?void 0:v.routes)||void 0===i?void 0:i[F])||void 0===l?void 0:l.objectIdFieldName,s=Q(E,d,r),c=null===(o=null==a?void 0:a.selectedMeasures)||void 0===o?void 0:o[0],h=Z(null==f?void 0:f.view.toScreen(null==v?void 0:v.routes[F].selectedPoint),null===(n=null==s?void 0:s.feature)||void 0===n?void 0:n.attributes,c),p=null==u?void 0:u.buildRecord(h);V(p)})(e)}},null===(t=null==H?void 0:H.timeDependedInfo)||void 0===t?void 0:t.map(((t,i)=>(0,e.jsx)(Option,{key:i,title:t.fromDate,value:t,label:t.fromDate},(0,e.jsx)("span",null,(0,d.isDefined)(t.fromDate)?(0,d.getDateWithTZOffset)(t.fromDate,M.routes[F].ds).toLocaleDateString():_("nullStr")),(0,e.jsx)("span",{style:{paddingLeft:"0.3rem",paddingRight:"0.3rem"}},_("toStr")),(0,e.jsx)("span",null,(0,d.isDefined)(t.toDate)?(0,d.getDateWithTZOffset)(t.toDate,M.routes[F].ds).toLocaleDateString():_("nullStr"))))))))},se=e=>ae(e);return(0,e.jsx)("div",{style:{position:"relative"}},D&&v&&(0,e.jsx)(i.FloatingPanel,{headerTitle:_("identifyResults"),size:j,defaultPosition:x,position:x,disableActivateOverlay:!1,dragBounds:"body",onDrag:ee,onResize:te,onHeaderClose:()=>{w(),I(!1)}},(0,e.jsx)("div",{css:(0,d.getCalciteBasicTheme)()},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",padding:"10px",overflowY:"scroll",height:"inherit"}},K&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{className:"ml-auto"},(0,e.jsx)(i.DataActionList,{widgetId:a,dataSets:[$],listStyle:i.DataActionListStyle.Dropdown,buttonSize:"sm",buttonType:"tertiary"}))),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,_("networkLabel"))),(0,e.jsx)("div",{style:{width:"50%"}},M&&(0,e.jsx)(i.Select,{size:"sm",value:M.id,onChange:X},s.map(((t,i)=>(0,e.jsx)(Option,{key:i,title:t.layerName,value:t.id,label:t.layerName},t.layerName)))))),H&&(t=>{var l,o;const a=((e,t,i)=>{if(!M)return;const l=[null==i?void 0:i.routeIdFieldName,null==i?void 0:i.routeNameFieldName],o=M?M.configFields:null,n=M?M.useFieldAlias:null,a=[];return(null==o?void 0:o.length)>0&&e&&o.forEach((i=>{var o,r,u,s,v;const c=null==i?void 0:i.enabled;let f=null===(o=null==i?void 0:i.field)||void 0===o?void 0:o.name;if(c&&!l.includes(f)){const l=ne(f,e[null===(r=null==i?void 0:i.field)||void 0===r?void 0:r.name],t);n&&(f=null===(u=null==i?void 0:i.field)||void 0===u?void 0:u.alias);const o=null===(s=null==i?void 0:i.field)||void 0===s?void 0:s.type;let c;l?c=l:(c=e[null===(v=null==i?void 0:i.field)||void 0===v?void 0:v.name],"date"===(null==o?void 0:o.toLowerCase())&&(c=(0,d.isDefined)(c)?(0,d.getDateWithTZOffset)(c,M.routes[F].ds).toLocaleDateString():null)),f&&a.push({name:f,val:c})}})),a})(null==N?void 0:N.attributes,null==t?void 0:t.fieldInfos,t),r=se("line"),u=se("point"),s=(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column"}},t.routeId&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingTop:"0.5rem"}},(0,e.jsx)("div",{style:{width:"30%",flex:"none"}},(0,e.jsx)(i.Label,null,_("routeId"))),(0,e.jsx)("div",{title:t.routeId,style:{width:"fitContent",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},t.routeId)),t.routeName&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,_("routeName"))),(0,e.jsx)("div",null,t.routeName)),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,_("measureLabel"))),(0,e.jsx)("div",null,(0,e.jsx)("span",null,null===(l=N.selectedMeasures)||void 0===l?void 0:l[0]),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},C[F].measureUnit))),(null===(o=N.selectedMeasures)||void 0===o?void 0:o.length)>1&&(()=>{const t=null==N?void 0:N.selectedMeasures,i=[];for(let l=1;l<t.length;l++)i.push((0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingBottom:"0.5rem"}},(0,e.jsx)("div",{style:{width:"30%"}}),(0,e.jsx)("span",null,t[l]),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},C[F].measureUnit)));return i})(),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,_("startMeasure"))),(0,e.jsx)("div",null,(0,e.jsx)("span",null,N.fromMeasure),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},C[F].measureUnit))),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,_("endMeasure"))),(0,e.jsx)("div",null,(0,e.jsx)("span",null," ",N.toMeasure),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},C[F].measureUnit))),ue(),a&&(null==a?void 0:a.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}},(t=>(0,e.jsx)(ie.CalciteTable,{className:"w-100 h-100",caption:_("routePicker"),bordered:!0,scale:"s",layout:"fixed"},(0,e.jsx)("calcite-table-row",{slot:"table-header"},(0,e.jsx)("calcite-table-header",{heading:(0,d.formatMessage)(n,"attribute")}),(0,e.jsx)("calcite-table-header",{heading:(0,d.formatMessage)(n,"value")})),null==t?void 0:t.map(((t,i)=>(0,e.jsx)(ie.CalciteTableRow,{key:i},(0,e.jsx)("calcite-table-cell",{itemKey:i},t.name),(0,e.jsx)("calcite-table-cell",{itemKey:i},t.val))))))(a)),z&&(null==r?void 0:r.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"1.5rem"}},_("lineEvent"),r),B&&(null==u?void 0:u.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}},_("pointEvent"),u));return s})(H)),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"center"}},(0,e.jsx)(i.Pagination,{current:F+1,onChangePage:e=>{(e=>{var t,i,l,o,n,a,d,r,s,c,h,p,m,y,S,b;w();const D=e-1,I=null===(o=null===(l=null===(i=null===(t=null==v?void 0:v.routes)||void 0===t?void 0:t[D])||void 0===i?void 0:i.timeDependedInfo)||void 0===l?void 0:l[0])||void 0===o?void 0:o.objectId,x=null===(a=null===(n=null==v?void 0:v.routes)||void 0===n?void 0:n[0])||void 0===a?void 0:a.objectIdFieldName,R=Q(E,I,x),j=null===(h=null===(c=null===(s=null===(r=null===(d=null==v?void 0:v.routes)||void 0===d?void 0:d[D])||void 0===r?void 0:r.timeDependedInfo)||void 0===s?void 0:s[0])||void 0===c?void 0:c.selectedMeasures)||void 0===h?void 0:h[0],k=Z(null==f?void 0:f.view.toScreen(null==v?void 0:v.routes[D].selectedPoint),null===(p=null==R?void 0:R.feature)||void 0===p?void 0:p.attributes,j),M=null==u?void 0:u.buildRecord(k);T(D),P(null===(S=null===(y=null===(m=null==v?void 0:v.routes)||void 0===m?void 0:m[D])||void 0===y?void 0:y.timeDependedInfo)||void 0===S?void 0:S[0]),V(M),g(null===(b=null==v?void 0:v.routes)||void 0===b?void 0:b[D],!0)})(e)},simple:!0,size:"sm",totalPage:null===(o=null==M?void 0:M.routes)||void 0===o?void 0:o.length})))))}var ae=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{r(l.next(e))}catch(e){n(e)}}function d(e){try{r(l.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}r((l=l.apply(e,t||[])).next())}))};var de=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{r(l.next(e))}catch(e){n(e)}}function d(e){try{r(l.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}r((l=l.apply(e,t||[])).next())}))};function re(t){const{widgetId:i,intl:l,lrsLayers:o,JimuMapView:n,defaultShowPp:a,hoverGraphic:r,config:s,onClearFlashGraphics:v,onClearPickedGraphics:c,onUpdateGraphics:f,flashSelectedGeometry:h}=t,[p,m]=e.React.useState(!1),[y,g]=e.React.useState(!1),[w,S]=e.React.useState(null),[b,D]=e.React.useState(null),[I,x]=e.React.useState(null),[R,j]=e.React.useState(null),[k,M]=e.React.useState(null),[G,C]=e.React.useState(null),[L,N]=e.React.useState(null),[P,F]=e.React.useState(!1),[T,E]=e.React.useState(null),[A,O]=e.React.useState(!0),[V,U]=e.React.useState(null),W=e.React.useCallback((e=>{m(e)}),[m]),H=e.React.useCallback((e=>{j(e)}),[j]),z=(e,...t)=>de(this,[e,...t],void 0,(function*(e,t=!1){const i=s.highlightStyle.routeColor,l=s.highlightStyle.width;(0,d.isDefined)(e.selectedPolyline)&&t&&h(yield(0,d.getGeometryGraphic)(yield(0,d.getSimpleLineGraphic)(e.selectedPolyline),i,l)),(0,d.isDefined)(e.selectedPoint)?f(yield(0,d.getGeometryGraphic)(yield(0,d.getSimplePointGraphic)(e.selectedPoint),te)):c(),n.clearSelectedFeatures()}));return(0,e.jsx)("div",null,(0,e.jsx)(u,{widgetId:i,selectedNetwork:b,onCreatePointDs:e=>{S(e)},lrsLayers:o,dataSourcesReady:W,handleSetDataSources:H}),(0,e.jsx)(ee,{intl:l,isReady:p,active:P,allDataSources:R,lrsLayers:o,jimuMapView:n,symbolColor:null,hoverGraphic:r,onActiveChange:()=>{var e;const t=!P;F(t),t?((null===(e=null==n?void 0:n.view)||void 0===e?void 0:e.popupEnabled)&&(n.view.popupEnabled=!1),v(),c()):n.view.popupEnabled=a},onRouteInfoUpdated:z,clearPickedGraphic:c,clearFlashGraphic:v,setSelectedPoint:e=>{M(e)},setRouteDetails:e=>de(this,void 0,void 0,(function*(){const t=[],i={};e.forEach((e=>{var l,o,n,a,d;const r=[];null===(l=null==e?void 0:e.routes)||void 0===l||l.forEach((e=>{var t;null===(t=null==e?void 0:e.timeDependedInfo)||void 0===t||t.forEach((e=>{var t;const l=null==e?void 0:e.objectId;r.push(l),i[l]=null===(t=null==e?void 0:e.selectedMeasures)||void 0===t?void 0:t[0]}))})),t.push(function(e,t,i){return ae(this,void 0,void 0,(function*(){var l;if(!e||0===e.length||!t)return[];const o={where:t+" IN ("+e.join(",")+")",outFields:["*"],returnGeometry:!0},n=yield i.query(o);return 0===(null===(l=null==n?void 0:n.records)||void 0===l?void 0:l.length)?[]:null==n?void 0:n.records}))}(r,null===(n=null===(o=null==e?void 0:e.routes)||void 0===o?void 0:o[0])||void 0===n?void 0:n.objectIdFieldName,null===(d=null===(a=null==e?void 0:e.routes)||void 0===a?void 0:a[0])||void 0===d?void 0:d.featureDS))}));const l=yield Promise.all(t);U(i),E(l),(e=>{let t=e.find((e=>(null==s?void 0:s.defaultNetworkLayer)===(null==e?void 0:e.id)));t||(t=e[0]);const i=o.find((e=>{var i;return(null===(i=null==e?void 0:e.layerInfo)||void 0===i?void 0:i.serviceId)===(null==t?void 0:t.id)}));x(t),D(null==i?void 0:i.networkInfo),g(!1)})(e),C(e)})),setEventDetails:e=>{N(e)},eventDataRecords:[],config:s,handleShowPp:e=>{O(e)}}),G&&G.length>0&&T.length>0&&A&&(0,e.jsx)(ne,{intl:l,allDataSources:R,selectedPoint:k,eventDetails:L,jimuMapView:n,onRouteInfoUpdated:z,clearPickedGraphic:c,config:s,isNetworkChange:y,widgetId:i,outputDS:w,dataRecords:T,measuresOids:V,selectedLocationInfo:I||G[0],networkLayers:G,handleSelectedNetworkChange:(e,t)=>{const i=o.find((t=>{var i;return(null===(i=null==t?void 0:t.layerInfo)||void 0===i?void 0:i.serviceId)===(null==e?void 0:e.id)})),l=G.find((t=>t.id===(null==e?void 0:e.id)));x(l),D(null==i?void 0:i.networkInfo),g(t)}}))}var ue=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{r(l.next(e))}catch(e){n(e)}}function d(e){try{r(l.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}r((l=l.apply(e,t||[])).next())}))};class se extends e.React.PureComponent{constructor(l){super(l),this.clearPickedGraphics=()=>{(0,d.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll()},this.clearFlashGraphic=()=>{(0,d.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()},this.updatePickedGraphic=e=>{(0,d.isDefined)(e)?(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.add(e)):this.clearPickedGraphics()},this.flashSelectedGeometry=e=>{(0,d.isDefined)(e)&&(this.state.flashGraphic.add(e),setTimeout((()=>{this.state.flashGraphic.removeAll(),setTimeout((()=>{this.state.flashGraphic.add(e),setTimeout((()=>{this.state.flashGraphic.removeAll(),setTimeout((()=>{this.state.flashGraphic.add(e),setTimeout((()=>{this.state.flashGraphic.removeAll()}),800)}),800)}),800)}),800)}),800))},this.updateGraphics=(e,t)=>ue(this,void 0,void 0,(function*(){(0,d.isDefined)(e.selectedPolyline)&&t&&this.flashSelectedGeometry(yield(0,d.getGeometryGraphic)(yield(0,d.getSimpleLineGraphic)(e.selectedPolyline),"#00FFFF")),(0,d.isDefined)(e.selectedPoint)?this.updatePickedGraphic(yield(0,d.getGeometryGraphic)(yield(0,d.getSimplePointGraphic)(e.selectedPoint),te)):this.clearPickedGraphics()})),this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))},this.waitForChildDataSourcesReady=t=>ue(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const i=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==i?void 0:i.isDataSourceSet())&&!i.areChildDataSourcesCreated()?i.childDataSourcesReady().then((()=>i)).catch((e=>i)):Promise.resolve(i)})),this.getI18nMessage=(e,l)=>{const o=Object.assign({},t,i.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:o[e]},l)},this.state={jimuMapView:void 0,hoverGraphic:null,pickedGraphic:null,flashGraphic:null}}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,t){t.jimuMapView!==this.state.jimuMapView&&(0,d.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers())}removeGraphicLayers(){(0,d.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,d.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,d.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,d.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const i=new a.default({listMode:"hide"}),l=new a.default({listMode:"hide"}),o=new a.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([l,o,i]),this.setState({hoverGraphic:i}),this.setState({pickedGraphic:l}),this.setState({flashGraphic:o})}}clearGraphics(){(0,d.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,d.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,d.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}render(){var t,l;const{config:a,id:d}=this.props,{lrsLayers:r,networkLayers:u}=a,{jimuMapView:s}=this.state;return u&&0!==(null==u?void 0:u.length)?(0,e.jsx)("div",{css:e.css`
    min-width: 32px;
    min-height: 32px;
  `},(0,e.jsx)(n.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(re,{intl:this.props.intl,widgetId:d,lrsLayers:r,config:a,JimuMapView:s,hoverGraphic:this.state.hoverGraphic,onClearPickedGraphics:this.clearPickedGraphics.bind(this),onClearFlashGraphics:this.clearFlashGraphic.bind(this),onUpdateGraphics:this.updatePickedGraphic.bind(this),flashSelectedGeometry:this.flashSelectedGeometry.bind(this),defaultShowPp:null===(l=null==s?void 0:s.view)||void 0===l?void 0:l.popupEnabled})):(0,e.jsx)(i.WidgetPlaceholder,{icon:o(),widgetId:d,message:this.getI18nMessage("_widgetLabel")})}}function ve(e){s.p=e}})(),v})())}}}));