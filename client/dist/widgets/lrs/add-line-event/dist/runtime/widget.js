System.register(["jimu-core","jimu-ui","jimu-arcgis","widgets/shared-code/lrs","calcite-components","esri/layers/GraphicsLayer"],(function(e,t){var o={},a={},n={},i={},s={},r={};return{setters:[function(e){o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.MessageManager=e.MessageManager,o.React=e.React,o.RecordSetChangeType=e.RecordSetChangeType,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.focusElementInKeyboardMode=e.focusElementInKeyboardMode,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.utils=e.utils},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,a.Label=e.Label,a.Select=e.Select,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.WidgetPlaceholder=e.WidgetPlaceholder,a.defaultMessages=e.defaultMessages},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.AttributeTable=e.AttributeTable,i.CopyAttributeTool=e.CopyAttributeTool,i.GetUnits=e.GetUnits,i.InlineEditableDropdown=e.InlineEditableDropdown,i.Intellisense=e.Intellisense,i.LockAction=e.LockAction,i.LockManagerComponent=e.LockManagerComponent,i.LrsApplyEdits=e.LrsApplyEdits,i.LrsLayerType=e.LrsLayerType,i.QueryMeasureOnRoute=e.QueryMeasureOnRoute,i.QueryPolylineOnRoute=e.QueryPolylineOnRoute,i.QueryRouteMeasures=e.QueryRouteMeasures,i.RoutePicker=e.RoutePicker,i.RoutePickerPopup=e.RoutePickerPopup,i.SearchMethod=e.SearchMethod,i.convertStationToNumber=e.convertStationToNumber,i.getCalciteBasicTheme=e.getCalciteBasicTheme,i.getDateToUTC=e.getDateToUTC,i.getDateWithTZOffset=e.getDateWithTZOffset,i.getDateWithoutTZOffset=e.getDateWithoutTZOffset,i.getGeometryGraphic=e.getGeometryGraphic,i.getInitialEventInfoState=e.getInitialEventInfoState,i.getInitialRouteInfoState=e.getInitialRouteInfoState,i.getInitialRouteMeasurePickerInfoState=e.getInitialRouteMeasurePickerInfoState,i.getIntialLocksInfo=e.getIntialLocksInfo,i.getNetworkOutFields=e.getNetworkOutFields,i.getRouteFromEndMeasures=e.getRouteFromEndMeasures,i.getRouteMeasures=e.getRouteMeasures,i.getSimpleLineGraphic=e.getSimpleLineGraphic,i.getSimplePointGraphic=e.getSimplePointGraphic,i.getSuggestions=e.getSuggestions,i.getUUID=e.getUUID,i.isDate=e.isDate,i.isDefined=e.isDefined,i.isInWidgetController=e.isInWidgetController,i.isNumber=e.isNumber,i.queryAllRoutesByLineId=e.queryAllRoutesByLineId,i.queryRouteIdOrName=e.queryRouteIdOrName,i.queryRoutesByLineId=e.queryRoutesByLineId,i.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,i.validateField=e.validateField,i.validateRangeDomain=e.validateRangeDomain},function(e){s.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){r.default=e.default}],execute:function(){e((()=>{var e={14321:e=>{"use strict";e.exports=a},26623:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M17 3H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h9v1H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h15a2 2 0 0 1 2 2v6h-1V4a1 1 0 0 0-1-1"></path><path fill="#000" d="M5.5 6.5v-2h-1v2H3v1h10.5v2h1v-2H16v-1zM13 12.5H3v-1h10zM16 18v-3h-3v-1h3v-3h1v3h3v1h-3v3z"></path></svg>'},47626:e=>{"use strict";e.exports=i},59620:e=>{"use strict";e.exports=r},62686:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=o},99037:e=>{"use strict";e.exports=s}},t={};function l(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,l),n.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var o in t)l.o(t,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var u={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(u),l.d(u,{__set_webpack_public_path__:()=>wa,default:()=>ka});var e,t=l(79244);!function(e){e.single="SINGLE",e.multiple="MULTIPLE"}(e||(e={}));const o={_widgetLabel:"Add Line Event",typeLabel:"Type",eventLayerLabel:"Event",networkLabel:"Network",fromMethodLabel:"From Method",toMethodLabel:"To Method",fromRouteIdLabel:"From Route ID *",toRouteIdLabel:"To Route ID *",fromRouteNameLabel:"From Route Name *",toRouteNameLabel:"To Route Name *",fromMeasureLabel:"From Measure *",fromMeasureWithUnits:"From Measure ({units}) *",toMeasureWithUnits:"To Measure ({units}) *",selectRouteLabel:"Select Route",toMeasureLabel:"To Measure *",startDateLabel:"Start Date *",endDateLabel:"End Date",fromDateLabel:"From Date",toDateLabel:"To Date",routeIdLabel:"Route ID",measureLabel:"Measure",routeNameLabel:"Route Name",datesLabel:"Dates",nextLabel:"Next",singleOperation:"Single Line",multipleOperation:"Multiple Line",useStartDateLabel:"Use route start date",useEndDateLabel:"Use route end date",useStartMeasureLabel:"Use route start measure",useEndMeasureLabel:"Use route end measure",routeAndMeasure:"Route and Measure",coordinate:"Coordinate",locationOffset:"Location Offset",backLabel:"Back",saveLabel:"Save",selectAllLabel:"Select All",useMergeEventsLabel:"Merge coincident events",useRetireEventsLabel:"Retire overlapping events",resetForm:"Reset",nullLabel:"null",trueLabel:"true",falseLabel:"false",attributeError:"{fieldValue}: {message}",eventCreated:"Event Created",routeNotFound:"Route not found",routeNotOnSameLine:"From Route and To Route are not in the same line.",measureLessError:"Selected measure is less than route's from measure",measureGreaterError:"Selected measure is greater than route's to measure",invalidMeasureError:"Input measure is invalid",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Valid exceeds maximum length of field: {value}.",invalidDate:"Invalid date.",invalidFromDateBefore:"Start date is before route start date",invalidFromDateAfter:"Start date is after route end date",invalidToDateBefore:"End date is before route start date",invalidToDateAfter:"End date is after route end date",invalidDatesOrder:"Selected start date is greater than selected end date",invalidDatesSameDay:"Start and end dates cannot be the same",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",noResult:"No results",attributeSetLabel:"Attribute Set",invalidContingentValues:"Attribute do not satisfy a required Contingent Value: {groupNames}",contingentValueError:"Invalid contingent value in the field"};var a=l(14321),n=l(26623),i=l.n(n),s=l(62686),r=l(47626);function c(){const e=t.hooks.useTranslation(o);return(0,t.jsx)("div",{className:"add-line=event-form-header"},(0,t.jsx)("div",{className:"add-single-line-event-form__header pt-3 px-3 align-items-center"},(0,t.jsx)("div",{className:"add-single-line-event_title d-flex align-items-center text-truncate",css:t.css`
            font-weight: 500;
            font-size: 14px;
          `},(0,t.jsx)("div",{className:"text-truncate"},e("_widgetLabel")))))}const d=function(){this.__data__=[],this.size=0};const f=function(e,t){return e===t||e!=e&&t!=t};const m=function(e,t){for(var o=e.length;o--;)if(f(e[o][0],t))return o;return-1};var v=Array.prototype.splice;const p=function(e){var t=this.__data__,o=m(t,e);return!(o<0)&&(o==t.length-1?t.pop():v.call(t,o,1),--this.size,!0)};const h=function(e){var t=this.__data__,o=m(t,e);return o<0?void 0:t[o][1]};const D=function(e){return m(this.__data__,e)>-1};const b=function(e,t){var o=this.__data__,a=m(o,e);return a<0?(++this.size,o.push([e,t])):o[a][1]=t,this};function g(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var a=e[t];this.set(a[0],a[1])}}g.prototype.clear=d,g.prototype.delete=p,g.prototype.get=h,g.prototype.has=D,g.prototype.set=b;const R=g;const I=function(){this.__data__=new R,this.size=0};const y=function(e){var t=this.__data__,o=t.delete(e);return this.size=t.size,o};const S=function(e){return this.__data__.get(e)};const N=function(e){return this.__data__.has(e)};const M="object"==typeof global&&global&&global.Object===Object&&global;var T="object"==typeof self&&self&&self.Object===Object&&self;const k=M||T||Function("return this")();const w=k.Symbol;var j=Object.prototype,x=j.hasOwnProperty,F=j.toString,A=w?w.toStringTag:void 0;const O=function(e){var t=x.call(e,A),o=e[A];try{e[A]=void 0;var a=!0}catch(e){}var n=F.call(e);return a&&(t?e[A]=o:delete e[A]),n};var L=Object.prototype.toString;const P=function(e){return L.call(e)};var E=w?w.toStringTag:void 0;const C=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":E&&E in Object(e)?O(e):P(e)};const _=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const G=function(e){if(!_(e))return!1;var t=C(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const U=k["__core-js_shared__"];var V,B=(V=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||""))?"Symbol(src)_1."+V:"";const W=function(e){return!!B&&B in e};var z=Function.prototype.toString;const q=function(e){if(null!=e){try{return z.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Q=/^\[object .+?Constructor\]$/,H=Function.prototype,Z=Object.prototype,$=H.toString,J=Z.hasOwnProperty,K=RegExp("^"+$.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Y=function(e){return!(!_(e)||W(e))&&(G(e)?K:Q).test(q(e))};const X=function(e,t){return null==e?void 0:e[t]};const ee=function(e,t){var o=X(e,t);return Y(o)?o:void 0};const te=ee(k,"Map");const oe=ee(Object,"create");const ae=function(){this.__data__=oe?oe(null):{},this.size=0};const ne=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var ie=Object.prototype.hasOwnProperty;const se=function(e){var t=this.__data__;if(oe){var o=t[e];return"__lodash_hash_undefined__"===o?void 0:o}return ie.call(t,e)?t[e]:void 0};var re=Object.prototype.hasOwnProperty;const le=function(e){var t=this.__data__;return oe?void 0!==t[e]:re.call(t,e)};const ue=function(e,t){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=oe&&void 0===t?"__lodash_hash_undefined__":t,this};function ce(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var a=e[t];this.set(a[0],a[1])}}ce.prototype.clear=ae,ce.prototype.delete=ne,ce.prototype.get=se,ce.prototype.has=le,ce.prototype.set=ue;const de=ce;const fe=function(){this.size=0,this.__data__={hash:new de,map:new(te||R),string:new de}};const me=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const ve=function(e,t){var o=e.__data__;return me(t)?o["string"==typeof t?"string":"hash"]:o.map};const pe=function(e){var t=ve(this,e).delete(e);return this.size-=t?1:0,t};const he=function(e){return ve(this,e).get(e)};const De=function(e){return ve(this,e).has(e)};const be=function(e,t){var o=ve(this,e),a=o.size;return o.set(e,t),this.size+=o.size==a?0:1,this};function ge(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var a=e[t];this.set(a[0],a[1])}}ge.prototype.clear=fe,ge.prototype.delete=pe,ge.prototype.get=he,ge.prototype.has=De,ge.prototype.set=be;const Re=ge;const Ie=function(e,t){var o=this.__data__;if(o instanceof R){var a=o.__data__;if(!te||a.length<199)return a.push([e,t]),this.size=++o.size,this;o=this.__data__=new Re(a)}return o.set(e,t),this.size=o.size,this};function ye(e){var t=this.__data__=new R(e);this.size=t.size}ye.prototype.clear=I,ye.prototype.delete=y,ye.prototype.get=S,ye.prototype.has=N,ye.prototype.set=Ie;const Se=ye;const Ne=function(e,t){for(var o=-1,a=null==e?0:e.length;++o<a&&!1!==t(e[o],o,e););return e};const Me=function(){try{var e=ee(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const Te=function(e,t,o){"__proto__"==t&&Me?Me(e,t,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[t]=o};var ke=Object.prototype.hasOwnProperty;const we=function(e,t,o){var a=e[t];ke.call(e,t)&&f(a,o)&&(void 0!==o||t in e)||Te(e,t,o)};const je=function(e,t,o,a){var n=!o;o||(o={});for(var i=-1,s=t.length;++i<s;){var r=t[i],l=a?a(o[r],e[r],r,o,e):void 0;void 0===l&&(l=e[r]),n?Te(o,r,l):we(o,r,l)}return o};const xe=function(e,t){for(var o=-1,a=Array(e);++o<e;)a[o]=t(o);return a};const Fe=function(e){return null!=e&&"object"==typeof e};const Ae=function(e){return Fe(e)&&"[object Arguments]"==C(e)};var Oe=Object.prototype,Le=Oe.hasOwnProperty,Pe=Oe.propertyIsEnumerable,Ee=Ae(function(){return arguments}())?Ae:function(e){return Fe(e)&&Le.call(e,"callee")&&!Pe.call(e,"callee")};const Ce=Ee;const _e=Array.isArray;const Ge=function(){return!1};var Ue="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ve=Ue&&"object"==typeof module&&module&&!module.nodeType&&module,Be=Ve&&Ve.exports===Ue?k.Buffer:void 0;const We=(Be?Be.isBuffer:void 0)||Ge;var ze=/^(?:0|[1-9]\d*)$/;const qe=function(e,t){var o=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==o||"symbol"!=o&&ze.test(e))&&e>-1&&e%1==0&&e<t};const Qe=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var He={};He["[object Float32Array]"]=He["[object Float64Array]"]=He["[object Int8Array]"]=He["[object Int16Array]"]=He["[object Int32Array]"]=He["[object Uint8Array]"]=He["[object Uint8ClampedArray]"]=He["[object Uint16Array]"]=He["[object Uint32Array]"]=!0,He["[object Arguments]"]=He["[object Array]"]=He["[object ArrayBuffer]"]=He["[object Boolean]"]=He["[object DataView]"]=He["[object Date]"]=He["[object Error]"]=He["[object Function]"]=He["[object Map]"]=He["[object Number]"]=He["[object Object]"]=He["[object RegExp]"]=He["[object Set]"]=He["[object String]"]=He["[object WeakMap]"]=!1;const Ze=function(e){return Fe(e)&&Qe(e.length)&&!!He[C(e)]};const $e=function(e){return function(t){return e(t)}};var Je="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ke=Je&&"object"==typeof module&&module&&!module.nodeType&&module,Ye=Ke&&Ke.exports===Je&&M.process;const Xe=function(){try{var e=Ke&&Ke.require&&Ke.require("util").types;return e||Ye&&Ye.binding&&Ye.binding("util")}catch(e){}}();var et=Xe&&Xe.isTypedArray;const tt=et?$e(et):Ze;var ot=Object.prototype.hasOwnProperty;const at=function(e,t){var o=_e(e),a=!o&&Ce(e),n=!o&&!a&&We(e),i=!o&&!a&&!n&&tt(e),s=o||a||n||i,r=s?xe(e.length,String):[],l=r.length;for(var u in e)!t&&!ot.call(e,u)||s&&("length"==u||n&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||qe(u,l))||r.push(u);return r};var nt=Object.prototype;const it=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||nt)};const st=function(e,t){return function(o){return e(t(o))}};const rt=st(Object.keys,Object);var lt=Object.prototype.hasOwnProperty;const ut=function(e){if(!it(e))return rt(e);var t=[];for(var o in Object(e))lt.call(e,o)&&"constructor"!=o&&t.push(o);return t};const ct=function(e){return null!=e&&Qe(e.length)&&!G(e)};const dt=function(e){return ct(e)?at(e):ut(e)};const ft=function(e,t){return e&&je(t,dt(t),e)};const mt=function(e){var t=[];if(null!=e)for(var o in Object(e))t.push(o);return t};var vt=Object.prototype.hasOwnProperty;const pt=function(e){if(!_(e))return mt(e);var t=it(e),o=[];for(var a in e)("constructor"!=a||!t&&vt.call(e,a))&&o.push(a);return o};const ht=function(e){return ct(e)?at(e,!0):pt(e)};const Dt=function(e,t){return e&&je(t,ht(t),e)};var bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,gt=bt&&"object"==typeof module&&module&&!module.nodeType&&module,Rt=gt&&gt.exports===bt?k.Buffer:void 0,It=Rt?Rt.allocUnsafe:void 0;const yt=function(e,t){if(t)return e.slice();var o=e.length,a=It?It(o):new e.constructor(o);return e.copy(a),a};const St=function(e,t){var o=-1,a=e.length;for(t||(t=Array(a));++o<a;)t[o]=e[o];return t};const Nt=function(e,t){for(var o=-1,a=null==e?0:e.length,n=0,i=[];++o<a;){var s=e[o];t(s,o,e)&&(i[n++]=s)}return i};const Mt=function(){return[]};var Tt=Object.prototype.propertyIsEnumerable,kt=Object.getOwnPropertySymbols;const wt=kt?function(e){return null==e?[]:(e=Object(e),Nt(kt(e),(function(t){return Tt.call(e,t)})))}:Mt;const jt=function(e,t){return je(e,wt(e),t)};const xt=function(e,t){for(var o=-1,a=t.length,n=e.length;++o<a;)e[n+o]=t[o];return e};const Ft=st(Object.getPrototypeOf,Object);const At=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)xt(t,wt(e)),e=Ft(e);return t}:Mt;const Ot=function(e,t){return je(e,At(e),t)};const Lt=function(e,t,o){var a=t(e);return _e(e)?a:xt(a,o(e))};const Pt=function(e){return Lt(e,dt,wt)};const Et=function(e){return Lt(e,ht,At)};const Ct=ee(k,"DataView");const _t=ee(k,"Promise");const Gt=ee(k,"Set");const Ut=ee(k,"WeakMap");var Vt="[object Map]",Bt="[object Promise]",Wt="[object Set]",zt="[object WeakMap]",qt="[object DataView]",Qt=q(Ct),Ht=q(te),Zt=q(_t),$t=q(Gt),Jt=q(Ut),Kt=C;(Ct&&Kt(new Ct(new ArrayBuffer(1)))!=qt||te&&Kt(new te)!=Vt||_t&&Kt(_t.resolve())!=Bt||Gt&&Kt(new Gt)!=Wt||Ut&&Kt(new Ut)!=zt)&&(Kt=function(e){var t=C(e),o="[object Object]"==t?e.constructor:void 0,a=o?q(o):"";if(a)switch(a){case Qt:return qt;case Ht:return Vt;case Zt:return Bt;case $t:return Wt;case Jt:return zt}return t});const Yt=Kt;var Xt=Object.prototype.hasOwnProperty;const eo=function(e){var t=e.length,o=new e.constructor(t);return t&&"string"==typeof e[0]&&Xt.call(e,"index")&&(o.index=e.index,o.input=e.input),o};const to=k.Uint8Array;const oo=function(e){var t=new e.constructor(e.byteLength);return new to(t).set(new to(e)),t};const ao=function(e,t){var o=t?oo(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)};var no=/\w*$/;const io=function(e){var t=new e.constructor(e.source,no.exec(e));return t.lastIndex=e.lastIndex,t};var so=w?w.prototype:void 0,ro=so?so.valueOf:void 0;const lo=function(e){return ro?Object(ro.call(e)):{}};const uo=function(e,t){var o=t?oo(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)};const co=function(e,t,o){var a=e.constructor;switch(t){case"[object ArrayBuffer]":return oo(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return ao(e,o);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return uo(e,o);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return io(e);case"[object Symbol]":return lo(e)}};var fo=Object.create;const mo=function(){function e(){}return function(t){if(!_(t))return{};if(fo)return fo(t);e.prototype=t;var o=new e;return e.prototype=void 0,o}}();const vo=function(e){return"function"!=typeof e.constructor||it(e)?{}:mo(Ft(e))};const po=function(e){return Fe(e)&&"[object Map]"==Yt(e)};var ho=Xe&&Xe.isMap;const Do=ho?$e(ho):po;const bo=function(e){return Fe(e)&&"[object Set]"==Yt(e)};var go=Xe&&Xe.isSet;const Ro=go?$e(go):bo;var Io="[object Arguments]",yo="[object Function]",So="[object Object]",No={};No[Io]=No["[object Array]"]=No["[object ArrayBuffer]"]=No["[object DataView]"]=No["[object Boolean]"]=No["[object Date]"]=No["[object Float32Array]"]=No["[object Float64Array]"]=No["[object Int8Array]"]=No["[object Int16Array]"]=No["[object Int32Array]"]=No["[object Map]"]=No["[object Number]"]=No[So]=No["[object RegExp]"]=No["[object Set]"]=No["[object String]"]=No["[object Symbol]"]=No["[object Uint8Array]"]=No["[object Uint8ClampedArray]"]=No["[object Uint16Array]"]=No["[object Uint32Array]"]=!0,No["[object Error]"]=No[yo]=No["[object WeakMap]"]=!1;const Mo=function e(t,o,a,n,i,s){var r,l=1&o,u=2&o,c=4&o;if(a&&(r=i?a(t,n,i,s):a(t)),void 0!==r)return r;if(!_(t))return t;var d=_e(t);if(d){if(r=eo(t),!l)return St(t,r)}else{var f=Yt(t),m=f==yo||"[object GeneratorFunction]"==f;if(We(t))return yt(t,l);if(f==So||f==Io||m&&!i){if(r=u||m?{}:vo(t),!l)return u?Ot(t,Dt(r,t)):jt(t,ft(r,t))}else{if(!No[f])return i?t:{};r=co(t,f,l)}}s||(s=new Se);var v=s.get(t);if(v)return v;s.set(t,r),Ro(t)?t.forEach((function(n){r.add(e(n,o,a,n,t,s))})):Do(t)&&t.forEach((function(n,i){r.set(i,e(n,o,a,i,t,s))}));var p=d?void 0:(c?u?Et:Pt:u?ht:dt)(t);return Ne(p||t,(function(n,i){p&&(n=t[i=n]),we(r,i,e(n,o,a,i,t,s))})),r};const To=function(e){return Mo(e,5)};var ko;!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(ko||(ko={}));Object.assign({},{eventRequiredLabel:"Event *",networkRequiredLabel:"Network *",routeIdRequiredLabel:"Route ID *",routeNameRequiredLabel:"Route Name *",startDateRequiredLabel:"Start Date *",nullLabel:"null",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",attributeError:"{fieldValue}: {message}",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Value exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",contingentValueError:"Invalid contingent value in the field",selectRouteLabel:"Select Route",routePicker:"Route Picker",routeNameLabel:"Route Name",routeIdLabel:"Route ID",fromRouteNameLabel:"From Route Name",fromRouteIdLabel:"From Route ID",toRouteNameLabel:"To Route Name",toRouteIdLabel:"To Route ID",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",fromMeasureLabel:"From Measure",toMeasureLabel:"To Measure",noResult:"No Results",copyAttributes:"Copy Attributes",noLrsLayersTips:"No LRS layers are present in the selected map. Select a map with LRS Network and Event layers present in the webmap.",multipleServicesTips:"Map contains layers from more than one feature service. Select a map with LRS Network and Event layers coming from a single feature service.",noNetworkLayersTips:"No LRS Network layers are present in the selected map. Select a map with at least one LRS network layer present in the web map.",noMapSelectedTips:"Select a map.",displaySettings:"Display Settings",hideNetwork:"Hide Network",hideEvent:"Hide Event",hideMethod:"Hide Method",hideRoute:"Hide Route in Search by Line",hideType:"Hide Type",hideAttributeSet:"Hide Attribute Set",hideMeasures:"Hide Measures",hideDates:"Hide Dates",useRoutesStartEndDates:"Use Routes Start and End Dates",useRoutesStartEndDatesTooltip:"Routes start/end dates will be used for new events. If disabled, the current date will be used.",selectMap:"Select Map",loadLayers:"Load layers",clearLayers:"Clear layers",removeLayer:"Remove",missingParentNetwork:"Parent network is missing",inches:"Inches (US Survey)",feet:"Feet (US Survey)",yards:"Yards (US Survey)",miles:"Miles (US Survey)",nauticalMiles:"Nautical miles (US Survey)",points:"Points",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal degrees",decimeters:"Decimeters",intFeet:"Feet (International)",intMiles:"Statute miles",esriUnknownUnits:"esriUnknownUnits",invalidRouteField:"Route could not be found with provided value",CannotAcquireLockUserAndVersion:"Cannot acquire lock because {user} has the lock in version {version}.",UnavailableLockOnLine:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnRoute:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnLineWithoutVersion:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",UnavailableLockOnRouteWithoutVersion:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",YouAcquiredLockOnLine:"You have acquired a lock on line {nameOrId} ({networkName}) in version {version}.",YouAcquiredLockOnRoute:"You have acquired a lock on route {nameOrId} ({networkName}) in version {version}.",ReconcileRequired:"The default version has changed. Reconcile this version with the default version in order to acquire locks."},a.defaultMessages);function wo(e){return null!=e}function jo(e,t,o,a,n,i,s){const r={};if(wo(a))if(-1===e&&-1===o)a.forEach((e=>{r[e.name]=e.value}));else{const t=a[o];a.forEach((o=>{r[o.name]=o.value,o.name===t.name&&(r[o.name]=e)}))}else s.forEach((e=>{const t=i.attributes[e.name],o=e.alias.split(".")[1];r[o]=t}));const l=[];for(const e of n){const t=e.isEditingRestrictive?"error":"warning";let o=!1;const a=e.contingencies.filter((e=>!e.isRetired));if(!a||0===a.length)return[];for(const e of a){let t=!0;for(const o in e.values){const a=e.values[o];if("any"!==a.objectType)if("null"===a.objectType){if(null!=r[o]){t=!1;break}}else if("code"===a.objectType){if(null!=a.codedValue&&r[o]!==a.codedValue.code){t=!1;break}}else if("range"===a.objectType){const e=r[o];if(null!=a.minValue&&null!=a.maxValue&&(e<a.minValue||e>a.maxValue)){t=!1;break}}}if(t){o=!0;break}}o||l.push({fieldGroup:e,type:t})}return l}var xo=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};let Fo=[];function Ao(e){var n;const i=t.hooks.useTranslation(o),{intl:s,widgetId:l,networkDS:u,network:c,eventDS:d,eventLayer:f,routeInfo:m,eventInfo:v,reset:p,jimuMapView:h,hoverGraphic:D,conflictPreventionEnabled:b,onNavBack:g}=e,[R,I]=t.React.useState(),[y,S]=t.React.useState(!1),[N,M]=t.React.useState(),[T,k]=t.React.useState(""),[w,j]=t.React.useState((0,r.getIntialLocksInfo)()),[x,F]=t.React.useState(!1),[A,O]=t.React.useState(!1);t.React.useEffect((()=>{I(L())}),[d,f]),t.React.useEffect((()=>{p&&I(L())}),[p]),t.React.useEffect((()=>{if(b){const e=Object.assign({},w);(0,r.isDefined)(c)&&(e.networkId=[c.networkInfo.lrsNetworkId]),(0,r.isDefined)(f)&&(e.eventServiceLayerIds=[f.serviceId]),(0,r.isDefined)(m)&&(e.routeInfo=m),j(e)}}),[u,c,f,m]);const L=()=>{const e=[];if((0,r.isDefined)(f)&&(0,r.isDefined)(d)&&(0,r.isDefined)(f.eventInfo)&&(0,r.isDefined)(f.eventInfo.attributeFields)){const t=d,o=(null==t?void 0:t.layer).fields;f.eventInfo.attributeFields.forEach((t=>{if(t.enabled){const a=o.find((e=>e.name===t.field.name));if(a){let o;o=(0,r.isDate)(a.type)?(0,r.isDefined)(a.defaultValue)?new Date(a.defaultValue):null:a.defaultValue;const n={index:e.length,name:a.name,alias:a.alias,type:a.type,hasDomain:(0,r.isDefined)(a.domain),value:o,error:"",nullable:a.nullable,default:"number"==typeof o?Number(o).toString():o,length:a.length,editable:t.editable};e.push(n)}}}))}return e},P=e=>e.findIndex((e=>e.error.length>0))>-1,E=e=>{const t=To(e);I(t),F(P(t))},C=e=>{g(e)},_=()=>{const e=[];if((0,r.isDefined)(f)&&(0,r.isDefined)(d)){const t=d,o=(null==t?void 0:t.layer).fields;f.eventInfo.attributeFields.forEach((t=>{const a=o.find((e=>e.name===t.field.name));if(a){let o;if("date"===a.type&&(0,r.isDefined)(a.defaultValue)){const e=new Date(a.defaultValue);(0,r.isDefined)(e)&&(o=e.toISOString().substring(0,10))}else o=a.defaultValue;const n={index:e.length,name:a.name,alias:a.alias,type:a.type,hasDomain:(0,r.isDefined)(a.domain),value:o,error:"",nullable:a.nullable,default:"number"==typeof o?Number(o).toString():o,length:a.length,editable:t.editable};e.push(n)}})),I(e)}},G=e=>xo(this,void 0,void 0,(function*(){const t={edits:[]};if((()=>{const e=To(R);let t=!1;return e.forEach(((o,a)=>{let n;if(n=o.hasDomain?(0,r.validateRangeDomain)(o.value,o.name,d):(0,r.validateField)(o.value,o.name,d),(0,r.isDefined)(Fo)){let t=[];const i=jo(o.value,0,a,e,Fo);(null==i?void 0:i.length)>0&&(i.forEach((e=>{var o;const a=null===(o=null==e?void 0:e.fieldGroup)||void 0===o?void 0:o.fields;t.push(a)})),t=t.flat(),t.includes(o.name)&&(O(!0),n={hasError:!0,message:"contingentValueError"}))}if(n.hasError){let e;if("contingentValueError"===n.message){const t=[];Fo.forEach((e=>{t.push(e.name)}));let o=i("invalidContingentValues");o=o.replace("{groupNames}",t.join(",")),e=o}else{const t=f.useFieldAlias?o.alias:o.name;e=i("attributeError",{fieldValue:t,message:i(n.message)})}M("error"),k(e),S(!0),setTimeout((()=>{S(!1)}),5e3),t=!0,o.error=i(n.message)}})),t&&E(e),t})())return;let o=d.getGDBVersion();if(o||(o=""),(0,r.isDefined)(f)){const e={};let o=!1,a=!1;f.eventInfo.canSpanRoutes?m.routeLineOrder>m.toRouteLineOrder?o=!0:m.routeId===m.toRouteId&&m.selectedMeasure>m.selectedToMeasure&&(a=!0):m.selectedMeasure>m.selectedToMeasure&&(a=!0);const n=f.eventInfo.eventIdFieldName;e[n]="{"+(0,r.getUUID)()+"}";const i=f.eventInfo.routeIdFieldName;e[i]=m.routeId;const s=f.eventInfo.fromMeasureFieldName;e[s]=m.selectedMeasure;const l=f.eventInfo.fromDateFieldName;if(m.selectedFromDate){const t=(0,r.isDefined)(m.selectedFromDate)?(0,r.getDateWithoutTZOffset)(m.selectedFromDate.valueOf(),u):null;e[l]=(0,r.getDateToUTC)(t)}else e[l]=m.selectedFromDate;const c=f.eventInfo.toDateFieldName;if(m.selectedToDate){const t=(0,r.isDefined)(m.selectedToDate)?(0,r.getDateWithoutTZOffset)(m.selectedToDate.valueOf(),u):null;e[c]=(0,r.getDateToUTC)(t)}else e[c]=m.selectedToDate;if(f.eventInfo.routeNameFieldName&&f.eventInfo.routeNameFieldName.length>0){const t=f.eventInfo.routeNameFieldName;e[t]=m.routeName}if(f.eventInfo.toRouteIdFieldName&&f.eventInfo.toRouteIdFieldName.length>0){const t=f.eventInfo.toRouteIdFieldName;e[t]=m.toRouteId,o&&(e[i]=m.toRouteId,e[t]=m.routeId)}if(f.eventInfo.toRouteNameFieldName&&f.eventInfo.toRouteNameFieldName.length>0){const t=f.eventInfo.toRouteNameFieldName;if(e[t]=m.toRouteName,o){const o=f.eventInfo.routeNameFieldName;e[o]=m.toRouteName,e[t]=m.routeName}}if(f.eventInfo.toMeasureFieldName&&f.eventInfo.toMeasureFieldName.length>0){const t=f.eventInfo.toMeasureFieldName;e[t]=m.selectedToMeasure,(o||a)&&(e[s]=m.selectedToMeasure,e[t]=m.selectedMeasure)}R.forEach((t=>{const o=t.name;if((0,r.isDefined)(t.value)&&(0,r.isDate)(t.type)){const a=(0,r.getDateWithoutTZOffset)(t.value.valueOf(),u);e[o]=(0,r.getDateToUTC)(a)}else(0,r.isNumber)(t.type)?!(0,r.isDefined)(t.value)||""===t.value||isNaN(Number(t.value))?e[o]=null:e[o]=Number(t.value):e[o]=t.value}));const d=[],p={attributes:e,geometry:m.selectedPolyline};d.push(p);const h={id:f.serviceId,adds:d,allowMerge:v.mergeCoincident,retireMeasureOverlap:v.retireOverlapping,retireByEventId:!1};t.edits.push(h)}yield(0,r.LrsApplyEdits)(f.lrsUrl,t,o).then((o=>{o.success?(M("success"),k(i("eventCreated")),S(!0),U(t),setTimeout((()=>xo(this,void 0,void 0,(function*(){if(S(!1),b&&(0,r.isDefined)(e)){yield(0,r.tryReleaseLockOnDefault)(u,e);const t=Object.assign(Object.assign({},w),{lockAction:r.LockAction.Clear});j(t)}else C(!0),_()}))),5e3)):(M("error"),k(`${o.message} \n ${o.details}`),S(!0),setTimeout((()=>{S(!1)}),5e3))}))})),U=e=>xo(this,void 0,void 0,(function*(){const o=d,a=o.getPopupInfo(),n=o.getLayerDefinition(),i=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==n?void 0:n.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==a?void 0:a.fieldInfos)||[]).filter((e=>e.visible)));let s=null;yield(0,t.loadArcGISJSAPIModules)(["esri/Graphic"]).then((e=>{[s]=e})).then((()=>{const t=new s({geometry:e.edits[0].adds[0].geometry,attributes:e.edits[0].adds[0].attributes}),a=o.buildRecord(t);o.afterAddRecord(a)})),o.updateQueryParams({returnGeometry:!0},l);const r=new t.DataRecordSetChangeMessage(l,t.RecordSetChangeType.CreateUpdate,[{records:o.getRecords(),fields:i.map((e=>e.fieldName)),dataSource:o,name:o.id}]);t.MessageManager.getInstance().publishMessage(r)}));return(0,t.jsx)("div",{className:"h-100",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-line-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-line-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-line-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-line=event-edit-attributes__action {
      height: auto;
    }
    .add-line-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,t.jsx)("div",{className:"add-line-event-edit-attributes__content"},b&&(0,t.jsx)(r.LockManagerComponent,{intl:s,featureDS:u,lockInfo:w,showAlert:!0,networkName:null===(n=null==c?void 0:c.networkInfo)||void 0===n?void 0:n.datasetName,conflictPreventionEnabled:b,onQueryAndAcquireComplete:(e,t,o)=>{j(e),o&&G(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},w),{lockAction:r.LockAction.None});j(e),C(!0),_()}}),(0,t.jsx)("div",{className:"attribute-picker d-flex w-100 px-3"},(0,t.jsx)("div",{className:"ml-auto"},(0,t.jsx)(r.CopyAttributeTool,{disabled:!1,networkDs:u,eventDataSources:[d],jimuMapView:h,hoverGraphic:D,onAttributesCopied:e=>{const t=To(R);e.forEach((e=>{e.layerId===f.serviceId.toString()&&e.fieldValuePair.forEach((e=>{const o=t.findIndex((t=>t.name===e.name));if(o>-1){let a=e.value;(0,r.isDate)(t[o].type)&&(a=new Date(e.value)),t[o].value=a}}))})),I(t)}}))),(0,t.jsx)("div",{className:"h-100"},A&&(0,t.jsx)(a.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){O(!1)},open:A,text:T,type:"warning",closable:!0,withIcon:!0}),(0,t.jsx)(r.AttributeTable,{tableIndex:0,eventDS:d,eventLayer:f,fieldInfos:R,collapable:!1,useAlias:!(0,r.isDefined)(f)||f.useFieldAlias,onUpdateItem:(e,t,o)=>{const a=To(R);a[o].value=e,a[o].error=t,I(a),F(P(a))},onUpdateAll:E,onFieldGrpUpdated:(e,t)=>{Fo=e,Fo&&0!==(null==Fo?void 0:Fo.length)||O(!1)},isReset:p})),y&&(0,t.jsx)("div",{className:"add-line-event-edit-attributes__toast-container w-100 p-3"},(0,t.jsx)(a.Alert,{className:"add-line-event-edit-attributes__toast w-100",type:N,text:T,closable:!0,withIcon:!0,open:y,onClose:()=>{S(!1)}}))),(0,t.jsx)("div",{className:"add-line-attributes-footer w-100"},(0,t.jsx)("div",{className:"add-line=event-edit-attributes__action w-100 d-flex"},(0,t.jsx)("div",{className:"mt-auto mr-auto"},(0,t.jsx)(a.Button,{"aria-label":i("backLabel"),size:"sm",type:"secondary",onClick:()=>{C(!1)}},i("backLabel"))),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(a.Button,{type:"primary",className:"active","aria-label":i("saveLabel"),size:"sm",disabled:A||x,onClick:()=>{if(b){const e=Object.assign(Object.assign({},w),{lockAction:r.LockAction.QueryAndAcquire});j(e)}else G()}},i("saveLabel"))))))}function Oo(e){const{network:o,event:a,dataSourcesReady:n,onCreateNetworkDs:i,onCreateEventDs:s}=e,[r,l]=t.React.useState(null!=o?o:null),[u,c]=t.React.useState(null!=a?a:null),[d,f]=t.React.useState(!1),[m,v]=t.React.useState(!1);t.React.useEffect((()=>{o&&l(o)}),[o]),t.React.useEffect((()=>{a&&c(a)}),[a]),t.React.useEffect((()=>{n(d&&m)}),[n,m,d]);const p=t.React.useCallback((e=>{i(e)}),[i]),h=t.React.useCallback((e=>{s(e)}),[s]),D=t.React.useCallback((e=>{if(e){const{status:o,instanceStatus:a}=e;a===t.DataSourceStatus.NotCreated||a===t.DataSourceStatus.CreateError||o===t.DataSourceStatus.LoadError||o===t.DataSourceStatus.NotReady?f(!1):f(!0)}}),[f]),b=t.React.useCallback((e=>{if(e){const{status:o,instanceStatus:a}=e;a===t.DataSourceStatus.NotCreated||a===t.DataSourceStatus.CreateError||o===t.DataSourceStatus.LoadError||o===t.DataSourceStatus.NotReady?v(!1):v(!0)}}),[v]),g=t.React.useCallback((()=>{f(!1)}),[f]),R=t.React.useCallback((()=>{v(!1)}),[v]);return(0,t.jsx)("div",null,r&&(0,t.jsx)(t.DataSourceComponent,{useDataSource:r.useDataSource,onDataSourceInfoChange:D,onCreateDataSourceFailed:g,onDataSourceCreated:p}),u&&(0,t.jsx)(t.DataSourceComponent,{useDataSource:u.useDataSource,onDataSourceInfoChange:b,onCreateDataSourceFailed:R,onDataSourceCreated:h}))}const Lo=function(){return k.Date.now()};var Po=/\s/;const Eo=function(e){for(var t=e.length;t--&&Po.test(e.charAt(t)););return t};var Co=/^\s+/;const _o=function(e){return e?e.slice(0,Eo(e)+1).replace(Co,""):e};const Go=function(e){return"symbol"==typeof e||Fe(e)&&"[object Symbol]"==C(e)};var Uo=/^[-+]0x[0-9a-f]+$/i,Vo=/^0b[01]+$/i,Bo=/^0o[0-7]+$/i,Wo=parseInt;const zo=function(e){if("number"==typeof e)return e;if(Go(e))return NaN;if(_(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=_o(e);var o=Vo.test(e);return o||Bo.test(e)?Wo(e.slice(2),o?2:8):Uo.test(e)?NaN:+e};var qo=Math.max,Qo=Math.min;const Ho=function(e,t,o){var a,n,i,s,r,l,u=0,c=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var o=a,i=n;return a=n=void 0,u=t,s=e.apply(i,o)}function v(e){var o=e-l;return void 0===l||o>=t||o<0||d&&e-u>=i}function p(){var e=Lo();if(v(e))return h(e);r=setTimeout(p,function(e){var o=t-(e-l);return d?Qo(o,i-(e-u)):o}(e))}function h(e){return r=void 0,f&&a?m(e):(a=n=void 0,s)}function D(){var e=Lo(),o=v(e);if(a=arguments,n=this,l=e,o){if(void 0===r)return function(e){return u=e,r=setTimeout(p,t),c?m(e):s}(l);if(d)return clearTimeout(r),r=setTimeout(p,t),m(l)}return void 0===r&&(r=setTimeout(p,t)),s}return t=zo(t)||0,_(o)&&(c=!!o.leading,i=(d="maxWait"in o)?qo(zo(o.maxWait)||0,t):i,f="trailing"in o?!!o.trailing:f),D.cancel=function(){void 0!==r&&clearTimeout(r),u=0,a=l=n=r=void 0},D.flush=function(){return void 0===r?s:h(Lo())},D};var Zo=1/0;const $o=function(e){return e?(e=zo(e))===Zo||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Jo=function(e){var t=$o(e),o=t%1;return t==t?o?t-o:t:0};const Ko=function(e,t){for(var o=-1,a=null==e?0:e.length,n=Array(a);++o<a;)n[o]=t(e[o],o,e);return n};var Yo=w?w.prototype:void 0,Xo=Yo?Yo.toString:void 0;const ea=function e(t){if("string"==typeof t)return t;if(_e(t))return Ko(t,e)+"";if(Go(t))return Xo?Xo.call(t):"";var o=t+"";return"0"==o&&1/t==-1/0?"-0":o};const ta=function(e){return null==e?"":ea(e)};var oa=k.isFinite,aa=Math.min;const na=function(e){var t=Math[e];return function(e,o){if(e=zo(e),(o=null==o?0:aa(Jo(o),292))&&oa(e)){var a=(ta(e)+"e").split("e"),n=t(a[0]+"e"+(+a[1]+o));return+((a=(ta(n)+"e").split("e"))[0]+"e"+(+a[1]-o))}return t(e)}}("round");var ia=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};function sa(e){var n,i,s,l,u,c;const d=t.hooks.useTranslation(o),{intl:f,widgetId:m,network:v,event:p,networkDS:h,routeInfo:D,jimuMapView:b,hoverGraphic:g,clearPickedGraphic:R,clearHoverGraphic:I,onRouteInfoUpdated:y,onRouteMeasurePickerInfoUpdated:S,routeMeasurePickerInfo:N,isFrom:M,canSpanRoutes:T,reset:k,revalidateRouteFromDataAction:w,onResetDataAction:j,hideMeasures:x,useStartMeasure:F,useEndMeasure:A}=e,[O,L]=t.React.useState(!1),[P,E]=t.React.useState(!1),[C,_]=t.React.useState(!1),[G,U]=t.React.useState(!1),[V,B]=t.React.useState(""),[W,z]=t.React.useState(""),[q,Q]=t.React.useState(!1),[H,Z]=t.React.useState([]),[$,J]=t.React.useState(),K=t.React.useRef(null),Y=t.React.useRef((e=>{})),X=t.React.useRef(null),ee=t.React.useRef(null),te=t.React.useRef(null),oe=t.React.useRef(null),ae=t.React.useRef(null),ne=t.React.useRef(!1),ie=t.React.useRef(!1),[se,re]=t.React.useState(null),[le,ue]=t.React.useState(null),[ce,de]=t.React.useState(!1),[fe,me]=t.React.useState([]);t.React.useEffect((()=>{Y.current=Ho(pe,400)}),[]),t.React.useEffect((()=>{if(w){const e=M?v.useRouteName?D.routeName:D.routeId:v.useRouteName?D.toRouteName:D.toRouteId;he(e),M?((()=>{ia(this,void 0,void 0,(function*(){yield ge(e,!0),isNaN(D.selectedMeasure)||B(D.selectedMeasure.toString())}))})(),D.selectedToMeasure||j()):(()=>{ia(this,void 0,void 0,(function*(){yield ge(e,!0),D.selectedToMeasure&&z(D.selectedToMeasure.toString()),j()}))})()}}),[w]),t.React.useEffect((()=>{k&&(B(""),z(""),ae.current=null,Ne())}),[k]),t.React.useEffect((()=>{M?v&&v.useRouteName?re(D.routeName):v&&!v.useRouteName&&re(D.routeId):v&&v.useRouteName?ue(D.toRouteName):v&&!v.useRouteName&&ue(D.toRouteId)}),[v,D.routeId,D.toRouteId,D.routeName,D.toRouteName]);const ve=t.React.useCallback(((e,t=!1)=>{y(e,t),ae.current=null}),[y]);t.React.useEffect((()=>{M&&(isNaN(D.selectedMeasure)?B(""):B(D.selectedMeasure.toString()),Ne(!1,!0))}),[v,D.selectedMeasure]),t.React.useEffect((()=>{M&&F&&Ne(!1,!0)}),[D.selectedPoint]),t.React.useEffect((()=>{M||A&&Ne(!1,!0)}),[D.selectedToPoint]),t.React.useEffect((()=>{M||(isNaN(D.selectedToMeasure)?z(""):z(D.selectedToMeasure.toString()),Ne(!1,!0))}),[v,D.selectedToMeasure]),t.React.useEffect((()=>{if(!M&&T&&D.validRoute&&(v.useRouteName?ue(D.toRouteName):ue(D.toRouteId)),!M&&!T&&D.validRoute&&(v.useRouteName?ue(D.routeName):ue(D.routeId),D.routeId!==D.toRouteId||D.routeName!==D.toRouteName)){const e=Object.assign(Object.assign({},D),{toRouteId:D.routeId,toRouteName:D.routeName});y(e)}M&&Ne()}),[D.routeName,D.routeId]),t.React.useEffect((()=>{M||Ne()}),[D.toRouteName,D.toRouteId]),t.React.useEffect((()=>{D.routeName&&D.routeId&&D.routeName.length<1&&D.routeId.length<1&&he("")}),[p,v]);const pe=t.hooks.useEventCallback((e=>{const t=v.useRouteName?v.routeNameFieldSchema.jimuName:v.routeIdFieldSchema.jimuName,o=(0,r.getSuggestions)(t,e,h);Promise.all([o]).then((e=>ia(this,void 0,void 0,(function*(){const o=null==e?void 0:e[0];if(!M&&D.lineId){const e=[];o.forEach((t=>{t.suggestionItem.forEach((t=>{e.push(t.suggestion)}))}));const a=[],n=(0,r.queryRoutesByLineId)(e,D.lineId,v,h);yield Promise.all([n]).then((e=>{const n=null==e?void 0:e[0];if((0,r.isDefined)(n)){for(let e=0;e<n.features.length;e++){const o=n.features[e].attributes[t];a.push(o)}a.length>0?o.forEach((e=>{const t=e.suggestionItem.filter((e=>a.includes(e.suggestion)));e.suggestionItem=t})):o.forEach((e=>{e.suggestionItem=[]}))}})).catch((e=>{o.forEach((e=>{e.suggestionItem=[]}))}))}o&&me(o),X.current&&de(!0)}))))})),he=e=>{M?re(e):ue(e),X.current=e,ae.current=e},De=()=>{(0,t.focusElementInKeyboardMode)(ee.current),be(!0,!1)},be=(e=!1,t=!0)=>{e||(ie.current=!1)};t.React.useEffect((()=>{(0,r.isDefined)(v)&&((0,r.isDefined)(w)||(re(""),ue("")),B(""),z(""),L(!1),E(!1),_(!1),U(!1),R(),I())}),[v]),t.React.useEffect((()=>{(0,r.isDefined)(b)&&b.view&&J(b.view.popupEnabled)}),[b]);const ge=(e,t=!1)=>new Promise((o=>{setTimeout((()=>{ae.current&&!t&&(e=ae.current),ae.current=null;const a=[],n=(0,r.isDefined)(D.lineId)?M?"":D.lineId:"",i=(0,r.queryRouteIdOrName)(e,v,h,T,M,n).then((o=>ia(this,void 0,void 0,(function*(){if((0,r.isDefined)(o)){if(!t&&(k||M&&(e===D.routeId||e===D.routeName)||!M&&(e===D.toRouteId||e===D.toRouteName)))return{valid:!0};if(yield Promise.all(o.features.map((t=>ia(this,void 0,void 0,(function*(){const o=M?yield Re(t,e):yield Ie(t,e);a.push(o)}))))),a.length>1&&!t)Me(a);else if(a.length>0){let o=a[0];if(t&&(o=a.find((e=>e.fromDate.getTime()===D.fromDate.getTime()))),M){if(V.length>0||t&&!isNaN(D.selectedMeasure))return ye(o,t).then((t=>(T||e===D.toRouteId||e===D.toRouteName||F||(t.selectedToMeasure=NaN),y(t,!0),{valid:!0})));T||e===D.toRouteId||e===D.toRouteName||A||(o.selectedToMeasure=NaN),y(o,!0)}else{if(W.length>0||t&&!isNaN(D.selectedToMeasure))return Se(o,t).then((e=>(y(e,!0),{valid:!0})));y(o,!0)}}return{valid:!0}}})))).catch((t=>{if(k)return he(""),{valid:!0};{const o=T?D.toRouteId:"",a=T||""===e?NaN:D.selectedToMeasure,n=isNaN(a)?null:D.selectedToPoint,i=T?D.selectedToPolyline:null;if((0,r.isDefined)(v)&&v.useRouteName)if(M){const t=T?D.toRouteName:""===e?"":D.toRouteName,s=Object.assign(Object.assign({},D),{routeName:e,toRouteName:t,routeId:"",toRouteId:o,selectedMeasure:NaN,selectedToMeasure:a,selectedPolyline:null,selectedToPolyline:i,selectedPoint:null,selectedToPoint:n,validRoute:!1});y(s)}else{const t=Object.assign(Object.assign({},D),{toRouteName:e,toRouteId:"",selectedToPolyline:null,selectedToMeasure:NaN,selectedToPoint:null,validToRoute:!1});y(t)}else if(M){const t=Object.assign(Object.assign({},D),{routeId:e,toRouteId:o,selectedMeasure:NaN,selectedToMeasure:a,selectedPolyline:null,selectedToPolyline:i,selectedPoint:null,selectedToPoint:n,validRoute:!1});y(t)}else{const t=Object.assign(Object.assign({},D),{toRouteId:e,selectedToMeasure:NaN,selectedToPolyline:null,selectedToPoint:null,validToRoute:!1});y(t)}if(e.length>0){if("Error: routeNotOnSameLine"===t.message)return{valid:!1,msg:d("routeNotOnSameLine")};return{valid:!1,msg:"Route '"+e.replace(/ /g,"\xa0")+"' not found"}}return he(""),{valid:!0}}}));o(i)}),200)})),Re=(e,t)=>ia(this,void 0,void 0,(function*(){const t=(0,r.getNetworkOutFields)(v),o=v.useRouteName?e.attributes[t.routeNameFieldName]:"",a=e.attributes[t.routeIdFieldName],n=e.attributes[t.fromDateFieldName],i=e.attributes[t.toDateFieldName],s=e.geometry,l=(0,r.getRouteFromEndMeasures)(e.geometry),u=e.attributes[t.lineIdFieldName],c=e.attributes[t.lineOrderFieldName],d=e.attributes[t.lineNameFieldName];let f=w?D.fromDate:new Date(Date.now());(0,r.isDefined)(f)&&(0,r.isDefined)(i)&&f>i&&(f=(0,r.getDateWithTZOffset)(n,h));let m=w?D.toDate:new Date(Date.now());(0,r.isDefined)(m)&&(0,r.isDefined)(i)&&m>i&&(m=(0,r.getDateWithTZOffset)(i,h)),(0,r.isDefined)(i)||w||(m=null);let p=!1;return T&&!D.validToRoute||u&&D.toLineId!==u?p=!0:T||(p=!0),yield(0,r.QueryRouteMeasures)(h,v,l,n,a).then((e=>{const t=Math.min(...e),b=Math.max(...e),g=Object.assign(Object.assign({},D),{routeId:a,toRouteId:p?a:D.toRouteId,routeName:o,toRouteName:p?o:D.toRouteName,routeLineOrder:c,toRouteLineOrder:p?c:D.toRouteLineOrder,lineId:u,toLineId:u,lineName:d,toLineName:d,fromMeasure:na(t,v.measurePrecision),toMeasure:na(b,v.measurePrecision),toRouteFromMeasure:p?na(t,v.measurePrecision):D.toRouteFromMeasure,toRouteToMeasure:p?na(b,v.measurePrecision):D.toRouteToMeasure,selectedToMeasure:p?NaN:D.selectedToMeasure,fromDate:(0,r.isDefined)(n)?(0,r.getDateWithTZOffset)(n,h):null,toDate:(0,r.isDefined)(i)?(0,r.getDateWithTZOffset)(i,h):null,toRouteFromDate:p?(0,r.isDefined)(n)?(0,r.getDateWithTZOffset)(n,h):null:D.toRouteFromDate,toRouteToDate:p?(0,r.isDefined)(i)?(0,r.getDateWithTZOffset)(i,h):null:D.toRouteToDate,selectedToPoint:p?null:D.selectedToPoint,selectedPolyline:s,selectedToPolyline:p?s:D.selectedToPolyline,selectedFromDate:f,selectedToDate:m,validRoute:!0,validToRoute:!0});return F&&(g.selectedMeasure=na(t,v.measurePrecision),g.selectedPoint=l[0],B(na(t,v.measurePrecision).toString())),(!M&&A||D.lineId!==u&&A||!D.lineId&&!u&&A)&&(g.selectedToMeasure=na(b,v.measurePrecision),g.selectedToPoint=l[1],z(na(b,v.measurePrecision).toString())),g}))})),Ie=(e,t)=>ia(this,void 0,void 0,(function*(){const t=(0,r.getNetworkOutFields)(v),o=v.useRouteName?e.attributes[t.routeNameFieldName]:"",a=e.attributes[t.fromDateFieldName],n=e.attributes[t.routeIdFieldName],i=e.attributes[t.toDateFieldName],s=e.geometry,l=(0,r.getRouteFromEndMeasures)(e.geometry),u=e.attributes[t.lineOrderFieldName];let c=w?D.fromDate:new Date(Date.now());(0,r.isDefined)(i)&&(0,r.isDefined)(c)&&c>i?c=(0,r.getDateWithTZOffset)(a,h):(0,r.isDefined)(c)||c.setHours(0,0,0,0);let d=w?D.toDate:new Date(Date.now());return(0,r.isDefined)(i)&&(0,r.isDefined)(d)&&d>i?d=(0,r.getDateWithTZOffset)(i,h):(0,r.isDefined)(d)&&d.setHours(0,0,0,0),(0,r.isDefined)(i)||w||(d=null),yield(0,r.QueryRouteMeasures)(h,v,l,a,n).then((e=>{const t=Math.min(...e),c=Math.max(...e),d=Object.assign(Object.assign({},D),{toRouteName:T?o:D.routeName,toRouteId:T?n:D.routeId,toRouteFromDate:T?(0,r.isDefined)(a)?(0,r.getDateWithTZOffset)(a,h):null:D.toRouteFromDate,toRouteToDate:T?(0,r.isDefined)(i)?(0,r.getDateWithTZOffset)(i,h):null:D.toRouteToDate,selectedToPolyline:T?s:D.selectedToPolyline,toRouteFromMeasure:T?na(t,v.measurePrecision):D.toRouteFromMeasure,toRouteToMeasure:T?na(c,v.measurePrecision):D.toRouteToMeasure,toRouteLineOrder:T?u:D.toRouteLineOrder,validToRoute:!0});return A&&(d.selectedToMeasure=na(c,v.measurePrecision),d.selectedToPoint=l[1],z(na(c,v.measurePrecision).toString())),d}))})),ye=(e,t)=>(0,r.QueryMeasureOnRoute)(h,v,e.routeId,e.fromDate,t||F?e.selectedMeasure.toString():V).then((o=>{if(o){return Object.assign(Object.assign({},e),{selectedPoint:o,selectedMeasure:parseFloat(t||F?e.selectedMeasure.toString():V)})}return Object.assign(Object.assign({},e),{selectedPoint:null,selectedMeasure:NaN})})),Se=(e,t)=>(0,r.QueryMeasureOnRoute)(h,v,e.toRouteId,e.toRouteFromDate,t||A?e.selectedToMeasure.toString():W).then((o=>{if(o){return Object.assign(Object.assign({},e),{selectedToPoint:o,selectedToMeasure:parseFloat(t||A?e.selectedToMeasure.toString():W)})}return Object.assign(Object.assign({},e),{selectedToMeasure:NaN})}));t.React.useEffect((()=>{if(M&&T&&D.toRouteId.length<1&&D.toRouteName.length<1&&D.validRoute){const e=Object.assign(Object.assign({},D),{toRouteId:D.routeId,toRouteName:D.routeName});y(e)}M||T||v&&!v.useRouteName&&!D.routeId.length&&D.validToRoute&&ue(D.routeId)}),[D.routeId,D.routeName]),t.React.useEffect((()=>{if(T&&!w&&!A)if(M){const e=Object.assign(Object.assign({},D),{toRouteId:D.routeId,toRouteName:D.routeName,selectedToMeasure:NaN,selectedToPoint:null});y(e)}else R()}),[D.lineId]);const Ne=(e=!0,o=!0)=>{w||setTimeout((()=>{if(k&&(ee.current.disabled=!1,x||(te.current.disabled=!1)),e&&(ee.current.select(),(0,t.focusElementInKeyboardMode)(ee.current,!0),ee.current.blur()),o&&!x){const e=te.current.disabled;te.current.disabled=!1,(0,t.focusElementInKeyboardMode)(te.current,!0),te.current.blur(),te.current.disabled=e}k&&(ee.current.disabled=!M,x||(te.current.disabled=!0))}),600)},Me=t.React.useCallback((e=>{e.length&&(Q(!0),Z(e))}),[]),Te=t.React.useCallback((e=>{(0,r.isDefined)(e)&&(e.selectedFromDate=e.fromDate,e.selectedToDate=e.toDate,y(e,!0),Ne()),Q(!1)}),[y]),ke=t.React.useCallback((()=>{Q(!1)}),[]);return(0,t.jsx)("div",{className:"route-and-measure-form d-flex w-100 pt-1 px-3"},v&&(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)(a.Label,{size:"sm",className:"w-100",style:{padding:0,paddingTop:5,width:100,alignItems:"center",fontWeight:500}},M?v.useRouteName?d("fromRouteNameLabel"):d("fromRouteIdLabel"):v.useRouteName?d("toRouteNameLabel"):d("toRouteIdLabel")),(0,t.jsx)("div",{ref:K,className:"d-flex w-100",style:{paddingBottom:3}},(0,t.jsx)(a.TextInput,{type:"text",className:"w-100",size:"sm",allowClear:!0,disabled:!(0,r.isDefined)(h)||!M&&(!T||D.routeId.length<1&&D.routeName.length<1&&D.toRouteId.length<1&&D.toRouteName.length<1),onBlur:()=>{oe.current=setTimeout((()=>{ne.current||de(!1),ie.current||be(!1)}),200)},value:M?se||"":le||"",ref:ee,onChange:e=>{var t;ae.current=null;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,a=(null==o?void 0:o.length)>2;if(he(o),!a)return de(!1),!1;Y.current(o)},checkValidityOnAccept:ge}),(M?se:le)&&(0,t.jsx)(r.Intellisense,{isOpen:(ce||(ne.current=!1),ce),reference:K,searchText:M?se:le,searchSuggestion:fe,onRecordItemClick:(e,t)=>{if(t)return De(),!1;ae.current=e,he(e)},id:m,searchInputRef:ee}),(0,t.jsx)(r.RoutePicker,{type:"route-measure",active:M?N.fromRoutePickerActive:N.toRoutePickerActive,networkDs:h,network:v,routeInfo:D,disabled:!(0,r.isDefined)(h)||!M&&(!T||(null===(n=D.routeId)||void 0===n?void 0:n.length)<1&&(null===(i=D.routeName)||void 0===i?void 0:i.length)<1),jimuMapView:b,symbolColor:null,hoverGraphic:g,onActiveChange:M?()=>{const e=!N.fromRoutePickerActive;if(L(e),e){_(!1);const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!0,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),I(),setTimeout((()=>{b.view.popupEnabled=$&&!P&&!C&&!G}),800)}}:()=>{const e=!N.toRoutePickerActive;if(E(e),e){U(!1);const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!0,toMeasurePickerActive:!1});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),I(),setTimeout((()=>{b.view.popupEnabled=$&&!O&&!C&&!G}),800)}},onRouteInfoUpdated:ve,onMultiRouteSelect:Me,isFrom:M,canSpanRoutes:T,useRouteStartMeasure:F,useRouteEndMeasure:A})),!x&&(0,t.jsx)("div",null,(0,t.jsx)(a.Label,{size:"sm",className:"w-100",style:{padding:0,paddingTop:5,width:100,alignItems:"center",fontWeight:500}},d(M?"fromMeasureWithUnits":"toMeasureWithUnits",{units:(0,r.GetUnits)(v.unitsOfMeasure,f)})),(0,t.jsx)("div",{className:"d-flex w-100"},(0,t.jsx)(a.TextInput,{ref:te,"aria-label":d(M?"fromMeasureWithUnits":"toMeasureWithUnits",{units:(0,r.GetUnits)(v.unitsOfMeasure,f)}),className:"w-100",size:"sm",value:M?V:W,disabled:!(0,r.isDefined)(h)||(M?F:A)||(M?D.routeId.length<1&&(null===(s=D.routeName)||void 0===s?void 0:s.length)<1:D.toRouteId.length<1&&(null===(l=D.toRouteName)||void 0===l?void 0:l.length)<1),onChange:e=>{var t;t=e.target.value,M?B(t):z(t)},checkValidityOnAccept:e=>ia(this,void 0,void 0,(function*(){let t=NaN;if(""===e){t=NaN;const e=Object.assign({},D);return M?(e.selectedMeasure=NaN,e.selectedPoint=null):(e.selectedToMeasure=NaN,e.selectedToPoint=null),y(e),{valid:!0}}if(t=isNaN(Number(e))?(0,r.convertStationToNumber)(e):Number(e),t=na(t,v.measurePrecision),isNaN(t)){R();const e=Object.assign({},D);return M?(e.selectedMeasure=NaN,e.selectedPoint=null,B("")):(e.selectedToMeasure=NaN,e.selectedToPoint=null,z("")),y(e),{valid:!0}}{const e=!T&&(0,r.isDefined)(D.selectedPolyline)||T&&D.routeId===D.toRouteId&&(0,r.isDefined)(D.selectedPolyline)||T&&D.routeId!==D.toRouteId&&(0,r.isDefined)(D.selectedToPolyline);if(M&&(0,r.isDefined)(D.selectedPolyline)||!M&&e){if(M){if(t<D.fromMeasure)return{valid:!1,msg:d("measureLessError")};if(t>D.toMeasure)return{valid:!1,msg:d("measureGreaterError")}}else{const e=T?D.routeId===D.toRouteId?D.fromMeasure:D.toRouteFromMeasure:D.fromMeasure,o=T?D.routeId===D.toRouteId?D.toMeasure:D.toRouteToMeasure:D.toMeasure;if(t<e)return{valid:!1,msg:d("measureLessError")};if(t>o)return{valid:!1,msg:d("measureGreaterError")}}let e=Object.assign({},D);M?e.routeId.length?yield(0,r.QueryMeasureOnRoute)(h,v,e.routeId,e.fromDate,t.toString()).then((o=>{(0,r.isDefined)(o)&&(!(0,r.isDefined)(e.selectedPoint)||o.x!==e.selectedPoint.x&&o.y!==e.selectedPoint.y)&&(e=Object.assign(Object.assign({},e),{selectedPoint:o,selectedMeasure:parseFloat(t.toString())}),y(e))})):y(e):e.toRouteId.length?yield(0,r.QueryMeasureOnRoute)(h,v,e.toRouteId,e.toRouteFromDate,t.toString()).then((o=>{(!(0,r.isDefined)(e.selectedToPoint)||o.x!==e.selectedToPoint.x&&o.y!==e.selectedToPoint.y)&&(e=Object.assign(Object.assign({},e),{selectedToPoint:o,selectedToMeasure:parseFloat(t.toString())}),y(e))})):y(e)}return{valid:!0}}}))}),(0,t.jsx)(r.RoutePicker,{type:"measure",active:M?N.fromMeasurePickerActive:N.toMeasurePickerActive,networkDs:h,network:v,routeInfo:D,disabled:!(0,r.isDefined)(h)||(M?F:A)||(M?D.routeId.length<1&&(null===(u=D.routeName)||void 0===u?void 0:u.length)<1:D.toRouteId.length<1&&(null===(c=D.toRouteName)||void 0===c?void 0:c.length)<1),jimuMapView:b,symbolColor:null,hoverGraphic:g,onActiveChange:M?()=>{const e=!N.fromMeasurePickerActive;if(_(e),e){L(!1);const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!0,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),I(),setTimeout((()=>{b.view.popupEnabled=$&&!O&&!P&&!G}),800)}}:()=>{const e=!N.toMeasurePickerActive;if(U(e),e){E(!1);const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!0});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),I(),setTimeout((()=>{b.view.popupEnabled=$&&!O&&!P&&!C}),800)}},onRouteInfoUpdated:ve,onMultiRouteSelect:Me,isFrom:M,canSpanRoutes:T}))),(0,t.jsx)(r.RoutePickerPopup,{isOpen:q,routeInfos:H,useRouteName:v.useRouteName,onRouteSelect:Te,onRouteSelectCancel:ke,isFrom:M,measurePrecision:v.measurePrecision,jimuMapView:b,graphicLayer:g})))}function ra(e){const{intl:o,widgetId:a,network:n,event:i,networkDS:s,method:l,jimuMapView:u,hoverGraphic:c,pickedGraphic:d,isFrom:f,routeInfo:m,routeMeasurePickerInfo:v,reset:p,revalidateRouteFromDataAction:h,canSpanRoutes:D,onResetDataAction:b,useStartMeasure:g,useEndMeasure:R,hideMeasures:I,onUpdateRouteInfo:y,onUpdateRouteMeasurePickerInfo:S}=e;return(0,t.jsx)("div",{className:"add-line-event-route-selection-form d-flex",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-line-event-route-selection-form {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
      fontWeight: 500;
    }
  `},(0,t.jsx)("div",{className:"d-flex w-100"},l===r.SearchMethod.Measure&&(0,t.jsx)(sa,{intl:o,widgetId:a,network:n,event:i,networkDS:s,routeInfo:m,jimuMapView:u,hoverGraphic:c,clearPickedGraphic:()=>{(0,r.isDefined)(d)&&d.removeAll()},clearHoverGraphic:()=>{(0,r.isDefined)(c)&&c.removeAll()},onRouteInfoUpdated:(e,t=!1)=>{y(e,t)},onRouteMeasurePickerInfoUpdated:e=>{S(e)},routeMeasurePickerInfo:v,isFrom:f,canSpanRoutes:D,reset:p,revalidateRouteFromDataAction:h,onResetDataAction:b,useStartMeasure:g,useEndMeasure:R,hideMeasures:I}),l===r.SearchMethod.Coordinate&&(0,t.jsx)("div",null),l===r.SearchMethod.LocationOffset&&(0,t.jsx)("div",null)))}var la=l(99037);function ua(e){const n=t.hooks.useTranslation(o),{intl:i,routeInfo:s,eventInfo:l,network:u,revalidateRouteFromDataAction:c,hideDates:d,useRouteStartEndDate:f,onUpdateRouteInfo:m}=e,[v,p]=t.React.useState(!1),[h,D]=t.React.useState(!1),[b,g]=t.React.useState("idle"),[R,I]=t.React.useState("idle"),[y,S]=t.React.useState(""),[N,M]=t.React.useState(""),[T,k]=t.React.useState(!1);t.React.useEffect((()=>{c&&(p(!1),D(!1),S(""),M(""))}),[c]),t.React.useEffect((()=>{p(f),D(f)}),[d]),t.React.useEffect((()=>{let e=!1;const t=Object.assign({},s);if(c||("idle"===b&&S(""),"idle"===R&&M("")),!(0,r.isDefined)(l)&&(0,r.isDefined)(null==u?void 0:u.lineIdFieldSchema)||(null==l?void 0:l.canSpanRoutes)||""===s.routeId&&""===s.routeName?k(!1):k(!0),""===s.routeId&&""===s.toRouteId&&""===s.routeName&&""===s.toRouteName)return p(!1),D(!1),g("idle"),I("idle"),S(""),void M("");(0,r.isDefined)(l)&&l.canSpanRoutes&&(p(!1),D(!1)),(0,r.isDefined)(s.selectedFromDate)&&v&&s.selectedFromDate!==s.fromDate&&(t.selectedFromDate=s.fromDate,e=!0),h&&s.selectedToDate!==s.toDate&&(t.selectedToDate=s.toDate,e=!0);w(s.selectedFromDate,!0)&&w(s.selectedToDate,!1),e&&m(t)}),[m,s,l,v,h]);const w=(e,t)=>{const a=function(e,t,a,n,i,s){const r={setFromDateStatus:"",setToDateStatus:"",setFromDateToolTip:"",setToDateToolTip:"",validDate:!0},l=e;return wo(l)?wo(null==a?void 0:a.fromDate)&&l<(null==a?void 0:a.fromDate)||wo(null==a?void 0:a.toRouteFromDate)&&l<(null==a?void 0:a.toRouteFromDate)?(t?r.setFromDateStatus="invalid":r.setToDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidFromDateBefore",defaultMessage:o.invalidFromDateBefore}):r.setToDateToolTip=s.formatMessage({id:"invalidToDateBefore",defaultMessage:o.invalidToDateBefore}),r.validDate=!1,r):wo(null==a?void 0:a.toDate)&&l>(null==a?void 0:a.toDate)||wo(null==a?void 0:a.toRouteToDate)&&l>(null==a?void 0:a.toRouteToDate)?(t?r.setFromDateStatus="invalid":r.setToDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidFromDateAfter",defaultMessage:o.invalidFromDateAfter}):r.setToDateToolTip=s.formatMessage({id:"invalidToDateAfter",defaultMessage:o.invalidToDateAfter}),r.validDate=!1,r):(wo(null==a?void 0:a.selectedToDate)&&t&&(l>(null==a?void 0:a.selectedToDate)&&(r.setFromDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidDatesOrder",defaultMessage:o.invalidDatesOrder}):r.setToDateToolTip=s.formatMessage({id:"invalidDatesOrder",defaultMessage:o.invalidDatesOrder}),r.validDate=!1),i===s.formatMessage({id:"invalidDatesOrder",defaultMessage:o.invalidDatesOrder})?l<(null==a?void 0:a.selectedToDate)&&(r.setToDateStatus="idle",r.setToDateToolTip=""):i===s.formatMessage({id:"invalidDatesSameDay",defaultMessage:o.invalidDatesSameDay})&&l!==(null==a?void 0:a.selectedFromDate)&&(r.setToDateStatus="idle",r.setToDateToolTip="")),wo(null==a?void 0:a.selectedToDate)&&t&&l.getTime()===(null==a?void 0:a.selectedToDate.getTime())&&(r.setFromDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidDatesSameDay",defaultMessage:o.invalidDatesSameDay}):r.setToDateToolTip=s.formatMessage({id:"invalidDatesSameDay",defaultMessage:o.invalidDatesSameDay}),r.validDate=!1),wo(null==a?void 0:a.selectedFromDate)&&(t||(l<(null==a?void 0:a.selectedFromDate)&&(r.setToDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidDatesOrder",defaultMessage:o.invalidDatesOrder}):r.setToDateToolTip=s.formatMessage({id:"invalidDatesOrder",defaultMessage:o.invalidDatesOrder}),r.validDate=!1),n===s.formatMessage({id:"invalidDatesOrder",defaultMessage:o.invalidDatesOrder})?l>(null==a?void 0:a.selectedFromDate)&&(r.setFromDateStatus="idle",r.setFromDateToolTip=""):n===s.formatMessage({id:"invalidDatesSameDay",defaultMessage:o.invalidDatesSameDay})&&l!==(null==a?void 0:a.selectedFromDate)&&(r.setFromDateStatus="idle",r.setFromDateToolTip=""))),wo(null==a?void 0:a.selectedFromDate)&&(t||l.getTime()!==(null==a?void 0:a.selectedFromDate.getTime())||(r.setToDateStatus="invalid",t?r.setFromDateToolTip=s.formatMessage({id:"invalidDatesSameDay",defaultMessage:o.invalidDatesSameDay}):r.setToDateToolTip=s.formatMessage({id:"invalidDatesSameDay",defaultMessage:o.invalidDatesSameDay}),r.validDate=!1)),r.validDate&&(t?r.setFromDateStatus="idle":r.setToDateStatus="idle",t?r.setFromDateToolTip="":r.setToDateToolTip=""),r):(t?r.setFromDateStatus="idle":r.setToDateStatus="idle",t?r.setFromDateToolTip="":r.setToDateToolTip="",r)}(e,t,s,y,N,i);return a&&(g(a.setFromDateStatus),I(a.setToDateStatus),S(a.setFromDateToolTip),M(a.setToDateToolTip)),a.validDate};return(0,t.jsx)("div",{className:"add-line=event-form-header px-3",css:(0,r.getCalciteBasicTheme)()},!d&&(0,t.jsx)("div",null,(0,t.jsx)(a.Label,{size:"sm",className:"mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},n("startDateLabel")),(0,t.jsx)(a.Tooltip,{title:y},(0,t.jsx)(la.CalciteInputDatePicker,{scale:"s",disabled:!!v||void 0,valueAsDate:s.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const o=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(w(o,!0),o){const e=Object.assign(Object.assign({},s),{selectedFromDate:o});m(e)}else{const e=Object.assign(Object.assign({},s),{selectedFromDate:null});m(e)}}},status:b,placement:"top",overlayPositioning:"fixed"})),(0,t.jsx)(a.Label,{size:"sm",className:"w-100 pt-2",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:v,className:"mr-2",disabled:!T,onChange:(e,t)=>{w(s.fromDate,!0),p(t)}}),n("useStartDateLabel")),(0,t.jsx)(a.Label,{size:"sm",className:"mb-0 pt-1",style:{width:100,alignItems:"center",fontWeight:500}},n("endDateLabel")),(0,t.jsx)(a.Tooltip,{title:N},(0,t.jsx)(la.CalciteInputDatePicker,{scale:"s",disabled:!!h||void 0,valueAsDate:s.selectedToDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const o=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(w(o,!1),o){const e=Object.assign(Object.assign({},s),{selectedToDate:o});m(e)}else{const e=Object.assign(Object.assign({},s),{selectedToDate:null});m(e)}}},status:R,placement:"top",overlayPositioning:"fixed"})),(0,t.jsx)(a.Label,{size:"sm",className:"w-100 pt-2",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:h,className:"mr-2",disabled:!T,onChange:(e,t)=>{w(s.toDate,!1),D(t)}}),n("useEndDateLabel"))))}const ca="#00FFFF",da="#008000",fa="#FF0000";function ma(e){const n=t.hooks.useTranslation(o),{eventInfo:i,onUpdateEventInfo:s}=e,[r,l]=t.React.useState(!1),[u,c]=t.React.useState(!1);t.React.useEffect((()=>{const e=Object.assign(Object.assign({},i),{mergeCoincident:!1,retireOverlapping:!1});s(e)}),[]),t.React.useEffect((()=>{l(i.mergeCoincident),c(i.retireOverlapping)}),[i]);return(0,t.jsx)("div",{className:"merge-retire-form px-3 h-100"},(0,t.jsx)("hr",{css:t.css`
            border: none;
            height: 1px;
            background-color: var(--ref-palette-neutral-400);
          `}),(0,t.jsx)(a.Label,{size:"sm",className:"w-100 pt-1",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:r,className:"mr-2",onChange:(e,t)=>{l(t);const o=Object.assign(Object.assign({},i),{mergeCoincident:t});s(o)}}),n("useMergeEventsLabel")),(0,t.jsx)(a.Label,{size:"sm",className:"w-100 pt-0",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:u,className:"mr-2",onChange:(e,t)=>{c(t);const o=Object.assign(Object.assign({},i),{retireOverlapping:t});s(o)}}),n("useRetireEventsLabel")))}function va(n){const i=t.hooks.useTranslation(o),{operationType:s,onOperationTypeChanged:r}=n,l=t.React.useMemo((()=>s),[s]);return(0,t.jsx)("div",{className:"add-line-event-operation-type"},(0,t.jsx)(a.Label,{size:"default",className:"pt-2 mb-0 px-3",style:{fontWeight:500,width:100,alignItems:"center"}},i("typeLabel")),(0,t.jsx)(a.Select,{"aria-label":i("typeLabel"),className:"w-100 px-3",size:"sm",value:l,onChange:e=>{r(e.target.value)}},(0,t.jsx)("option",{value:e.single}," ",i("singleOperation")),(0,t.jsx)("option",{value:e.multiple}," ",i("multipleOperation"))))}var pa=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};function ha(e){var n;const i=t.hooks.useTranslation(o),{intl:s,widgetId:l,lrsLayers:u,lineEventLayers:d,networkLayers:f,defaultEvent:m,defaultFromMethod:v,defaultToMethod:p,JimuMapView:h,operationType:D,hoverGraphic:b,pickedFromGraphic:g,pickedToGraphic:R,flashGraphic:I,hideEvent:y,hideNetwork:S,hideType:N,hideMethod:M,hideMeasures:T,hideDates:k,hideTitle:w,useRouteStartEndDate:j,conflictPreventionEnabled:x,networkDataSourceFromDataAction:F,routeInfoFromDataAction:A,onResetDataAction:O,onClearGraphics:L,onClearHoverGraphic:P,onOperationTypeChanged:E}=e,[C,_]=t.React.useState(0),[G,U]=t.React.useState(null),[V,B]=t.React.useState(null),[W,z]=t.React.useState(null),[q,Q]=t.React.useState(null),[H,Z]=t.React.useState(!1),[$,J]=t.React.useState(v),[K,Y]=t.React.useState(p),[X,ee]=t.React.useState(!1),[te,oe]=t.React.useState((0,r.getInitialRouteInfoState)()),[ae,ne]=t.React.useState(!1),[ie,se]=t.React.useState(!1),[re,le]=t.React.useState(!1),[ue,ce]=t.React.useState((0,r.getIntialLocksInfo)()),[de,fe]=t.React.useState(!x),me=t.React.useRef(null),[ve,pe]=t.React.useState(!1),he=t.React.useCallback((e=>{U(e)}),[U]),De=t.React.useCallback((e=>{B(e)}),[B]),be=t.React.useCallback((()=>{Z(!0)}),[Z]);t.React.useEffect((()=>{(0,t.focusElementInKeyboardMode)(me.current)}),[]),t.React.useEffect((()=>{if(re){const e=te;e.selectedToMeasure=e.toRouteToMeasure,ke(e)}if(ie){const e=te;e.selectedMeasure=e.fromMeasure,ke(e)}}),[te,ie,re]),t.React.useEffect((()=>{if(q){const e=u.find((e=>(0,r.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===q.eventInfo.parentNetworkId));e&&e.layerType===r.LrsLayerType.network&&z((0,t.Immutable)(e))}else{const e=u.find((e=>e.name===m.name));Q((0,t.Immutable)(e))}}),[m,u,q]),t.React.useEffect((()=>{!function(){pa(this,void 0,void 0,(function*(){if((0,r.isDefined)(A)&&(isNaN(A.fromMeasure)||isNaN(A.toRouteToMeasure))){const e=yield(0,r.getRouteMeasures)(A,W,G);(0,r.isDefined)(e.fromMeasure)&&(0,r.isDefined)(e.toRouteToMeasure)&&(A.fromMeasure=e.fromMeasure,A.toRouteToMeasure=e.toRouteToMeasure)}}))}()}),[F,A]),t.React.useEffect((()=>{const e=(0,r.isDefined)(F)||(0,r.isDefined)(A);e&&Me(),e&&setTimeout((()=>{if((0,r.isDefined)(F)&&F.id!==(null==W?void 0:W.id)){U(F);let e,t=F;(F.id.includes("output_point")||F.id.includes("output_line"))&&(t=F.getOriginDataSources()[0]),u.forEach((o=>{o.id===t.id&&(0,r.isDefined)(o.networkInfo)&&(e=o)}));const o=u.find((t=>t.eventInfo.parentNetworkId===e.networkInfo.lrsNetworkId&&!t.eventInfo.isPointEvent));(0,r.isDefined)(o)&&Re(o.name)}(0,r.isDefined)(A)&&(q.eventInfo.canSpanRoutes||A.routeId===A.toRouteId||(A.toRouteId=A.routeId,A.toRouteName=A.routeName,A.toRouteFromMeasure=A.fromMeasure,A.toRouteToMeasure=A.toMeasure,A.selectedToPolyline=A.selectedPolyline,A.toRouteFromDate=A.fromDate,A.toRouteToDate=A.toDate),ke(A),ne(!0))}),2e3)}),[F,A]),t.React.useEffect((()=>{x&&ge()}),[q,W]);const ge=(e=r.LockAction.None,t)=>{const o=Object.assign({},ue);(0,r.isDefined)(W)&&(o.networkId=[W.networkInfo.lrsNetworkId]),(0,r.isDefined)(q)&&(o.eventServiceLayerIds=[q.serviceId]),(0,r.isDefined)(t)&&(o.routeInfo=t),o.lockAction=e,ce(o)},Re=t.React.useCallback((e=>{const o=u.find((t=>t.name===e));if(o){const e=u.find((e=>(0,r.isDefined)(e.networkInfo)&&e.networkInfo.lrsNetworkId===o.eventInfo.parentNetworkId)),a=(0,r.getInitialRouteMeasurePickerInfoState)();if(Oe(a),e&&e.layerType===r.LrsLayerType.network&&q&&(q.eventInfo.parentNetworkId!==o.eventInfo.parentNetworkId||o.eventInfo.canSpanRoutes||q.eventInfo.canSpanRoutes&&!o.eventInfo.canSpanRoutes)){if(z((0,t.Immutable)(e)),!(0,r.isDefined)(A)){const e=(0,r.getInitialRouteInfoState)();ke(e)}T||(se(!1),le(!1))}pe(!0),Q((0,t.Immutable)(o)),P()}}),[u,q,W,A]),Ie=t.React.useCallback((e=>{const o=u.find((t=>t.name===e));(0,r.isDefined)(o)&&z((0,t.Immutable)(o))}),[u]),ye=t.React.useCallback((e=>{J(e)}),[]),Se=t.React.useCallback((e=>{Y(e)}),[]),Ne=t.React.useCallback((e=>{e&&Me(),_(0),me.current&&(0,t.focusElementInKeyboardMode)(me.current)}),[]);t.React.useEffect((()=>{se(T),le(T)}),[T]),t.React.useEffect((()=>{T&&(se(T),le(T))}),[]);const Me=()=>{L();const e=(0,r.getInitialRouteInfoState)();ke(e,!1,!0);const t=(0,r.getInitialEventInfoState)();xe(t);const o=(0,r.getInitialRouteMeasurePickerInfoState)();Oe(o),T||(se(!1),le(!1)),ee(!0),setTimeout((()=>{ee(!1)}),800)},Te=()=>{ne(!1),O()},ke=(e,t=!1,o=!1)=>{if(oe(e),Ee(e,t),x){const t=o?r.LockAction.Clear:r.LockAction.QueryAndAcquire;ge(t,e)}},[we,je]=t.React.useState((0,r.getInitialEventInfoState)()),xe=e=>{je(e)},[Fe,Ae]=t.React.useState((0,r.getInitialRouteMeasurePickerInfoState)()),Oe=e=>{Ae(e)};t.React.useEffect((()=>{(0,r.isDefined)(W)&&!(0,r.isDefined)(F)&&(oe((0,r.getInitialRouteInfoState)()),je((0,r.getInitialEventInfoState)()))}),[W]);const Le=()=>{(0,r.isDefined)(g)&&g.removeAll()},Pe=()=>{(0,r.isDefined)(R)&&R.removeAll()},Ee=(e,t)=>pa(this,void 0,void 0,(function*(){var o;(0,r.isDefined)(e.selectedPolyline)&&t&&(o=yield(0,r.getGeometryGraphic)(yield(0,r.getSimpleLineGraphic)(e.selectedPolyline),ca),(0,r.isDefined)(o)&&(I.add(o),setTimeout((()=>{I.removeAll(),setTimeout((()=>{I.add(o),setTimeout((()=>{I.removeAll(),setTimeout((()=>{I.add(o),setTimeout((()=>{I.removeAll()}),800)}),800)}),800)}),800)}),800))),(0,r.isDefined)(e.selectedPoint)?(e=>{(0,r.isDefined)(e)?(g.removeAll(),g.add(e)):Le()})(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedPoint),da)):Le(),(0,r.isDefined)(e.selectedToPoint)?(e=>{(0,r.isDefined)(e)?(R.removeAll(),R.add(e)):Pe()})(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedToPoint),fa)):Pe(),(0,r.isDefined)(h)&&h.clearSelectedFeatures()})),Ce=t.React.useCallback((()=>function(e,t,o,a){var n,i,s;if(!wo(e))return!1;let r=!0;if(r=r&&(null===(n=e.routeId)||void 0===n?void 0:n.length)>0,r=r&&(null===(i=e.toRouteId)||void 0===i?void 0:i.length)>0,!o)return!1;if(!wo(a)||!wo(a.networkInfo))return!1;const l=na(e.fromMeasure,a.networkInfo.measurePrecision),u=na(e.toMeasure,a.networkInfo.measurePrecision),c=na(e.selectedMeasure,a.networkInfo.measurePrecision),d=na(e.selectedToMeasure,a.networkInfo.measurePrecision);if(isNaN(l)||isNaN(c))return!1;if(r=r&&c>=l,null===(s=t.eventInfo)||void 0===s?void 0:s.canSpanRoutes){const t=na(e.toRouteFromMeasure,a.networkInfo.measurePrecision),o=na(e.toRouteToMeasure,a.networkInfo.measurePrecision);if(isNaN(t)||isNaN(d))return!1;if(r=r&&d>=t,isNaN(o)||isNaN(d))return!1;r=r&&d<=o}else{if(isNaN(u)||isNaN(d))return!1;r=r&&d<=u}return wo(e.selectedFromDate)&&!wo(e.selectedToDate)&&(wo(e.fromDate)&&(r=r&&e.selectedFromDate>=e.fromDate),wo(e.toDate)&&(r=r&&e.selectedFromDate<e.toDate)),!wo(e.selectedFromDate)&&wo(e.selectedToDate)&&(wo(e.fromDate)&&(r=r&&e.selectedToDate>=e.fromDate),wo(e.toDate)&&(r=r&&e.selectedToDate<e.toDate)),wo(e.selectedFromDate)&&wo(e.selectedToDate)&&(r=r&&e.selectedFromDate<e.selectedToDate,wo(e.fromDate)&&(r=r&&e.selectedFromDate>=e.fromDate),wo(e.toDate)&&(r=r&&e.selectedToDate<=e.toDate)),!(!wo(e.selectedFromDate)&&!wo(e.selectedToDate))&&!(e.routeId!==e.toRouteId&&wo(e.fromDate)&&wo(e.toRouteFromDate)&&(e.selectedFromDate<e.fromDate||wo(e.toDate)&&e.selectedFromDate>e.toDate||e.selectedFromDate<e.toRouteFromDate||wo(e.toRouteToDate)&&e.selectedFromDate>e.toRouteToDate))&&r}(te,q,de,W)),[te,de]),_e=t.React.useCallback(((e,t,o)=>{fe(!!o),ce(e)}),[]);return(0,t.jsx)("div",{className:"add-single-line-event h-100 d-flex",ref:me,tabIndex:-1,css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .add-single-line-event-form {
      height: 100%;
    }
    .add-single-line-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-single-line-event__actions {
      height: 100%;
    }
    .add-line-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,t.jsx)(Oo,{network:W,event:q,dataSourcesReady:be,onCreateNetworkDs:he,onCreateEventDs:De}),!w&&(0,t.jsx)(c,null),(0,t.jsx)("div",{className:(0,t.classNames)("add-single-line-event__content",{"d-none":1===C,[a.FOCUSABLE_CONTAINER_CLASS]:1!==C})},x&&(0,t.jsx)(r.LockManagerComponent,{intl:s,showAlert:!0,featureDS:G,lockInfo:ue,networkName:null===(n=null==W?void 0:W.networkInfo)||void 0===n?void 0:n.datasetName,conflictPreventionEnabled:x,onQueryAndAcquireComplete:_e,onMessageClear:()=>{ge(r.LockAction.None)}}),!N&&(0,t.jsx)(va,{operationType:D,onOperationTypeChanged:E}),!y&&(0,t.jsx)("div",null,(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",style:{fontWeight:500}},i("eventLayerLabel")),(0,t.jsx)(a.Select,{"aria-label":i("eventLayerLabel"),className:"w-100 px-3",size:"sm",value:q?q.name:"",disabled:1===d.length,onChange:e=>{Re(e.target.value)}},d.map(((e,o)=>(0,t.jsx)("options",{key:o,value:e},e))))),!S&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("networkLabel"),isDisabled:!0,defaultItem:(0,r.isDefined)(W)?W.name:"",listItems:f,onSelectionChanged:Ie}),!M&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("fromMethodLabel"),defaultItem:$,isDisabled:!0,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:ye}),(0,t.jsx)(ra,{intl:s,widgetId:l,network:W?W.networkInfo:null,event:q,dsReady:!H,networkDS:G,method:$,jimuMapView:h,hoverGraphic:b,pickedGraphic:g,isFrom:!0,routeInfo:te,routeMeasurePickerInfo:Fe,reset:X,hideMeasures:T,revalidateRouteFromDataAction:ae,onResetDataAction:Te,canSpanRoutes:!(!(0,r.isDefined)(q)||!(0,r.isDefined)(q.eventInfo))&&q.eventInfo.canSpanRoutes,onUpdateRouteInfo:ke,onUpdateRouteMeasurePickerInfo:Oe,useStartMeasure:ie,useEndMeasure:re}),!T&&(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:ie,className:"mr-2",disabled:!(0,r.isDefined)(te)||isNaN(te.fromMeasure),onChange:(e,t)=>{if(t){const e=te;e.selectedMeasure=e.fromMeasure,ke(e)}se(t)}}),i("useStartMeasureLabel")),!M&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("toMethodLabel"),defaultItem:K,isDisabled:!0,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:Se}),(0,t.jsx)(ra,{intl:s,widgetId:l,network:W?W.networkInfo:null,event:q,dsReady:!H,networkDS:G,method:K,jimuMapView:h,hoverGraphic:b,pickedGraphic:R,isFrom:!1,routeInfo:te,routeMeasurePickerInfo:Fe,reset:X,hideMeasures:T,revalidateRouteFromDataAction:ae,onResetDataAction:Te,canSpanRoutes:!(!(0,r.isDefined)(q)||!(0,r.isDefined)(q.eventInfo))&&q.eventInfo.canSpanRoutes,onUpdateRouteInfo:ke,onUpdateRouteMeasurePickerInfo:Oe,useStartMeasure:ie,useEndMeasure:re}),!T&&(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:re,className:"mr-2",disabled:!(0,r.isDefined)(null==te?void 0:te.toRouteToMeasure)||isNaN(te.toRouteToMeasure),onChange:(e,t)=>{if(t){const e=te;e.selectedToMeasure=e.toRouteToMeasure,ke(e)}le(t)}}),i("useEndMeasureLabel")),(0,t.jsx)(ua,{intl:s,hideDates:k,useRouteStartEndDate:j,routeInfo:te,eventInfo:q?q.eventInfo:null,network:W?W.networkInfo:null,revalidateRouteFromDataAction:ae,onUpdateRouteInfo:ke}),(0,t.jsx)(ma,{eventInfo:we,onUpdateEventInfo:xe})),(0,t.jsx)("div",{className:(0,t.classNames)("add-line-footer w-100",{"d-none":1===C,[a.FOCUSABLE_CONTAINER_CLASS]:1!==C})},(0,t.jsx)(a.Label,{size:"sm",className:"mt-auto mr-auto",style:{fontWeight:500,width:100,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--primary-500"},onClick:Me},i("resetForm")),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(a.Button,{type:"primary",className:"active","aria-label":i("nextLabel"),size:"sm",disabled:!Ce()&&H,onClick:()=>{pe(!1),_(1)}},i("nextLabel")))),(0,t.jsx)("div",{className:(0,t.classNames)("add-single-line-event__content",{"d-none":1!==C,[a.FOCUSABLE_CONTAINER_CLASS]:1===C})},(0,t.jsx)(Ao,{intl:s,widgetId:l,networkDS:G,network:W,eventDS:V,eventLayer:q,routeInfo:te,eventInfo:we,reset:X||ve,jimuMapView:h,hoverGraphic:b,conflictPreventionEnabled:x,onNavBack:Ne})))}var Da=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};let ba=[];function ga(e){const n=t.hooks.useTranslation(o),{intl:i,widgetId:s,networkDS:l,network:u,eventLayers:c,routeInfo:d,eventInfo:f,attributeSet:m,reset:v,isReady:p,jimuMapView:h,hoverGraphic:D,conflictPreventionEnabled:b,onNavBack:g}=e,[R,I]=t.React.useState([]),[y,S]=t.React.useState([]),[N,M]=t.React.useState([]),[T,k]=t.React.useState([]),[w,j]=t.React.useState(!1),[x,F]=t.React.useState(),[A,O]=t.React.useState(""),[L,P]=t.React.useState(!1),[E,C]=t.React.useState(!1),[_,G]=t.React.useState(!1),[U,V]=t.React.useState((0,r.getIntialLocksInfo)()),[B,W]=t.React.useState(!0),[z,q]=t.React.useState(!1);t.React.useEffect((()=>{v&&H(c)}),[v]),t.React.useEffect((()=>{(0,r.isDefined)(m)&&(0,r.isDefined)(c)&&p&&H(c)}),[m,c,p]),t.React.useEffect((()=>{Q()}),[l,u,c,d]);const Q=(e=r.LockAction.None,t,o)=>{if(b){const a=Object.assign({},U);if((0,r.isDefined)(u)&&(a.networkId=[u.lrsNetworkId]),(0,r.isDefined)(c)){const e=(0,r.isDefined)(o)?o:T,t=[];N.forEach(((o,a)=>{e[a]&&t.push(o.serviceId)})),a.eventServiceLayerIds=t}(0,r.isDefined)(t)&&(a.routeInfo=t),a.lockAction=e,V(a)}},H=e=>{if((0,r.isDefined)(e)){const t=[],o=[],a=[],n=[];e.forEach((e=>{const i=Z(e),s=$(e,i);t.push(i),o.push(s),a.push(e.asMutable({deep:!0})),n.push(!0)})),I(t),S(o),M(a),G(0===a.length),k(n),Q(r.LockAction.None,d,n),W(!0)}},Z=e=>{if((0,r.isDefined)(e)&&(0,r.isDefined)(e.useDataSource)){const o=t.DataSourceManager.getInstance().getDataSource(e.useDataSource.dataSourceId);if((0,r.isDefined)(o))return o}},$=(e,t)=>{const o=[];if((0,r.isDefined)(t)){const a=t,n=(null==a?void 0:a.layer).fields,i=m.layers.find((t=>t.layerId===e.serviceId));(0,r.isDefined)(i)&&i.fields.forEach((e=>{const t=n.find((t=>t.name===e.name));if(t){let a;""!==e.value&&(a=(0,r.isDate)(t.type)?(0,r.isDefined)(e.value)?new Date(e.value):null:(0,r.isNumber)(t.type)?Number(e.value):e.value);const n={index:o.length,name:t.name,alias:t.alias,type:t.type,hasDomain:(0,r.isDefined)(t.domain),value:a,error:"",nullable:t.nullable,default:"number"==typeof a?Number(a).toString():a,length:t.length,editable:t.editable};o.push(n)}}))}return o},J=e=>e.findIndex((e=>e.error.length>0))>-1,K=(e,t,o,a)=>{const n=To(y),i=To(n[a]);i[o].value=e,i[o].error=t,n[a]=i,S(n),P(J(n[a]))},Y=(e,t)=>{const o=To(y);o[t]=e,S(o),P(J(e))},X=(e,t)=>{var o;const a=To(ba);a[t]=e,ba=a,ba[t]&&0!==(null===(o=ba[t])||void 0===o?void 0:o.length)||C(!1)},ee=(e,t)=>{const o=T;o[t]=e,k(o),Q(r.LockAction.None,d,o),o.every((e=>!e))?G(!0):G(!1)},te=e=>{b?(q(!1),Q(r.LockAction.Clear)):g(e)},oe=()=>{R.forEach((e=>Da(this,void 0,void 0,(function*(){var o;const a=e,n=a.getPopupInfo(),i=a.getLayerDefinition(),r=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==i?void 0:i.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==n?void 0:n.fieldInfos)||[]).filter((e=>e.visible))),l=a.mergeQueryParams(null!==(o=a.getCurrentQueryParams())&&void 0!==o?o:{},{where:"1=1",sqlExpression:null}),u=Object.assign({returnGeometry:!0},l);yield a.load(u,{widgetId:s});const c=new t.DataRecordSetChangeMessage(s,t.RecordSetChangeType.CreateUpdate,[{records:a.getRecords(),fields:r.map((e=>e.fieldName)),dataSource:a,name:a.id}]);t.MessageManager.getInstance().publishMessage(c)}))))},ae=e=>Da(this,void 0,void 0,(function*(){if((()=>{const e=To(y);let t=!1;return e.forEach(((o,a)=>{if(T[a]){const i=To(o);i.forEach(((s,l)=>{let u;if(u=s.hasDomain?(0,r.validateRangeDomain)(s.value,s.name,R[a]):((0,r.isDate)(s.type),(0,r.validateField)(s.value,s.name,R[a])),(0,r.isDefined)(ba[a])){const e=jo(s.value,0,l,o,ba[a]);if((null==e?void 0:e.length)>0){let t=[];e.forEach((e=>{var o;const a=null===(o=null==e?void 0:e.fieldGroup)||void 0===o?void 0:o.fields;t.push(a)})),t=t.flat(),t.includes(s.name)&&(C(!0),P(!0),u={hasError:!0,message:"contingentValueError"})}}if(u.hasError){let o;if("contingentValueError"===u.message){const e=[];ba[a].forEach((t=>{e.push(t.name)}));let t=n("invalidContingentValues");t=t.replace("{groupNames}",e.join(",")),o=t}else{const e=N[a].useFieldAlias?s.alias:s.name;o=n("attributeError",{fieldValue:e,message:n(u.message)})}F("error"),O(o),j(!0),setTimeout((()=>{j(!1)}),5e3),t=!0,s.error=n(u.message),e[a]=i}}))}})),t&&S(e),t})())return;let o=R[0].getGDBVersion();o||(o="");const a=N[0].lrsUrl,i={edits:[]};yield Promise.all(N.map(((e,o)=>Da(this,void 0,void 0,(function*(){if(T[o]&&(0,r.isDefined)(e)){const a={};let n=!1,s=!1;e.eventInfo.canSpanRoutes?d.routeLineOrder>d.toRouteLineOrder?n=!0:d.routeId===d.toRouteId&&d.selectedMeasure>d.selectedToMeasure&&(s=!0):d.selectedMeasure>d.selectedToMeasure&&(s=!0);const c=e.eventInfo.eventIdFieldName;a[c]="{"+(0,r.getUUID)()+"}";const m=e.eventInfo.routeIdFieldName;a[m]=d.routeId;const v=e.eventInfo.fromMeasureFieldName;a[v]=d.selectedMeasure;const p=e.eventInfo.fromDateFieldName;if(d.selectedFromDate){const e=(0,r.isDefined)(d.selectedFromDate)?(0,r.getDateWithoutTZOffset)(d.selectedFromDate.valueOf(),l):null;a[p]=(0,r.getDateToUTC)(e)}else a[p]=d.selectedFromDate;const h=e.eventInfo.toDateFieldName;if(d.selectedToDate){const e=(0,r.isDefined)(d.selectedToDate)?(0,r.getDateWithoutTZOffset)(d.selectedToDate.valueOf(),l):null;a[h]=(0,r.getDateToUTC)(e)}else a[h]=d.selectedToDate;if(e.eventInfo.routeNameFieldName&&e.eventInfo.routeNameFieldName.length>0){const t=e.eventInfo.routeNameFieldName;a[t]=d.routeName}if(e.eventInfo.toRouteIdFieldName&&e.eventInfo.toRouteIdFieldName.length>0){const t=e.eventInfo.toRouteIdFieldName;a[t]=d.toRouteId,n&&(a[m]=d.toRouteId,a[t]=d.routeId)}if(e.eventInfo.toRouteNameFieldName&&e.eventInfo.toRouteNameFieldName.length>0){const t=e.eventInfo.toRouteNameFieldName;if(a[t]=d.toRouteName,n){const o=e.eventInfo.routeNameFieldName;a[o]=d.toRouteName,a[t]=d.routeName}}if(e.eventInfo.toMeasureFieldName&&e.eventInfo.toMeasureFieldName.length>0){const t=e.eventInfo.toMeasureFieldName;a[t]=d.selectedToMeasure,(n||s)&&(a[v]=d.selectedToMeasure,a[t]=d.selectedMeasure)}y[o].forEach((e=>{const t=e.name;if((0,r.isDefined)(e.value)&&(0,r.isDate)(e.type)){const o=(0,r.getDateWithoutTZOffset)(e.value.valueOf(),l);a[t]=(0,r.getDateToUTC)(o)}else(0,r.isNumber)(e.type)?!(0,r.isDefined)(e.value)||""===e.value||isNaN(Number(e.value))?a[t]=null:a[t]=Number(e.value):a[t]=e.value}));const D={};if(e.eventInfo.canSpanRoutes||d.routeId===d.toRouteId){const t=[],o={attributes:a,geometry:d.selectedPolyline};t.push(o);const n={id:e.serviceId,adds:t,allowMerge:f.mergeCoincident,retireMeasureOverlap:f.retireOverlapping,retireByEventId:!1};i.edits.push(n)}else{const o=u.routeIdFieldSchema.jimuName,n=u.routeNameFieldSchema.jimuName,s=u.lineOrderFieldSchema.jimuName,p=u.fromDateFieldSchema.jimuName,h=yield(0,r.queryAllRoutesByLineId)(d.lineId,u,l);if((0,r.isDefined)(h)&&(yield Promise.all(h.features.map((e=>{const t=e.attributes[o],a={routeId:"",routeName:"",fromMeasure:0,toMeasure:0,fromDate:void 0,toDate:void 0,selectedMeasure:0,selectedFromDate:void 0,selectedToDate:void 0,routeLineOrder:0,selectedPolyline:null};return a.routeId=t,a.routeName=e.attributes[n],a.routeLineOrder=e.attributes[s],a.fromDate=e.attributes[p],a.selectedPolyline=e.geometry,D[t]=a,D})))),Object.keys(D).length){const o=Object.keys(D).sort(((e,t)=>D[e].routeLineOrder-D[t].routeLineOrder)),n=Object.fromEntries(o.map((e=>[e,D[e]]))),s=e.eventInfo.toMeasureFieldName;for(const[o,p]of Object.entries(n)){const n=structuredClone(a),h=p.routeLineOrder;if(h<d.routeLineOrder)continue;let D=!1,b=null,g=!1,R=NaN,I=NaN,y="",S="";if(o===d.routeId)y=o,S=d.routeName,R=d.selectedMeasure,I=d.toMeasure,b=yield(0,r.QueryPolylineOnRoute)(l,u,y,o,d.fromDate,R.toString(),I.toString()),D=!0;else if(h>d.routeLineOrder&&h<d.toRouteLineOrder){b=p.selectedPolyline;const e=(0,r.getRouteFromEndMeasures)(b),t=yield(0,r.QueryRouteMeasures)(l,u,e,p.fromDate,o);R=na(Math.min(...t),u.measurePrecision),I=na(Math.max(...t),u.measurePrecision),y=o,D=!0}else o===d.toRouteId&&(y=o,S=d.toRouteName,R=d.toRouteFromMeasure,I=d.selectedToMeasure,b=yield(0,r.QueryPolylineOnRoute)(l,u,o,o,d.fromDate,R.toString(),I.toString()),D=!0,g=!0);if(D){if(n[c]="{"+t.utils.getUUID()+"}",n[m]=y,n[v]=R,n[s]=I,e.eventInfo.routeNameFieldName&&e.eventInfo.routeNameFieldName.length>0){n[e.eventInfo.routeNameFieldName]=S}const o={attributes:n,geometry:b},a={id:e.serviceId,adds:[o],allowMerge:f.mergeCoincident,retireMeasureOverlap:f.retireOverlapping,retireByEventId:!1};if(i.edits.push(a),g)break}}}}}return i}))))),yield(0,r.LrsApplyEdits)(a,i,o).then((t=>{t.success?(F("success"),O(n("eventCreated")),j(!0),oe(),setTimeout((()=>Da(this,void 0,void 0,(function*(){if(j(!1),b){q(!0),yield(0,r.tryReleaseLockOnDefault)(l,e);const t=Object.assign(Object.assign({},e),{lockAction:r.LockAction.Clear});V(t)}else te(!0)}))),5e3)):(F("error"),O(`${t.message} \n ${t.details}`),j(!0),setTimeout((()=>{j(!1)}),5e3))}))})),ne=e=>{e.every((e=>e))?W(!0):(e.every((e=>!e)),W(!1))};return(0,t.jsx)("div",{className:"h-100",css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-multiple-line-events-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-multiple-line-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-multiple-line-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-multiple-line-events-edit-attributes__action {
      height: auto;
    }
    .add-multiline-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,t.jsx)("div",{className:"add-multiple-line-events-edit-attributes__content"},b&&(0,t.jsx)(r.LockManagerComponent,{intl:i,featureDS:l,lockInfo:U,showAlert:!0,networkName:null==u?void 0:u.datasetName,conflictPreventionEnabled:b,onQueryAndAcquireComplete:(e,t,o)=>{V(e),o&&ae(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},U),{lockAction:r.LockAction.None});V(e),g(z),q(!1)}}),(0,t.jsx)("div",{className:"attribute-picker d-flex w-100 px-3"},(0,t.jsx)("div",{className:"mr-auto"},(0,t.jsx)(a.Label,{size:"sm",className:"text-truncate w-100 pt-2",centric:!0,check:!0,style:{textOverflow:"ellipsis",fontWeight:500}},(0,t.jsx)(a.Checkbox,{checked:B,className:"mr-2",onChange:e=>{const t=e.target.checked,o=T;o.forEach(((e,a)=>{o[a]=t})),k(o),ne(o),o.every((e=>!e))?G(!0):G(!1)}}),n("selectAllLabel"))),(0,t.jsx)("div",{className:"ml-auto"},(0,t.jsx)(r.CopyAttributeTool,{disabled:!1,networkDs:l,eventDataSources:R,jimuMapView:h,hoverGraphic:D,onAttributesCopied:e=>{const t=To(y);e.forEach((e=>{const o=c.findIndex((t=>t.serviceId.toString()===e.layerId));if(o>-1){const a=To(t[o]);e.fieldValuePair.forEach((e=>{const t=a.findIndex((t=>t.name===e.name));if(t>-1){let o=e.value;(0,r.isDate)(a[t].type)&&(o=(0,r.isDefined)(e.value)?new Date(e.value):null),a[t].value=o}})),t[o]=a}})),S(t)}}))),E&&(0,t.jsx)(a.Alert,{tabIndex:0,className:"w-100 userInfo",onClose:function(){C(!1)},open:E,text:A,type:"warning",closable:!0,withIcon:!0}),(0,r.isDefined)(y)&&y.map(((e,o)=>(0,t.jsx)(r.AttributeTable,{key:o,tableIndex:o,eventDS:R[o],eventLayer:(0,t.Immutable)(N[o]),fieldInfos:e,useAlias:!0,collapable:!0,isExpanded:T[o],onItemChecked:ee,onUpdateItem:K,onFieldGrpUpdated:X,onUpdateAll:Y}))),w&&(0,t.jsx)("div",{className:"add-multiple-line-event-edit-attributes__toast-container w-100 p-3"},(0,t.jsx)(a.Alert,{className:"add-multiple-line-event-edit-attributes__toast w-100",type:x,text:A,closable:!0,withIcon:!0,open:w,onClose:()=>{j(!1)}}))),(0,t.jsx)("div",{className:"add-multiline-attributes-footer w-100"},(0,t.jsx)("div",{className:"add-multiple-line-events-edit-attributes__action w-100 d-flex"},(0,t.jsx)("div",{className:"mt-auto mr-auto"},(0,t.jsx)(a.Button,{"aria-label":n("backLabel"),size:"sm",type:"secondary",onClick:()=>{te(!1)}},n("backLabel"))),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(a.Button,{type:"primary",className:"active","aria-label":n("saveLabel"),size:"sm",disabled:L||_||E,onClick:()=>{b?Q(r.LockAction.QueryAndAcquire,d,T):ae()}},n("saveLabel"))))))}function Ra(e){const{events:o,dataSourcesReady:a}=e,[n,i]=t.React.useState(null!=o?o:null),[s,l]=t.React.useState([]);t.React.useEffect((()=>{if(o){i(o);const e=Array(o.length).fill(!1);l(e)}}),[o]),t.React.useEffect((()=>{a((e=>e.every(Boolean)))}),[a,s]);const u=t.React.useCallback(((e,t)=>{const o=Object.assign({},s);o[e]=t,l(o)}),[s]),c=t.React.useCallback(((e,t)=>{u(t,!0)}),[u]),d=t.React.useCallback(((e,o)=>{if(e){const{status:a,instanceStatus:n}=e;n===t.DataSourceStatus.NotCreated||n===t.DataSourceStatus.CreateError||a===t.DataSourceStatus.LoadError||a===t.DataSourceStatus.NotReady?u(o,!1):u(o,!0)}}),[u]),f=t.React.useCallback((e=>{u(e,!1)}),[u]);return(0,t.jsx)("div",null,(0,r.isDefined)(n)&&n.map(((e,o)=>(0,t.jsx)(t.DataSourceComponent,{useDataSource:e.useDataSource,onDataSourceInfoChange:e=>{d(e,o)},onCreateDataSourceFailed:e=>{f(o)},onDataSourceCreated:e=>{c(e,o)}}))))}var Ia=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};function ya(e){var n;const i=t.hooks.useTranslation(o),{intl:s,widgetId:l,lrsLayers:u,jimuMapView:d,operationType:f,networkLayers:m,defaultNetwork:v,defaultFromMethod:p,defaultToMethod:h,defaultAttributeSet:D,attributeSets:b,hoverGraphic:g,pickedFromGraphic:R,pickedToGraphic:I,flashGraphic:y,hideMethod:S,hideNetwork:N,hideType:M,hideAttributeSet:T,hideMeasures:k,hideDates:w,hideTitle:j,useRouteStartEndDate:x,conflictPreventionEnabled:F,networkDataSourceFromDataAction:A,routeInfoFromDataAction:O,onResetDataAction:L,onClearGraphics:P,onClearHoverGraphic:E,onOperationTypeChanged:C}=e,[_,G]=t.React.useState(0),[U,V]=t.React.useState(null),[B,W]=t.React.useState(null),[z,q]=t.React.useState(null),[Q,H]=t.React.useState(!1),[Z,$]=t.React.useState(!1),[J,K]=t.React.useState(p),[Y,X]=t.React.useState(h),[ee,te]=t.React.useState(D),[oe,ae]=t.React.useState(null),[ne,ie]=t.React.useState(!1),[se,re]=t.React.useState((0,r.getInitialRouteInfoState)()),[le,ue]=t.React.useState(!1),[ce,de]=t.React.useState((0,r.getIntialLocksInfo)()),[fe,me]=t.React.useState(!1),[ve,pe]=t.React.useState(!1),he=t.React.useRef(null),De=t.React.useCallback((e=>{V(e)}),[V]),be=t.React.useCallback((()=>{H(!0)}),[H]),ge=t.React.useCallback((()=>{$(!0)}),[$]),Re=t.React.useCallback((e=>{const o=u.find((t=>t.name===e));(0,r.isDefined)(o)&&W((0,t.Immutable)(o)),k||(me(!1),pe(!1))}),[u]);t.React.useEffect((()=>{(0,t.focusElementInKeyboardMode)(he.current)}),[]),t.React.useEffect((()=>{if(!(0,r.isDefined)(B))if((0,r.isDefined)(v)){const e=u.find((e=>e.name===v.name));W((0,t.Immutable)(e))}else{const e=u.find((e=>e.layerType===r.LrsLayerType.network));e&&W((0,t.Immutable)(e))}if(!(0,r.isDefined)(oe)){const e=b.attributeSet.find((e=>e.title===ee));e&&ae(e)}}),[u,v]),t.React.useEffect((()=>{!function(){Ia(this,void 0,void 0,(function*(){if((0,r.isDefined)(O)&&(isNaN(O.fromMeasure)||isNaN(O.toRouteToMeasure))){const e=yield(0,r.getRouteMeasures)(O,B,U);(0,r.isDefined)(e.fromMeasure)&&(0,r.isDefined)(e.toRouteToMeasure)&&(O.fromMeasure=e.fromMeasure,O.toRouteToMeasure=e.toRouteToMeasure)}}))}()}),[A,O]),t.React.useEffect((()=>{const e=(0,r.isDefined)(A)||(0,r.isDefined)(O);e&&ke(),e&&setTimeout((()=>{if((0,r.isDefined)(A)&&A.id!==(null==B?void 0:B.id)){V(A);let e,t=A;(A.id.includes("output_point")||A.id.includes("output_line"))&&(t=A.getOriginDataSources()[0]),u.forEach((o=>{o.id===t.id&&(0,r.isDefined)(o.networkInfo)&&(e=o)}));const o=e.name;Re(o)}(0,r.isDefined)(O)&&(xe.canSpanRoutes||O.routeId===O.toRouteId||(O.toRouteId=O.routeId,O.toRouteName=O.routeName,O.toRouteFromMeasure=O.fromMeasure,O.toRouteToMeasure=O.toMeasure,O.selectedToPolyline=O.selectedPolyline,O.toRouteFromDate=O.fromDate,O.toRouteToDate=O.toDate),je(O),ue(!0))}),2e3)}),[A,O]),t.React.useEffect((()=>{F&&Ie()}),[U,oe,B]);const Ie=(e=r.LockAction.None,t)=>{const o=Object.assign({},ce);if((0,r.isDefined)(B)&&(o.networkId=[B.networkInfo.lrsNetworkId]),(0,r.isDefined)(oe)){const e=oe.layers.map((e=>e.layerId));o.eventServiceLayerIds=e}(0,r.isDefined)(t)&&(o.routeInfo=t),o.lockAction=e,de(o)};t.React.useEffect((()=>{if((0,r.isDefined)(oe)&&(0,r.isDefined)(B)){const e=[];oe.layers.forEach((t=>{const o=u.find((e=>e.serviceId===t.layerId));o&&B.networkInfo.lrsNetworkId===o.eventInfo.parentNetworkId&&e.push(o)})),q((0,t.Immutable)(e))}}),[oe,B]),t.React.useEffect((()=>{me(k),pe(k)}),[k]),t.React.useEffect((()=>{k&&(me(k),pe(k))}),[]);const ye=t.React.useCallback((e=>{const t=b.attributeSet.find((t=>t.title===e));t&&ae(t),te(e)}),[]),Se=t.React.useCallback((e=>{K(e)}),[]),Ne=t.React.useCallback((e=>{X(e)}),[]),Me=t.React.useMemo((()=>!!(Q&&Z&&(0,r.isDefined)(d)&&(0,r.isDefined)(null==d?void 0:d.view)&&(null==d?void 0:d.view.ready))),[Q,Z,d]),Te=t.React.useCallback((e=>{e&&ke(),G(0),he.current&&(0,t.focusElementInKeyboardMode)(he.current)}),[]),ke=()=>{let e=!1;(0,r.isDefined)(B)&&(0,r.isDefined)(B.networkInfo)&&(0,r.isDefined)(B.networkInfo.lineIdFieldSchema)&&(e=!0),P();const t=(0,r.getInitialRouteInfoState)();je(t,!1,!0);const o=(0,r.getInitialEventInfoState)();o.canSpanRoutes=e,Ae(o);const a=(0,r.getInitialRouteMeasurePickerInfoState)();Pe(a),k||(me(!1),pe(!1)),E(),ie(!0),setTimeout((()=>{ie(!1)}),800)},we=()=>{ue(!1),L()},je=(e,t=!1,o=!1)=>{if(re(e),_e(e,t),F){const t=o?r.LockAction.Clear:r.LockAction.Release;Ie(t,e)}},[xe,Fe]=t.React.useState((0,r.getInitialEventInfoState)()),Ae=e=>{Fe(e)},[Oe,Le]=t.React.useState((0,r.getInitialRouteMeasurePickerInfoState)()),Pe=e=>{Le(e)};t.React.useEffect((()=>{if((0,r.isDefined)(B)){re((0,r.getInitialRouteInfoState)());const e=(0,r.getInitialEventInfoState)();(0,r.isDefined)(B.networkInfo)&&(0,r.isDefined)(B.networkInfo.lineIdFieldSchema)&&(e.canSpanRoutes=!0),Ae(e)}}),[B,ne]);const Ee=()=>{(0,r.isDefined)(R)&&R.removeAll()},Ce=()=>{(0,r.isDefined)(I)&&I.removeAll()},_e=(e,t)=>Ia(this,void 0,void 0,(function*(){var o;(0,r.isDefined)(e.selectedPolyline)&&t&&(o=yield(0,r.getGeometryGraphic)(yield(0,r.getSimpleLineGraphic)(e.selectedPolyline),ca),(0,r.isDefined)(o)&&(y.add(o),setTimeout((()=>{y.removeAll(),setTimeout((()=>{y.add(o),setTimeout((()=>{y.removeAll(),setTimeout((()=>{y.add(o),setTimeout((()=>{y.removeAll()}),800)}),800)}),800)}),800)}),800))),(0,r.isDefined)(e.selectedPoint)?(e=>{(0,r.isDefined)(e)?(R.removeAll(),R.add(e)):Ee()})(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedPoint),da)):Ee(),(0,r.isDefined)(e.selectedToPoint)?(e=>{(0,r.isDefined)(e)?(I.removeAll(),I.add(e)):Ce()})(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedToPoint),fa)):Ce(),(0,r.isDefined)(d)&&d.clearSelectedFeatures()})),Ge=t.React.useCallback((()=>function(e,t,o){var a,n;if(!wo(e))return!1;let i=!0;if(i=i&&(null===(a=e.routeId)||void 0===a?void 0:a.length)>0,i=i&&(null===(n=e.toRouteId)||void 0===n?void 0:n.length)>0,!wo(o)||!wo(o.networkInfo))return!1;const s=na(e.fromMeasure,o.networkInfo.measurePrecision),r=na(e.toMeasure,o.networkInfo.measurePrecision),l=na(e.selectedMeasure,o.networkInfo.measurePrecision),u=na(e.selectedToMeasure,o.networkInfo.measurePrecision);if(isNaN(s)||isNaN(l))return!1;if(i=i&&l>=s,null==t?void 0:t.canSpanRoutes){const t=na(e.toRouteFromMeasure,o.networkInfo.measurePrecision),a=na(e.toRouteToMeasure,o.networkInfo.measurePrecision);if(isNaN(t)||isNaN(u))return!1;if(i=i&&u>=t,isNaN(a)||isNaN(u))return!1;i=i&&u<=a}else{if(isNaN(r)||isNaN(u))return!1;i=i&&u<=r}return wo(e.selectedFromDate)&&!wo(e.selectedToDate)&&(wo(e.fromDate)&&(i=i&&e.selectedFromDate>=e.fromDate),wo(e.toDate)&&(i=i&&e.selectedFromDate<e.toDate)),!wo(e.selectedFromDate)&&wo(e.selectedToDate)&&(wo(e.fromDate)&&(i=i&&e.selectedToDate>=e.fromDate),wo(e.toDate)&&(i=i&&e.selectedToDate<e.toDate)),wo(e.selectedFromDate)&&wo(e.selectedToDate)&&(i=i&&e.selectedFromDate<e.selectedToDate,wo(e.fromDate)&&(i=i&&e.selectedFromDate>=e.fromDate),wo(e.toDate)&&(i=i&&e.selectedToDate<=e.toDate)),!(!wo(e.selectedFromDate)&&!wo(e.selectedToDate))&&i}(se,xe,B)),[se]),Ue=t.React.useCallback(((e,t)=>{de(e)}),[]);return(0,t.jsx)("div",{className:"add-multiple-line-event h-100 d-flex",ref:he,tabIndex:-1,css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .add-multiple-line-event-form {
      height: 100%;
    }
    .add-multiple-line-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-line-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,t.jsx)(Oo,{network:B,dataSourcesReady:be,onCreateNetworkDs:De}),(0,t.jsx)(Ra,{events:z,dataSourcesReady:ge}),!j&&(0,t.jsx)(c,null),(0,t.jsx)("div",{className:(0,t.classNames)("add-multiple-line-event__content",{"d-none":1===_,[a.FOCUSABLE_CONTAINER_CLASS]:1!==_})},F&&(0,t.jsx)(r.LockManagerComponent,{intl:s,showAlert:!1,featureDS:U,lockInfo:ce,networkName:null===(n=null==B?void 0:B.networkInfo)||void 0===n?void 0:n.datasetName,conflictPreventionEnabled:F,onQueryAndReleaseComplete:Ue,onMessageClear:()=>{Ie(r.LockAction.None)}}),!M&&(0,t.jsx)(va,{operationType:f,onOperationTypeChanged:C}),!N&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("networkLabel"),isDisabled:1===m.length,defaultItem:(0,r.isDefined)(B)?B.name:"",listItems:m,onSelectionChanged:Re}),!T&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("attributeSetLabel"),isDisabled:1===b.attributeSet.length,defaultItem:ee,listItems:(()=>{const e=[];return b.attributeSet.forEach((t=>{e.push(t.title)})),e})(),onSelectionChanged:ye}),!S&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("fromMethodLabel"),defaultItem:J,isDisabled:!0,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:Se}),(0,t.jsx)(ra,{intl:s,widgetId:l,network:B?B.networkInfo:null,dsReady:Me,networkDS:U,method:J,jimuMapView:d,hoverGraphic:g,pickedGraphic:R,isFrom:!0,routeInfo:se,routeMeasurePickerInfo:Oe,reset:ne,hideMeasures:k,revalidateRouteFromDataAction:le,onResetDataAction:we,canSpanRoutes:!!B&&(0,r.isDefined)(B.networkInfo.lineIdFieldSchema),onUpdateRouteInfo:je,onUpdateRouteMeasurePickerInfo:Pe,useStartMeasure:fe,useEndMeasure:ve}),!k&&(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:fe,className:"mr-2",disabled:!(0,r.isDefined)(se)||isNaN(se.fromMeasure),onChange:(e,t)=>{if(t){const e=se;e.selectedMeasure=e.fromMeasure,e.selectedPoint=null,je(e)}me(t)}}),i("useStartMeasureLabel")),!S&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("toMethodLabel"),defaultItem:Y,isDisabled:!0,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:Ne}),(0,t.jsx)(ra,{intl:s,widgetId:l,network:B?B.networkInfo:null,dsReady:Me,networkDS:U,method:Y,jimuMapView:d,hoverGraphic:g,pickedGraphic:I,isFrom:!1,routeInfo:se,routeMeasurePickerInfo:Oe,reset:ne,hideMeasures:k,revalidateRouteFromDataAction:le,onResetDataAction:we,canSpanRoutes:!!B&&(0,r.isDefined)(B.networkInfo.lineIdFieldSchema),onUpdateRouteInfo:je,onUpdateRouteMeasurePickerInfo:Pe,useStartMeasure:fe,useEndMeasure:ve}),!k&&(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:ve,className:"mr-2",disabled:!(0,r.isDefined)(null==se?void 0:se.toRouteToMeasure)||isNaN(se.toRouteToMeasure),onChange:(e,t)=>{if(t){const e=se;e.selectedToMeasure=e.toRouteToMeasure,e.selectedToPoint=null,je(e)}pe(t)}}),i("useEndMeasureLabel")),(0,t.jsx)(ua,{intl:s,hideDates:w,useRouteStartEndDate:x,routeInfo:se,network:B?B.networkInfo:null,revalidateRouteFromDataAction:le,onUpdateRouteInfo:je}),(0,t.jsx)(ma,{eventInfo:xe,onUpdateEventInfo:Ae})),(0,t.jsx)("div",{className:(0,t.classNames)("add-line-footer w-100",{"d-none":1===_,[a.FOCUSABLE_CONTAINER_CLASS]:1!==_})},(0,t.jsx)(a.Label,{size:"sm",className:"mt-auto mr-auto",style:{fontWeight:500,width:100,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--primary-500"},onClick:ke},i("resetForm")),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(a.Button,{type:"primary",className:"active","aria-label":i("nextLabel"),size:"sm",disabled:!Ge()&&Me,onClick:()=>{G(1)}},i("nextLabel")))),(0,t.jsx)("div",{className:(0,t.classNames)("add-multiple-line-event__content",{"d-none":1!==_,[a.FOCUSABLE_CONTAINER_CLASS]:1===_})},(0,t.jsx)(ga,{intl:s,widgetId:l,networkDS:U,network:B?B.networkInfo:null,eventLayers:z,attributeSet:oe,routeInfo:se,eventInfo:xe,reset:ne,isReady:Me,jimuMapView:d,hoverGraphic:g,conflictPreventionEnabled:F,onNavBack:Te})))}var Sa=l(59620),Na=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};const Ma=t.css`
  background-color: var(--ref-palette-white);
`;class Ta extends t.React.PureComponent{constructor(n){super(n),this.componentDidMount=()=>{var e,t;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedDataSource)?this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource}):(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.selectedRouteInfo)&&this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo});const o=(0,r.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:o}),this.setState({operationType:this.props.config.defaultType})},this.onActiveViewChange=e=>{e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))},this.waitForChildDataSourcesReady=e=>Na(this,void 0,void 0,(function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const o=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==o?void 0:o.isDataSourceSet())&&!o.areChildDataSourcesCreated()?o.childDataSourcesReady().then((()=>o)).catch((e=>o)):Promise.resolve(o)})),this.handleOperationTypeChange=e=>{this.setState({operationType:e}),this.clearGraphics()},this.getI18nMessage=(e,t)=>{const n=Object.assign({},o,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:n[e]},t)},this.state={hideTitle:!1,jimuMapView:void 0,operationType:e.single,hoverGraphic:null,pickedFromGraphic:null,pickedToGraphic:null,flashGraphic:null,routeInfoFromDataAction:null,networkDataSourceFromDataAction:null},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,o){var a,n,i,s,l,u,c,d,f,m;o.jimuMapView!==this.state.jimuMapView&&(0,r.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers());const v=null===(i=null===(n=null===(a=(0,t.getAppStore)())||void 0===a?void 0:a.getState())||void 0===n?void 0:n.widgetsRuntimeInfo[this.props.id])||void 0===i?void 0:i.state;if((v===t.WidgetState.Opened||!v)&&((null===(s=this.props)||void 0===s?void 0:s.selectedNetworkDataSource)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedNetworkDataSource&&(null===(l=null==e?void 0:e.mutableStatePropsVersion)||void 0===l?void 0:l.selectedNetworkDataSource)===(null===(u=this.props.mutableStatePropsVersion)||void 0===u?void 0:u.selectedNetworkDataSource)||this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource})),null===(c=this.props)||void 0===c?void 0:c.selectedRouteInfo)){!(null===(d=this.props)||void 0===d?void 0:d.selectedRouteInfo)||e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedRouteInfo&&(null===(f=null==e?void 0:e.mutableStatePropsVersion)||void 0===f?void 0:f.selectedRouteInfo)===(null===(m=this.props.mutableStatePropsVersion)||void 0===m?void 0:m.selectedRouteInfo)||this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo})}}removeGraphicLayers(){(0,r.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,r.isDefined)(this.state.pickedFromGraphic)&&(this.state.pickedFromGraphic.removeAll(),this.state.pickedFromGraphic.destroy(),this.setState({pickedFromGraphic:null})),(0,r.isDefined)(this.state.pickedToGraphic)&&(this.state.pickedToGraphic.removeAll(),this.state.pickedToGraphic.destroy(),this.setState({pickedToGraphic:null})),(0,r.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,r.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const o=new Sa.default({listMode:"hide"}),a=new Sa.default({listMode:"hide"}),n=new Sa.default({listMode:"hide"}),i=new Sa.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([a,n,i,o]),this.setState({hoverGraphic:o}),this.setState({pickedFromGraphic:a}),this.setState({pickedToGraphic:n}),this.setState({flashGraphic:i})}}resetDataAction(){this.setState({routeInfoFromDataAction:null}),this.setState({networkDataSourceFromDataAction:null})}clearGraphics(){this&&this.state&&((0,r.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,r.isDefined)(this.state.pickedFromGraphic)&&this.state.pickedFromGraphic.removeAll(),(0,r.isDefined)(this.state.pickedToGraphic)&&this.state.pickedToGraphic.removeAll(),(0,r.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll())}clearHoverGraphic(){this&&this.state&&(0,r.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll()}render(){var o;const{config:n,id:r,intl:l}=this.props,{lrsLayers:u,networkLayers:c,lineEventLayers:d,intersectionLayers:f,defaultEvent:m,defaultNetwork:v,defaultFromMethod:p,defaultToMethod:h,attributeSets:D,defaultAttributeSet:b,hideType:g,hideMethod:R,hideEvent:I,hideNetwork:y,hideAttributeSet:S,hideMeasures:N,hideDates:M,useRouteStartEndDate:T,conflictPreventionEnabled:k}=n,{jimuMapView:w,operationType:j}=this.state;return(null==c?void 0:c.length)&&(null==d?void 0:d.length)?(0,t.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-add-line-event surface-1 border-0",css:Ma},(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:null===(o=this.props.useMapWidgetIds)||void 0===o?void 0:o[0],onActiveViewChange:this.onActiveViewChange}),j===e.single&&(0,t.jsx)(ha,{intl:l,widgetId:r,lrsLayers:u,JimuMapView:w,operationType:j,onOperationTypeChanged:this.handleOperationTypeChange,lineEventLayers:d,networkLayers:c,instersectionLayers:f,defaultEvent:m,defaultFromMethod:p,defaultToMethod:h,hoverGraphic:this.state.hoverGraphic,pickedFromGraphic:this.state.pickedFromGraphic,pickedToGraphic:this.state.pickedToGraphic,flashGraphic:this.state.flashGraphic,hideEvent:I,hideNetwork:y,hideType:g,hideMethod:R,hideMeasures:N,hideDates:M,hideTitle:this.state.hideTitle,useRouteStartEndDate:T,conflictPreventionEnabled:k,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphics:this.clearGraphics.bind(this),onClearHoverGraphic:this.clearHoverGraphic.bind(this)}),j===e.multiple&&(0,t.jsx)(ya,{intl:l,widgetId:r,lrsLayers:u,jimuMapView:w,operationType:j,onOperationTypeChanged:this.handleOperationTypeChange,lineEventLayers:d,networkLayers:c,instersectionLayers:f,defaultEvent:m,defaultNetwork:v,defaultFromMethod:p,defaultToMethod:h,defaultAttributeSet:b,attributeSets:D,hoverGraphic:this.state.hoverGraphic,pickedFromGraphic:this.state.pickedFromGraphic,pickedToGraphic:this.state.pickedToGraphic,flashGraphic:this.state.flashGraphic,hideNetwork:y,hideMethod:R,hideType:g,hideAttributeSet:S,hideMeasures:N,hideDates:M,hideTitle:this.state.hideTitle,useRouteStartEndDate:T,conflictPreventionEnabled:k,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphics:this.clearGraphics.bind(this),onClearHoverGraphic:this.clearHoverGraphic.bind(this)})):(0,t.jsx)(a.WidgetPlaceholder,{icon:i(),widgetId:r,message:this.getI18nMessage("_widgetLabel")})}}Ta.mapExtraStateProps=(e,t)=>{var o,a;return{selectedRouteInfo:null===(o=null==t?void 0:t.mutableStateProps)||void 0===o?void 0:o.selectedRouteInfo,selectedNetworkDataSource:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedNetworkDataSource}};const ka=Ta;function wa(e){l.p=e}})(),u})())}}}));