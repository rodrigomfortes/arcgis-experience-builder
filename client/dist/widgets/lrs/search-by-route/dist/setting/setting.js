System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui/basic/color-picker","widgets/shared-code/lrs","jimu-ui/basic/list-tree","jimu-core/react","jimu-ui/advanced/sql-expression-builder","jimu-ui/advanced/data-source-selector"],(function(e,t){var i={},a={},s={},n={},o={},l={},r={},d={},u={},c={};return{setters:[function(e){i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.JimuFieldType=e.JimuFieldType,i.OrderRule=e.OrderRule,i.React=e.React,i.ReactRedux=e.ReactRedux,i.SessionManager=e.SessionManager,i.classNames=e.classNames,i.css=e.css,i.esri=e.esri,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.jsx=e.jsx,i.polished=e.polished,i.urlUtils=e.urlUtils},function(e){a.Button=e.Button,a.Checkbox=e.Checkbox,a.NumericInput=e.NumericInput,a.Select=e.Select,a.Switch=e.Switch,a.TextInput=e.TextInput,a.defaultMessages=e.defaultMessages},function(e){s.MapWidgetSelector=e.MapWidgetSelector,s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper,s.getOutputJsonOriginDs=e.getOutputJsonOriginDs},function(e){n.getAppConfigAction=e.getAppConfigAction},function(e){o.ColorPicker=e.ColorPicker},function(e){l.GetEsriUnits=e.GetEsriUnits,l.GetUnits=e.GetUnits,l.SearchMethod=e.SearchMethod,l.colorBlack=e.colorBlack,l.errorMessageDelay=e.errorMessageDelay,l.formatMessage=e.formatMessage,l.highlightColor=e.highlightColor,l.isDefined=e.isDefined,l.messages=e.messages},function(e){r.List=e.List,r.TreeItemActionType=e.TreeItemActionType},function(e){d.Fragment=e.Fragment},function(e){u.Sort=e.Sort},function(e){c.DataSourceRemoveWaringReason=e.DataSourceRemoveWaringReason,c.DataSourceRemoveWarningPopup=e.DataSourceRemoveWarningPopup,c.dataComponentsUtils=e.dataComponentsUtils}],execute:function(){e((()=>{var e={4108:e=>{"use strict";e.exports=n},13089:e=>{"use strict";e.exports=c},14321:e=>{"use strict";e.exports=a},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},47626:e=>{"use strict";e.exports=l},54337:e=>{"use strict";e.exports=o},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},68972:e=>{"use strict";e.exports=d},71442:e=>{"use strict";e.exports=u},79244:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=s},98640:e=>{"use strict";e.exports=r}},t={};function g(i){var a=t[i];if(void 0!==a)return a.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,g),s.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var i in t)g.o(t,i)&&!g.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},g.p="";var h={};return g.p=window.jimuConfig.baseUrl,(()=>{"use strict";g.r(h),g.d(h,{__set_webpack_public_path__:()=>Q,default:()=>V});var e=g(79244),t=g(14321),i=g(79298),a=g(4108);const s={blankStatus:"Select a map to import LRS networks",outputDsLabelPoint:"{label} point result",outputDsLabelLine:"{label} line result",layerConfig:"Layer Configuration",importAll:"Import all",selectMap:"Select Map",networkConfig:"Network Configuration",referentConfig:"Referent Configuration",networkLabel:"Label",defaultIdentifier:"Default Identifier",routeIdentifier:"Route",lineIdentifier:"Line",spatialReference:"Spatial Reference",routeId:"Route ID",routeName:"Route name",lineId:"Line ID",lineName:"Line Name",multiField:"Multi field",searchMethod:"Search Methods",identifier:"Identifier",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",referent:"Referent",lineAndMeasure:"Line and Measure",removeNetwork:"Remove",selectionHighlight:"Highlight",graphicWidth:"Width",resultSettings:"Result Settings",resultsPageSize:"Page size",enablePoint:"Enable add point",enableLine:"Enable add line",defaultReferent:"Default Referent",defaultOffsetUnit:"Default Offset Units",routeFields:"Multi field route ID",routeFieldsConfig:"Route ID settings",selectionSettings:"Selection Settings",results:"Results",sortResults:"Sort results by:",radiusWithUnits:"Radius ({units})",resultsAscending:"Ascending",resultsDescending:"Descending",noMapSelected:"Select Map",lrs:"LRS",defaultStr:"Default",configureFields:"Configure Fields",defaultNetwork:"Default Network",searchMeasures:"Search Measures",singleLabel:"Single",multipleLabel:"Multiple",rangeLabel:"Range",expandByDefault:"Expand by default",loadLayers:"Load layers",clearLayers:"Clear layers",labelColor:"Label color",labelSize:"Label size",advancedFieldDisplay:"Advanced field display",networkFields:"Network fields",additionalFields:"Additional fields"};var n,o,l,r,d,u=g(54337),c=g(47626),p=g(98640);!function(e){e.RouteId="ROUTEID",e.RouteName="ROUTENAME",e.MultiField="MULTIFIELD"}(n||(n={})),function(e){e.LineId="LINEID",e.LineName="LINENAME"}(o||(o={})),function(e){e.Map="MAP",e.Lrs="LRS"}(l||(l={})),function(e){e.X="X",e.Y="Y",e.Z="Z"}(r||(r={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE",e.Range="RANGE"}(d||(d={}));var m=g(68972),f=g(28996),v=g.n(f),S=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const I=t=>{const i=window.SVG,{className:a}=t,s=S(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",a);return i?e.React.createElement(i,Object.assign({className:n,src:v()},s)):e.React.createElement("svg",Object.assign({className:n},s))};function w(a){const{networkItem:n,onPropertyChanged:o,onPropertiesChanged:l}=a,r=e.hooks.useTranslation(s),d=Object.assign({},{},n),u=(e,t)=>{if(e.target)if(g(t)){const i=[],a=[];i.push(t),a.push(e.target.checked),i.push("defaultMethod"),a.push(h(t)),l(i,a,!0)}else o(t,e.target.checked,!0)},g=e=>{let t=!1;switch(e){case"useMeasure":t=d.defaultMethod===c.SearchMethod.Measure;break;case"useCoordinate":t=d.defaultMethod===c.SearchMethod.Coordinate;break;case"useReferent":t=d.defaultMethod===c.SearchMethod.Referent;break;case"useLineAndMeasure":t=d.defaultMethod===c.SearchMethod.LineAndMeasure}return t},h=e=>"useMeasure"!==e&&d.useMeasure&&d.defaultMethod!==c.SearchMethod.Measure?c.SearchMethod.Measure:"useCoordinate"!==e&&d.useCoordinate&&d.defaultMethod!==c.SearchMethod.Coordinate?c.SearchMethod.Coordinate:"useLineAndMeasure"!==e&&d.useLineAndMeasure&&d.defaultMethod!==c.SearchMethod.LineAndMeasure?c.SearchMethod.LineAndMeasure:c.SearchMethod.Referent,p=()=>{let e=0;return d.useMeasure&&e++,d.useCoordinate&&e++,d.useReferent&&e++,d.useLineAndMeasure&&e++,e};return(0,e.jsx)(i.SettingSection,{role:"group","aria-label":r("searchMethod"),title:r("searchMethod")},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:r("defaultStr")},(0,e.jsx)(t.Select,{"aria-label":r("defaultStr"),className:"w-100",size:"sm",value:d.defaultMethod,disabled:1===p(),onChange:e=>{o("defaultMethod",e.target.value,!0)}},d.useMeasure&&(0,e.jsx)("option",{value:c.SearchMethod.Measure},r("measure")),d.useCoordinate&&(0,e.jsx)("option",{value:c.SearchMethod.Coordinate},r("coordinate")),d.useReferent&&(0,e.jsx)("option",{value:c.SearchMethod.Referent},r("referent")),d.useLineAndMeasure&&(0,e.jsx)("option",{value:c.SearchMethod.LineAndMeasure},r("lineAndMeasure")))),(0,e.jsx)(i.SettingRow,{tag:"label",label:r("measure")},(0,e.jsx)(t.Switch,{checked:d.useMeasure,disabled:1===p()&&d.useMeasure,onChange:e=>{u(e,"useMeasure")}})),(0,e.jsx)(i.SettingRow,{tag:"label",label:r("coordinate")},(0,e.jsx)(t.Switch,{checked:d.useCoordinate,disabled:1===p()&&d.useCoordinate,onChange:e=>{u(e,"useCoordinate")}})),(0,e.jsx)(i.SettingRow,{tag:"label",label:r("referent")},(0,e.jsx)(t.Switch,{checked:d.useReferent,disabled:1===p()&&d.useReferent,onChange:e=>{u(e,"useReferent")}})),d.showLineAndMeasure&&(0,e.jsx)(i.SettingRow,{tag:"label",label:r("lineAndMeasure")},(0,e.jsx)(t.Switch,{checked:d.useLineAndMeasure,disabled:1===p()&&d.useLineAndMeasure,onChange:e=>{u(e,"useLineAndMeasure")}})))}function b(a){const{networkItem:l,onPropertyChanged:r}=a,d=e.hooks.useTranslation(s),u=Object.assign({},{},l),c=()=>{let e=0;return u.useRouteId&&e++,u.useRouteName&&e++,u.useMultiField&&e++,e},g=e=>u.routeIdFields[e].enabled,h=e=>{const t=u.routeIdFields.asMutable({deep:!0});t[e].enabled=!t[e].enabled,r("routeIdFields",t,!0)},m={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:p.TreeItemActionType.RenderOverrideItem,children:[{name:p.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:p.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemBody,children:[{name:p.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:p.TreeItemActionType.RenderOverrideItemDragHandle},{name:p.TreeItemActionType.RenderOverrideItemDetailToggle},{name:p.TreeItemActionType.RenderOverrideItemTitle},{name:p.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,e.jsx)(i.SettingSection,{title:d("defaultIdentifier")},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:d("routeIdentifier")},(0,e.jsx)(t.Select,{"aria-label":d("routeIdentifier"),className:"w-100",size:"sm",value:u.defaultIdentifer,disabled:1===c(),onChange:e=>{r("defaultIdentifer",e.target.value,!0)}},u.useRouteId&&(0,e.jsx)("option",{value:n.RouteId},d("routeId")),u.useRouteName&&(0,e.jsx)("option",{value:n.RouteName},d("routeName")),u.useMultiField&&(0,e.jsx)("option",{value:n.MultiField},d("routeFields")))),u.defaultIdentifer===n.MultiField&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(p.List,Object.assign({className:"list-routeid-fields pt-2",showCheckbox:!0,dndEnabled:!0,itemsJson:Array.from(u.routeIdFields).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:g(t),itemStateTitle:e.field.alias,itemStateCommands:[]}))),onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,a]=i;var s;s=a.map((e=>e.itemStateDetailContent)),r("routeIdFields",s,!0)},renderOverrideItemDetailToggle:(i,a)=>{const{itemJsons:s,itemJsons:[{itemStateDetailVisible:n,itemStateDetailContent:o}]}=a.props,[l]=s,r=+l.itemKey;return o?(0,e.jsx)(t.Checkbox,{"aria-expanded":!!n,className:"jimu-tree-item__detail-toggle mr-2",checked:g(r),onClick:e=>{h(r)}}):null},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;h(+i.itemKey)}},m))),u.supportsLines&&(0,e.jsx)("div",{style:{marginTop:"12px"}},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:d("lineIdentifier")},(0,e.jsx)(t.Select,{"aria-label":d("lineIdentifier"),className:"w-100",size:"sm",value:u.defaultLineIdentifier,disabled:1===c(),onChange:e=>{r("defaultLineIdentifier",e.target.value,!0)}},u.useLineId&&(0,e.jsx)("option",{value:o.LineId},d("lineId")),u.useLineName&&(0,e.jsx)("option",{value:o.LineName},d("lineName"))))))}function y(t){const{widgetId:i,useDataSourceId:a}=t;return e.ReactRedux.useSelector((e=>{var t;let s;s=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig;return(null!==(t=s.widgets[i].useDataSources)&&void 0!==t?t:[]).some((e=>e.dataSourceId===a))}))}var x=g(71442);function R(a){const{networkItem:n,onPropertyChanged:o,onQueryItemChanged:l}=a,r=e.hooks.useTranslation(s);return(0,e.jsx)("div",null,(null==n?void 0:n.sortOptions)&&(0,e.jsx)(i.SettingSection,{role:"group","aria-label":r("results"),title:r("results")},(0,e.jsx)(i.SettingRow,{"aria-label":r("sortResults"),flow:"wrap",label:r("sortResults")},(0,e.jsx)(x.Sort,{onChange:e=>{const{dataSourceId:t,mainDataSourceId:i,dataViewId:a,rootDataSourceId:s}=n.useDataSource,o={dataSourceId:t,mainDataSourceId:i,dataViewId:a,rootDataSourceId:s,fields:n.useDataSource.fields};let r=n.set("sortOptions",e);r=r.set("useDataSource",o),l(r,!0)},value:(0,e.Immutable)(n.sortOptions),useDataSource:n.useDataSource})),(0,e.jsx)(i.SettingRow,{flow:"no-wrap",tag:"label",label:r("expandByDefault")},(0,e.jsx)(t.Switch,{checked:n.expandByDefault,onChange:e=>{o("expandByDefault",e.target.checked,!0)}}))))}function k(a){const{networkItem:n,onPropertyChanged:o}=a,l=e.hooks.useTranslation(s),r=Object.assign({},{},n),d=(e,t)=>{e.target&&o(t,e.target.checked,!0)},u=()=>{let e=0;return r.searchSingle&&e++,r.searchMultiple&&e++,r.searchRange&&e++,e};return(0,e.jsx)(i.SettingSection,{role:"group","aria-label":l("searchMeasures"),title:l("searchMeasures")},(0,e.jsx)(i.SettingRow,{tag:"label",label:l("singleLabel")},(0,e.jsx)(t.Switch,{checked:r.searchSingle,disabled:1===u()&&r.searchSingle,onChange:e=>{d(e,"searchSingle")}})),(0,e.jsx)(i.SettingRow,{tag:"label",label:l("multipleLabel")},(0,e.jsx)(t.Switch,{checked:r.searchMultiple,disabled:1===u()&&r.searchMultiple,onChange:e=>{d(e,"searchMultiple")}})),(0,e.jsx)(i.SettingRow,{tag:"label",label:l("rangeLabel")},(0,e.jsx)(t.Switch,{checked:r.searchRange,disabled:1===u()&&r.searchRange,onChange:e=>{d(e,"searchRange")}})))}function M(a){const{networkItem:n,onPropertyChanged:o}=a,r=e.hooks.useTranslation(s),d=Object.assign({},{},n);return(0,e.jsx)(i.SettingSection,{title:r("spatialReference")},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:r("Default")},(0,e.jsx)(t.Select,{"aria-label":r("Default"),className:"w-100",size:"sm",value:d.defaultSpatialReferenceFrom,onChange:e=>{o("defaultSpatialReferenceFrom",e.target.value,!0)}},(0,e.jsx)("option",{value:l.Map},r("map")),(0,e.jsx)("option",{value:l.Lrs},r("lrs")))))}function C(a){const{networkItem:n,intl:o,onPropertyChanged:l}=a,r=e.hooks.useTranslation(s),d=Object.assign({},{},n);return(0,e.jsx)(i.SettingSection,{title:r("search")},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:r("radiusWithUnits",{units:(0,c.GetUnits)(d.unitsOfMeasure,o)})},(0,e.jsx)(t.NumericInput,{size:"sm",value:d.searchRadius,precision:3,onAcceptValue:e=>{l("searchRadius",e,!0)},"aria-label":r("radius"),className:"w-100"})))}const j=[{value:"Measure",label:"Measure"},{value:"ToMeasure",label:"To Measure"}],D=[{value:"DerivedRouteName",label:"Derived Route Name"},{value:"DerivedRouteID",label:"Derived Route ID"},{value:"DerivedRouteMeasure",label:"Derived Route Measure"},{value:"DerivedRouteToMeasure",label:"Derived Route ToMeasure"}],N="Distance",L="Distance",F=[{value:"Station",label:"Station"},{value:"FromStation",label:"From Station"},{value:"ToStation",label:"To Station"}],O="Network_OBJECTID",T=[{value:"ToRouteID",label:"To RouteID"},{value:"ToRouteName",label:"To Route Name"},{value:"ToRouteLineOrder",label:"To Route Line Order"},{value:"ToRouteFromDate",label:"To Route From Date"},{value:"ToRouteToDate",label:"To Route To Date"}];function A(a){const{networkItem:n,networkItems:o,onPropertyChanged:l,onPropertiesChanged:r}=a,d=e.hooks.useTranslation(s),[u,c]=e.React.useState(!1),[g,h]=e.React.useState(!1),[p,m]=e.React.useState(!1),[f,v]=e.React.useState();e.React.useEffect((()=>{var e,t,i,a;const s=n.lrsNetworkId,l=o.find((e=>s===e.derivedFromNetworkId&&e.isDerived));(null==l?void 0:l.isDerived)?v(!0):v(!1);const d=[],u=[],g=n.lrsFields,p=n.additionalFields;if(g)g.forEach((e=>{d.push(e)}));else{const e=n.defaultChecked;if(!e)return;e.forEach((e=>{d.push(e)}))}if(p)p.forEach((e=>{u.push(e)}));else{const e=w();if(!e)return;e.forEach((e=>{u.push(e.value)}))}if((null===(e=null==n?void 0:n.lrsFields)||void 0===e?void 0:e.length)===(null===(t=null==n?void 0:n.layerFields)||void 0===t?void 0:t.length)){h(!0);n.layerFields.forEach((e=>{S(e.jimuName,!0)}))}else h(!1);if((null===(i=null==n?void 0:n.additionalFields)||void 0===i?void 0:i.length)===(null===(a=w())||void 0===a?void 0:a.length)){m(!0);w().forEach((e=>{I(e.value,!0)}))}else m(!1);c(n.showAdditionalFields);r(["lrsFields","additionalFields"],[d,u],!0)}),[n.name,f]);const S=(e,t)=>{var i,a;const s=n.lrsFields.asMutable();if(e)if(t&&!(null===(i=n.lrsFields)||void 0===i?void 0:i.includes(e)))s.push(e);else if(!t&&(null===(a=n.lrsFields)||void 0===a?void 0:a.includes(e))){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}l("lrsFields",s,!0),s.length===n.layerFields.length?h(!0):h(!1)},I=(e,t)=>{var i,a;const s=n.additionalFields.asMutable();if(e)if(t&&!(null===(i=n.additionalFields)||void 0===i?void 0:i.includes(e)))s.push(e);else if(!t&&(null===(a=n.additionalFields)||void 0===a?void 0:a.includes(e))){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}l("additionalFields",s,!0),s.length===w().length?m(!0):m(!1)},w=()=>{const e=[];return e.push({label:j.at(0).label,value:j.at(0).value}),e.push({label:j.at(1).label,value:j.at(1).value}),f&&(e.push({label:D.at(0).label,value:D.at(0).value}),e.push({label:D.at(1).label,value:D.at(1).value}),e.push({label:D.at(2).label,value:D.at(2).value}),e.push({label:D.at(3).label,value:D.at(3).value})),e.push({label:L,value:N}),e.push({label:F.at(0).label,value:F.at(0).value}),e.push({label:F.at(1).label,value:F.at(1).value}),e.push({label:F.at(2).label,value:F.at(2).value}),(null==n?void 0:n.supportsLines)&&(e.push({label:T.at(0).label,value:T.at(0).value}),e.push({label:T.at(1).label,value:T.at(1).value}),e.push({label:T.at(2).label,value:T.at(2).value}),e.push({label:T.at(3).label,value:T.at(3).value}),e.push({label:T.at(4).label,value:T.at(4).value})),e},b=(()=>{const i=n.layerFields;if(!i)return;const a=[];return i.forEach((i=>{var s;a.push((0,e.jsx)("div",null,(0,e.jsx)(t.Checkbox,{checked:null===(s=n.lrsFields)||void 0===s?void 0:s.includes(i.jimuName),onClick:e=>{S(i.jimuName,e.currentTarget.checked)}}),(0,e.jsx)("span",{style:{paddingLeft:"0.5rem"}},i.alias)))})),a})(),y=(()=>{const i=[];return w().forEach((a=>{var s;i.push((0,e.jsx)("div",null,(0,e.jsx)(t.Checkbox,{checked:null===(s=n.additionalFields)||void 0===s?void 0:s.includes(a.value),onClick:e=>{I(a.value,e.currentTarget.checked)}}),(0,e.jsx)("span",{style:{paddingLeft:"0.5rem"}},a.label)))})),i})();return(0,e.jsx)(i.SettingSection,{role:"group"},(0,e.jsx)(i.SettingRow,{tag:"label","aria-label":d("advancedFieldDisplay"),flow:"no-wrap",label:d("advancedFieldDisplay")},(0,e.jsx)(t.Switch,{checked:u,onChange:e=>{l("showAdditionalFields",e.target.checked,!0),c(e.target.checked)}})),u&&(0,e.jsx)("div",{style:{paddingTop:"1rem"}},(0,e.jsx)(i.SettingRow,{"aria-label":d("networkFields"),flow:"no-wrap",label:d("networkFields")},(0,e.jsx)(t.Checkbox,{checked:g,onClick:e=>{(e=>{h(e);const t=n.lrsFields.asMutable(),i=n.layerFields;i&&(i.forEach((i=>{var a,s;const o=i.jimuName,l=e;if(o)if(l&&!(null===(a=n.lrsFields)||void 0===a?void 0:a.includes(o)))t.push(o);else if(!l&&(null===(s=n.lrsFields)||void 0===s?void 0:s.includes(o))){const e=t.indexOf(o);-1!==e&&t.splice(e,1)}})),r(["lrsFields","checkAllLrsFields"],[t,e],!0))})(e.currentTarget.checked)}})),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",marginTop:"0.7rem",marginBottom:"0.7rem",marginLeft:"0.7rem"}},b),(0,e.jsx)(i.SettingRow,{"aria-label":d("additionalFields"),flow:"no-wrap",label:d("additionalFields")},(0,e.jsx)(t.Checkbox,{checked:p,onClick:e=>{(e=>{m(e);const t=n.additionalFields.asMutable(),i=w();i&&(i.forEach((i=>{var a,s;const o=i.value,l=e;if(o)if(l&&!(null===(a=n.additionalFields)||void 0===a?void 0:a.includes(o)))t.push(o);else if(!l&&(null===(s=n.additionalFields)||void 0===s?void 0:s.includes(o))){const e=t.indexOf(o);-1!==e&&t.splice(e,1)}})),r(["additionalFields","checkAllAdditionalFields"],[t,e],!0))})(e.currentTarget.checked)}})),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",marginTop:"0.7rem",marginLeft:"0.7rem"}},y)))}function P(a){var n;const{intl:o,widgetId:l,index:r,networkItem:d,networkItems:u,onNetworkItemChanged:c}=a,g=e.hooks.useTranslation(s),[h,p]=e.React.useState(null==d?void 0:d.name),m=y({widgetId:l,useDataSourceId:null===(n=null==d?void 0:d.useDataSource)||void 0===n?void 0:n.dataSourceId});e.React.useEffect((()=>{(null==d?void 0:d.name)&&h!==(null==d?void 0:d.name)&&p(null==d?void 0:d.name)}),[null==d?void 0:d.name]);const f=e.React.useCallback(((e,t,i=!1)=>{let a;a=null==t?d.without(e):d.set(e,t),c(r,a,i)}),[c,r,d]),v=e.React.useCallback(((e,t,i=!1)=>{if(e.length!==t.length)return;let a;e.forEach(((e,i)=>{a=null==t[i]?null==a?d.without(e):a.without(e):null==a?d.set(e,t[i]):a.set(e,t[i])})),c(r,a,i)}),[c,r,d]),S=e.React.useCallback((e=>{p(e.target.value)}),[]),I=e.React.useCallback((e=>{e.trim().length>0?f("name",e,!0):p(null==d?void 0:d.name)}),[null==d?void 0:d.name,f]);return(0,e.jsx)("div",{className:"h-100"},(0,e.jsx)("div",{css:e.css`height: 100%; overflow:auto;`},d&&m&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,{role:"group","aria-label":g("networkLabel"),title:g("networkLabel")},(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(t.TextInput,{size:"sm",type:"text",className:"w-100",value:h,onChange:S,onAcceptValue:I,"aria-label":g("networkLabel")}))),(0,e.jsx)(w,{widgetId:l,networkItem:d,onPropertyChanged:f,onPropertiesChanged:v}),(d.useMeasure||d.useLineAndMeasure)&&(0,e.jsx)(k,{networkItem:d,onPropertyChanged:f}),(0,e.jsx)(b,{widgetId:l,networkItem:d,onPropertyChanged:f}),d.useCoordinate&&(0,e.jsx)(M,{networkItem:d,onPropertyChanged:f}),d.useCoordinate&&(0,e.jsx)(C,{intl:o,networkItem:d,onPropertyChanged:f}),(0,e.jsx)(R,{networkItem:d,onPropertyChanged:f,onQueryItemChanged:(e,t=!1)=>{c(r,e,t)}}),(0,e.jsx)(A,{networkItem:d,networkItems:u,onPropertyChanged:f,onPropertiesChanged:v}))))}var U=g(31027),E=g.n(U),z=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const B=t=>{const i=window.SVG,{className:a}=t,s=z(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",a);return i?e.React.createElement(i,Object.assign({className:n,src:E()},s)):e.React.createElement("svg",Object.assign({className:n},s))};function W(a){var n,o;const{widgetId:l,index:r,referentItem:d,onReferentItemChanged:u}=a,c=e.hooks.useTranslation(s),[g,h]=e.React.useState(null==d?void 0:d.name),[p,m]=e.React.useState(null===(n=null==d?void 0:d.layerFields[0])||void 0===n?void 0:n.name),f=y({widgetId:l,useDataSourceId:null===(o=null==d?void 0:d.useDataSource)||void 0===o?void 0:o.dataSourceId});e.React.useEffect((()=>{var e;(null==d?void 0:d.name)&&g!==(null==d?void 0:d.name)&&(h(null==d?void 0:d.name),m(null===(e=null==d?void 0:d.layerFields[0])||void 0===e?void 0:e.name)),(null==d?void 0:d.displayName)&&m(null==d?void 0:d.displayName)}),[null==d?void 0:d.name]);const v=e.React.useCallback(((e,t,i=!1)=>{let a;a=null==t?d.without(e):d.set(e,t),u(r,a,i)}),[u,r,d]),S=e.React.useCallback((e=>{h(e.target.value)}),[]),I=e.React.useCallback((e=>{e.trim().length>0?v("name",e,!0):h(null==d?void 0:d.name)}),[null==d?void 0:d.name,v]);return(0,e.jsx)("div",{className:"h-100"},(0,e.jsx)("div",{css:e.css`height: 100%; overflow:auto;`},d&&f&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(i.SettingSection,{role:"group","aria-label":c("networkLabel"),title:c("networkLabel")},(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(t.TextInput,{size:"sm",type:"text",className:"w-100",value:g,onChange:S,onAcceptValue:I,"aria-label":c("networkLabel")}))),(0,e.jsx)(i.SettingSection,{role:"group","aria-label":c("configureFields"),title:c("configureFields")},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:c("defaultStr")},(0,e.jsx)(t.Select,{"aria-label":c("defaultStr"),className:"w-100",size:"sm",value:p,onChange:e=>{(e=>{m(e);const t=d.set("displayName",e);u(r,t,!1)})(e.target.value)}},(()=>{const t=null==d?void 0:d.layerFields;if(0===(null==t?void 0:t.length))return[];const i=[];return t.forEach(((t,a)=>{i.push((0,e.jsx)("option",{key:a,value:t.name},t.name))})),i})()))))))}var J=function(e,t,i,a){return new(i||(i=Promise))((function(s,n){function o(e){try{r(a.next(e))}catch(e){n(e)}}function l(e){try{r(a.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,l)}r((a=a.apply(e,t||[])).next())}))};const H=g(62838);function _(a){var r,d;const{intl:u,widgetId:g,networkItems:h=[],mapWidgetIds:f,portalUrl:v,theme:S,runningQuery:w,setRunningQuery:b,onNewNetworkItemsAdded:y,onNetworkItemRemoved:x,onClearAll:R,onNetworkItemChanged:k,onNetworkOrderChanged:M,onMapWidgetChanged:C}=a,D=e.React.useRef(null),[N,L]=e.React.useState(!1),[F,O]=e.React.useState(!1),[T,A]=e.React.useState(!1),[U,E]=e.React.useState(-1),[z,_]=e.React.useState(!1),G=e.hooks.useTranslation(s,c.messages);let $=w;const V=()=>{const e=null==f?void 0:f[0],t=Q(e),i=[];return t.forEach((e=>{var t;const a=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,s=ie(a);i.includes(s)||i.push(s)})),i},Q=t=>{var i,a,s,n,o;let l=[];if(!t)return l;const r=(null===(i=null===window||void 0===window?void 0:window.jimuConfig)||void 0===i?void 0:i.isBuilder)?null===(s=null===(a=(0,e.getAppStore)().getState())||void 0===a?void 0:a.appStateInBuilder)||void 0===s?void 0:s.appConfig:null===(n=(0,e.getAppStore)().getState())||void 0===n?void 0:n.appConfig;if(!r)return l;const d=null===(o=r.widgets[t])||void 0===o?void 0:o.useDataSources;if(void 0!==d){d.map((e=>e.dataSourceId)).forEach((t=>{const i=e.DataSourceManager.getInstance().getDataSource(t),a=null==i?void 0:i.getDataSourcesByType(e.DataSourceTypes.FeatureLayer);a&&(l=l.concat(a))}))}return l},q=(t,i)=>J(this,void 0,void 0,(function*(){$=!0,b(!0);let a=!1;const s=t[i];let n=null;const o=e.SessionManager.getInstance().getSessionByUrl(v),l=o&&o.token?o.token:"";return n=l?{f:"json",token:l}:{f:"json"},a=yield K({method:"GET",url:s,params:n}).then((e=>{if(e.hasOwnProperty("lrs")){if(e.hasOwnProperty("networkLayers")||e.hasOwnProperty("eventLayers")||e.hasOwnProperty("calibrationPointLayers")||e.hasOwnProperty("intersectionLayers")||e.hasOwnProperty("nonLRSLayers")){return["networkLayers","eventLayers","calibrationPointLayers","intersectionLayers","nonLRSLayers"].forEach((t=>J(this,void 0,void 0,(function*(){if(e.hasOwnProperty(t)){if("eventLayers"===t){const i=e[t];e[t]=i.filter((e=>"esriLRSPointEventLayer"===e.type))}const i=e[t];(null==i?void 0:i.length)>0&&(yield Y(e[t],t))}})))),!0}return O(!0),setTimeout((()=>{O(!1)}),c.errorMessageDelay),!1}return L(!0),setTimeout((()=>{L(!1)}),c.errorMessageDelay),!1})).catch((e=>!1)),a})),K=t=>new Promise((function(i,a){const s={params:t.params,httpMethod:t.method};e.esri.restRequest.request(t.url,s).then((e=>{i(e)})).catch((e=>{i(e)}))})),Y=(e,t)=>J(this,void 0,void 0,(function*(){const i=null==f?void 0:f[0],a=Q(i),s=[],n=[];e.forEach((e=>{n.push(e.id)}));const o=[];a.forEach((e=>{var t,i;const a=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,l=null==e?void 0:e.getLayerDefinition(),r=-1===h.findIndex((t=>t.id===e.id)),d=n.findIndex((e=>e===l.id))>-1,u=-1===o.findIndex((e=>e===l.id));a&&r&&d&&u&&(o.push(l.id),s.push({dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(i=e.getRootDataSource())||void 0===i?void 0:i.id}))})),"networkLayers"===t&&0===n.length?(O(!0),setTimeout((()=>{O(!1)}),c.errorMessageDelay)):s.length>0&&(yield X(s,t))})),X=(t,i)=>J(this,void 0,void 0,(function*(){if(0===(null==t?void 0:t.length)||!i)return;const a=yield(()=>J(this,void 0,void 0,(function*(){let a=[];const s=[];return t.forEach((t=>{s.push(e.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,e.Immutable)(t)).then((s=>J(this,void 0,void 0,(function*(){const n=te(s);n||Promise.reject(Error(""));const o=null==s?void 0:s.getLayerDefinition(),l=null==n?void 0:n.url;let r;"networkLayers"===i?r=ie(l)+"/networkLayers/"+o.id:"eventLayers"===i?r=ie(l)+"/eventLayers/"+o.id:"calibrationPointLayers"===i?r=ie(l)+"/calibrationPointLayers/"+o.id:"intersectionLayers"===i?r=ie(l)+"/intersectionLayers/"+o.id:"nonLRSLayers"===i&&(r=ie(l)+"/nonLRSLayers/"+o.id),"networkLayers"===i?yield Z(s,t,n,r,l).then((t=>(t&&(a=a.concat([(0,e.Immutable)(t)])),a))):yield ee(s,t,n,r,i).then((t=>(t&&(a=a.concat([(0,e.Immutable)(t)])),a)))})))))})),yield Promise.all(s),a})))();y(a)})),Z=(t,i,a,s,r)=>{const d=e.SessionManager.getInstance().getSessionByUrl(v),u=d&&d.token?d.token:"";let h=null;return h=u?{f:"json",token:u}:{f:"json"},new Promise(((r,d)=>{K({method:"POST",url:s,params:h}).then((d=>{var u;if(!d)return;const h=d.routeIdFieldName,p=d.routeNameFieldName,m=d.fromDateFieldName,f=d.toDateFieldName,v=d.routeIdFields,S=!!h&&h.length>0,I=!!p&&p.length>0,w=!!v&&v.length>1,b=d.supportsLines;let y,x,R,k,M,C;const D=[],N=d.measurePrecision,L=d.isDerived,F=d.derivedFromNetworkId;let O=n.RouteId;b?O=n.RouteName:(null==v?void 0:v.length)>1&&(O=n.MultiField),b&&(x=d.lineIdFieldName,y=!!x&&x.length>0,M=d.lineNameFieldName,k=!!M&&M.length>0,R=d.lineOrderFieldName,k?C=o.LineName:y&&(C=o.LineId));const T=[];v&&v.forEach((e=>{h!==e&&p!==e&&T.push(e)}));const A=null==t?void 0:t.getSchema(),P=(null==A?void 0:A.fields)?Object.values(null==A?void 0:A.fields):[],U=P.find((e=>h===e.name)),E=P.find((e=>p===e.name)),z=P.find((e=>x===e.name)),B=P.find((e=>M===e.name)),W=P.filter((e=>T.includes(e.name))),J=P.find((e=>R===e.name)),H=P.find((e=>m===e.name)),_=P.find((e=>f===e.name));O===n.RouteName&&null==E&&(O=n.RouteId,(null==v?void 0:v.length)>1&&(O=n.MultiField)),U&&D.push(U.alias),E&&D.push(E.alias),W.length>1&&W.forEach((e=>{D.push(e.alias)})),D.push(j.at(0).value),D.push(j.at(1).value);const G=[];W.forEach((e=>{const t={field:e,enabled:!0};G.push(t)}));let $="";$=b?null==E?void 0:E.jimuName:null==U?void 0:U.jimuName;const V=[],Q={jimuFieldName:$,order:e.OrderRule.Asc};V.push(Q);const q=`${Math.random()}`.slice(2),K=null==a?void 0:a.getLabel();let Y=1e3;if("esriMeters"!==d.unitsOfMeasure)switch(d.unitsOfMeasure){case"esriDecimalDegrees":Y=.009;break;case"esriNauticalMiles":case"esriIntNauticalMiles":Y=.54;break;case"esriMiles":case"esriIntMiles":Y=.62;break;case"esriKilometers":Y=1;break;case"esriYards":case"esriIntYards":Y=5468;break;case"esriFeet":case"esriIntFeet":Y=1093.6;break;case"esriDecimeters":Y=1e4;break;case"esriInches":case"esriIntInches":Y=39370;break;case"esriCentimeters":Y=1e5;break;case"esriMillimeters":Y=1e6;break;case"esriPoints":Y=2834640}const X=[],Z=null==t?void 0:t.getLayerDefinition(),ee=[null==Z?void 0:Z.globalIdField,null==Z?void 0:Z.objectIdField],te=null==Z?void 0:Z.editFieldsInfo;te&&(ee.push(te.creationDateField),ee.push(te.creatorField),ee.push(te.editDateField),ee.push(te.editorField));const ie=null==Z?void 0:Z.fields,ae=null===(u=null==t?void 0:t.getSchema())||void 0===u?void 0:u.fields;for(const e in ae)ee.includes(e)||X.push(ae[e]);const se=[],ne=ie.find((e=>h===e.name)),oe=ie.find((e=>p===e.name)),le=ie.find((e=>m===e.name)),re=ie.find((e=>f===e.name)),de=ie.find((e=>x===e.name)),ue=ie.find((e=>M===e.name)),ce=ie.find((e=>R===e.name));se.push(ne.name),I&&se.push(oe.name),se.push(le.name),se.push(re.name),de&&se.push(de.name),ue&&se.push(ue.name),ce&&se.push(ce.name);const ge={id:t.id,name:K,configId:q,lrsNetworkId:d.lrsNetworkId,outputLineDsId:`${g}_output_line_${q}`,outputPointDsId:`${g}_output_point_${q}`,networkUrl:s,useRouteId:S,useRouteName:I,useLineId:y,useLineName:k,useMultiField:w,useMeasure:!0,useCoordinate:!0,useReferent:!0,useLineAndMeasure:b,showLineAndMeasure:b,useDataSource:i,defaultMethod:c.SearchMethod.Measure,enabledMethods:[c.SearchMethod.Measure],defaultIdentifer:O,defaultLineIdentifier:C,routeIdFieldName:h,routeNameFieldName:p,lineIdFieldName:x,lineNameFieldName:M,lineOrderFieldName:R,routeIdFields:G,routeIdField:U||void 0,routeNameField:E||void 0,lineIdField:z||void 0,lineNameField:B||void 0,lineOrderField:J||void 0,routeIdFieldNames:v,supportsLines:b,unitsOfMeasure:d.unitsOfMeasure,sortOptions:V,measurePrecision:N,defaultSpatialReferenceFrom:l.Lrs,searchRadius:Y,referent:!1,fromDateField:H,toDateField:_,fromDateFieldName:null==d?void 0:d.fromDateFieldName,toDateFieldName:null==d?void 0:d.toDateFieldName,searchSingle:!0,searchMultiple:!0,searchRange:!0,expandByDefault:!1,spatialReferenceInfo:{wkid:d.spatialReferenceInfo.wkid,wkt:d.spatialReferenceInfo.wkt},isDerived:L,derivedFromNetworkId:F,layerFields:X,defaultChecked:se,showAdditionalFields:!1,allFieldsDetails:P},he=(0,e.Immutable)(Object.assign({},ge,{networkInfo:ge}));r(he)}))}))},ee=(t,i,a,s,n)=>{const o=e.SessionManager.getInstance().getSessionByUrl(v),l=o&&o.token?o.token:"";let r=null;return r=l?{f:"json",token:l}:{f:"json"},new Promise(((o,l)=>{K({method:"POST",url:s,params:r}).then((l=>{var r,d;if(!l)return;const u=null==a?void 0:a.getLabel(),g=[],h=null==t?void 0:t.getLayerDefinition(),p=[null==h?void 0:h.globalIdField],m=null==h?void 0:h.editFieldsInfo;m&&(p.push(m.creationDateField),p.push(m.creatorField),p.push(m.editDateField),p.push(m.editorField));const f=null==h?void 0:h.fields;(null==f?void 0:f.length)>0&&f.forEach((e=>{"esriFieldTypeDate"===(null==e?void 0:e.type)&&p.push(null==e?void 0:e.name)}));const v=null===(r=null==t?void 0:t.getSchema())||void 0===r?void 0:r.fields;for(const e in v)p.includes(e)||g.push(v[e]);const S={id:t.id,layerId:l.id,name:u,networkUrl:s,type:n,useDataSource:i,referent:!0,defaultMethod:c.SearchMethod.Referent,displayName:null===(d=g[0])||void 0===d?void 0:d.name,layerFields:g,routeIdFieldName:null==l?void 0:l.routeIdFieldName,fromDateFieldName:null==l?void 0:l.fromDateFieldName,toDateFieldName:null==l?void 0:l.toDateFieldName,dateFormat:null==l?void 0:l.dateFormat,allFields:null==l?void 0:l.fields},I=(0,e.Immutable)(Object.assign({},S,{networkInfo:S}));o(I)}))}))},te=t=>t?t.type===e.DataSourceTypes.SceneLayer?t.getAssociatedDataSource():t:null,ie=e=>{let t=e;return t.includes("FeatureServer")&&(t=t.substring(0,t.indexOf("FeatureServer"))),t.includes("MapServer")&&(t=t.substring(0,t.indexOf("MapServer"))),t+"MapServer/exts/LRServer"},ae=e.React.useCallback((()=>{E(-1)}),[]),se=e.css`
    border-bottom: 1px
    solid var(--ref-palette-neutral-700);

    &.h-100 >
    .jimu-widget-setting--section {
      border-bottom: none;
    }

    .error-tips {
      font-style: italic;
      font-size: 12px;
      color: var(--ref-palette-neutral-1000);
      margin-top: 5px;
      .display-error-tips {
        width: calc(100% - 20px);
        margin: 0 4px;
        color: ${S.sys.color.error.main};
      }
    }

    .empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 255px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;

        .empty-placeholder-text {
          color: ${S.ref.palette.neutral[1e3]};
          font-size: ${e.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${S.ref.palette.neutral[800]};
        }
      }
    }
  `,ne={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:p.TreeItemActionType.RenderOverrideItem,children:[{name:p.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:p.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:p.TreeItemActionType.RenderOverrideItemBody,children:[{name:p.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:p.TreeItemActionType.RenderOverrideItemDragHandle},{name:p.TreeItemActionType.RenderOverrideItemTitle},{name:p.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};let oe=G("networkConfig");return(null===(r=h[U])||void 0===r?void 0:r.referent)&&(oe=G("referentConfig")),(0,e.jsx)("div",{ref:D,css:se,className:(0,e.classNames)("d-flex flex-column",{"h-100":0===h.length})},(0,e.jsx)(i.SettingSection,{className:"border-0"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(i.SettingRow,{label:G("selectMap")}),(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(i.MapWidgetSelector,{onSelect:e=>{C(e)},useMapWidgetIds:f})),(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(t.Button,{role:"button",type:"primary",className:"w-100 text-dark",onClick:()=>{if(L(!1),_(!1),O(!1),A(!1),void 0===(null==f?void 0:f[0]))A(!0),setTimeout((()=>{A(!1)}),c.errorMessageDelay);else{const e=V();e.length>1?(_(!0),setTimeout((()=>{_(!1)}),c.errorMessageDelay)):e.length>0?$||q(e,0).then((e=>{e||(L(!0),setTimeout((()=>{L(!1)}),c.errorMessageDelay))})).catch((e=>{$=!1,b(!1),console.error(e)})):(L(!0),setTimeout((()=>{L(!1)}),c.errorMessageDelay))}},title:G("importAll"),"aria-label":G("importAll")},G("loadLayers"))),h&&h.length>0&&(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(t.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:R,title:G("clearLayers"),"aria-label":G("clearLayers")},G("clearLayers"))),N&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(I,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,c.formatMessage)(u,"noLrsLayersTips")))),T&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(I,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,c.formatMessage)(u,"noMapSelectedTips")))),F&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(I,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,c.formatMessage)(u,"noNetworkLayersTips")))),z&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(m.Fragment,null,(0,e.jsx)(I,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,c.formatMessage)(u,"multipleServicesTips")))))),(0,e.jsx)(i.SettingSection,{className:(0,e.classNames)("pt-0 border-0",{"h-100":0===h.length})},(0,e.jsx)("div",{className:"setting-ui-unit-list"},(0,e.jsx)(p.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:h.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:U===t,itemStateTitle:e.name,itemStateCommands:[{label:G("removeNetwork"),iconProps:()=>({icon:H,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e,i=+t.itemKey;i===U&&ae(),x(i)}}]}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,a]=i;M(a.map((e=>e.itemStateDetailContent)))},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;var a;a=+i.itemKey,E(a===U?-1:a)}},ne)),h.length===U&&(0,e.jsx)(p.List,Object.assign({className:"setting-ui-unit-list-new",css:e.css`.jimu-tree-item__detail-toggle { display: none !important; }`,itemsJson:[{name:"......"}].map((e=>({itemStateDetailContent:e,itemKey:`${U}`,itemStateChecked:!0,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1},ne))),0===h.length&&(0,e.jsx)("div",{className:"empty-placeholder w-100 h-100"},(0,e.jsx)("div",{className:"empty-placeholder-inner"},(0,e.jsx)("div",{className:"empty-placeholder-icon"},(0,e.jsx)(B,{size:48})),(0,e.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",dangerouslySetInnerHTML:{__html:G("blankStatus")}}))),(0,e.jsx)(i.SidePopper,{isOpen:U>=0&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:ae,position:"right",trigger:null==D?void 0:D.current,title:oe},!1===(null===(d=h[U])||void 0===d?void 0:d.referent)?(0,e.jsx)(P,{intl:u,widgetId:g,index:U,total:h.length,networkItems:h,networkItem:h[U],onNetworkItemChanged:k}):(0,e.jsx)(W,{widgetId:g,index:U,total:h.length,referentItem:h[U],onReferentItemChanged:k}))))}var G=g(13089);let $;class V extends e.React.PureComponent{constructor(n){super(n),this.updateWidgetJson=(...e)=>{const[t,...i]=e,a=Object.assign(Object.assign({id:this.props.id},t));this.props.onSettingChange(a,...i)},this.updateConfigForOptions=(...e)=>{let t=null;const i=e.reduce(((e,[i,a,s])=>("networkItems"===i&&(null==s?void 0:s.dsUpdateRequired)&&(t=this.getAllDataSources(a)),e.set(i,a))),this.props.config);t?this.updateWidgetJson({config:i,useDataSources:Object.values(t.useDataSourceMap)},t.outputDataSources):this.updateWidgetJson({config:i})},this.tryRemoveNetworkItem=e=>{const t=this.props.config.networkItems[e],i=(0,a.getAppConfigAction)().appConfig;0===G.dataComponentsUtils.getWidgetsUsingDsOrItsDescendantDss(t.outputLineDsId,i.widgets).length?this.doRemoveNetworkItem(e,!0):this.setState({showRemoveNetworkItemWarning:!0,indexOfNetworkItemToRemove:e,dsToRemove:t.outputLineDsId})},this.beforeRemovingDataSource=()=>{this.doRemoveNetworkItem(this.state.indexOfNetworkItemToRemove)},this.doRemoveNetworkItem=(e,t=!1)=>{const i={dsUpdateRequired:t},a=this.props.config.networkItems.asMutable({deep:!0});a.splice(e,1),this.updateConfigForOptions(["networkItems",a,i])},this.afterRemovingDataSource=()=>{this.setState({showRemoveNetworkItemWarning:!1,indexOfNetworkItemToRemove:-1,dsToRemove:null})},this.addNetworkItems=(t,i=!0)=>{var a,s,n;let o=null!==(a=this.props.config.networkItems)&&void 0!==a?a:(0,e.Immutable)([]),l=null!==(n=null===(s=this.props.config.networkItems)||void 0===s?void 0:s.length)&&void 0!==n?n:0;t.forEach((t=>{o=e.Immutable.set(o,l,t),l++})),this.updateConfigForOptions(["networkItems",o,{dsUpdateRequired:i}])},this.updateNetworkItem=(t,i,a=!1)=>{var s;let n=null!==(s=this.props.config.networkItems)&&void 0!==s?s:(0,e.Immutable)([]);n=e.Immutable.set(n,t,i),this.updateConfigForOptions(["networkItems",n,{dsUpdateRequired:a}])},this.reOrderNetworkItems=e=>{this.updateConfigForOptions(["networkItems",e])},this.getAllDataSources=t=>(0,e.Immutable)(t).asMutable({deep:!0}).reduce(((t,a)=>{var s,n;const o=a.useDataSource,l=o.dataSourceId;if(t.useDataSourceMap[l]=t.useDataSourceMap[l]||o,t.useDataSourceMap[l].fields=o.fields,!a.referent){const o=e.DataSourceManager.getInstance().getDataSource(null===(s=a.useDataSource)||void 0===s?void 0:s.dataSourceId);if(o){const e=null===(n=(0,i.getOutputJsonOriginDs)(o))||void 0===n?void 0:n.getDataSourceJson(),s=this.getInitOutDataSource(this.props.widgetId,e,a,!0),l=this.getInitOutDataSource(this.props.widgetId,e,a,!1);t.outputDataSources.push(s),t.outputDataSources.push(l)}}return t}),{useDataSourceMap:{},outputDataSources:[]}),this.getInitOutDataSource=(e,t,i,a)=>{const s=a?this.getI18nMessage("outputDsLabelPoint",{label:i.name}):this.getI18nMessage("outputDsLabelLine",{label:i.name}),n=a?i.outputPointDsId:i.outputLineDsId,o=this.getInitSchema(s,i);return{id:n,type:null==t?void 0:t.type,label:s,originDataSources:[i.useDataSource],url:null==t?void 0:t.url,itemId:null==t?void 0:t.itemId,portalUrl:null==t?void 0:t.portalUrl,layerId:null==t?void 0:t.layerId,layers:null==t?void 0:t.layers,isOutputFromWidget:!0,isDataInDataSourceInstance:!0,schema:o,geometryType:a?"esriGeometryPoint":"esriGeometryPolyline"}},this.getInitSchema=(t="",i)=>{const a={},s=e.DataSourceManager.getInstance().getDataSource(i.useDataSource.dataSourceId),n=null==s?void 0:s.getSchema().fields.asMutable({deep:!0}),o=[];return Object.keys(n).forEach((e=>{o.push(n[e])})),j.forEach((t=>{o.push({alias:t.value,type:e.JimuFieldType.Number,jimuName:t.value,name:t.value})})),o.push({alias:N,type:e.JimuFieldType.String,jimuName:N,name:N}),F.forEach((t=>{o.push({alias:t.value,type:e.JimuFieldType.String,jimuName:t.value,name:t.value})})),D.forEach((t=>{o.push({alias:t.value,type:e.JimuFieldType.String,jimuName:t.value,name:t.value})})),o.push({alias:T.at(0).value,type:e.JimuFieldType.String,jimuName:T.at(0).value,name:T.at(0).value}),o.push({alias:T.at(1).value,type:e.JimuFieldType.String,jimuName:T.at(1).value,name:T.at(1).value}),o.push({alias:T.at(2).value,type:e.JimuFieldType.String,jimuName:T.at(2).value,name:T.at(2).value}),o.push({alias:T.at(3).value,type:e.JimuFieldType.Date,jimuName:T.at(3).value,name:T.at(3).value}),o.push({alias:T.at(4).value,type:e.JimuFieldType.Date,jimuName:T.at(4).value,name:T.at(4).value}),o.push({alias:O,type:e.JimuFieldType.String,jimuName:O,name:O}),null==o||o.forEach((e=>{a[null==e?void 0:e.jimuName]=e})),{label:t,idField:"OBJECTID",fields:a}},this.hideRemovePopup=()=>{this.setState({showRemoveNetworkItemWarning:!1})},this.getI18nMessage=(e,i)=>{const a=Object.assign({},s,t.defaultMessages,c.messages);return this.props.intl.formatMessage({id:e,defaultMessage:a[e]},i)},this.handleHighlishStyleChange=e=>{const t=this.props.config.highlightStyle.asMutable({deep:!0});"string"==typeof e&&(t.color=e),"number"==typeof e&&(t.size=e),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",t)})},this.handleLabelStyleChange=e=>{const t=this.props.config.labelStyle.asMutable({deep:!0});"string"==typeof e&&(t.color=e),"number"==typeof e&&(t.size=e),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("labelStyle",t)})},this.handleDefaultOffsetUnitChange=e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,a=this.props.config.resultConfig.asMutable({deep:!0});a.defaultOffsetUnit=i,this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",a)})},this.handleDefaultReferentChange=t=>{var i;const a=null===(i=null==t?void 0:t.target)||void 0===i?void 0:i.value,s=this.props.config.networkItems.find((e=>e.layerId===a)),n=this.props.config.resultConfig.asMutable({deep:!0});n.defaultReferentLayer=(0,e.Immutable)(s),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",n)})},this.handlePageSizeChange=e=>{const t=this.props.config.resultConfig.asMutable({deep:!0});t.pageSize=e,this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",t)})},this.handleHideMethodChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideMethod",t)})},this.handleHideNetworkChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideNetwork",t)})},this.handleHideRouteSearchByLine=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideRoute",t)})},this.handleDefaultNetworkChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetwork",e)})},this.removeAllLayers=(e=!1)=>{this.setRunningQuery(!1);const t={dsUpdateRequired:e};this.updateConfigForOptions(["networkItems",[],t])},this.mapWidgetIdUpdated=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.removeAllLayers()},this.networkSupportsLine=e=>{const{config:t}=this.props;if(!t.networkItems||0===t.networkItems.length)return;const i=t.networkItems.find((t=>t.name===e));return null==i?void 0:i.supportsLines},this.setRunningQuery=e=>{$=e},this.state={showLayerPanel:!1,noLrsLayers:!1,showRemoveNetworkItemWarning:!1,indexOfNetworkItemToRemove:-1,dsToRemove:null}}componentDidMount(){$=!1}getUnits(){return[this.getI18nMessage("inches"),this.getI18nMessage("points"),this.getI18nMessage("feet"),this.getI18nMessage("yards"),this.getI18nMessage("miles"),this.getI18nMessage("nauticalMiles"),this.getI18nMessage("millimeters"),this.getI18nMessage("centimeters"),this.getI18nMessage("meters"),this.getI18nMessage("kilometers"),this.getI18nMessage("decimalDegrees"),this.getI18nMessage("decimeters"),this.getI18nMessage("intFeet"),this.getI18nMessage("intMiles")]}getUnit(e){const t=this.getUnits();return e?(0,c.GetEsriUnits)(t[e],this.props.intl):(0,c.GetEsriUnits)(t[0],this.props.intl)}getHighlightStyleConfig(){if(this.props.config.highlightStyle)return this.props.config.highlightStyle;{const e=this.getDefaultHighlightStyleConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",e)}),e}}getDefaultHighlightStyleConfig(){return{color:c.highlightColor,size:3}}getLabelStyleConfig(){if(this.props.config.labelStyle)return this.props.config.labelStyle;{const e=this.getDefaultLabelStyleConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("labelStyle",e)}),e}}getDefaultLabelStyleConfig(){return{color:c.colorBlack,size:12}}getResultConfig(){if(this.props.config.resultConfig)return this.props.config.resultConfig;{const e=this.getDefaultResultsConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",e)}),e}}getDefaultResultsConfig(){return{pageSize:25}}getDefaultOffsetUnitsConfig(){let t=this.props.config.resultConfig.asMutable({deep:!0});return(0,c.isDefined)(t)||(t=this.getDefaultResultsConfig()),(0,c.isDefined)(t.defaultOffsetUnit)&&""!==t.defaultOffsetUnit||(t.defaultOffsetUnit=this.getUnit(),(0,c.isDefined)(t.defaultReferentLayer)||(t.defaultReferentLayer=(0,e.Immutable)(this.props.config.networkItems.find((e=>e.referent)))),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",t)})),t.defaultOffsetUnit}getDefaultReferentConfig(){const t=this.props.config;let i=this.props.config.resultConfig.asMutable({deep:!0});return(0,c.isDefined)(i)||(i=this.getDefaultResultsConfig()),i&&(0,c.isDefined)(i.defaultReferentLayer)&&t.networkItems.findIndex((e=>e.layerId===i.defaultReferentLayer.layerId))>-1||(i.defaultReferentLayer=(0,e.Immutable)(this.props.config.networkItems.find((e=>e.referent))),""===i.defaultOffsetUnit&&(i.defaultOffsetUnit=this.getUnit()),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",i)})}),200)),i.defaultReferentLayer.layerId}getHideMethodConfig(){return this.props.config.hideMethod}getHideNetworkConfig(){return this.props.config.hideNetwork}getHideRouteSearchByLineConfig(){return this.props.config.hideRoute}getDefaultNetworkConfig(){const e=this.props.config;if(this.props.config.defaultNetwork&&""!==e.defaultNetwork&&this.props.config.networkItems.findIndex((t=>t.name===e.defaultNetwork))>-1)return this.props.config.defaultNetwork;if(this.props.config.networkItems.filter((e=>!e.referent)).length>0){const e=this.props.config.networkItems.find((e=>!e.referent)).name;return setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetwork",e)})}),200),e}}render(){var a,s;const{config:n}=this.props,o=this.networkSupportsLine(this.getDefaultNetworkConfig());return(0,e.jsx)("div",{className:"setting-search-by-route h-100"},(0,e.jsx)("div",{className:"jimu-widget-setting setting-search-by-route__setting-content h-100"},(0,e.jsx)(_,{runningQuery:$,setRunningQuery:this.setRunningQuery,intl:this.props.intl,widgetId:this.props.id,networkItems:this.props.config.networkItems,mapWidgetIds:this.props.useMapWidgetIds,portalUrl:this.props.portalUrl,theme:this.props.theme,onNewNetworkItemsAdded:this.addNetworkItems,onNetworkItemChanged:this.updateNetworkItem,onClearAll:this.removeAllLayers,onNetworkItemRemoved:this.tryRemoveNetworkItem,onNetworkOrderChanged:this.reOrderNetworkItems,onMapWidgetChanged:this.mapWidgetIdUpdated}),0!==n.networkItems.length&&(0,e.jsx)("div",null,(0,e.jsx)(i.SettingSection,{role:"group",title:this.getI18nMessage("selectionSettings"),"aria-label":this.getI18nMessage("selectionSettings")},(0,e.jsx)(i.SettingRow,{label:this.getI18nMessage("selectionHighlight")},(0,e.jsx)(u.ColorPicker,{color:this.props.config.highlightStyle.color?this.props.config.highlightStyle.color:c.highlightColor,value:this.getHighlightStyleConfig().color||this.props.theme2.sys.color.surface.paper||"",onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("selectionHighlight")})),(0,e.jsx)(i.SettingRow,{flow:"wrap",label:this.getI18nMessage("graphicWidth")},(0,e.jsx)(t.NumericInput,{size:"sm",value:this.getHighlightStyleConfig().size||3,precision:1,min:0,max:15,step:.1,onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("graphicWidth"),className:"w-100"})),(0,e.jsx)(i.SettingRow,{label:this.getI18nMessage("labelColor")},(0,e.jsx)(u.ColorPicker,{color:this.props.config.labelStyle.color?this.props.config.labelStyle.color:c.colorBlack,value:this.getLabelStyleConfig().color||this.props.theme2.sys.color.surface.paper||"",onChange:this.handleLabelStyleChange,"aria-label":this.getI18nMessage("labelColor")})),(0,e.jsx)(i.SettingRow,{flow:"wrap",label:this.getI18nMessage("labelSize")},(0,e.jsx)(t.NumericInput,{size:"sm",value:this.getLabelStyleConfig().size,precision:1,min:0,max:30,step:.1,onChange:this.handleLabelStyleChange,"aria-label":this.getI18nMessage("labelSize"),className:"w-100"}))),(0,e.jsx)(i.SettingSection,{role:"group",title:this.getI18nMessage("resultSettings"),"aria-label":this.getI18nMessage("resultSettings")},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:this.getI18nMessage("resultsPageSize")},(0,e.jsx)(t.NumericInput,{size:"sm",value:this.getResultConfig().pageSize,precision:0,min:5,max:500,onChange:this.handlePageSizeChange,"aria-label":this.getI18nMessage("resultsPageSize"),className:"w-100"}))),(0,e.jsx)(i.SettingSection,{role:"group",title:(0,c.formatMessage)(this.props.intl,"displaySettings"),"aria-label":(0,c.formatMessage)(this.props.intl,"displaySettings")},(0,e.jsx)(i.SettingRow,{tag:"label",label:(0,c.formatMessage)(this.props.intl,"hideMethod")},(0,e.jsx)(t.Switch,{checked:this.getHideMethodConfig(),onChange:this.handleHideMethodChange})),(0,e.jsx)(i.SettingRow,{tag:"label",label:(0,c.formatMessage)(this.props.intl,"hideNetwork")},(0,e.jsx)(t.Switch,{checked:this.getHideNetworkConfig(),onChange:this.handleHideNetworkChange})),o&&(0,e.jsx)(i.SettingRow,{tag:"label",label:(0,c.formatMessage)(this.props.intl,"hideRoute")},(0,e.jsx)(t.Switch,{checked:this.getHideRouteSearchByLineConfig(),onChange:this.handleHideRouteSearchByLine})),(0,e.jsx)(i.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultNetwork")},(0,e.jsx)(t.Select,{"aria-label":this.getI18nMessage("defaultNetwork"),className:"w-100",size:"sm",value:this.getDefaultNetworkConfig(),disabled:1===n.networkItems.length,onChange:e=>{this.handleDefaultNetworkChange(e.target.value)}},n.networkItems.filter((e=>!e.referent)).map(((t,i)=>(0,e.jsx)("option",{key:i,value:t.name},t.name))))),this.props.config.networkItems&&(null===(a=this.props.config.networkItems.filter((e=>e.referent)))||void 0===a?void 0:a.length)>0&&(0,e.jsx)(m.Fragment,null,(0,e.jsx)(i.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultReferent")},(0,e.jsx)(t.Select,{"aria-label":this.getI18nMessage("defaultReferent"),value:this.getDefaultReferentConfig(),onChange:this.handleDefaultReferentChange},null===(s=this.props.config.networkItems.filter((e=>e.referent)))||void 0===s?void 0:s.map(((t,i)=>(0,e.jsx)("option",{key:i,value:t.layerId},t.name))))),(0,e.jsx)(i.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultOffsetUnit")},(0,e.jsx)(t.Select,{"aria-label":this.getI18nMessage("defaultOffsetUnit"),value:this.getDefaultOffsetUnitsConfig(),onChange:this.handleDefaultOffsetUnitChange},this.getUnits().map(((t,i)=>(0,e.jsx)("option",{key:i,value:(0,c.GetEsriUnits)(t,this.props.intl)},t)))))))),(0,e.jsx)(G.DataSourceRemoveWarningPopup,{dataSourceId:this.state.dsToRemove,isOpen:this.state.showRemoveNetworkItemWarning,toggle:this.hideRemovePopup,reason:G.DataSourceRemoveWaringReason.DataSourceRemoved,afterRemove:this.afterRemovingDataSource,beforeRemove:this.beforeRemovingDataSource})))}}function Q(e){g.p=e}})(),h})())}}}));