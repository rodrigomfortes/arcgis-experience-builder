System.register(["jimu-core","widgets/shared-code/lrs"],(function(e,t){var r={},n={};return{setters:[function(e){r.AbstractDataAction=e.AbstractDataAction,r.DataLevel=e.DataLevel,r.DataSourceStatus=e.DataSourceStatus,r.DataSourceTypes=e.DataSourceTypes,r.MutableStoreManager=e.MutableStoreManager,r.getAppStore=e.getAppStore,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){n.isDefined=e.isDefined}],execute:function(){e((()=>{var e={47626:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=r}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var i={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(i),o.d(i,{default:()=>R});var e=o(79244),t=o(47626);const r="object"==typeof global&&global&&global.Object===Object&&global;var n="object"==typeof self&&self&&self.Object===Object&&self;const a=r||n||Function("return this")();var s=/\s/;const u=function(e){for(var t=e.length;t--&&s.test(e.charAt(t)););return t};var l=/^\s+/;const c=function(e){return e?e.slice(0,u(e)+1).replace(l,""):e};const d=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const f=a.Symbol;var v=Object.prototype,g=v.hasOwnProperty,p=v.toString,S=f?f.toStringTag:void 0;const y=function(e){var t=g.call(e,S),r=e[S];try{e[S]=void 0;var n=!0}catch(e){}var o=p.call(e);return n&&(t?e[S]=r:delete e[S]),o};var m=Object.prototype.toString;const b=function(e){return m.call(e)};var h=f?f.toStringTag:void 0;const D=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":h&&h in Object(e)?y(e):b(e)};const I=function(e){return null!=e&&"object"==typeof e};const M=function(e){return"symbol"==typeof e||I(e)&&"[object Symbol]"==D(e)};var O=/^[-+]0x[0-9a-f]+$/i,P=/^0b[01]+$/i,j=/^0o[0-7]+$/i,w=parseInt;const A=function(e){if("number"==typeof e)return e;if(M(e))return NaN;if(d(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=d(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=c(e);var r=P.test(e);return r||j.test(e)?w(e.slice(2),r?2:8):O.test(e)?NaN:+e};var N=1/0;const x=function(e){return e?(e=A(e))===N||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const k=function(e){var t=x(e),r=t%1;return t==t?r?t-r:t:0};const L=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o};const T=Array.isArray;var F=f?f.prototype:void 0,J=F?F.toString:void 0;const C=function e(t){if("string"==typeof t)return t;if(T(t))return L(t,e)+"";if(M(t))return J?J.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r};const G=function(e){return null==e?"":C(e)};var $=a.isFinite,E=Math.min;const V=function(e){var t=Math[e];return function(e,r){if(e=A(e),(r=null==r?0:E(k(r),292))&&$(e)){var n=(G(e)+"e").split("e"),o=t(n[0]+"e"+(+n[1]+r));return+((n=(G(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round");var B=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))};class R extends e.AbstractDataAction{isSupported(r,n){var o;if(r.length>1)return Promise.resolve(!1);const i=r[0];if(1!==i.records.length)return Promise.resolve(!1);const a=i.records[0].getData(),s=JSON.parse(JSON.stringify(a)),{dataSource:u,records:l}=i,c=u.type===e.DataSourceTypes.FeatureLayer||u.type===e.DataSourceTypes.SceneLayer,d=n!==e.DataLevel.Records,f=i.dataSource,v=(null==f?void 0:f.supportSpatialInfo)&&(null==f?void 0:f.supportSpatialInfo()),g=n===e.DataLevel.Records&&0===(null==l?void 0:l.length),p=!u.isInAppConfig()&&!c;if(d||g||p||!v)return Promise.resolve(!1);if(!u||u.getStatus()===e.DataSourceStatus.NotReady)return Promise.resolve(!1);const S=(0,t.isDefined)(u.getOriginDataSources()[0])?u.getOriginDataSources()[0]:u,y=_(),m=null===(o=null==y?void 0:y.widgets)||void 0===o?void 0:o[this.widgetId];if(!(0,t.isDefined)(S))return Promise.resolve(!1);let b;return m.config.lrsLayers.forEach((e=>{e.id===S.id&&(b=e.networkInfo)})),b&&(0,t.isDefined)(s[b.routeIdFieldSchema.name])&&""!==s[b.routeIdFieldSchema.name]?Promise.resolve(!0):Promise.resolve(!1)}onExecute(r,n){return B(this,void 0,void 0,(function*(){var n;const o=r[0],{records:i,dataSource:a}=o,s=_(),u=null===(n=null==s?void 0:s.widgets)||void 0===n?void 0:n[this.widgetId],l=(0,t.isDefined)(a.getOriginDataSources()[0])?a.getOriginDataSources()[0]:a;let c;u.config.lrsLayers.forEach((e=>{e.id===l.id&&(c=e.networkInfo)}));const d=i[0].getData(),f=JSON.parse(JSON.stringify(d)),v={networkInfo:c,routeId:"",routeName:"",fromMeasure:null,toMeasure:null},g=Object.keys(f).find((e=>e===c.routeIdFieldSchema.name)),p=Object.keys(f).find((e=>{var t;return e===(null===(t=c.routeNameFieldSchema)||void 0===t?void 0:t.name)})),S=Object.keys(f).find((e=>"Measure"===e)),y=Object.keys(f).find((e=>"ToMeasure"===e));if(v.routeId=(0,t.isDefined)(g)?f[g]:null,v.routeName=(0,t.isDefined)(p)?f[p]:null,v.fromMeasure=(0,t.isDefined)(S)?f[S]:null,v.toMeasure=(0,t.isDefined)(y)?f[y]:null,isNaN(v.fromMeasure)||isNaN(v.toMeasure)||null===v.fromMeasure||null===v.toMeasure){const r=l.getIdField(),n=Object.keys(f).find((e=>"Network_OBJECTID"===e));let o=null;if(o=(0,t.isDefined)(n)?f[n]:f[r],null===o)return Promise.resolve(!1);const i=l,a={returnGeometry:!0,returnM:!0,where:`${l.getIdField()} = ${o}`};yield i.query(a).then((r=>B(this,void 0,void 0,(function*(){if(!(r.records.length>0))return Promise.resolve(!1);{let n=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Polyline"]).then((o=>{n=o[0];const i=new n(r.records[0].getGeometry());if(!(0,t.isDefined)(i))return Promise.resolve(!1);const a=i.getPoint(0,0),s=i.paths[i.paths.length-1].length-1,u=i.getPoint(i.paths.length-1,s);v.fromMeasure=V(a.m,c.measurePrecision),v.toMeasure=V(u.m,c.measurePrecision),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedNetworkDataSource",l),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"routeLocationParams",v)}))}}))))}else e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedNetworkDataSource",l),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"routeLocationParams",v);return Promise.resolve(!0)}))}}function _(){var t,r,n;return window.jimuConfig.isBuilder?null===(r=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===r?void 0:r.appConfig:null===(n=(0,e.getAppStore)().getState())||void 0===n?void 0:n.appConfig}})(),i})())}}}));