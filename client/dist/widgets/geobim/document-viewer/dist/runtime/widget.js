System.register(["jimu-core","jimu-ui","widgets/shared-code/geobim","jimu-core/react"],(function(e,t){var n={},o={},i={},l={};return{setters:[function(e){n.React=e.React,n.ReactRedux=e.ReactRedux,n.WidgetState=e.WidgetState,n.classNames=e.classNames,n.css=e.css,n.jsx=e.jsx},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Loading=e.Loading,o.WidgetPlaceholder=e.WidgetPlaceholder},function(e){i.ApsLogIn=e.ApsLogIn,i.GeoBIMProvider=e.GeoBIMProvider,i.HEADER_LINE_HEIGHT=e.HEADER_LINE_HEIGHT,i.ModelViewerProvider=e.ModelViewerProvider,i.ReactModelViewer=e.ReactModelViewer,i.UserTypeNotPermissible=e.UserTypeNotPermissible,i.areFeatureDocumentLinksEqual=e.areFeatureDocumentLinksEqual,i.areModelViewerLinkedDocumentsEqual=e.areModelViewerLinkedDocumentsEqual,i.areRecordArraysEqual=e.areRecordArraysEqual,i.defaultSharedMessages=e.defaultSharedMessages,i.geoBIMWidgetContainerStyle=e.geoBIMWidgetContainerStyle,i.hidableContainerStyle=e.hidableContainerStyle,i.loadingContainerStyle=e.loadingContainerStyle,i.modelViewerDisabledSelector=e.modelViewerDisabledSelector,i.modelViewerLinkedDocumentSelector=e.modelViewerLinkedDocumentSelector,i.selectionWarningStyle=e.selectionWarningStyle,i.setModelViewerDisabled=e.setModelViewerDisabled,i.useApsAuth=e.useApsAuth,i.useGeoBIM=e.useGeoBIM,i.useLinks=e.useLinks,i.useModelViewer=e.useModelViewer,i.useSharedMessages=e.useSharedMessages},function(e){l.useCallback=e.useCallback}],execute:function(){e((()=>{var e={8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},11532:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M6 17H5v-1h1zm0-3H5v1h1zm-2-2H3v1h1zm2 .728V12H5v1h1zM7.969 19H9v1H0v-1h1v-9h6.969zM7 11H2v8h5zm-3 3H3v1h1zm9-6.127v2.775l5.186-2.278-1.397-.614 1.074-.62 2.137.94v.589l-5.564 2.446L20 13.18v.616l-7.5 3.298L9 15.55v-1.09l3 1.32V7.872l-.353-.155L6 5.235V9H5V4.697c0-.297.175-.565.447-.685l6.334-2.789.719-.316L20 4.205v.59zm0 3.777v4.13l5.098-2.24zm5.186-7.15L12.5 2l-1.086.477-4.024 1.77a.276.276 0 0 0 0 .506l3.821 1.68L12.5 7zM4 16H3v1h1z" style="fill:currentColor;stroke-width:0"></path></svg>'},14321:e=>{"use strict";e.exports=o},38512:e=>{"use strict";e.exports=i},51334:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 3.5a3.5 3.5 0 1 0-7 0V6H3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-2V3.5l.005-.164A2.5 2.5 0 0 1 12.5 1l.164.005A2.5 2.5 0 0 1 15 3.5a.5.5 0 0 0 1 0M9 7H3v8h9V7H9m-1.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},68972:e=>{"use strict";e.exports=l},79244:e=>{"use strict";e.exports=n}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var r={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(r),s.d(r,{__set_webpack_public_path__:()=>C,default:()=>_});var e=s(79244),t=s(14321),n=s(38512);const o={_widgetLabel:"Document Viewer",_widgetDescription:"A widget to display and interact with 2D and 3D documents from Autodesk Construction Cloud.",widgetTitle:"Document Viewer",geobim_logInText:" to your Autodesk account to view documents.",noDocument:"No document to display.",geobim_multipleFeatures:"Multiple feature selection is currently not supported by the Document Viewer widget. Please select a single feature and continue.",noDocumentTitle:"(No Document Title)",documentLockDisabledMessage:"Make a selection to lock documents",documentUnlockedMessage:"Lock current document",documentLockedMessage:"Unlock current document"};s(11532);var i=s(8547),l=s.n(i),a=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const u=t=>{const n=window.SVG,{className:o}=t,i=a(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",o);return n?e.React.createElement(n,Object.assign({className:s,src:l()},i)):e.React.createElement("svg",Object.assign({className:s},i))};var c=s(51334),d=s.n(c),m=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const g=t=>{const n=window.SVG,{className:o}=t,i=m(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",o);return n?e.React.createElement(n,Object.assign({className:l,src:d()},i)):e.React.createElement("svg",Object.assign({className:l},i))};var p=s(68972);const{useState:v,useMemo:w,useRef:h}=e.React,{useSelector:y}=e.ReactRedux,b=(e,t)=>null!==(null!=e?e:null)&&null!==(null!=t?t:null)&&e.url===(null==t?void 0:t.url);var f=function(e,t,n,o){return new(n||(n=Promise))((function(i,l){function s(e){try{a(o.next(e))}catch(e){l(e)}}function r(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,r)}a((o=o.apply(e,t||[])).next())}))};const{useMemo:M}=e.React,x=(e,t,o,i)=>{const{geoBIMLoading:l,geoBIMInitialized:s}=(0,n.useGeoBIM)(),{bimDocument:r,documentLoading:a,multipleFeatureSelectionWarning:u,cancelMultipleFeatureSelectionWarning:c}=((e,t)=>{const{featureDocumentLinks:o,linksLoading:i,linksInitialized:l}=(0,n.useLinks)(),{hasMapWidget:s,geoBIMInitialized:r,selectedFeatures:a}=(0,n.useGeoBIM)(),u=y((t=>(0,n.modelViewerLinkedDocumentSelector)(e,t))),c=w((()=>null==u?void 0:u.asMutable({deep:!0})),[u]),[d,m]=v(null),[g,f]=v(!1),M=h(null),x=h(null),j=h(null),S=h(null);if(t||(0,n.areRecordArraysEqual)(S.current,a)||(S.current=a,a.length>1?f(!0):1===a.length&&f(!1)),(0,n.areModelViewerLinkedDocumentsEqual)(M.current,c)||(M.current=c,t&&!b(null==c?void 0:c.document,null==d?void 0:d.document)||(m(c),j.current=o,f(!1))),i&&((0,n.areFeatureDocumentLinksEqual)(x.current,j.current)||(x.current=j.current)),!(0,n.areFeatureDocumentLinksEqual)(x.current,o)&&l&&!i){x.current=o;const e=null==o?void 0:o.documents[0];t&&!b(e,null==d?void 0:d.document)||((null==o?void 0:o.documents.length)>0?(m({document:e,selectedIds:o.feature.bimIds}),j.current=o):(m(null),j.current=null))}const L=w((()=>!(r&&(!s||l))||i),[r,s,l,i]),I=(0,p.useCallback)((()=>{f(!1)}),[]);return w((()=>({bimDocument:d,documentLoading:L,multipleFeatureSelectionWarning:g,cancelMultipleFeatureSelectionWarning:I})),[I,d,L,g])})(e,t),d=M((()=>null==(null==r?void 0:r.document)?i("widgetTitle"):(null==r?void 0:r.document.displayName)||i("noDocumentTitle")),[r,i]),m=M((()=>({getAccessToken:()=>f(void 0,void 0,void 0,(function*(){return yield o()}))})),[o]),g=M((()=>!t&&(a||l||!s)),[a,s,l,t]);return M((()=>({modelViewerTitle:d,modelViewerOptions:m,bimDocument:r,documentLoading:a,widgetLoading:g,multipleFeatureSelectionWarning:u,cancelMultipleFeatureSelectionWarning:c})),[d,m,r,a,g,u,c])},{useMemo:j,useState:S,useEffect:L}=e.React,I=t=>(0,e.css)({label:"modelViewerHeader",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",lineHeight:n.HEADER_LINE_HEIGHT,fontSize:`${t.sys.typography.h5.fontSize}`,fontWeight:`${t.sys.typography.h5.fontWeight}`,fontcolor:`${t.sys.typography.h5.color}`,padding:t.sys.spacing(3),backgroundColor:t.sys.color.surface.paper,borderBottom:`solid 1px ${t.sys.color.divider.primary}`}),V=t=>(0,e.css)({label:"modelViewerAlert",width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"center","div.alert-panel":{width:"80% !important",marginBottom:`${t.sys.spacing(3)} !important`}}),D=t=>(0,e.css)({label:"noDocumentMessage",width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",fontcolor:t.sys.color.action.disabled.text}),k=o=>{const{bimDocument:i,theme:l,i18nMessage:s}=o,{viewerErrorMessage:r,documentVisible:a}=(t=>{var o;const{showModelViewer:i,viewDocument:l,viewerError:s}=(0,n.useModelViewer)(),{widgetState:r}=(0,n.useGeoBIM)(),[a,u]=S(!1),c=null===(o=null==t?void 0:t.document)||void 0===o?void 0:o.url,d=null==t?void 0:t.selectedIds,m=null==t?void 0:t.document.issue;L((function(){null!=c&&r!==e.WidgetState.Closed?(i(!0),u(!0),l(c,void 0,d,void 0!==m?[m]:void 0)):(i(!1),u(!1))}),[d,c,i,l,m,r]);const g=j((()=>null===s?null:null!=(null==s?void 0:s.errorCode)?`Code ${s.errorCode}: ${s.message}`:s.message),[s]);return j((()=>({viewerErrorMessage:g,documentVisible:a})),[a,g])})(i);return(0,e.jsx)("div",{css:(0,e.css)({label:"modelViewerWrapper",position:"relative",width:"100%",height:"100%"})},null!==r&&(0,e.jsx)("div",{css:V(l)},(0,e.jsx)(t.Alert,{text:r,"aria-live":"polite",open:!0,size:"medium",type:"warning",withIcon:!0})),null===r&&(0,e.jsx)(e.React.Fragment,null,!a&&(0,e.jsx)("div",{css:D(l)},s("noDocument")),(0,e.jsx)(n.ReactModelViewer,null)))},{useSelector:R,useDispatch:E}=e.ReactRedux,{useState:A}=e.React,O=o=>{const{theme:i,widgetId:l,i18nMessage:s}=o,r=R((e=>(0,n.modelViewerDisabledSelector)(l,e))),{apsAuthenticated:a,userHasPermission:c,geoBIMInitialized:d}=(0,n.useGeoBIM)(),{getApsAuthToken:m}=(0,n.useApsAuth)(),p=E(),{modelViewerTitle:v,modelViewerOptions:w,bimDocument:h,documentLoading:y,widgetLoading:b,multipleFeatureSelectionWarning:f,cancelMultipleFeatureSelectionWarning:M}=x(l,r,m,s),[j,S]=A(!1),L=y||!a||null==h,V=f&&!b,O=b&&!j||V,T=!c&&d;!j&&h&&S(!0);return(0,e.jsx)("div",{css:(0,n.geoBIMWidgetContainerStyle)(i),className:"jimu-widget widget-document-viewer"},(0,e.jsx)("div",{css:I(i)},v,(0,e.jsx)("div",{title:s(L?"documentLockDisabledMessage":r?"documentLockedMessage":"documentUnlockedMessage")},(0,e.jsx)(t.Button,{type:r?"primary":"default",onClick:()=>{(0,n.setModelViewerDisabled)(l,!r,p)},disabled:L,icon:!0},r?(0,e.jsx)(u,null):(0,e.jsx)(g,null)))),T&&(0,e.jsx)(n.UserTypeNotPermissible,{userTypeNotPermissibleLinkText:s("geobim_userTypeLink"),userTypeNotPermissibleText:s("geobim_userTypeNote",{widget_name:s("widgetTitle")}),theme:i}),!a&&!T&&(0,e.jsx)(n.ApsLogIn,{logInLinkText:s("geobim_logInLink"),loginMessageFirstLine:s("geobim_logInText"),loginMessageSecondLine:s("geobim_logInTip"),theme:i}),a&&!T&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(e.React.Fragment,null,b&&(0,e.jsx)("div",{css:(0,n.loadingContainerStyle)(i)},(0,e.jsx)(t.Loading,null)),V&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{css:D(i)},s("noDocument")),(0,e.jsx)("div",{css:(0,n.selectionWarningStyle)(i)},(0,e.jsx)(t.Alert,{text:s("geobim_multipleFeatures"),"aria-live":"polite",closable:!0,open:!0,onClose:()=>{M()},size:"medium",type:"warning",withIcon:!0}))),(0,e.jsx)("div",{css:(0,n.hidableContainerStyle)(i,O)},(0,e.jsx)(n.ModelViewerProvider,{options:w},(0,e.jsx)(k,{bimDocument:h,theme:i,i18nMessage:s}))))))},{useCallback:T}=e.React,_=t=>{const{useMapWidgetIds:i,id:l,intl:s,theme:r,widgetId:a,state:u,manifest:c}=t,{translateMessage:d}=(0,n.useSharedMessages)(s,c.translatedLocales),m=T(((e,t)=>{const i=Object.assign(Object.assign({},n.defaultSharedMessages.default),o);return d(e,i,t)}),[d]),g=null==i?void 0:i[0];return(0,e.jsx)(e.React.Fragment,null,!1,(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(n.GeoBIMProvider,{mapWidgetId:g,widgetId:a,widgetState:u},(0,e.jsx)(O,{i18nMessage:m,theme:r,widgetId:a}))))};function C(e){s.p=e}})(),r})())}}}));