System.register(["jimu-core","jimu-ui","widgets/shared-code/geobim"],(function(e,t){var s={},o={},n={};return{setters:[function(e){s.React=e.React,s.ReactRedux=e.ReactRedux,s.classNames=e.classNames,s.css=e.css,s.jsx=e.jsx,s.lodash=e.lodash},function(e){o.Alert=e.Alert,o.Loading=e.Loading,o.TextInput=e.TextInput,o.WidgetPlaceholder=e.WidgetPlaceholder},function(e){n.ApsLogIn=e.ApsLogIn,n.GeoBIMProvider=e.GeoBIMProvider,n.GeoBimFeatureServiceError=e.GeoBimFeatureServiceError,n.UserTypeNotPermissible=e.UserTypeNotPermissible,n.areIDocumentsEqual=e.areIDocumentsEqual,n.defaultSharedMessages=e.defaultSharedMessages,n.geoBIMWidgetContainerStyle=e.geoBIMWidgetContainerStyle,n.getFeatureAttribute=e.getFeatureAttribute,n.isDocumentRepositoryItem=e.isDocumentRepositoryItem,n.isNodeRepositoryItem=e.isNodeRepositoryItem,n.loadingContainerStyle=e.loadingContainerStyle,n.modelViewerDisabledSelector=e.modelViewerDisabledSelector,n.repositoryItemHasChildren=e.repositoryItemHasChildren,n.setModelViewerLinkedDocument=e.setModelViewerLinkedDocument,n.useDocuments=e.useDocuments,n.useGeoBIM=e.useGeoBIM,n.useSharedMessages=e.useSharedMessages}],execute:function(){e((()=>{var e={14321:e=>{"use strict";e.exports=o},23001:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m4 2 8 6-8 6z"></path></svg>'},35737:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m14 4-6 8-6-8z"></path></svg>'},37741:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M20 4.795v-.59L12.5.907l-.719.316-6.334 2.79A.75.75 0 0 0 5 4.696v5.4l.892.903H6V5.235l5.647 2.483.353.155v7.907l-1-.44v1.092l1.5.66 7.5-3.297v-.616l-5.564-2.068L20 8.665v-.59l-2.137-.94-1.074.62 1.397.615L13 10.648V7.873zm-1.902 8.744L13 15.78v-4.13zM12.5 7l-1.289-.567-3.821-1.68a.277.277 0 0 1 0-.506l4.024-1.77L12.5 2l5.686 2.5zm-7.025 5-.989-1H2.25l-.975 1H0v8h10v-8zM9 19H1v-4h8zm0-5H1v-1h.697l.975-1h1.396l.99 1H9z" style="fill:currentColor;stroke-width:0"></path></svg>'},38512:e=>{"use strict";e.exports=n},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=s}},t={};function r(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var i={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(i),r.d(i,{__set_webpack_public_path__:()=>ae,default:()=>ce});var e=r(79244),t=r(14321),s=r(38512);const o={_widgetLabel:"Document Explorer",_widgetDescription:"A widget to display project documents and folders from Autodesk Construction Cloud.",widgetTitle:"Document Explorer",geobim_logInText:" to your Autodesk account to view project folders and documents.",searchDocuments:"Search",noHub:"No documents to display.",noSearchResults:"No documents found.",noDocuments:"(No documents)",noProjects:"(No projects)",noAccess:"(No access)"};var n=r(37741),l=r.n(n),c=r(50170),a=r.n(c),d=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]])}return s};const u=t=>{const s=window.SVG,{className:o}=t,n=d(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",o);return s?e.React.createElement(s,Object.assign({className:r,src:a()},n)):e.React.createElement("svg",Object.assign({className:r},n))};var m=function(e,t,s,o){return new(s||(s=Promise))((function(n,r){function i(e){try{c(o.next(e))}catch(e){r(e)}}function l(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,l)}c((o=o.apply(e,t||[])).next())}))};const{useState:g,useCallback:p,useMemo:v,useEffect:f}=e.React,h=()=>{const{selectedFeatures:e,geoBIMError:t,currentGeoBIMView:o}=(0,s.useGeoBIM)(),{searchRepository:n,getRoot:r,useDocumentsReady:i}=(0,s.useDocuments)(),[l,c]=g(null),[a,d]=g(null),[u,h]=g(!0),[x,y]=g(""),[j,b]=g(null),[w,I]=g(!1),[S,M]=g(!1),[R,E]=g(!1),C=v((()=>{if(1!==e.length||null===a)return null;const t=e[0],o=(0,s.getFeatureAttribute)(t.feature,"projectId");for(const e of a)if(e.id===o)return e;return null}),[a,e]);f((function(){let e=!1;return(()=>{m(this,void 0,void 0,(function*(){var n;if((!i||null==o)&&t===s.GeoBimFeatureServiceError.NONE)return c(null),d(null),void h(!0);if(t===s.GeoBimFeatureServiceError.MULTIPLE_FEATURE_SERVICES||t===s.GeoBimFeatureServiceError.NO_FEATURE_SERVICE)return c(null),d(null),void h(!1);h(!0);const l=yield r(),a=null===l,u=null!==(n=null==l?void 0:l.children)&&void 0!==n?n:null;e||(c(l),d(u),h(!1),E(a))}))})(),()=>{e=!0}}),[o,t,r,i]),f((function(){let e=!1;return(()=>{m(this,void 0,void 0,(function*(){if(null===l||null==x||""===x||!i)return I(!1),b(null),void M(!1);I(!0),M(!0);const t=null!=C?C:l,s=yield n(t,x);e||(b(s),M(!1))}))})(),()=>{e=!0}}),[l,u,n,x,C,i]);const D=p((e=>{y(e)}),[]);return v((()=>({root:l,rootItems:a,rootUpdating:u,geoBIMError:t,selectedRootItem:C,setDocumentSearchText:D,searchResults:j,searchActive:w,searchUpdating:S,accessError:R})),[l,a,u,t,C,D,j,w,S,R])},x=t=>(0,e.css)({label:"documentExplorerControls",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",padding:t.sys.spacing(3),backgroundColor:t.sys.color.surface.paper,borderBottom:`solid 1px ${t.sys.color.divider.primary}`}),y=t=>(0,e.css)({label:"documentsContainer",height:"100%",overflow:"auto",position:"relative",backgroundColor:t.sys.color.surface.paper}),j=t=>(0,e.css)({label:"documentsLoadingContainer",position:"relative",height:"100%",backgroundColor:t.sys.color.surface.background},(0,s.loadingContainerStyle)(t)),b=t=>(0,e.css)({label:"treeContainer",minWidth:"fit-content",padding:t.sys.spacing(3)}),w=t=>(0,e.css)({label:"rootDisplayStyle",minWidth:"fit-content",marginLeft:t.sys.spacing(5)}),I=t=>(0,e.css)({label:"treeNodeStyle",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",padding:t.sys.spacing(1),minWidth:"fit-content",cursor:"pointer","&:hover":{backgroundColor:t.sys.color.primary.main}}),S=t=>(0,e.css)({label:"treeNodeIcon",margin:`0 ${t.sys.spacing(2)} 2px 0`}),M=t=>(0,e.css)({label:"treeNodeLoadingStyle",display:"inline-block",position:"relative",transform:"scale(0.3)",height:"12px",marginTop:t.sys.spacing(2),marginLeft:t.sys.spacing(2)}),R=t=>(0,e.css)({label:"treeChildrenStyle",minWidth:"fit-content",marginLeft:t.sys.spacing(6)}),E=t=>(0,e.css)({label:"noDocumentsStyle",padding:t.sys.spacing(1)}),C=t=>(0,e.css)({label:"treeDocumentStyle",padding:t.sys.spacing(1),minWidth:"fit-content",cursor:"pointer","&:hover":{backgroundColor:t.sys.color.primary.main}}),D=t=>(0,e.css)({label:"selectedTreeDocumentStyle",backgroundColor:t.sys.color.secondary.main},C(t)),O=t=>(0,e.css)({label:"noTreeMessageContainer",width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:t.sys.color.surface.background,fontcolor:t.sys.color.action.disabled.text,padding:t.sys.spacing(2)});var N=r(23001),k=r.n(N),T=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]])}return s};const L=t=>{const s=window.SVG,{className:o}=t,n=T(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",o);return s?e.React.createElement(s,Object.assign({className:r,src:k()},n)):e.React.createElement("svg",Object.assign({className:r},n))};var P=r(35737),B=r.n(P),_=function(e,t){var s={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(s[o[n]]=e[o[n]])}return s};const A=t=>{const s=window.SVG,{className:o}=t,n=_(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",o);return s?e.React.createElement(s,Object.assign({className:r,src:B()},n)):e.React.createElement("svg",Object.assign({className:r},n))};var F=function(e,t,s,o){return new(s||(s=Promise))((function(n,r){function i(e){try{c(o.next(e))}catch(e){r(e)}}function l(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,l)}c((o=o.apply(e,t||[])).next())}))};const{useMemo:G,useState:V,useCallback:W,useEffect:z}=e.React;const{useCallback:U,useState:H,createContext:q,useMemo:$}=e.React,{useSelector:J,useDispatch:K}=e.ReactRedux,Q=q(void 0);function X(t){const{modelViewerWidgetId:o,children:n}=t,r=K(),i=J((e=>(0,s.modelViewerDisabledSelector)(o,e))),[l,c]=H(null),a=$((()=>i||null==o||""===o),[i,o]),d=U((()=>{c(null)}),[]),u=U((e=>{a||null==e||(e.url===(null==l?void 0:l.url)&&(0,s.setModelViewerLinkedDocument)(o,null,null,r),(0,s.setModelViewerLinkedDocument)(o,e,null,r),c(e))}),[a,null==l?void 0:l.url,o,r]),m=$((()=>({selectedDocument:l,documentPreviewDisabled:a,previewDocument:u,clearDocumentSelection:d})),[d,a,u,l]);return(0,e.jsx)(Q.Provider,{value:m},n)}const{useContext:Y,useMemo:Z}=e.React;const ee=t=>{const{theme:o,documentItem:n}=t,{selectedDocument:r,previewDocument:i}=function(){const e=Y(Q);if(void 0===e)throw new Error("Must call useTree inside of DocumentsProvider");const{previewDocument:t,selectedDocument:s}=e;return Z((()=>({selectedDocument:s,previewDocument:t})),[t,s])}(),l=null!==r&&(0,s.areIDocumentsEqual)(n.document,r);return(0,e.jsx)("div",{onClick:()=>{i(n.document)},css:l?D(o):C(o)},n.label)},te=o=>{const{i18nMessage:n,theme:r,nodeItem:i,hidden:l}=o,{onToggleExpanded:c,nodeChildren:a,documentChildren:d,loading:u,accessError:m,expanded:g}=function(e){const{getChildren:t,useDocumentsReady:o}=(0,s.useDocuments)(),[n,r]=V(!0),[i,l]=V(!1),[c,a]=V(!1),[d,u]=V([]),[m,g]=V([]),[p,v]=V(!1),f=G((()=>(0,s.repositoryItemHasChildren)(e)&&null!==e.children),[e]);if(f&&!c){const t=e.children.filter(s.isNodeRepositoryItem),o=e.children.filter(s.isDocumentRepositoryItem);u(t),g(o),l(!0),a(!0)}z((function(){let n=!1;return(()=>{F(this,void 0,void 0,(function*(){if(!c||f||!o)return void r(!1);r(!0);const i=yield t(e);if(n)return;if(null===i)return u([]),g([]),v(!0),void r(!1);const l=i.filter(s.isNodeRepositoryItem),a=i.filter(s.isDocumentRepositoryItem);u(l),g(a),v(!1),r(!1)}))})(),()=>{n=!0}}),[c,t,f,e,o]);const h=W((()=>{a((e=>e||!0)),l((e=>!e))}),[]);return G((()=>({onToggleExpanded:h,nodeChildren:d,documentChildren:m,loading:n,accessError:p,expanded:i})),[p,m,i,n,d,h])}(i);return(0,e.jsx)("div",{hidden:l},(0,e.jsx)("div",{css:I(r),onClick:()=>{c()}},g?(0,e.jsx)("div",{css:S(r)},(0,e.jsx)(A,{size:"s"})):(0,e.jsx)("div",{css:S(r)},(0,e.jsx)(L,{size:"s"})),(0,e.jsx)("b",null,i.label)),(0,e.jsx)("div",{css:R(r),hidden:!g},(0,e.jsx)("div",{hidden:!u,css:M(r)},(0,e.jsx)(t.Loading,null)),(0,e.jsx)("div",{hidden:u},m&&(0,e.jsx)("div",{css:E(r)},n("noAccess")),!m&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",null,0===a.length?[]:a.map((t=>(0,e.jsx)(te,{key:t.id,i18nMessage:n,theme:r,nodeItem:t})))),(0,e.jsx)("div",null,0===d.length?0===a.length?[(0,e.jsx)("div",{key:"no-documents",css:E(r)},n("noDocuments"))]:[]:d.map((t=>(0,e.jsx)(ee,{key:t.id,theme:r,documentItem:t}))))))))},se=te,{useState:oe}=e.React,ne=t=>{const{i18nMessage:o,theme:n,root:r,rootItems:i,selectedRootItem:l,hidden:c}=t,[a,d]=oe(!1);return(0,e.jsx)("div",{hidden:c},(0,e.jsx)("div",{css:b(n)},null===r||null!==l?null:(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{css:I(n),onClick:()=>{d((e=>!e))}},a?(0,e.jsx)("div",{css:S(n)},(0,e.jsx)(A,{size:"s"})):(0,e.jsx)("div",{css:S(n)},(0,e.jsx)(L,{size:"s"})),(0,e.jsx)("b",null,r.label))),(0,e.jsx)("div",{css:null===l?w(n):(0,e.css)({label:"rootItemsDisplayStyle",minWidth:"fit-content",marginLeft:"0px"})},(null==i?void 0:i.length)>0?i.filter((e=>(0,s.isNodeRepositoryItem)(e))).map((t=>{const s=(e=>null!==l?e.id!==l.id:!a)(t);return(0,e.jsx)(se,{key:t.id,i18nMessage:o,theme:n,nodeItem:t,hidden:s})})):[(0,e.jsx)("div",{key:"no-projects",hidden:!a,css:E(n)},o("noProjects"))])))},{useMemo:re}=e.React,ie=o=>{const{i18nMessage:n,theme:r}=o,{apsAuthenticated:i,userHasPermission:l,geoBIMInitialized:c}=(0,s.useGeoBIM)(),{root:a,rootItems:d,rootUpdating:m,geoBIMError:g,selectedRootItem:p,setDocumentSearchText:v,searchResults:f,searchActive:w,searchUpdating:I,accessError:S}=h(),M=!l&&c,R=re((()=>e.lodash.debounce(v,700)),[v]);return(0,e.jsx)("div",{css:(0,s.geoBIMWidgetContainerStyle)(r),className:"jimu-widget widget-document-explorer"},M&&(0,e.jsx)(s.UserTypeNotPermissible,{userTypeNotPermissibleLinkText:n("geobim_userTypeLink"),userTypeNotPermissibleText:n("geobim_userTypeNote",{widget_name:n("widgetTitle")}),theme:r}),!i&&!M&&(0,e.jsx)(s.ApsLogIn,{logInLinkText:n("geobim_logInLink"),loginMessageFirstLine:n("geobim_logInText"),loginMessageSecondLine:n("geobim_logInTip"),theme:r}),i&&!M&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{css:x(r)},(0,e.jsx)(t.TextInput,{css:(0,e.css)({label:"searchBox",width:"100%"}),type:"text",allowClear:!0,disabled:m||null===a,prefix:(0,e.jsx)(u,{color:r.sys.color.divider.primary,currentColor:!0}),placeholder:n("searchDocuments"),onChange:e=>{R(e.target.value)}})),(0,e.jsx)("div",{css:y(r)},!m&&S?(0,e.jsx)("div",{key:"no-access",css:O(r),hidden:w},n("noAccess")):m||null!==a?(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{hidden:!m||w,css:j(r)},(0,e.jsx)(t.Loading,null)),(0,e.jsx)(ne,{key:null!==(E=null==a?void 0:a.id)&&void 0!==E?E:"no-hub",i18nMessage:n,theme:r,root:a,rootItems:d,selectedRootItem:p,hidden:m||w})):(0,e.jsx)("div",{key:"no-hub",css:O(r),hidden:w},(0,e.jsx)("div",{css:(0,e.css)({label:"noTreeMessageStyle",flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"})},n("noHub")),g===s.GeoBimFeatureServiceError.NO_FEATURE_SERVICE&&(0,e.jsx)("div",null,(0,e.jsx)(t.Alert,{fullWidth:!0,type:"warning",withIcon:!0,text:n("noGeoBIMFeatureServiceError")})),g===s.GeoBimFeatureServiceError.MULTIPLE_FEATURE_SERVICES&&(0,e.jsx)("div",null,(0,e.jsx)(t.Alert,{fullWidth:!0,type:"warning",withIcon:!0,text:n("multipleGeoBIMFeatureServicesError")}))),w?I?(0,e.jsx)("div",{css:j(r)},(0,e.jsx)(t.Loading,null)):null===f?(0,e.jsx)("div",{css:O(r)},n("noSearchResults")):(0,e.jsx)("div",{css:b(r)},(0,e.jsx)(se,{key:f.id,i18nMessage:n,theme:r,nodeItem:f})):null)));var E},{useCallback:le}=e.React,ce=n=>{const{useMapWidgetIds:r,intl:i,theme:c,widgetId:a,config:d,manifest:u}=n,{modelViewerWidgetId:m}=d,{translateMessage:g}=(0,s.useSharedMessages)(i,u.translatedLocales),p=le(((e,t)=>{const n=Object.assign(Object.assign({},s.defaultSharedMessages.default),o);return g(e,n,t)}),[g]),v=null==r?void 0:r[0],f=v;return(0,e.jsx)(e.React.Fragment,null,!f&&(0,e.jsx)(t.WidgetPlaceholder,{icon:l(),message:p("widgetTitle"),widgetId:a}),f&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.GeoBIMProvider,{mapWidgetId:v,widgetId:a},(0,e.jsx)(X,{modelViewerWidgetId:m},(0,e.jsx)(ie,{i18nMessage:p,theme:c})))))};function ae(e){r.p=e}})(),i})())}}}));