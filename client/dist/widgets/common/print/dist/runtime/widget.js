System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-theme"],(function(e,t){var l={},o={},n={},i={};return{setters:[function(e){l.AllDataSourceTypes=e.AllDataSourceTypes,l.BaseVersionManager=e.BaseVersionManager,l.DataSourceComponent=e.DataSourceComponent,l.DataSourceManager=e.DataSourceManager,l.DataSourceStatus=e.DataSourceStatus,l.DataSourceTypes=e.DataSourceTypes,l.Immutable=e.Immutable,l.React=e.React,l.ReactRedux=e.ReactRedux,l.ServiceManager=e.ServiceManager,l.SessionManager=e.SessionManager,l.UtilityManager=e.UtilityManager,l.WidgetState=e.WidgetState,l.appActions=e.appActions,l.appConfigUtils=e.appConfigUtils,l.classNames=e.classNames,l.css=e.css,l.defaultMessages=e.defaultMessages,l.esri=e.esri,l.focusElementInKeyboardMode=e.focusElementInKeyboardMode,l.getAppStore=e.getAppStore,l.hooks=e.hooks,l.jsx=e.jsx,l.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,l.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,l.lodash=e.lodash,l.moduleLoader=e.moduleLoader,l.polished=e.polished},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.Icon=e.Icon,o.Loading=e.Loading,o.LoadingType=e.LoadingType,o.NumericInput=e.NumericInput,o.Option=e.Option,o.Popper=e.Popper,o.Radio=e.Radio,o.SVG=e.SVG,o.Select=e.Select,o.Tab=e.Tab,o.Tabs=e.Tabs,o.TextArea=e.TextArea,o.TextInput=e.TextInput,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent,n.MapViewManager=e.MapViewManager,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.getAppThemeVariables=e.getAppThemeVariables,i.getThemeColorValue=e.getThemeColorValue}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=o},22167:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M4 4.796 4.796 4 8.02 7.224l3.184-3.184.796.796L8.816 8.02l3.144 3.144-.796.796L8.02 8.816 4.836 12l-.796-.796L7.224 8.02z"></path><path fill="#000" fill-rule="evenodd" d="m0 4 4-4h8l4 4v8l-4 4H4l-4-4zm1 .414L4.414 1h7.172L15 4.414v7.172L11.586 15H4.414L1 11.586z" clip-rule="evenodd"></path></svg>'},29435:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},55886:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M10.167 0H1.833A.845.845 0 0 0 1 .857v10.286c0 .473.373.857.833.857h8.334c.46 0 .833-.384.833-.857V.857A.845.845 0 0 0 10.167 0M2 11V1h8v10zm1.6-8h4.8c.331 0 .6.224.6.5s-.269.5-.6.5H3.6c-.331 0-.6-.224-.6-.5s.269-.5.6-.5m4.8 3H3.6c-.331 0-.6.224-.6.5s.269.5.6.5h4.8c.331 0 .6-.224.6-.5S8.731 6 8.4 6" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=n},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},68108:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#C5C5C5" fill-rule="evenodd" d="M2.4.8V4h-.8A1.6 1.6 0 0 0 0 5.6v3.2a1.6 1.6 0 0 0 1.136 1.532c.249.075.464-.143.464-.403 0-.182-.154-.323-.32-.396A.8.8 0 0 1 .8 8.8V5.6a.8.8 0 0 1 .8-.8h12.8a.8.8 0 0 1 .8.8v3.2a.8.8 0 0 1-.48.733c-.166.073-.32.214-.32.396 0 .26.215.478.464.403A1.6 1.6 0 0 0 16 8.8V5.6A1.6 1.6 0 0 0 14.4 4h-.8V.8a.8.8 0 0 0-.8-.8H3.2a.8.8 0 0 0-.8.8m10.4 0H3.2V4h9.6z" clip-rule="evenodd"></path><path fill="#C5C5C5" d="M5.2 10.4a.4.4 0 0 0 0 .8h5.6a.4.4 0 0 0 0-.8zM5.2 12.8a.4.4 0 0 0 0 .8h3.2a.4.4 0 0 0 0-.8z"></path><path fill="#C5C5C5" fill-rule="evenodd" d="M2.4 15.2V8.8H2A.4.4 0 0 1 2 8h12a.4.4 0 0 1 0 .8h-.4v6.4a.8.8 0 0 1-.8.8H3.2a.8.8 0 0 1-.8-.8m10.4-6.4v6.4H3.2V8.8z" clip-rule="evenodd"></path><path fill="#C5C5C5" d="M12 6c0-.22.18-.4.4-.4h.8a.4.4 0 0 1 0 .8h-.8A.4.4 0 0 1 12 6"></path></svg>'},79244:e=>{"use strict";e.exports=l},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'}},t={};function r(l){var o=t[l];if(void 0!==o)return o.exports;var n=t[l]={exports:{}};return e[l](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var l in t)r.o(t,l)&&!r.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var a={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(a),r.d(a,{__set_webpack_public_path__:()=>_t,default:()=>Bt});var e=r(79244),t=r(14321),l=r(62686);const o="CIMMarkerNorthArrow",n={color:"#000",size:"4px"};var i,u,s;!function(e){e.ExportWebMap="ExportWebMap",e.GetLayoutTemplatesInfo="GetLayoutTemplatesInfo",e.GetReportTemplatesInfo="GetReportTemplatesInfo"}(i||(i={})),function(e){e.CurrentMapExtent="CURRENT MAP EXTENT",e.CurrentMapScale="CURRENT MAP SCALE",e.SetMapScale="SET MAP SCALE"}(u||(u={})),function(e){e.Point="POINT",e.Inch="INCH",e.Centimeter="CENTIMETER",e.Millimeter="MILLIMETER"}(s||(s={}));const d={layoutOptions:{customTextElements:[],hasAuthorText:!0,hasCopyrightText:!0,hasLegend:!0,hasTitleText:!0},mapSurroundInfos:[],pageSize:null,pageUnits:null,webMapFrameSize:null},c={scalePreserved:!1,outScale:36978595.474472,layoutOptions:{titleText:"ArcGIS Web Map"},exportOptions:{dpi:96},printExtentType:u.CurrentMapExtent,attributionVisible:!1,forceFeatureAttributes:!0,wkid:null,wkidLabel:null,enableTitle:!0,legendEnabled:!0,enableMapPrintExtents:!0,enableOutputSpatialReference:!0,enableQuality:!0,enableFeatureAttribution:!0,enableMapSize:!0,overrideCommonSetting:!1,enableAuthor:!0,enableCopyright:!0,enableLegend:!0,enableScalebarUnit:!0,enableCustomTextElements:!0};var v,p,m,y,f,h,g,x,b;!function(e){e.LayoutTemplate="Layout Template",e.ReportTemplate="Report Template"}(v||(v={})),function(e){e.Classic="CLASSIC",e.Compact="COMPACT"}(p||(p={})),function(e){e.OrganizationService="ORGANIZATION SERVICE",e.Customize="CUSTOMIZE"}(m||(m={})),function(e){e.OrganizationTemplate="ORGANIZATION TEMPLATE",e.Customize="CUSTOMIZE"}(y||(y={})),function(e){e.Loading="LOADING",e.Success="SUCCESS",e.Error="ERROR"}(f||(f={})),function(e){e.PrintTemplate="PRINT TEMPLATE",e.PrintResult="PRINT RESULT"}(h||(h={})),function(e){e.ServiceLayout="Service Layout",e.CustomLayout="Custom Layout"}(g||(g={})),function(e){e.RPTT="RPTT",e.RPTX="RPTX"}(x||(x={})),function(e){e.ServiceReport="Service Report",e.CustomReport="Custom Report"}(b||(b={}));var w=r(68108),S=r.n(w);const I={_widgetLabel:"Print",printPlaceholder:"Select or switch to a webmap to enable print.",chooseMapTip:"Please select a map with 2D data.",chooseUseUtility:"Please select utility.",printTemplate:"Print template",printResult:"Print result",previewPrint:"Preview print extents",fileFormat:"File format",mapPrintingExtents:"Map printing extents",outputSpatialReference:"Output spatial reference",printQuality:"Print quality",featureAttribution:"Feature attribution",selectEditableSettings:"Select editable settings",currentMapExtent:"Current map extent",currentMapScale:"Current map scale",setMapScale:"Set map scale",useCurrentScale:"Use current scale",wellKnownId:"Enter a well-known ID ({wkid})",allowEditing:"Select settings that allow editing at runtime",includeAttribution:"Include attribution",includeAttributes:"Include attributes",includeLegend:"Include legend",templateConfiguration:"Template configuration",templateName:"Template name",printLayout:"Layout",MapOnlyOptions:"Map-only options",LayoutOptions:"Layout options",mapSize:"Map size",spatialReference:"Output spatial reference {WKID}",printAuthor:"Author",printCopyright:"Copyright",scaleBarUnit:"Scalebar unit",mapAttribution:"Map attribution",resultEmptyMessage:"Your printed files will appear here.",northArrow:"North arrow",includeNorthArrow:"Include north arrow",resultsNumber:"Results {number}",wkidPlaceholder:"Basemap: {wkid}"};var T=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};const O=t=>T(void 0,void 0,void 0,(function*(){return G(t).then((t=>e.ServiceManager.getInstance().fetchArcGISServerInfo(t).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(new Error(e))))))})),j=(e,t,l)=>T(void 0,void 0,void 0,(function*(){return G(t).then((t=>B(t,l,e)))}));const C=(e,t,l)=>T(void 0,void 0,void 0,(function*(){const o=k(null==t?void 0:t.utilityId);return le(e).then((n=>{let i=l;return B(e,v.LayoutTemplate).then((r=>T(void 0,void 0,void 0,(function*(){let a;if(n.supportCustomReport||n.supportReport){const l=(yield B(e,v.ReportTemplate))||[],o=E(l);i=i.set("reportTemplateChoiceList",o).set("defaultReportTemplate",null==n?void 0:n.defaultReportTemplate).set("defaultCustomReportItem",null==n?void 0:n.defaultCustomReportItem),a=yield M(l,n,t)}const u=yield R(n,t),s={templateTaskInfo:r,templatesInTask:null==n?void 0:n.templates,reportOption:a,defaultLayoutOptionInfo:u,printTemplateType:null==l?void 0:l.printTemplateType,printServiceType:o},d=N(s),c=A(null==n?void 0:n.templates,d);return i=i.set("printCustomTemplate",d).set("useUtility",t).set("formatList",null==n?void 0:n.formatList).set("defaultFormat",null==n?void 0:n.defaultFormat).set("layoutChoiceList",c).set("supportCustomLayout",n.supportCustomLayout||!1).set("supportReport",n.supportReport||!1).set("supportCustomReport",n.supportCustomReport||!1).setIn(["commonSetting","forceFeatureAttributes"],n.supportReport||n.supportCustomReport||!1),Promise.resolve(i)}))))}))})),R=(e,t)=>T(void 0,void 0,void 0,(function*(){var l;const o={layoutTypes:g.ServiceLayout};if((null==e?void 0:e.supportCustomLayout)&&(null==e?void 0:e.defaultCustomLayoutItem)){const n=yield j(null===(l=null==e?void 0:e.defaultCustomLayoutItem)||void 0===l?void 0:l.id,t,v.ReportTemplate),i=null==n?void 0:n[0];o.customLayoutItem=null==e?void 0:e.defaultCustomLayoutItem,o.templateInfo=i}return Promise.resolve(o)})),M=(e,t,l)=>T(void 0,void 0,void 0,(function*(){var o,n,i,r,a;if(!(null==t?void 0:t.supportCustomReport)||!(null==t?void 0:t.supportReport))return null;const u={reportTypes:b.ServiceReport};if((null==t?void 0:t.supportReport)&&(null==t?void 0:t.defaultReportTemplate)){let l;null==e||e.forEach((e=>{(null==e?void 0:e.reportTemplate)===(null==t?void 0:t.defaultReportTemplate)&&(l=null==e?void 0:e.reportOptions)})),u.report=null==t?void 0:t.defaultReportTemplate,u.reportOptions=l}if((null==t?void 0:t.supportCustomReport)&&(null==t?void 0:t.defaultCustomReportItem)){const e=yield j(null===(o=null==t?void 0:t.defaultCustomReportItem)||void 0===o?void 0:o.id,l,v.ReportTemplate),s=null===(n=null==e?void 0:e[0])||void 0===n?void 0:n.reportOptions;u.customReportItem={id:null===(i=null==t?void 0:t.defaultCustomReportItem)||void 0===i?void 0:i.id,title:(null===(r=null==e?void 0:e[0])||void 0===r?void 0:r.reportTemplate)||(null===(a=null==t?void 0:t.defaultCustomReportItem)||void 0===a?void 0:a.id)},u.reportOptions=s,u.reportTypes=b.CustomReport}return Promise.resolve(u)})),E=e=>{if(!e)return[];return e.filter((e=>function(e){if(!e)return null;let t=x.RPTX;const l=(null==e?void 0:e.reportSectionOverrides)||{};return Object.keys(l).forEach((e=>{const o=l[e];((null==o?void 0:o.fieldElements)||(null==o?void 0:o.fieldLabelElements))&&(t=x.RPTT)})),t}(null==e?void 0:e.reportOptions)===x.RPTX))},L=(e,t)=>{var l,o;if(!t)return e;const n=null===(l=null==t?void 0:t.customTextElements)||void 0===l?void 0:l.map((e=>{const t={};for(const l in e)t[l]=!0;return t})),i=P(t);return e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,e.layoutOptions.customTextElements=(null==t?void 0:t.customTextElements)||[],e.layoutOptions.elementOverrides=i,e.customTextElementEnableList=n||[],e.enableNorthArrow=!!J(i),e.enableLegend=e.hasLegend,e.enableAuthor=e.hasAuthorText,e.enableCopyright=e.hasCopyrightText,e.enableScalebarUnit=!0,e.hasLegend&&(null==e?void 0:e.layoutOptions)&&(e.layoutOptions.legendLayers=[]),(null===(o=e.layoutOptions)||void 0===o?void 0:o.scalebarUnit)||(e.layoutOptions.scalebarUnit="Miles"),e},N=e=>{const{templateTaskInfo:t,templatesInTask:l,reportOption:o,defaultLayoutOptionInfo:n,printServiceType:i,printTemplateType:r}=e,a=l?ee(l,i,r):[];return null==a?void 0:a.map((e=>{var l;let i;if(t&&0!==(null==t?void 0:t.length)?t.forEach((t=>{e.label===t.layoutTemplate&&(i=t)})):i=d,(null==e?void 0:e.layout)&&(e.layout=F(null==e?void 0:e.layout)),(null==e?void 0:e.format)&&(e.format=null===(l=null==e?void 0:e.format)||void 0===l?void 0:l.toLowerCase()),(null==i?void 0:i.webMapFrameSize)&&(e.mapFrameSize=null==i?void 0:i.webMapFrameSize,e.mapFrameUnit=null==i?void 0:i.pageUnits),(e=L(e,null==i?void 0:i.layoutOptions)).mapFrameUnit=null==i?void 0:i.pageUnits,e.selectedFormatList=[null==e?void 0:e.format],"boolean"!=typeof e.showLabels&&(e.showLabels=!0),o&&((null==o?void 0:o.customReportItem)&&(e.customReportItem=null==o?void 0:o.customReportItem),(null==o?void 0:o.report)&&(e.report=null==o?void 0:o.report),(null==o?void 0:o.reportOptions)&&(e.reportOptions=null==o?void 0:o.reportOptions),(null==o?void 0:o.reportTypes)&&(e.reportTypes=null==o?void 0:o.reportTypes)),n){(null==n?void 0:n.layoutTypes)&&(e.layoutTypes=null==n?void 0:n.layoutTypes),(null==n?void 0:n.customLayoutItem)&&(e.customLayoutItem=null==n?void 0:n.customLayoutItem);const t=null==n?void 0:n.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=null==t?void 0:t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=null==t?void 0:t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=null==t?void 0:t.webMapFrameSize))}return e}))},P=e=>{const t=(null==e?void 0:e.mapSurroundInfos)||[],l={};return null==t||t.forEach((e=>{e.type===o&&(e.visible=!0),l[e.name]=e})),l},A=(e,t)=>(null==e?void 0:e.map((e=>{e.layoutTemplate=F(null==e?void 0:e.layout);const l=$(null==e?void 0:e.layout);return null==t||t.forEach((t=>{(null==e?void 0:e.layout)===(null==t?void 0:t.layout)&&(e.mapFrameSize=null==t?void 0:t.mapFrameSize,e.mapFrameUnit=null==t?void 0:t.mapFrameUnit,e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,!l&&(e.layoutOptions=null==t?void 0:t.layoutOptions),e.customTextElementEnableList=null==t?void 0:t.customTextElementEnableList,e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e.enableNorthArrow=null==t?void 0:t.enableNorthArrow)})),e})))||[],k=t=>{const l=e.UtilityManager.getInstance().getUtilityJson(t);return"org"===(null==l?void 0:l.source)?m.OrganizationService:m.Customize};var D,U=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};!function(e){e.AsynchronousSubmit="esriExecutionTypeAsynchronous",e.SynchronousExecute="esriExecutionTypeSynchronous"}(D||(D={}));const V=(t,l)=>{let o=l;return(null==t?void 0:t.exportOptions)&&(o=o.set("exportOptions",Object.assign(Object.assign({},t.exportOptions||{}),(null==l?void 0:l.exportOptions)||{}))),(null==t?void 0:t.layoutOptions)&&(null==l?void 0:l.layoutOptions)&&(o=o.set("layoutOptions",Object.assign(Object.assign({},(null==t?void 0:t.layoutOptions)||{}),(null==l?void 0:l.layoutOptions)||{}))),(0,e.Immutable)(Object.assign(Object.assign({},t),o))},z=(e,t)=>{let l;return null==e||e.forEach(((e,o)=>{(null==e?void 0:e.templateId)===t&&(l=o)})),l},F=e=>e,$=e=>"map-only"===(e=>{var t,l;return null===(l=null===(t=null==e?void 0:e.replace(/\_/gi,"-"))||void 0===t?void 0:t.replace(/\s+/gi,"-"))||void 0===l?void 0:l.toLowerCase()})(e),W=(e,t)=>{let l=!1;return null==e||e.forEach((e=>{(null==e?void 0:e.templateId)===t&&(l=!0)})),l},G=t=>U(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));function B(t,l,o){return U(this,void 0,void 0,(function*(){const n={query:{"env:outSR":"","env:processSR":"",returnZ:!1,returnM:!1,returnTrueCurves:!1,returnFeatureCollection:!1,context:"",f:"json"},responseType:"json"},r=yield(a=t,T(void 0,void 0,void 0,(function*(){return e.ServiceManager.getInstance().fetchArcGISServerInfo(a).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(new Error(e))))})));var a;const u=r?e.SessionManager.getInstance().getSessionByUrl(r):null;if(o){const e={id:o};u&&(e.token=u.token),l===v.LayoutTemplate&&(u&&(n.query.token=u.token),n.query.Layout_Item_ID=JSON.stringify(e)),l===v.ReportTemplate&&(n.query.Report_Item_ID=JSON.stringify(e))}return function(t){return U(this,void 0,void 0,(function*(){var l;if(!t)return Promise.resolve(null);const o=`${null===(l=t.split("/GPServer"))||void 0===l?void 0:l[0]}/GPServer`,n=function(){var t,l;const o=(null===(t=(0,e.getAppStore)().getState().portalSelf)||void 0===t?void 0:t.helperServices)||{};return(null===(l=null==o?void 0:o.asyncPrintTask)||void 0===l?void 0:l.url)||null}(),r=(yield _(o))||{},{tasks:a,supportedOperations:u,executionType:s}=r;let d=s,c=null,v=null,p=null,m=null;const y=null==a?void 0:a.map((t=>function(t,l){return U(this,void 0,void 0,(function*(){if(!t||!l)return Promise.resolve(null);const o=`${l}/${t}`,n={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(o,n).then((e=>{var t;const l=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.name;return Promise.resolve(l)}))}))}))}(t,o).then((e=>{e===i.GetLayoutTemplatesInfo&&(c=`${o}/${t}`,v=`${c}/${u}`),e===i.GetReportTemplatesInfo&&(p=`${o}/${t}`,m=`${o}/${t}/${u}`)}))));if(yield Promise.all(y),n===t){const e=yield function(e){return U(this,void 0,void 0,(function*(){const t=`${null==e?void 0:e.split("/arcgis/")[0]}/arcgis/rest/services/Utilities/PrintingTools/GPServer`,l=(yield _(t))||{},{tasks:o,supportedOperations:n,executionType:i}=l;let r=null,a=null,u=null;return null==o||o.forEach((e=>{((null==e?void 0:e.includes("Layout"))||(null==e?void 0:e.includes("Layout")))&&(u=e)})),r=`${t}/${u}`,a=`${r}/${n}`,{layoutTemplatesInfoTaskUrl:r,layoutTemplatesInfoRequestUrl:a,executionType:i}}))}(o);c=e.layoutTemplatesInfoTaskUrl,v=e.layoutTemplatesInfoRequestUrl,d=e.executionType}return Promise.resolve({url:o,layoutTemplatesInfoTaskUrl:c,layoutTemplatesInfoRequestUrl:v,reportTemplatesInfoTaskUrl:p,reportTemplatesInfoRequestUrl:m,executionType:s,layoutTemplateTaskExecutionType:d})}))}(t).then((t=>{const{layoutTemplatesInfoRequestUrl:o,reportTemplatesInfoRequestUrl:i,reportTemplatesInfoTaskUrl:r,executionType:a,layoutTemplatesInfoTaskUrl:u,layoutTemplateTaskExecutionType:s}=t,d=l===v.ReportTemplate?i:o,c=l===v.LayoutTemplate?s:a;return d?(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(d,n).then((e=>U(this,void 0,void 0,(function*(){var o,i,a;if(c===D.AsynchronousSubmit){const i=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.jobId;return function(e,t,l,o){return U(this,void 0,void 0,(function*(){const n=`${e}/jobs/${t}/results/Output_JSON`;return new Promise(((e,t)=>{let i=0;const r=10,a=3e3,u=()=>{o(n,l).then((t=>{var l;(null===(l=null==t?void 0:t.data)||void 0===l?void 0:l.value)?e(t.data.value):(i++,i<r?setTimeout(u,a):e([]))})).catch((e=>{t(new Error(e))}))};u()}))}))}(l===v.ReportTemplate?r:u,i,n,t)}return Promise.resolve((null===(a=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.results[0])||void 0===a?void 0:a.value)||[])}))),(e=>Promise.reject(new Error(e)))).catch((e=>Promise.reject(new Error(e))))})):Promise.resolve(null)}))}))}function _(t){return U(this,void 0,void 0,(function*(){var l;if(!t)return Promise.resolve(null);const o=`${null===(l=t.split("/GPServer"))||void 0===l?void 0:l[0]}/GPServer`,n={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(o,n).then((e=>{var t,l;const o=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.tasks,n=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.executionType,i=n===D.SynchronousExecute?"execute":"submitJob";return Promise.resolve({tasks:o,supportedOperations:i,executionType:n})}))}))}))}function J(e={}){var t;let l=null;for(const n in e)(null===(t=null==e?void 0:e[n])||void 0===t?void 0:t.type)===o&&(l=n);return l}function q(e,t){const l=H(e,t),{reportsAvailable:o,elementOverridesAvailable:n}=l;return o&&n}function H(e,t){var l;const{defaultCustomReportItem:o,defaultReportTemplate:n,supportCustomReport:i,supportReport:r}=t,a=function(e){const{reportOptions:t,defaultCustomReportItem:l,defaultReportTemplate:o,supportCustomReport:n,supportReport:i,reportTypes:r}=e;if(!n&&!i)return!0;switch(r){case b.CustomReport:return t?Q(t):!l&&!o;case b.ServiceReport:return t?Q(t):!o}}({defaultCustomReportItem:o,defaultReportTemplate:n,supportCustomReport:i,supportReport:r,reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes});return{reportsAvailable:a,elementOverridesAvailable:function(e){if(!e)return!0;let t=!0;for(const l in e){K(e[l])||(t=!1)}return t}(null===(l=null==e?void 0:e.layoutOptions)||void 0===l?void 0:l.elementOverrides)}}function K(e){let t=!0;if(e.visible&&("CIMTableFrame"===e.type||"CIMGraphicElement"===e.type)){const l=null==e?void 0:e.exbDataSource;l&&0!==(null==l?void 0:l.length)||(t=!1)}return t}function Q(e){if(!(null==e?void 0:e.reportSectionOverrides))return!1;const t=(null==e?void 0:e.reportSectionOverrides)||{};let l=!0;return Object.keys(t).forEach(((e,o)=>{var n,i;const r=t[e];if((null==r?void 0:r.exbDatasource)&&0!==(null===(n=null==r?void 0:r.exbDatasource)||void 0===n?void 0:n.length)){const e=X()||[],t=null===(i=null==r?void 0:r.exbDatasource)||void 0===i?void 0:i[0],o=(null==t?void 0:t.rootDataSourceId)||(null==t?void 0:t.mainDataSourceId);(null==e?void 0:e.includes(o))||(l=!1)}else l=!1})),l}const X=()=>{var t;const l=(0,e.getAppStore)().getState(),o=(null==l?void 0:l.appStateInBuilder)?null===(t=null==l?void 0:l.appStateInBuilder)||void 0===t?void 0:t.appConfig:null==l?void 0:l.appConfig,n=null==o?void 0:o.dataSources,i=[];return Object.keys(n).forEach((t=>{const l=n[t];(null==l?void 0:l.type)!==e.DataSourceTypes.WebScene&&i.push(l.id)})),i.length>0?(0,e.Immutable)(i):void 0},Z=(e,t)=>{if(e&&0!==(null==e?void 0:e.length)&&t){let l=!0;const o=Y(null==t?void 0:t[0])||[],n=null==e?void 0:e[0],i=(null==n?void 0:n.rootDataSourceId)||(null==n?void 0:n.mainDataSourceId);return(null==o?void 0:o.includes(i))||(l=!1),l}return!0},Y=t=>{var l,o,n;const i=(0,e.getAppStore)().getState(),r=(null==i?void 0:i.appStateInBuilder)?null===(l=null==i?void 0:i.appStateInBuilder)||void 0===l?void 0:l.appConfig:null==i?void 0:i.appConfig,a=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[t],u=[],s=e.DataSourceManager.getInstance();return null===(n=null==a?void 0:a.useDataSources)||void 0===n||n.forEach((t=>{const l=s.getDataSource(t.dataSourceId);(null==l?void 0:l.type)===e.DataSourceTypes.WebMap&&u.push(t.dataSourceId)})),u.length>0?(0,e.Immutable)(u):void 0},ee=(t,l,o)=>{const n=t.map((t=>{var l;let o=(0,e.Immutable)(t);return o=o.set("layout",F(null==t?void 0:t.layout)),o=o.setIn(["layoutOptions","scalebarUnit"],"Miles").setIn(["layoutOptions","legendLayers"],null),o=o.set("reportTypes",b.ServiceReport).set("layoutTypes",g.ServiceLayout),$(null==o?void 0:o.layout)&&(o=o.set("exportOptions",Object.assign({width:800,height:1100},null==t?void 0:t.exportOptions))),null===(l=V((0,e.Immutable)(c),(0,e.Immutable)(o)))||void 0===l?void 0:l.asMutable({deep:!0})}));return te(n,l,o)},te=(e,t,l)=>{const o=((e,t)=>e===m.Customize||t===y.Customize?"custom":"org")(t,l);return e.map(((e,t)=>(e.templateId=`config_${o}_${t}`,e)))};function le(t){const l={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[o]=e;return o(t,l).then((e=>function(e){return U(this,void 0,void 0,(function*(){let t=!1,l=!1;const o=(null==e?void 0:e.parameters)||[],n="web_map_as_json",i="output_file",r="layout_item_id",a="layout_template",u="report_template",s="report_item_id";let d=[],c=[],v="pdf",p=!1,m=!1,y=!1,f="",h="",g="",x="";return null==o||o.forEach((e=>{var t,l;if("Format"===e.name){const o=(null===(t=null==e?void 0:e.choiceList)||void 0===t?void 0:t.map((e=>null==e?void 0:e.toLowerCase())))||[];if(e.defaultValue)v=null===(l=e.defaultValue)||void 0===l?void 0:l.toLowerCase();else if((null==o?void 0:o.length)>0){const e=[];null==o||o.forEach((t=>{(t.includes("pdf")||t.includes("png"))&&e.push(t)})),v=(null==e?void 0:e[0])||o[0]}c=o}})),null==o||o.forEach((e=>{if("Layout_Template"===e.name){const t=e.choiceList,l=e.defaultValue;t?d=null==t?void 0:t.map((e=>ie(e,c,v))):d.push(ie(l,c,v))}e.name.toLowerCase()===a&&(f=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===r&&(p=!0,h=null==e?void 0:e.defaultValue),e.name.toLowerCase()===u&&(y=!0,g=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===s&&(m=!0,x=null==e?void 0:e.defaultValue),"string"==typeof e.name&&e.name.toLowerCase()===n&&(t=!0),"string"==typeof e.name&&e.name.toLowerCase()===i&&(l=!0)})),Promise.resolve({templates:d,formatList:c,defaultFormat:v,defaultReportTemplate:g,defaultCustomReportItem:x,hasWebmapParam:t,hasOutputParam:l,supportCustomLayout:p,supportReport:y,supportCustomReport:m,defaultLayout:f,defaultCustomLayoutItem:h})}))}(null==e?void 0:e.data)))}))}function oe(t,l,o){var n,i,r,a;const u=e.UtilityManager.getInstance().utilityHasSignInError(t);let s=404===(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.httpStatus);400===(null===(i=null==o?void 0:o.details)||void 0===i?void 0:i.httpStatus)&&(null===(a=null===(r=null==o?void 0:o.details)||void 0===r?void 0:r.message)||void 0===a?void 0:a.includes("Item does not exist"))&&(s=!0),u||s?(l&&l(!0),e.UtilityManager.getInstance().reportUtilityState(t,!1,u)):(l&&l(!1),e.UtilityManager.getInstance().reportUtilityState(t,!0))}function ne(t){const l=e.DataSourceManager.getInstance().getDataSource(t);return l&&l.supportSpatialInfo&&!l.supportSpatialInfo()}function ie(e,t,l){const o=$(e)?{}:{layoutOptions:{legend:!1}},n=l||t[0]||"PNG32";return Object.assign({label:e,layout:e,format:n},o)}var re=r(30655),ae=r.n(re),ue=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const se=t=>{const l=window.SVG,{className:o}=t,n=ue(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:ae()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var de=r(94064),ce=r.n(de),ve=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const pe=t=>{const l=window.SVG,{className:o}=t,n=ve(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:ce()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var me=r(29435),ye=r.n(me),fe=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const he=t=>{const l=window.SVG,{className:o}=t,n=fe(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:ye()},n)):e.React.createElement("svg",Object.assign({className:i},n))},ge=t=>{const{label:l,className:o,children:n,flowWrap:i}=t,r=e.css`
    .title {
      font-size: 14px;
    }
  `;return(0,e.jsx)("div",{className:(0,e.classNames)("mb-2 align-items-center",{className:o,"d-flex":!i}),css:r},(0,e.jsx)("div",{className:(0,e.classNames)("title flex-grow-1",{"mb-2":i})},l),n)};var xe=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};const be=(e,t)=>{let l=1,o=e;return t.forEach((n=>{o===(null==n?void 0:n.title)&&(o=`${e} (${l})`,l++,be(o,t))})),o},we=e=>{const t=(e=>{var t;return e?null===(t=null==e?void 0:e.asMutable())||void 0===t?void 0:t.map((e=>e.resultId)):[]})(e);if(!t||0===(null==t?void 0:t.length))return"result_0";return`config_${Se(t)+1}`},Se=e=>{var t;if(!e||0===(null==e?void 0:e.length))return 0;const l=null==e?void 0:e.map((e=>{var t;const l=null===(t=null==e?void 0:e.split("_"))||void 0===t?void 0:t.pop();return l?Number(l):0}));return null===(t=null==l?void 0:l.sort(((e,t)=>t-e)))||void 0===t?void 0:t[0]};function Ie(e,t){return"print-extents-layer-"+e+"-"+t}function Te(e,t){return`exb-print-layer-${t}-${e}`}function Oe(e){return xe(this,void 0,void 0,(function*(){if(e)return(0,l.loadArcGISJSAPIModules)(["esri/kernel"]).then((([t])=>G(e).then((e=>{const l=t.id.findCredential(e);return Promise.resolve(null==l?void 0:l.token)}))))}))}function je(e,t,l,o,n,i){!function(e,t,l,o){var n;if(!(t&&e&&o&&l&&0!==(null===(n=Object.keys(e))||void 0===n?void 0:n.length)))return;Object.keys(e).forEach((n=>{const i=e[n];Ce(null==i?void 0:i.exbDataSource,t,l,o)}))}(e,l,o,n),i&&function(e,t,l,o){if(!(e&&t&&o&&l))return;const n=(null==t?void 0:t.reportSectionOverrides)||{};Object.keys(n).forEach((t=>xe(this,void 0,void 0,(function*(){const i=n[t];Ce(null==i?void 0:i.exbDatasource,e,l,o)}))))}(l,t,o,n)}function Ce(e,t,l,o){return xe(this,void 0,void 0,(function*(){var n;if((null==e?void 0:e.length)>0){const i=Z(e,o),r=null===(n=null==e?void 0:e[0])||void 0===n?void 0:n.dataSourceId;if(!i&&t){if(ne(r)){const e=yield Ee(r,l);t.view.map.tables.remove(e)}else{const e=Te(r,l);t.view.map.findLayerById(e)&&t.removeLayerFromMap(e)}}}}))}function Re(t,l,o,n,i){return xe(this,void 0,void 0,(function*(){return yield Promise.all(Object.keys(t).map((r=>xe(this,void 0,void 0,(function*(){const a=function(t){var l,o;const n=null==t?void 0:t.exbDataSource;if((null==n?void 0:n.length)>0){const i=null===(l=null==n?void 0:n[0])||void 0===l?void 0:l.dataSourceId,r=e.DataSourceManager.getInstance().getDataSource(i),a=r?r.getSelectedRecordIds():[];if((null==a?void 0:a.length)>0)if(null==t?void 0:t.dynamicTextElements){const e=null===(o=t.dynamicTextElements)||void 0===o?void 0:o.map((e=>(e.filterType="selected",e)));t.dynamicTextElements=e}else t.filterType="selected";return t}return t}(t[r]),u=null==a?void 0:a.exbDataSource;if((null==u?void 0:u.length)>0){const e=yield Me(u,l,o,n);if("CIMGraphicElement"===a.type&&(null==a?void 0:a.dynamicTextElements)){const t=null==a?void 0:a.dynamicTextElements,l=null==t?void 0:t.map((t=>(t.sourceLayerId=e,t)));a.dynamicTextElements=l}else t[r].sourceLayerId=e;delete t[r].exbDataSource,delete t[r].isDsOutputDs}"CIMLegend"===a.type&&(t[r].visible=i)}))))),Promise.resolve(t||{})}))}function Me(t,o,n,i){return xe(this,void 0,void 0,(function*(){var r,a;const u=Z(t,n),s=null===(r=null==t?void 0:t[0])||void 0===r?void 0:r.dataSourceId;let d;if(u){const l=e.DataSourceManager.getInstance(),o=l.getDataSource(s);if(!o)return l.createDataSourceByUseDataSource(null==t?void 0:t[0]).then((e=>{var t;return d=(null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.id)||"",Promise.resolve(d)}));d=(null===(a=null==o?void 0:o.layer)||void 0===a?void 0:a.id)||""}else d=Te(s,i),o&&!function(e,t){var l,o,n;const i=t.getAllJimuLayerViews().map((e=>{var t;return null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.id}))||[],r=(null===(n=null===(o=null===(l=t.view.map)||void 0===l?void 0:l.tables)||void 0===o?void 0:o.toArray())||void 0===n?void 0:n.map((e=>null==e?void 0:e.id)))||[];return i.concat(r).includes(e)}(d,o)&&(yield function(t,o,n){return xe(this,void 0,void 0,(function*(){const i=Te(o,n);if(t){const r=t.view.map.findLayerById(i),a=function(t){var l,o;return null===(o=null===(l=e.DataSourceManager.getInstance().getDataSource(t))||void 0===l?void 0:l.getDataSourceJson())||void 0===o?void 0:o.isOutputFromWidget}(o);if(!function(t){var l;const o=null===(l=e.DataSourceManager.getInstance().getDataSource(t))||void 0===l?void 0:l.getStatus();return o!==e.DataSourceStatus.NotCreated&&o!==e.DataSourceStatus.CreateError&&o!==e.DataSourceStatus.LoadError&&o!==e.DataSourceStatus.SaveError&&o!==e.DataSourceStatus.NotReady}(o))return;let u;const s=ne(o);if(r&&a)u=t.getJimuLayerViewByAPILayer(r);else if(s){const e=yield Ee(o,n),l=function(e,t){const l=e.view.map.tables.map((e=>e.id));return l.includes(null==t?void 0:t.id)}(t,e);l||t.view.map.tables.add(e)}else u=yield t.addLayerToMap(o,i);u&&(yield t.whenJimuLayerViewLoaded(u.id),u.layer.opacity=0,yield function(e,t){return xe(this,void 0,void 0,(function*(){var o,n,i,r;if(!(null===(n=null===(o=e.layer)||void 0===o?void 0:o.customParameters)||void 0===n?void 0:n.moveFeaturesToCenterWhenPrinting))return;const a=yield null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.queryFeatures({returnGeometry:!0}),u=(null==a?void 0:a.features)||[];if(0===u.length)return;const s=null===(r=t.view.extent)||void 0===r?void 0:r.center,d=null==e?void 0:e.layer;if("point"===d.geometryType){const[e]=yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic"]),o={type:"point",x:s.x,y:s.y,spatialReference:t.view.spatialReference},n=u.map((t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:o})));yield d.applyEdits({updateFeatures:n})}else if("polyline"===d.geometryType){const[e,o]=yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polyline"]),n=new o({hasZ:!1,hasM:!1,paths:[[[t.view.extent.center.x,t.view.extent.center.y],[t.view.extent.center.x+5,t.view.extent.center.y+5]]],spatialReference:t.view.spatialReference}),i=u.map((t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:n})));yield d.applyEdits({updateFeatures:i})}else if("polygon"===d.geometryType){const[e,o]=yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polygon"]),n=new o({hasZ:!1,hasM:!1,rings:[[[t.view.extent.xmin,t.view.extent.ymin],[t.view.extent.xmin,t.view.extent.ymax],[t.view.extent.xmax,t.view.extent.ymax],[t.view.extent.xmin,t.view.extent.ymin]]],spatialReference:t.view.spatialReference}),i=u.map((t=>new e({attributes:(null==t?void 0:t.attributes)||{},geometry:n})));yield d.applyEdits({updateFeatures:i})}}))}(u,t),yield u.whenCurrentLayerViewNotUpdating(),yield function(e,t){return xe(this,void 0,void 0,(function*(){var o,n,i;if(!(null===(o=null==e?void 0:e.view)||void 0===o?void 0:o.queryFeatureCount)||!(null==e?void 0:e.whenCurrentLayerViewNotUpdating))return!1;yield e.whenCurrentLayerViewNotUpdating();const r=null===(n=null==t?void 0:t.view)||void 0===n?void 0:n.extent,a=null==e?void 0:e.layer,u=yield null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.queryFeatureCount({geometry:r});if(0===u&&"point"===a.geometryType){const e={type:"point",x:t.view.extent.center.x,y:t.view.extent.center.y,spatialReference:t.view.spatialReference},o={},n=new Date;o[a.objectIdField]=n.getTime(),yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic"]).then((([t])=>{const l=new t({geometry:e,attributes:o});return a.applyEdits({addFeatures:[l]}).then((()=>Promise.resolve(!0)))}))}else if(0===u&&"polyline"===a.geometryType){const e={},o=new Date;e[a.objectIdField]=o.getTime(),yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polyline"]).then((([l,o])=>{const n=new l({geometry:new o({hasZ:!1,hasM:!1,paths:[[[t.view.extent.center.x,t.view.extent.center.y],[t.view.extent.center.x+5,t.view.extent.center.y+5]]],spatialReference:t.view.spatialReference}),attributes:e});return a.applyEdits({addFeatures:[n]}).then((()=>Promise.resolve(!0)))}))}else{if(0!==u||"polygon"!==a.geometryType)return Promise.resolve(!0);{const e={},o=new Date;e[a.objectIdField]=o.getTime(),yield(0,l.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/Polygon"]).then((([l,o])=>{const n=new l({geometry:new o({hasZ:!1,hasM:!1,rings:[[[t.view.extent.xmin,t.view.extent.ymin],[t.view.extent.xmin,t.view.extent.ymax],[t.view.extent.xmax,t.view.extent.ymax],[t.view.extent.xmin,t.view.extent.ymin]]],spatialReference:t.view.spatialReference}),attributes:e});return a.applyEdits({addFeatures:[n]}).then((()=>Promise.resolve(!0)))}))}}}))}(u,t),yield u.whenCurrentLayerViewNotUpdating())}}))}(o,s,i));return Promise.resolve(d)}))}function Ee(t,l){return xe(this,void 0,void 0,(function*(){const o=Te(t,l),n=e.DataSourceManager.getInstance().getDataSource(t),i=yield n.createJSAPILayerByDataSource();return i.id=o,i.opacity=0,i}))}function Le(e){return xe(this,void 0,void 0,(function*(){var t,o,n,i,r,a,s,d,c;const{printTemplateProperties:v,mapView:p,locale:m,utility:y,isSupportReport:f,useMapWidgetIds:h,widgetId:x}=e;try{const e=!1===(null==v?void 0:v.hasTitleText),c=!1===(null==v?void 0:v.hasLegend);let w=v.without("enableTitle","enableAuthor","enableOutputSpatialReference","enableMapPrintExtents","enableQuality","enableMapSize","enableFeatureAttribution","enableCopyright","enableLegend","enableMapAttribution","enableCustomTextElements","hasAuthorText","hasCopyrightText","hasLegend","hasTitleText","selectedFormatList","mapFrameSize","mapFrameUnit","legendEnabled","templateId","printExtentType","customTextElementEnableList");switch(null==v?void 0:v.printExtentType){case u.CurrentMapExtent:w=w.set("scalePreserved",!1);break;case u.CurrentMapScale:w=w.set("outScale",null===(t=null==p?void 0:p.view)||void 0===t?void 0:t.scale).set("scalePreserved",!0);break;case u.SetMapScale:w=w.set("scalePreserved",!0)}let S=null==w?void 0:w.asMutable({deep:!0});e&&(null===(o=null==S?void 0:S.layoutOptions)||void 0===o||delete o.titleText),c&&(null===(n=null==S?void 0:S.layoutOptions)||void 0===n||delete n.legendLayers);const I=null===(i=null==v?void 0:v.layoutOptions)||void 0===i?void 0:i.legendLayers;if(S.layoutOptions.legendLayers=I?null:[],S.showLabels=!0,v.layoutTypes!==g.CustomLayout&&v.reportTypes!==b.CustomReport||(S=yield function(e,t){return xe(this,void 0,void 0,(function*(){const o=e;return(0,l.loadArcGISJSAPIModules)(["esri/portal/PortalItem"]).then((l=>{const[n]=l;return O(t).then((t=>{var l,i;if(e.layoutTypes===g.CustomLayout&&(null===(l=e.customLayoutItem)||void 0===l?void 0:l.id)){const l=new n({id:e.customLayoutItem.id,portal:t});o.layoutItem=l}if(e.reportTypes===b.CustomReport&&(null===(i=e.customReportItem)||void 0===i?void 0:i.id)){const l=new n({id:e.customReportItem.id,portal:t});o.reportItem=l}return delete o.customLayoutItem,delete o.customReportItem,delete o.layoutTypes,delete o.reportTypes,Promise.resolve(o)}))}),(e=>Promise.resolve(o))).catch((e=>Promise.resolve(o)))}))}(S,y)),f){const e=yield function(e,t,l,o){return xe(this,void 0,void 0,(function*(){const n=(null==e?void 0:e.reportSectionOverrides)||{};return yield Promise.all(Object.keys(n).map((e=>xe(this,void 0,void 0,(function*(){var i;const r=n[e];if((null===(i=null==r?void 0:r.exbDatasource)||void 0===i?void 0:i.length)>0){const i=yield Me(null==r?void 0:r.exbDatasource,t,l,o);n[e].sourceId=i,delete n[e].exbDatasource}}))))),e&&(e.reportSectionOverrides=n),Promise.resolve(e||{})}))}(null==S?void 0:S.reportOptions,p,h,x);S.reportOptions=e}const T=(null===(r=null==S?void 0:S.layoutOptions)||void 0===r?void 0:r.elementOverrides)||{};if((null===(a=Object.keys(T))||void 0===a?void 0:a.length)>0){const e=yield Re(T,p,h,x,!!I);S.layoutOptions.elementOverrides=e}return(null==S?void 0:S.wkid)||(S.wkid=null===(d=null===(s=null==p?void 0:p.view)||void 0===s?void 0:s.spatialReference)||void 0===d?void 0:d.wkid),S=function(e,t){var l;const o=(null===(l=e.layoutOptions)||void 0===l?void 0:l.customTextElements)||[];let n=!1;o.forEach((e=>{e.date&&(n=!0)})),n||o.push({Date:(new Date).toLocaleString(t)});return e.layoutOptions.customTextElements=o,e}(S,m),Promise.resolve(S)}catch(e){return console.error(e),je(null===(c=null==v?void 0:v.layoutOptions)||void 0===c?void 0:c.elementOverrides,null==v?void 0:v.reportOptions,p,x,h,f),Promise.resolve(null)}}))}function Ne(e,t,l){const o=Pe(l);return e/(t?o.XDPI:o.YDPI)*2.54/100}function Pe(e){return e?{XDPI:e,YDPI:e}:function(){const e={XDPI:null,YDPI:null},t=window.screen;if(null==t?void 0:t.XDPI)e.XDPI=null==t?void 0:t.deviceXDPI,e.YDPI=null==t?void 0:t.deviceYDPI;else{const t=document.createElement("div");t.style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(t),e.XDPI=t.offsetWidth,e.YDPI=t.offsetHeight,t.parentNode.removeChild(t)}return e}()}var Ae=r(1888),ke=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};const{useState:De,useEffect:Ue,useRef:Ve}=e.React,ze=l=>{var o,i,r,a;const{jimuMapView:d,id:c,selectedTemplate:v,className:p,config:m}=l,y=e.hooks.useTranslation(I,t.defaultMessages),f=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.widgetsRuntimeInfo)||void 0===t?void 0:t[c]})),h=Ve(null),g=Ve(null),x=Ve(null),b=Ve(null),w=Ve(null===(o=null==d?void 0:d.view)||void 0===o?void 0:o.extent),S=Ve(null===(i=null==d?void 0:d.view)||void 0===i?void 0:i.scale),T=Ve(null),O=Ve(null),j=Ve(null),C=Ve(!1),R=e.css`
    .checkbox-con {
      color: var(--ref-palette-neutral-1100);
      font-size: ${e.polished.rem(14)};
      line-height: ${e.polished.rem(22)};
      margin: ${e.polished.rem(4)} 0 ${e.polished.rem(8)} 0;
    }
  `,[M,E]=De(!1),[L,N]=De(null===(r=null==d?void 0:d.view)||void 0===r?void 0:r.extent),[P,A]=De(null===(a=null==d?void 0:d.view)||void 0===a?void 0:a.scale);Ue((()=>{h.current=f,M&&((null==f?void 0:f.state)===e.WidgetState.Hidden||(null==f?void 0:f.state)===e.WidgetState.Closed?q():U())}),[f]),Ue((()=>(b.current=e.lodash.debounce(U,400),(0,e.loadArcGISJSAPIModules)(["esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Polygon","esri/geometry/Extent","esri/geometry/Point","esri/geometry/support/WKIDUnitConversion"]).then((e=>{g.current=e})),q)),[]),Ue((()=>{var e,t,l,o,n,i;const r=(null==v?void 0:v.templateId)!==(null===(e=x.current)||void 0===e?void 0:e.templateId),a=(null==v?void 0:v.printExtentType)!==(null===(t=x.current)||void 0===t?void 0:t.printExtentType),u=(null==v?void 0:v.outScale)!==(null===(l=x.current)||void 0===l?void 0:l.outScale),s=(null===(o=null==v?void 0:v.exportOptions)||void 0===o?void 0:o.dpi)!==(null===(i=null===(n=x.current)||void 0===n?void 0:n.exportOptions)||void 0===i?void 0:i.dpi),d=D();x.current=v,M&&(r||a||u||d||s)&&b.current()}),[v]),Ue((()=>{M&&L&&b.current()}),[L,P,m.previewBackgroundColor,m.previewOutLine,M]),Ue((()=>{var t,l;N(d?(0,e.Immutable)(JSON.parse(JSON.stringify(null===(l=null===(t=null==d?void 0:d.view)||void 0===t?void 0:t.extent)||void 0===l?void 0:l.toJSON()))):null)}),[d]),Ue((()=>(d&&k().then((()=>{var t,l;O.current=null===(t=T.current)||void 0===t?void 0:t.watch((()=>{var e;return null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.extent}),(()=>{var t,l;const o=JSON.parse(JSON.stringify(null===(t=null==d?void 0:d.view)||void 0===t?void 0:t.extent.toJSON()));N((0,e.Immutable)(o)),w.current=null===(l=null==d?void 0:d.view)||void 0===l?void 0:l.extent})),j.current=null===(l=T.current)||void 0===l?void 0:l.watch((()=>{var e;return null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.scale}),(()=>{var e;const t=null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.scale;A(t),S.current=t}))})),()=>{var e,t,l,o,n,i;(null===(e=O.current)||void 0===e?void 0:e.remove)&&(null===(l=null===(t=O.current)||void 0===t?void 0:t.remove)||void 0===l||l.call(t)),(null===(o=j.current)||void 0===o?void 0:o.remove)&&(null===(i=null===(n=j.current)||void 0===n?void 0:n.remove)||void 0===i||i.call(n))})),[d]);const k=()=>ke(void 0,void 0,void 0,(function*(){return T.current||(T.current=yield(0,e.loadArcGISJSAPIModule)("esri/core/reactiveUtils")),T.current})),D=()=>{var e,t,l,o,n,i;if(!$(null==v?void 0:v.layout))return!1;const r=(null===(e=null==v?void 0:v.exportOptions)||void 0===e?void 0:e.width)!==(null===(l=null===(t=x.current)||void 0===t?void 0:t.exportOptions)||void 0===l?void 0:l.width),a=(null===(o=null==v?void 0:v.exportOptions)||void 0===o?void 0:o.height)!==(null===(i=null===(n=x.current)||void 0===n?void 0:n.exportOptions)||void 0===i?void 0:i.height);return r||a},U=e.hooks.useEventCallback((()=>{var t,l,o;if((null===(t=h.current)||void 0===t?void 0:t.state)===e.WidgetState.Hidden||(null===(l=h.current)||void 0===l?void 0:l.state)===e.WidgetState.Closed)return;const i=J(),r=g.current[1],a=(null==m?void 0:m.previewOutLine)||n,s=(null==m?void 0:m.previewBackgroundColor)||"rgba(0,216,237,0.3)",d=new r({geometry:(null===(o=x.current)||void 0===o?void 0:o.printExtentType)===u.CurrentMapExtent?F():z(),symbol:{type:"simple-fill",color:V(s),outline:{color:V(a.color,1),width:a.size}}});i.graphics.removeAll(),i.graphics.add(d),C.current||q()})),V=(t,l=.3)=>{if(!t)return null;let o;if(t.includes("var(")||t.includes("#")){const n=(0,Ae.getThemeColorValue)(t,(0,Ae.getAppThemeVariables)());o=e.polished.rgba(n,l)}if(t.includes("rgba")){const n=t.split("(")[1].split(")")[0].split(","),i=n[n.length-1];o=Number(i)>.6?e.polished.rgba(t,l):t}return o},z=()=>{var e,t,l,o,n;const{mapFrameSize:i,mapFrameUnit:r,layout:a}=null===(e=x.current)||void 0===e?void 0:e.asMutable({deep:!0}),s=_(),d=B(r),c=g.current[2],v=$(a),p=null===(t=null==w?void 0:w.current)||void 0===t?void 0:t.center,m=(null===(l=x.current)||void 0===l?void 0:l.printExtentType)===u.SetMapScale?null===(o=x.current)||void 0===o?void 0:o.outScale:S.current,y=v?G():{width:i[0],height:i[1]},f={x:v?1:d.x/(null==s?void 0:s.x),y:v?1:d.y/(null==s?void 0:s.y)},h={x:y.width,y:y.height},b=(null==p?void 0:p.x)-(null==h?void 0:h.x)/2*m*(null==f?void 0:f.x),I=(null==p?void 0:p.y)-(null==h?void 0:h.y)/2*m*(null==f?void 0:f.y),T=(null==p?void 0:p.x)+(null==h?void 0:h.x)/2*m*(null==f?void 0:f.x),O=(null==p?void 0:p.y)+(null==h?void 0:h.y)/2*m*(null==f?void 0:f.y),j=[[b,I],[b,O],[T,O],[T,I],[b,I]],C=new c({spatialReference:null===(n=null==w?void 0:w.current)||void 0===n?void 0:n.spatialReference});return C.addRing(j),C},F=()=>{var t,l,o,n,i,r;const a=g.current[3],{mapFrameSize:u,layout:s,exportOptions:c}=null===(t=x.current)||void 0===t?void 0:t.asMutable({deep:!0}),v=$(s),p=g.current[2];let m=(0,e.Immutable)(null===(l=w.current)||void 0===l?void 0:l.toJSON());const y=(null===(o=null==d?void 0:d.view)||void 0===o?void 0:o.width)/(null===(n=null==d?void 0:d.view)||void 0===n?void 0:n.height),f=v?(null==c?void 0:c.width)/(null==c?void 0:c.height):u[0]/u[1],h=(null==m?void 0:m.height)||(null===(i=null==d?void 0:d.view)||void 0===i?void 0:i.height),b=(null==m?void 0:m.width)||(null===(r=null==d?void 0:d.view)||void 0===r?void 0:r.width);if(y>f){const e=b/f,t=W(!1,e/h);m=m.set("height",e).set("ymin",null==t?void 0:t.mim).set("ymax",null==t?void 0:t.max)}else if(y<f){const e=h*f,t=W(!0,e/b);m=m.set("width",e).set("xmin",null==t?void 0:t.mim).set("xmax",null==t?void 0:t.max)}const S=new a({xmax:null==m?void 0:m.xmax,xmin:null==m?void 0:m.xmin,ymax:null==m?void 0:m.ymax,ymin:null==m?void 0:m.ymin,zmax:null==m?void 0:m.zmax,zmin:null==m?void 0:m.zmin,spatialReference:null==m?void 0:m.spatialReference});return p.fromExtent(S)},W=(e,t)=>{var l,o;const n=null===(l=w.current)||void 0===l?void 0:l.toJSON(),i=null===(o=null==w?void 0:w.current)||void 0===o?void 0:o.center,r=(e?(null==n?void 0:n.xmax)-(null==n?void 0:n.xmin):(null==n?void 0:n.ymax)-(null==n?void 0:n.ymin))*t;return{max:e?(null==i?void 0:i.x)+r/2:(null==i?void 0:i.y)+r/2,mim:e?(null==i?void 0:i.x)-r/2:(null==i?void 0:i.y)-r/2}},G=()=>{var e;const{exportOptions:t}=null===(e=x.current)||void 0===e?void 0:e.asMutable({deep:!0}),l=_();return{width:Ne(null==t?void 0:t.width,!0,null==t?void 0:t.dpi)*(null==l?void 0:l.x),height:Ne(null==t?void 0:t.height,!1,null==t?void 0:t.dpi)*(null==l?void 0:l.y)}},B=e=>{switch(null==e?void 0:e.toUpperCase()){case s.Centimeter:return{x:.01,y:.01};case s.Inch:return{x:.0254,y:.0254};case s.Millimeter:return{x:.001,y:.001};case s.Point:return{x:.0254/72,y:.0254/72};default:return{x:NaN,y:NaN}}},_=()=>{var e;const t=g.current[5];let l,o;const n=null===(e=null==w?void 0:w.current)||void 0===e?void 0:e.spatialReference;n&&(l=n.wkid,o=n.wkt);let i=null;if(l)i=t.values[t[l]];else if(o&&-1!==o.search(/^PROJCS/i)){const e=/UNIT\[([^\]]+)\]\]$/i.exec(o);e&&e[1]&&(i=parseFloat(e[1].split(",")[1]))}return{x:i,y:i}},J=()=>{var e;let t=null;const l=g.current[0],o=Ie(c,d.id);return(null===(e=d.view)||void 0===e?void 0:e.map)&&(t=d.view.map.findLayerById(o),t||(t=new l({id:o,listMode:"hide",title:o}),d.view.map.add(t))),t},q=()=>{var e,t;if(H()&&d.view||!v){const l=Ie(c,null==d?void 0:d.id),o=null===(t=null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.map)||void 0===t?void 0:t.findLayerById(l);o&&o.graphics.removeAll()}},H=()=>!!$(null==v?void 0:v.layout)||!!(null==v?void 0:v.mapFrameSize);return(0,e.jsx)("div",{className:p,css:R},H()&&(0,e.jsx)("div",{title:y("showPrintArea"),"aria-label":y("showPrintArea"),className:"d-flex w-100 align-items-center checkbox-con",onClick:()=>{E(!M),C.current=!M,M?q():U()}},(0,e.jsx)(t.Checkbox,{title:y("showPrintArea"),className:"lock-item-ratio","data-field":"mapSize",checked:M}),(0,e.jsx)("div",{className:"text-left ml-2 text-truncate"},y("showPrintArea"))))},Fe=e.css`
  & .alert-panel {
    background: none !important;
    border: none !important;
    padding: 0 !important;
  }
`,$e=l=>{const o=e.hooks.useTranslation(t.defaultMessages),{supportReport:n,supportCustomReport:i,outputDataSourceWarning:r}=l;return(0,e.jsx)("div",{css:Fe},(n||i)&&!!(null==r?void 0:r.label)&&(0,e.jsx)(ge,null,(0,e.jsx)(t.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,text:o("outputDataIsNotGenerated",{outputDsLabel:null==r?void 0:r.label,sourceWidgetName:null==r?void 0:r.widgets})})))};var We=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};const Ge=new(0,e.esri.Sanitizer),{useState:Be,useEffect:_e,useRef:Je}=e.React,qe=l=>{var o,n,i,r,a,s,d,c;const v=e.hooks.useTranslation(I,t.defaultMessages,e.defaultMessages),p=Je(null),m=Je(null),y=Je(null),f=Je(!1),g=Je(null),x=e.css`
    padding-bottom: ${e.polished.rem(16)};
    padding-top: ${e.polished.rem(16)};
    .setting-con {
      overflow-y: auto;
      padding-left: ${e.polished.rem(16)};
      padding-right: ${e.polished.rem(16)};
    }
    .print-button-con {
      padding-left: ${e.polished.rem(16)};
      padding-right: ${e.polished.rem(16)};
    }
    .no-right-padding .jimu-interactive-node{
      padding-right: 0;
    }
    .scalebar-unit {
      width: ${e.polished.rem(160)};
    }
    .map-size-con input {
      width: 100%;
    }
    .wkid-describtion {
      font-size: ${e.polished.rem(12)};
      color: var(--ref-palette-neutral-900);
    }
    .wkid-describtion-invalid {
      color: var(--sys-color-error-dark)
    }
    .outscale-con, .dpi-con {
      input {
        border-right: 0;
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
      }
      button {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        height: ${e.polished.rem(26)};
        svg {
          margin-right: 0;
        }
      }
    }
    .radio-con, .checkbox-con {
      color: var(--ref-palette-neutral-1100);
      font-size: ${e.polished.rem(14)};
      line-height: ${e.polished.rem(22)};
      margin: ${e.polished.rem(4)} 0 ${e.polished.rem(8)} 0;
    }
  `,{templateList:b,jimuMapView:w,selectedTemplate:S,id:T,config:O,outputDataSourceWarning:j,confirmPrint:C,views:R,handleSelectedTemplateChange:M,setSelectedTemplateByIndex:E}=l,[L,N]=Be((null===(o=null==S?void 0:S.layoutOptions)||void 0===o?void 0:o.titleText)||""),[P,A]=Be((null==S?void 0:S.wkid)||""),[k,D]=Be(null==S?void 0:S.outScale),[U,V]=Be((null===(n=null==S?void 0:S.layoutOptions)||void 0===n?void 0:n.authorText)||""),[F,W]=Be((null===(i=null==S?void 0:S.layoutOptions)||void 0===i?void 0:i.copyrightText)||""),[G,B]=Be(null===(r=null==S?void 0:S.layoutOptions)||void 0===r?void 0:r.customTextElements),[_,q]=e.React.useState(null===(a=null==S?void 0:S.exportOptions)||void 0===a?void 0:a.dpi),[H,K]=e.React.useState(null===(s=null==S?void 0:S.exportOptions)||void 0===s?void 0:s.width),[Q,X]=e.React.useState(null===(d=null==S?void 0:S.exportOptions)||void 0===d?void 0:d.height),[Z,Y]=Be(!1),[ee,te]=e.React.useState(null),[le,oe]=Be(null),[ne,ie]=Be(!1),[re,ae]=Be(!1),[ue,de]=Be(!1);_e((()=>{var e,t,l,o,n,i,r,a,u,s,d,c;const v=J(null===(e=null==S?void 0:S.layoutOptions)||void 0===e?void 0:e.elementOverrides);N((null===(t=null==S?void 0:S.layoutOptions)||void 0===t?void 0:t.titleText)||""),V((null===(l=null==S?void 0:S.layoutOptions)||void 0===l?void 0:l.authorText)||""),W((null===(o=null==S?void 0:S.layoutOptions)||void 0===o?void 0:o.copyrightText)||""),B(null===(n=null==S?void 0:S.layoutOptions)||void 0===n?void 0:n.customTextElements),A(null==S?void 0:S.wkid),D(null==S?void 0:S.outScale),q(null===(i=null==S?void 0:S.exportOptions)||void 0===i?void 0:i.dpi),K(null===(r=null==S?void 0:S.exportOptions)||void 0===r?void 0:r.width),X(null===(a=null==S?void 0:S.exportOptions)||void 0===a?void 0:a.height),oe(v),Ke(Z),ie(!!(null===(u=null==S?void 0:S.layoutOptions)||void 0===u?void 0:u.legendLayers)),ae(!!(null===(c=null===(d=null===(s=null==S?void 0:S.layoutOptions)||void 0===s?void 0:s.elementOverrides)||void 0===d?void 0:d[v])||void 0===c?void 0:c.visible)),p.current=null==S?void 0:S.wkid,(null==S?void 0:S.wkidLabel)?te(null==S?void 0:S.wkidLabel):m.current&&ce(null==S?void 0:S.wkid).then((e=>{te(e)}))}),[S]);const ce=e.React.useCallback((t=>We(void 0,void 0,void 0,(function*(){if(f.current){const{getSRLabel:e}=m.current;return Promise.resolve(e(t))}return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{m.current=e,f.current=!0;const{getSRLabel:l}=m.current;return Promise.resolve(l(t))}))}))),[]),ve=e.React.useCallback((e=>e?ee:ue),[ue,ee]),me=t=>We(void 0,void 0,void 0,(function*(){if(f.current){const{isValidWkid:e}=m.current;return Promise.resolve(e(t))}return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{m.current=e,f.current=!0;const{isValidWkid:l}=m.current;return Promise.resolve(l(t))}))})),ye=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=z(null==b?void 0:b.asMutable({deep:!0}),l);E(o)},fe=e.React.useCallback(((e,t)=>{const l=S.setIn(e,t);M(l)}),[M,S]),xe=()=>{fe(["forceFeatureAttributes"],!(null==S?void 0:S.forceFeatureAttributes))},be=()=>{fe(["attributionVisible"],!(null==S?void 0:S.attributionVisible))},we=e=>{fe(["layoutOptions","legendLayers"],ne?null:[]),ie(!ne)},Se=()=>{var e,t,l;const o=null===(l=null===(t=null===(e=null==S?void 0:S.layoutOptions)||void 0===e?void 0:e.elementOverrides)||void 0===t?void 0:t[le])||void 0===l?void 0:l.visible;fe(["layoutOptions","elementOverrides",le,"visible"],!o)},Ie=e=>{fe(["layoutOptions","titleText"],e)},Te=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;N(l)};_e((()=>{S&&w&&Oe("")}),[w]);const Oe=e=>We(void 0,void 0,void 0,(function*(){if(!(!e||(yield me(e)))){A(p.current);const e=yield ce(p.current);return te(e),!1}p.current=e;const t=e?yield ce(e):"";te(t),A(e);const l=S.set("wkid",e||"").set("wkidLabel",t||"");M(l)})),je=e=>We(void 0,void 0,void 0,(function*(){if(!e||(yield me(e))){const t=yield ce(e);te(t)}else te(v("invalidWKID"));A(e)})),Ce=e=>{fe(["outScale"],e)},Re=()=>{var e;const t=null===(e=null==w?void 0:w.view)||void 0===e?void 0:e.scale;D(t),fe(["outScale"],t)},Me=e=>{D(e)},Ee=e=>{fe(["layoutOptions","authorText"],e)},Le=e=>{if(e<1)return!1;q(parseInt(e))},Ne=e=>{if(e<1)return!1;fe(["exportOptions","dpi"],parseInt(e))},Pe=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;V(l)},Ae=e=>{fe(["layoutOptions","copyrightText"],e)},ke=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;W(l)},De=e=>{var t;if(!e||Number(e)<1)return K(null===(t=null==S?void 0:S.exportOptions)||void 0===t?void 0:t.width),!1;fe(["exportOptions","width"],e)},Ue=e=>{K(e)},Ve=e=>{var t;if(!e||Number(e)<1)return X(null===(t=null==S?void 0:S.exportOptions)||void 0===t?void 0:t.height),!1;fe(["exportOptions","height"],e)},Fe=e=>{X(e)},qe=e=>{const t=e.target.value;fe(["format"],t)},He=e=>{const t=e.target.value;fe(["layoutOptions","scalebarUnit"],t)},Ke=e=>{const t=tt(),{showOutputSpatialReference:l}=t;e&&l&&!(null==S?void 0:S.wkidLabel)&&(We(void 0,void 0,void 0,(function*(){const e=yield ce(null==S?void 0:S.wkid);te(e)})),Ye(w))},Qe=()=>{Ke(!Z),Y(!Z)},Xe=e=>{var t;if(e===u.SetMapScale){const l=null===(t=null==w?void 0:w.view)||void 0===t?void 0:t.scale;D(l),fe(["outScale"],l);const o=S.set("outScale",l).set("printExtentType",e);M(o)}else fe(["printExtentType"],e)},Ze=e=>{if(m.current){const{isValidWkid:t}=m.current;return!e||t(e)}return!0},Ye=e.React.useCallback((e=>We(void 0,void 0,void 0,(function*(){var t,l;if(e){const o=null===(l=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.spatialReference)||void 0===l?void 0:l.wkid,n=o?yield ce(o):"";de(n)}}))),[ce]);_e((()=>(Ye(w),w&&We(void 0,void 0,void 0,(function*(){return y.current||(y.current=yield(0,e.loadArcGISJSAPIModule)("esri/core/reactiveUtils")),y.current})).then((()=>{var e;g.current=null===(e=y.current)||void 0===e?void 0:e.watch((()=>{var e,t;return null===(t=null===(e=null==w?void 0:w.view)||void 0===e?void 0:e.spatialReference)||void 0===t?void 0:t.wkid}),(()=>{Ye(w)}))})),()=>{var e,t,l;(null===(e=g.current)||void 0===e?void 0:e.remove)&&(null===(l=null===(t=g.current)||void 0===t?void 0:t.remove)||void 0===l||l.call(t))})),[w,Ye]);const et=e=>{var t,l;return v("wkidPlaceholder",{wkid:(null===(l=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.spatialReference)||void 0===l?void 0:l.wkid)||null})},tt=()=>{const e=$(null==S?void 0:S.layout),t=(null==S?void 0:S.hasAuthorText)&&(null==S?void 0:S.enableAuthor)&&!e,l=(null==S?void 0:S.hasCopyrightText)&&(null==S?void 0:S.enableCopyright)&&!e,o=(null==S?void 0:S.hasLegend)&&(null==S?void 0:S.enableLegend)&&!e,n=lt()&&!e;return{showLayoutOption:t||l||o||n||(null==S?void 0:S.enableScalebarUnit),showAuthor:t,showCopyright:l,showLegend:o,showCustomTextElements:n,showTitle:null==S?void 0:S.enableTitle,showFeatureAttribution:null==S?void 0:S.enableFeatureAttribution,showMapAttribution:(null==S?void 0:S.enableMapAttribution)&&e,showQuality:null==S?void 0:S.enableQuality,showMapSize:(null==S?void 0:S.enableMapSize)&&e,showMapPrintExtents:null==S?void 0:S.enableMapPrintExtents,showScalebarUnit:(null==S?void 0:S.enableScalebarUnit)&&!e,showOutputSpatialReference:null==S?void 0:S.enableOutputSpatialReference,showNorthArrow:null==S?void 0:S.enableNorthArrow}},lt=()=>{var e,t;const l=[];return null===(e=null==S?void 0:S.customTextElementEnableList)||void 0===e||e.forEach((e=>{for(const t in e)l.push(e[t])})),(null===(t=null==l?void 0:l.filter((e=>e)))||void 0===t?void 0:t.length)>0},ot=()=>{var l;const o=tt(),{showAuthor:n,showCopyright:i,showLegend:r,showLayoutOption:a,showFeatureAttribution:u,showQuality:s,showScalebarUnit:d,showNorthArrow:c}=o;return(0,e.jsx)("div",{role:"group","aria-label":v("LayoutOptions")},a&&(0,e.jsx)("div",{className:"mb-2"},v("LayoutOptions")),n&&(0,e.jsx)(ge,{flowWrap:!0,label:v("printAuthor")},(0,e.jsx)(t.TextInput,{size:"sm",className:"w-100 dpi-input",value:U,onAcceptValue:Ee,onChange:Pe,"aria-label":v("printAuthor")})),i&&(0,e.jsx)(ge,{flowWrap:!0,label:v("printCopyright")},(0,e.jsx)(t.TextInput,{size:"sm",className:"w-100 dpi-input",value:F,onAcceptValue:Ae,onChange:ke,"aria-label":v("printCopyright")})),nt(),r&&(0,e.jsx)(ge,null,(0,e.jsx)("div",{title:v("includeLegend"),"aria-label":v("includeLegend"),className:"w-100 align-items-center d-flex checkbox-con",onClick:we},(0,e.jsx)(t.Checkbox,{title:v("includeLegend"),className:"lock-item-ratio",checked:ne}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},v("includeLegend")))),c&&(0,e.jsx)(ge,null,(0,e.jsx)("div",{title:v("includeNorthArrow"),"aria-label":v("includeNorthArrow"),className:"w-100 align-items-center d-flex checkbox-con",onClick:Se},(0,e.jsx)(t.Checkbox,{title:v("includeNorthArrow"),className:"lock-item-ratio",checked:re}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},v("includeNorthArrow")))),d&&(0,e.jsx)(ge,{label:v("scaleBarUnit"),flowWrap:!1},(0,e.jsx)(t.Select,{value:null===(l=null==S?void 0:S.layoutOptions)||void 0===l?void 0:l.scalebarUnit,onChange:He,size:"sm",className:"scalebar-unit","aria-label":v("scaleBarUnit")},function(e){return[{value:"Miles",label:e("unitsLabelMiles")},{value:"Kilometers",label:e("unitsLabelKilometers")},{value:"Meters",label:e("unitsLabelMeters")},{value:"Feet",label:e("unitsLabelFeet")}]}(v).map(((l,o)=>(0,e.jsx)(t.Option,{key:`unit${o}`,value:l.value,title:l.label},l.label))))),s&&(0,e.jsx)(ge,{label:v("printQuality"),flowWrap:!0},(0,e.jsx)("div",{className:"d-flex align-items-center w-100 dpi-con"},(0,e.jsx)(t.NumericInput,{size:"sm",className:"flex-grow-1 no-right-padding",value:_,min:1,onAcceptValue:Ne,onChange:Le,showHandlers:!1,"aria-label":v("printQuality")}),(0,e.jsx)(t.Button,{disabled:!0,size:"sm",title:"DPI"},"DPI"))),u&&(0,e.jsx)(ge,null,(0,e.jsx)("div",{title:v("includeAttributes"),"aria-label":v("includeAttributes"),className:"w-100 align-items-center d-flex checkbox-con",onClick:xe},(0,e.jsx)(t.Checkbox,{title:v("includeAttributes"),className:"lock-item-ratio","data-field":"mapSize",checked:null==S?void 0:S.forceFeatureAttributes}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},v("includeAttributes")))))},nt=()=>{const l=[];return null==G||G.forEach(((o,n)=>{var i,r;for(const a in o){if(!(null===(r=null===(i=null==S?void 0:S.customTextElementEnableList)||void 0===i?void 0:i[n])||void 0===r?void 0:r[a]))continue;const u=(0,e.jsx)(ge,{flowWrap:!0,className:"align-item-center",label:a,key:`${a}_${n}`},(0,e.jsx)(t.TextArea,{className:"flex-grow-1",value:o[a]||"",onAcceptValue:e=>{it(n,a,e)},onChange:e=>{rt(n,a,e)},"aria-label":a}));l.push(u)}})),l},it=(e,t,l)=>{const o=G[e].set(t,l),n=null==G?void 0:G.asMutable({deep:!0});n.splice(e,1,o),fe(["layoutOptions","customTextElements"],n)},rt=(t,l,o)=>{var n;const i=null===(n=null==o?void 0:o.target)||void 0===n?void 0:n.value,r=G[t].set(l,i),a=null==G?void 0:G.asMutable({deep:!0});a.splice(t,1,r),B((0,e.Immutable)(a))},at=()=>{const l=tt(),{showFeatureAttribution:o,showMapAttribution:n,showQuality:i}=l;return(0,e.jsx)("div",null,o&&(0,e.jsx)(ge,{className:"mb-1"},(0,e.jsx)("div",{title:v("includeAttributes"),"aria-label":v("includeAttributes"),className:"w-100 align-items-center mt-1 d-flex checkbox-con",onClick:xe},(0,e.jsx)(t.Checkbox,{title:v("includeAttributes"),className:"lock-item-ratio","data-field":"mapSize",checked:null==S?void 0:S.forceFeatureAttributes}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},v("includeAttributes")))),n&&(0,e.jsx)(ge,null,(0,e.jsx)("div",{title:v("includeAttribution"),"aria-label":v("includeAttribution"),className:"w-100 align-items-center d-flex checkbox-con",onClick:be},(0,e.jsx)(t.Checkbox,{title:v("includeAttribution"),className:"lock-item-ratio","data-field":"mapSize",checked:null==S?void 0:S.attributionVisible}),(0,e.jsx)("div",{className:"text-left ml-2 f-grow-1"},v("includeAttribution")))),i&&(0,e.jsx)(ge,{label:v("printQuality"),flowWrap:!0},(0,e.jsx)("div",{className:"d-flex align-items-center w-100 dpi-con"},(0,e.jsx)(t.NumericInput,{size:"sm",className:"flex-grow-1 no-right-padding",value:_,onAcceptValue:Ne,onChange:Le,showHandlers:!1,min:1,"aria-label":v("printQuality")}),(0,e.jsx)(t.Button,{disabled:!0,size:"sm",title:"DPI"},"DPI"))))},ut=()=>Ge.sanitize(v("spatialReference",{WKID:'<a target="_blank" href="https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references.htm">WKID</a>'}));return(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{invisible:R!==h.PrintTemplate}),css:x},(0,e.jsx)("div",{className:"w-100 h-100 d-flex flex-column"},(0,e.jsx)("div",{className:"flex-grow-1 w-100 setting-con"},(0,e.jsx)("div",{className:"w-100"},(()=>{var l,o,n,i,r;const a=tt(),{showTitle:u}=a;return(0,e.jsx)("div",{className:"base-setting-con"},(0,e.jsx)(ge,{flowWrap:!0,label:v("template")},(0,e.jsx)(t.Select,{value:(null==S?void 0:S.templateId)||"",onChange:ye,size:"sm","aria-label":v("template")},null==b?void 0:b.map(((l,o)=>(0,e.jsx)(t.Option,{key:null==l?void 0:l.templateId,value:null==l?void 0:l.templateId,title:null==l?void 0:l.label},null==l?void 0:l.label))))),(0,e.jsx)($e,{supportCustomReport:null==O?void 0:O.supportCustomReport,supportReport:null==O?void 0:O.supportReport,outputDataSourceWarning:j}),u&&(0,e.jsx)(ge,{flowWrap:!0,label:v("title")},(0,e.jsx)(t.TextInput,{size:"sm",className:"w-100",value:L,"aria-label":v("title"),onAcceptValue:Ie,onChange:Te})),(null===(l=null==S?void 0:S.selectedFormatList)||void 0===l?void 0:l.length)>1&&(0,e.jsx)(ge,{flowWrap:!0,label:v("fileFormat")},(0,e.jsx)(t.Select,{value:(null===(o=null==S?void 0:S.format)||void 0===o?void 0:o.toLowerCase())||"",onChange:qe,size:"sm","aria-label":v("fileFormat")},!(null===(n=null==S?void 0:S.selectedFormatList)||void 0===n?void 0:n.includes(null==S?void 0:S.format))&&(0,e.jsx)(t.Option,{className:"sr-only",key:`${null==S?void 0:S.format}0`,value:null===(i=null==S?void 0:S.format)||void 0===i?void 0:i.toLowerCase(),title:null==S?void 0:S.format},null==S?void 0:S.format),null===(r=null==S?void 0:S.selectedFormatList)||void 0===r?void 0:r.map(((l,o)=>(0,e.jsx)(t.Option,{key:`format${o}`,value:l,title:l},l))))))})(),(0,e.jsx)("div",null,$(null==S?void 0:S.layout)&&(()=>{const l=tt(),{showMapSize:o}=l;return(0,e.jsx)("div",null,o&&(0,e.jsx)("div",{className:"d-flex align-items-center"},(0,e.jsx)("div",{className:"flex-grow-1"},(0,e.jsx)("div",{className:"mb-1"},v("width")),(0,e.jsx)(t.NumericInput,{size:"sm",className:"w-100 map-size-con",value:H,onAcceptValue:De,onChange:Ue,showHandlers:!1,"aria-label":v("width")})),(0,e.jsx)("div",{className:"flex-grow-1 ml-2"},(0,e.jsx)("div",{className:"mb-1"},v("height")),(0,e.jsx)(t.NumericInput,{size:"sm",className:"w-100 map-size-con",value:Q,onAcceptValue:Ve,onChange:Fe,showHandlers:!1,"aria-label":v("height")}))))})(),(()=>{const l=$(null==S?void 0:S.layout),o=tt(),{showLayoutOption:n,showFeatureAttribution:i,showMapAttribution:r,showQuality:a,showMapSize:s,showMapPrintExtents:d,showScalebarUnit:c,showOutputSpatialReference:p}=o,m=n||i||r||a||s||d||c||p;return(0,e.jsx)("div",null,m&&(0,e.jsx)("div",{className:"d-flex align-items-center",role:"group","aria-label":v("advance")},(0,e.jsx)("div",{className:"flex-grow-1"},v("advance")),(0,e.jsx)(t.Button,{icon:!0,className:"collapse-button",size:"sm",type:"tertiary",onClick:Qe,title:v(Z?"collapse":"expand"),"aria-label":v(Z?"collapse":"expand"),"aria-expanded":Z},Z?(0,e.jsx)(pe,null):(0,e.jsx)(se,null))),Z&&(0,e.jsx)("div",null,d&&(0,e.jsx)(ge,{flowWrap:!0,label:v("mapPrintingExtents")},(0,e.jsx)("div",{role:"group","aria-label":v("mapPrintingExtents")},(0,e.jsx)("div",{title:v("currentMapExtent"),"aria-label":v("currentMapExtent"),className:"d-flex align-items-center radio-con mt-1 checkbox-con",onClick:()=>{Xe(u.CurrentMapExtent)}},(0,e.jsx)(t.Radio,{"aria-label":v("currentMapExtent"),title:v("currentMapExtent"),checked:(null==S?void 0:S.printExtentType)===u.CurrentMapExtent,className:"mr-2"})," ",v("currentMapExtent")),(0,e.jsx)("div",{title:v("currentMapScale"),"aria-label":v("currentMapScale"),className:"d-flex align-items-center radio-con checkbox-con",onClick:()=>{Xe(u.CurrentMapScale)}},(0,e.jsx)(t.Radio,{"aria-label":v("currentMapScale"),title:v("currentMapScale"),checked:(null==S?void 0:S.printExtentType)===u.CurrentMapScale,className:"mr-2"})," ",v("currentMapScale")),(0,e.jsx)("div",{title:v("setMapScale"),"aria-label":v("setMapScale"),className:"d-flex align-items-center radio-con checkbox-con",onClick:()=>{Xe(u.SetMapScale)}},(0,e.jsx)(t.Radio,{"aria-label":v("setMapScale"),title:v("setMapScale"),checked:(null==S?void 0:S.printExtentType)===u.SetMapScale,className:"mr-2"})," ",v("setMapScale")),(null==S?void 0:S.printExtentType)===u.SetMapScale&&(0,e.jsx)("div",{className:"w-100 d-flex align-items-center outscale-con"},(0,e.jsx)(t.NumericInput,{size:"sm",className:"flex-grow-1 dpi-input no-right-padding",value:k,onAcceptValue:Ce,onChange:Me,showHandlers:!1,"aria-label":v("setMapScale")}),(0,e.jsx)(t.Button,{size:"sm",onClick:Re,title:v("useCurrentScale")},(0,e.jsx)(he,null))))),p&&(0,e.jsx)(ge,{flowWrap:!0,label:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:ut()}})},(0,e.jsx)(t.NumericInput,{size:"sm",className:"w-100 dpi-input no-right-padding",value:P||"",onAcceptValue:Oe,onChange:je,showHandlers:!1,placeholder:et(w),"aria-label":v("spatialReference",{WKID:""}),"aria-describedby":"print-wkid-describtion"}),(0,e.jsx)("div",{id:"print-wkid-describtion",title:ve(P),"aria-label":ve(P),className:(0,e.classNames)("text-truncate mt-1 wkid-describtion",{"wkid-describtion-invalid":!Ze(Number(P))})},ve(P))),!l&&ot(),l&&at()))})()))),(0,e.jsx)("div",{className:"print-button-con"},(null==O?void 0:O.enablePreview)&&(0,e.jsx)(ze,{id:T,jimuMapView:w,className:"w-100",scale:k,selectedTemplate:S,scalebarUnit:null===(c=null==S?void 0:S.layoutOptions)||void 0===c?void 0:c.scalebarUnit,printExtentType:null==S?void 0:S.printExtentType,config:O}),(0,e.jsx)(t.Button,{className:"w-100 mt-2",type:"primary",onClick:()=>{C(S)},title:v("_widgetLabel")},v("_widgetLabel")))))};var He=r(62838),Ke=r.n(He),Qe=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const Xe=t=>{const l=window.SVG,{className:o}=t,n=Qe(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:Ke()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var Ze=r(55886),Ye=r.n(Ze),et=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const tt=t=>{const l=window.SVG,{className:o}=t,n=et(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:Ye()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var lt=r(22167),ot=r.n(lt),nt=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const it=t=>{const l=window.SVG,{className:o}=t,n=nt(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:ot()},n)):e.React.createElement("svg",Object.assign({className:i},n))},{useEffect:rt,useState:at}=e.React,ut=l=>{const o=e.hooks.useTranslation(I,t.defaultMessages),n=e.css`
    & {
      overflow: auto;
      padding: ${e.polished.rem(16)} ${e.polished.rem(16)} ${e.polished.rem(16)} ${e.polished.rem(16)};
    }
    .result-button {
      padding-left: 0;
      padding-right: 0;
    }
    a {
      padding: 0;
    }
    .print-loading-con {
      width: 16px;
      height: 16px;
      margin-right: ${e.polished.rem(4)};
    }
    a.result-button{
      &:hover {
        color: var(--sys-color-primary-main);
        background: none;
        text-decoration: underline;
      }
    }
    .error-link, .error-link:hover {
      color: var(--ref-palette-neutral-1200);
      & svg {
        color: var(--sys-color-error-dark);
      }
    }
  `,{printResultList:i,config:r,id:a,deleteResultItem:u}=l,[s,d]=at(null);rt((()=>{Oe(r.useUtility).then((e=>{d(e)}))}),[r.useUtility]);const c=l=>{switch(l.state){case f.Loading:return(0,e.jsx)("div",{className:"print-loading-con position-relative"},(0,e.jsx)(t.Loading,{width:16,height:16,type:t.LoadingType.Donut}));case f.Success:return(0,e.jsx)(tt,null);case f.Error:return(0,e.jsx)("span",{className:"mr-2",title:o("uploadImageError")},(0,e.jsx)(it,null))}};return(0,e.jsx)("div",{className:"w-100 h-100",css:n},0===(null==i?void 0:i.length)&&(0,e.jsx)("div",{id:`resultEmptyMessage${a}`},o("resultEmptyMessage")),i.map(((l,n)=>(0,e.jsx)("div",{className:"d-flex align-items-center mb-2 w-100",key:null==l?void 0:l.resultId},(0,e.jsx)(t.Button,{href:s?`${null==l?void 0:l.url}?token=${s}`:null==l?void 0:l.url,disabled:!(null==l?void 0:l.url),target:"_blank",size:"sm","aria-label":null==l?void 0:l.title,type:"tertiary",tag:(null==l?void 0:l.url)?"a":"div",className:(0,e.classNames)("flex-grow-1 p-0 d-flex align-items-center result-button",{"error-link":(null==l?void 0:l.state)===f.Error})},c(l),(0,e.jsx)("div",{className:"ml-2 flex-grow-1 text-left",title:null==l?void 0:l.title},null==l?void 0:l.title)),(0,e.jsx)(t.Button,{icon:!0,size:"sm",type:"tertiary",onClick:()=>{u(n)},"aria-label":o("remove"),title:o("remove")},(0,e.jsx)(Xe,null))))))};var st=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};const dt=t=>st(void 0,void 0,void 0,(function*(){var o;const{printTemplateProperties:n,useUtility:i,isSupportReport:r,widgetId:a,useMapWidgetIds:u,jimuMapView:s,reportOptions:d,elementOverrides:c,toggleUtilityErrorRemind:v}=t,p=null===(o=t.mapView)||void 0===o?void 0:o.timeExtent,m=function(t,l){const o=null==l?void 0:l.dataSourceId;if(!t||!o)return t;let n=!0;const i=(0,e.getAppStore)().getState().appConfig.widgets;if(Object.keys(i).forEach((t=>{var l,r;const a=i[t];if("widgets/common/timeline/"===a.uri){const t=((null==a?void 0:a.useDataSources)||[]).filter((e=>e.rootDataSourceId===o||e.mainDataSourceId===o));(null==t?void 0:t.length)>0&&(null===(l=a.config)||void 0===l?void 0:l.dataSourceType)!==e.AllDataSourceTypes.Map&&(null===(r=a.config)||void 0===r?void 0:r.dataSourceType)!==e.AllDataSourceTypes.WebMap&&(n=!1)}})),n){let e;return(l.getAllJimuLayerViews().map((e=>e.layer))||[]).forEach((t=>{(null==t?void 0:t.timeExtent)&&(e=null==t?void 0:t.timeExtent)})),e&&(t.timeExtent=e),t}return t}(t.mapView,s),y=yield(f=(0,e.Immutable)(i),T(void 0,void 0,void 0,(function*(){const t=yield O(f);return t?e.SessionManager.getInstance().getSessionByUrl(t):null})));var f;return G(i).then((e=>(0,l.loadArcGISJSAPIModules)(["esri/rest/support/PrintParameters","esri/rest/support/PrintTemplate","esri/rest/print","esri/geometry/SpatialReference"]).then((l=>{var o;const[f,h,g,x]=l;n.includeTables=!0;const b=new h(n),w={view:vt(m),template:b};n.wkid!==(null===(o=null==m?void 0:m.spatialReference)||void 0===o?void 0:o.wkid)&&(w.outSpatialReference=new x({wkid:n.wkid}));const S=new f(w),I={timeout:12e4,token:null==y?void 0:y.token};return(null==y?void 0:y.token)&&(I.token=y.token),g.execute(e,S,I).then((e=>(oe(null==i?void 0:i.utilityId,v),je(c,d,s,a,u,r),ct(t.mapView,p),vt(m,!0),Promise.resolve(e))),(e=>(je(c,d,s,a,u,r),oe(null==i?void 0:i.utilityId,v,e),ct(t.mapView,p),vt(m,!0),Promise.reject(new Error(e))))).catch((e=>(je(c,d,s,a,u,r),oe(null==i?void 0:i.utilityId,v,e),ct(t.mapView,p),vt(m,!0),Promise.reject(new Error(e)))))}))))}));function ct(e,t){e.timeExtent=t}function vt(e,t=!1){return e.map.layers.toArray().forEach((e=>{var l,o,n,i;if(null===(l=null==e?void 0:e.id)||void 0===l?void 0:l.includes("jimu-draw-groupLayer")){(null===(o=null==e?void 0:e.layers)||void 0===o?void 0:o.toArray()).forEach((e=>{var l;null===(l=e.graphics)||void 0===l||l.forEach((e=>{var l;(null===(l=null==e?void 0:e.attributes)||void 0===l?void 0:l.jimuDrawId)&&(e.geometry.hasZ=t)}))}))}(null===(n=null==e?void 0:e.id)||void 0===n?void 0:n.includes("bookmark-layer-"))&&(null===(i=null==e?void 0:e.graphics)||void 0===i||i.forEach((e=>{var l;(null===(l=null==e?void 0:e.attributes)||void 0===l?void 0:l.jimuDrawId)&&(e.geometry.hasZ=t)})))})),e}const pt=e.css`
  & .utility-err-remind-con {
    bottom: 0;
  }
`,mt=l=>{const o=e.hooks.useTranslation(t.defaultMessages,e.defaultMessages),{utilityId:n,toggleUtilityErrorRemind:i}=l,r=e.ReactRedux.useSelector((e=>{var t,l,i;const r=null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.utilityStates;return!0===(null===(l=null==r?void 0:r[n])||void 0===l?void 0:l.isSignInError)?o("signInErrorDefault"):!1===(null===(i=null==r?void 0:r[n])||void 0===i?void 0:i.success)?o("utilityNotAvailable"):void 0}));return(0,e.jsx)("div",{className:"position-relative w-100",css:pt},(0,e.jsx)("div",{className:"position-absolute w-100 utility-err-remind-con"},(0,e.jsx)(t.Alert,{buttonType:"tertiary",className:"w-100",type:"warning",withIcon:!0,closable:!0,onClose:()=>{i(!1)},text:r})))};var yt=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};const{useState:ft,useRef:ht,useEffect:gt}=e.React,xt=e.css`
  .classic-setting-con {
    height: 0;
  }
  .jimu-tabs-tab-content {
    height: calc(100% - 40px);
  }
  .jimu-nav-type-underline {
    height: ${e.polished.rem(40)};
    border-bottom: 1px solid var(--ref-palette-neutral-300) !important;
    display: flex;
    align-items: center;
    &>li {
      flex: 1;
    }
    .loading-con {
      min-width: 16px;
      height: 16px;
      margin-top: -1px;
    }
    .badge-dot {
      top: ${e.polished.rem(4)};
      right: ${e.polished.rem(4)};
    }
  }

`,bt=o=>{var n;const i=e.hooks.useTranslation(I,t.defaultMessages),r=ht([]),a=ht([]),u=ht(null),s=ht(null),d=ht(null),{config:c,jimuMapView:v,templateList:p,id:m,locale:y,useMapWidgetIds:g,outputDataSourceWarning:x,showUtilityErrorRemind:b,handleSelectedTemplateIndexChange:w,toggleUtilityErrorRemind:S}=o,[T,O]=ft(h.PrintTemplate),[j,C]=ft((0,e.Immutable)([])),[R,M]=ft(null);gt((()=>{P(0)}),[]),gt((()=>{var t;if(R&&W(p,null==R?void 0:R.templateId)){const l=z(null==p?void 0:p.asMutable({deep:!0}),null==R?void 0:R.templateId),o=null===(t=A(null==p?void 0:p[l]))||void 0===t?void 0:t.asMutable({deep:!0});E(o),u.current=(0,e.Immutable)(o)}R&&W(p,null==R?void 0:R.templateId)||P(0)}),[p,c]);const E=t=>{var l;let o=null==R?void 0:R.asMutable({deep:!0});for(const e in o)e.includes("enable")&&delete o[e];const n=L(t,null===(l=u.current)||void 0===l?void 0:l.asMutable({deep:!0}));n.length>0&&n.forEach((l=>{const n=N(t,l);o=(0,e.Immutable)(o).setIn(l.split("."),n).asMutable({deep:!0})})),o.customTextElementEnableList=null==t?void 0:t.customTextElementEnableList,o.selectedFormatList=null==t?void 0:t.selectedFormatList;const i=(0,e.Immutable)(Object.assign(Object.assign({},t),o));k(i)},L=(e,t)=>{const l=[],o=(e,t,n)=>{for(const i in e){const r=e[i],a=null==t?void 0:t[i],u=n?`${n}.${i}`:i;"object"==typeof r&&"object"==typeof a&&(null!==r&&null!==a)?o(r,a,u):r!==a&&l.push(u)}};return o(e,t,""),l},N=(e,t)=>{const l=t.split(".");let o=e;for(const e of l)o=null==o?void 0:o[e];return o},P=e=>{if(0===(null==p?void 0:p.length))return!1;const t=A(null==p?void 0:p[e]);u.current=t,w(e),k(t)},A=t=>t?((null==t?void 0:t.overrideCommonSetting)?t=V((0,e.Immutable)(null==c?void 0:c.commonSetting),(0,e.Immutable)(t)):(t=t.set("wkid",null),t=V((0,e.Immutable)(t),(0,e.Immutable)(null==c?void 0:c.commonSetting))),t):null,k=e=>{M(e)},D=e=>{const t=Ie(m,v.id),l=v.view.map.findLayerById(t);l&&(l.visible=e)},U=(t,l,o)=>{let n;o&&(t.url=o),t.state=l;const i=r.current;i.forEach(((e,l)=>{e.resultId===t.resultId&&(n=l)})),(n||0===n)&&(i.splice(n,1,t),C((0,e.Immutable)(i)),r.current=i)},F=(t,l=!1)=>{if("Escape"===t.key){const o=l?s.current:d.current;(0,e.focusElementInKeyboardMode)(o),t.preventDefault()}};return(0,e.jsx)("div",{className:"w-100 h-100 d-flex flex-column",css:xt},(0,e.jsx)("div",{className:"flex-grow-1 w-100 classic-setting-con overflow-hidden"},(0,e.jsx)(t.Tabs,{defaultValue:h.PrintTemplate,keepMount:!0,onChange:t=>{O(t),t===h.PrintResult&&(a.current=(0,e.Immutable)(r.current).asMutable())},type:"underline",className:"h-100 w-100"},(0,e.jsx)(t.Tab,{innerRef:s,id:h.PrintTemplate,title:i("printTemplate"),className:"flex-grow-1 h-100"},(0,e.jsx)("div",{className:"w-100 h-100",onKeyUp:e=>{F(e,!0)}},(0,e.jsx)(qe,{id:m,config:c,jimuMapView:v,selectedTemplate:R,templateList:p,outputDataSourceWarning:x,confirmPrint:t=>yt(void 0,void 0,void 0,(function*(){var o,n;const i={resultId:we((0,e.Immutable)(r.current)),url:null,title:be(null===(o=null==t?void 0:t.layoutOptions)||void 0===o?void 0:o.titleText,(0,e.Immutable)(r.current)),state:f.Loading},a=r.current,u=(null==c?void 0:c.supportCustomReport)||(null==c?void 0:c.supportReport);a.push(i),r.current=a,C((0,e.Immutable)(a)),D(!1);const s={printTemplateProperties:R,mapView:v,locale:y,utility:c.useUtility,useMapWidgetIds:g,widgetId:m,isSupportReport:u},d=yield Le(s);if(!d)return void U(i,f.Error);let p;u&&(p=l.MapViewManager.getInstance().getJimuMapViewById(v.id));const h=p||v;dt({useUtility:null==c?void 0:c.useUtility,mapView:null==h?void 0:h.view,printTemplateProperties:d,toggleUtilityErrorRemind:S,jimuMapView:v,useMapWidgetIds:g,widgetId:m,isSupportReport:u,reportOptions:null==R?void 0:R.reportOptions,elementOverrides:null===(n=null==R?void 0:R.layoutOptions)||void 0===n?void 0:n.elementOverrides}).then((e=>{D(!0),U(i,f.Success,null==e?void 0:e.url)}),(e=>{D(!0),U(i,f.Error)}))})),views:T,handleSelectedTemplateChange:k,setSelectedTemplateByIndex:P}),b&&(0,e.jsx)(mt,{utilityId:null===(n=null==c?void 0:c.useUtility)||void 0===n?void 0:n.utilityId,toggleUtilityErrorRemind:S}))),(0,e.jsx)(t.Tab,{id:h.PrintResult,title:(()=>{var l;const o=(()=>{var e,t;return(null===(t=null===(e=null==r?void 0:r.current)||void 0===e?void 0:e.filter((e=>e.state===f.Loading)))||void 0===t?void 0:t.length)>0})()&&T===h.PrintTemplate,n=null===(l=null==r?void 0:r.current)||void 0===l?void 0:l.length,a=!o&&n>0?`(${n})`:"";return(0,e.jsx)("div",null,(0,e.jsx)("div",{className:"d-inline-block"},i("resultsNumber",{number:a})),o&&(0,e.jsx)("div",{className:"loading-con position-relative ml-1 d-inline-block align-middle"},(0,e.jsx)(t.Loading,{width:16,height:16,type:t.LoadingType.Donut})))})(),innerRef:d,"aria-describedby":0===(null==j?void 0:j.length)?`resultEmptyMessage${m}`:"",className:"flex-grow-1 h-100"},(0,e.jsx)("div",{className:"w-100 h-100",onKeyUp:e=>{F(e)}},(0,e.jsx)(ut,{id:m,config:c,printResultList:j,deleteResultItem:t=>{var l,o;const n=r.current;n.splice(t,1),C((0,e.Immutable)(n)),r.current=null===(l=(0,e.Immutable)(n))||void 0===l?void 0:l.asMutable({deep:!0}),a.current=null===(o=(0,e.Immutable)(n))||void 0===o?void 0:o.asMutable({deep:!0})}}))))))};var wt=function(e,t){var l={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(l[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(l[o[n]]=e[o[n]])}return l};const St=t=>{const l=window.SVG,{className:o}=t,n=wt(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return l?e.React.createElement(l,Object.assign({className:i,src:S()},n)):e.React.createElement("svg",Object.assign({className:i},n))},It=t=>{const l=e.css`
    &.print-loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${e.polished.rem(16)};
      height: ${e.polished.rem(16)};
      border: 1px solid var(--ref-palette-neutral-800);
      border-radius: 50%;
      border-top: 1px solid var(--ref-palette-neutral-1100);
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      margin-right: ${e.polished.rem(4)};
    }
  `;return(0,e.jsx)("div",{css:l,className:"print-loading-con"})},{useEffect:Tt,useState:Ot}=e.React,jt=l=>{const o=e.hooks.useTranslation(I,t.defaultMessages),{printResult:n,useUtility:i,restPrint:r}=l,[a,u]=Ot(null),s=e.css`
    .error-link, .error-link:hover {
      color: var(--ref-palette-neutral-1200);
      & svg {
        color: var(--sys-color-error-dark);
      }
    }
    a.result-button{
      &:hover {
        color: var(--sys-color-primary-main);
        background: none;
        text-decoration: underline;
      }
    }
  `;Tt((()=>{Oe(i).then((e=>{u(e)}))}),[i]);return(0,e.jsx)("div",{className:"d-flex flex-column h-100 w-100 result-con",css:s},(0,e.jsx)(t.Button,{href:a?`${null==n?void 0:n.url}?token=${a}`:null==n?void 0:n.url,disabled:!(null==n?void 0:n.url),target:"_blank",size:"sm","aria-label":null==n?void 0:n.title,tag:(null==n?void 0:n.url)?"a":"div",type:"tertiary",className:(0,e.classNames)("d-flex p-0 align-items-center",{"error-link":(null==n?void 0:n.state)===f.Error})},(()=>{switch(null==n?void 0:n.state){case f.Loading:return(0,e.jsx)(It,null);case f.Success:return(0,e.jsx)(tt,null);case f.Error:return(0,e.jsx)("span",{title:o("uploadImageError")},(0,e.jsx)(it,null))}})(),(0,e.jsx)("div",{className:"ml-2 flex-grow-1 text-left",title:null==n?void 0:n.title},null==n?void 0:n.title)),(0,e.jsx)("div",{className:"flex-grow-1 d-flex align-items-end"},(0,e.jsx)("div",{className:"flex-grow-1"}),(0,e.jsx)(t.Button,{type:"primary","aria-label":o("reset"),title:o("reset"),onClick:r},o("reset"))))};var Ct=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};const{useState:Rt,useRef:Mt,useEffect:Et}=e.React,{useSelector:Lt}=e.ReactRedux,Nt=o=>{var n,i;const{config:r,templateList:a,jimuMapView:u,errorTip:s,id:d,locale:c,useMapWidgetIds:v,outputDataSourceWarning:p,showPlaceholder:m,showUtilityErrorRemind:y,controllerWidgetId:h,toggleUtilityErrorRemind:g}=o,x=e.hooks.useTranslation(I,t.defaultMessages),b=Mt(null),w=Mt(null),S=Lt((e=>{var t,l;return null===(l=null===(t=null==e?void 0:e.appConfig)||void 0===t?void 0:t.widgets)||void 0===l?void 0:l[d]})),T=e.css`
    .compact-con {
      padding: 0;
      svg {
        margin: 0 auto;
      }
      .compact-icon {
        color: ${null===(i=null===(n=null==S?void 0:S.icon)||void 0===n?void 0:n.properties)||void 0===i?void 0:i.color};
      }
    }
    .off-panel-con {
      min-height: 32px;
      min-width: 32px;
    }
    .operate-con-width-controller-widget {
      min-width: 295px;
      padding: 12px;
      .close-con button{
        padding: 0;
        svg {
          margin: 0 auto;
        }
      }
    }
  `,O=e.css`
    & {
      padding: ${e.polished.rem(12)};
      width: ${e.polished.rem(320)};
    }
    .select-con {
      min-height: ${e.polished.rem(107)};
    }
    .result-con {
      min-height: ${e.polished.rem(107)};
    }
    .close-con button{
      padding: 0;
      svg {
        margin: 0 auto;
      }
    }
    .result-list-con button {
      padding: 0;
    }
    .compact-preview-con {
      width: 0;
    }
  `,[j,C]=Rt(!1),[R,M]=Rt(!1),[E,L]=Rt(null),[N,P]=Rt(null);Et((()=>{A(0)}),[]),Et((()=>{if(N&&W(a,null==N?void 0:N.templateId)||A(0),N&&W(a,null==N?void 0:N.templateId)){const e=z(null==a?void 0:a.asMutable({deep:!0}),null==N?void 0:N.templateId);A(e)}}),[a,r]);const A=e=>{if(0===(null==a?void 0:a.length))return!1;let t=null==a?void 0:a[e];t=(null==t?void 0:t.overrideCommonSetting)?V(null==r?void 0:r.commonSetting,t):V(t,null==r?void 0:r.commonSetting),P(t)},k=(t,l)=>{const o="clickOutside"!==l&&!j;C(o),clearTimeout(w.current),w.current=setTimeout((()=>{!o&&(0,e.focusElementInKeyboardMode)(b.current)}))},D=e=>{var t;const l=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=z(null==a?void 0:a.asMutable({deep:!0}),l);A(o)},U=()=>{L(null),M(!1)},F=e=>{const t=Ie(d,u.id),l=u.view.map.findLayerById(t);l&&(l.visible=e)},$=()=>Ct(void 0,void 0,void 0,(function*(){var t,o;const n={resultId:null==N?void 0:N.templateId,url:null,title:null===(t=null==N?void 0:N.layoutOptions)||void 0===t?void 0:t.titleText,state:f.Loading},i=(null==r?void 0:r.supportCustomReport)||(null==r?void 0:r.supportReport);L((0,e.Immutable)(n)),M(!R),F(!1);const a={printTemplateProperties:N,mapView:u,locale:c,utility:r.useUtility,useMapWidgetIds:v,widgetId:d,isSupportReport:i},s=yield Le(a);if(!s)return n.state=f.Error,void L((0,e.Immutable)(n));let p;i&&(p=l.MapViewManager.getInstance().getJimuMapViewById(u.id));const m=p||u;dt({useUtility:null==r?void 0:r.useUtility,mapView:null==m?void 0:m.view,printTemplateProperties:s,toggleUtilityErrorRemind:g,jimuMapView:u,useMapWidgetIds:v,widgetId:d,isSupportReport:i,reportOptions:null==N?void 0:N.reportOptions,elementOverrides:null===(o=null==N?void 0:N.layoutOptions)||void 0===o?void 0:o.elementOverrides}).then((t=>{n.url=null==t?void 0:t.url,n.state=f.Success,F(!0),L((0,e.Immutable)(n))}),(t=>{F(!0),n.state=f.Error,L((0,e.Immutable)(n))}))})),G=()=>{var l;return(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{"operate-con-width-controller-widget":h})},!m&&(0,e.jsx)("div",{className:"d-flex flex-column w-100 h-100"},!h&&(0,e.jsx)("div",{className:"text-right close-con"},(0,e.jsx)(t.Button,{className:"print-button",type:"tertiary","aria-label":x("closeTour"),title:x("closeTour"),onClick:k},(0,e.jsx)(Xe,null))),(0,e.jsx)("div",{className:"flex-grow-1"},!R&&(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100 select-con",{"sr-only":R})},(()=>{var l;return(0,e.jsx)("div",{className:"d-flex flex-column"},(0,e.jsx)(ge,{flowWrap:!0,className:"flex-grow-1",label:x("template")},(0,e.jsx)(t.Select,{value:(null==N?void 0:N.templateId)||"",onChange:D,size:"sm",className:"scalebar-unit","aria-label":x("template")},null==a?void 0:a.map(((l,o)=>(0,e.jsx)(t.Option,{key:l.templateId,value:l.templateId,title:l.label},l.label))))),(0,e.jsx)($e,{supportCustomReport:null==r?void 0:r.supportCustomReport,supportReport:null==r?void 0:r.supportReport,outputDataSourceWarning:p}),(0,e.jsx)("div",{className:"print-button-con d-flex align-items-center mt-2"},(null==r?void 0:r.enablePreview)&&(0,e.jsx)(ze,{className:"flex-grow-1 compact-preview-con",id:d,config:r,jimuMapView:u,scale:null==N?void 0:N.outScale,selectedTemplate:N,scalebarUnit:null===(l=null==N?void 0:N.layoutOptions)||void 0===l?void 0:l.scalebarUnit,printExtentType:null==N?void 0:N.printExtentType}),(0,e.jsx)(t.Button,{className:"print-button text-truncate ml-1",type:"primary",onClick:$,title:x("_widgetLabel"),"aria-label":x("_widgetLabel")},x("_widgetLabel"))))})()),R&&(0,e.jsx)(jt,{printResult:E,restPrint:U,useUtility:null==r?void 0:r.useUtility}))),m&&(0,e.jsx)("div",null,s),y&&(0,e.jsx)(mt,{utilityId:null===(l=null==r?void 0:r.useUtility)||void 0===l?void 0:l.utilityId,toggleUtilityErrorRemind:g}))};return(0,e.jsx)("div",{className:"w-100 h-100",css:T},h&&(0,e.jsx)("div",{className:"w-100 h-100"},G()),!h&&(0,e.jsx)("div",{className:"w-100 h-100"},(0,e.jsx)(t.Button,{className:(0,e.classNames)("w-100 h-100 compact-con",{"off-panel-con":null==S?void 0:S.offPanel}),type:"tertiary",ref:b,title:x("_widgetLabel"),"aria-label":x("_widgetLabel"),onClick:k},(()=>{const l=null==S?void 0:S.icon;return l?"string"==typeof l?(0,e.jsx)(t.SVG,{src:l}):(0,e.jsx)(t.Icon,{className:"compact-icon",icon:null==l?void 0:l.svg}):(0,e.jsx)(St,null)})()),(0,e.jsx)(t.Popper,{open:j,placement:"bottom",reference:b,shiftOptions:{crossAxis:!0},flipOptions:{fallbackPlacements:["left-start","left-end"]},arrowOptions:!0,toggle:k,css:O},G())))};var Pt=function(e,t,l,o){return new(l||(l=Promise))((function(n,i){function r(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(r,a)}u((o=o.apply(e,t||[])).next())}))};class At extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.10.0",description:"update layoutChoiceList of old print widget",upgrader:t=>Pt(this,void 0,void 0,(function*(){const l=null==t?void 0:t.useUtility,o=t=>{var l,o,n,i,r,a;let u=(0,e.Immutable)(t);if(null===(l=null==t?void 0:t.exportOptions)||void 0===l?void 0:l.dpi){const e=Number(null===(o=null==t?void 0:t.exportOptions)||void 0===o?void 0:o.dpi);e<0?u=u.setIn(["exportOptions","dpi"],1):parseInt(e)!==e&&(u=u.setIn(["exportOptions","dpi"],parseInt(e)))}if(null===(n=null==t?void 0:t.exportOptions)||void 0===n?void 0:n.width){Number(null===(i=null==t?void 0:t.exportOptions)||void 0===i?void 0:i.width)<1&&(u=u.setIn(["exportOptions","width"],800))}else(null==t?void 0:t.layout)&&$(null==t?void 0:t.layout)&&(u=u.setIn(["exportOptions","width"],800));if(null===(r=null==t?void 0:t.exportOptions)||void 0===r?void 0:r.height){Number(null===(a=null==t?void 0:t.exportOptions)||void 0===a?void 0:a.height)<1&&(u=u.setIn(["exportOptions","height"],1100))}else(null==t?void 0:t.layout)&&$(null==t?void 0:t.layout)&&(u=u.setIn(["exportOptions","height"],1100));return null==u?void 0:u.asMutable({deep:!0})};t=(e=>{var t,l;return(null===(l=null===(t=null==e?void 0:e.commonSetting)||void 0===t?void 0:t.exportOptions)||void 0===l?void 0:l.dpi)?e.setIn(["commonSetting"],o(e.commonSetting)):e})(t);if(l){const e=yield(n=l,i=t,T(void 0,void 0,void 0,(function*(){return G(n).then((e=>C(e,n,i)))})));if(null==e?void 0:e.layoutChoiceList){const l=((e,t)=>{var l;const n=(null===(l=null==e?void 0:e.printCustomTemplate)||void 0===l?void 0:l.asMutable({deep:!0}))||[];return n?null==n?void 0:n.map((e=>{var l;if(null==e?void 0:e.mapFrameSize)return o(e);{const n=null===(l=null==t?void 0:t.filter((t=>(null==t?void 0:t.layout)===(null==e?void 0:e.layout))))||void 0===l?void 0:l[0],i={mapFrameSize:null==n?void 0:n.mapFrameSize,mapFrameUnit:null==n?void 0:n.mapFrameUnit,hasAuthorText:null==n?void 0:n.hasAuthorText,hasCopyrightText:null==n?void 0:n.hasCopyrightText,hasLegend:null==n?void 0:n.hasLegend,hasTitleText:null==n?void 0:n.hasTitleText};return Object.assign(Object.assign({},o(e)),i)}})):n})(t,null==e?void 0:e.layoutChoiceList);return t.setIn(["layoutChoiceList"],null==e?void 0:e.layoutChoiceList).set("printCustomTemplate",l)}return t}return t;var n,i}))},{version:"1.13.0",description:"Add default print preview style for old print widget",upgrader:e=>{let t=e;return"boolean"!=typeof(null==e?void 0:e.enablePreview)&&(t=t.set("enablePreview",!0).set("previewBackgroundColor","rgba(0,216,237,1)").set("previewOutLine",n)),t}},{version:"1.14.0",description:"Add default layout template or report template for old print widget",upgrader:e=>Pt(this,void 0,void 0,(function*(){var t,l,o;let n=e;if(n.useUtility){n=(yield(r=n,Pt(void 0,void 0,void 0,(function*(){let e=r;return G(e.useUtility).then((t=>le(t).then((l=>Pt(void 0,void 0,void 0,(function*(){var o,n;const{supportCustomLayout:i,defaultCustomLayoutItem:a,supportCustomReport:u,supportReport:s}=l;let d={layoutTypes:g.ServiceLayout},c={reportTypes:b.ServiceReport};if(i&&a&&(d=yield R(l,e.useUtility)),s||u){const o=(yield B(t,v.ReportTemplate))||[],n=E(o);e=e.set("reportTemplateChoiceList",n).set("defaultReportTemplate",null==l?void 0:l.defaultReportTemplate).set("defaultCustomReportItem",null==l?void 0:l.defaultCustomReportItem),c=yield M(o,l,e.useUtility)}const p=((null==e?void 0:e.printTemplateType)===y.Customize?null===(o=e.printCustomTemplate)||void 0===o?void 0:o.asMutable({deep:!0}):null===(n=e.printOrgTemplate)||void 0===n?void 0:n.asMutable({deep:!0})).map((e=>{if((s||u)&&(e.reportTypes=d.reportTypes,(null==c?void 0:c.customReportItem)&&(e.customReportItem=c.customReportItem),(null==c?void 0:c.report)&&(e.report=c.report),(null==c?void 0:c.reportOptions)&&(e.reportOptions=c.reportOptions)),e.layoutTypes=d.layoutTypes,i&&a){(null==d?void 0:d.customLayoutItem)&&(e.customLayoutItem=d.customLayoutItem);const t=null==d?void 0:d.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=t.webMapFrameSize))}return e}));return e=(null==r?void 0:r.printTemplateType)===y.Customize?e.set("printCustomTemplate",p):e.set("printOrgTemplate",p),Promise.resolve(e)}))),(t=>Promise.resolve(e)))))}))))||n;const e=(null==n?void 0:n.printTemplateType)===y.Customize?null===(t=n.printCustomTemplate)||void 0===t?void 0:t.asMutable({deep:!0}):null===(l=n.printOrgTemplate)||void 0===l?void 0:l.asMutable({deep:!0});if(e&&n.layoutChoiceList){const t=(i=e,(null===(o=n.layoutChoiceList)||void 0===o?void 0:o.asMutable({deep:!0})).map((e=>{const t=(null==i?void 0:i.filter((t=>t.layout===e.layout))[0])||{};return e.customTextElementEnableList=t.customTextElementEnableList||[],e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e})));n=n.set("layoutChoiceList",t)}}var i,r;return n}))}]}}const kt=new At,{useState:Dt,useEffect:Ut,useRef:Vt}=e.React,zt=t=>{const l=Vt({}),o=Vt(null),{reportOptions:n,id:i,handleWarningLabelChange:r}=t,[a,u]=Dt(null),[s,d]=Dt(null);Ut((()=>{const e=(null==n?void 0:n.reportSectionOverrides)||{},t=[],i=[],a=[],s=[];Object.keys(e).forEach((l=>{var o;const n=e[l],r=null===(o=null==n?void 0:n.exbDatasource)||void 0===o?void 0:o[0],u=null==n?void 0:n.isDsOutputDs;r&&u&&!(null==i?void 0:i.includes(null==r?void 0:r.dataSourceId))&&(t.push(r),i.push(null==r?void 0:r.dataSourceId)),!r||u||(null==a?void 0:a.includes(null==r?void 0:r.dataSourceId))||(s.push(r),a.push(null==r?void 0:r.dataSourceId))})),function(e,t){if((null==e?void 0:e.length)!==(null==t?void 0:t.length)||!e||!t)return!1;const l=e.sort(),o=t.sort();let n=!0;return null==l||l.forEach(((e,t)=>{l[t]!==o[t]&&(n=!1)})),n}(i,o.current)||(r(null),l.current={}),o.current=i,u(t),d(s)}),[n]);const c=(t,o)=>{var n,i;const a=o.dataSourceId,u=l.current,s=(null===(n=(0,e.getAppStore)().getState().appConfig)||void 0===n?void 0:n.widgets)||{};if((null==u?void 0:u[a])!==t){u[a]=t,l.current=u;const o=[],n={};Object.keys(u).forEach((t=>{var l;if(!u[t]){const i=e.DataSourceManager.getInstance().getDataSource(t),r=null==i?void 0:i.getLabel(),a=v(i),u=null===e.appConfigUtils||void 0===e.appConfigUtils?void 0:e.appConfigUtils.getWidgetIdByOutputDataSource(a),d=null===(l=null==s?void 0:s[u])||void 0===l?void 0:l.label;u&&(o.push(r),n[u]=d)}}));let d=null,c=null;(null===(i=Object.keys(n))||void 0===i?void 0:i.length)>0&&(c=o.join(", "),d=Object.keys(n).map((e=>n[e])).join(", ")),r({label:c,widgets:d})}},v=e=>{var t;return e?{dataSourceId:e.id,mainDataSourceId:e.getMainDataSource().id,dataViewId:e.dataViewId,rootDataSourceId:null===(t=e.getRootDataSource())||void 0===t?void 0:t.id}:null};return(0,e.jsx)("div",null,null==a?void 0:a.map((t=>(0,e.jsx)(e.DataSourceComponent,{key:t.dataSourceId,query:null,useDataSource:t,onDataSourceCreated:()=>{(e=>{c(!0,e)})(t)},onCreateDataSourceFailed:e=>{((e,t)=>{c(!1,t)})(0,t)},widgetId:i,queryCount:!0,onDataSourceInfoChange:l=>{((t,l)=>{const o=null==t?void 0:t.status,n=o!==e.DataSourceStatus.NotCreated&&o!==e.DataSourceStatus.CreateError&&o!==e.DataSourceStatus.LoadError&&o!==e.DataSourceStatus.SaveError&&o!==e.DataSourceStatus.NotReady;c(n,l)})(l,t)}}))),null==s?void 0:s.map((t=>(0,e.jsx)(e.DataSourceComponent,{key:t.dataSourceId,query:null,useDataSource:t,widgetId:i,queryCount:!0}))))},{useState:Ft,useRef:$t,useEffect:Wt}=e.React,Gt=o=>{var n;const{id:i,config:r,dispatch:a,useMapWidgetIds:u,layoutId:s,layoutItemId:d,locale:c,controllerWidgetId:v}=o,f=e.hooks.useTranslation(I,t.defaultMessages),h=e.ReactRedux.useSelector((e=>{var t;const l=null===(t=null==e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.selection;return!(!l||l.layoutId!==s||l.layoutItemId!==d)})),g=e.ReactRedux.useSelector((e=>{var t,l;return null===(l=null===(t=e.widgetsState)||void 0===t?void 0:t[i])||void 0===l?void 0:l.loadingPrintService})),x=$t(!1),b=$t(null),[w,T]=Ft(null),[O,j]=Ft(f("printPlaceholder")),[C,R]=Ft(null),[M,E]=Ft(0),[L,N]=Ft(null),[P,A]=Ft(!1),[k,D]=Ft(!1),U=e.css`
    .jimu-widget-placeholder {
      border: none;
    }
    &.surface-1 {
      border: none !important;
    }
    .checkbox-con:hover {
      color: var(--ref-palette-neutral-1100);
    }
  `;Wt((()=>{z()}),[h]),Wt((()=>{V()}),[r]),Wt((()=>{B(w,C,r)}),[C,r,w]),Wt((()=>{g&&R(null)}),[g]);const V=()=>{var e,t;let l=(e=null==r?void 0:r.printServiceType,t=null==r?void 0:r.printTemplateType,e===m.Customize||t===y.Customize)?null==r?void 0:r.printCustomTemplate:null==r?void 0:r.printOrgTemplate;((null==r?void 0:r.supportCustomReport)||(null==r?void 0:r.supportReport))&&(l=null==l?void 0:l.filter((e=>q(null==e?void 0:e.asMutable({deep:!0}),r)))),R(l)},z=()=>{s&&i&&d&&!x.current&&h&&(a(e.appActions.widgetStatePropChange(i,"layoutInfo",{layoutId:s,layoutItemId:d})),x.current=!0)},F=e=>{var t;const l=!u||0===(null==u?void 0:u.length);return(null!=e||l)&&(l||"2d"===(null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.type))?(l&&j(f("printPlaceholder")),void T(e)):(j(f("chooseMapTip")),void T(null))},$=e=>{},W=()=>{let e=O;return w&&!(null==r?void 0:r.useUtility)&&(e=""),e},G=(e=!1)=>{D(e),e&&(clearTimeout(b.current),b.current=setTimeout((()=>{D(!1)}),5e3))},B=e.hooks.useEventCallback(((e,t,l)=>{var o;const{supportCustomReport:n,supportReport:i}=l;let r=!1;if(!e||!(null==l?void 0:l.useUtility))return r=!0,void A(r);if(i||n){let e=!0;if(null==t||t.forEach((t=>{q(null==t?void 0:t.asMutable({deep:!0}),l)&&(e=!1)})),e){const e=((e,t,l)=>{const o=H(e,t),{reportsAvailable:n,elementOverridesAvailable:i}=o;let r;return n||(r=l("reportTemplateRemind")),i||(r=r?`${r} ${l("dynamicElementTemplateRemind")}`:l("dynamicElementTemplateRemind")),r})(null===(o=null==t?void 0:t[0])||void 0===o?void 0:o.asMutable({deep:!0}),l,f);O&&j(e),r=!0}}t&&0!==(null==t?void 0:t.length)&&!g||(r=!0,j(null)),A(r)}));return(0,e.jsx)("div",{className:(0,e.classNames)("w-100 h-100",{"surface-1":(null==r?void 0:r.modeType)===p.Classic}),css:U},(0,e.jsx)("div",{className:"map"},(0,e.jsx)("div",null,(0,e.jsx)(l.JimuMapViewComponent,{useMapWidgetId:null==u?void 0:u[0],onActiveViewChange:F,onViewGroupCreate:$}))),(null==r?void 0:r.modeType)===p.Classic&&(0,e.jsx)("div",{className:"w-100 h-100"},!P&&(0,e.jsx)(bt,{outputDataSourceWarning:L,handleSelectedTemplateIndexChange:e=>{E(e)},useMapWidgetIds:u,id:i,locale:c,config:r,jimuMapView:w,templateList:C,showUtilityErrorRemind:k,toggleUtilityErrorRemind:G}),P&&(0,e.jsx)(t.WidgetPlaceholder,{name:f("_widgetLabel"),icon:S(),message:W()})),(null==r?void 0:r.modeType)===p.Compact&&(0,e.jsx)("div",{className:"w-100 h-100"},(0,e.jsx)(Nt,{showPlaceholder:P,outputDataSourceWarning:L,useMapWidgetIds:u,id:i,config:r,locale:c,jimuMapView:w,templateList:C,controllerWidgetId:v,errorTip:W(),showUtilityErrorRemind:k,toggleUtilityErrorRemind:G})),((null==r?void 0:r.supportReport)||(null==r?void 0:r.supportCustomReport))&&(0,e.jsx)(zt,{id:i,reportOptions:null===(n=null==C?void 0:C[M])||void 0===n?void 0:n.reportOptions,handleWarningLabelChange:e=>{N(e)}}))};Gt.versionManager=kt;const Bt=Gt;function _t(e){r.p=e}})(),a})())}}}));