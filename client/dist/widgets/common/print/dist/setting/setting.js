System.register(["jimu-core","jimu-arcgis","jimu-for-builder","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-ui/advanced/utility-selector","jimu-for-builder/service","jimu-theme","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/style-setting-components","jimu-ui/basic/color-picker"],(function(e,t){var o={},n={},i={},r={},l={},a={},s={},u={},c={},d={},p={},m={};return{setters:[function(e){o.AllDataSourceTypes=e.AllDataSourceTypes,o.DataSourceManager=e.DataSourceManager,o.DataSourceTypes=e.DataSourceTypes,o.Immutable=e.Immutable,o.LayoutType=e.LayoutType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.ServiceManager=e.ServiceManager,o.SessionManager=e.SessionManager,o.SupportedUtilityType=e.SupportedUtilityType,o.UtilityManager=e.UtilityManager,o.classNames=e.classNames,o.css=e.css,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.focusElementInKeyboardMode=e.focusElementInKeyboardMode,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.moduleLoader=e.moduleLoader,o.polished=e.polished},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.builderAppSync=e.builderAppSync,i.getAppConfigAction=e.getAppConfigAction},function(e){r.Alert=e.Alert,r.AlertPopup=e.AlertPopup,r.Button=e.Button,r.Checkbox=e.Checkbox,r.CollapsablePanel=e.CollapsablePanel,r.Dropdown=e.Dropdown,r.DropdownButton=e.DropdownButton,r.DropdownItem=e.DropdownItem,r.DropdownMenu=e.DropdownMenu,r.Icon=e.Icon,r.Loading=e.Loading,r.LoadingType=e.LoadingType,r.MultiSelect=e.MultiSelect,r.MultiSelectItem=e.MultiSelectItem,r.NumericInput=e.NumericInput,r.Option=e.Option,r.Radio=e.Radio,r.Select=e.Select,r.Switch=e.Switch,r.TextArea=e.TextArea,r.TextInput=e.TextInput,r.Tooltip=e.Tooltip,r.defaultMessages=e.defaultMessages},function(e){l.MapWidgetSelector=e.MapWidgetSelector,l.SettingRow=e.SettingRow,l.SettingSection=e.SettingSection,l.SidePopper=e.SidePopper},function(e){a.List=e.List,a.TreeItemActionType=e.TreeItemActionType},function(e){s.UtilitySelector=e.UtilitySelector,s.addNewUtility=e.addNewUtility,s.extractService=e.extractService},function(e){u.appServices=e.appServices},function(e){c.getTheme2=e.getTheme2,c.styled=e.styled},function(e){d.DataSourceSelector=e.DataSourceSelector},function(e){p.SizeColorSetting=e.SizeColorSetting},function(e){m.ThemeColorPicker=e.ThemeColorPicker}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=c},3158:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODciIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA4NyA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxyZWN0IHdpZHRoPSI4NyIgaGVpZ2h0PSI2NCIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMyIgeT0iNTIiIHdpZHRoPSI4MSIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04NCAyNUgzVjI5SDg0VjI1Wk00MyAzN0gzVjQxSDQzVjM3WiIgZmlsbD0iIzQ0NDQ0NCIvPg0KPHJlY3QgeD0iMTQiIHk9IjUiIHdpZHRoPSIyMCIgaGVpZ2h0PSI2IiBmaWxsPSIjNkE2QTZBIi8+DQo8cmVjdCB4PSI1MyIgeT0iNSIgd2lkdGg9IjIwIiBoZWlnaHQ9IjYiIGZpbGw9IiMzNjM2MzYiLz4NCjxyZWN0IHg9IjMiIHk9IjE2IiB3aWR0aD0iODEiIGhlaWdodD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMyIgeT0iMTYiIHdpZHRoPSI0MCIgaGVpZ2h0PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8L3N2Zz4NCg=="},4108:e=>{"use strict";e.exports=i},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},12046:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.227 1.312c-.404-.404-1.045-.417-1.432-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431zm-8.114 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},13089:e=>{"use strict";e.exports=d},14321:e=>{"use strict";e.exports=r},15417:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODciIGhlaWdodD0iNDYiIHZpZXdCb3g9IjAgMCA4NyA0NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxyZWN0IHk9IjE2IiB3aWR0aD0iODciIGhlaWdodD0iMzAiIGZpbGw9IiMyODI4MjgiLz4NCjxyZWN0IHg9IjQiIHk9IjIzIiB3aWR0aD0iNzkiIGhlaWdodD0iNiIgZmlsbD0iIzQ0NDQ0NCIvPg0KPHJlY3QgeD0iNCIgeT0iMzgiIHdpZHRoPSI0MCIgaGVpZ2h0PSIzIiBmaWxsPSIjNDQ0NDQ0Ii8+DQo8cmVjdCB4PSI2MyIgeT0iMzYiIHdpZHRoPSIyMCIgaGVpZ2h0PSI3IiByeD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3Qgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiByeD0iMiIgZmlsbD0iIzUyNTI1MiIvPg0KPC9zdmc+DQo="},15562:e=>{"use strict";e.exports=p},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},29435:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.938 8A7 7 0 0 1 1.01 9H0a8.001 8.001 0 0 0 15.938-1A8 8 0 0 0 1.02 3.98L1 .702a.5.5 0 1 0-1 .006L.031 5.9l5.128-.826a.5.5 0 0 0-.16-.987L1.819 4.6A7 7 0 0 1 14.938 8"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},50170:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-1.27 4.936a6.5 6.5 0 1 1 .707-.707l4.136 4.137a.5.5 0 1 1-.707.707z" clip-rule="evenodd"></path></svg>'},54337:e=>{"use strict";e.exports=m},62686:e=>{"use strict";e.exports=n},71371:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=o},79298:e=>{"use strict";e.exports=l},79860:e=>{"use strict";e.exports=u},98640:e=>{"use strict";e.exports=a}},t={};function v(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,v),i.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var o in t)v.o(t,o)&&!v.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var h={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(h),v.d(h,{__set_webpack_public_path__:()=>Go,default:()=>$o});var e=v(79244),t=v(62686),o=v(4108),n=v(14321),i=v(79298);const r="CIMMarkerNorthArrow",l={color:"#000",size:"4px"};var a,s,u;!function(e){e.ExportWebMap="ExportWebMap",e.GetLayoutTemplatesInfo="GetLayoutTemplatesInfo",e.GetReportTemplatesInfo="GetReportTemplatesInfo"}(a||(a={})),function(e){e.CurrentMapExtent="CURRENT MAP EXTENT",e.CurrentMapScale="CURRENT MAP SCALE",e.SetMapScale="SET MAP SCALE"}(s||(s={})),function(e){e.Point="POINT",e.Inch="INCH",e.Centimeter="CENTIMETER",e.Millimeter="MILLIMETER"}(u||(u={}));const c={layoutOptions:{customTextElements:[],hasAuthorText:!0,hasCopyrightText:!0,hasLegend:!0,hasTitleText:!0},mapSurroundInfos:[],pageSize:null,pageUnits:null,webMapFrameSize:null},d={scalePreserved:!1,outScale:36978595.474472,layoutOptions:{titleText:"ArcGIS Web Map"},exportOptions:{dpi:96},printExtentType:s.CurrentMapExtent,attributionVisible:!1,forceFeatureAttributes:!0,wkid:null,wkidLabel:null,enableTitle:!0,legendEnabled:!0,enableMapPrintExtents:!0,enableOutputSpatialReference:!0,enableQuality:!0,enableFeatureAttribution:!0,enableMapSize:!0,overrideCommonSetting:!1,enableAuthor:!0,enableCopyright:!0,enableLegend:!0,enableScalebarUnit:!0,enableCustomTextElements:!0};var p,m,g,f,y,b,x,w,T;!function(e){e.LayoutTemplate="Layout Template",e.ReportTemplate="Report Template"}(p||(p={})),function(e){e.Classic="CLASSIC",e.Compact="COMPACT"}(m||(m={})),function(e){e.OrganizationService="ORGANIZATION SERVICE",e.Customize="CUSTOMIZE"}(g||(g={})),function(e){e.OrganizationTemplate="ORGANIZATION TEMPLATE",e.Customize="CUSTOMIZE"}(f||(f={})),function(e){e.Loading="LOADING",e.Success="SUCCESS",e.Error="ERROR"}(y||(y={})),function(e){e.PrintTemplate="PRINT TEMPLATE",e.PrintResult="PRINT RESULT"}(b||(b={})),function(e){e.ServiceLayout="Service Layout",e.CustomLayout="Custom Layout"}(x||(x={})),function(e){e.RPTT="RPTT",e.RPTX="RPTX"}(w||(w={})),function(e){e.ServiceReport="Service Report",e.CustomReport="Custom Report"}(T||(T={}));const S={printSource:"Source",selectMap:"Select a map widget with 2D data",printMode:"Mode",printClassic:"Classic",printCompact:"Compact",configurePrintTemplate:"Print template",printService:"Print service",useOrganizationService:"Use organization service",printCustomize:"Customize",printTemplate:"Print template",useOrganizationTemplate:"Use organization template",newPrintTemplate:"New print template",newTemplate:"New template",templateCommonSettings:"Template common settings",setDefaults:"Set defaults",printTitle:"Title",mapPrintingExtents:"Map printing extents",outputSpatialReference:"Output spatial reference",printQuality:"Print quality",featureAttribution:"Feature attribution",selectEditableSettings:"Select editable settings",currentMapExtent:"Current map extent",currentMapScale:"Current map scale",setMapScale:"Set map scale",useCurrentScale:"Use current scale",allowEditing:"Select settings that allow editing at runtime",wellKnownId:"Enter a well-known ID ({wkid})",includeAttribution:"Include attribution",includeLegend:"Include legend",templateConfiguration:"Template configuration",templateName:"Template name",fileFormat:"File format",printLayout:"Layout",MapOnlyOptions:"Map-only options",LayoutOptions:"Layout options",mapSize:"Map size",overrideCommonSettings:"Override common settings",overrideSettingsTitle:"Are you sure you want to disable override settings?",overrideSettingsRemind:"You will lose the settings configured.",printTemplateAuthor:"Author",copyright:"Copyright",legend:"Legend",scaleBarUnit:"Scalebar unit",miles:"Miles",kilometers:"Kilometers",meters:"Meters",feet:"Feet",mapAttribution:"Map attribution",utilityPlaceholder:'Click the "Select utility" button to add utilities for further configurations.',featureAttributes:"Feature attributes",includeAttributes:"Include attributes",northArrow:"North arrow",includeNorthArrow:"Include north arrow",serviceIsNotAvailable:"Service is not available.",printPreviewStyle:"Print preview style",enablePrintPreview:"Enable print preview",useServiceLayout:"Use service layout",useCustomLayout:"Use layout from layout item",useServiceReport:"Use service report",useCustomReport:"Use report from report item",report:"Report",reportRemind:"The report can only be generated in PDF format. If you want to print the report only, please choose the MAP_ONLY layout option.",reportNotConfigured:"The report is not configured with any data.",selectLayoutItemPlaceholder:"Select an layout item",selectReportItemPlaceholder:"Select a report item",checkingReport:"Checking report",notSupportReport:"Report template is not supported.",untitledTemplate:"Untitled template",includeElementOverrides:"Include {name}",wkidRemind:"Leave empty to use the basemap's spatial reference. Enter a valid WKID (e.g., 3857) to override.",wkidSettingPlaceholder:"Basemap: {wkid}"};var I=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}s((n=n.apply(e,t||[])).next())}))};const C=t=>I(void 0,void 0,void 0,(function*(){return W(t).then((t=>e.ServiceManager.getInstance().fetchArcGISServerInfo(t).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(new Error(e))))))})),R=(t,o,n)=>I(void 0,void 0,void 0,(function*(){const i=null==o?void 0:o.id;return i?O(i,null==t?void 0:t.useUtility,p.LayoutTemplate).then((i=>{var r,l;const a=null==i?void 0:i[0];let s=((null==t?void 0:t.printTemplateType)===f.Customize?null===(r=t.printCustomTemplate)||void 0===r?void 0:r.asMutable({deep:!0}):null===(l=t.printOrgTemplate)||void 0===l?void 0:l.asMutable({deep:!0}))[n];s.customLayoutItem=o,s=function(t,o){if(!t||!o)return o;(null==t?void 0:t.webMapFrameSize)&&(o.mapFrameSize=null==t?void 0:t.webMapFrameSize),(null==t?void 0:t.pageUnits)&&(o.mapFrameUnit=null==t?void 0:t.pageUnits);const n=null==t?void 0:t.layoutOptions,i=(0,e.Immutable)(n).without("hasAuthorText","hasCopyrightText","hasLegend","hasTitleText");o.layoutOptions=null==i?void 0:i.asMutable({deep:!0}),o=P(o,n),n&&(o.layout="");return o}(a,s);const u=J(t,n,s);return Promise.resolve(u)}),(e=>Promise.reject(new Error(e)))).catch((e=>Promise.reject(new Error(e)))):Promise.reject(new Error("No custom layout item id"))})),O=(e,t,o)=>I(void 0,void 0,void 0,(function*(){return W(t).then((t=>V(t,o,e)))}));function k(t,o,n,i){return I(this,void 0,void 0,(function*(){var r;let l=null===(r=G((0,e.Immutable)(o),(0,e.Immutable)(d)))||void 0===r?void 0:r.asMutable({deep:!0});l=yield function(e,t){return I(this,void 0,void 0,(function*(){var o;const{layoutChoiceList:n,defaultCustomLayoutItem:i,defaultLayout:r,supportCustomLayout:l}=null==e?void 0:e.asMutable({deep:!0});let a=x.ServiceLayout;e.layoutChoiceList&&0!==(null===(o=e.layoutChoiceList)||void 0===o?void 0:o.length)||(a=x.CustomLayout);let s={layoutTypes:a};if(l&&i){const o={defaultCustomLayoutItem:i,defaultLayout:r,supportCustomLayout:l};s=yield E(o,e.useUtility),t.customLayoutItem=(null==s?void 0:s.customLayoutItem)||null;const n=null==s?void 0:s.templateInfo;n&&(t.layoutOptions=null==n?void 0:n.layoutOptions,t.mapFrameUnit=null==n?void 0:n.pageUnits,t.mapFrameSize=null==n?void 0:n.webMapFrameSize)}else null==n||n.forEach(((e,o)=>{let n=!1;r?r===(null==e?void 0:e.layoutTemplate)&&(n=!0):0===o&&(n=!0);const i={};n&&(t=Object.assign(Object.assign({},t),e)),s.templateInfo=i}));return t.layoutTypes=null==s?void 0:s.layoutTypes,Promise.resolve(t)}))}(t,o),l=yield function(e,t){return I(this,void 0,void 0,(function*(){const{reportTemplateChoiceList:o,defaultCustomReportItem:n,defaultReportTemplate:i,supportReport:r,supportCustomReport:l}=null==e?void 0:e.asMutable({deep:!0}),a={defaultReportTemplate:i,supportCustomReport:l,defaultCustomReportItem:n,supportReport:r},s=yield N(o,a,e.useUtility);return s&&(t.reportTypes=null==s?void 0:s.reportTypes,t.customReportItem=(null==s?void 0:s.customReportItem)||null,t.report=(null==s?void 0:s.report)||null,t.reportOptions=(null==s?void 0:s.reportOptions)||null),Promise.resolve(t)}))}(t,l);const a=function(e,t){var o,n;let i=1,r=t;const l=(null==e?void 0:e.printTemplateType)===f.Customize?null===(o=e.printCustomTemplate)||void 0===o?void 0:o.asMutable({deep:!0}):null===(n=e.printOrgTemplate)||void 0===n?void 0:n.asMutable({deep:!0});return null==l||l.forEach((e=>{e.label===r&&(i+=1,r=`${t} ${i}`)})),r}(t,i);return l.format=t.defaultFormat,l.selectedFormatList=[t.defaultFormat],l.templateId=n,l.label=a,l.overrideCommonSetting=!1,Promise.resolve(l)}))}const j=(t,o,n)=>I(void 0,void 0,void 0,(function*(){const i=U(null==o?void 0:o.utilityId);return function(t){const o={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[n]=e;return n(t,o).then((e=>function(e){return z(this,void 0,void 0,(function*(){let t=!1,o=!1;const n=(null==e?void 0:e.parameters)||[],i="web_map_as_json",r="output_file",l="layout_item_id",a="layout_template",s="report_template",u="report_item_id";let c=[],d=[],p="pdf",m=!1,v=!1,h=!1,g="",f="",y="",b="";return null==n||n.forEach((e=>{var t,o;if("Format"===e.name){const n=(null===(t=null==e?void 0:e.choiceList)||void 0===t?void 0:t.map((e=>null==e?void 0:e.toLowerCase())))||[];if(e.defaultValue)p=null===(o=e.defaultValue)||void 0===o?void 0:o.toLowerCase();else if((null==n?void 0:n.length)>0){const e=[];null==n||n.forEach((t=>{(t.includes("pdf")||t.includes("png"))&&e.push(t)})),p=(null==e?void 0:e[0])||n[0]}d=n}})),null==n||n.forEach((e=>{if("Layout_Template"===e.name){const t=e.choiceList,o=e.defaultValue;t?c=null==t?void 0:t.map((e=>ae(e,d,p))):c.push(ae(o,d,p))}e.name.toLowerCase()===a&&(g=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===l&&(m=!0,f=null==e?void 0:e.defaultValue),e.name.toLowerCase()===s&&(h=!0,y=(null==e?void 0:e.defaultValue)||""),e.name.toLowerCase()===u&&(v=!0,b=null==e?void 0:e.defaultValue),"string"==typeof e.name&&e.name.toLowerCase()===i&&(t=!0),"string"==typeof e.name&&e.name.toLowerCase()===r&&(o=!0)})),Promise.resolve({templates:c,formatList:d,defaultFormat:p,defaultReportTemplate:y,defaultCustomReportItem:b,hasWebmapParam:t,hasOutputParam:o,supportCustomLayout:m,supportReport:h,supportCustomReport:v,defaultLayout:g,defaultCustomLayoutItem:f})}))}(null==e?void 0:e.data)))}))}(t).then((e=>{let r=n;return V(t,p.LayoutTemplate).then((l=>I(void 0,void 0,void 0,(function*(){let a;if(e.supportCustomReport||e.supportReport){const n=(yield V(t,p.ReportTemplate))||[],i=A(n);r=r.set("reportTemplateChoiceList",i).set("defaultReportTemplate",null==e?void 0:e.defaultReportTemplate).set("defaultCustomReportItem",null==e?void 0:e.defaultCustomReportItem),a=yield N(n,e,o)}const s=yield E(e,o),u={templateTaskInfo:l,templatesInTask:null==e?void 0:e.templates,reportOption:a,defaultLayoutOptionInfo:s,printTemplateType:null==n?void 0:n.printTemplateType,printServiceType:i},c=M(u),d=D(null==e?void 0:e.templates,c);return r=r.set("printCustomTemplate",c).set("useUtility",o).set("formatList",null==e?void 0:e.formatList).set("defaultFormat",null==e?void 0:e.defaultFormat).set("layoutChoiceList",d).set("supportCustomLayout",e.supportCustomLayout||!1).set("supportReport",e.supportReport||!1).set("supportCustomReport",e.supportCustomReport||!1).setIn(["commonSetting","forceFeatureAttributes"],e.supportReport||e.supportCustomReport||!1),Promise.resolve(r)}))))}))})),E=(e,t)=>I(void 0,void 0,void 0,(function*(){var o;const n={layoutTypes:x.ServiceLayout};if((null==e?void 0:e.supportCustomLayout)&&(null==e?void 0:e.defaultCustomLayoutItem)){const i=yield O(null===(o=null==e?void 0:e.defaultCustomLayoutItem)||void 0===o?void 0:o.id,t,p.ReportTemplate),r=null==i?void 0:i[0];n.customLayoutItem=null==e?void 0:e.defaultCustomLayoutItem,n.templateInfo=r}return Promise.resolve(n)})),N=(e,t,o)=>I(void 0,void 0,void 0,(function*(){var n,i,r,l,a;if(!(null==t?void 0:t.supportCustomReport)||!(null==t?void 0:t.supportReport))return null;const s={reportTypes:T.ServiceReport};if((null==t?void 0:t.supportReport)&&(null==t?void 0:t.defaultReportTemplate)){let o;null==e||e.forEach((e=>{(null==e?void 0:e.reportTemplate)===(null==t?void 0:t.defaultReportTemplate)&&(o=null==e?void 0:e.reportOptions)})),s.report=null==t?void 0:t.defaultReportTemplate,s.reportOptions=o}if((null==t?void 0:t.supportCustomReport)&&(null==t?void 0:t.defaultCustomReportItem)){const e=yield O(null===(n=null==t?void 0:t.defaultCustomReportItem)||void 0===n?void 0:n.id,o,p.ReportTemplate),u=null===(i=null==e?void 0:e[0])||void 0===i?void 0:i.reportOptions;s.customReportItem={id:null===(r=null==t?void 0:t.defaultCustomReportItem)||void 0===r?void 0:r.id,title:(null===(l=null==e?void 0:e[0])||void 0===l?void 0:l.reportTemplate)||(null===(a=null==t?void 0:t.defaultCustomReportItem)||void 0===a?void 0:a.id)},s.reportOptions=u,s.reportTypes=T.CustomReport}return Promise.resolve(s)})),A=e=>{if(!e)return[];return e.filter((e=>Q(null==e?void 0:e.reportOptions)===w.RPTX))},P=(e,t)=>{var o,n;if(!t)return e;const i=null===(o=null==t?void 0:t.customTextElements)||void 0===o?void 0:o.map((e=>{const t={};for(const o in e)t[o]=!0;return t})),r=L(t);return e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,e.layoutOptions.customTextElements=(null==t?void 0:t.customTextElements)||[],e.layoutOptions.elementOverrides=r,e.customTextElementEnableList=i||[],e.enableNorthArrow=!!Z(r),e.enableLegend=e.hasLegend,e.enableAuthor=e.hasAuthorText,e.enableCopyright=e.hasCopyrightText,e.enableScalebarUnit=!0,e.hasLegend&&(null==e?void 0:e.layoutOptions)&&(e.layoutOptions.legendLayers=[]),(null===(n=e.layoutOptions)||void 0===n?void 0:n.scalebarUnit)||(e.layoutOptions.scalebarUnit="Miles"),e},M=e=>{const{templateTaskInfo:t,templatesInTask:o,reportOption:n,defaultLayoutOptionInfo:i,printServiceType:r,printTemplateType:l}=e,a=o?ie(o,r,l):[],s=null==a?void 0:a.map((e=>{var o;let r;if(t&&0!==(null==t?void 0:t.length)?t.forEach((t=>{e.label===t.layoutTemplate&&(r=t)})):r=c,(null==e?void 0:e.layout)&&(e.layout=B(null==e?void 0:e.layout)),(null==e?void 0:e.format)&&(e.format=null===(o=null==e?void 0:e.format)||void 0===o?void 0:o.toLowerCase()),(null==r?void 0:r.webMapFrameSize)&&(e.mapFrameSize=null==r?void 0:r.webMapFrameSize,e.mapFrameUnit=null==r?void 0:r.pageUnits),(e=P(e,null==r?void 0:r.layoutOptions)).mapFrameUnit=null==r?void 0:r.pageUnits,e.selectedFormatList=[null==e?void 0:e.format],"boolean"!=typeof e.showLabels&&(e.showLabels=!0),n&&((null==n?void 0:n.customReportItem)&&(e.customReportItem=null==n?void 0:n.customReportItem),(null==n?void 0:n.report)&&(e.report=null==n?void 0:n.report),(null==n?void 0:n.reportOptions)&&(e.reportOptions=null==n?void 0:n.reportOptions),(null==n?void 0:n.reportTypes)&&(e.reportTypes=null==n?void 0:n.reportTypes)),i){(null==i?void 0:i.layoutTypes)&&(e.layoutTypes=null==i?void 0:i.layoutTypes),(null==i?void 0:i.customLayoutItem)&&(e.customLayoutItem=null==i?void 0:i.customLayoutItem);const t=null==i?void 0:i.templateInfo;t&&((null==t?void 0:t.layoutOptions)&&(e.layoutOptions=null==t?void 0:t.layoutOptions),(null==t?void 0:t.pageUnits)&&(e.mapFrameUnit=null==t?void 0:t.pageUnits),(null==t?void 0:t.webMapFrameSize)&&(e.mapFrameSize=null==t?void 0:t.webMapFrameSize))}return e}));return s},L=e=>{const t=(null==e?void 0:e.mapSurroundInfos)||[],o={};return null==t||t.forEach((e=>{e.type===r&&(e.visible=!0),o[e.name]=e})),o},D=(e,t)=>{const o=(null==e?void 0:e.map((e=>{e.layoutTemplate=B(null==e?void 0:e.layout);const o=H(null==e?void 0:e.layout);return null==t||t.forEach((t=>{(null==e?void 0:e.layout)===(null==t?void 0:t.layout)&&(e.mapFrameSize=null==t?void 0:t.mapFrameSize,e.mapFrameUnit=null==t?void 0:t.mapFrameUnit,e.hasAuthorText=null==t?void 0:t.hasAuthorText,e.hasCopyrightText=null==t?void 0:t.hasCopyrightText,e.hasLegend=null==t?void 0:t.hasLegend,e.hasTitleText=null==t?void 0:t.hasTitleText,!o&&(e.layoutOptions=null==t?void 0:t.layoutOptions),e.customTextElementEnableList=null==t?void 0:t.customTextElementEnableList,e.enableNorthArrow=t.enableNorthArrow,e.enableLegend=t.hasLegend,e.enableAuthor=t.hasAuthorText,e.enableCopyright=t.hasCopyrightText,e.enableScalebarUnit=!0,e.enableNorthArrow=null==t?void 0:t.enableNorthArrow)})),e})))||[];return o},U=t=>{const o=e.UtilityManager.getInstance().getUtilityJson(t);return"org"===(null==o?void 0:o.source)?g.OrganizationService:g.Customize};var _,z=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}s((n=n.apply(e,t||[])).next())}))};!function(e){e.AsynchronousSubmit="esriExecutionTypeAsynchronous",e.SynchronousExecute="esriExecutionTypeSynchronous"}(_||(_={}));const $=(e,t)=>e===g.Customize||t===f.Customize?"custom":"org",G=(t,o)=>{let n=o;return(null==t?void 0:t.exportOptions)&&(n=n.set("exportOptions",Object.assign(Object.assign({},t.exportOptions||{}),(null==o?void 0:o.exportOptions)||{}))),(null==t?void 0:t.layoutOptions)&&(null==o?void 0:o.layoutOptions)&&(n=n.set("layoutOptions",Object.assign(Object.assign({},(null==t?void 0:t.layoutOptions)||{}),(null==o?void 0:o.layoutOptions)||{}))),(0,e.Immutable)(Object.assign(Object.assign({},t),n))},F=(e,t)=>{let o;return null==e||e.forEach(((e,n)=>{(null==e?void 0:e.templateId)===t&&(o=n)})),o},q=(e,t)=>e===g.Customize||t===f.Customize,B=e=>e,H=e=>"map-only"===(e=>{var t,o;return null===(o=null===(t=null==e?void 0:e.replace(/\_/gi,"-"))||void 0===t?void 0:t.replace(/\s+/gi,"-"))||void 0===o?void 0:o.toLowerCase()})(e),W=t=>z(void 0,void 0,void 0,(function*(){return e.UtilityManager.getInstance().getUrlOfUseUtility(t).then((e=>Promise.resolve(e)))}));function V(t,o,n){return z(this,void 0,void 0,(function*(){const i={query:{"env:outSR":"","env:processSR":"",returnZ:!1,returnM:!1,returnTrueCurves:!1,returnFeatureCollection:!1,context:"",f:"json"},responseType:"json"},r=yield(l=t,I(void 0,void 0,void 0,(function*(){return e.ServiceManager.getInstance().fetchArcGISServerInfo(l).then((e=>Promise.resolve(null==e?void 0:e.owningSystemUrl)),(e=>Promise.reject(new Error(e))))})));var l;const s=r?e.SessionManager.getInstance().getSessionByUrl(r):null;if(n){const e={id:n};s&&(e.token=s.token),o===p.LayoutTemplate&&(s&&(i.query.token=s.token),i.query.Layout_Item_ID=JSON.stringify(e)),o===p.ReportTemplate&&(i.query.Report_Item_ID=JSON.stringify(e))}return function(t){return z(this,void 0,void 0,(function*(){var o;if(!t)return Promise.resolve(null);const n=`${null===(o=t.split("/GPServer"))||void 0===o?void 0:o[0]}/GPServer`,i=function(){var t,o;const n=(null===(t=(0,e.getAppStore)().getState().portalSelf)||void 0===t?void 0:t.helperServices)||{};return(null===(o=null==n?void 0:n.asyncPrintTask)||void 0===o?void 0:o.url)||null}(),r=(yield K(n))||{},{tasks:l,supportedOperations:s,executionType:u}=r;let c=u,d=null,p=null,m=null,v=null;const h=null==l?void 0:l.map((t=>function(t,o){return z(this,void 0,void 0,(function*(){if(!t||!o)return Promise.resolve(null);const n=`${o}/${t}`,i={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(n,i).then((e=>{var t;const o=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.name;return Promise.resolve(o)}))}))}))}(t,n).then((e=>{e===a.GetLayoutTemplatesInfo&&(d=`${n}/${t}`,p=`${d}/${s}`),e===a.GetReportTemplatesInfo&&(m=`${n}/${t}`,v=`${n}/${t}/${s}`)}))));if(yield Promise.all(h),i===t){const e=yield function(e){return z(this,void 0,void 0,(function*(){const t=`${null==e?void 0:e.split("/arcgis/")[0]}/arcgis/rest/services/Utilities/PrintingTools/GPServer`,o=(yield K(t))||{},{tasks:n,supportedOperations:i,executionType:r}=o;let l=null,a=null,s=null;return null==n||n.forEach((e=>{((null==e?void 0:e.includes("Layout"))||(null==e?void 0:e.includes("Layout")))&&(s=e)})),l=`${t}/${s}`,a=`${l}/${i}`,{layoutTemplatesInfoTaskUrl:l,layoutTemplatesInfoRequestUrl:a,executionType:r}}))}(n);d=e.layoutTemplatesInfoTaskUrl,p=e.layoutTemplatesInfoRequestUrl,c=e.executionType}return Promise.resolve({url:n,layoutTemplatesInfoTaskUrl:d,layoutTemplatesInfoRequestUrl:p,reportTemplatesInfoTaskUrl:m,reportTemplatesInfoRequestUrl:v,executionType:u,layoutTemplateTaskExecutionType:c})}))}(t).then((t=>{const{layoutTemplatesInfoRequestUrl:n,reportTemplatesInfoRequestUrl:r,reportTemplatesInfoTaskUrl:l,executionType:a,layoutTemplatesInfoTaskUrl:s,layoutTemplateTaskExecutionType:u}=t,c=o===p.ReportTemplate?r:n,d=o===p.LayoutTemplate?u:a;return c?(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(c,i).then((e=>z(this,void 0,void 0,(function*(){var n,r,a;if(d===_.AsynchronousSubmit){const r=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.jobId;return function(e,t,o,n){return z(this,void 0,void 0,(function*(){const i=`${e}/jobs/${t}/results/Output_JSON`;return new Promise(((e,t)=>{let r=0;const l=10,a=3e3,s=()=>{n(i,o).then((t=>{var o;(null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.value)?e(t.data.value):(r++,r<l?setTimeout(s,a):e([]))})).catch((e=>{t(new Error(e))}))};s()}))}))}(o===p.ReportTemplate?l:s,r,i,t)}return Promise.resolve((null===(a=null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.results[0])||void 0===a?void 0:a.value)||[])}))),(e=>Promise.reject(new Error(e)))).catch((e=>Promise.reject(new Error(e))))})):Promise.resolve(null)}))}))}function K(t){return z(this,void 0,void 0,(function*(){var o;if(!t)return Promise.resolve(null);const n=`${null===(o=t.split("/GPServer"))||void 0===o?void 0:o[0]}/GPServer`,i={query:{f:"json"},responseType:"json"};return(0,e.loadArcGISJSAPIModules)(["esri/request"]).then((e=>{const[t]=e;return t(n,i).then((e=>{var t,o;const n=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.tasks,i=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.executionType,r=i===_.SynchronousExecute?"execute":"submitJob";return Promise.resolve({tasks:n,supportedOperations:r,executionType:i})}))}))}))}function Z(e={}){var t;let o=null;for(const n in e)(null===(t=null==e?void 0:e[n])||void 0===t?void 0:t.type)===r&&(o=n);return o}function Q(e){if(!e)return null;let t=w.RPTX;const o=(null==e?void 0:e.reportSectionOverrides)||{};return Object.keys(o).forEach((e=>{const n=o[e];((null==n?void 0:n.fieldElements)||(null==n?void 0:n.fieldLabelElements))&&(t=w.RPTT)})),t}function J(e,t,o){var n,i;const r=(null==e?void 0:e.printTemplateType)===f.Customize?null===(n=e.printCustomTemplate)||void 0===n?void 0:n.asMutable({deep:!0}):null===(i=e.printOrgTemplate)||void 0===i?void 0:i.asMutable({deep:!0});r[t]=o;return(null==e?void 0:e.printTemplateType)===f.Customize?e.set("printCustomTemplate",r):e.set("printOrgTemplate",r)}function Y(e,t){var o;const{defaultCustomReportItem:n,defaultReportTemplate:i,supportCustomReport:r,supportReport:l}=t;return{reportsAvailable:ee({defaultCustomReportItem:n,defaultReportTemplate:i,supportCustomReport:r,supportReport:l,reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes}),elementOverridesAvailable:function(e){if(!e)return!0;let t=!0;for(const o in e){te(e[o])||(t=!1)}return t}(null===(o=null==e?void 0:e.layoutOptions)||void 0===o?void 0:o.elementOverrides)}}const X=(e,t,o)=>{const n=Y(e,t),{reportsAvailable:i,elementOverridesAvailable:r}=n;let l;return i||(l=o("reportTemplateRemind")),r||(l=l?`${l} ${o("dynamicElementTemplateRemind")}`:o("dynamicElementTemplateRemind")),l};function ee(e){const{reportOptions:t,defaultCustomReportItem:o,defaultReportTemplate:n,supportCustomReport:i,supportReport:r,reportTypes:l}=e;if(!i&&!r)return!0;switch(l){case T.CustomReport:return t?oe(t):!o&&!n;case T.ServiceReport:return t?oe(t):!n}}function te(e){let t=!0;if(e.visible&&("CIMTableFrame"===e.type||"CIMGraphicElement"===e.type)){const o=null==e?void 0:e.exbDataSource;o&&0!==(null==o?void 0:o.length)||(t=!1)}return t}function oe(e){if(!(null==e?void 0:e.reportSectionOverrides))return!1;const t=(null==e?void 0:e.reportSectionOverrides)||{};let o=!0;return Object.keys(t).forEach(((e,n)=>{var i,r;const l=t[e];if((null==l?void 0:l.exbDatasource)&&0!==(null===(i=null==l?void 0:l.exbDatasource)||void 0===i?void 0:i.length)){const e=ne()||[],t=null===(r=null==l?void 0:l.exbDatasource)||void 0===r?void 0:r[0],n=(null==t?void 0:t.rootDataSourceId)||(null==t?void 0:t.mainDataSourceId);(null==e?void 0:e.includes(n))||(o=!1)}else o=!1})),o}const ne=()=>{var t;const o=(0,e.getAppStore)().getState(),n=(null==o?void 0:o.appStateInBuilder)?null===(t=null==o?void 0:o.appStateInBuilder)||void 0===t?void 0:t.appConfig:null==o?void 0:o.appConfig,i=null==n?void 0:n.dataSources,r=[];return Object.keys(i).forEach((t=>{const o=i[t];(null==o?void 0:o.type)!==e.DataSourceTypes.WebScene&&r.push(o.id)})),r.length>0?(0,e.Immutable)(r):void 0},ie=(t,o,n)=>{const i=t.map((t=>{var o;let n=(0,e.Immutable)(t);return n=n.set("layout",B(null==t?void 0:t.layout)),n=n.setIn(["layoutOptions","scalebarUnit"],"Miles").setIn(["layoutOptions","legendLayers"],null),n=n.set("reportTypes",T.ServiceReport).set("layoutTypes",x.ServiceLayout),H(null==n?void 0:n.layout)&&(n=n.set("exportOptions",Object.assign({width:800,height:1100},null==t?void 0:t.exportOptions))),null===(o=G((0,e.Immutable)(d),(0,e.Immutable)(n)))||void 0===o?void 0:o.asMutable({deep:!0})}));return re(i,o,n)},re=(e,t,o)=>{const n=$(t,o);return e.map(((e,t)=>(e.templateId=`config_${n}_${t}`,e)))};function le(t){var o,n,i;return null!==(i=null===(n=null===(o=e.DataSourceManager.getInstance().getDataSource(t))||void 0===o?void 0:o.getDataSourceJson())||void 0===n?void 0:n.isOutputFromWidget)&&void 0!==i&&i}function ae(e,t,o){const n=H(e)?{}:{layoutOptions:{legend:!1}},i=o||t[0]||"PNG32";return Object.assign({label:e,layout:e,format:i},n)}var se=v(98640),ue=v(71371);const ce=(e,t,o)=>{const n=e.map((e=>e.templateId)),i=$(t,o);if(!n||0===(null==n?void 0:n.length))return`config_${i}_0`;return`config_${i}_${de(n)+1}`},de=e=>{var t;const o=null==e?void 0:e.map((e=>{var t;const o=null===(t=null==e?void 0:e.split("_"))||void 0===t?void 0:t.pop();return o?Number(o):0}));return null===(t=null==o?void 0:o.sort(((e,t)=>t-e)))||void 0===t?void 0:t[0]};const pe=(t,o,n)=>{var i,r;const l=null===(i=null==n?void 0:n.filter((e=>(null==e?void 0:e.layout)===o)))||void 0===i?void 0:i[0];let a=Object.assign(Object.assign(Object.assign({},t),l),{layoutTypes:x.ServiceLayout});return H(null==l?void 0:l.layout)&&(a=null===(r=(0,e.Immutable)(a).setIn(["exportOptions","width"],800).setIn(["exportOptions","height"],1100))||void 0===r?void 0:r.asMutable({deep:!0})),a};function me(e,t){if(t){const t={reportTemplate:"None"};e.unshift(t)}return e}function ve(t){const o=function(t){var o;const n=null===(o=(0,e.getAppStore)().getState().portalSelf)||void 0===o?void 0:o.helperServices;return(0,ue.extractService)(n,e.SupportedUtilityType.Printing,null,null,t)}(t)||[],n=o[0];if(!n)return null;let i=e.UtilityManager.getInstance().getIdOfOrgUtility(n.name,n.url,n.index,n.label);return i||(i=(0,ue.addNewUtility)(n)),{utilityId:i}}const he=t=>{const o=e.DataSourceManager.getInstance();let n=!1;const i=e=>{var t,o,r;n||("MAP_SERVICE"===(null===(t=null==e?void 0:e.parentDataSource)||void 0===t?void 0:t.type)?n=!0:(null===(o=null==e?void 0:e.parentDataSource)||void 0===o?void 0:o.parentDataSource)&&i(null===(r=null==e?void 0:e.parentDataSource)||void 0===r?void 0:r.parentDataSource))},r=o.getDataSource(t.id);return i(r),n},ge=(e,t)=>!(!e||!t)&&(null==t?void 0:t.some((t=>t.dataSourceId===e.dataSourceId))),fe=(e,t)=>{const n={id:e},i=(0,o.getAppConfigAction)(),r=function(e){const t=[];return e.printCustomTemplate.forEach((e=>{var o,n,i,r;const l=(null==e?void 0:e.reportOptions)||{};for(const e in l){const i=null===(o=l[e])||void 0===o?void 0:o.reportSectionOverrides;for(const e in i){const o=null===(n=l[e])||void 0===n?void 0:n.exbDatasource;(null==o?void 0:o[0])&&!ge(o[0],t)&&t.push(o[0])}}const a=(null===(i=null==e?void 0:e.layoutOptions)||void 0===i?void 0:i.elementOverrides)||{};for(const e in a){const o=null===(r=a[e])||void 0===r?void 0:r.exbDataSource;(null==o?void 0:o[0])&&!ge(o[0],t)&&t.push(o[0])}})),t}(t);n.config=t,n.useDataSources=r,i.editWidget(n).exec()};var ye=v(4651),be=v.n(ye),xe=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};const we=t=>{const o=window.SVG,{className:n}=t,i=xe(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:be()},i)):e.React.createElement("svg",Object.assign({className:r},i))},Te=e.css`
  .report-remind-alert .jimu-icon-component {
    color: var(--sys-color-warning-main) !important;
  }
`,Se=t=>{const o=e.hooks.useTranslation(n.defaultMessages),{config:i,templateList:r,itemStateDetailContent:l,activeTemplateId:a,handelActiveTemplateIdChange:s,handelTemplateListChange:u}=t,[c,d]=e.React.useState(!1),p=e.hooks.useEventCallback((e=>{let t=0;const o=n=>(e=>r.some((t=>t.label===e)))(n)?(t+=1,o(n=`${e} ${t}`)):n;return o(e)})),m=e=>{d(!c),null==e||e.stopPropagation()};return(0,e.jsx)("div",{className:"d-flex align-items-center",css:Te},!function(e,t){const o=Y(e,t),{reportsAvailable:n,elementOverridesAvailable:i}=o;return n&&i}(l,i)&&(0,e.jsx)(n.Alert,{className:"report-remind-alert",buttonType:"tertiary",form:"tooltip",size:"small",type:"warning",text:X(l,i,o)}),(0,e.jsx)(n.Dropdown,{direction:"down",size:"sm",useKeyUpEvent:!0,toggle:m,isOpen:c},(0,e.jsx)(n.DropdownButton,{size:"sm",arrow:!1,icon:!0,onClick:m,type:"tertiary","aria-label":o("more"),title:o("more")},(0,e.jsx)(we,{size:"s"})),(0,e.jsx)(n.DropdownMenu,null,(0,e.jsx)(n.DropdownItem,{title:o("duplicate"),"aria-label":o("duplicate"),onClick:e=>{e.stopPropagation();const t=F(r,a),o=ce(r,i.printServiceType,i.printTemplateType),n=r,l=p(r[t].label),c=Object.assign(Object.assign({},r[t]),{templateId:o,label:l});n.push(c),u(n),setTimeout((()=>{const e=(null==n?void 0:n.length)-1;s(o,e)}),200)}},o("duplicate")),(0,e.jsx)(n.DropdownItem,{title:o("deleteOption"),"aria-label":o("deleteOption"),onClick:()=>{const e=F(r,a),t=r;null==t||t.splice(e,1),u(t),s(null)}},o("deleteOption")))))},Ie=e.css`
  .report-remind-alert {
    .jimu-icon-component {
      color: var(--sys-color-warning-main) !important;
    }
    &.jimu-btn {
      padding: 0 !important;
    }
  }
`,Ce=t=>{const{className:o,config:n,activeTemplateId:i,showNewTemplateItem:r,handelActiveTemplateIdChange:l,handelTemplateListChange:a}=t,s={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:se.TreeItemActionType.RenderOverrideItem,children:[{name:se.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:se.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:se.TreeItemActionType.RenderOverrideItemBody,children:[{name:se.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:se.TreeItemActionType.RenderOverrideItemDragHandle},{name:se.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:se.TreeItemActionType.RenderOverrideItemTitle},{name:se.TreeItemActionType.RenderOverrideItemDetailToggle},{name:se.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};e.React.useEffect((()=>{c((null==n?void 0:n.printTemplateType)===f.Customize||(null==n?void 0:n.printServiceType)===g.Customize),m()}),[n]);const[u,c]=e.React.useState((null==n?void 0:n.printTemplateType)===f.Customize||(null==n?void 0:n.printServiceType)===g.Customize),[d,p]=e.React.useState([]),m=()=>{var e,t;(null==n?void 0:n.printServiceType)===g.Customize||(null==n?void 0:n.printTemplateType)===f.Customize?p((null===(e=null==n?void 0:n.printCustomTemplate)||void 0===e?void 0:e.asMutable({deep:!0}))||[]):p((null===(t=null==n?void 0:n.printOrgTemplate)||void 0===t?void 0:t.asMutable({deep:!0}))||[])};return(0,e.jsx)("div",{className:`w-100 mt-2 ${o||""}`,css:Ie},(0,e.jsx)(se.List,Object.assign({className:"w-100",itemsJson:Array.from(d).map(((e,t)=>({itemStateDetailContent:e,itemKey:null==e?void 0:e.templateId,itemStateChecked:i&&(null==e?void 0:e.templateId)===i,itemStateTitle:null==e?void 0:e.label,itemStateIcon:null,itemStateCommands:[]}))),dndEnabled:u,renderOverrideItemDetailToggle:(t,o)=>{const{itemJsons:i}=o.props,[r]=i,s=null==r?void 0:r.itemStateDetailContent,u=null==r?void 0:r.itemKey;return(0,e.jsx)(Se,{activeTemplateId:u,itemStateDetailContent:s,templateList:d,config:n,handelActiveTemplateIdChange:l,handelTemplateListChange:a})},onUpdateItem:(e,t)=>{const{itemJsons:o}=t.props,[,n]=o;if(e.updateType===se.TreeItemActionType.HandleDidDrop){const e=n.map((e=>e.itemStateDetailContent));l(null),a(e)}},onClickItemBody:(e,t)=>{const{itemJsons:o}=t.props,n=o[0],i=o[1];l(n.itemKey,i.indexOf(n))}},s)),r&&(0,e.jsx)(se.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:"item",itemKey:"index",itemStateChecked:!0,itemStateTitle:"......",itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},s)))};var Re=v(23662),Oe=v.n(Re),ke=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};const je=t=>{const o=window.SVG,{className:n}=t,i=ke(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Oe()},i)):e.React.createElement("svg",Object.assign({className:r},i))};var Ee=v(29435),Ne=v.n(Ee),Ae=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};const Pe=t=>{const o=window.SVG,{className:n}=t,i=Ae(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Ne()},i)):e.React.createElement("svg",Object.assign({className:r},i))};var Me=v(45508),Le=v.n(Me),De=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};const Ue=t=>{const o=window.SVG,{className:n}=t,i=De(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Le()},i)):e.React.createElement("svg",Object.assign({className:r},i))};var _e=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}s((n=n.apply(e,t||[])).next())}))};const ze=v(12046),$e=new(0,e.esri.Sanitizer),{useRef:Ge}=e.React;var Fe;!function(e){e.Title="TITLE",e.Extents="EXTENTS",e.SpatialReference="SPATIAL REFERENCE",e.Feature="FEATURE ATTRIBUTION",e.Quality="QUALITY"}(Fe||(Fe={}));const qe=t=>{var o,r,l,a;const u=e.hooks.useTranslation(S,e.defaultMessages,n.defaultMessages),c=Ge(null),d=Ge(null),p=Ge(!1),v=e.css`
    .dpi-input .input-wrapper{
      padding-right: 0;
    }
    .radio-con {
      cursor: pointer;
    }
    .use-current-map-scale svg{
      margin: 0 auto;
    }
    .enable-setting-con .jimu-widget-setting--row-label{
      margin-bottom: 0;
    }
    .wkid-describtion {
      font-size: ${e.polished.rem(12)};
      color: var(--ref-palette-neutral-900);
    }
    .wkid-describtion-invalid {
      color: var(--sys-color-error-dark)
    }
    .check-box-con, .radio-con {
      color: var(--ref-palette-neutral-900);
      font-size: ${e.polished.rem(14)};
      line-height: ${e.polished.rem(22)};
      margin: ${e.polished.rem(4)} 0 ${e.polished.rem(8)} 0;
    }
  `,{printTemplateProperties:h,modeType:g,jimuMapView:f,id:y,handleTemplatePropertyChange:b}=t,[x,w]=e.React.useState(null),[T,I]=e.React.useState((null===(o=h.layoutOptions)||void 0===o?void 0:o.titleText)||""),[C,R]=e.React.useState(null==h?void 0:h.wkid),[O,k]=e.React.useState(null===(r=null==h?void 0:h.exportOptions)||void 0===r?void 0:r.dpi),[j,E]=e.React.useState(null==h?void 0:h.outScale),[N,A]=e.React.useState(null),[P,M]=e.React.useState(null),L=e.React.useCallback((t=>_e(void 0,void 0,void 0,(function*(){if(p.current){const{getSRLabel:e}=c.current;return Promise.resolve(e(t))}return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{c.current=e,p.current=!0;const{getSRLabel:o}=c.current;return Promise.resolve(o(t))}))}))),[]),D=e.React.useCallback((e=>_e(void 0,void 0,void 0,(function*(){var t,o;if(e){const n=null===(o=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.spatialReference)||void 0===o?void 0:o.wkid,i=n?yield L(n):"";M(i)}}))),[L]),U=t=>_e(void 0,void 0,void 0,(function*(){if(p.current){const{isValidWkid:e}=c.current;return Promise.resolve(e(t))}return e.moduleLoader.loadModule("jimu-core/wkid").then((e=>{c.current=e,p.current=!0;const{isValidWkid:o}=c.current;return Promise.resolve(o(t))}))})),_=e=>_e(void 0,void 0,void 0,(function*(){if(e===Fe.SpatialReference&&!(null==h?void 0:h.wkidLabel)){const e=yield L(null==h?void 0:h.wkid);A(e)}w(e)})),z=()=>{w(null)},$=e=>{var t;let o=h.setIn(["printExtentType"],e);const n=f?null===(t=null==f?void 0:f.view)||void 0===t?void 0:t.scale:36978595.474472;switch(e){case s.CurrentMapExtent:o=o.setIn(["scalePreserved"],!1);break;case s.CurrentMapScale:o=o.setIn(["scalePreserved"],!0);break;case s.SetMapScale:o=o.setIn(["scalePreserved"],!0),o=o.setIn(["outScale"],n)}b(o)},G=e=>{const t=h.setIn([e],!(null==h?void 0:h[e]));b(t)},F=e.React.useCallback((e=>e?N:P),[P,N]);return e.React.useEffect((()=>{D(f)}),[f,D]),e.React.useEffect((()=>{var e,t;I((null===(e=h.layoutOptions)||void 0===e?void 0:e.titleText)||""),R(null==h?void 0:h.wkid),k(null===(t=null==h?void 0:h.exportOptions)||void 0===t?void 0:t.dpi),E(null==h?void 0:h.outScale),d.current=null==h?void 0:h.wkid,(null==h?void 0:h.wkidLabel)?A(null==h?void 0:h.wkidLabel):c.current&&(null==h?void 0:h.wkid)&&L(null==h?void 0:h.wkid).then((e=>{A(e)}))}),[L,h]),(0,e.jsx)("div",{css:v},(0,e.jsx)("div",{role:"group","aria-label":u("setDefaults")},(0,e.jsx)(i.SettingRow,{label:u("setDefaults"),flow:"wrap"}),(0,e.jsx)(n.CollapsablePanel,{label:u("printTitle"),isOpen:x===Fe.Title,onRequestOpen:()=>{_(Fe.Title)},onRequestClose:z,role:"group","aria-label":u("printTitle"),rightIcon:ze,type:"primary",className:x===Fe.Title&&"active-collapse"},(0,e.jsx)(i.SettingRow,{className:"mt-2"},(0,e.jsx)(n.TextInput,{size:"sm",className:"search-placeholder w-100",placeholder:u("printTitle"),value:T,onAcceptValue:e=>{const t=h.setIn(["layoutOptions","titleText"],e);b(t)},onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;I(o)},"aria-label":u("printTitle")}))),(0,e.jsx)(n.CollapsablePanel,{label:u("mapPrintingExtents"),isOpen:x===Fe.Extents,onRequestOpen:()=>{_(Fe.Extents)},onRequestClose:z,role:"group","aria-label":u("mapPrintingExtents"),rightIcon:ze,type:"primary",className:x===Fe.Extents&&"active-collapse"},(0,e.jsx)(i.SettingRow,{className:"mt-2"},(0,e.jsx)("div",{className:"w-100",role:"radiogroup"},(0,e.jsx)("div",{title:u("currentMapExtent"),"aria-label":u("currentMapExtent"),className:"d-flex align-items-center radio-con",onClick:()=>{$(s.CurrentMapExtent)}},(0,e.jsx)(n.Radio,{title:u("currentMapExtent"),checked:(null==h?void 0:h.printExtentType)===s.CurrentMapExtent,className:"mr-2"})," ",u("currentMapExtent")),(0,e.jsx)("div",{title:u("currentMapScale"),"aria-label":u("currentMapScale"),className:"d-flex align-items-center radio-con",onClick:()=>{$(s.CurrentMapScale)}},(0,e.jsx)(n.Radio,{title:u("currentMapScale"),checked:(null==h?void 0:h.printExtentType)===s.CurrentMapScale,className:"mr-2"})," ",u("currentMapScale")),(0,e.jsx)("div",{title:u("setMapScale"),"aria-label":u("setMapScale"),className:"d-flex align-items-center radio-con",onClick:()=>{$(s.SetMapScale)}},(0,e.jsx)(n.Radio,{title:u("setMapScale"),checked:(null==h?void 0:h.printExtentType)===s.SetMapScale,className:"mr-2"})," ",u("setMapScale")),(null==h?void 0:h.printExtentType)===s.SetMapScale&&(0,e.jsx)("div",{className:"d-flex mt-1 align-items-center"},(0,e.jsx)(n.NumericInput,{size:"sm",className:"search-placeholder flex-grow-1 dpi-input",value:j,onAcceptValue:e=>{const t=h.setIn(["outScale"],e);b(t)},onChange:e=>{E(e)},showHandlers:!1}),(0,e.jsx)(n.Button,{className:"use-current-map-scale",size:"sm",title:u("useCurrentScale"),disabled:!f,onClick:()=>{var e;if(!f)return;const t=null===(e=null==f?void 0:f.view)||void 0===e?void 0:e.scale,o=h.setIn(["outScale"],t);b(o)}},(0,e.jsx)(Pe,null)))))),(0,e.jsx)(n.CollapsablePanel,{label:u("outputSpatialReference"),isOpen:x===Fe.SpatialReference,onRequestOpen:()=>{_(Fe.SpatialReference)},onRequestClose:z,role:"group",type:"primary","aria-label":u("outputSpatialReference"),rightIcon:ze,className:x===Fe.SpatialReference&&"active-collapse"},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:(0,e.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:$e.sanitize(u("wellKnownId",{wkid:'<a target="_blank" href="https://developers.arcgis.com/rest/services-reference/enterprise/using-spatial-references.htm">WKID</a>'}))}}),className:"mt-2"},(0,e.jsx)(n.TextInput,{size:"sm",className:"search-placeholder w-100",value:C||"",onAcceptValue:e=>_e(void 0,void 0,void 0,(function*(){if(!(!e||(yield U(e)))){R(d.current);const e=yield L(d.current);return A(e),!1}const t=e?yield L(e):"";A(t);const o=h.setIn(["wkid"],e).set("wkidLabel",t);b(o)})),onChange:e=>_e(void 0,void 0,void 0,(function*(){var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;R(o);if(!o||(yield U(o))){const e=o?yield L(o):"";A(e)}else A(u("invalidWKID"))})),suffix:(0,e.jsx)(n.Tooltip,{title:u("wkidRemind"),id:`wkidRemind${y}`,describeChild:!0,enterDelay:0,"aria-live":"off",placement:"top"},(0,e.jsx)(n.Button,{className:"wkid-info-icon p-0",icon:!0,type:"tertiary","aria-label":u("additionalInformation"),"aria-describedby":`wkidRemind${y}`},(0,e.jsx)(Ue,null))),placeholder:u("wkidSettingPlaceholder",{wkid:(null===(a=null===(l=null==f?void 0:f.view)||void 0===l?void 0:l.spatialReference)||void 0===a?void 0:a.wkid)||null}),"aria-label":u("wellKnownId",{wkid:"WKID"}),"aria-describedby":"print-wkid-describtion"}),(0,e.jsx)("div",{id:"print-wkid-describtion",className:(0,e.classNames)("text-truncate mt-1 wkid-describtion",{"wkid-describtion-invalid":!(e=>{if(c.current){const{isValidWkid:t}=c.current;return!e||t(e)}return!0})(Number(C))}),title:F(C),"aria-label":F(C)},F(C)))),(0,e.jsx)(n.CollapsablePanel,{label:u("printQuality"),isOpen:x===Fe.Quality,onRequestOpen:()=>{_(Fe.Quality)},onRequestClose:z,role:"group","aria-label":u("printQuality"),type:"primary",rightIcon:ze,className:x===Fe.Quality&&"active-collapse"},(0,e.jsx)(i.SettingRow,{className:"mt-2"},(0,e.jsx)("div",{className:"d-flex align-items-center w-100"},(0,e.jsx)(n.NumericInput,{size:"sm",className:"search-placeholder flex-grow-1 dpi-input",placeholder:u("printQuality"),value:O,onAcceptValue:e=>{if(e<1)return!1;const t=h.setIn(["exportOptions","dpi"],parseInt(e));b(t)},onChange:e=>{if(e<1)return!1;k(parseInt(e))},showHandlers:!1,"aria-label":u("printQuality"),"aria-describedby":`describeElement${y}`}),(0,e.jsx)(n.Button,{disabled:!0,size:"sm",title:"DPI"},"DPI"),(0,e.jsx)("div",{className:"sr-only",id:`describeElement${y}`},O,"DPI")))),(0,e.jsx)(n.CollapsablePanel,{label:u("featureAttributes"),isOpen:x===Fe.Feature,onRequestOpen:()=>{_(Fe.Feature)},onRequestClose:z,role:"group",type:"primary","aria-label":u("featureAttributes"),rightIcon:ze,className:x===Fe.Feature&&"active-collapse"},(0,e.jsx)(i.SettingRow,{className:"mt-2"},(0,e.jsx)("div",{title:u("includeAttributes"),className:"d-flex w-100 align-items-center check-box-con","aria-label":u("includeAttributes"),onClick:()=>{G("forceFeatureAttributes")}},(0,e.jsx)(n.Checkbox,{title:u("includeAttributes"),className:"lock-item-ratio","data-field":"forceFeatureAttributes",checked:(null==h?void 0:h.forceFeatureAttributes)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("includeAttributes")))))),g===m.Classic&&(0,e.jsx)(i.SettingRow,{className:"mt-4 enable-setting-con",flow:"wrap",role:"group","aria-label":u("selectEditableSettings"),label:u("selectEditableSettings")},(0,e.jsx)("div",{className:"w-100"},(0,e.jsx)("div",{title:u("printTitle"),"aria-label":u("printTitle"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{(()=>{const e=h.setIn(["enableTitle"],!(null==h?void 0:h.enableTitle));b(e)})()}},(0,e.jsx)(n.Checkbox,{title:u("printTitle"),className:"lock-item-ratio","data-field":"enableTitle",checked:(null==h?void 0:h.enableTitle)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("printTitle"))),(0,e.jsx)("div",{title:u("mapPrintingExtents"),"aria-label":u("mapPrintingExtents"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{G("enableMapPrintExtents")}},(0,e.jsx)(n.Checkbox,{title:u("mapPrintingExtents"),className:"lock-item-ratio","data-field":"enableMapPrintExtents",checked:(null==h?void 0:h.enableMapPrintExtents)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("mapPrintingExtents"))),(0,e.jsx)("div",{title:u("outputSpatialReference"),"aria-label":u("outputSpatialReference"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{G("enableOutputSpatialReference")}},(0,e.jsx)(n.Checkbox,{title:u("outputSpatialReference"),className:"lock-item-ratio","data-field":"enableOutputSpatialReference",checked:(null==h?void 0:h.enableOutputSpatialReference)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("outputSpatialReference"))),(0,e.jsx)("div",{title:u("printQuality"),"aria-label":u("printQuality"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{G("enableQuality")}},(0,e.jsx)(n.Checkbox,{title:u("printQuality"),className:"lock-item-ratio","data-field":"enableQuality",checked:(null==h?void 0:h.enableQuality)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("printQuality"))),(0,e.jsx)("div",{title:u("featureAttributes"),"aria-label":u("featureAttributes"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{G("enableFeatureAttribution")}},(0,e.jsx)(n.Checkbox,{title:u("featureAttributes"),className:"lock-item-ratio","data-field":"enableFeatureAttribution",checked:(null==h?void 0:h.enableFeatureAttribution)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},u("featureAttributes"))))))};var Be=v(50170),He=v.n(Be),We=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};const Ve=t=>{const o=window.SVG,{className:n}=t,i=We(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:He()},i)):e.React.createElement("svg",Object.assign({className:r},i))};function Ke(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;function Ze(e){return Object.keys(e).some((t=>{let o=e[t];if(!o)return!1;o&&o.toParam&&(o=o.toParam());switch(o.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}}))}function Qe(e){const t={};return Object.keys(e).forEach((o=>{var n,i;let r=e[o];if(r&&r.toParam&&(r=r.toParam()),!r&&0!==r&&"boolean"!=typeof r&&"string"!=typeof r)return;let l;switch(r.constructor.name){case"Array":const e=null===(i=null===(n=r[0])||void 0===n?void 0:n.constructor)||void 0===i?void 0:i.name;l="Array"===e?r:"Object"===e?JSON.stringify(r):r.join(",");break;case"Object":l=JSON.stringify(r);break;case"Date":l=r.valueOf();break;case"Function":l=null;break;case"Boolean":l=r+"";break;default:l=r}(l||0===l||"string"==typeof l||Array.isArray(l))&&(t[o]=l)})),t}function Je(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map((t=>Je(e,t))).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function Ye(e){const t=Qe(e);return Object.keys(t).map((e=>Je(e,t[e]))).join("&")}const Xe=globalThis.FormData;globalThis.File,globalThis.Blob;class et extends Error{constructor(e,t,o,n,i){super(e);const r=new.target.prototype;Object.setPrototypeOf(this,r),e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:`${t}: ${e}`,this.originalMessage=e,this.code=t,this.response=o,this.url=n,this.options=i}}function tt(e){console&&console.warn&&console.warn.apply(console,[e])}const ot="@esri/arcgis-rest-js";class nt extends et{constructor(e="AUTHENTICATION_ERROR",t="AUTHENTICATION_ERROR_CODE",o,n,i){super(e,t,o,n,i),this.name="ArcGISAuthError",this.message="AUTHENTICATION_ERROR_CODE"===t?e:`${t}: ${e}`;const r=new.target.prototype;Object.setPrototypeOf(this,r)}retry(e,t=1){let o=0;const n=(i,r)=>{o+=1,e(this.url,this.options).then((e=>{const t=Object.assign(Object.assign({},this.options),{authentication:e});return it(this.url,t)})).then((e=>{i(e)})).catch((e=>{"ArcGISAuthError"===e.name&&o<t?n(i,r):e.name===this.name&&e.message===this.message&&o>=t?r(this):r(e)}))};return new Promise(((e,t)=>{n(e,t)}))}}function it(e,t){const o=globalThis.DEFAULT_ARCGIS_REQUEST_OPTIONS||{httpMethod:"POST",params:{f:"json"}},n=Object.assign(Object.assign(Object.assign({httpMethod:"POST"},o),t),{params:Object.assign(Object.assign({},o.params),t.params),headers:Object.assign(Object.assign({},o.headers),t.headers)}),{httpMethod:i,rawResponse:r}=n,l=Object.assign({f:"json"},n.params);let a=null;const s={method:i,signal:n.signal,credentials:n.credentials||"same-origin"};let u;if(n.headers&&n.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(s.credentials="include"),"string"==typeof n.authentication){const e=n.authentication;u={portal:"https://www.arcgis.com/sharing/rest",getToken:()=>Promise.resolve(e)},n.authentication.startsWith("AAPK")||n.authentication.startsWith("AATK")||n.suppressWarnings||globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING||(tt("Using an oAuth 2.0 access token directly in the token option is discouraged. Consider using ArcGISIdentityManager or Application session. See https://esriurl.com/arcgis-rest-js-direct-token-warning for more information."),globalThis.ARCGIS_REST_JS_SUPPRESS_TOKEN_WARNING=!0)}else u=n.authentication;const c=e;return(u?u.getToken(e).catch((t=>(t.url=e,t.options=n,a=t,Promise.resolve("")))):Promise.resolve("")).then((t=>{t.length&&(l.token=t),u&&u.getDomainCredentials&&(s.credentials=u.getDomainCredentials(e));const o={};if("GET"===s.method){l.token&&n.hideToken&&"undefined"==typeof window&&(o["X-Esri-Authorization"]=`Bearer ${l.token}`,delete l.token);const i=""===Ye(l)?e:e+"?"+Ye(l);n.maxUrlLength&&i.length>n.maxUrlLength||!n.maxUrlLength&&i.length>2e3||l.token&&n.hideToken?(s.method="POST",t.length&&n.hideToken&&(l.token=t,delete o["X-Esri-Authorization"])):e=i}const i=new RegExp("/items/.+/updateResources").test(e);return"POST"===s.method&&(s.body=function(e,t){const o=Ze(e)||t,n=Qe(e);if(o){const e=new Xe;return Object.keys(n).forEach((t=>{if("undefined"!=typeof Blob&&n[t]instanceof Blob){const o=n.fileName||n[t].name||t;e.append(t,n[t],o)}else e.append(t,n[t])})),e}return Ye(e)}(l,i)),s.headers=Object.assign(Object.assign({},o),n.headers),("undefined"==typeof window||window&&void 0===window.document)&&!s.headers.referer&&(s.headers.referer=ot),Ze(l)||i||(s.headers["Content-Type"]="application/x-www-form-urlencoded"),globalThis.fetch?globalThis.fetch(e,s):Promise.resolve({fetch:globalThis.fetch,Headers:globalThis.Headers,Response:globalThis.Response,Request:globalThis.Request}).then((({fetch:t})=>t(e,s)))})).then((t=>{if(!t.ok)return t.json().then((o=>{const{status:i,statusText:r}=t,{message:l,details:a}=o.error,s=`${l}. ${a?a.join(" "):""}`.trim();throw new et(s,`HTTP ${i} ${r}`,o,e,n)})).catch((o=>{if("ArcGISRequestError"===o.name)throw o;const{status:i,statusText:r}=t;throw new et(r,`HTTP ${i}`,t,e,n)}));if(r)return t;switch(l.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}})).then((t=>{if("json"!==l.f&&"geojson"!==l.f||r)return t;{const o=function(e,t,o,n,i){if(e.code>=400){const{message:o,code:i}=e;throw new et(o,i,e,t,n)}if(e.error){const{message:o,code:r,messageCode:l}=e.error,a=l||r||"UNKNOWN_ERROR_CODE";if(498===r||499===r)throw i||new nt(o,a,e,t,n);throw new et(o,a,e,t,n)}if("failed"===e.status||"failure"===e.status){let o,i="UNKNOWN_ERROR_CODE";try{o=JSON.parse(e.statusMessage).message,i=JSON.parse(e.statusMessage).code}catch(t){o=e.statusMessage||e.message}throw new et(o,i,e,t,n)}return e}(t,c,0,n,a);if(a){const t=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];n.authentication.federatedServers[t]={token:[],expires:new Date(Date.now()+864e5)},a=null}return o}}))}function rt(e,t={params:{f:"json"}}){const{request:o}=t,n=Ke(t,["request"]);return o?o(e,n):it(e,n).catch((e=>e instanceof nt&&t.authentication&&"string"!=typeof t.authentication&&t.authentication.canRefresh&&t.authentication.refreshCredentials?e.retry((()=>t.authentication.refreshCredentials()),1):Promise.reject(e)))}var lt,at;!function(e){e.TOKEN_REFRESH_FAILED="TOKEN_REFRESH_FAILED",e.GENERATE_TOKEN_FOR_SERVER_FAILED="GENERATE_TOKEN_FOR_SERVER_FAILED",e.REFRESH_TOKEN_EXCHANGE_FAILED="REFRESH_TOKEN_EXCHANGE_FAILED",e.NOT_FEDERATED="NOT_FEDERATED",e.UNKNOWN_ERROR_CODE="UNKNOWN_ERROR_CODE"}(lt||(lt={}));class st extends Error{constructor(e="UNKNOWN_ERROR",t=lt.UNKNOWN_ERROR_CODE,o,n,i){super(e);const r=new.target.prototype;Object.setPrototypeOf(this,r),this.name="ArcGISTokenRequestError",this.message=`${t}: ${e}`,this.originalMessage=e,this.code=t,this.response=o,this.url=n,this.options=i}}class ut extends Error{constructor(){super("The user has denied your authorization request.");const e=new.target.prototype;Object.setPrototypeOf(this,e),this.name="ArcGISAccessDeniedError"}}Error;function ct(e){return"string"!=typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}!function(e){e.ArcGISRequestError="ArcGISRequestError",e.ArcGISAuthError="ArcGISAuthError",e.ArcGISAccessDeniedError="ArcGISAccessDeniedError",e.ArcGISTokenRequestError="ArcGISTokenRequestError"}(at||(at={}));const dt=3e5;function pt(e,t){const o=t;return o.rawResponse=!1,rt(e,o).then((e=>{if("token"in e&&"expires"in e)return{token:e.token,username:t.params.username,expires:new Date(e.expires)};const o={token:e.access_token,username:e.username,expires:new Date(Date.now()+1e3*e.expires_in-dt),ssl:!0===e.ssl};return e.refresh_token&&(o.refreshToken=e.refresh_token),e.refresh_token_expires_in&&(o.refreshTokenExpires=new Date(Date.now()+1e3*e.refresh_token_expires_in-dt)),o}))}class mt{constructor(e){this.portal=e.portal?ct(e.portal):"https://www.arcgis.com/sharing/rest",this._username=e.username}get username(){return this._username?this._username:this._user&&this._user.username?this._user.username:void 0}getUsername(){return this.username?Promise.resolve(this.username):this.getUser().then((e=>e.username))}getUser(e){if(this._pendingUserRequest)return this._pendingUserRequest;if(this._user)return Promise.resolve(this._user);{const t=`${this.portal}/community/self`,o=Object.assign(Object.assign({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingUserRequest=rt(t,o).then((e=>(this._user=e,this._pendingUserRequest=null,e))),this._pendingUserRequest}}clearCachedUserInfo(){this._user=null}}function vt(e){return!e||e.length<=0?{}:e.replace(/^#/,"").replace(/^\?/,"").split("&").reduce(((e,t)=>{const{key:o,value:n}=function(e){const[t,o]=e.split("=");return{key:decodeURIComponent(t),value:decodeURIComponent(o)}}(t);return e[o]=n,e}),{})}const ht=/^https?:\/\/(\S+)\.arcgis\.com.+/;function gt(e){return ht.test(e)}function ft(e){if(!ht.test(e))return null;const t=e.match(ht)[1].split(".").pop();return t.includes("dev")?"dev":t.includes("qa")?"qa":"production"}function yt(e,t){const o=ct(function(e){if(!ht.test(e))return e;switch(ft(e)){case"dev":return"https://devext.arcgis.com/sharing/rest";case"qa":return"https://qaext.arcgis.com/sharing/rest";default:return"https://www.arcgis.com/sharing/rest"}}(t)).replace(/https?:\/\//,""),n=ct(e).replace(/https?:\/\//,"");return new RegExp(n,"i").test(o)}function bt(e,t=window){return!t&&window&&(t=window),t.btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function xt(e){!e&&window&&(e=window);return bt(e.crypto.getRandomValues(new Uint8Array(32)))}class wt extends mt{constructor(e){if(super(e),this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?ct(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.server=e.server,this.referer=e.referer,this.federatedServers={},this.trustedDomains=[],e.server){const t=this.getServerRootUrl(e.server);this.federatedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}get token(){return this._token}get tokenExpires(){return this._tokenExpires}get refreshToken(){return this._refreshToken}get refreshTokenExpires(){return this._refreshTokenExpires}get canRefresh(){return!(!this.username||!this.password)||!!(this.clientId&&this.refreshToken&&this.redirectUri)}static beginOAuth2(e,t){!t&&window&&(t=window);const{portal:o,provider:n,clientId:i,expiration:r,redirectUri:l,popup:a,popupWindowFeatures:s,locale:u,params:c,style:d,pkce:p,state:m}=Object.assign({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",expiration:20160,popup:!0,popupWindowFeatures:"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes",locale:"",style:"",pkce:!0},e),v=m||xt(t),h=`ARCGIS_REST_JS_AUTH_STATE_${i}`;t.localStorage.setItem(h,v);let g=`${ct(o)}/oauth2/authorize`;const f={client_id:i,response_type:p?"code":"token",expiration:r,redirect_uri:l,state:JSON.stringify({id:v,originalUrl:t.location.href}),locale:u,style:d};let y;if("arcgis"!==n&&(g=`${ct(o)}/oauth2/social/authorize`,f.socialLoginProviderName=n,f.autoAccountCreateForSocial=!0),p){const e=xt(t),o=`ARCGIS_REST_JS_CODE_VERIFIER_${i}`;t.localStorage.setItem(o,e),y=function(e,t=window){if(!t&&window&&(t=window),e&&t.isSecureContext&&t.crypto&&t.crypto.subtle){const o=(new t.TextEncoder).encode(e);return t.crypto.subtle.digest("SHA-256",o).then((e=>bt(new Uint8Array(e),t)))}return Promise.resolve(null)}(e,t).then((function(t){f.code_challenge_method=t?"S256":"plain",f.code_challenge=t||e}))}else y=Promise.resolve();return y.then((()=>(g=`${g}?${Ye(f)}`,c&&(g=`${g}&${Ye(c)}`),a?new Promise(((e,n)=>{t.addEventListener(`arcgis-rest-js-popup-auth-${i}`,(t=>{if("access_denied"===t.detail.error){const e=new ut;return n(e),e}if(t.detail.errorMessage){const e=new nt(t.detail.errorMessage,t.detail.error);return n(e),e}e(new wt({clientId:i,portal:o,ssl:t.detail.ssl,token:t.detail.token,tokenExpires:t.detail.expires,username:t.detail.username,refreshToken:t.detail.refreshToken,refreshTokenExpires:t.detail.refreshTokenExpires,redirectUri:l}))}),{once:!0}),t.open(g,"oauth-window",s),t.dispatchEvent(new CustomEvent("arcgis-rest-js-popup-auth-start"))})):void(t.location.href=g))))}static completeOAuth2(e,t){!t&&window&&(t=window);const{portal:o,clientId:n,popup:i,pkce:r,redirectUri:l}=Object.assign({portal:"https://www.arcgis.com/sharing/rest",popup:!0,pkce:!0},e),a=`ARCGIS_REST_JS_AUTH_STATE_${n}`,s=t.localStorage.getItem(a),u=vt(r?t.location.search.replace(/^\?/,""):t.location.hash.replace(/^#/,"")),c=u&&u.state?JSON.parse(u.state):void 0;function d(e,o,r){return t.localStorage.removeItem(a),i&&t.opener?(t.opener.dispatchEvent(new CustomEvent(`arcgis-rest-js-popup-auth-${n}`,{detail:{error:o,errorMessage:e}})),void t.close()):(r&&t.history.replaceState(t.history.state,"",r),"access_denied"===o?Promise.reject(new ut):Promise.reject(new nt(e,o)))}function p(e,r){return t.localStorage.removeItem(a),i&&t.opener?(t.opener.dispatchEvent(new CustomEvent(`arcgis-rest-js-popup-auth-${n}`,{detail:Object.assign({},e)})),void t.close()):(t.history.replaceState(t.history.state,"",r),new wt({clientId:n,portal:o,ssl:e.ssl,token:e.token,tokenExpires:e.expires,username:e.username,refreshToken:e.refreshToken,refreshTokenExpires:e.refreshTokenExpires,redirectUri:l||location.href.replace(location.search,"")}))}if(!s||!c)return d("No authentication state was found, call `ArcGISIdentityManager.beginOAuth2(...)` to start the authentication process.","no-auth-state");if(c.id!==s)return d("Saved client state did not match server sent state.","mismatched-auth-state");if(u.error){const e=u.error;return d(u.error_description||"Unknown error",e,c.originalUrl)}if(r&&u.code){const e=ct(`${o}/oauth2/token/`),i=`ARCGIS_REST_JS_CODE_VERIFIER_${n}`,r=t.localStorage.getItem(i);return t.localStorage.removeItem(i),pt(e,{httpMethod:"POST",params:{client_id:n,code_verifier:r,grant_type:"authorization_code",redirect_uri:l||location.href.replace(location.search,""),code:u.code}}).then((e=>p(Object.assign(Object.assign({},e),c),c.originalUrl))).catch((e=>d(e.originalMessage,e.code,c.originalUrl)))}return!r&&u.access_token?Promise.resolve(p(Object.assign({token:u.access_token,expires:new Date(Date.now()+1e3*parseInt(u.expires_in,10)),ssl:"true"===u.ssl,username:u.username},c),c.originalUrl)):d("Unknown error","oauth-error",c.originalUrl)}static fromParent(e,t){let o;return!t&&window&&(t=window),new Promise(((n,i)=>{o=e=>{if(e.source===t.parent&&e.data)try{return n(wt.parentMessageHandler(e))}catch(e){return i(e)}},t.addEventListener("message",o,!1),t.parent.postMessage({type:"arcgis:auth:requestCredential"},e)})).then((e=>(t.removeEventListener("message",o,!1),e)))}static authorize(e,t){const{portal:o,clientId:n,expiration:i,redirectUri:r,state:l}=Object.assign({portal:"https://arcgis.com/sharing/rest",expiration:20160},e),a={client_id:n,expiration:i,response_type:"code",redirect_uri:r};l&&(a.state=l);const s=`${o}/oauth2/authorize?${Ye(a)}`;t.writeHead(301,{Location:s}),t.end()}static exchangeAuthorizationCode(e,t){const{portal:o,clientId:n,redirectUri:i}=Object.assign({portal:"https://www.arcgis.com/sharing/rest"},e);return pt(`${o}/oauth2/token`,{params:{grant_type:"authorization_code",client_id:n,redirect_uri:i,code:t}}).then((e=>new wt({clientId:n,portal:o,ssl:e.ssl,redirectUri:i,refreshToken:e.refreshToken,refreshTokenExpires:e.refreshTokenExpires,token:e.token,tokenExpires:e.expires,username:e.username}))).catch((e=>{throw new st(e.message,lt.REFRESH_TOKEN_EXCHANGE_FAILED,e.response,e.url,e.options)}))}static deserialize(e){const t=JSON.parse(e);return new wt({clientId:t.clientId,refreshToken:t.refreshToken,refreshTokenExpires:t.refreshTokenExpires?new Date(t.refreshTokenExpires):void 0,username:t.username,password:t.password,token:t.token,tokenExpires:t.tokenExpires?new Date(t.tokenExpires):void 0,portal:t.portal,ssl:t.ssl,tokenDuration:t.tokenDuration,redirectUri:t.redirectUri,server:t.server})}static fromCredential(e,t){const o=void 0===e.ssl||e.ssl,n=e.expires||Date.now()+72e5;return t.hasServer?new wt({server:e.server,ssl:o,token:e.token,username:e.userId,tokenExpires:new Date(n)}):new wt({portal:ct(e.server.includes("sharing/rest")?e.server:e.server+"/sharing/rest"),ssl:o,token:e.token,username:e.userId,tokenExpires:new Date(n)})}static parentMessageHandler(e){if("arcgis:auth:credential"===e.data.type){const t=e.data.credential;return function(e){return"string"==typeof e.userId||"number"==typeof e.expires}(t)?wt.fromCredential(t,{hasPortal:!0,hasServer:!1,server:t.server}):new wt(t)}if("arcgis:auth:error"===e.data.type){const t=new Error(e.data.error.message);throw t.name=e.data.error.name,t}throw new Error("Unknown message type.")}static destroy(e){return function(e){const t=`${ct(e.portal||"https://www.arcgis.com/sharing/rest")}/oauth2/revokeToken/`,o=e.token,n=e.clientId;delete e.portal,delete e.clientId,delete e.token;const i=Object.assign(Object.assign({},e),{httpMethod:"POST",params:{client_id:n,auth_token:o}});return rt(t,i).then((e=>{if(!e.success)throw new et("Unable to revoke token",500,e,t,i);return e}))}({clientId:e.clientId,portal:e.portal,token:e.refreshToken||e.token})}static fromToken(e){const t=new wt(e);return t.getUser().then((()=>t))}static signIn(e){const t=new wt(e);return t.getUser().then((()=>t))}toCredential(){return{expires:this.tokenExpires.getTime(),server:this.server||this.portal,ssl:this.ssl,token:this.token,userId:this.username}}getPortal(e){if(this._pendingPortalRequest)return this._pendingPortalRequest;if(this._portalInfo)return Promise.resolve(this._portalInfo);{const t=`${this.portal}/portals/self`,o=Object.assign(Object.assign({httpMethod:"GET",authentication:this},e),{rawResponse:!1});return this._pendingPortalRequest=rt(t,o).then((e=>(this._portalInfo=e,this._pendingPortalRequest=null,e))),this._pendingPortalRequest}}getToken(e,t){return function(e,t){const o=gt(e),n=gt(t),i=ft(e),r=ft(t);return!(!o||!n||i!==r)}(this.portal,e)||new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t)}validateAppAccess(e){return this.getToken(this.portal).then((t=>function(e,t,o="https://www.arcgis.com/sharing/rest"){return rt(`${o}/oauth2/validateAppAccess`,{method:"POST",params:{f:"json",client_id:t,token:e}})}(t,e)))}toJSON(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires||void 0,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires||void 0,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,server:this.server}}serialize(){return JSON.stringify(this)}enablePostMessageAuth(e,t){!t&&window&&(t=window),this._hostHandler=this.createPostMessageHandler(e),t.addEventListener("message",this._hostHandler,!1)}disablePostMessageAuth(e){!e&&window&&(e=window),e.removeEventListener("message",this._hostHandler,!1)}refreshCredentials(e){return this.clearCachedUserInfo(),this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new st("Unable to refresh token. No refresh token or password present.",lt.TOKEN_REFRESH_FAILED))}getServerRootUrl(e){const[t]=ct(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/),[o,n,i]=t.match(/(https?:\/\/)(.+)/),[r,...l]=i.split("/");return`${n}${r.toLowerCase()}/${l.join("/")}`}getDomainCredentials(e){return this.trustedDomains&&this.trustedDomains.length?(e=e.toLowerCase(),this.trustedDomains.some((t=>e.startsWith(t.toLowerCase())))?"include":"same-origin"):"same-origin"}signOut(){return wt.destroy(this)}createPostMessageHandler(e){return t=>{const o=e.indexOf(t.origin)>-1,n="arcgis:auth:requestCredential"===t.data.type,i=this.tokenExpires.getTime()>Date.now();if(o&&n){let e={};if(i){const t=this.toCredential();t.server=t.server.replace("/sharing/rest",""),e={type:"arcgis:auth:credential",credential:t}}else e={type:"arcgis:auth:error",error:{name:"tokenExpiredError",message:"Token was expired, and not returned to the child application"}};t.source.postMessage(e,t.origin)}}}getTokenForServer(e,t){const o=this.getServerRootUrl(e),n=this.federatedServers[o];return n&&n.expires&&n.expires.getTime()>Date.now()?Promise.resolve(n.token):(this._pendingTokenRequests[o]||(this._pendingTokenRequests[o]=this.fetchAuthorizedDomains().then((()=>rt(`${o}/rest/info`,{credentials:this.getDomainCredentials(e)}).then((n=>{if(n.owningSystemUrl){if(yt(n.owningSystemUrl,this.portal))return rt(`${n.owningSystemUrl}/sharing/rest/info`,t);throw new st(`${e} is not federated with ${this.portal}.`,lt.NOT_FEDERATED)}if(n.authInfo&&void 0!==this.federatedServers[o])return Promise.resolve({authInfo:n.authInfo});throw new st(`${e} is not federated with any portal and is not explicitly trusted.`,lt.NOT_FEDERATED)})).then((e=>this.token&&this.tokenExpires.getTime()<Date.now()?this.server?this.refreshCredentials().then((()=>({token:this.token,expires:this.tokenExpires}))):this.refreshCredentials().then((()=>this.generateTokenForServer(e.authInfo.tokenServicesUrl,o))):this.generateTokenForServer(e.authInfo.tokenServicesUrl,o))).then((e=>(this.federatedServers[o]=e,delete this._pendingTokenRequests[o],e.token)))))),this._pendingTokenRequests[o])}generateTokenForServer(e,t){return rt(e,{params:{token:this.token,serverUrl:t,expiration:this.tokenDuration}}).then((e=>({token:e.token,expires:new Date(e.expires-3e5)}))).catch((e=>{throw new st(e.message,lt.GENERATE_TOKEN_FOR_SERVER_FAILED,e.response,e.url,e.options)}))}getFreshToken(e){return this.token&&!this.tokenExpires||this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshCredentials(e).then((()=>(this._pendingTokenRequests[this.portal]=null,this.token)))),this._pendingTokenRequests[this.portal])}refreshWithUsernameAndPassword(e){const t={username:this.username,password:this.password,expiration:this.tokenDuration,client:"referer",referer:this.referer?this.referer:"undefined"!=typeof window&&void 0!==window.document&&window.location&&window.location.origin?window.location.origin:ot};return(this.server?rt(`${this.getServerRootUrl(this.server)}/rest/info`).then((o=>rt(o.authInfo.tokenServicesUrl,Object.assign({params:t},e)))):rt(`${this.portal}/generateToken`,Object.assign({params:t},e))).then((e=>(this.updateToken(e.token,new Date(e.expires)),this))).catch((e=>{throw new st(e.message,lt.TOKEN_REFRESH_FAILED,e.response,e.url,e.options)}))}refreshWithRefreshToken(e){if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()-864e5<Date.now())return this.exchangeRefreshToken(e);const t=Object.assign({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e);return pt(`${this.portal}/oauth2/token`,t).then((e=>this.updateToken(e.token,e.expires))).catch((e=>{throw new st(e.message,lt.TOKEN_REFRESH_FAILED,e.response,e.url,e.options)}))}updateToken(e,t){return this._token=e,this._tokenExpires=t,this}exchangeRefreshToken(e){const t=Object.assign({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e);return pt(`${this.portal}/oauth2/token`,t).then((e=>(this._token=e.token,this._tokenExpires=e.expires,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this))).catch((e=>{throw new st(e.message,lt.REFRESH_TOKEN_EXCHANGE_FAILED,e.response,e.url,e.options)}))}fetchAuthorizedDomains(){return this.server||!this.portal?Promise.resolve(this):this.getPortal().then((e=>(e.authorizedCrossOriginDomains&&e.authorizedCrossOriginDomains.length&&(this.trustedDomains=e.authorizedCrossOriginDomains.filter((e=>!e.startsWith("http://"))).map((e=>e.startsWith("https://")?e:`https://${e}`))),this)))}}function Tt(e){return console.log("DEPRECATED:, 'UserSession' is deprecated. Use 'ArcGISIdentityManager' instead."),new wt(e)}var St;Tt.beginOAuth2=function(...e){return console.warn("DEPRECATED:, 'UserSession.beginOAuth2' is deprecated. Use 'ArcGISIdentityManager.beginOAuth2' instead."),wt.beginOAuth2(...e)},Tt.completeOAuth2=function(...e){return console.warn("DEPRECATED:, 'UserSession.completeOAuth2()' is deprecated. Use 'ArcGISIdentityManager.completeOAuth2()' instead."),e.length<=1&&console.warn("WARNING:, 'UserSession.completeOAuth2()' is now async and returns a promise the resolves to an instance of `ArcGISIdentityManager`."),wt.completeOAuth2(...e)},Tt.fromParent=function(...e){return console.warn("DEPRECATED:, 'UserSession.fromParent' is deprecated. Use 'ArcGISIdentityManager.fromParent' instead."),wt.fromParent(...e)},Tt.authorize=function(...e){return console.warn("DEPRECATED:, 'UserSession.authorize' is deprecated. Use 'ArcGISIdentityManager.authorize' instead."),wt.authorize(...e)},Tt.exchangeAuthorizationCode=function(...e){return console.warn("DEPRECATED:, 'UserSession.exchangeAuthorizationCode' is deprecated. Use 'ArcGISIdentityManager.exchangeAuthorizationCode' instead."),wt.exchangeAuthorizationCode(...e)},Tt.fromCredential=function(...e){return console.log("DEPRECATED:, 'UserSession.fromCredential' is deprecated. Use 'ArcGISIdentityManager.fromCredential' instead."),console.warn("WARNING:, 'UserSession.fromCredential' now requires a `ServerInfo` object from the JS API as a second parameter."),wt.fromCredential(...e)},Tt.deserialize=function(...e){return console.log("DEPRECATED:, 'UserSession.deserialize' is deprecated. Use 'ArcGISIdentityManager.deserialize' instead."),wt.deserialize(...e)},function(e){e.Success="Succeeded",e.Failed="Failed",e.Waiting="Waiting",e.Cancelled="Cancelled",e.Cancelling="Cancelling",e.New="New",e.Executing="Executing",e.Submitted="Submitted",e.Failure="Failure",e.TimedOut="TimedOut",e.Error="Error",e.Status="Etatus",e.Unknown="Unknown"}(St||(St={}));class It{constructor(e=""){this.termStack=[],this.rangeStack=[],this.openGroups=0,this.q=e}match(...e){return this.termStack=this.termStack.concat(e),this}in(e){const t=`\`in(${e?`"${e}"`:""})\``;return this.hasRange||this.hasTerms?(e&&"*"!==e&&(this.q+=`${e}:`),this.commit()):(tt(`${t} was called with no call to \`match(...)\` or \`from(...)\`/\`to(...)\`. Your query was not modified.`),this)}startGroup(){return this.commit(),this.openGroups>0&&(this.q+=" "),this.openGroups++,this.q+="(",this}endGroup(){return this.openGroups<=0?(tt("`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified."),this):(this.commit(),this.openGroups--,this.q+=")",this)}and(){return this.addModifier("and")}or(){return this.addModifier("or")}not(){return this.addModifier("not")}from(e){return this.hasTerms?(tt('`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01").  Your query was not modified.'),this):(this.rangeStack[0]=e,this)}to(e){return this.hasTerms?(tt('`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date("2020-01-01"). Your query was not modified.'),this):(this.rangeStack[1]=e,this)}boost(e){return this.commit(),this.q+=`^${e}`,this}toParam(){return this.commit(),this.cleanup(),this.q}clone(){return this.commit(),this.cleanup(),new It(this.q+"")}addModifier(e){return this.currentModifer?(tt(`You have called \`${this.currentModifer}()\` after \`${e}()\`. Your current query was not modified.`),this):(this.commit(),""===this.q&&"not"!==e?(tt(`You have called \`${e}()\` without calling another method to modify your query first. Try calling \`match()\` first.`),this):(this.currentModifer=e,this.q+=""===this.q?"":" ",this.q+=`${e.toUpperCase()} `,this))}hasWhiteSpace(e){return/\s/g.test(e)}formatTerm(e){return e instanceof Date?e.getTime():"string"==typeof e&&this.hasWhiteSpace(e)?`"${e}"`:e}commit(){return this.currentModifer=void 0,this.hasRange&&(this.q+=`[${this.formatTerm(this.rangeStack[0])} TO ${this.formatTerm(this.rangeStack[1])}]`,this.rangeStack=[void 0,void 0]),this.hasTerms&&(this.q+=this.termStack.map((e=>this.formatTerm(e))).join(" "),this.termStack=[]),this}get hasTerms(){return this.termStack.length>0}get hasRange(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]}cleanup(){if(this.openGroups>0)for(tt(`Automatically closing ${this.openGroups} group(s). You can use \`endGroup(...)\` to remove this warning.`);this.openGroups>0;)this.q+=")",this.openGroups--;const e=this.q;this.q=e.replace(/( AND ?| NOT ?| OR ?)*$/,""),e!==this.q&&tt("`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified."),this.q=this.q.replace(/(\(\))*/,"")}}var Ct=v(79860),Rt=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}s((n=n.apply(e,t||[])).next())}))};function Ot(t,o,n,i){var r,l;let a=(new It).match(o).in("type");i&&(a=a.and().startGroup().not().match(i).in("type").endGroup()),t&&(a=a.and().startGroup().match(t).endGroup());const s=(0,e.getAppStore)().getState(),u=null===(l=null===(r=null==s?void 0:s.portalSelf)||void 0===r?void 0:r.user)||void 0===l?void 0:l.orgId;return n===(null==s?void 0:s.portalUrl)&&u&&(a=a.and().match(u).in("orgid")),a.toParam()}var kt=v(1888);const jt={crossAxis:!0},Et=e.css`
  .dropdown >.dropdown-button:hover,  .dropdown >.dropdown-button{
    background: var(--ref-palette-neutral-300);
    border: 1px solid var(--ref-palette-neutral-300);
    border-radius: ${e.polished.rem(2)};
    text-align: left;
  }
`,Nt=(0,kt.styled)(n.DropdownMenu)`
  & .dropdown-item-con{
    max-height: ${e.polished.rem(400)};
    max-width: ${e.polished.rem(300)};
    min-width: ${e.polished.rem(227)};
    overflow: auto;
  }
  .search-container{
    padding: 0 0.5rem 0.5rem 0.5rem;
  }
  .loading-placeholder, .loading-con {
    width: ${e.polished.rem(16)};
    height: ${e.polished.rem(16)};
  }
  .loading-con {
    @keyframes loading {
      0% {transform: rotate(0deg)};
      100% {transform: rotate(360deg)};
    }
    position: absolute;
    right: ${e.polished.rem(8)};
    bottom: ${e.polished.rem(2)};
    min-width: ${e.polished.rem(16)};
    border: 2px solid var(--ref-palette-neutral-1000);
    border-radius: 50%;
    border-top: 2px solid var(--sys-color-primary-main);
    box-sizing: border-box;
    animation:loading 2s infinite linear;
    box-sizing: border-box;
  }
`,{useState:At,useRef:Pt,useEffect:Mt}=e.React,Lt=t=>{const o=Pt(null),i=Pt(null),r=Pt(null),l=Pt(1),a=Pt(""),s=Pt((0,e.Immutable)([])),u=Pt(null),c=Pt(null),d=Pt(null),p=e.hooks.useTranslation(n.defaultMessages),{portalUrl:m,title:v,className:h,size:g,buttonProps:f,menuProps:y,zIndex:b,fluid:x,autoWidth:w,appendToBody:T,strategy:S,useKeyUpEvent:I,hideSearchInput:C,itemtype:R,activeItem:O,placeholder:k,excludeType:j,onChange:E}=t,[N,A]=At(!1),[P,M]=At(""),[L,D]=At(!1),[U,_]=At((0,e.Immutable)([]));Mt((()=>{d.current=m,z()}),[m]);const z=e.hooks.useEventCallback((()=>{if(l.current<0||!d.current)return;const t=e.SessionManager.getInstance().getSessionByUrl(d.current),o={searchText:P,start:l.current,searchItemtype:R||"Layout",portalUrl:d.current,excludeType:j};t&&(o.authentication=t),D(!0),function(e){return Rt(this,void 0,void 0,(function*(){const{searchText:t,portalUrl:o,num:n,start:i,sortField:r,sortOrder:l,searchItemtype:a,excludeType:s,authentication:u}=e;if(!o)return Promise.reject(new Error("No portal url"));const c={start:i||1,num:n||30,q:Ot(t,a,o,s),sortField:r||"modified",sortOrder:l||"desc"};return u&&(c.authentication=u),Ct.appServices.searchAppByPortalUrl(c,o)}))}(o).then((t=>{var o;if(D(!1),t){let n=1===l.current?[]:null===(o=s.current)||void 0===o?void 0:o.asMutable({deep:!0});l.current=null==t?void 0:t.nextStart;const i=(null==t?void 0:t.results)||[];n=n.concat(i),s.current=(0,e.Immutable)(n),_((0,e.Immutable)(n))}})).catch((e=>{D(!1)}))})),$=t=>{l.current=1,a.current=t.target.value,M(t.target.value),clearTimeout(u.current),s.current=(0,e.Immutable)([]),u.current=setTimeout((()=>{z()}),500)},G=e=>{e&&c.current&&function(e,t,o,n){const i=new IntersectionObserver((function(e,t){const n=e[0].intersectionRatio>0;o&&o(n)}),n||{root:t});i.observe(e)}(c.current,e,F)},F=(e=!1)=>{var t;e&&(null===(t=s.current)||void 0===t?void 0:t.length)>0&&z()};return(0,e.jsx)("div",{className:(0,e.classNames)("app-item-selector-con w-100",h),css:Et},(0,e.jsx)(n.Dropdown,{className:"w-100",size:g,direction:"down",fluid:x,autoWidth:w,toggle:()=>{A(!N)},isOpen:N,useKeyUpEvent:I,handelTabEvent:t=>{const o=!C&&i.current;let n;return"Tab"===t.key&&t.shiftKey?n=o:"Tab"===t.key&&t.shiftKey,!!n&&(t.preventDefault(),(0,e.focusElementInKeyboardMode)(n),!0)},menuRole:"listbox","aria-label":t["aria-label"]},(0,e.jsx)(n.DropdownButton,Object.assign({size:g},f,{innerRef:e=>{o.current=e},title:v||(null==O?void 0:O.title),"aria-describedby":t["aria-describedby"],"a11y-description":t["a11y-description"],role:"combobox"}),(null==O?void 0:O.title)||k),(0,e.jsx)(Nt,Object.assign({appendToBody:T,strategy:S,zIndex:b,className:"shadow-3",shiftOptions:jt,trapFocus:!1},y),m&&(0,e.jsx)("div",null,!C&&(0,e.jsx)("div",{className:"search-container"},(0,e.jsx)(n.TextInput,{prefix:(0,e.jsx)(Ve,null),allowClear:!0,size:"sm",type:"text",value:P,ref:i,placeholder:p("SearchLabel"),onChange:$})),(0,e.jsx)("div",{className:"dropdown-item-con",ref:e=>{G(e)}},U.map(((t,o)=>(0,e.jsx)(n.DropdownItem,{ref:e=>{((e,t)=>{0===t&&e&&(r.current=e)})(e,o)},key:o,className:"select-item text-truncate d-block text-left",onClick:e=>{(e=>{e.id!==(null==O?void 0:O.id)&&E&&E(e)})(null==t?void 0:t.asMutable({deep:!0}))},active:(null==O?void 0:O.id)===t.id,title:t.title,"aria-label":t.title},t.title))),(null==U?void 0:U.length)>0&&!L&&(0,e.jsx)("span",{ref:c}),0===(null==U?void 0:U.length)&&!L&&(0,e.jsx)(n.DropdownItem,{disabled:!0,"aria-label":p("noItemsFound")},p("noItemsFound")),L&&(0,e.jsx)("div",{className:"loading-item"},(0,e.jsx)("div",{className:"loading-placeholder"}),(0,e.jsx)("div",{className:"loading-con"})))))))};var Dt=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}s((n=n.apply(e,t||[])).next())}))};const{useState:Ut,useEffect:_t,useRef:zt}=e.React,$t=e.css`
  .radio-con {
    cursor: pointer;
  }
`,Gt=t=>{const o=e.hooks.useTranslation(S),r=zt(null),{id:l,template:a,config:s,templateIndex:u,handleLayoutChange:c,onSettingChange:d,toggleLoading:p}=t,[m,v]=Ut(null),[h,g]=Ut(null),[y,b]=Ut(!1);_t((()=>{r.current=null==a?void 0:a.customLayoutItem}),[a]),_t((()=>{v(r.current)}),[u]),_t((()=>{C(s.useUtility).then((e=>{g(e)})),O(s.useUtility)}),[s.useUtility]);const w=e=>Dt(void 0,void 0,void 0,(function*(){const t={id:e.id,title:e.title};v(t),p(!0),R(s,t,u).then((e=>{p(!1),d({id:l,config:e})}),(e=>{v((null==a?void 0:a.customLayoutItem)||null),p(!1)}))})),T=()=>{var e,t;const o=a.set("layoutTypes",x.CustomLayout).set("customLayoutItem",null),n=(null==s?void 0:s.printTemplateType)===f.Customize?null===(e=s.printCustomTemplate)||void 0===e?void 0:e.asMutable({deep:!0}):null===(t=s.printOrgTemplate)||void 0===t?void 0:t.asMutable({deep:!0});n[u]=null==o?void 0:o.asMutable({deep:!0});const i=(null==s?void 0:s.printTemplateType)===f.Customize?s.set("printCustomTemplate",n):s.set("printOrgTemplate",n);v(null),d({id:l,config:i})},I=()=>{var e,t;const o=null===(t=null===(e=null==s?void 0:s.layoutChoiceList)||void 0===e?void 0:e[u])||void 0===t?void 0:t.layout;c(B(o))},O=t=>Dt(void 0,void 0,void 0,(function*(){var o,n;const i=yield W(null==t?void 0:t.asMutable({deep:!0})),r=(null===(o=(0,e.getAppStore)().getState().portalSelf)||void 0===o?void 0:o.helperServices)||{},l=null===(n=null==r?void 0:r.printTask)||void 0===n?void 0:n.url;b((!i||i!==l)&&s.supportCustomLayout)}));return(0,e.jsx)("div",{className:"custom-layout-setting-con mt-2",css:$t},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:o("printLayout")}),(()=>{var t,r;const l=!(null==a?void 0:a.layoutTypes)||(null==a?void 0:a.layoutTypes)===x.ServiceLayout||!y,u=(null===(t=null==s?void 0:s.layoutChoiceList)||void 0===t?void 0:t.length)>0;return(0,e.jsx)("div",{role:"group","aria-label":o("printLayout")},(0,e.jsx)("div",{role:"radiogroup"},y&&u&&(0,e.jsx)(i.SettingRow,null,(0,e.jsx)("div",{className:"d-flex radio-con align-items-center",title:o("useServiceLayout"),onClick:I},(0,e.jsx)(n.Radio,{className:"mr-1",checked:l,title:o("useServiceLayout")}),(0,e.jsx)("span",null,o("useServiceLayout")))),y&&u&&(0,e.jsx)(i.SettingRow,null,(0,e.jsx)("div",{className:"d-flex radio-con align-items-center","aria-label":o("useCustomLayout"),title:o("useCustomLayout"),onClick:T},(0,e.jsx)(n.Radio,{checked:(null==a?void 0:a.layoutTypes)===x.CustomLayout,className:"mr-1",title:o("useCustomLayout")}),(0,e.jsx)("span",null,o("useCustomLayout"))))),l&&(0,e.jsx)(i.SettingRow,{className:"mt-3"},(0,e.jsx)(n.Select,{value:B(null==a?void 0:a.layout)||"",onChange:e=>{c(e.target.value)},size:"sm",disabled:(null==s?void 0:s.printTemplateType)===f.OrganizationTemplate,"aria-label":o("printLayout")},null===(r=null==s?void 0:s.layoutChoiceList)||void 0===r?void 0:r.map(((t,o)=>(0,e.jsx)(n.Option,{key:`layout${o}`,value:null==t?void 0:t.layoutTemplate,title:null==t?void 0:t.layoutTemplate},null==t?void 0:t.layoutTemplate))))),(null==a?void 0:a.layoutTypes)===x.CustomLayout&&y&&(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(Lt,{portalUrl:h,activeItem:m,itemtype:"Layout",size:"sm",placeholder:o("selectLayoutItemPlaceholder"),onChange:w})))})())};var Ft=v(13089);const qt=e.css`
  & .loading-con {
    width: ${e.polished.rem(16)};
    height: ${e.polished.rem(16)};
  }
`,Bt=t=>{const{text:o,className:i}=t;return(0,e.jsx)("div",{css:qt,className:(0,e.classNames)(i,"d-flex align-items-center")},(0,e.jsx)("div",{className:"loading-con position-relative mr-1"},(0,e.jsx)(n.Loading,{width:16,height:16,type:n.LoadingType.Donut})),(0,e.jsx)("div",null,o))};var Ht=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}s((n=n.apply(e,t||[])).next())}))};const{useState:Wt,useEffect:Vt}=e.React,Kt=e.css`
  .report-temp-tip-button {
    padding: 0;
  }
  .radio-con {
    cursor: pointer;
  }
  .warning-alert-con {
    position: absolute;
    top: ${e.polished.rem(50)};
    right: ${e.polished.rem(8)};
    left: ${e.polished.rem(8)};
  }
`,Zt=t=>{const o=e.hooks.useTranslation(S),{id:r,template:l,config:a,templateIndex:s,onSettingChange:u}=t,[c,d]=Wt(null),[m,v]=Wt(null),[h,g]=Wt(!1);Vt((()=>{d(null==l?void 0:l.customReportItem)}),[s]),Vt((()=>{C(a.useUtility).then((e=>{v(e)}))}),[a.useUtility]);const y=(e=!1)=>{g(e)},b=e=>Ht(void 0,void 0,void 0,(function*(){const t={id:e.id,title:e.title};d(t),y(!0),((e,t,o)=>I(void 0,void 0,void 0,(function*(){const n=null==t?void 0:t.id;return n?O(n,null==e?void 0:e.useUtility,p.ReportTemplate).then((n=>{var i,r;const l=null==n?void 0:n[0],a=((null==e?void 0:e.printTemplateType)===f.Customize?null===(i=e.printCustomTemplate)||void 0===i?void 0:i.asMutable({deep:!0}):null===(r=e.printOrgTemplate)||void 0===r?void 0:r.asMutable({deep:!0}))[o];a.customReportItem=t,a.reportOptions=(null==l?void 0:l.reportOptions)||{};const s=J(e,o,a);return Promise.resolve(s)}),(e=>Promise.reject(new Error(e)))).catch((e=>Promise.reject(new Error(e)))):Promise.reject(new Error("No custom report item id"))})))(a,t,s).then((e=>{y(!1),u({id:r,config:e})}),(e=>{d((null==l?void 0:l.customLayoutItem)||null),y(!1)}))})),x=()=>{let e=l.set("reportTypes",T.CustomReport);d((null==a?void 0:a.defaultCustomReportItem)||null),e=e.set("customReportItem",null).set("reportOptions",null);const t=J(a,s,null==e?void 0:e.asMutable({deep:!0}));u({id:r,config:t})},R=()=>{var e;let t=l.set("reportTypes",T.ServiceReport),o=null;const n=(null==a?void 0:a.defaultReportTemplate)||"";(null==a?void 0:a.defaultReportTemplate)&&(null===(e=null==a?void 0:a.reportTemplateChoiceList)||void 0===e||e.forEach((e=>{e.reportTemplate===(null==a?void 0:a.defaultReportTemplate)&&(o=e.reportOptions)}))),t=t.set("report",n).set("reportOptions",o);const i=J(a,s,null==t?void 0:t.asMutable({deep:!0}));u({id:r,config:i})},k=e.hooks.useEventCallback((()=>{if(!(null==l?void 0:l.reportOptions))return!0;return Q(null==l?void 0:l.reportOptions)===w.RPTX})),j=e.hooks.useEventCallback((()=>{const e=(null==a?void 0:a.supportReport)&&(null==a?void 0:a.defaultReportTemplate)&&!(null==a?void 0:a.supportCustomReport),t=(null==l?void 0:l.reportTypes)===T.CustomReport&&!(null==l?void 0:l.customReportItem);return(e&&t||!k())&&!h}));return(0,e.jsx)("div",{className:"custom-layout-setting-con mt-2",css:Kt},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:(0,e.jsx)("div",{className:"d-flex align-items-center"},(0,e.jsx)("div",{className:"mr-1"},o("report")),(0,e.jsx)(n.Tooltip,{title:o("reportRemind"),showArrow:!0,placement:"left"},(0,e.jsx)(n.Button,{className:"report-temp-tip-button",type:"tertiary","aria-label":o("reportRemind")},(0,e.jsx)(Ue,{size:"s"}))))}),(()=>{var t;const d=a.supportCustomReport,p=!(null==l?void 0:l.reportTypes)||(null==l?void 0:l.reportTypes)===T.ServiceReport||!d,v=me(null===(t=null==a?void 0:a.reportTemplateChoiceList)||void 0===t?void 0:t.asMutable({deep:!0}),!(null==a?void 0:a.defaultReportTemplate)),g=d&&!(null==a?void 0:a.defaultCustomReportItem);return(0,e.jsx)("div",{role:"group","aria-label":o("report")},(0,e.jsx)("div",{role:"radiogroup"},g&&(0,e.jsx)(i.SettingRow,null,(0,e.jsx)("div",{className:"d-flex radio-con align-items-center","aria-label":o("useServiceReport"),title:o("useServiceReport"),onClick:R},(0,e.jsx)(n.Radio,{className:"mr-1",checked:p,title:o("useServiceReport")}),(0,e.jsx)("span",null,o("useServiceReport")))),g&&(0,e.jsx)(i.SettingRow,null,(0,e.jsx)("div",{className:"d-flex radio-con align-items-center","aria-label":o("useCustomReport"),title:o("useCustomReport"),onClick:x},(0,e.jsx)(n.Radio,{checked:(null==l?void 0:l.reportTypes)===T.CustomReport,className:"mr-1",title:o("useCustomReport")}),(0,e.jsx)("span",null,o("useCustomReport"))))),p&&(0,e.jsx)(i.SettingRow,{className:"mt-3"},(0,e.jsx)(n.Select,{value:(null==l?void 0:l.report)||"None",size:"sm",disabled:(null==a?void 0:a.printTemplateType)===f.OrganizationTemplate,"aria-label":o("report")},null==v?void 0:v.map(((t,o)=>(0,e.jsx)(n.Option,{key:o,value:null==t?void 0:t.reportTemplate,title:null==t?void 0:t.reportTemplate,onClick:()=>{((e,t)=>{var o,n;let i=!1;a.supportCustomReport&&(null==l?void 0:l.reportTypes)===T.CustomReport?i=!a.defaultCustomReportItem:a.supportReport&&(null==l?void 0:l.reportTypes)===T.ServiceReport&&(i=!a.defaultReportTemplate);const c=me(null===(o=null==a?void 0:a.reportTemplateChoiceList)||void 0===o?void 0:o.asMutable({deep:!0}),i);let d=null;"None"===c[t].reportTemplate&&i&&0===Number(t)?e="":d=(null===(n=c[t])||void 0===n?void 0:n.reportOptions)||null;const p=l.set("reportOptions",d).set("report",e),m=J(a,s,null==p?void 0:p.asMutable({deep:!0}));u({id:r,config:m})})(null==t?void 0:t.reportTemplate,o)}},null==t?void 0:t.reportTemplate))))),(null==l?void 0:l.reportTypes)===T.CustomReport&&a.supportCustomReport&&(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(Lt,{portalUrl:m,activeItem:c,itemtype:"Pro Report",excludeType:"Pro Report Template",size:"sm",placeholder:o("selectReportItemPlaceholder"),onChange:b})),h&&(0,e.jsx)(Bt,{className:"mt-2","aria-label":o("checkingReport"),text:o("checkingReport")}),j()&&(0,e.jsx)("div",{className:"warning-alert-con"},(0,e.jsx)(n.Alert,{type:"warning",text:o("notSupportReport"),withIcon:!0})))})(),(()=>{const e=k();return!h&&e})()&&(()=>{var t,o;const n=(null===(t=null==l?void 0:l.reportOptions)||void 0===t?void 0:t.reportSectionOverrides)||(0,e.Immutable)({});if(0!==(null===(o=Object.keys(n))||void 0===o?void 0:o.length))return(0,e.jsx)("div",{className:"mt-3"},Object.keys(n).map(((t,o)=>{const u=n[t];return(0,e.jsx)(i.SettingRow,{label:t,flow:"wrap",key:o},(0,e.jsx)(Ft.DataSourceSelector,{types:(0,e.Immutable)([e.AllDataSourceTypes.FeatureLayer,e.AllDataSourceTypes.ImageryLayer,e.AllDataSourceTypes.OrientedImageryLayer]),useDataSources:null==u?void 0:u.exbDatasource,mustUseDataSource:!0,onChange:e=>{((e,t)=>{var o;const n=le(null===(o=e[0])||void 0===o?void 0:o.dataSourceId),i=l.setIn(["reportOptions","reportSectionOverrides",t,"exbDatasource"],e).setIn(["reportOptions","reportSectionOverrides",t,"isDsOutputDs"],n),u=J(a,s,null==i?void 0:i.asMutable({deep:!0}));fe(r,u)})(e,t)},widgetId:r,closeDataSourceListOnChange:!0,"aria-describedby":"list-empty-tip",hideDataView:!0,hideDs:he}))})))})())};var Qt=v(28996),Jt=v.n(Qt),Yt=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};const Xt=t=>{const o=window.SVG,{className:n}=t,i=Yt(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:Jt()},i)):e.React.createElement("svg",Object.assign({className:r},i))};var eo;!function(e){e.MapSize="MAP SIZE",e.Author="AUTHOR",e.Copyright="COPYRIGHT",e.Legend="LEGEND",e.ScaleBarUnit="SCALE BAR UNIT",e.AttributionVisible="ATTRIBUTION VISIBLE",e.CustomTextElements="CUSTOM TEXT ELEMENTS",e.NorthArrow="NORTH ARROW"}(eo||(eo={}));const to=t=>{const{elementOverridesOption:o,needDsSelector:i}=t,r=e.hooks.useTranslation(S,n.defaultMessages,e.defaultMessages),l=o.name;if(i){const t=te(o);return(0,e.jsx)("div",{className:"d-flex w-100 align-item-center"},(0,e.jsx)("span",{className:"flex-grow-1"},l),!t&&(0,e.jsx)(n.Tooltip,{title:r("dynamicElementTemplateRemind")},(0,e.jsx)(n.Button,{tag:"div",tabIndex:0,icon:!0,variant:"text",className:"p-0 warning-icon-con","aria-label":r("dynamicElementTemplateRemind")},(0,e.jsx)(Xt,null))))}return l},{useEffect:oo,useState:no,useRef:io}=e.React,ro=v(12046),lo=e.css`
  .warning-icon-con {
    color: var(--sys-color-warning-main) !important;
  }
`,ao=t=>{var o,r,l,a,s,u,c,d;const p=e.hooks.useTranslation(S,n.defaultMessages,e.defaultMessages),{id:v,config:h,templateIndex:g,template:f,handelCustomSettingChange:y}=t,b=io(null),x=io(!1),[w,T]=no((null===(o=null==f?void 0:f.layoutOptions)||void 0===o?void 0:o.authorText)||""),[I,C]=no((null===(r=null==f?void 0:f.layoutOptions)||void 0===r?void 0:r.copyrightText)||""),[R,O]=no(null),[k,j]=no(null===(l=null==f?void 0:f.layoutOptions)||void 0===l?void 0:l.customTextElements),[E,N]=no(null),[A,P]=no(null),[M,L]=no(null),[D,U]=no(null);oo((()=>{var e,t,o,n,i;P(Z(null===(e=null==f?void 0:f.layoutOptions)||void 0===e?void 0:e.elementOverrides)),T((null===(t=null==f?void 0:f.layoutOptions)||void 0===t?void 0:t.authorText)||""),C((null===(o=null==f?void 0:f.layoutOptions)||void 0===o?void 0:o.copyrightText)||""),j(null===(n=null==f?void 0:f.layoutOptions)||void 0===n?void 0:n.customTextElements);const r=function(e){var t;if(!e)return null;const o={northArrow:[],scaleBar:[],legend:[],dynamicText:[],table:[],chart:[]};for(const n in e){const i=e[n];switch(i.type){case"CIMMarkerNorthArrow":o.northArrow.push(i);break;case"CIMGraphicElement":(null===(t=i.dynamicTextElements)||void 0===t?void 0:t.some((e=>"table"===e.type)))&&o.dynamicText.push(i);break;case"CIMTableFrame":o.table.push(i)}}return o}(null===(i=null==f?void 0:f.layoutOptions)||void 0===i?void 0:i.elementOverrides);L(r),b.current=f}),[f]),oo((()=>{$()}),[]),oo((()=>{z()&&$()}),[k]),oo((()=>{_(M)}),[M]);const _=t=>{const o=Y(t);if(x.current||!o)return;const n={};for(const e in t){const o=t[e];n[e]||(n[e]={}),o.forEach((t=>{n[e][t.name]=!1}))}U((0,e.Immutable)(n)),x.current=!0},z=()=>{if(!k)return!1;if((null==k?void 0:k.length)!==(null==E?void 0:E.length))return!0;{let e=!1;return null==k||k.forEach(((t,o)=>{for(const n in t)Object.prototype.hasOwnProperty.call(E[o],n)||(e=!0)})),e}},$=()=>{const t=null==k?void 0:k.map(((e,t)=>{const o={};for(const t in e)o[t]=!1;return o}));N((0,e.Immutable)(t||[]))},G=e=>{q(),V(),O(e)},F=()=>{q(),O(null),V()},q=()=>{const e=null==E?void 0:E.map((e=>{const t={};for(const o in e)t[o]=!1;return t}));N(e)},B=e=>{y([e],!(null==f?void 0:f[e]))},H=()=>{var e;return!!(null===(e=null==f?void 0:f.layoutOptions)||void 0===e?void 0:e.legendLayers)},W=(e,t)=>{const o=null==E?void 0:E.map(((o,n)=>{const i={};for(const r in o)i[r]=t===n&&r===e&&!E[t][e];return i}));O(null),V(),N(o)},V=()=>{let e=D;for(const t in D){const o=D[t];for(const n in o)e=e.setIn([t,n],!1)}U(e)},K=(t,o,r)=>{var l,a;const s=Q(t.type),u=t.name,c=(null===(l=null==D?void 0:D[o])||void 0===l?void 0:l[u])||!1;return(0,e.jsx)(n.CollapsablePanel,{label:(0,e.jsx)(to,{elementOverridesOption:t,needDsSelector:s}),key:`${u}_${r}`,isOpen:c,onRequestOpen:()=>{((e,t)=>{var o;let n=D;for(const i in D){const r=D[i];for(const l in r){const r=l===t&&i===e&&!(null===(o=null==D?void 0:D[e])||void 0===o?void 0:o[t]);n=n.setIn([i,l],r)}}O(null),q(),U(n)})(o,u)},onRequestClose:F,role:"group","aria-label":u,rightIcon:ro,type:"primary",className:(null===(a=null==D?void 0:D[o])||void 0===a?void 0:a[u])&&"active-collapse"},(0,e.jsx)(i.SettingRow,{flow:"wrap",className:"align-item-center mt-2"},(0,e.jsx)("div",{title:u,"aria-label":p("includeElementOverrides",{name:u}),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{((e,t,o,n=!1)=>{if(n&&!o){const n=f.setIn(["layoutOptions","elementOverrides",e,"exbDataSource"],[]).setIn(["layoutOptions","elementOverrides",e,"isDsOutputDs"],!1).setIn(["layoutOptions","elementOverrides",e,t],o),i=J(h,g,null==n?void 0:n.asMutable({deep:!0}));fe(v,i)}else y(["layoutOptions","elementOverrides",e,t],o)})(u,"visible",!t.visible,s)}},(0,e.jsx)(n.Checkbox,{title:u,className:"lock-item-ratio","aria-label":p("includeElementOverrides",{name:u}),checked:t.visible||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},p("includeElementOverrides",{name:u})))),s&&t.visible&&(0,e.jsx)(i.SettingRow,{flow:"wrap",className:"align-item-center mt-2"},(0,e.jsx)(Ft.DataSourceSelector,{types:(0,e.Immutable)([e.AllDataSourceTypes.FeatureLayer,e.AllDataSourceTypes.ImageryLayer,e.AllDataSourceTypes.OrientedImageryLayer]),useDataSources:null==t?void 0:t.exbDataSource,mustUseDataSource:!0,onChange:e=>{((e,t)=>{var o;const n=le(null===(o=e[0])||void 0===o?void 0:o.dataSourceId),i=f.setIn(["layoutOptions","elementOverrides",t,"exbDataSource"],e).setIn(["layoutOptions","elementOverrides",t,"isDsOutputDs"],n),r=J(h,g,null==i?void 0:i.asMutable({deep:!0}));fe(v,r)})(e,u)},widgetId:v,closeDataSourceListOnChange:!0,"aria-describedby":"list-empty-tip",hideDataView:!0,hideDs:he})))},Q=e=>"CIMChartFrame"===e||"CIMGraphicElement"===e||"CIMTableFrame"===e,Y=e=>{let t=0;for(const o in e){t+=(e[o]||[]).length}return t>0},X=(e,t)=>{var o,n;const i=null===(o=null==f?void 0:f.customTextElementEnableList)||void 0===o?void 0:o[t],r=i.set(e,!(null==i?void 0:i[e])),l=null===(n=null==f?void 0:f.customTextElementEnableList)||void 0===n?void 0:n.asMutable({deep:!0});l.splice(t,1,r),y(["customTextElementEnableList"],l)},ee=(e,t,o)=>{const n=k[e].set(t,o),i=null==k?void 0:k.asMutable({deep:!0});i.splice(e,1,n),y(["layoutOptions","customTextElements"],i)},te=(t,o,n)=>{var i;const r=null===(i=null==n?void 0:n.target)||void 0===i?void 0:i.value,l=k[t].set(o,r),a=null==k?void 0:k.asMutable({deep:!0});a.splice(t,1,l),j((0,e.Immutable)(a))};return(0,e.jsx)(i.SettingSection,{title:p("LayoutOptions"),role:"group","aria-label":p("LayoutOptions"),css:lo},(0,e.jsx)("div",{role:"group","aria-label":p("setDefaults")},(0,e.jsx)(i.SettingRow,{label:p("setDefaults"),flow:"wrap"}),(null==f?void 0:f.hasAuthorText)&&(0,e.jsx)(n.CollapsablePanel,{label:p("printTemplateAuthor"),isOpen:R===eo.Author,onRequestOpen:()=>{G(eo.Author)},onRequestClose:F,role:"group","aria-label":p("printTemplateAuthor"),type:"primary",rightIcon:ro,className:"mb-2"},(0,e.jsx)(i.SettingRow,{flow:"wrap",className:"mt-2"},(0,e.jsx)(n.TextInput,{size:"sm",className:"w-100",value:w,onAcceptValue:e=>{y(["layoutOptions","authorText"],e)},onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;T(o)},"aria-label":p("printTemplateAuthor")}))),(null==f?void 0:f.hasCopyrightText)&&(0,e.jsx)(n.CollapsablePanel,{label:p("copyright"),isOpen:R===eo.Copyright,onRequestOpen:()=>{G(eo.Copyright)},onRequestClose:F,role:"group","aria-label":p("copyright"),rightIcon:ro,type:"primary",className:"mb-2"},(0,e.jsx)(i.SettingRow,{flow:"wrap",className:"mt-2"},(0,e.jsx)(n.TextInput,{size:"sm",className:"w-100",value:I,onAcceptValue:e=>{y(["layoutOptions","copyrightText"],e)},onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;C(o)},"aria-label":p("copyright")}))),(null==f?void 0:f.hasLegend)&&(0,e.jsx)(n.CollapsablePanel,{label:p("legend"),isOpen:R===eo.Legend,onRequestOpen:()=>{G(eo.Legend)},onRequestClose:F,role:"group",type:"primary","aria-label":p("legend"),rightIcon:ro,className:"mb-2"},(0,e.jsx)(i.SettingRow,{flow:"wrap",className:"mt-2"},(0,e.jsx)("div",{title:p("includeLegend"),"aria-label":p("includeLegend"),className:"d-flex w-100 align-items-center check-box-con",onClick:e=>{const t=H();y(["layoutOptions","legendLayers"],t?null:[])}},(0,e.jsx)(n.Checkbox,{title:p("includeLegend"),className:"lock-item-ratio",checked:H()}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},p("includeLegend"))))),(0,e.jsx)(n.CollapsablePanel,{label:p("scaleBarUnit"),isOpen:R===eo.ScaleBarUnit,onRequestOpen:()=>{G(eo.ScaleBarUnit)},onRequestClose:F,role:"group","aria-label":p("scaleBarUnit"),rightIcon:ro,type:"primary",className:R===eo.ScaleBarUnit&&"active-collapse"},(0,e.jsx)(i.SettingRow,{flow:"wrap",className:"mt-2"},(0,e.jsx)(n.Select,{value:(null===(a=null==f?void 0:f.layoutOptions)||void 0===a?void 0:a.scalebarUnit)||"",onChange:e=>{const t=e.target.value;y(["layoutOptions","scalebarUnit"],t)},size:"sm","aria-label":p("scaleBarUnit")},function(e){return[{value:"Miles",label:e("unitsLabelMiles")},{value:"Kilometers",label:e("unitsLabelKilometers")},{value:"Meters",label:e("unitsLabelMeters")},{value:"Feet",label:e("unitsLabelFeet")}]}(p).map(((t,o)=>(0,e.jsx)(n.Option,{key:`unit${o}`,value:t.value,title:t.label},t.label)))))),(null===(u=null===(s=null==f?void 0:f.layoutOptions)||void 0===s?void 0:s.customTextElements)||void 0===u?void 0:u.length)>0&&(t=>{const o=[];return null==k||k.forEach(((r,l)=>{var a;for(const s in r){const u=(0,e.jsx)(n.CollapsablePanel,{label:s,key:`${s}_${l}`,isOpen:(null===(a=null==t?void 0:t[l])||void 0===a?void 0:a[s])||!1,onRequestOpen:()=>{W(s,l)},onRequestClose:F,role:"group","aria-label":s,rightIcon:ro,type:"primary",className:(null==t?void 0:t[s])&&"active-collapse"},(0,e.jsx)(i.SettingRow,{flow:"wrap",className:"align-item-center mt-2"},(0,e.jsx)(n.TextArea,{className:"flex-grow-1",value:r[s]||"","aria-label":s,onAcceptValue:e=>{ee(l,s,e)},onChange:e=>{te(l,s,e)}})));o.push(u)}})),o})(E),Y(M)&&(()=>{const e=[];for(const t in M){M[t].forEach(((o,n)=>{const i=K(o,t,n);e.push(i)}))}return e})()),h.modeType===m.Classic&&(0,e.jsx)(i.SettingRow,{className:"mt-2",flow:"wrap",role:"group","aria-label":p("selectEditableSettings"),label:p("selectEditableSettings")},(0,e.jsx)("div",{className:"w-100"},(null==f?void 0:f.hasAuthorText)&&(0,e.jsx)("div",{title:p("printTemplateAuthor"),"aria-label":p("printTemplateAuthor"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{B("enableAuthor")}},(0,e.jsx)(n.Checkbox,{title:p("printTemplateAuthor"),className:"lock-item-ratio",checked:(null==f?void 0:f.enableAuthor)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},p("printTemplateAuthor"))),(null==f?void 0:f.hasCopyrightText)&&(0,e.jsx)("div",{title:p("copyright"),"aria-label":p("copyright"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{B("enableCopyright")}},(0,e.jsx)(n.Checkbox,{title:p("copyright"),className:"lock-item-ratio",checked:(null==f?void 0:f.enableCopyright)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},p("copyright"))),(null==f?void 0:f.hasLegend)&&(0,e.jsx)("div",{title:p("legend"),"aria-label":p("legend"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{B("enableLegend")}},(0,e.jsx)(n.Checkbox,{title:p("legend"),className:"lock-item-ratio",checked:(null==f?void 0:f.enableLegend)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},p("legend"))),(0,e.jsx)("div",{title:p("scaleBarUnit"),"aria-label":p("scaleBarUnit"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{B("enableScalebarUnit")}},(0,e.jsx)(n.Checkbox,{title:p("scaleBarUnit"),className:"lock-item-ratio",checked:(null==f?void 0:f.enableScalebarUnit)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},p("scaleBarUnit"))),(null===(d=null===(c=null==f?void 0:f.layoutOptions)||void 0===c?void 0:c.customTextElements)||void 0===d?void 0:d.length)>0&&(()=>{const t=[];return null==k||k.forEach(((o,i)=>{var r,l;for(const a in o){const o=(0,e.jsx)("div",{key:`${a}_${i}`,title:a,"aria-label":a,className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{X(a,i)}},(0,e.jsx)(n.Checkbox,{title:a,className:"lock-item-ratio",checked:(null===(l=null===(r=null==f?void 0:f.customTextElementEnableList)||void 0===r?void 0:r[i])||void 0===l?void 0:l[a])||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},a));t.push(o)}})),t})(),A&&(0,e.jsx)("div",{title:p("northArrow"),"aria-label":p("northArrow"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{B("enableNorthArrow")}},(0,e.jsx)(n.Checkbox,{title:p("northArrow"),className:"lock-item-ratio",checked:(null==f?void 0:f.enableNorthArrow)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},p("northArrow"))))))},{useEffect:so,useState:uo}=e.React,co=v(12046),po=t=>{var o,r;const l=e.hooks.useTranslation(S,n.defaultMessages,e.defaultMessages),{config:a,template:s,handelCustomSettingChange:u}=t,[c,d]=uo(null===(o=null==s?void 0:s.exportOptions)||void 0===o?void 0:o.width),[p,v]=uo(null===(r=null==s?void 0:s.exportOptions)||void 0===r?void 0:r.height),[h,g]=uo(null);so((()=>{var e,t;d(null===(e=null==s?void 0:s.exportOptions)||void 0===e?void 0:e.width),v(null===(t=null==s?void 0:s.exportOptions)||void 0===t?void 0:t.height)}),[s]);const f=e=>{g(e)},y=()=>{g(null)},b=e=>{u([e],!(null==s?void 0:s[e]))};return(0,e.jsx)(i.SettingSection,{title:l("MapOnlyOptions"),role:"group","aria-label":l("MapOnlyOptions")},(0,e.jsx)("div",{role:"group","aria-label":l("setDefaults")},(0,e.jsx)(i.SettingRow,{label:l("setDefaults"),flow:"wrap"}),(0,e.jsx)(n.CollapsablePanel,{label:l("mapSize"),isOpen:h===eo.MapSize,onRequestOpen:()=>{f(eo.MapSize)},onRequestClose:y,role:"group","aria-label":l("mapSize"),rightIcon:co,type:"primary",className:h===eo.MapSize&&"active-collapse"},(0,e.jsx)(i.SettingRow,{label:l("width"),className:"mt-2"},(0,e.jsx)(n.NumericInput,{className:"map-size-input",size:"sm",placeholder:l("width"),value:c||800,onAcceptValue:e=>{var t;if(!e||Number(e)<1)return d(null===(t=null==s?void 0:s.exportOptions)||void 0===t?void 0:t.width),!1;u(["exportOptions","width"],Number(e))},onChange:e=>{if(e<1)return!1;d(e)},showHandlers:!1,"aria-label":l("width")})),(0,e.jsx)(i.SettingRow,{label:l("height")},(0,e.jsx)(n.NumericInput,{className:"map-size-input",size:"sm",placeholder:l("height"),value:p||1100,onAcceptValue:e=>{var t;if(!e||Number(e)<1)return v(null===(t=null==s?void 0:s.exportOptions)||void 0===t?void 0:t.height),!1;u(["exportOptions","height"],Number(e))},onChange:e=>{v(e)},showHandlers:!1,"aria-label":l("height")}))),(0,e.jsx)(n.CollapsablePanel,{label:l("mapAttribution"),isOpen:h===eo.AttributionVisible,onRequestOpen:()=>{f(eo.AttributionVisible)},onRequestClose:y,role:"group","aria-label":l("mapAttribution"),rightIcon:co,type:"primary",className:h===eo.AttributionVisible&&"active-collapse"},(0,e.jsx)(i.SettingRow,{flow:"wrap",className:"mt-2"},(0,e.jsx)("div",{title:l("includeAttribution"),"aria-label":l("includeAttribution"),className:"d-flex w-100 align-items-center check-box-con",onClick:e=>{const t=!(null==s?void 0:s.attributionVisible);u(["attributionVisible"],t)}},(0,e.jsx)(n.Checkbox,{title:l("includeAttribution"),className:"lock-item-ratio","data-field":"mapSize",checked:!!(null==s?void 0:s.attributionVisible)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},l("includeAttribution")))))),a.modeType===m.Classic&&(0,e.jsx)(i.SettingRow,{className:"mt-2",flow:"wrap",role:"group","aria-label":l("selectEditableSettings"),label:l("selectEditableSettings")},(0,e.jsx)("div",{className:"w-100"},(0,e.jsx)("div",{className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{b("enableMapSize")},title:l("mapSize"),"aria-label":l("mapSize")},(0,e.jsx)(n.Checkbox,{title:l("mapSize"),className:"lock-item-ratio","data-field":"mapSize",checked:(null==s?void 0:s.enableMapSize)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},l("mapSize")))),(0,e.jsx)("div",{className:"w-100 mt-1"},(0,e.jsx)("div",{title:l("mapAttribution"),"aria-label":l("mapAttribution"),className:"d-flex w-100 align-items-center check-box-con",onClick:()=>{b("enableMapAttribution")}},(0,e.jsx)(n.Checkbox,{title:l("mapAttribution"),className:"lock-item-ratio","data-field":"mapSize",checked:(null==s?void 0:s.enableMapAttribution)||!1}),(0,e.jsx)("div",{className:"lock-item-ratio-label text-left ml-2"},l("mapAttribution"))))))},{useEffect:mo,useState:vo,useRef:ho}=e.React,go=t=>{const o=e.hooks.useTranslation(S,n.defaultMessages,e.defaultMessages),{id:r,isOpen:l,trigger:a,popperFocusNode:s,config:u,activeTemplateId:c,jimuMapView:d,toggle:p,handelTemplateListChange:m,onSettingChange:v}=t,h=ho(null),g=ho(null),y=ho(null);mo((()=>{L()}),[u,c]);const[b,w]=vo(null),[T,I]=vo(null),[C,R]=vo(null),[O,k]=vo((null==b?void 0:b.label)||""),[j,E]=vo(!1),[N,A]=vo(!1);mo((()=>(B(h.current),g.current=null,"number"==typeof T&&(h.current=T),()=>{B(h.current)})),[T]),mo((()=>{k((null==b?void 0:b.label)||""),P(b)}),[b]);const P=e=>{const{defaultCustomReportItem:t,defaultReportTemplate:o,supportCustomReport:n,supportReport:i}=u;if(!e)return;if(ee({defaultCustomReportItem:t,defaultReportTemplate:o,supportCustomReport:n,supportReport:i,reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes})){const t={reportOptions:null==e?void 0:e.reportOptions,reportTypes:null==e?void 0:e.reportTypes,customReportItem:null==e?void 0:e.customReportItem,report:null==e?void 0:e.report,templateIndex:T,templateId:e.templateId};g.current=t}},M=(e=!1)=>{A(e)},L=()=>{const e=q(null==u?void 0:u.printServiceType,null==u?void 0:u.printTemplateType)?null==u?void 0:u.printCustomTemplate:null==u?void 0:u.printOrgTemplate,t=F(null==e?void 0:e.asMutable({deep:!0}),c);I(t),R(e),w((null==e?void 0:e[t])||null),y.current=e},D=(e,t)=>{const o=b.setIn(e,t),n=null==C?void 0:C.asMutable({deep:!0});n[T]=null==o?void 0:o.asMutable({deep:!0}),m(n)},U=e=>{if(!e)return k(null==b?void 0:b.label),!1;D(["label"],e)},_=e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;k(o)},z=e=>{const t=null==C?void 0:C.asMutable({deep:!0});t[T]=null==e?void 0:e.asMutable({deep:!0}),m(t)},$=()=>{const e=!(null==b?void 0:b.overrideCommonSetting);if(e){let t=b.setIn(["overrideCommonSetting"],e);t=G(t,null==u?void 0:u.commonSetting);const o=null==C?void 0:C.asMutable({deep:!0});o[T]=null==t?void 0:t.asMutable({deep:!0}),m(o)}else D(["overrideCommonSetting"],e)},B=e=>{var t;const o="number"==typeof e?e:T,n=null===(t=y.current)||void 0===t?void 0:t.asMutable({deep:!0});let i=null==n?void 0:n[o];if(!i)return;let r=!1;const l=W(i);l.isTemplateChange&&(r=!0,i=l.newTemplateItem);const a=V(i);a.isTemplateChange&&(r=!0,i=a.newTemplateItem),r&&(n[o]=i,m(n))},W=e=>{var t,o,n;if(!e)return{isTemplateChange:!1};let i=!1;return(null==e?void 0:e.layoutTypes)===x.CustomLayout&&!(null===(t=e.customLayoutItem)||void 0===t?void 0:t.id)&&(null===(o=null==u?void 0:u.layoutChoiceList)||void 0===o?void 0:o.length)>0&&(e=pe(e,e.layout,null===(n=null==u?void 0:u.layoutChoiceList)||void 0===n?void 0:n.asMutable({deep:!0})),i=!0),{isTemplateChange:i,newTemplateItem:e}},V=e.hooks.useEventCallback((t=>{var o;if(!t)return{isTemplateChange:!1};const{defaultCustomReportItem:n,defaultReportTemplate:i,supportCustomReport:r,supportReport:l}=u;let a=!1,s=(0,e.Immutable)(t);if(!ee({defaultCustomReportItem:n,defaultReportTemplate:i,supportCustomReport:r,supportReport:l,reportOptions:null==t?void 0:t.reportOptions,reportTypes:null==t?void 0:t.reportTypes})&&g.current&&(null===(o=g.current)||void 0===o?void 0:o.templateId)===t.templateId){const{reportOptions:e,reportTypes:t,customReportItem:o,report:n}=g.current;s=s.set("reportOptions",e).set("reportTypes",t).set("customReportItem",o).set("report",n).set("report",n),a=!0}return{isTemplateChange:a,newTemplateItem:null==s?void 0:s.asMutable({deep:!0})}})),K=(e,t)=>{var o;const n="number"==typeof t?t:T,i=pe(null==b?void 0:b.asMutable({deep:!0}),e,null===(o=null==u?void 0:u.layoutChoiceList)||void 0===o?void 0:o.asMutable({deep:!0})),r=null==C?void 0:C.asMutable({deep:!0});r[n]=i,m(r)},Z=e=>{var t,o,n;const i=null==e?void 0:e.format,r=null===(t=null==e?void 0:e.selectedFormatList)||void 0===t?void 0:t.asMutable({deep:!0});return!i||(null===(o=u.formatList)||void 0===o?void 0:o.includes(i))?null!=r?r:[]:null!==(n=null==r?void 0:r.filter((e=>e!==i)))&&void 0!==n?n:[]},Q=(e,t)=>{var o;if(0===(null==t?void 0:t.length))return!1;let n=b.set("selectedFormatList",t);if(!(null==t?void 0:t.includes(n.format))){const e=null===(o=u.formatList)||void 0===o?void 0:o.filter((e=>e.toLocaleLowerCase().includes("pdf")&&t.includes(e)));n=n.set("format",e[0]||t[0])}const i=null==C?void 0:C.asMutable({deep:!0});i[T]=null==n?void 0:n.asMutable({deep:!0}),m(i)},J=()=>{E(!j)},Y=e.css`
    .remind-con {
      padding-left: ${e.polished.rem(25)};
      color: var(--ref-palette-neutral-1100);
      margin-bottom: ${e.polished.rem(60)};
      margin-top: ${e.polished.rem(19)};
      font-size: ${e.polished.rem(13)};
    }
    .modal-body {
      padding: ${e.polished.rem(30)} ${e.polished.rem(30)} 0 ${e.polished.rem(30)};
    }
    .modal-footer {
      padding: 0 ${e.polished.rem(30)} ${e.polished.rem(30)} ${e.polished.rem(30)};
    }
    .remind-title {
      font-size: ${e.polished.rem(16)};
      font-weight: 500;
    }
  `,X=e=>{e.target.checked?$():J()},te=e.css`
    & {
      overflow: auto;
    }
    .text-wrap {
      overflow: hidden;
      white-space: pre-wrap;
    }
    .map-size-input {
      width: ${e.polished.rem(80)};
    }
    .setting-collapse {
      & {
        margin-bottom: ${e.polished.rem(8)};
      }
      .collapse-header {
        line-height: 2.2;
      }
    }
    .check-box-con {
      color: var(--ref-palette-neutral-900);
      font-size: ${e.polished.rem(14)};
      line-height: ${e.polished.rem(22)};
      margin: ${e.polished.rem(4)} 0 ${e.polished.rem(8)} 0;
    }
    .layout-loading-con {
      left: 0;
      height: ${e.polished.rem(100)};
    }
  `,oe=e.hooks.useEventCallback(((e,t)=>{var o;const n=!(null==t?void 0:t.layoutTypes)||(null==t?void 0:t.layoutTypes)===x.ServiceLayout;return!e&&!(!n&&!(null===(o=t.customLayoutItem)||void 0===o?void 0:o.id))}));return(0,e.jsx)(i.SidePopper,{isOpen:l,position:"right",toggle:p,trigger:a,title:o("templateConfiguration"),backToFocusNode:s},(0,e.jsx)("div",{className:"w-100 h-100",css:te},(0,e.jsx)(i.SettingSection,null,(0,e.jsx)(i.SettingRow,{flow:"wrap",label:o("templateName")},(0,e.jsx)(n.TextInput,{size:"sm",className:"w-100",value:O,onAcceptValue:U,onChange:_,"aria-label":o("templateName"),disabled:(null==u?void 0:u.printTemplateType)===f.OrganizationTemplate})),(0,e.jsx)(i.SettingRow,{flow:"wrap",label:o("fileFormat"),role:"group","aria-label":o("fileFormat")},(0,e.jsx)(n.MultiSelect,{"aria-label":o("fileFormat"),onChange:Q,values:(0,e.Immutable)(Z(b)),size:"sm"},null==u?void 0:u.formatList.map((t=>(0,e.jsx)(n.MultiSelectItem,{key:t,value:t,label:t}))))),(0,e.jsx)(Gt,{id:r,config:u,template:b,templateIndex:T,handleLayoutChange:K,onSettingChange:v,toggleLoading:M}),((null==u?void 0:u.supportCustomReport)||(null==u?void 0:u.supportReport))&&(0,e.jsx)(Zt,{id:r,config:u,template:b,templateIndex:T,onSettingChange:v}),N&&(0,e.jsx)("div",{className:"layout-loading-con position-absolute w-100"},(0,e.jsx)(n.Loading,null))),oe(N,b)&&(0,e.jsx)("div",null,H(null==b?void 0:b.layout)&&(0,e.jsx)(po,{id:r,config:u,template:b,handelCustomSettingChange:D}),!H(null==b?void 0:b.layout)&&(0,e.jsx)(ao,{id:r,config:u,template:b,templateIndex:T,handelCustomSettingChange:D}),(0,e.jsx)(i.SettingSection,null,(0,e.jsx)(i.SettingRow,{className:"mb-4",tag:"label","aria-label":o("overrideCommonSettings"),label:o("overrideCommonSettings")},(0,e.jsx)(n.Switch,{checked:(null==b?void 0:b.overrideCommonSetting)||!1,onChange:X})),(null==b?void 0:b.overrideCommonSetting)&&(0,e.jsx)(qe,{id:r,printTemplateProperties:b,handleTemplatePropertyChange:z,modeType:null==u?void 0:u.modeType,jimuMapView:d}),(0,e.jsx)(n.AlertPopup,{isOpen:j,toggle:J,hideHeader:!0,onClickOk:$,onClickClose:J,css:Y},(0,e.jsx)("div",{className:"align-middle pt-2 remind-title d-flex align-items-center","aria-label":o("overrideSettingsTitle")},(0,e.jsx)("div",{className:"mr-1"},(0,e.jsx)(Xt,{className:"align-middle",size:"l",color:"var(--sys-color-warning-main)"})),(0,e.jsx)("span",{className:"align-middle flex-grow-1"},o("overrideSettingsTitle"))),(0,e.jsx)("div",{className:"remind-con"},o("overrideSettingsRemind")))))))};var fo=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}s((n=n.apply(e,t||[])).next())}))};const{useState:yo,useEffect:bo,useRef:xo}=e.React,wo=[e.SupportedUtilityType.Printing],To=t=>{const o=xo(!1),r=e.hooks.useTranslation(S,n.defaultMessages),{config:l,id:a,onSettingChange:s,toggleLoading:u,toggleRemindPopper:c}=t,d=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appStateInBuilder.appConfig.widgets[a])||void 0===t?void 0:t.useUtilities})),[p,m]=yo(null==l?void 0:l.useUtility),v=e.css`
    &>div>div {
      padding-left: 0!important;
      padding-right: 0!important;
    }
    .utility-list {
      margin-bottom: 0 !important;
    }
  `;bo((()=>{m(null==l?void 0:l.useUtility)}),[l]),bo((()=>{l&&!d&&h()}),[d,l]);const h=()=>{const t=ve(r);(null==t?void 0:t.utilityId)&&(o.current=!1,f((0,e.Immutable)(t)))},g=()=>{let e=l;e=e.set("useUtility",null),m(null),u(!1),s({id:a,config:e,useUtilities:[]})},f=t=>fo(void 0,void 0,void 0,(function*(){u(!0),m(t),((e,t)=>I(void 0,void 0,void 0,(function*(){return W(e).then((o=>j(o,e,t)))})))(t,l).then((e=>{if(o.current)return!1;u(!1),s({id:a,config:e,useUtilities:t?[t]:[]})}),(o=>{!function(t,o,n){var i,r,l,a;const s=e.UtilityManager.getInstance().utilityHasSignInError(t);let u=404===(null===(i=null==n?void 0:n.details)||void 0===i?void 0:i.httpStatus);400===(null===(r=null==n?void 0:n.details)||void 0===r?void 0:r.httpStatus)&&(null===(a=null===(l=null==n?void 0:n.details)||void 0===l?void 0:l.message)||void 0===a?void 0:a.includes("Item does not exist"))&&(u=!0),s||u?(o&&o(!0),e.UtilityManager.getInstance().reportUtilityState(t,!1,s)):(o&&o(!1),e.UtilityManager.getInstance().reportUtilityState(t,!0))}(null==t?void 0:t.utilityId,null,o),g(),u(!1),c(!0)}))}));return(0,e.jsx)("div",{css:v},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:r("printService"),"aria-label":r("printService")},(0,e.jsx)(ue.UtilitySelector,{useUtilities:(t=>{var o;if(!t)return(0,e.Immutable)([]);const n=null===(o=(0,e.getAppStore)().getState().appStateInBuilder.appConfig)||void 0===o?void 0:o.utilities;if(null==n?void 0:n[t.utilityId])return(0,e.Immutable)([t]);(0,e.Immutable)([])})(p),onChange:e=>{const t=e[0];m(t),t?(o.current=!1,f(t)):(o.current=!0,g())},showRemove:!0,closePopupOnSelect:!0,types:wo})))};var So=function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}s((n=n.apply(e,t||[])).next())}))};const{useState:Io,useRef:Co}=e.React,Ro=t=>{const o=Co(null),r=Co(null),{config:l,id:a,jimuMapView:s,showLoading:u,className:c,onSettingChange:d,handlePropertyChange:p,toggleRemindPopper:m,toggleLoading:v}=t,h=e.hooks.useTranslation(S,n.defaultMessages),g=e.css`
    .radio-con {
      cursor: pointer;
    }
    .loading-con {
      height: ${e.polished.rem(100)};
    }
  `,[y,b]=Io(null),[x,w]=Io(null),[T,I]=Io(!0),C=(e,t)=>{var n,i;if(e===y)b(null);else{const r=null===(i=null===(n=o.current)||void 0===n?void 0:n.getElementsByClassName("jimu-tree-item__body"))||void 0===i?void 0:i[t];b(e),r&&w(r)}},R=e=>{const t=q(null==l?void 0:l.printServiceType,null==l?void 0:l.printTemplateType);p(t?"printCustomTemplate":"printOrgTemplate",e)},O=()=>{I(!T)};return(0,e.jsx)(i.SettingSection,{className:c,css:g,role:"group","aria-label":h("configurePrintTemplate")},(0,e.jsx)(n.CollapsablePanel,{label:h("configurePrintTemplate"),isOpen:T,onRequestOpen:O,onRequestClose:O,"aria-label":h("configurePrintTemplate"),className:"custom-setting-collapse"},(0,e.jsx)(To,{id:a,config:l,showLoading:u,onSettingChange:d,toggleLoading:v,toggleRemindPopper:m}),u&&(0,e.jsx)("div",{className:"loading-con position-relative"},(0,e.jsx)(n.Loading,{type:n.LoadingType.Secondary})),(null==l?void 0:l.useUtility)&&!u&&(0,e.jsx)("div",null,(null==l?void 0:l.printTemplateType)===f.Customize&&(0,e.jsx)(n.Button,{className:"w-100 mt-2",ref:r,type:"primary","aria-label":h("newTemplate"),onClick:()=>So(void 0,void 0,void 0,(function*(){var e,t,o;let n=(null===(t=null===(e=null==l?void 0:l.printCustomTemplate)||void 0===e?void 0:e[0])||void 0===t?void 0:t.asMutable({deep:!0}))||{};const i=(null===(o=null==l?void 0:l.printCustomTemplate)||void 0===o?void 0:o.asMutable({deep:!0}))||[],a=ce(i,null==l?void 0:l.printServiceType,f.Customize);n=yield k(l,n,a,h("untitledTemplate")),i.push(n),p("printCustomTemplate",i),w(r.current),b(a)}))},(0,e.jsx)(je,{className:"mr-1"}),h("newTemplate")),(0,e.jsx)("div",{ref:o},!u&&(0,e.jsx)(Ce,{id:a,handelActiveTemplateIdChange:C,handelTemplateListChange:R,showNewTemplateItem:!1,activeTemplateId:y,config:l})),(0,e.jsx)(go,{id:a,isOpen:y,config:l,activeTemplateId:y,toggle:()=>{C(null)},handelTemplateListChange:R,jimuMapView:s,trigger:o.current,popperFocusNode:x,onSettingChange:d}))))};var Oo=v(15562),ko=v(54337);const jo=t=>{const o=(0,kt.getTheme2)(),r=e.hooks.useTranslation(S,n.defaultMessages),{config:a,handlePropertyChange:s}=t,u=e.css`
    .outline-con {
      input {
        width: ${e.polished.rem(55)};
      }
    }
    .preview-style-setting-con {
      margin-top: ${e.polished.rem(16)};
    }
    .enable-preview-label {
      margin-right: ${e.polished.rem(10)};
    }
    .enable-preview-switch-button {
      margin-right: 2px;
    }
  `,c=()=>{s("enablePreview",!(null==a?void 0:a.enablePreview))},d=e=>{0===e.length&&(e="rgba(0,216,237,1)"),s("previewBackgroundColor",e)},p=(t,o)=>{const n=null==o?void 0:o.includes("px"),i=function(e){const t=null==e?void 0:e.split("px")[0];return!(!e||!t)&&Number(t)>=0}(o);if(n&&!i)return;const r=(null==a?void 0:a.previewOutLine)||(0,e.Immutable)(l);0===o.length&&(o=l[t]),s("previewOutLine",r.setIn([t],o))};return(0,e.jsx)(i.SettingSection,{className:"show-preview-area-con",css:u,role:"group",title:(0,e.jsx)("div",{className:"d-flex align-items-center label-con",onClick:c},(0,e.jsx)("div",{className:"flex-grow-1 enable-preview-label text-truncate w-100",title:r("showPrintArea"),"aria-label":r("showPrintArea")},r("showPrintArea")),(0,e.jsx)(n.Switch,{className:"enable-preview-switch-button","aria-label":r("showPrintArea"),checked:null==a?void 0:a.enablePreview,onChange:c,title:r("showPrintArea")})),"aria-label":r("showPrintArea")},(null==a?void 0:a.enablePreview)&&(0,e.jsx)("div",{className:"preview-style-setting-con"},(0,e.jsx)(i.SettingRow,{label:r("fill"),"aria-label":r("fill")},(0,e.jsx)(ko.ThemeColorPicker,{value:null==a?void 0:a.previewBackgroundColor,specificTheme:o,onChange:d,"aria-label":r("fill")})),(0,e.jsx)(i.SettingRow,{className:"outline-con",role:"group",flow:"no-wrap",label:r("columnOutline"),"aria-label":r("columnOutline")},(0,e.jsx)(Oo.SizeColorSetting,{color:(null===(m=null==a?void 0:a.previewOutLine)||void 0===m?void 0:m.color)||l.color,size:(null===(v=null==a?void 0:a.previewOutLine)||void 0===v?void 0:v.size)||l.size,onChange:p}))));var m,v};var Eo=v(31027),No=v.n(Eo),Ao=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o};const Po=t=>{const o=window.SVG,{className:n}=t,i=Ao(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return o?e.React.createElement(o,Object.assign({className:r,src:No()},i)):e.React.createElement("svg",Object.assign({className:r},i))},Mo=()=>{const t=e.hooks.useTranslation(S,n.defaultMessages),o=e.css`
    & {
      & {
        color: var(--ref-palette-neutral-800);
      }
      p {
        color: var(--ref-palette-neutral-1000);
        font-size: ${e.polished.rem(14)};
        margin: ${e.polished.rem(16)} auto 0;
        line-height: ${e.polished.rem(19)};
        width: ${e.polished.rem(228)};
      }
    }
  `;return(0,e.jsx)("div",{className:"w-100 mt-4 text-center utility-placeholder",css:o},(0,e.jsx)("div",{className:"text-center w-100"},(0,e.jsx)(Po,{size:48}),(0,e.jsx)("p",{className:"text-Secondary",id:"list-empty-tip","aria-label":t("utilityPlaceholder"),title:t("utilityPlaceholder")},t("utilityPlaceholder"))))},{useEffect:Lo,useRef:Do}=e.React,Uo={width:"360px",height:"460px"},_o={width:"40px",height:"40px"},zo={width:"295px",height:"107px"},$o=r=>{const{config:l,id:a,portalUrl:s,onSettingChange:u,useMapWidgetIds:c,controllerWidgetId:d}=r,p=e.hooks.useTranslation(S,n.defaultMessages),h=Do(null),g=e.ReactRedux.useSelector((e=>{var t,o;return null===(o=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.widgetsState[a])||void 0===o?void 0:o.layoutInfo})),f=e.ReactRedux.useSelector((e=>e.appStateInBuilder.appConfig)),[y,b]=e.React.useState(null),[x,w]=e.React.useState(!1),[T,I]=e.React.useState(!1),[C,R]=e.React.useState(!1),O=e.css`
    & .custom-setting-collapse>div.collapse-header {
      padding-left: 0 !important;
      padding-right: 0 !important;
    }
    .no-utility-setting {
      border-bottom: none;
    }
    .select-mode-con {
      &>div {
        flex: 1;
      }
      button {
        height: ${e.polished.rem(80)};
        background: var(--ref-palette-neutral-300);
        border: 2px solid transparent;
        &:not(:disabled):not(.disabled).active {
          border-color: var(--sys-color-primary-main);
          background: var(--ref-palette-neutral-300);
        }
      }
      img {
        width: 100%;
        height: 100%;
        margin: 0 auto;
      }
    }
    .remind-con {
      top: ${e.polished.rem(90)};
    }
    .text-wrap {
      overflow: hidden;
      white-space: pre-wrap;
    }
    .mode-text {
      max-width: 100px;
      margin-left: auto;
      margin-right: auto;
    }
    .setting-collapse {
      & {
        margin-bottom: ${e.polished.rem(8)};
      }
      .collapse-header {
        line-height: 2.2;
      }
      .handle{
        height: ${e.polished.rem(32)};
        background: var(--ref-palette-neutral-500);
        padding-left: ${e.polished.rem(8)};
        padding-right: ${e.polished.rem(8)};
      }
    }
  `,k=e.ReactRedux.useSelector((e=>e.appStateInBuilder.appConfig.utilities));Lo((()=>{j(k)}),[k]),Lo((()=>{E()}),[l]);const j=e.hooks.useEventCallback((e=>{var t,o;const n=null===(t=null==l?void 0:l.useUtility)||void 0===t?void 0:t.utilityId;if(!n)return;(null===(o=Object.keys(e||{}))||void 0===o?void 0:o.includes(n))||N("useUtility",null)})),E=()=>{var e,t;const n=null===(t=null===(e=null==f?void 0:f.widgets)||void 0===e?void 0:e[a])||void 0===t?void 0:t.style;if(!(null==l?void 0:l.hasInitBorder)&&!(null==n?void 0:n.border)){const e=(0,o.getAppConfigAction)(),t={color:"var(--ref-palette-neutral-700)",type:"solid",width:"1px"};let i;i=n?n.set("border",t):{border:t};const r=null==l?void 0:l.set("hasInitBorder",!0);e.editWidgetProperty(a,"style",i).editWidgetProperty(a,"config",r).editWidgetProperty(a,"offPanel",!1).exec()}},N=(e,t)=>{if((null==l?void 0:l[e])===t)return!1;const o=l.setIn([e],t);u({id:a,config:o})},A=(e=!1)=>{w(e),e&&(clearTimeout(h.current),h.current=setTimeout((()=>{w(!1)}),5e3))},P=t=>{var n;const i=l.setIn(["modeType"],t),r=(0,o.getAppConfigAction)();let s=Uo;t===m.Compact&&(s=d?zo:_o);const u=M(),c=t===m.Compact;if(u===e.LayoutType.FixedLayout){const{layoutId:e,layoutItemId:t}=g,o=f.layouts[e],l=(null===(n=null==o?void 0:o.content)||void 0===n?void 0:n[t]).bbox.set("width",s.width).set("height",s.height);r.editLayoutItemProperty(g,"bbox",l).editWidgetProperty(a,"config",i).editWidgetProperty(a,"offPanel",c).exec()}else r.editWidgetProperty(a,"config",i).editWidgetProperty(a,"offPanel",c).exec()},M=()=>{var e,t;const o=null==g?void 0:g.layoutId;return null===(t=null===(e=null==f?void 0:f.layouts)||void 0===e?void 0:e[o])||void 0===t?void 0:t.type},L=()=>{I(!T)};return(0,e.jsx)("div",{className:"widget-setting-search jimu-widget-search",css:O},(0,e.jsx)(i.SettingSection,{className:"map-selector-section"},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:p("selectMap")},(0,e.jsx)(i.MapWidgetSelector,{autoSelect:!0,onSelect:e=>{u({id:a,useMapWidgetIds:e})},"aria-label":p("selectMap"),useMapWidgetIds:c})),(0,e.jsx)("div",{className:"fly-map"},(0,e.jsx)("div",null,(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:null==c?void 0:c[0],onActiveViewChange:e=>{null==e||"3d"===e.view.type?b(null):(null==e?void 0:e.id)!==(null==y?void 0:y.id)&&b(e)}})))),(0,e.jsx)(i.SettingSection,{className:"map-selector-section"},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:p("printMode"),role:"radiogroup","aria-label":p("printMode")},(0,e.jsx)("div",{className:"d-flex w-100 select-mode-con"},(0,e.jsx)("div",{className:"flex-grow-1"},(0,e.jsx)(n.Button,{variant:"text",role:"radio","aria-checked":(null==l?void 0:l.modeType)===m.Classic,className:"w-100",disableHoverEffect:!0,disableRipple:!0,title:p("printClassic"),active:(null==l?void 0:l.modeType)===m.Classic,onClick:()=>{P(m.Classic)}},(0,e.jsx)(n.Icon,{autoFlip:!0,icon:v(3158)})),(0,e.jsx)("div",{className:"mt-2 w-100 text-center text-truncate mode-text",title:p("printClassic")},p("printClassic"))),(0,e.jsx)("div",{className:"flex-grow-1 ml-2"},(0,e.jsx)(n.Button,{variant:"text",role:"radio","aria-checked":(null==l?void 0:l.modeType)===m.Compact,className:"w-100",disableHoverEffect:!0,disableRipple:!0,active:(null==l?void 0:l.modeType)===m.Compact,title:p("printCompact"),onClick:()=>{P(m.Compact)}},(0,e.jsx)(n.Icon,{autoFlip:!0,icon:v(15417)})),(0,e.jsx)("div",{className:"mt-2 text-center text-truncate mode-text",title:p("printCompact")},p("printCompact")))))),(0,e.jsx)("div",{className:"w-100 position-absolute remind-con"},(0,e.jsx)(n.Alert,{withIcon:!0,form:"basic",type:"warning",open:x,closable:!0,className:"w-100",text:p("serviceIsNotAvailable"),onClose:()=>{A(!1)}})),(0,e.jsx)(Ro,{id:a,config:l,portalUrl:s,handlePropertyChange:N,onSettingChange:u,jimuMapView:y,toggleRemindPopper:A,showLoading:C,toggleLoading:e=>{o.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:a,propKey:"loadingPrintService",value:e}),R(e)},className:!(null==l?void 0:l.useUtility)&&!C&&"no-utility-setting"}),(null==l?void 0:l.useUtility)&&(0,e.jsx)(i.SettingSection,{role:"group","aria-label":p("templateCommonSettings")},(0,e.jsx)(n.CollapsablePanel,{label:p("templateCommonSettings"),isOpen:T,onRequestOpen:L,onRequestClose:L,"aria-label":p("templateCommonSettings"),className:"custom-setting-collapse"},(0,e.jsx)(qe,{id:a,printTemplateProperties:null==l?void 0:l.commonSetting,handleTemplatePropertyChange:e=>{const t=l.set("commonSetting",e);u({id:a,config:t})},modeType:null==l?void 0:l.modeType,jimuMapView:y}))),(null==l?void 0:l.useUtility)&&(0,e.jsx)(jo,{config:l,handlePropertyChange:N}),!(null==l?void 0:l.useUtility)&&!C&&(0,e.jsx)(Mo,null))};function Go(e){v.p=e}})(),h})())}}}));