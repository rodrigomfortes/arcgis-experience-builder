System.register(["jimu-core","jimu-ui"],(function(e,t){var r={},i={};return{setters:[function(e){r.Immutable=e.Immutable,r.dataSourceUtils=e.dataSourceUtils,r.expressionUtils=e.expressionUtils},function(e){i.richTextUtils=e.richTextUtils}],execute:function(){e((()=>{var e={14321:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=r}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var o={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(o),s.d(o,{default:()=>i,mapExpDataDsId:()=>l,mapExpression:()=>c,mapHtmlDataDsId:()=>a,replaceExpressionDataSource:()=>n});var e=s(79244),t=s(14321);const r=(0,e.Immutable)([]);class i{constructor(){this.id="embed-app-config-operation"}afterWidgetCopied(e,t,i,s,o){var n;if(!o)return s;const a=(null!==(n=t.widgets[e].useDataSources)&&void 0!==n?n:r).filter((e=>!!o[e.mainDataSourceId])),l=t.widgets[e];let d=l.config.expression;d=a&&(null==a?void 0:a.length)>0?c(d,o,l):d;return s.setIn(["widgets",i,"config","expression"],d)}widgetWillRemove(e){return e}useDataSourceWillChange(e,t,r){let i=e;if(t||r){const s=e.widgets[this.widgetId];let o=(null==s?void 0:s.config).expression;o=n(o,t,r),i=e.setIn(["widgets",this.widgetId,"config","expression"],o)}return i}}const n=(r,i,s)=>r?r.replace(t.richTextUtils.EXP_TAG_REGEXP,(r=>(r=a(r,i,s)).replace(t.richTextUtils.DATA_EXPRESSION_REGEXP,((r,o)=>{const n=t.richTextUtils.convertEncodeObject(o),a=e.expressionUtils.replaceDataSourceId((0,e.Immutable)(n),i,s);return`data-expression="${t.richTextUtils.convertEncodedString(a)}"`})))):r,a=(r,i,s)=>r?r.replace(t.richTextUtils.DATA_DS_ID_REGEXP,((t,r)=>r&&e.dataSourceUtils.areDerivedFromSameMain(i,s)?`data-dsid="${s}"`:t)):r,c=(r,i,s)=>r?r.replace(t.richTextUtils.EXP_TAG_REGEXP,(r=>t.richTextUtils.getUniqueId(r)?(r=l(r,i)).replace(t.richTextUtils.DATA_EXPRESSION_REGEXP,((r,o)=>{const n=t.richTextUtils.convertEncodeObject(o),{isChanged:a,expression:c}=e.expressionUtils.mapExpression(i,(0,e.Immutable)(n),s);if(a){return`data-expression="${t.richTextUtils.convertEncodedString(c)}"`}return r})):r)):r,l=(r,i)=>r?r.replace(t.richTextUtils.DATA_DS_ID_REGEXP,((t,r)=>{if(!r)return t;const s=r.split(",");let o="";return s.forEach((t=>{const r=Object.keys(i).find((r=>e.dataSourceUtils.areDerivedFromSameMain(t,r))),s=i[r],n=r&&s?t.replace(r,s):t;o+=`${o?",":""}${n}`})),o?`data-dsid="${o}"`:t})):r})(),o})())}}}));