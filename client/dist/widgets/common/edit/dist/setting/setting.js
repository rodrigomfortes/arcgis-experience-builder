System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-theme","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector"],(function(e,t){var a={},i={},n={},l={},o={},s={},r={};return{setters:[function(e){a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JSAPILayerTypes=e.JSAPILayerTypes,a.React=e.React,a.ServiceManager=e.ServiceManager,a.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,a.SupportedServerTypes=e.SupportedServerTypes,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.defaultMessages=e.defaultMessages,a.hooks=e.hooks,a.jsx=e.jsx,a.polished=e.polished},function(e){i.AdvancedSelect=e.AdvancedSelect,i.Alert=e.Alert,i.Button=e.Button,i.Checkbox=e.Checkbox,i.ConfirmDialog=e.ConfirmDialog,i.Label=e.Label,i.Loading=e.Loading,i.LoadingType=e.LoadingType,i.PanelHeader=e.PanelHeader,i.Popper=e.Popper,i.Radio=e.Radio,i.Select=e.Select,i.Switch=e.Switch,i.TextArea=e.TextArea,i.TextInput=e.TextInput,i.Tooltip=e.Tooltip,i.defaultMessages=e.defaultMessages},function(e){n.LayerSetting=e.LayerSetting,n.MapWidgetSelector=e.MapWidgetSelector,n.SettingRow=e.SettingRow,n.SettingSection=e.SettingSection,n.SidePopper=e.SidePopper},function(e){l.JimuMapViewComponent=e.JimuMapViewComponent,l.SnappingUtils=e.SnappingUtils},function(e){o.useTheme=e.useTheme},function(e){s.List=e.List,s.Tree=e.Tree,s.TreeAlignmentType=e.TreeAlignmentType,s.TreeCollapseStyle=e.TreeCollapseStyle,s.TreeItemActionType=e.TreeItemActionType},function(e){r.DataSourceSelector=e.DataSourceSelector,r.FieldSelector=e.FieldSelector,r.dataComponentsUtils=e.dataComponentsUtils}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=o},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},13089:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=i},19556:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 2h4a1 1 0 0 1 1 1v1h8a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1m0 1v11h13V4.913H5V3zm6 3h1v3h3v1H8v3H7v-3H4V9h3z" clip-rule="evenodd"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=l},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},79244:e=>{"use strict";e.exports=a},79298:e=>{"use strict";e.exports=n},98640:e=>{"use strict";e.exports=s}},t={};function c(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var a in t)c.o(t,a)&&!c.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>ye,default:()=>he});var e,t,a,i,n=c(79244),l=c(14321),o=c(79298),s=c(62686);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(t||(t={})),function(e){e.NoMap="NOMAP",e.NoLayer="NOEDITABLE"}(a||(a={})),function(e){e.Prescriptive="PRESCRIPTIVE",e.Flexible="FLEXIBLE"}(i||(i={}));const r={newEdit:"New editable source",newEditTips:"Support selected features view only",attrMode:"Attribute only",layerConfig:"Layer configuration",capability:"Capability",addRecords:"Add records",deleteRecords:"Delete records",updateRecords:"Update records",snappingSettings:"Snapping settings",configFields:"Configure fields",configFieldsTip:"Select fields to show",addGroup:"Add a group",group:"Group",checkAll:"Check all",uncheckAll:"Uncheck all",noDataMessageDefaultText:"No valid record is selected, select one or add one.",editBlankStatus:'Click the "{EditString}" button to add and configure {ModeString}',editableSource:"editable data sources",changeModeConfirmTitle:"Are you sure you want to switch the mode?",changeModeConfirmTips:"You will lose the settings configured.",editable:"Editable",editFieldDescription:"Please input the description.",editableCount:"{count} Editable",layerHonorSetting:"Use webmap settings",layerCustomize:"Customize",noLayerTips:"The Map does not contain any editable data.",uneditableTips:"The layer is in a read-only state.",templateFilter:"Template filter",relatedRecords:"Related records",runtimeDataEditing:"Runtime data editing",initialReshapeMode:"Display vertices while editing",editGeometryGuides:"Show visual aids to help identify perpendicular and parallel lines when creating or updating a feature.",editFeatureToFeature:"Snap vertices of a feature that is currently being drawn or reshaped to that of an existing feature's vertex, edge, or end point.",batchEditingSetting:"Batch editing"},u=e=>{const{config:t,onPropertyChange:a}=e,{description:i,noDataMessage:s}=t,c=n.hooks.useTranslation(r,l.defaultMessages);return(0,n.jsx)(o.SettingSection,{role:"group","aria-label":c("iconGroup_general"),title:c("iconGroup_general")},(0,n.jsx)(o.SettingRow,{flow:"wrap",label:c("description")},(0,n.jsx)(l.TextArea,{className:"w-100",height:90,"aria-label":c("description"),placeholder:c("editFieldDescription"),defaultValue:null!=i?i:"",onBlur:e=>{a("description",e.target.value)}})),(0,n.jsx)(o.SettingRow,{flow:"wrap",label:c("noDataMessage")},(0,n.jsx)(l.TextArea,{className:"w-100",height:75,"aria-label":c("noDataMessage"),placeholder:c("noDataMessageDefaultText"),defaultValue:s,onBlur:e=>{a("noDataMessage",e.target.value)}})))};var m=c(1888),p=c(23662),g=c.n(p),f=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const h=e=>{const t=window.SVG,{className:a}=e,i=f(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:g()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var y=c(98640),b=c(62838),v=c.n(b);const S=[n.JSAPILayerTypes.FeatureLayer,n.JSAPILayerTypes.SceneLayer,n.JSAPILayerTypes.BuildingComponentSublayer,n.JSAPILayerTypes.OrientedImageryLayer,n.JSAPILayerTypes.SubtypeSublayer],x=(0,n.Immutable)([n.DataSourceTypes.FeatureLayer,n.DataSourceTypes.SceneLayer,n.DataSourceTypes.BuildingComponentSubLayer,n.DataSourceTypes.OrientedImageryLayer,n.DataSourceTypes.SubtypeSublayer]),j=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),C=e=>{const t=null==e?void 0:e.allowGeometryUpdates,a=null==e?void 0:e.capabilities;return{allowGeometryUpdates:t,create:j(a,"create"),update:j(a,"update"),deletable:j(a,"delete")}};function w(e){if(!e)return[];const t=e.objectIdField,{creationDateField:a,creatorField:i,editDateField:n,editorField:l}=e.editFieldsInfo||{},{shapeAreaFieldName:o,shapeLengthFieldName:s}=e.geometryProperties||{};return[t,a,i,n,l,o,s].filter(Boolean)}const R=e=>{const t=[];return null==e||e.forEach((e=>{"group"===e.type?t.push(...R(e.elements)):t.push(e)})),t},T=(e,a)=>{var i,l,o,s,r;const c=e.getLayerDefinition(),{allowGeometryUpdates:d,create:u,update:m,deletable:p}=C(c),g=(null===(o=null===(l=null===(i=e.getSchema())||void 0===i?void 0:i.fields)||void 0===l?void 0:l.asMutable)||void 0===o?void 0:o.call(l,{deep:!0}))||{};let f=Object.values(g);f=f.filter((e=>!w(c).includes(e.name)));const h=null===(s=a.formTemplate)||void 0===s?void 0:s.elements;if(h){const e=R(h).filter((e=>"field"===e.type)).map((e=>e.fieldName));f=f.filter((t=>e.includes(t.name)))}(null==f?void 0:f.length)>50&&(f=f.slice(0,50));const y=(null==c?void 0:c.fields)||[],b=f.map((e=>{const t=y.find((t=>t.name===e.jimuName)),a=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:a,subDescription:(null==e?void 0:e.description)||"",editable:a})})),v={dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(r=e.getRootDataSource())||void 0===r?void 0:r.id};return{id:e.id,name:e.getLabel(),useDataSource:(0,n.Immutable)(v),addRecords:u,deleteRecords:p,updateRecords:m,updateAttributes:m,updateGeometries:d&&m,showFields:f,groupedFields:b,layerHonorMode:t.Webmap}},I=e=>n.DataSourceManager.getInstance().getDataSource(e),k=e=>{const t=(null==e?void 0:e.type)===n.DataSourceTypes.SceneLayer||(null==e?void 0:e.type)===n.DataSourceTypes.BuildingComponentSubLayer;null==e||e.type,n.DataSourceTypes.OrientedImageryLayer;let a;return a=t?e.getAssociatedDataSource():e,a};const D={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:y.TreeItemActionType.RenderOverrideItem,children:[{name:y.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemBody,children:[{name:y.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:y.TreeItemActionType.RenderOverrideItemDragHandle},{name:y.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:y.TreeItemActionType.RenderOverrideItemTitle},{name:y.TreeItemActionType.RenderOverrideItemDetailToggle},{name:y.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},M=e=>{const{layersConfig:t,activeIndex:a,failedDataSourceIds:i,onRemove:s,onSort:r,onClick:c}=e,d=n.hooks.useTranslation(l.defaultMessages,n.defaultMessages),u=t.length,m=n.React.useMemo((()=>t.asMutable({deep:!0}).map(((e,t)=>({itemStateDetailContent:e,itemKey:e.id,itemStateTitle:e.name,itemStateChecked:t===a,itemStateCommands:[{label:d("remove"),iconProps:()=>({icon:v(),size:12}),action:()=>{s(e.id)}}]})))),[a,t,s,d]),p=n.React.useMemo((()=>(0,n.jsx)(l.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:d("dataSourceCreateError")})),[d]),g=n.React.useCallback(((e,t)=>{var a,n;const{itemJsons:l}=t.props,[o]=l,s=null===(n=null===(a=null==o?void 0:o.itemStateDetailContent)||void 0===a?void 0:a.useDataSource)||void 0===n?void 0:n.dataSourceId;return i.includes(s)?p:null}),[p,i]),f=n.React.useCallback(((e,t)=>{if("handleDidDrop"===e.updateType){const t=e.targetDropItemChildren.map((e=>e.itemKey));r(t)}}),[r]),h=n.React.useCallback(((e,t)=>{const{itemJsons:[a]}=t.props;c(a.itemKey)}),[c]),b=n.React.useMemo((()=>[{itemStateDetailContent:"......",itemKey:`${a}`,itemStateTitle:"......",itemStateChecked:!0,itemStateCommands:[]}]),[a]);return(0,n.jsx)(o.SettingRow,{className:"setting-ui-unit-list",css:n.css`
    display: block !important;
    &.setting-ui-unit-list {
      width: 100%;
      .tree-item {
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        &.tree-item_level-1 {
        }
        .jimu-checkbox {
          margin-right: 8px;
        }
      }
      .setting-ui-unit-list-new {
        padding-top: 4px;
      }
    }
  `},u>0&&(0,n.jsx)(y.List,Object.assign({className:"w-100",itemsJson:m,dndEnabled:!0,renderOverrideItemDetailToggle:g,onUpdateItem:f,onClickItemBody:h},D)),u===a&&(0,n.jsx)(y.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:b,dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},D)))};var N=c(13089);const O=e=>n.css`
    .disabled-label{
      color: ${e.ref.palette.neutral[700]};
    }
  `,A=e=>{const{layerConfig:t,isGeoMode:a,layerDefinition:i,layerEditingEnabled:s,onChange:c}=e,{addRecords:d,deleteRecords:u,updateRecords:p,updateAttributes:g,updateGeometries:f}=t,h=n.hooks.useTranslation(r,l.defaultMessages),y=(0,m.useTheme)(),b=(null==i?void 0:i.type)===n.SupportedLayerServiceTypes.Table,{allowGeometryUpdates:v,create:S,update:x,deletable:j}=C(i),w=n.React.useCallback(((e,a)=>{const i=e.currentTarget;i&&c(t.set(a,i.checked))}),[t,c]),R=n.React.useCallback(((e,a)=>{const i=e.currentTarget;if(!i)return;const n=i.checked;c(t.set("updateRecords",n).set("updateAttributes",n).set("updateGeometries",v&&n))}),[v,t,c]),T=n.React.useCallback(((e,a)=>{const i=e.currentTarget;if(!i)return;const n=i.checked;c("updateAttributes"===a&&!n&&!f||"updateGeometries"===a&&!n&&!g?t.set("updateRecords",!1).set("updateAttributes",!1).set("updateGeometries",!1):t.set(a,n))}),[t,c,g,f]);return(0,n.jsx)(o.SettingSection,{title:h("capability"),css:O(y)},s?(0,n.jsx)(n.React.Fragment,null,(!a&&b||a)&&(0,n.jsx)(o.SettingRow,{tag:"label",label:h("addRecords")},(0,n.jsx)(l.Switch,{"aria-label":h("addRecords"),checked:d,onChange:e=>{w(e,"addRecords")},disabled:!S})),(0,n.jsx)(o.SettingRow,{tag:"label",label:h("deleteRecords")},(0,n.jsx)(l.Switch,{"aria-label":h("deleteRecords"),checked:u,onChange:e=>{w(e,"deleteRecords")},disabled:!j})),(0,n.jsx)(o.SettingRow,{tag:"label",label:h("updateRecords")},(0,n.jsx)(l.Switch,{"aria-label":h("updateRecords"),checked:p,onChange:R,disabled:!x})),a&&p&&(0,n.jsx)("div",{className:"ml-4 mt-2"},(0,n.jsx)(l.Label,{className:"w-100 d-flex"},(0,n.jsx)(l.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:g,"aria-label":h("attribute"),onChange:e=>{T(e,"updateAttributes")},disabled:!x}),(0,n.jsx)("div",{className:"m-0 ml-2 flex-grow-1 omit-label"},h("attribute"))),(0,n.jsx)(l.Label,{className:"w-100 d-flex"},(0,n.jsx)(l.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:f,"aria-label":h("geometry"),onChange:e=>{T(e,"updateGeometries")},disabled:!v}),(0,n.jsx)("div",{className:`m-0 ml-2 flex-grow-1 omit-label ${!v&&"disabled-label"}`},h("geometry"))))):h("uneditableTips"))};var E=c(19556),L=c.n(E),F=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const P=e=>{const t=window.SVG,{className:a}=e,i=F(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:L()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var V=c(9044),G=c.n(V),B=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const z=e=>{const t=window.SVG,{className:a}=e,i=B(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:G()},i)):n.React.createElement("svg",Object.assign({className:l},i))};var J=c(45508),H=c.n(J),U=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const _=e=>{const t=window.SVG,{className:a}=e,i=U(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:H()},i)):n.React.createElement("svg",Object.assign({className:l},i))},W="root item for tree data entry",$={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:y.TreeItemActionType.RenderOverrideItem,children:[{name:y.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemContent,children:[{name:y.TreeItemActionType.RenderOverrideItemBody,children:[{name:y.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:y.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:y.TreeItemActionType.RenderOverrideItemDragHandle},{name:y.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:y.TreeItemActionType.RenderOverrideItemIcon},{name:y.TreeItemActionType.RenderOverrideItemTitle},{name:y.TreeItemActionType.RenderOverrideItemCommands},{name:y.TreeItemActionType.RenderOverrideItemDetailToggle}]}]},{name:y.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]},{name:y.TreeItemActionType.RenderOverrideItemSubitems}]})},K=e=>n.css`
    .fields-list-header {
      background: ${e.ref.palette.neutral[300]};
      border-bottom: 1px solid ${e.ref.palette.neutral[600]};
      height: 34px;
      width: 100%;
      flex-wrap: nowrap;
      .jimu-checkbox {
        margin-top: 2px;
      }
      .fields-list-check {
        margin-left: 18px;
      }
    }
    .selected-fields-con{
      margin-top: 0 !important;
      .selected-fields-list {
        flex: 1;
        max-height: 300px;
        overflow-y: auto;
      }
      .jimu-tree-item{
        background: ${e.ref.palette.neutral[300]};
        border-bottom: 1px solid ${e.ref.palette.neutral[400]};
        .jimu-tree-item__content{
          div:first-of-type{
            padding-left: 2px;
          }
          .jimu-tree-item__body{
            background: ${e.ref.palette.neutral[300]};
            .jimu-tree-item__title{
              .jimu-input{
                width: 125px;
              }
            }
            .item-remove-button {
              padding: 0 2px; /** consistent with detail icon from tree. */
            }
            &:hover {
              background: none !important;
            }
          }
        }
      }
    }
  `,Y=(e,t)=>{let a=!1;for(const i of e)if(i.jimuName===t.jimuName){a=!0;break}return a},X=e=>{const t=[];return e.forEach((e=>{(null==e?void 0:e.groupKey)&&t.push(null==e?void 0:e.groupKey)})),t.length>0?Math.max.apply(null,t):0},q=e=>{const{layerConfig:a,layerDefinition:i,layerEditingEnabled:s,isFromMap:c,onChange:d}=e,{useDataSource:u,showFields:p,groupedFields:g,layerHonorMode:f}=a,[h,b]=n.React.useState(null),[v,S]=n.React.useState(!1),[x,j]=n.React.useState(null),[C,R]=n.React.useState(!1),T=n.React.useRef(null),k=n.React.useRef(null),D=(0,m.useTheme)(),M=n.hooks.useTranslation(r,l.defaultMessages),O=n.React.useMemo((()=>g.asMutable({deep:!0})),[g]),A=n.React.useMemo((()=>{let e=0;return null==O||O.forEach((t=>{(null==t?void 0:t.children)?t.children.forEach((t=>{t.editAuthority&&e++})):t.editAuthority&&e++})),e}),[O]),E=n.React.useMemo((()=>p.map((e=>e.jimuName))),[p]),L=n.React.useMemo((()=>(0,n.Immutable)(w(i)||[])),[i]),F=n.React.useMemo((()=>!!O&&O.some((e=>!e.editAuthority&&e.editable))),[O]),V=n.React.useMemo((()=>{if(!O)return!1;const e=O.some((e=>e.editAuthority&&e.editable)),t=O.some((e=>!e.editAuthority&&e.editable));return e&&t}),[O]),G=n.React.useCallback((e=>{const t=I(null==u?void 0:u.dataSourceId),a=null==t?void 0:t.getSchema(),i=(null==a?void 0:a.fields)?Object.values(null==a?void 0:a.fields):[],n=e=>e.filter((e=>!L.includes(e.jimuName))).map((e=>Object.assign({itemKey:e.jimuName,itemStateChecked:!!s&&(null==e?void 0:e.editAuthority),itemStateTitle:e.alias||e.jimuName||e.name,itemStateIcon:N.dataComponentsUtils.getIconFromFieldType(e.type,D),itemStateDetailContent:e,itemStateDisabled:!(null==e?void 0:e.groupKey)&&!Y(i,e),itemStateCommands:[],isCheckboxDisabled:!s||!e.editable},e.children?{itemChildren:n(e.children)}:{}))),l=n(e);b({itemKey:W,itemStateTitle:W,itemChildren:l})}),[L,s,D,null==u?void 0:u.dataSourceId]),B=n.hooks.useLatest(h),J=n.hooks.usePrevious(a.id);n.React.useEffect((()=>{(!B.current&&O||J!==a.id)&&G(O)}),[G,O,J,a.id,B]);const H=n.React.useCallback(((e,t)=>{d(a.set("layerHonorMode",t))}),[a,d]),U=n.React.useCallback((e=>{if(!e)return;const t=e.filter((e=>e));let n=O;const l=t.filter((e=>!p.find((t=>t.jimuName===e.jimuName))));for(const e of l){const t=((null==i?void 0:i.fields)||[]).find((t=>t.name===e.jimuName)),a=null==t?void 0:t.editable;n.push(Object.assign(Object.assign({},e.asMutable({deep:!0})),{editAuthority:a,subDescription:(null==e?void 0:e.description)||"",editable:a}))}const o=p.filter((e=>!t.find((t=>t.jimuName===e.jimuName)))).map((e=>e.jimuName));n=n.filter((e=>!o.includes(e.jimuName)));for(let e=0;e<n.length;e++){const t=n[e];t.children&&(t.children=t.children.filter((e=>!o.includes(e.jimuName))))}d(a.set("showFields",t).set("groupedFields",n)),G(n)}),[G,O,a,null==i?void 0:i.fields,d,p]),q=n.React.useCallback((()=>{const e=O;e.forEach((e=>{e.editable&&(e.editAuthority=F),e.children&&e.children.forEach((e=>{e.editAuthority=F}))})),d(a.set("groupedFields",e)),G(e)}),[G,O,F,a,d]),Q=n.React.useCallback((()=>{R((()=>(setTimeout((()=>{R(!1)}),1e3),!0)));const e=X(O)+1,t=[{jimuName:`${M("group")}-${e}`,name:`${M("group")}-${e}`,alias:`${M("group")}-${e}`,subDescription:"",editAuthority:!1,editable:!0,children:[],groupKey:e},...O];d(a.set("groupedFields",t)),G(t)}),[G,O,a,d,M]),Z=n.React.useCallback((e=>{let t=[];for(const a of O)t=a.jimuName===e?t.concat(a.children):t.concat(a);d(a.set("groupedFields",t)),(null==x?void 0:x.jimuName)===e&&S(!1),G(t)}),[G,null==x?void 0:x.jimuName,O,a,d]),ee=n.React.useCallback(((e,t)=>{const{itemJsons:a}=t.props,[i]=a,{groupKey:o,jimuName:s}=(null==i?void 0:i.itemStateDetailContent)||{};return o?(0,n.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",disableHoverEffect:!0,disableRipple:!0,className:"item-remove-button",onClick:e=>{null==e||e.stopPropagation(),Z(s)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||Z(s)},title:M("remove"),"aria-label":M("remove")},(0,n.jsx)(z,null)):""}),[Z,M]),te=n.React.useCallback(((e,t)=>{T.current=e.current,j(t),S((e=>!e))}),[]),ae=n.React.useCallback(((e,t)=>{const{itemJsons:a,itemJsons:[{itemStateDetailVisible:i,itemStateDetailContent:o,itemStateDisabled:s}]}=t.props,[r]=a,c=null==r?void 0:r.itemStateDetailContent;return o?(0,n.jsx)(l.Button,{icon:!0,type:"tertiary",size:"sm",title:M("description"),"aria-label":M("description"),disabled:!!s,disableHoverEffect:!0,disableRipple:!0,"aria-expanded":!!i,className:"jimu-tree-item__detail-toggle",onClick:e=>{e.stopPropagation(),te(t.dragRef,c)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||(e.stopPropagation(),te(t.dragRef,c))},css:()=>n.css`
        &.jimu-tree-item__detail-toggle {
          display: flex;
          align-items: center;
          cursor: pointer;

          .icon-btn-sizer {
            margin: 0;
            min-width: 0.5rem;
            min-height: 0.5rem;
          }
        }
      `},(0,n.jsx)(_,{autoFlip:!i})):null}),[te,M]),ie=n.React.useCallback(((e,t)=>{var a,i,n;const{draggingItemJsons:l,targetItemJsons:o,dropType:s}=e,r=null===(a=o[0])||void 0===a?void 0:a.itemChildren,c=null===(i=o[Math.min(1,o.length-2)])||void 0===i?void 0:i.itemChildren,d=null===(n=l[0])||void 0===n?void 0:n.itemChildren;let u=!0;return"to-inside"!==s||r&&!d||(u=!1),"to-inside"!==s&&c&&d&&(u=!1),u}),[]),ne=n.React.useCallback(((e,t)=>{const{targetItemJsons:a}=e,[i]=a,{groupKey:n}=(null==i?void 0:i.itemStateDetailContent)||{};return!!n}),[]),le=n.React.useCallback(((e,t)=>{var i;const{itemJsons:n,updateType:l}=e,o=n[0],s=null==o?void 0:o.itemStateDetailContent;if(!(null==s?void 0:s.groupKey)&&l===y.TreeItemActionType.HandleStartEditing)return;const r=n[n.length-1];b(r);const c=null===(i=r.itemChildren)||void 0===i?void 0:i.map(((e,t)=>{var a;const i=e.itemStateDetailContent;if(e.itemChildren){e.itemStateTitle||(e.itemStateTitle=null===(a=e.itemStateDetailContent)||void 0===a?void 0:a.jimuName),i.name=e.itemStateTitle,i.alias=e.itemStateTitle;const t=e.itemChildren.length>0&&!e.itemChildren.some((e=>!e.isCheckboxDisabled&&!e.itemStateChecked));i.editAuthority=t;const n=e.itemChildren.map((e=>(e.itemStateDetailContent.editAuthority=e.itemStateChecked,e.itemStateDetailContent)));i.children=n}else i.editAuthority=e.itemStateChecked;return i}));d(a.set("groupedFields",c))}),[a,d]),oe=n.React.useCallback((e=>{let t;return O.forEach(((a,i)=>{if(a.jimuName===e)t=[i];else if(null==a?void 0:a.children){const n=a.children.findIndex((t=>t.jimuName===e));n>-1&&(t=[i,n])}})),t}),[O]),se=n.React.useCallback((()=>{var e;const t=O,i=oe(null==x?void 0:x.jimuName),n=(null===(e=k.current)||void 0===e?void 0:e.value)||"";if(2===i.length){const[e,a]=i,l=t[e].children[a];l&&(l.subDescription=n)}else if(1===i.length){const[e]=i;t[e].subDescription=n}d(a.set("groupedFields",t)),S(!1),G(t)}),[G,null==x?void 0:x.jimuName,oe,O,a,d]);return c&&(0,n.jsx)(o.SettingSection,{title:M("configFields"),css:K(D)},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Select,{size:"sm",className:"w-100",value:f,onChange:H},(0,n.jsx)("option",{value:t.Webmap},M("layerHonorSetting")),(0,n.jsx)("option",{value:t.Custom},M("layerCustomize")))),f===t.Custom&&(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,{flow:"wrap",label:M("configFieldsTip")},(0,n.jsx)(N.FieldSelector,{useDataSources:u?(0,n.Immutable)([u]):(0,n.Immutable)([]),selectedFields:(0,n.Immutable)(E),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,hiddenFields:L,onChange:U})),(0,n.jsx)(o.SettingRow,{flow:"wrap",label:s&&M("editableCount",{count:A})},(0,n.jsx)("div",{className:"fields-list-header form-inline"},(0,n.jsx)("div",{className:"d-flex w-100 fields-list-check"},s&&(0,n.jsx)(l.Checkbox,{id:"editAll","data-field":"editAll",onClick:q,checked:!F,indeterminate:V,title:F?`${M("editable")} (${M("checkAll")})`:`${M("editable")} (${M("uncheckAll")})`}),(0,n.jsx)(l.Label,{for:"editAll",style:{cursor:"pointer"},className:"ml-2",title:M("field")},M("field"))),(0,n.jsx)(l.Button,{icon:!0,size:"sm",type:"tertiary",disableHoverEffect:!0,disableRipple:!0,onClick:Q,title:M("addGroup"),"aria-label":M("addGroup"),disabled:C},(0,n.jsx)(P,null)))),(0,n.jsx)(o.SettingRow,{className:"selected-fields-con"},(0,n.jsx)(y.Tree,Object.assign({className:"selected-fields-list",rootItemJson:h,treeAlignmentType:y.TreeAlignmentType.Intact,dndEnabled:!0,checkboxLinkage:s,collapseStyle:y.TreeCollapseStyle.Arrow,renderOverrideItemCommands:ee,renderOverrideItemDetailToggle:ae,isItemDroppable:ie,isFolder:ne,onUpdateItem:le},$)),x&&(0,n.jsx)(l.Popper,{placement:"bottom-start",reference:T,offsetOptions:[-27,3],open:v,arrowOptions:!1,toggle:()=>{S(!1)}},(0,n.jsx)("div",{style:{width:228,height:132},className:"p-4"},(0,n.jsx)(l.TextArea,{ref:k,id:null==x?void 0:x.jimuName,className:"w-100",height:60,placeholder:M("editFieldDescription"),defaultValue:(null==x?void 0:x.subDescription)||(null==x?void 0:x.description)}),(0,n.jsx)("div",{className:"mt-4 float-right"},(0,n.jsx)(l.Button,{size:"sm",type:"primary",onClick:se},M("commonModalOk")),(0,n.jsx)(l.Button,{size:"sm",className:"ml-1",onClick:()=>{S(!1)}},M("commonModalCancel"))))))))};var Q=function(e,t,a,i){return new(a||(a=Promise))((function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}r((i=i.apply(e,t||[])).next())}))};const Z=e=>{const{layerConfig:t,isGeoMode:a,layerDefinition:i,layerEditingEnabled:s,isFromMap:c,batchEditing:d=!1,filterDs:u,onChange:m,onClose:p}=e,[g,f]=n.React.useState(""),[h,y]=n.React.useState(null);n.React.useEffect((()=>{f((null==t?void 0:t.name)||"")}),[null==t?void 0:t.name]);const b=n.hooks.useTranslation(r,l.defaultMessages),v=(null==t?void 0:t.useDataSource)?(0,n.Immutable)([t.useDataSource]):(0,n.Immutable)([]),S=n.React.useCallback((e=>Q(void 0,void 0,void 0,(function*(){const t=null==e?void 0:e[0];if(t)try{y((0,n.Immutable)(e));const a=yield n.DataSourceManager.getInstance().createDataSourceByUseDataSource(t),i=k(a),l=yield i.createJSAPILayerByDataSource(),o=T(i,l);m((0,n.Immutable)(o))}catch(e){console.error(e)}finally{y(null)}}))),[m]),j=n.React.useCallback((e=>{const t=e.target.value;f(t)}),[]),C=n.React.useCallback((e=>{(e=""===(e=null==e?void 0:e.trim())?null==t?void 0:t.name:e)!==g&&f(e),m(t.set("name",e))}),[g,t,m]);return(0,n.jsx)("div",{className:"w-100 h-100",css:n.css`
    .layer-config-panel {
      .panel-inner {
        .title {
          max-width: 70%;
        }
      }
      .setting-container {
        height: calc(100% - ${n.polished.rem(58)});
        overflow: auto;
      }
    }
  `},h&&(0,n.jsx)(l.Loading,{type:l.LoadingType.Secondary}),(0,n.jsx)("div",{className:"w-100 h-100 layer-config-panel"},!a&&(0,n.jsx)("div",{className:"w-100 d-flex px-4 py-0"},(0,n.jsx)(l.PanelHeader,{level:1,className:"px-0 py-4 panel-inner",showClose:!!p,onClose:p,title:b("layerConfig")})),(0,n.jsx)("div",{className:"setting-container"},(0,n.jsx)(o.SettingSection,{title:b("data"),className:"pt-0"},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(N.DataSourceSelector,{types:x,disableRemove:()=>!0,disableDataSourceList:a,hideDataView:!0,useDataSources:h||v,mustUseDataSource:!0,onChange:S,closeDataSourceListOnChange:!0,hideDs:u,hideTabs:(0,n.Immutable)(["OUTPUT"])}))),t&&(0,n.jsx)(n.React.Fragment,null,!a&&(0,n.jsx)(o.SettingSection,{title:b("label")},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.TextInput,{size:"sm",type:"text",className:"w-100",value:g,onChange:j,onAcceptValue:C,"aria-label":b("label")}))),(0,n.jsx)(A,{layerConfig:t,isGeoMode:a,layerDefinition:i,layerEditingEnabled:s,onChange:m}),!d&&(0,n.jsx)(q,{layerConfig:t,isFromMap:c,layerDefinition:i,layerEditingEnabled:s,onChange:m})))))};class ee extends n.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=e=>{this.props.onDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,n.jsx)(n.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var te=function(e,t,a,i){return new(a||(a=Promise))((function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}r((i=i.apply(e,t||[])).next())}))};const ae=e=>n.css`
    .edit-tips{
      font-style: italic;
      font-size: 12px;
      color: ${e.ref.palette.neutral[1e3]};
    }
  `,ie="NEW_LAYER_CONFIG_ID",ne=e=>{const{widgetId:t,config:a,useDataSources:i,onSettingChange:s}=e,{layersConfig:c}=a,[d,u]=n.React.useState(null),[p,g]=n.React.useState(!1),[f,y]=n.React.useState([]),[b,v]=n.React.useState({}),S=(0,m.useTheme)(),j=n.hooks.useTranslation(r,l.defaultMessages),w=j("newEdit"),R=n.React.useRef(null),T=n.React.useRef(null),D=n.React.useMemo((()=>d===ie?c.length:c.findIndex((e=>e.id===d))),[d,c]),N=n.React.useMemo((()=>{const e=c.find((e=>e.id===d));return(0,n.Immutable)(e)}),[d,c]),O=n.React.useMemo((()=>b[d]),[d,b]),A=n.React.useCallback(((e,t)=>{const a=c.findIndex((t=>t.id===e));let i;i=t?R.current.getElementsByClassName("add-edit-btn")[0]:R.current.getElementsByClassName("jimu-tree-item__body")[a],T.current=i,e!==d||t?(g(!0),u(e)):(g(!1),u(null))}),[d,c]),E=n.React.useCallback((()=>te(void 0,void 0,void 0,(function*(){const e=n.DataSourceManager.getInstance().getDataSourcesAsArray().filter((e=>x.includes(e.type)&&!e.isDataView)),t=n.ServiceManager.getInstance(),a=e.map((e=>t.fetchArcGISServerInfo(e.url)));yield Promise.allSettled(a),A(ie,!0)}))),[A]),L=n.React.useCallback((()=>{g(!1),u(null)}),[]),F=n.React.useCallback((e=>{const n=a.layersConfig.filter((t=>t.id!==e));let l=a.set("layersConfig",n);0===n.length&&(l=l.set("description",""));const o=i?i.asMutable({deep:!0}):[];s({id:t,config:l,useDataSources:o.filter((t=>t.dataSourceId!==e))}),e===d&&L()}),[d,a,L,s,i,t]),P=n.React.useCallback((e=>{const i=e.map((e=>c.find((t=>t.id===e))));s({id:t,config:a.set("layersConfig",i)})}),[a,c,s,t]),V=n.React.useCallback((e=>{if(!(null==e?void 0:e.url)||(null==e?void 0:e.isOutputFromWidget))return!0;const t=c.map((e=>e.id)),a=(n.dataSourceUtils.getFullArcGISServiceUrl(e.url,!1)||"").toLowerCase().endsWith(n.SupportedServerTypes.MapService.toLowerCase()),i=I(e.id),l=null==i?void 0:i.getLayerDefinition(),{create:o,update:s,deletable:r}=C(l),d=n.ServiceManager.getInstance().getServerInfoByServiceUrl(e.url),u=!(!d||d.owningSystemUrl||o||s||r);return t.includes(e.id)||a||u}),[c]),G=n.React.useCallback((e=>{const l=D>-1?D:c.length;let o=i||(0,n.Immutable)([]);(null==N?void 0:N.id)!==e.id&&(o=o.filter((e=>e.dataSourceId!==(null==N?void 0:N.id))),o=o.concat(e.useDataSource)),s({id:t,config:a.setIn(["layersConfig",`${l}`],e),useDataSources:o.asMutable()}),u(e.id)}),[D,null==N?void 0:N.id,a,c.length,s,i,t]),B=n.React.useCallback(((e,t)=>te(void 0,void 0,void 0,(function*(){var a;const i=c.map((e=>e.id));if(t){const i=k(t),n=yield i.createJSAPILayerByDataSource(),l={id:e,dataSource:i,layer:n,layerDefinition:null==i?void 0:i.getLayerDefinition(),layerEditingEnabled:n.editingEnabled,isFromMap:!!(null===(a=null==i?void 0:i.getRootDataSource())||void 0===a?void 0:a.map)};v((t=>{const a={};for(const i of c)i.id===e?a[i.id]=l:t[i.id]&&(a[i.id]=t[i.id]);return a}))}else y((t=>[...t,e].filter((e=>i.includes(e)))))}))),[c]);return(0,n.jsx)(n.React.Fragment,null,c.map((e=>(0,n.jsx)(ee,{key:e.useDataSource.dataSourceId,useDataSource:e.useDataSource,onDataSourceCreatedOrFailed:B}))),(0,n.jsx)("div",{className:"mt-4",ref:R},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Button,{className:"w-100 add-edit-btn",type:"primary",onClick:E,title:w,"aria-label":w,"aria-describedby":"edit-blank-msg"},(0,n.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,n.jsx)(h,{className:"mr-1 mb-1"}),w))),(0,n.jsx)(o.SettingRow,{css:ae(S)},(0,n.jsx)("div",{className:"text-break edit-tips"},j("newEditTips"))),c.length>0&&(0,n.jsx)(M,{layersConfig:c,activeIndex:D,failedDataSourceIds:f,onRemove:F,onSort:P,onClick:A})),(0,n.jsx)(o.SidePopper,{position:"right",isOpen:p,toggle:L,trigger:null==R?void 0:R.current,backToFocusNode:T.current},(0,n.jsx)(Z,{layerConfig:N,isGeoMode:!1,layerDefinition:null==O?void 0:O.layerDefinition,layerEditingEnabled:null==O?void 0:O.layerEditingEnabled,isFromMap:null==O?void 0:O.isFromMap,filterDs:V,onChange:G,onClose:L})))},le=e=>{const{config:a,isActiveScene:i,onPropertyChange:s,onMultiplePropertyChange:c}=e,{tooltip:d,defaultTooltipEnabled:u=!1,templateFilter:m,relatedRecords:p,liveDataEditing:g,initialReshapeMode:f,segmentLabel:h=!0,defaultSegmentLabelEnabled:y=!1,batchEditing:b=!1}=a,v=n.hooks.useTranslation(r,l.defaultMessages);return(0,n.jsx)(o.SettingSection,{role:"group","aria-label":v("iconGroup_general"),title:v("iconGroup_general")},(0,n.jsx)(o.SettingRow,{tag:"label",label:v("tooltip")},(0,n.jsx)(l.Switch,{checked:d,"data-key":"tooltip",onChange:e=>{var t;t=e.target.checked,c([{name:"tooltip",value:t},{name:"defaultTooltipEnabled",value:!1}])}})),d&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:u,className:"mr-1",onChange:e=>{s("defaultTooltipEnabled",e.target.checked)}}),v("defaultEnabled"))),i&&(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,{tag:"label",label:v("segmentLabel")},(0,n.jsx)(l.Switch,{checked:h,onChange:e=>{var t;t=e.target.checked,c([{name:"segmentLabel",value:t},{name:"defaultSegmentLabelEnabled",value:!1}])}})),h&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:y,className:"mr-1",onChange:e=>{s("defaultSegmentLabelEnabled",e.target.checked)}}),v("defaultEnabled")))),(0,n.jsx)(o.SettingRow,{tag:"label",label:v("templateFilter")},(0,n.jsx)(l.Switch,{checked:m,"data-key":"templateFilter",onChange:e=>{s("templateFilter",e.target.checked)}})),(0,n.jsx)(o.SettingRow,{tag:"label",label:v("relatedRecords")},(0,n.jsx)(l.Switch,{checked:p,"data-key":"relatedRecords",onChange:e=>{s("relatedRecords",e.target.checked)}})),(0,n.jsx)(o.SettingRow,{tag:"label",label:v("runtimeDataEditing")},(0,n.jsx)(l.Switch,{checked:g,"data-key":"liveDataEditing",onChange:e=>{s("liveDataEditing",e.target.checked)}})),(0,n.jsx)(o.SettingRow,{tag:"label",label:v("initialReshapeMode")},(0,n.jsx)(l.Switch,{checked:f,"data-key":"initialReshapeMode",onChange:e=>{s("initialReshapeMode",e.target.checked)}})),(0,n.jsx)(o.SettingRow,{tag:"label",label:v("batchEditingSetting")},(0,n.jsx)(l.Switch,{checked:b,"data-key":"batchEditing",onChange:(e,i)=>{if(i&&a.mapViewsConfig&&Object.keys(a.mapViewsConfig).length>0){let e=a.mapViewsConfig;Object.entries(e).forEach((([a,i])=>{let l=i.layersConfig;if(l)for(let i=0;i<l.length;i++){let o=l[i];o.layerHonorMode===t.Custom&&(o=o.set("layerHonorMode",t.Webmap),l=n.Immutable.set(l,i,o),e=e.setIn([a,"layersConfig"],l))}})),c([{name:"batchEditing",value:i},{name:"mapViewsConfig",value:e}])}else s("batchEditing",i)}})))},oe=e=>{const{widgetId:t,config:a,useMapWidgetIds:i,onSettingChange:l}=e;return(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(o.MapWidgetSelector,{useMapWidgetIds:i,onSelect:e=>{const i=a.set("mapViewsConfig",{}).set("defaultSnapLayers",[]);l({id:t,config:i,useMapWidgetIds:e})}}))};var se=function(e,t,a,i){return new(a||(a=Promise))((function(n,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function s(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}r((i=i.apply(e,t||[])).next())}))};const re=e=>{var t,a,i,s,r;const{useMapWidgetIds:c,mapEmpty:d,jimuMapViews:u,mapViewsConfig:m,batchEditing:p,onChange:g}=e,[f,h]=n.React.useState(null),[y,b]=n.React.useState(null),[v,x]=n.React.useState([]),j=n.hooks.useTranslation(l.defaultMessages),w=null==c?void 0:c[0],R=n.React.useCallback((e=>se(void 0,void 0,void 0,(function*(){const t=`${w}-${e}`;h(t);const a=u.find((e=>e.id===t)),i=a.getAllJimuLayerViews();let l=Object.values(i).filter((e=>!e.fromRuntime&&function(e){var t;if(!e||!e.type)return!1;const a=e.layer.type,i=a!==n.JSAPILayerTypes.BuildingComponentSublayer||e.view,l=S.includes(a),o=!!(null===(t=e.layer)||void 0===t?void 0:t.url);return i&&l&&o}(e)));const o=n.ServiceManager.getInstance(),s=l.map((e=>se(void 0,void 0,void 0,(function*(){const t=yield e.createLayerDataSource();return yield o.fetchArcGISServerInfo(e.layer.url),t?e:null}))));try{l=(yield Promise.all(s)).filter((e=>!!e))}catch(e){console.log(e)}var r;a.isActive||(yield(r=500,new Promise((e=>{setTimeout((()=>{e()}),r)})))),l=l.filter((e=>{var t;const a=e.getLayerDataSource(),i=null===(t=null==a?void 0:a.getLayerDefinition)||void 0===t?void 0:t.call(a),{create:n,update:l,deletable:s}=C(i),r=o.getServerInfoByServiceUrl(e.layer.url);return!!(!r||r.owningSystemUrl||n||l||s)})),x(l)}))),[u,w]),D=!!(null===(t=m[f])||void 0===t?void 0:t.customizeLayers),M=n.React.useMemo((()=>{const e={};for(const[t,a]of Object.entries(m||{}))a.customizeLayers&&(e[t]=a.customJimuLayerViewIds||[]);return e}),[m]),N=n.React.useMemo((()=>{const e=[];return v.forEach((t=>{e.push(t.id);t.getAllAncestorJimuLayerViews().forEach((t=>{e.push(t.id)}))})),e}),[v]),O=n.React.useCallback((e=>{const t=m[f]||(0,n.Immutable)({customizeLayers:!1});if(e){const e=[],a=[];for(const t of v){const i=t.getLayerDataSource();if(!i)continue;const n=T(i,t.layer);a.push(n),e.push(t.id)}g(f,t.set("customizeLayers",!0).set("customJimuLayerViewIds",e).set("layersConfig",a))}else g(f,t.set("customizeLayers",!1).set("customJimuLayerViewIds",[]).set("layersConfig",[]))}),[m,f,v,g]),A=n.React.useCallback((e=>!N.includes(e.id)),[N]),E=n.React.useCallback((e=>!v.includes(e)),[v]),L=n.React.useCallback((e=>{const t=m[f],a=t.layersConfig,i=e.map((e=>{var t;return null===(t=v.find((t=>t.id===e)))||void 0===t?void 0:t.layerDataSourceId}));let n=a.filter((e=>i.includes(e.id)));const l=a.map((e=>e.id));for(const t of e)try{const e=v.find((e=>e.id===t));if(!e||l.includes(e.layerDataSourceId))continue;const a=e.getLayerDataSource();if(!a)continue;n=n.concat(T(a,e.layer))}catch(e){continue}g(f,t.set("customJimuLayerViewIds",e).set("layersConfig",n))}),[m,f,g,v]),F=n.React.useCallback((e=>{for(const t of u){const a=t.getAllJimuLayerViews().find((t=>t.id===e));if(a){b(a);break}}}),[u]),P=n.React.useCallback(((e,t)=>{const a=u.find((t=>t.id===e)),i=t.map((e=>{var t,i;return null===(i=null===(t=a.jimuLayerViews)||void 0===t?void 0:t[e.itemKey])||void 0===i?void 0:i.id})),n=t.map((e=>{var t,i;return null===(i=null===(t=a.jimuLayerViews)||void 0===t?void 0:t[e.itemKey])||void 0===i?void 0:i.layerDataSourceId})),l=m[e].layersConfig.asMutable({deep:!0});l.sort(((e,t)=>n.indexOf(e.id)-n.indexOf(t.id)));const o=m[e].set("layersConfig",l).set("customJimuLayerViewIds",i);g(e,o)}),[g,u,m]);let V,G;const B=null==y?void 0:y.layerDataSourceId,z=I(B),J=k(z);if(y&&J)for(const[e,t]of Object.entries(m))if(t.customizeLayers&&(null===(a=t.customJimuLayerViewIds)||void 0===a?void 0:a.includes(null==y?void 0:y.id))){const a=(null===(s=null===(i=null==t?void 0:t.layersConfig)||void 0===i?void 0:i.filter((e=>e.id===B)))||void 0===s?void 0:s[0])||(0,n.Immutable)(T(J,null==y?void 0:y.layer));V=e,G=a;break}const H=null==J?void 0:J.getLayerDefinition(),U=null===(r=null==J?void 0:J.layer)||void 0===r?void 0:r.editingEnabled,_=n.React.useCallback((e=>{const t=m[V].layersConfig,a=t.findIndex((e=>e.id===B)),i=n.Immutable.set(t,a,e),l=m[V].set("layersConfig",i);g(V,l)}),[m,V,g,B]);return(0,n.jsx)(o.SettingRow,null,!d&&(0,n.jsx)(o.LayerSetting,{mapWidgetId:w,mapViewId:f,keepLastTimeMap:!0,onMapItemClick:R,isCustomizeEnabled:D,selectedValues:M,hideLayers:A,disableLayers:E,isShowRuntimeAddedLayerEnabled:!1,showRuntimeAddedLayerOption:!1,showTable:!1,onToggleCustomize:O,onSelectedLayerIdChange:L,showSelectedLayers:!0,dndEnabled:!0,onLayerItemClick:F,onLayerReorder:P},(0,n.jsx)(Z,{layerConfig:G,isGeoMode:!0,layerDefinition:H,layerEditingEnabled:U,isFromMap:!0,batchEditing:p,onChange:_})),d&&(0,n.jsx)(l.Alert,{tabIndex:0,type:"warning",fullWidth:!0,open:!0,text:j("noWebMapWebSceneTip")}))};const ce=e=>{const{config:t,jimuMapViews:a,onPropertyChange:c}=e,{selfSnapping:d,featureSnapping:u,defaultSelfEnabled:m,defaultFeatureEnabled:p,gridSnapping:g=!1,defaultGridEnabled:f=!1,defaultSnapLayers:h,snapSettingMode:y}=t,b=n.hooks.useTranslation(r,l.defaultMessages,n.defaultMessages),v=s.SnappingUtils.getAllSnappingLayerItems(a),S=n.React.useMemo((()=>v.filter((e=>null==h?void 0:h.includes(e.value)))),[v,h]),x=(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)("div",{className:"plain-tooltip",style:{maxWidth:260}},(0,n.jsx)("div",{className:"mt-1",style:{fontWeight:700}}," ",b("geometryGuides")," "),(0,n.jsx)("div",{className:"mb-3"}," ",b("editGeometryGuides")),(0,n.jsx)("div",{className:"mt-2",style:{fontWeight:700}}," ",b("featureToFeature")," "),(0,n.jsx)("div",{className:"mb-3"}," ",b("editFeatureToFeature")),(0,n.jsx)("div",{className:"mt-2",style:{fontWeight:700}}," ",b("grid")," "),(0,n.jsx)("div",{className:"mb-3"}," ",b("tipsForGrid")))),j=(0,n.jsx)("div",{className:"d-flex justify-content-between align-items-center"},(0,n.jsx)("span",{className:"text-wrap"},b("snappingSettings")),(0,n.jsx)(l.Tooltip,{showArrow:!0,role:"tooltip",title:x},(0,n.jsx)(l.Button,{icon:!0,disableHoverEffect:!0,disableRipple:!0,variant:"text",size:"sm",className:"flex-shrink-0"},(0,n.jsx)(_,null))));return(0,n.jsx)(o.SettingSection,{role:"group",title:j,"aria-label":b("snappingSettings")},(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Select,{size:"sm",className:"w-100",value:y,onChange:e=>{c("snapSettingMode",e.target.value)}},(0,n.jsx)("option",{value:i.Prescriptive},b("prescriptiveMode")),(0,n.jsx)("option",{value:i.Flexible},b("flexibleMode")))),y===i.Prescriptive?(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:m,className:"mr-1",onChange:e=>{c("defaultSelfEnabled",e.target.checked)}}),b("geometryGuides"))),(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:p,className:"mr-1",onChange:e=>{c("defaultFeatureEnabled",e.target.checked)}}),b("featureToFeature")))):(0,n.jsx)(n.React.Fragment,null,(0,n.jsx)(o.SettingRow,{tag:"label",label:b("geometryGuides")},(0,n.jsx)(l.Switch,{checked:d,"data-key":"selfSnapping",onChange:e=>{c("selfSnapping",e.target.checked)}})),d&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:m,className:"mr-1",onChange:e=>{c("defaultSelfEnabled",e.target.checked)}}),b("defaultEnabled"))),(0,n.jsx)(o.SettingRow,{tag:"label",label:b("featureToFeature")},(0,n.jsx)(l.Switch,{checked:u,"data-key":"featureSnapping",onChange:e=>{c("featureSnapping",e.target.checked)}})),u&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:p,className:"mr-1",onChange:e=>{c("defaultFeatureEnabled",e.target.checked)}}),b("defaultEnabled"))),(0,n.jsx)(o.SettingRow,{tag:"label",label:b("grid")},(0,n.jsx)(l.Switch,{checked:g,"data-key":"gridSnapping",onChange:e=>{c("gridSnapping",e.target.checked)}})),g&&(0,n.jsx)(o.SettingRow,null,(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Checkbox,{checked:f,className:"mr-1",onChange:e=>{c("defaultGridEnabled",e.target.checked)}}),b("defaultEnabled")))),(0,n.jsx)(o.SettingRow,{flow:"wrap",label:b("chooseDefaultSnappingLayers"),className:"select-option"},(0,n.jsx)(l.AdvancedSelect,{size:"sm",title:b("chooseDefaultSnappingLayers"),hideCheckAll:!1,hideBottomTools:!0,hideSearchInput:!0,staticValues:v,sortList:!1,isMultiple:!0,selectedValues:S,disabled:0===a.length,onChange:e=>{const t=(e||[]).map((e=>e.value));c("defaultSnapLayers",t)},"aria-label":b("chooseDefaultSnappingLayers")})))};var de=c(31027),ue=c.n(de),me=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};const pe=e=>{const t=window.SVG,{className:a}=e,i=me(e,["className"]),l=(0,n.classNames)("jimu-icon jimu-icon-component",a);return t?n.React.createElement(t,Object.assign({className:l,src:ue()},i)):n.React.createElement("svg",Object.assign({className:l},i))},ge=e=>n.css`
    &.empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 260px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;

        .empty-placeholder-text {
          color: ${e.ref.palette.neutral[1e3]};
          font-size: 14px;
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${e.ref.palette.neutral[800]};
        }
      }
    }
  `,fe=e=>{const{isGeoMode:t}=e,a=n.hooks.useTranslation(r,l.defaultMessages),i=(0,m.useTheme)(),o=a("newEdit"),s=a("editableSource"),c=t?a("selectMapHint"):a("editBlankStatus",{EditString:o,ModeString:s});return(0,n.jsx)("div",{className:"empty-placeholder w-100",css:ge(i)},(0,n.jsx)("div",{className:"empty-placeholder-inner"},(0,n.jsx)("div",{className:"empty-placeholder-icon"},(0,n.jsx)(pe,{size:48})),(0,n.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg"},c)))},he=t=>{const{id:a,config:i,useDataSources:c,useMapWidgetIds:d,onSettingChange:m}=t,{editMode:p,layersConfig:g=(0,n.Immutable)([]),mapViewsConfig:f=(0,n.Immutable)({}),batchEditing:h=!1}=i,[y,b]=n.React.useState(!1),[v,S]=n.React.useState(!0),[x,j]=n.React.useState([]),[C,w]=n.React.useState(!1),R=n.React.useRef(null),T=p===e.Attribute,I=p===e.Geometry,k=(null==d?void 0:d.length)>0,D=T&&g.length>0||I&&Object.keys(f).length>0,M=n.hooks.useTranslation(r,l.defaultMessages),N=n.React.useCallback(((e,t)=>{if(t===i[e])return;const n=i.set(e,t);m({id:a,config:n})}),[i,m,a]),O=n.React.useCallback((e=>{let t=i;e.forEach((e=>{e.value!==i[e.name]&&(t=t.set(e.name,e.value))})),m({id:a,config:t})}),[i,m,a]),A=n.React.useCallback((()=>{m({id:a,config:i.set("editMode",R.current).set("layersConfig",[]).set("mapViewsConfig",{}),useDataSources:[],useMapWidgetIds:[]}),R.current=null,b(!1)}),[i,m,a]),E=n.React.useCallback((e=>{p!==e&&(R.current=e,D?b(!0):A())}),[p,A,D]),L=n.React.useCallback((e=>{j([]);const t=Object.values(e);1!==Object.keys(t).length||Object.values(t)[0].dataSourceId?S(!1):S(!0),j(t)}),[S]),F=n.React.useCallback((e=>{e&&w("3d"===e.view.type)}),[]),P=n.React.useCallback(((e,t)=>{m({id:a,config:i.setIn(["mapViewsConfig",e],t)})}),[i,m,a]);return(0,n.jsx)("div",{className:"h-100"},(0,n.jsx)("div",{className:"jimu-widget-setting widget-setting-edit h-100"},(0,n.jsx)(o.SettingSection,{role:"group",title:M("mode")},(0,n.jsx)("div",{role:"radiogroup",className:"mb-4"},(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:T,onChange:()=>{E(e.Attribute)}}),M("attrMode")),(0,n.jsx)(l.Label,{className:"d-flex align-items-center"},(0,n.jsx)(l.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:I,onChange:()=>{E(e.Geometry)}}),M("interactWithMap"))),T&&(0,n.jsx)(ne,{widgetId:a,config:i,useDataSources:c,onSettingChange:m}),I&&(0,n.jsx)(oe,{widgetId:a,config:i,useMapWidgetIds:d,onSettingChange:m}),I&&k&&(0,n.jsx)(re,{useMapWidgetIds:d,mapEmpty:v,jimuMapViews:x,mapViewsConfig:f,batchEditing:h,onChange:P})),T&&D&&(0,n.jsx)(u,{config:i,onPropertyChange:N}),T&&!D&&(0,n.jsx)(fe,{isGeoMode:!1}),I&&k&&(0,n.jsx)(ce,{config:i,jimuMapViews:x,onPropertyChange:N}),I&&k&&(0,n.jsx)(le,{config:i,isActiveScene:C,onPropertyChange:N,onMultiplePropertyChange:O}),I&&!k&&(0,n.jsx)(fe,{isGeoMode:!0}),I&&(0,n.jsx)(s.JimuMapViewComponent,{useMapWidgetId:null==d?void 0:d[0],onViewsCreate:L,onActiveViewChange:F}),y&&(0,n.jsx)(l.ConfirmDialog,{level:"warning",title:M("changeModeConfirmTitle"),hasNotShowAgainOption:!1,content:M("changeModeConfirmTips"),onConfirm:A,onClose:()=>{b(!1)}})))};function ye(e){c.p=e}})(),d})())}}}));