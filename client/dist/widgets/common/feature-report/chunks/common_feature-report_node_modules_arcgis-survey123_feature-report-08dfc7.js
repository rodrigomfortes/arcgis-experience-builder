"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_common_feature-report_node_modules_arcgis-survey123_feature-report-08dfc7"],{402:(e,t,i)=>{i.r(t),i.d(t,{features_preview:()=>c,report_generator:()=>h,report_settings:()=>d,task_list:()=>u,template_chooser:()=>m});var r=i(826),s=i(938),o=i(5),a=i(291),l=i(129);const n=e=>{const{folderId:t,start:i=1,num:r=10,authentication:s}=e,o=t?`/${t}`:"";return function(e){return e.owner?Promise.resolve(e.owner):e.item&&e.item.owner?Promise.resolve(e.item.owner):e.authentication&&e.authentication.getUsername?e.authentication.getUsername():Promise.reject(new Error("Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option."))}(e).then((t=>`${(0,a.d)(e)}/content/users/${t}${o}`)).then((e=>(0,a.r)(e,{httpMethod:"GET",authentication:s,params:{start:i,num:r}})))},c=class{constructor(e){(0,r.r)(this,e),this.reportService=o.R.getService(),this.utilService=a.U.getService(),this.stateService=l.S.getService(),this.queryParameters=void 0,this.inputFeatureTemplate=void 0,this.featureCount=0,this.featureStr="",this.translator=void 0,this.reportLang=void 0,this.commonLang=void 0}componentWillLoad(){return this.stateService.subscribe("update-features-preview",(e=>{void 0!==e&&(this.inputFeatureTemplate=e),this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.init()})),Promise.resolve(!0).then((()=>{const e=s.T.getService().getTranslateSync();this.translator=e,this.initTranslateData(e),this.stateService.subscribe("locale-data-changed",(e=>{this.initTranslateData(e)}))})).catch((e=>{this.reportService.showError(e)}))}initTranslateData(e){this.translator=e,this.commonLang=null==e?void 0:e.common,this.reportLang=null==e?void 0:e.customPrint}init(){let e=[];return this.getDisplayFields().then((t=>{e=t;let i=[];i=e;const r=JSON.parse(this.queryParameters);let a=10;r.resultRecordCount<10&&(a=r.resultRecordCount),r.orderByFields&&(r.orderByFields=r.orderByFields.replace("||",""));const l=Object.assign({url:s.P.featureLayerUrl,authentication:s.P.token,outFields:i,resultRecordCount:a},r),n="where"in l?l.where:null,c="objectIds"in l?l.objectIds:null,h={};return null!==n&&(h.where=n),null!=c&&(h.objectIds=c),c||n||(h.where="1<>1",delete h.objectIds),l.params=h,delete l.where,delete l.objectIds,this.reportService.getResourceCredential(s.P.featureLayerUrl).then((e=>(l.authentication=e,(0,o.q)(l))))})).then((t=>{if(0===this.featureCount)return this.featureStr=this.commonLang.noResults,!0;const i=t.fields||[],r={};i.forEach((e=>{r[e.name]=e}));const s=this.featureCount>10?10:this.featureCount,o=t.features.splice(0,s);return this.featureStr=o.map((t=>{let i=this.inputFeatureTemplate;return e.forEach((e=>{const s=this.utilService.formatFieldVal(r[e],t.attributes[e]);i=i.replace(`{${e}}`,s)})),i})).join("<br>"),this.featureCount>10&&(this.featureStr+=`<br>...(${this.utilService.formatNumber(this.featureCount-10)} ${this.commonLang.more||"more"})`),!0})).catch((e=>{this.reportService.showError(e)}))}getDisplayFields(){let e=[];return this.reportService.getLayerJson().then((t=>{if(this.inputFeatureTemplate){const i=t.fields||[];return(this.inputFeatureTemplate.match(/\{.*?\}/g)||[]).forEach((t=>{const r=t.substring(1,t.length-1),s=i.find((e=>e.name===r));e.indexOf(r)<0&&s&&e.push(r)})),e.length||(e=[t.objectIdField||"objectid"]),e}if(t.displayField)this.inputFeatureTemplate="{"+t.displayField+"}",e=[t.displayField];else{const i=t.fields||[],r=Object.keys(t.editFieldsInfo||{}).map((e=>t.editFieldsInfo[e])).concat([t.objectIdField||"",t.globalIdField||""]),s=i.find((e=>!r.includes(e.name)&&"esriFieldTypeString"===e.type)),o=i.find((e=>!r.includes(e.name)&&this.utilService.isNumberField(e))),a=i.find((e=>!r.includes(e.name)&&!this.utilService.isNumberField(e)&&"esriFieldTypeString"!==e.type)),l=s||o||a||i[0];l&&(this.inputFeatureTemplate="{"+l.name+"}",e=[l.name])}return e}))}render(){var e,t;return(0,r.h)(r.H,{key:"e032ecfad868b052035b8568c92f65671871fe70"},(0,r.h)("div",{key:"12a91912e7c7c9d3e1b7613db8fc17d3b574dbd3"},(0,r.h)("div",{key:"4e1f2e8d946dbb478500b72249a6587677401cf0",class:"heading"},null===(t=null===(e=this.translator)||void 0===e?void 0:e.customPrint)||void 0===t?void 0:t.inputFeatures," (",this.featureCount,")"),(0,r.h)("div",{key:"948e309e0fcfaf88ab4f777073f07179d6c6f660",innerHTML:this.featureStr})),(0,r.h)("slot",{key:"4e53f2242c73e394085efe69f42725e3fa534d20"}))}};c.style=":host{display:block;min-height:200;padding:0 0.75rem;color:var(--calcite-color-text-2)}:host .heading{margin-inline:0px;margin-block:1.25rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}";const h=class{constructor(e){(0,r.r)(this,e),this.reportCreated=(0,r.c)(this,"reportCreated",7),this.batchPrintLimitCount=2e3,this.checkingList=[],this.reportService=o.R.getService(),this.utilService=a.U.getService(),this.state=l.S.getService(),this.featureCount=void 0,this.supportShowCredits=!0,this.printTemplates=[],this.langObj=void 0,this.creditsInfo=void 0,this.creditStatus=void 0,this.testModeJobObj=void 0,this.isTestModePrinting=void 0,this.visibleConf=void 0,this.templateItemId=void 0,this.isPrinting=void 0,this.translator=void 0}componentWillLoad(){return this.checkPrivilige(),this.printTemplates=this.reportService.getHelperObj("printTemplates")||[],this.state.subscribe("print-templates-updated",(e=>{this.printTemplates=e||[]})),this.state.subscribe("portal-info-update",(()=>{this.checkPrivilige()})),this.state.subscribe("feature-count-updated",(()=>{this.checkPrivilige()})),Promise.resolve(!0).then((()=>{const e=s.T.getService().getTranslateSync();this.translator=e,this.state.subscribe("locale-data-changed",(e=>{this.translator=e}))}))}checkPrivilige(){this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.isPortal=this.utilService.isPortal;const e=this.utilService.supportFeatureReport(),t=this.utilService.isUserCanPrintFeatureReport();this.canShowEstimateCredits=!!e&&t,this.supportShowCredits=!this.isPortal&&this.featureCount<=this.batchPrintLimitCount&&this.canShowEstimateCredits}estimateCredits(){if(!(this.featureCount>this.batchPrintLimitCount)&&!(this.featureCount<1)&&this.printTemplates&&this.printTemplates.length&&(!this.creditsInfo||"estimating"!==this.creditStatus)){const e=this.reportService.getParamCache().templateItemId||s.P.templateItemId,t={queryParameters:s.P.queryParameters,featureLayerUrl:s.P.featureLayerUrl,templateItemId:e,surveyItemId:s.P.surveyItemId};t.surveyItemId||delete t.surveyItemId,this.creditStatus="estimating",this.creditsInfo=this.creditsInfo||{},this.reportService.estimateReportCosts(t).then((t=>{if(!t.resultInfo)throw t.error;this.creditsInfo=t.resultInfo,this.creditStatus="finished",this.creditsInfo.lastCalculatedCount=this.featureCount,this.creditsInfo.lastSelectedTemplateId=e})).catch((e=>{this.reportService.showError(e),this.creditStatus="changed"}))}}buttonClickable(){return!!this.templateItemId||!(!this.printTemplates||!this.printTemplates.length)}executeCustomPrint(e){var t;const i=this.reportService.getParamCache();if(e&&this.isTestModePrinting)return;if(this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.featureCount<1)return void this.reportService.showError({},{errorStr:null===(t=this.translator)||void 0===t?void 0:t.common.noResults});if(e?this.isTestModePrinting=!0:this.isPrinting=!0,e){const e={queryParameters:s.P.queryParameters,templateItemId:i.templateItemId||s.P.templateItemId,surveyItemId:s.P.surveyItemId,featureLayerUrl:s.P.featureLayerUrl,outputReportName:i.outputPackageName||s.P.outputPackageName||i.outputReportName||s.P.outputReportName||""};if(e.outputReportName){const t=this.utilService.extractPlaceholders(e.outputReportName);t&&t.length||(e.outputPackageName=e.outputReportName)}const t=i.mergeFiles||s.P.mergeFiles;return t&&"none"!==t&&(e.mergeFiles=t),this.reportService.createSampleReport(e).then((e=>{var t,i;e&&e.success?(this.testModeJobObj=e,this.watchTestModeJob()):(this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.error&&e.error.message?e.error.message:""}),this.isTestModePrinting=!1)})).catch((e=>{var t,i;this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.error&&e.error.message?e.error.message:""}),this.isTestModePrinting=!1}))}let r=i.outputPackageName||s.P.outputPackageName||i.outputReportName||s.P.outputReportName||"";return r.length>250&&(r=r.substr(0,250)),Promise.resolve().then((()=>{let e=null;e=i.uploadInfo||s.P.uploadInfo||{type:"arcgis",parameters:{},conflictBehavior:"rename"};const t=s.P.packageFiles+""=="true"||s.P.packageFiles+""!="false"&&"auto",o={queryParameters:s.P.queryParameters,templateItemId:i.templateItemId||s.P.templateItemId,outputReportName:r||"",featureLayerUrl:s.P.featureLayerUrl,uploadInfo:JSON.stringify(e),packageFiles:t};s.P.surveyItemId&&(o.surveyItemId=i.surveyItemId||s.P.surveyItemId),(i.outputFormat||s.P.outputFormat)&&(o.outputFormat=i.outputFormat||s.P.outputFormat),s.P.webmapItemId&&(o.webmapItemId=s.P.webmapItemId),(Number(s.P.mapScale)||0===Number(s.P.mapScale))&&(o.mapScale=Number(s.P.mapScale)),s.P.locale&&(o.locale="||"+s.P.locale),s.P.utcOffset&&(o.utcOffset=s.P.utcOffset);const a=i.outputPackageName||s.P.outputPackageName;a&&(o.outputPackageName=a);const l=i.mergeFiles||s.P.mergeFiles;l&&"none"!==l&&(o.mergeFiles=l);!1===this.reportService.getHelperObj().canCreateItem&&delete o.uploadInfo;let n=null;this.reportService.executeReport(o).then((e=>{var t,i;if(e&&e.success)return n=e.jobId,this.reportService.checkJobStatus(n);this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.error.message}),this.isPrinting=!1})).then((()=>{this.queryJobTimmer&&clearTimeout(this.queryJobTimmer),this.queryJobTimmer=setTimeout((()=>{this.reportService.queryJobs(!0).then((e=>{this.checkingList.push(n),this.reportCreated.emit({jobId:n,checkingList:this.checkingList,jobs:(null==e?void 0:e.jobs)||[]}),this.isPrinting=!1}))}),100)})).catch((e=>{var t,i;const r=this.reportService.getErrorStr(e);this.reportService.showError(e,{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:r}),this.isPrinting=!1}))}))}watchTestModeJob(){if(!this.testModeJobObj)return;const e=this.testModeJobObj.jobId,t=()=>this.reportService.checkJobStatus(e).then((e=>{var i,r;if(this.testModeJobObj=e,"esriJobSucceeded"===e.jobStatus||"esriJobPartialSucceeded"===e.jobStatus)return this.reportService.downloadFile(e),this.isTestModePrinting=!1,"esriJobPartialSucceeded"===e.jobStatus&&this.reportService.showError({},{alertType:"warning",errorStr:null===(r=null===(i=this.translator)||void 0===i?void 0:i.customPrint)||void 0===r?void 0:r.printErrMsg,detail:e.detail||e.message||(e.messages&&e.messages.length?e.messages.reduce(((e,t)=>e+t)):"")}),!0;if("esriJobFailed"===this.testModeJobObj.jobStatus)throw this.isTestModePrinting=!1,e;if(e.error)throw e.error;setTimeout((()=>{t()}),1500)})).catch((e=>{var t,i;this.reportService.showError({},{errorStr:null===(i=null===(t=this.translator)||void 0===t?void 0:t.customPrint)||void 0===i?void 0:i.printErrMsg,detail:e.detail||e.message||(e.messages&&e.messages.length?e.messages.reduce(((e,t)=>e+t)):"")}),this.isTestModePrinting=!1}));t()}render(){var e,t,i,s,o,a,l,n,c,h,d,u,m,p,v;return(0,r.h)(r.H,{key:"c3ae4f789c8ee13766a37d216b4d8958847f1b72"},this.supportShowCredits&&this.visibleConf.indexOf("showCredits")>=0?(0,r.h)("div",{class:"credits-info"},(0,r.h)("div",{class:"show-credits has-spinner"},this.creditsInfo&&"estimating"===this.creditStatus?(0,r.h)(r.F,null,(0,r.h)("span",{class:""+(this.featureCount<1||!this.printTemplates.length?"disabled":""),onClick:()=>this.estimateCredits()},`${null===(e=this.translator)||void 0===e?void 0:e.common.calculating}`),(0,r.h)("calcite-loader",{label:null===(t=this.translator)||void 0===t?void 0:t.common.calculating,inline:"true"})):(0,r.h)("calcite-link",{disabled:this.featureCount<1||!this.printTemplates.length,onClick:()=>this.estimateCredits()},`${null===(s=null===(i=this.translator)||void 0===i?void 0:i.customPrint)||void 0===s?void 0:s.creditsEstimate}`)),this.creditsInfo&&"finished"===this.creditStatus&&this.featureCount>0&&this.printTemplates.length?(0,r.h)("div",{class:"credits-result-info"},(0,r.h)("span",null,null===(a=null===(o=this.translator)||void 0===o?void 0:o.customPrint)||void 0===a?void 0:a.creditsRecordsCount.replace("${$recordsCount}",`${this.featureCount}`).replace("${$requiredCredits}",`${this.creditsInfo.cost}`))):"",this.creditsInfo&&"changed"===this.creditStatus&&this.featureCount>0&&this.printTemplates.length?(0,r.h)("div",{class:"credits-result-info"},(0,r.h)("span",null,null===(n=null===(l=this.translator)||void 0===l?void 0:l.customPrint)||void 0===n?void 0:n.credtisResultInvalid)):""):"",(0,r.h)("div",{key:"2b7655195572ebffa544dc8d4c3de6133e8a6774",class:"execute-btn "+(!this.isPortal&&this.featureCount<=this.batchPrintLimitCount&&this.canShowEstimateCredits?"":"portal-btn")},(0,r.h)("a",{key:"2ddf00aea0426ff205556d64962c6f1191a9c8a2",class:"no-hover"},(0,r.h)("calcite-button",{key:"4a8e77d2eba6234db5abf862a28f5f7df0e82744",id:"submit-btn",disabled:this.isPrinting||!this.buttonClickable(),onClick:()=>this.executeCustomPrint()},null===(h=null===(c=this.translator)||void 0===c?void 0:c.customPrint)||void 0===h?void 0:h.generate,this.isPrinting?(0,r.h)("calcite-loader",{label:null===(u=null===(d=this.translator)||void 0===d?void 0:d.common)||void 0===u?void 0:u.loading,inline:"true"}):null),(this.printTemplates||[]).length>0||this.templateItemId||(null===(m=this.visibleConf)||void 0===m?void 0:m.indexOf("selectTemplate"))>=0?null:(0,r.h)("calcite-notice",{open:!0,kind:"danger",scale:"s",width:"auto"},(0,r.h)("div",{slot:"message"},null===(v=null===(p=this.translator)||void 0===p?void 0:p.customPrint)||void 0===v?void 0:v.chooseTemplateNoOneYet1)))),(0,r.h)("slot",{key:"318b81be1d680dc70c107f9422e727310af7fb9d"}))}};h.style=":host{padding:0 0.75rem;display:block}:host .clickable-text{cursor:pointer;font-weight:normal}:host calcite-notice{margin-top:6px}:host .credits-info{margin:10px 0 10px 0;padding:10px 0;background-color:var(--calcite-color-foreground-3);color:var(--calcite-color-text-2);display:flex;justify-content:space-between}:host .credits-info>div{margin:0px 10px}:host .credits-info .show-credits{display:inline-flex;align-items:center}:host .credits-info .show-credits survey123-ui-spinner{line-height:0}:host .credits-info .show-credits ::ng-deep span{line-height:0}:host .credits-info .show-credits .icon-spin.icon-refresh{top:1px}:host .credits-info .show-credits .spinner{-webkit-transition:none;-moz-transition:none;-o-transition:none;transition:none}:host .credits-info .show-credits span:not(.clickable-text){cursor:default}:host .credits-info .show-credits span.clickable-text.disabled{cursor:not-allowed}:host .credits-info .credits-result-info{flex-grow:1;display:flex;justify-content:flex-end}:host .credits-info .credits-result-info span{word-break:break-word}:host .pieview-info{margin-top:10px;margin-bottom:20px}:host .pieview-info .has-spinner>span{cursor:default}:host .pieview-info .has-spinner>span.report-status{padding:0 2px}:host .pieview-info .preview-text{cursor:default;display:flex;align-items:center}:host .pieview-info .preview-text>span{cursor:pointer}:host .pieview-info .preview-text.disabled{text-decoration:underline solid #979797;color:#979797;cursor:not-allowed}:host .pieview-info .preview-text.disabled>span{cursor:not-allowed}:host .execute-btn{overflow:auto;margin:-5px 0 30px 0}:host .execute-btn>span{line-height:41px}:host .execute-btn a{float:inline-start}:host .execute-btn a button{width:auto}:host .execute-btn.portal-btn{margin:20px 0}:host calcite-loader{display:inline-block;margin:0 0 0 10px}";const d=class{constructor(e){(0,r.r)(this,e),this.fileOptionChange=(0,r.c)(this,"fileOptionChange",7),this.fileNameChange=(0,r.c)(this,"fileNameChange",7),this.selectedFileFormatChange=(0,r.c)(this,"selectedFileFormatChange",7),this.reportService=o.R.getService(),this.state=l.S.getService(),this.mergeFiles=void 0,this.outputFormat="word",this.conflictBehavior="rename",this.fileName=void 0,this.visibleElems=[],this.translator=void 0,this.langReport=void 0,this.helperObj=void 0,this.featureCount=void 0,this.printTemplates=[]}onFileNameChange(){this.fileNameChangeHandler({target:{value:this.fileName}})}componentWillLoad(){return Promise.resolve(!0).then((()=>{const e=s.T.getService().getTranslateSync();return this.translator=e,this.langReport=null==e?void 0:e.customPrint,this.state.subscribe("locale-data-changed",(e=>{this.translator=e,this.langReport=null==e?void 0:e.customPrint})),this.printTemplates=this.reportService.getHelperObj("printTemplates")||[],this.state.subscribe("print-templates-updated",(e=>{this.printTemplates=e||[]})),this.helperObj=this.reportService.getHelperObj(),this.featureCount=this.reportService.getHelperObj("featureCount")||0,this.state.subscribe("portal-info-update",(()=>{this.featureCount=this.reportService.getHelperObj("featureCount")||0})),this.state.subscribe("feature-count-updated",(()=>{this.featureCount=this.reportService.getHelperObj("featureCount")||0})),this.getUserFolders()})).catch((e=>{this.reportService.showError(e)}))}fileOptChangeHandler(e){const t=this.reportService.getParamCache();"split"!==e.detail?t.mergeFiles=e.detail:delete t.mergeFiles,this.fileOptionChange.emit(e.detail)}fileNameChangeHandler(e){this.fileName=e.target.value;const t=this.fileName;if(t){const e=this.extractPlaceholders(t);e&&e.length||this.reportService.setParamCache({outputPackageName:t})}this.reportService.setParamCache({outputReportName:t}),this.fileNameChange.emit(this.fileName)}selectedFolderIdChangeHandler(e){this.selectedFolderId=e.target.value;const t=this.reportService.getParamCache("uploadInfo")||{type:"arcgis",parameters:{},conflictBehavior:"rename"};t.parameters.folderId="all"===this.selectedFolderId?"":this.selectedFolderId,this.reportService.setParamCache({uploadInfo:t})}outputFormatChangeHandler(e){this.outputFormat=e.target.value,this.reportService.setParamCache({outputFormat:this.outputFormat}),this.selectedFileFormatChange.emit(this.outputFormat)}getUserFolders(){var e,t;const i=a.U.getService(),r=null===(e=i.getUser())||void 0===e?void 0:e.username,s=null===(t=this.langReport)||void 0===t?void 0:t.saveToAGOFolderRoot.replace("${$username}",r),o=Object.assign({owner:r},i.getBaseRequestOptions());return n(o).then((e=>{var t;this.folders=[];const i=[];return i.push({username:r,id:"all",value:"all",title:s,label:s,created:null}),e&&e.folders&&e.folders.length?(e.folders.forEach((e=>{e.label=e.title,e.value=e.id})),this.folders=i.concat(e.folders)):this.folders=i,this.selectedFolderId=null===(t=this.folders[0])||void 0===t?void 0:t.id,this.folders}))}extractPlaceholders(e){const t=(e=e||"").match(/\$[^{$]*?{[^}]*?.*?}/g),i=[];return t&&t.forEach((e=>{-1===i.indexOf(e)&&i.push(e)})),i}changeConflictBehavior(e){this.conflictBehavior=e;const t=this.reportService.getParamCache("uploadInfo")||{type:"arcgis",parameters:{},conflictBehavior:"rename"};t.conflictBehavior=this.conflictBehavior,this.reportService.setParamCache({uploadInfo:t})}render(){var e,t,i,s,o,a,l,n,c,h,d,u,m,p,v,g,f,b,C,P,S,I,T,y,w,k,x,F,j,O,N,R,L,E,H,J,M,B;return(0,r.h)(r.H,{key:"3f587cd1126b796045f19ab17d3952c3ee7e14dc"},(0,r.h)("div",{key:"b57facec3431dfa5d9378a099c4d0d36e54800f7",class:"heading"},null===(t=null===(e=this.translator)||void 0===e?void 0:e.customPrint)||void 0===t?void 0:t.resultSettingsLabel1),this.visibleElems.indexOf("fileOptions")<0?null:(0,r.h)("file-option-chooser",{fileOption:this.mergeFiles,onFileOptionChange:e=>{this.fileOptChangeHandler(e)}}),this.visibleElems.indexOf("reportName")<0?null:(0,r.h)("calcite-label",{"aria-label":null===(s=null===(i=this.translator)||void 0===i?void 0:i.customPrint)||void 0===s?void 0:s.saveToAGOItemName},null===(a=null===(o=this.translator)||void 0===o?void 0:o.customPrint)||void 0===a?void 0:a.saveToAGOItemName,(0,r.h)("calcite-input-text",{placeholder:null===(n=null===(l=this.translator)||void 0===l?void 0:l.customPrint)||void 0===n?void 0:n.saveToAGOItemName,value:this.fileName,onCalciteInputTextChange:e=>this.fileNameChangeHandler(e)})),this.visibleElems.indexOf("saveToAGSAccount")<0?null:(0,r.h)(r.F,null,(0,r.h)("div",{class:"folder-label"},(0,r.h)("span",null,null===(h=null===(c=this.translator)||void 0===c?void 0:c.customPrint)||void 0===h?void 0:h.saveToAGOFolder),(0,r.h)("calcite-dropdown",{width:"l",scale:"m","aria-haspopup":"true",type:"click","width-scale":"l",onClick:e=>e.stopPropagation()},(0,r.h)("calcite-button",{slot:"trigger","aria-label":null===(u=null===(d=this.translator)||void 0===d?void 0:d.customPrint)||void 0===u?void 0:u.nameConflictOptLabel,"aria-description":null===(p=null===(m=this.translator)||void 0===m?void 0:m.customPrint)||void 0===p?void 0:p.nameConflictOptTip,"icon-start":"gear",appearance:"transparent"}),(0,r.h)("calcite-dropdown-group",null,(0,r.h)("calcite-label",{layout:"inline",class:"conflict-name-title"},null===(g=null===(v=this.translator)||void 0===v?void 0:v.customPrint)||void 0===g?void 0:g.nameConflictOptLabel,(0,r.h)("calcite-icon",{id:"info-icon",icon:"question",scale:"s"}," "),(0,r.h)("calcite-tooltip",{label:null===(b=null===(f=this.translator)||void 0===f?void 0:f.customPrint)||void 0===b?void 0:b.nameConflictOptTip,"reference-element":"info-icon"},(0,r.h)("span",null,null===(P=null===(C=this.translator)||void 0===C?void 0:C.customPrint)||void 0===P?void 0:P.nameConflictOptTip))),(0,r.h)("calcite-dropdown-item",{selected:"rename"==this.conflictBehavior,onCalciteDropdownItemSelect:()=>this.changeConflictBehavior("rename")},null===(I=null===(S=this.translator)||void 0===S?void 0:S.customPrint)||void 0===I?void 0:I.nameConflictOptRename),(0,r.h)("calcite-dropdown-item",{selected:"replace"==this.conflictBehavior,onCalciteDropdownItemSelect:()=>this.changeConflictBehavior("replace")},null===(y=null===(T=this.translator)||void 0===T?void 0:T.customPrint)||void 0===y?void 0:y.nameConflictOptReplace),(0,r.h)("calcite-dropdown-item",{selected:"fail"==this.conflictBehavior,onCalciteDropdownItemSelect:()=>this.changeConflictBehavior("fail")},null===(k=null===(w=this.translator)||void 0===w?void 0:w.customPrint)||void 0===k?void 0:k.nameConflictOptSkip)))),(0,r.h)("calcite-label",null,(0,r.h)("calcite-combobox",{id:"folder-selector","aria-label":null===(F=null===(x=this.translator)||void 0===x?void 0:x.customPrint)||void 0===F?void 0:F.saveToAGOFolder,disabled:!1===this.helperObj.canCreateItem,placeholder:null===(O=null===(j=this.translator)||void 0===j?void 0:j.customPrint)||void 0===O?void 0:O.saveToAGOFolder,"selection-mode":"single-persist",clearDisabled:"true",maxItems:"7",value:this.selectedFolderId,onCalciteComboboxChange:e=>{this.selectedFolderIdChangeHandler(e)}},(this.folders||[]).map((e=>(0,r.h)("calcite-combobox-item",{value:e.value,"text-label":e.label,selected:e.value===this.selectedFolderId})))),!1===this.helperObj.canCreateItem?(0,r.h)("calcite-tooltip",{label:this.langReport.saveToAGONoCreatePrivilegeTip,"reference-element":"folder-selector"},(0,r.h)("span",null,this.langReport.saveToAGONoCreatePrivilegeTip)):"")),this.visibleElems.indexOf("outputFormat")<0?null:(0,r.h)("calcite-label",null,null===(R=null===(N=this.translator)||void 0===N?void 0:N.customPrint)||void 0===R?void 0:R.outputFormat,(0,r.h)("calcite-combobox",{"aria-label":null===(E=null===(L=this.translator)||void 0===L?void 0:L.customPrint)||void 0===E?void 0:E.outputFormat,"selection-mode":"single-persist",clearDisabled:"true",value:this.outputFormat,onCalciteComboboxChange:e=>this.outputFormatChangeHandler(e)},(0,r.h)("calcite-combobox-item",{value:"docx",selected:"docx"===this.outputFormat,"text-label":null===(J=null===(H=this.translator)||void 0===H?void 0:H.customPrint)||void 0===J?void 0:J.outputFormatDocx}),(0,r.h)("calcite-combobox-item",{value:"pdf",selected:"pdf"===this.outputFormat,"text-label":null===(B=null===(M=this.translator)||void 0===M?void 0:M.customPrint)||void 0===B?void 0:B.outputFormatPdf}))),(0,r.h)("slot",{key:"5c93e8fb653d1581e8258b2c813ac9eabaf705a5"}))}static get watchers(){return{fileName:["onFileNameChange"]}}};d.style=":host{display:block;padding:0 0.75rem}:host .heading{margin-inline:0px;margin-block:1.25rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}:host .folder-label{display:flex;justify-content:space-between;align-items:center}:host .conflict-name-title{padding:0.75rem 0.75rem 0 0.75rem;margin-block-end:-1px;display:block;cursor:default;overflow-wrap:break-word;border-width:0px;border-block-end-width:1px;border-style:solid;font-weight:var(--calcite-font-weight-bold);border-color:var(--calcite-dropdown-group-border-color, var(--calcite-color-border-3));color:var(--calcite-dropdown-group-title-text-color);line-height:1rem}:host :dir(rtl) #info-icon{transform:scale(-1, 1) !important}";const u=class{constructor(e){(0,r.r)(this,e),this.goBackClicked=(0,r.c)(this,"goBackClicked",7),this.recentTasksCount=10,this.reportService=o.R.getService(),this.stateService=l.S.getService(),this.utilService=a.U.getService(),this.langReport=void 0,this.langCommon=void 0,this.langTasks=void 0,this.state="loading",this.jobs=void 0}componentWillLoad(){this.state="loading",Promise.resolve(!0).then((()=>{var e;const t=s.T.getService().getTranslateSync();return this.langReport=null==t?void 0:t.customPrint,this.langCommon=null==t?void 0:t.common,this.langTasks=null==t?void 0:t.customPrint.recentTasks,this.stateService.subscribe("locale-data-changed",(e=>{this.langReport=null==e?void 0:e.customPrint,this.langCommon=null==e?void 0:e.common,this.langTasks=null==e?void 0:e.customPrint.recentTasks})),(null===(e=this.jobs)||void 0===e?void 0:e.length)?{jobs:this.jobs}:this.reportService.queryJobs(!0)})).then((e=>{this.jobList=e})).catch((()=>{})).finally((()=>{var e;return this.jobs=(null===(e=this.jobList)||void 0===e?void 0:e.jobs)||[],this.state="ready",this.jobList}))}jobSplitDate(e,t){if(!this.jobs||t<0||t>=this.jobs.length||!e)return null;const i=this.utilService.formatDateTime(e.submitted,"date");if(0===t)return i;if(this.jobs[t-1]){return this.utilService.formatDateTime(this.jobs[t-1].submitted,"date")===i?null:i}return null}goBack(){this.goBackClicked.emit()}removeJob(e){const t=e.detail;if(this.jobs){const e=this.jobs.findIndex((e=>e.jobId===t.jobId));this.jobs.splice(e,1),this.jobs=[].concat(this.jobs)}}render(){var e,t;return(0,r.h)(r.H,{key:"6fc413f64e9a7a8fd9e31ee979d853f4b8465414"},(0,r.h)("div",{key:"8a460aabdf393c4ff6cb7e26a2b500e926b5927e",class:"banner"},(0,r.h)("calcite-action",{key:"8b396661d3fc6292e94419313597f994c3f1ec31",onClick:()=>this.goBack(),text:null===(e=this.langTasks)||void 0===e?void 0:e.label,icon:"chevrons-left","text-enabled":!0})),"ready"===this.state&&this.langReport&&this.langCommon&&this.langTasks&&this.jobs?(0,r.h)("div",{class:"list"},this.jobs.length<1?(0,r.h)("div",{class:"no-tasks"},this.langTasks.noTaskDesc):"",this.jobs.length?(0,r.h)(r.F,null,(0,r.h)("div",{class:"no-tasks"},this.langTasks.limitationDesc.replace("${$maxJobCount}",`${this.recentTasksCount}`)),(0,r.h)("ul",null,this.jobs.map(((e,t)=>(0,r.h)("li",{key:"li_"+e.jobId},this.jobSplitDate(e,t)?(0,r.h)("p",{class:"job-date"},this.jobSplitDate(e,t)):"",(0,r.h)("task-info",{key:e.jobId,job:e,onJobRemoved:e=>this.removeJob(e)})))))):""):(0,r.h)("div",{class:"loading"},(0,r.h)("calcite-loader",{label:null===(t=this.langCommon)||void 0===t?void 0:t.loading})),(0,r.h)("slot",{key:"217acda200bf79856bd3a99e1a975f0b8c9c2b1a"}))}};u.style=":host{display:block}:host *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}:host *{font-size:14px}:host .banner{cursor:pointer;font-weight:700;line-height:60px}:host .banner a{cursor:pointer;float:inline-start;transform:rotateZ(180deg);top:16px}:host .banner span{float:inline-start;padding-left:10px}:host .no-tasks{margin-bottom:20px}:host .list{height:calc(100% - 60px);padding:0 0.75rem;width:100%}:host .list ul{padding-left:0}:host .list ul li{list-style:none;margin-bottom:15px;border-radius:2px}:host .list p.job-date{color:#979797;line-height:40px;margin-bottom:0}:host-context([dir=rtl]) .banner a{transform:none !important}:host-context([dir=rtl]) .banner span{padding-right:10px;padding-left:unset !important}:host-context([dir=rtl]) list ul{padding-right:0;padding-left:unset !important}";const m=class{constructor(e){(0,r.r)(this,e),this.selectedTemplateChange=(0,r.c)(this,"selectedTemplateChange",7),this.reportService=o.R.getService(),this.stateService=l.S.getService(),this.langObj=void 0,this.selectedTemplateId=void 0,this.templateIds=void 0,this.surveyItemId=void 0,this.templates=[],this.translator=void 0}selectedTemplateIdChanged(){this.reportService.setParamCache({templateItemId:this.selectedTemplateId})}templateIdsChanged(){this.init()}surveyItemIdChanged(){this.init()}async reload(){this.init(!0)}componentWillLoad(){return this.reportService.setParamCache({templateItemId:this.selectedTemplateId}),Promise.resolve(!0).then((()=>{const e=s.T.getService().getTranslateSync();return this.translator=e,this.stateService.subscribe("locale-data-changed",(e=>{this.translator=e})),this.init()}))}init(e){const t=s.P,i=o.R.getService();return Promise.resolve(!0).then((()=>void 0===this.templateIds?i.getReportTemplates(t.surveyItemId,{isForce:e}):i.getReportTemplates(t.surveyItemId,{templateIds:this.templateIds,isForce:e}))).then((e=>(this.templates=e,this.stateService.notifyDataChanged("print-templates-updated",{value:e}),this.reportService.setHelperObj({printTemplates:e}),!this.selectedTemplateId&&e.length&&(this.selectedTemplateId=e[0].id,this.reportService.setParamCache({templateItemId:this.selectedTemplateId}),this.selectedTemplateChange.emit(this.selectedTemplateId)),!0))).catch((e=>{this.reportService.showError(e)}))}selectedTemplateChangeHandler(e){this.reportService.setParamCache({templateItemId:e.target.value}),this.selectedTemplateChange.emit(e.target.value)}render(){var e,t,i,s;return(0,r.h)(r.H,{key:"cecb24b5002acbcb9341a9a8e7b825a2afc7f689"},(0,r.h)("div",{key:"5af30c09981880f1d3ebd62555d88657fd33754f",class:"heading"},null===(e=this.translator)||void 0===e?void 0:e.customPrint.chooseTemplateLabel1),(0,r.h)("calcite-combobox",{key:"003f4518bb6bb5b77080c4b3196d6213e8548228","aria-label":null===(t=this.translator)||void 0===t?void 0:t.customPrint.chooseTemplateLabel1,placeholder:null===(i=this.translator)||void 0===i?void 0:i.customPrint.chooseTemplateLabel1,"selection-mode":"single-persist",clearDisabled:"true",value:this.selectedTemplateId,onCalciteComboboxChange:e=>{this.selectedTemplateChangeHandler(e)}},(this.templates||[]).map((e=>(0,r.h)("calcite-combobox-item",{value:e.id,"text-label":e.title,selected:e.id===this.selectedTemplateId})))),(this.templates||[]).length>0?null:(0,r.h)("calcite-notice",{open:!0,kind:"danger",scale:"s",width:"auto"},(0,r.h)("div",{slot:"message"},null===(s=this.translator)||void 0===s?void 0:s.customPrint.chooseTemplateNoOneYet1)),(0,r.h)("slot",{key:"3f66d6f1dc19d00ef9f9ea25996415b84a09702b"}))}get element(){return(0,r.g)(this)}static get watchers(){return{selectedTemplateId:["selectedTemplateIdChanged"],templateIds:["templateIdsChanged"],surveyItemId:["surveyItemIdChanged"]}}};m.style=":host{display:block;padding:0 0.75rem}:host calcite-notice{margin-top:6px}:host .heading{margin-inline:0px;margin-block:1.25rem 1rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}"}}]);