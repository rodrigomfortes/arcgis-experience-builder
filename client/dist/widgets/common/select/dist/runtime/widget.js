System.register(["jimu-core","jimu-ui","jimu-ui/basic/sql-expression-runtime","jimu-theme","jimu-arcgis"],(function(e,t){var a={},n={},o={},s={},r={};return{setters:[function(e){a.CONSTANTS=e.CONSTANTS,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceSelectionMode=e.DataSourceSelectionMode,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JSAPILayerTypes=e.JSAPILayerTypes,a.MessageManager=e.MessageManager,a.QueryScope=e.QueryScope,a.React=e.React,a.ReactDOM=e.ReactDOM,a.SqlExpressionMode=e.SqlExpressionMode,a.WidgetState=e.WidgetState,a.WidgetVersionManager=e.WidgetVersionManager,a.appActions=e.appActions,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.defaultMessages=e.defaultMessages,a.focusElementInKeyboardMode=e.focusElementInKeyboardMode,a.geometryUtils=e.geometryUtils,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,a.moduleLoader=e.moduleLoader,a.observeStore=e.observeStore,a.utils=e.utils,a.uuidv1=e.uuidv1},function(e){n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.DataActionList=e.DataActionList,n.DataActionListStyle=e.DataActionListStyle,n.Dropdown=e.Dropdown,n.DropdownButton=e.DropdownButton,n.DropdownItem=e.DropdownItem,n.DropdownMenu=e.DropdownMenu,n.Label=e.Label,n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.NumericInput=e.NumericInput,n.Progress=e.Progress,n.SVG=e.SVG,n.Select=e.Select,n.Switch=e.Switch,n.WidgetPlaceholder=e.WidgetPlaceholder,n.defaultMessages=e.defaultMessages},function(e){o.SqlExpressionRuntime=e.SqlExpressionRuntime,o.getShownClauseNumberByExpression=e.getShownClauseNumberByExpression},function(e){s.useTheme=e.useTheme},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=s},4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},9155:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M14 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0M.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},13424:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path stroke="#000" d="M1 3.5h5M1 9.5h14M1 14.5h14M14 3.5H9l2.5 3z"></path></svg>'},14321:e=>{"use strict";e.exports=n},14907:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 5.5C16 2.462 13.456 0 10.318 0 7.933 0 5.828 1.435 5 3.56l.886.323.078-.187c.737-1.667 2.438-2.78 4.354-2.78 2.615 0 4.735 2.053 4.735 4.584s-2.12 4.583-4.735 4.583c-.98 0-1.915-.288-2.703-.82l-.54.753.22.142a5.8 5.8 0 0 0 3.023.842C13.456 11 16 8.538 16 5.5M.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},25813:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.95 3a2.5 2.5 0 0 1-4.9 0H.5a.5.5 0 0 1 0-1h3.55a2.5 2.5 0 0 1 4.9 0h6.55a.5.5 0 0 1 0 1zM6.5 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m7.45 4.5a2.5 2.5 0 0 1-4.9 0H.5a.5.5 0 0 1 0-1h8.55a2.5 2.5 0 0 1 4.9 0h1.55a.5.5 0 0 1 0 1zm-2.45 1a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m-7 6.5a2.5 2.5 0 0 0 2.45-2h8.55a.5.5 0 0 0 0-1H6.95a2.5 2.5 0 0 0-4.9 0H.5a.5.5 0 0 0 0 1h1.55a2.5 2.5 0 0 0 2.45 2M3 13.5a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0" clip-rule="evenodd"></path></svg>'},31579:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 11V0L6 2.982v2.162h.91l-.001-1.49 8.182-2.44v8.882H8.434V11zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},32772:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M19.5 0H6v4.5h1V1h5v5.133l3.638 6.367H11.3v1h8.2zm-2.71 12.5h1.71V7.022l-3.35 2.606zM14.648 8.75 18.5 5.755V1H13v4.867z" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M11.89 10.006 1 4.165v12.318l2.897-3.357 3.401 6.517 3.367-1.95-3.426-6.564zM2 13.793V5.837l7.11 3.813-3.35.808 3.575 6.85-1.633.947-3.6-6.897z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},56509:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m10.308.302-.589.808 3.84 2.796L9 6.555l5.013 3.736.597-.801-3.796-2.832 4.576-2.657zM.25 3l8.642 4.969-3.423.738 2.724 5.45-2.887 1.667-2.724-5.45-2.35 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},60882:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M16 11V0H5v3.5h1V1h9v9H8.5v1zM.25 3l8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.91 5.771 1.154-.667-2.91-5.77 2.222-.48z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=r},66364:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOC44OTIxOSA3Ljk2ODU2TDAuMjUwMDg4IDNMMC4yMzE5MzQgMTIuOTY4NkwyLjU4Mjk3IDEwLjM3NEw1LjMwNjcxIDE1LjgyMzdMOC4xOTM0NiAxNC4xNTdMNS40Njk3MiA4LjcwNzM0TDguODkyMTkgNy45Njg1NlpNMS4yMzYzMyAxMC4zNzAxTDEuMjQ2MzMgNC43MjYwN0w2LjEzOTMzIDcuNTM5MDdMMy45MTgwMyA4LjAxOTE5TDYuODI3MzMgMTMuNzkwMUw1LjY3MjMzIDE0LjQ1NzFMMi43NjMzMyA4LjY4NTg2TDEuMjM2MzMgMTAuMzcwMVoiIGZpbGw9ImJsYWNrIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTExIDAuNjg3NUw2IDMuNzgxMjVMMTEgNi44NzVMMTYgMy43ODEyNUwxMSAwLjY4NzVaTTE0LjcyNSA1LjgyNzYxTDE0LjM0NjMgNS41OTMxN0wxNC45ODM3IDUuMTk4NTVMMTYgNS44Mjc2MUwxMSA4LjkyMTM2TDYgNS44Mjc2MUw3LjAxNjg4IDUuMTk4NTVMNy42NTQzOCA1LjU5MzE3TDcuMjc1IDUuODI3NjFMMTEgOC4xMzI4TDE0LjcyNSA1LjgyNzYxWk0xNiA3Ljg5MDNMMTQuOTcwNiA3LjI1Mjk5TDE0LjMzMzEgNy42NDc2MkwxNC43MjUgNy44OTAzTDExIDEwLjE5NTVMNy4yNzUgNy44OTAzTDcuNjY3NSA3LjY0NzYyTDcuMDMgNy4yNTI5OUw2IDcuODkwM0wxMSAxMC45ODQxTDE2IDcuODkwM1pNMTEgMS40NzcwNUw3LjI3NTAyIDMuNzgxNTVMMTEgNi4wODY3NEwxNC43MjUgMy43ODE1NUwxMSAxLjQ3NzA1WiIgZmlsbD0iYmxhY2siLz4NCjwvc3ZnPg0K"},71690:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7 14v-1h2v1zM9 12v-1H7v1zM10 13h4v1h-4zM14 11h-4v1h4z"></path><path fill="#000" fill-rule="evenodd" d="M15 6a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zM6 9V7h9v2zm9 6v-5H6v5zM0 10.5V12a1 1 0 0 0 1 1h1.5v-1H1v-1.5zM2.5 1H1a1 1 0 0 0-1 1v1.5h1V2h1.5zM0 8.5h1v-3H0zM4.5 1v1h3V1zm5 0v1H11v1.5h1V2a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>'},76117:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=a},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'}},t={};function i(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var c={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(c),i.d(c,{__set_webpack_public_path__:()=>Ze,default:()=>Ke});var e=i(79244),t=i(14321),a=i(45508),n=i.n(a),o=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const s=t=>{const a=window.SVG,{className:s}=t,r=o(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",s);return a?e.React.createElement(a,Object.assign({className:i,src:n()},r)):e.React.createElement("svg",Object.assign({className:i},r))},r={_widgetLabel:"Select",selectByData:"Select by data",selectingFeatures:"Selecting features",bufferUnit:"Buffer unit",selectByLocationFeatureCountTip:"There are {count} features inside this data.",attributeFilterBatchOnTip:"Apply all attribution for active layers",attributeFilterBatchOffTip:"Remove all attribution for active layers",batchLayerSelectableStatus:"Control layers' selectable status",allSelectable:"All selectable",noneSelectable:"None selectable",buildCustomSQL:"Build custom SQL",customSQL:"Custom SQL",selectWidgetSelection:"{layerName} select widget selection",noLayersAvailableTip:"No layers are available to select.",openSettingPanelTip:"Please open the widget setting panel to update the configurations."};var l;!function(e){e.Intersects="Intersects",e.Contains="Contains",e.Crosses="Crosses",e.EnvelopeIntersects="EnvelopeIntersects",e.IndexIntersects="IndexIntersects",e.Overlaps="Overlaps",e.Touches="Touches",e.Within="Within"}(l||(l={}));const u={[l.Intersects]:"esriSpatialRelIntersects",[l.Contains]:"esriSpatialRelContains",[l.Crosses]:"esriSpatialRelCrosses",[l.EnvelopeIntersects]:"esriSpatialRelEnvelopeIntersects",[l.IndexIntersects]:"esriSpatialRelIndexIntersects",[l.Overlaps]:"esriSpatialRelOverlaps",[l.Touches]:"esriSpatialRelTouches",[l.Within]:"esriSpatialRelWithin"},d={[l.Intersects]:"spatialRelation_Intersect",[l.Contains]:"spatialRelation_Contain",[l.Crosses]:"spatialRelation_Cross",[l.EnvelopeIntersects]:"spatialRelation_EnvelopeIntersect",[l.IndexIntersects]:"spatialRelation_IndexIntersect",[l.Overlaps]:"spatialRelation_Overlap",[l.Touches]:"spatialRelation_Touch",[l.Within]:"spatialRelation_Within"};var p;!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(p||(p={}));const m={[p.Miles]:"miles",[p.Kilometers]:"kilometers",[p.Feet]:"feet",[p.Meters]:"meters",[p.NauticalMiles]:"nautical-miles"};var f;!function(e){e.Point="point",e.Polyline="polyline",e.Rectangle="rectangle",e.Circle="circle",e.Polygon="polygon"}(f||(f={}));var g,S=i(76117);function y(e,t,a,n){const o={};return a.forEach((a=>{const s=a.uid;if(n[s])return;const r=a.sqlExpression,i=I(t,r),c=j(null),l=D(""),u={uid:s,displayTitle:"",dataSource:null,jimuLayerView:null,supportCustomSQLBuilder:t,shouldRenderFilterIcon:i,imDisplaySqlExpression:r,checked:!e,isSelecting:!1,latestSelectTaskInfo:{version:0,selectionMode:null,appliedGeometryInfo:c,appliedSql:l},isAttributeFilterOn:!1,tryExecuteSelectingByGeometryInfoAndSqlUI:null,enableAttributeFilter:null,clearSelection:null};o[s]=u})),o}function h(t,a){const n=(0,e.uuidv1)(),o=t.id;let s=o;const r=t.getMainDataSource();r&&(s=r.id);const i={uid:n,sqlHint:"",sqlExpression:null,useDataSource:{dataSourceId:o,mainDataSourceId:s},jimuLayerViewId:a};return(0,e.Immutable)(i)}function v(e,t){const a=function(e,t){const a=[];return e.forEach((e=>{const n=e.uid,o=t[n];o&&a.push({dataSourceItem:e,runtimeInfo:o})})),a}(e,t),n=[];return a.forEach((e=>{const{dataSourceItem:t,runtimeInfo:a}=e;t&&a&&a.displayTitle&&(t.jimuLayerViewId?a.jimuLayerView&&n.push(a):a.dataSource&&n.push(a))})),n}function w(e,t){return v(e,t).filter((e=>e.checked))}function b(e,t){return v(e,t).filter((e=>e.checked&&!e.isSelecting))}function I(e,t){let a=!1;return e?a=!0:t&&(a=!!D(t.sql)||R(e,t)),a}function R(e,t){let a=!1;return!e&&t&&(a=(0,S.getShownClauseNumberByExpression)(t)>0),a}function M(t,a,n){let o="";if(t&&a&&n){const t=e.dataSourceUtils.getArcGISSQL(a,n);t&&(o=t.sql)}return D(o)}function x(e){return"number"==typeof e&&e>0}function D(e){let t=e||"";return"1=1"===t&&(t=""),t}function j(e){return void 0===e?null:e}!function(e){e.Placeholder="Placeholder",e.Loading="Loading",e.NoLayersTip="NoLayersTip",e.Normal="Normal"}(g||(g={}));const N=[e.DataSourceTypes.FeatureLayer,e.DataSourceTypes.SceneLayer,e.DataSourceTypes.BuildingComponentSubLayer,e.DataSourceTypes.OrientedImageryLayer,e.DataSourceTypes.ImageryLayer,e.DataSourceTypes.SubtypeGroupLayer,e.DataSourceTypes.SubtypeSublayer];(0,e.Immutable)(N);function L(e){return N.includes(e)}const C=[e.JSAPILayerTypes.FeatureLayer,e.JSAPILayerTypes.SceneLayer,e.JSAPILayerTypes.BuildingComponentSublayer,e.JSAPILayerTypes.OrientedImageryLayer,e.JSAPILayerTypes.ImageryLayer,e.JSAPILayerTypes.SubtypeGroupLayer,e.JSAPILayerTypes.SubtypeSublayer];function k(t){if(!t||!t.type)return!1;const a=t.type,n=a!==e.JSAPILayerTypes.BuildingComponentSublayer||a===e.JSAPILayerTypes.BuildingComponentSublayer&&t.view;return!!(C.includes(a)&&n)}function T(e,t){return!e&&t}function E(e,t){const a=t.slice();return e&&a.sort(((t,a)=>{const n=O(e,t),o=O(e,a);return n&&o?function(e,t){const a=e.split(".").map((e=>parseInt(e))),n=t.split(".").map((e=>parseInt(e)));for(;a.length>0&&n.length>0;){const e=a.shift(),t=n.shift();if(e<t)return-1;if(e>t)return 1}if(a.length>0)return 1;if(n.length>0)return-1;return 0}(n,o):0})),a}function O(e,t){let a="";if(e&&t){const n=t.jimuLayerViewId;if(n){const t=e.jimuLayerViews[n];t&&(a=t.hierarchyLevel)}}return a}function A(t){var a;if(!t)return null;const n=function(){var t,a,n;return window.jimuConfig.isBuilder?null===(a=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(n=(0,e.getAppStore)().getState())||void 0===n?void 0:n.appConfig}();return null===(a=null==n?void 0:n.widgets)||void 0===a?void 0:a[t]}var V=i(60882),P=i.n(V),z=i(31579),B=i.n(z),F=i(14907),U=i.n(F),G=i(56509),W=i.n(G),J=i(9155),q=i.n(J),H=i(66364),$=i.n(H),_=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};const Y=e.css`
  overflow: hidden;
  border-bottom: 1px solid var(--ref-palette-neutral-400);

  .dropdown-btn-container {
    position: relative;
    float: left;

    .api-modules-loading-progress {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      width: 100%;
      background-color: rgba(110,110,110,0.3);
      animation: esri-fade-in 500ms ease-in-out;
    }

    .api-modules-loading-progress:after {
      position: absolute;
      width: 20%;
      height: 2px;
      top: 0;
      content: "";
      opacity: 1;
      z-index: 0;
      background-color: var(--sys-color-primary-main);
      animation: looping-progresss-bar-ani 1500ms linear infinite;
      transition: opacity 500ms ease-in-out;
    }
  }

  .render-dropdown {
    .selected-tool-btn {
      border-right: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    .select-dropdown-btn {
      font-size: 14px;
      border-left: 0;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      padding-left: 6px;
      padding-right: 6px;
    }
  }

  .clear-all-btn {
    float: right;
  }
`,Q="data",K={polygon:{mode:"hybrid"}},Z={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},X={tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},ee={style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};function te(a){var n,o;const{config:s,widgetId:i,mapWidgetId:c,autoControlWidgetId:l,widgetState:u,activeJimuMapView:d,setSelectByLocationVisible:p,allImDataSourceItems:m,dataSourceItemRuntimeInfoMap:g}=a,{useMap:S,interactiveTools:y,spatialSelection:h}=s,w=null==h?void 0:h.enable,I=e.hooks.useTranslation(t.defaultMessages,r),R=e.React.useRef(!1),[M,x]=e.React.useState(null),D=e.React.useRef(null);D.current=d;const[j,N]=e.React.useState(null),L=e.React.useMemo((()=>(null==j?void 0:j.view)||null),[j]),C=e.React.useRef(null),[k,E]=e.React.useState(!1),O=e.React.useRef(!1);O.current=k;const[A,V]=e.React.useState(!1),z=e.React.useRef([]),F=e.React.useRef(null),G=e.React.useRef(null),J=e.React.useRef("macOS"===(null===(o=null===(n=window.jimuUA)||void 0===n?void 0:n.os)||void 0===o?void 0:o.name)),H=!(!M||!L),te=null==s?void 0:s.mapInfo,oe=null==d?void 0:d.id,se=e.React.useMemo((()=>{let e=!1;if(oe&&te){const t=te[oe];e=!!t&&T(t.syncWithMap,t.enableAttributeSelection)}return e}),[te,oe]),re=e.React.useMemo((()=>{let e="esriSpatialRelIntersects";return y&&!1===y.partiallyWithin&&(e="esriSpatialRelContains"),e}),[y]),ie=e.React.useMemo((()=>v(m,g)),[m,g]),ce=e.React.useMemo((()=>b(m,g)),[m,g]),le=e.React.useMemo((()=>({[f.Rectangle]:{order:1,label:I("SelectionByRectangle"),iconSrc:P()},[f.Polygon]:{order:2,label:I("SelectionByLasso"),iconSrc:B()},[f.Circle]:{order:3,label:I("SelectionByCircle"),iconSrc:U()},[f.Polyline]:{order:4,label:I("SelectionByLine"),iconSrc:W()},[f.Point]:{order:5,label:I("SelectionByPoint"),iconSrc:q()},[Q]:{order:6,label:I("selectByData"),iconSrc:$()}})),[I]),ue=e.React.useMemo((()=>{const e=[];return S&&y&&y.tools&&y.tools.length>0&&y.tools.forEach((t=>{e.push(t)})),w&&e.push(Q),e.sort(((e,t)=>le[e].order-le[t].order)),e}),[y,w,le,S]),[de,pe]=e.React.useState(ue[0]),me=e.React.useRef();me.current=de;const fe=e.React.useMemo((()=>ue.filter((e=>e!==Q)).length>0),[ue]),ge=fe&&!M,Se=e.React.useMemo((()=>{let e="";if(de){const t=le[de];t&&(e=t.iconSrc)}return e}),[le,de]),ye=e.React.useCallback((e=>e!==Q&&!H),[H]),he=e.React.useMemo((()=>{const a=[];return ue.forEach((n=>{n===Q&&ue.length>=2&&a.push((0,e.jsx)(t.DropdownItem,{key:"divider",divider:!0}));const o=n===de,s=le[n].iconSrc,r=ye(n),i=(0,e.jsx)(t.DropdownItem,{key:n,active:o,disabled:r,onClick:()=>{pe(n)}},(0,e.jsx)(t.SVG,{src:s,className:"mr-2"}),le[n].label);a.push(i)})),a}),[ue,de,le,ye]);e.React.useEffect((()=>{const e=J.current,t=t=>{"Shift"===t.key?F.current={eventDate:new Date,isKeyDown:!0}:(e&&"Meta"===t.key||!e&&"Control"===t.key)&&(G.current={eventDate:new Date,isKeyDown:!0})},a=t=>{"Shift"===t.key?F.current={eventDate:new Date,isKeyDown:!1}:(e&&"Meta"===t.key||!e&&"Control"===t.key)&&(G.current={eventDate:new Date,isKeyDown:!1})};return document.addEventListener("keydown",t,!0),document.addEventListener("keyup",a,!0),()=>{document.removeEventListener("keydown",t,!0),document.removeEventListener("keyup",a,!0)}}),[]),e.React.useEffect((()=>{const e=D.current;e&&e!==j&&e.whenJimuMapViewLoaded().then((()=>{e===D.current&&N(e)}))}),[d,j]),e.React.useEffect((()=>{!fe||M||R.current||(R.current=!0,(0,e.loadArcGISJSAPIModules)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/symbols/support/jsonUtils","esri/views/2d/interactive/editingTools","esri/views/3d/interactive/editingTools","esri/views/2d/layers/GraphicsLayerView2D","esri/views/3d/layers/GraphicsLayerView3D"]).then((e=>{const[t,a,n]=e;x({SketchViewModel:t,GraphicsLayer:a,jsonUtils:n})})).catch((e=>{console.error("select widget loads api error",e)})))}),[M,R,fe]);const ve=e.React.useMemo((()=>de&&de!==Q?de:null),[de]),we=e.React.useMemo((()=>k&&de&&de!==Q?de:null),[k,de]);e.React.useEffect((()=>{if(u===e.WidgetState.Closed){const e=me.current;O.current&&e&&"data"!==e&&E(!1)}}),[u]),e.hooks.useEffectWithPreviousValues((t=>{const[a,n]=t;if(i){if(we!==a&&c)if(we&&l!==i){const t=e.appActions.requestAutoControlMapWidget(c,i);(0,e.getAppStore)().dispatch(t)}else if(!we&&l===i){const t=e.appActions.releaseAutoControlMapWidget(c);(0,e.getAppStore)().dispatch(t)}l!==n&&l!==i&&we&&E(!1)}}),[we,l,i]),e.React.useEffect((()=>{if(de&&!ue.includes(de)){const e=ue.length>0?ue[0]:null;pe(e),E(!1)}else if(!de&&ue.length>0){const e=ue[0];pe(e),E(!1)}}),[ue,de]);const be=!(!S||se||!ve),Ie=e.hooks.usePrevious(we),Re=e.React.useRef(null),Me=e.React.useCallback(((t,a,n)=>{a?a.geometry?(be||(n=e.DataSourceSelectionMode.New),function(){_(this,void 0,void 0,(function*(){let o=a.geometry;try{if("point"===o.type||"polyline"===o.type){const a=10*(null==t?void 0:t.resolution);if(a>0){const t=yield e.geometryUtils.createBuffer(o,[a],"meters");t&&(o=t)}}}catch(e){console.error("geometryUtils.createBuffer() error of Select widget",e)}const s=e.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(o.type),r={geometry:o.toJSON(),geometryType:s,spatialRel:re};z.current=ce;(z.current||[]).forEach((e=>{e.tryExecuteSelectingByGeometryInfoAndSqlUI(n,r)}))}))}()):console.log("sketch graphic.geometry is null"):console.log("sketch graphic is null")}),[be,re,ce]);Re.current=Me,e.React.useEffect((()=>{const t=C.current;let a=t;if(t){let e=!1;if(we)if(Ie===we){const a=L||null,n=t.view||null;e=!a||a!==n}else e=!0;else e=!0;e&&(t&&ne(t),a=null)}const n=()=>{const e=C.current;if(e&&we){const t=K[we];t?e.create(we,t):e.create(we)}};if(M&&L&&we&&!a){const t=L.on("key-down",(e=>{"Shift"===e.key&&e.stopPropagation()})),o=L.on("key-up",(e=>{"Shift"===e.key&&e.stopPropagation()})),{SketchViewModel:s,GraphicsLayer:r,jsonUtils:i}=M,c=new r;a=new s({view:L,layer:c,pointSymbol:i.fromJSON(Z),polylineSymbol:i.fromJSON(X),polygonSymbol:i.fromJSON(ee)}),a.viewKeyDownHandle=t,a.viewKeyUpHandle=o,a.on("create",(t=>{if("complete"===t.state&&(n(),Re.current)){const n=t.graphic,o=ae(F.current),s=ae(G.current);let r=e.DataSourceSelectionMode.New;r=o?s?e.DataSourceSelectionMode.SelectFromCurrent:e.DataSourceSelectionMode.AddToCurrent:s?e.DataSourceSelectionMode.RemoveFromCurrent:e.DataSourceSelectionMode.New,Re.current(a.view,n,r)}}))}C.current=a,n()}),[we,M,L,Ie]),e.React.useEffect((()=>{p(k&&de===Q)}),[k,de,p]),e.hooks.useUnmount((()=>{const e=C.current;e&&(ne(e),C.current=null)}));const xe=e.React.useMemo((()=>{let e="";if(de)if(de===Q)e=I("selectByData");else{let t="";t=de===f.Point?I("SelectionByPoint"):de===f.Rectangle?I("SelectionByRectangle"):de===f.Polygon?I("SelectionByLasso"):de===f.Circle?I("SelectionByCircle"):de===f.Polyline?I("SelectionByLine"):I("SelectLabel");const a=I("newSelection"),n=I("addToCurrentSelection"),o=I("removeFromCurrentSelection"),s=I("selectFromCurrentSelection"),r=I("drawShape"),i=I("draw"),c=J.current?"Cmd":"Ctrl",l=`\u2219 ${a} (${r})`;e=be?`${t}\n${l}\n${`\u2219 ${n} (Shift + ${i})`}\n${`\u2219 ${o} (${c} + ${i})`}\n${`\u2219 ${s} (Shift + ${c} + ${i})`}`:`${t}\n${l}`}return e}),[be,de,I]),De=e.React.useCallback((()=>{V((e=>!e))}),[V]),je=e.React.useCallback((()=>{E(!k)}),[k]),Ne=e.React.useCallback((()=>{ie.forEach((e=>{e.clearSelection&&e.clearSelection()}))}),[ie]),Le=he.length>=2;return(0,e.jsx)("div",{className:"w-100 p-4",css:Y},(0,e.jsx)("div",{className:(0,e.classNames)(["d-flex align-items-center dropdown-btn-container",{"render-dropdown":Le}])},de&&(0,e.jsx)(t.Button,{className:"selected-tool-btn",icon:!0,disabled:ye(de),type:k?"primary":"default",title:xe,"aria-label":xe,"aria-pressed":k,onClick:je},(0,e.jsx)(t.SVG,{src:Se})),Le&&(0,e.jsx)(t.Dropdown,{activeIcon:!0,isOpen:A,toggle:De,"aria-label":I("moreSelectionTools"),menuItemCheckMode:"singleCheck"},(0,e.jsx)(t.DropdownButton,{className:"select-dropdown-btn",type:A?"primary":"default"}),(0,e.jsx)(t.DropdownMenu,{alignment:"start",offsetOptions:4},he)),ge&&(0,e.jsx)("div",{className:"api-modules-loading-progress"})),(0,e.jsx)(t.Button,{title:I("drawToolClearBtn"),className:"pl-4 pr-4 nowrap clear-all-btn",type:"default",icon:!0,onClick:Ne},(0,e.jsx)("span",{className:"nowrap"},I("drawToolClearBtn"))))}function ae(e){if(e){if(e.isKeyDown)return!0;return Date.now()-e.eventDate.getTime()<=500}return!1}function ne(e){e&&(e.viewKeyDownHandle&&(e.viewKeyDownHandle.remove(),e.viewKeyDownHandle=null),e.viewKeyUpHandle&&(e.viewKeyUpHandle.remove(),e.viewKeyUpHandle=null),e.destroyed||e.destroy())}var oe=i(25813),se=i.n(oe),re=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const ie=t=>{const a=window.SVG,{className:n}=t,o=re(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:se()},o)):e.React.createElement("svg",Object.assign({className:s},o))};var ce=i(4583),le=i.n(ce),ue=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const de=t=>{const a=window.SVG,{className:n}=t,o=ue(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:le()},o)):e.React.createElement("svg",Object.assign({className:s},o))};var pe=i(71690),me=i.n(pe),fe=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const ge=t=>{const a=window.SVG,{className:n}=t,o=fe(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:me()},o)):e.React.createElement("svg",Object.assign({className:s},o))};var Se=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};class ye{constructor(e,t){this.ds=e,this.widgetId=t}clearSelection(){return Se(this,void 0,void 0,(function*(){const e=[];yield this.ds.selectRecords({widgetId:this.widgetId,records:e}),this.publishMessage(e)}))}selectRecords(t,a,n,o,s,r){return Se(this,void 0,void 0,(function*(){Object.values(a).includes(a)&&(a=e.DataSourceSelectionMode.New);let i=null;const c=this.widgetId,l=this.ds;if(a!==e.DataSourceSelectionMode.New||t.objectIds||t.geometry||t.where&&"1=1"!==t.where){const u=yield e.dataSourceUtils.selectBySelectionMode({widgetId:c,ds:l,query:t,selectionMode:a,signal:n,checkLayerVisibility:!1,jimuLayerView:o,progressCallback:s,updateSelectionIfAborted:r});u&&(i=u.records)}else i=[],l.selectRecords({widgetId:c,records:i});i&&this.publishMessage(i)}))}publishMessage(t){const a=new e.DataRecordsSelectionChangeMessage(this.widgetId,t,[this.ds.id]);e.MessageManager.getInstance().publishMessage(a)}}var he=i(96300),ve=i.n(he),we=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const be=t=>{const a=window.SVG,{className:n}=t,o=we(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:ve()},o)):e.React.createElement("svg",Object.assign({className:s},o))};var Ie=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};const Re=e.css`
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;

  .select-custom-sql-builder-header {
    padding: 16px;
  }

  .raw-sql-expression-builder {
    position: absolute;
    left: 16px;
    right: 16px;
    top: 53px;
    bottom: 16px;
    height: auto !important;
    overflow-x: auto;

    &.small-mode .sql-expression-builder .sql-expression-container {
      min-width: 240px;
    }
  }
`;function Me(a){const{isRTL:n,widgetId:o,widgetDomRef:s,dataSource:i,imSqlExpression:c,onBack:l}=a,u=null==s?void 0:s.current,d=e.hooks.useTranslation(t.defaultMessages,r),[p,m]=e.React.useState(null),[f,g]=e.React.useState(c),S=e.React.useCallback((()=>{l(f)}),[f,l]),y=e.React.useCallback((e=>{g(e)}),[g]);e.React.useEffect((()=>{!function(){Ie(this,void 0,void 0,(function*(){try{const t=yield e.moduleLoader.loadModules(["jimu-ui/advanced/sql-expression-builder"]);t&&t[0].SqlExpressionBuilder&&m(t[0].SqlExpressionBuilder)}catch(e){console.error("load SqlExpressionBuilder error",e)}}))}()}),[]);const h=e.React.useCallback((t=>{t&&(0,e.focusElementInKeyboardMode)(t)}),[]);return u?e.ReactDOM.createPortal((0,e.jsx)("div",{className:"select-custom-sql-builder surface-1 border-0",css:Re},(0,e.jsx)("div",{className:"select-custom-sql-builder-header"},(0,e.jsx)(t.Button,{type:"tertiary",size:"sm",icon:!0,ref:h,"aria-label":d("back"),onClick:S},(0,e.jsx)(be,{autoFlip:n})),(0,e.jsx)(t.Label,null,d("buildCustomSQL"))),p&&i&&(0,e.jsx)(p,{className:"raw-sql-expression-builder",dataSource:i,mode:e.SqlExpressionMode.Simple,widgetId:o,expression:f,noScrollForList:!0,queryScope:e.QueryScope.InRuntimeView,onChange:y})),u):null}var xe=i(1888);function De(a){const n="black",o=(0,xe.useTheme)(),s=e.React.useMemo((()=>e.css`
      display: inline-block;
      position: relative;
      width: 20px;
      height: 20px;
      background: transparent;

      .select-circle-progress {
        position: absolute;
        left: 0;
        top: 0;

        .jimu-circular-progress-track {
          stroke: ${n};
          opacity: 0.3;
        }

        .jimu-circular-progress-runner {
          stroke: ${n};
          transition: none !important;
        }
      }

      .progress-stop {
        position: absolute;
        width: 6px;
        height: 6px;
        left: 7px;
        top: 7px;
        background: ${n};
      }

      .progress-mask {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: transparent;
      }
    `),[n]),i=e.hooks.useTranslation(t.defaultMessages,r),c=100*a.progress,l=parseFloat(c.toFixed(2)),u=i("selectingFeaturesTip");return(0,e.jsx)("div",{css:s,onClick:a.onClick,className:"select-progress",title:u,"aria-label":u},(0,e.jsx)(t.Progress,{className:"select-circle-progress",color:o.ref.palette.neutral[200],type:"circular",value:l,circleSize:20}),(0,e.jsx)("div",{className:"progress-stop"}),(0,e.jsx)("div",{className:"progress-mask"}))}var je=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};function Ne(a){var n;const{isRTL:o,widgetId:s,widgetDomRef:i,enableDataAction:c,imDataSourceItem:l,itemRuntimeInfo:u,jimuMapView:d,updateDataSourceItemRuntimeInfoForUid:p,onDataRecordSetChange:m}=a,f=l.uid,g=l.useDataSource,y=l.sqlHint||"",h=l.sqlExpression,v=g.dataSourceId,w=l.jimuLayerViewId,b=u.displayTitle,N=u.dataSource,L=u.jimuLayerView,C=u.checked,k=u.imDisplaySqlExpression,T=(null===(n=u.latestSelectTaskInfo)||void 0===n?void 0:n.version)||0,E=u.shouldRenderFilterIcon,O=u.isAttributeFilterOn,A=u.isSelecting,V=u.supportCustomSQLBuilder,P=V,z=e.hooks.useTranslation(e.defaultMessages,t.defaultMessages,r),B=e.React.useId(),[F,U]=e.React.useState([]),G=F.length,W=e.React.useRef(null),[J,q]=e.React.useState(!1),[H,$]=e.React.useState(!1),_=e.React.useRef(u);_.current=u;const[Y,Q]=e.React.useState(0),K=e.React.useRef(null),Z=e.React.useRef(null),X=e.React.useRef(0),ee=e.React.useMemo((()=>R(V,h)),[V,h]),te=e.React.useMemo((()=>(V?z("customSQL"):y)||""),[y,V,z]),ae=e.React.useMemo((()=>{var t,a,n,o,s;let r=null;if(N&&F.length>0){const i=N.getLabel()||"",c=z("selectWidgetSelection",{layerName:i});r={dataSource:N,name:c,label:c,type:"selected",records:F};let l=!1;const u=N.getInfo&&(null===(a=null===(t=N.getInfo())||void 0===t?void 0:t.selectOptions)||void 0===a?void 0:a.widgetId);if(u){const t=null===(o=null===(n=(0,e.getAppStore)())||void 0===n?void 0:n.getState())||void 0===o?void 0:o.appConfig;if(t&&t.widgets){const e=t.widgets[u],a=null==e?void 0:e.uri;"widgets/arcgis/arcgis-map/"!==a&&"widgets/common/select/"!==a||(l=!0)}}const d=N.getAllUsedFields()||[];let p=[];if(L&&l){const e=L.view;e&&(null===(s=e.availableFields)||void 0===s?void 0:s.length)>0&&(p=e.availableFields.slice())}p||(p=[]);const m=N,f=m.getPopupInfoFields&&m.getPopupInfoFields()||[];let g=[].concat(d).concat(p).concat(f);if(g=Array.from(new Set(g)),g.includes("*")){g=g.filter((e=>"*"!==e));const e=N.getSchema();if(null==e?void 0:e.fields){const t=Object.keys(null==e?void 0:e.fields);t.length>0&&(g=t)}}g&&g.length>0&&(r.fields=g)}return r}),[N,L,F,z]),ne=e.React.useMemo((()=>ae?[ae]:[]),[ae]),[oe,se]=e.React.useState(!1),re=e.React.useMemo((()=>{const t=!w,a=x(T),n=E&&J&&ee,o=E&&J&&H,s=(null==L?void 0:L.type)===e.JSAPILayerTypes.SubtypeSublayer;return oe||t||a||n||o||s}),[H,J,oe,w,T,E,ee,L]),ce=e.React.useCallback((()=>je(this,void 0,void 0,(function*(){let t=N;if(!t){const a=e.DataSourceManager.getInstance();if(t=a.getDataSource(g.dataSourceId),!t)try{t=yield a.createDataSourceByUseDataSource(g)}catch(e){t=null,console.error("create data source error",g.dataSourceId,e)}t&&p(f,{dataSource:t})}return t}))),[N,f,p,g]),le=e.React.useCallback((()=>{var e,t;let a="";return N&&(a=N.getLabel()||(null===(e=N.getDataSourceJson())||void 0===e?void 0:e.sourceLabel)||""),a||L&&(a=null===(t=L.layer)||void 0===t?void 0:t.title),a||(a=""),a&&a!==b&&p(f,{displayTitle:a}),a}),[N,b,L,f,p]);e.React.useEffect((()=>{le()}),[le]),e.React.useEffect((()=>{if(!N){const t=e.DataSourceManager.getInstance().getDataSource(v);t&&p(f,{dataSource:t})}}),[N,v,f,p]),e.React.useEffect((()=>{re&&!N&&ce()}),[N,ce,re]),e.React.useEffect((()=>{if(w&&!L&&d&&0===w.indexOf(d.id)){function e(){return je(this,void 0,void 0,(function*(){let e=null;try{e=yield d.whenJimuLayerViewLoaded(w)}catch(t){e=null,console.error("jimuLayerViewLoaded error",w,t)}if(e){const t=e.isLayerVisible();p(f,{checked:t,jimuLayerView:e})}}))}e()}}),[L,w,d,f,p]),e.React.useEffect((()=>{m(f,ae)}),[ae,m,f]);const ue=e.React.useCallback(((t,a)=>{var n,o,r,i;let c=N;if(a){const l=(null===(n=null==t?void 0:t.selectedIds)||void 0===n?void 0:n.length)>0?null==t?void 0:t.selectedIds:null,u=(null===(o=a.selectedIds)||void 0===o?void 0:o.length)>0?a.selectedIds:null,d=(null===(r=a.selectOptions)||void 0===r?void 0:r.widgetId)||"";if(l!==u&&d!==s){const t=Z.current;if(t){const e=`Select widget: selection changed by other widget ${d}, abort current on-the-fly selecting task`;t.ignoreAbortedSelection=!0,t.abort(e)}const a={isAttributeFilterOn:!1};if(null===(i=_.current)||void 0===i?void 0:i.latestSelectTaskInfo){const t={version:_.current.latestSelectTaskInfo.version,selectionMode:e.DataSourceSelectionMode.New,appliedGeometryInfo:j(null),appliedSql:D("")};a.latestSelectTaskInfo=t}p(f,a)}if(a.instanceStatus!==e.DataSourceStatus.Created&&N)p(f,{dataSource:null});else if(a.instanceStatus===e.DataSourceStatus.Created){const t=e.DataSourceManager.getInstance().getDataSource(v);t&&t!==N&&(c=t,p(f,{dataSource:t}))}}let l=[];c&&(l=c.getSelectedRecords()||[],U(l)),U(l),le()}),[N,v,s,f,p,le]),pe=e.React.useRef();pe.current=ue,e.React.useEffect((()=>{let t=null;const a=(0,e.getAppStore)().getState();return a&&a.dataSourcesInfo&&(t=a.dataSourcesInfo[v]),pe.current&&pe.current(t,t),W.current=(0,e.observeStore)(((e,t)=>{pe.current&&pe.current(e,t)}),["dataSourcesInfo",v]),()=>{W.current&&"function"==typeof W.current&&W.current(),W.current=null}}),[v]),e.React.useEffect((()=>{const e=_.current;if(!e)return;if(!N)return;const t=e.latestSelectTaskInfo;if(!t)return;const a=t.version;if(!x(a))return;if(a<=X.current)return;Q(0),Z.current&&(Z.current.abort(`cancel selecting task ${X.current} because need to execute a new one`),Z.current=null);const n=a;X.current=n;const o=new AbortController;o.selectVersion=n,Z.current=o;const r=o.signal;let i=null;e.imDisplaySqlExpression&&(i=e.imDisplaySqlExpression.asMutable());const c={returnGeometry:!0,sqlExpression:i},l=t.appliedSql;l&&(c.where=l);const u=t.appliedGeometryInfo;u&&(c.geometry=u.geometry,c.geometryType=u.geometryType,c.spatialRel=u.spatialRel);const d=N;d.getPopupInfoFields&&(c.outFields=d.getPopupInfoFields());const m=t.selectionMode,g=()=>_.current&&_.current.latestSelectTaskInfo.version===n,S=e=>{g()&&Q(e)},y=new ye(d,s),h=()=>{var e;const t=g(),a=null===(e=Z.current)||void 0===e?void 0:e.ignoreAbortedSelection;return t&&!a};!function(){je(this,void 0,void 0,(function*(){try{yield y.selectRecords(c,m,r,L,S,h)}catch(e){console.error("Select widget select records error",e)}Z.current&&Z.current.selectVersion===n&&(Z.current=null),g()&&(p(f,{isSelecting:!1}),Q(1))}))}()}),[T,N,L,f,p,s]),e.React.useEffect((()=>{const e=I(V,h);p(f,{shouldRenderFilterIcon:e,imDisplaySqlExpression:h})}),[V,h,f,p]);const me=e.React.useCallback(((e,t)=>je(this,void 0,void 0,(function*(){const a=_.current;if(!a)return;let n=a.dataSource;if(n||(n=yield ce()),!n)return;t=j(t);const o=M(a.isAttributeFilterOn,a.imDisplaySqlExpression,n),s=a.latestSelectTaskInfo;if(s.version>0){const a=e===s.selectionMode,n=t===s.appliedGeometryInfo,r=o===s.appliedSql;if(a&&n&&r)return}const r=s.version+1;p(f,{latestSelectTaskInfo:{version:r,selectionMode:e,appliedGeometryInfo:t,appliedSql:o},isSelecting:!0})}))),[ce,f,p]),fe=e.React.useRef();fe.current=me;const Se=e.React.useCallback((e=>{e=!!e,E&&p(f,{isAttributeFilterOn:e})}),[E,f,p]),he=e.React.useCallback((()=>je(this,void 0,void 0,(function*(){let t=N;if(t||(t=yield ce()),!t)return;new ye(t,s).clearSelection();const a=_.current.latestSelectTaskInfo.version+1,n=j(null),o=D(""),r={version:a,selectionMode:e.DataSourceSelectionMode.New,appliedGeometryInfo:n,appliedSql:o};p(f,{latestSelectTaskInfo:r,isAttributeFilterOn:!1,isSelecting:!0})}))),[N,ce,f,p,s]),ve=e.React.useRef(!0);e.React.useEffect((()=>{const t=_.current;if(!t)return;const a=ve.current;if(ve.current=!1,!N&&!a)return void se(!0);const n=t.latestSelectTaskInfo;M(O,k,N)!==n.appliedSql&&fe.current&&fe.current(e.DataSourceSelectionMode.New,n.appliedGeometryInfo)}),[N,k,O]),e.React.useEffect((()=>{p(f,{tryExecuteSelectingByGeometryInfoAndSqlUI:me})}),[me,f,p]),e.React.useEffect((()=>{p(f,{enableAttributeFilter:Se})}),[Se,f,p]),e.React.useEffect((()=>{p(f,{clearSelection:he})}),[he,f,p]);const we=e.React.useCallback(((e,t)=>{p(f,{checked:t})}),[p,f]),be=e.React.useCallback((()=>{q(!J)}),[q,J]),Ie=e.React.useCallback((()=>{he()}),[he]),Re=e.React.useCallback((()=>{const e=Z.current;e&&e.abort()}),[Z]),xe=e.React.useCallback((e=>{K.current=null==e?void 0:e.target,$(!0)}),[$]),Ne=e.React.useCallback(((e,t)=>{A||Se(t)}),[Se,A]),Le=e.React.useCallback((e=>{const t=I(V,e);p(f,{shouldRenderFilterIcon:t,imDisplaySqlExpression:e})}),[V,p,f]),Ce=e.React.useCallback((t=>{Le(t),$(!1),setTimeout((()=>{const t=K.current;t&&(0,e.focusElementInKeyboardMode)(t)}),100)}),[Le,$]),ke=e.React.useMemo((()=>{let t=38;E&&(t+=26),c&&(t+=26);const a=`${t}px`;let n=4;n+=A?20:4+10*G.toString().length+4;const o=`${n}px`;return e.css`
    .select-ds-list-item-top-row {
      position: relative;

      .ds-list-label-container {
        width: calc(100% - ${a});
        flex-basis: calc(100% - ${a});
        flex-shrink: 0;
        flex-grow: 0;

        .ds-list-label {
          max-width: calc(100% - ${o});
          flex-basis: auto;
          flex-shrink: 0;
          flex-grow: 0;

          .layer-name {
            width: calc(100% - 20px);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
          }
        }

        .selection-count-container {
          width: ${o};
          flex-basis: ${o};
          flex-shrink: 0;
          flex-grow: 0;

          .selection-count {
            display: inline;
            border-radius: 4px;
            background: var(--ref-palette-neutral-300);
            padding: 1px 4px 0px 4px;
            line-height: 16px;
            font-size: 12px;
          }

          .aria-live-label {
            display: block;
            width: 0;
            height: 0;
            overflow: hidden;
          }
        }
      }

      .ds-list-icons {
        box-sizing: border-box;
        flex-direction: row;
        width: ${a};
        flex-basis: ${a};
        flex-shrink: 0;
        flex-grow: 0;
        padding-left: 12px;
      }
    }

    .select-sql-hint {
      word-break: break-all;
    }

    .sql-expr-runtime-disabled {
      touch-action: none;
      pointer-events: none;
    }
  `}),[c,A,G,E]),Te=e.React.useMemo((()=>{let e="";if(G>0){e=`${z("SelectionSelectedFeatures")}: ${G}`}return e}),[G,z]),Ee=e.React.useMemo((()=>{let e="";return A?e=z("loading"):Te&&(e=Te),e}),[A,Te,z]),Oe=e.React.useId();return b?(0,e.jsx)("div",{className:(0,e.classNames)(["select-ds-list-item w-100 mt-2",{"filer-panel-opened":J}]),css:ke},(0,e.jsx)("div",{className:"select-ds-list-item-top-row w-100 d-flex align-items-center"},(0,e.jsx)("div",{className:"ds-list-label-container d-flex align-items-center"},(0,e.jsx)(t.Label,{className:"ds-list-label d-flex align-items-center mb-0"},(0,e.jsx)(t.Checkbox,{checked:C,className:"mr-1",onChange:we,"aria-describedby":Oe}),(0,e.jsx)("span",{className:"layer-name",title:b},b)),(0,e.jsx)("div",{className:"selection-count-container d-flex align-items-center pl-1"},!A&&G>0&&(0,e.jsx)("div",{id:Oe,className:"selection-count","aria-label":Te},G),A&&(0,e.jsx)(De,{progress:Y,onClick:Re}),(0,e.jsx)("label",{className:"aria-live-label","aria-live":"polite"},Ee))),(0,e.jsx)("div",{className:"ds-list-icons d-flex align-items-center"},E&&(0,e.jsx)(t.Button,{title:z("attributeSelection"),type:J?"primary":"tertiary","aria-expanded":J,size:"sm",icon:!0,onClick:be},(0,e.jsx)(ge,{width:16,height:16})),(0,e.jsx)(t.Button,{title:z("clearSelection"),type:"tertiary",size:"sm",icon:!0,disabled:A||0===G,onClick:Ie},(0,e.jsx)(de,{size:16})),c&&(0,e.jsx)(t.DataActionList,{widgetId:s,dataSets:ne,disableDataSourceLevelActions:!0,buttonType:"tertiary",listStyle:t.DataActionListStyle.Dropdown,hideGroupTitle:!0}))),E&&(0,e.jsx)("div",{className:(0,e.classNames)(["filter-panel w-100",{"d-none":!J}])},(0,e.jsx)("div",{className:"d-flex w-100 align-items-center mt-3"},(0,e.jsx)("label",{htmlFor:B,className:"w-100 pb-0 pr-1 select-sql-hint"},te),P&&(0,e.jsx)(t.Button,{title:z("customSQL"),type:"tertiary",size:"sm",icon:!0,onClick:xe},(0,e.jsx)(ie,null)),(0,e.jsx)(t.Switch,{className:"where-switch",id:B,checked:O,onChange:Ne})),ee&&N&&(0,e.jsx)(S.SqlExpressionRuntime,{className:(0,e.classNames)([{"sql-expr-runtime-disabled":A}]),widgetId:s,dataSource:N,expression:k,onChange:Le}),H&&N&&(0,e.jsx)(Me,{isRTL:o,widgetId:s,widgetDomRef:i,dataSource:N,imSqlExpression:k,onBack:Ce}))):null}var Le=i(13424),Ce=i.n(Le),ke=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(a[n[o]]=e[n[o]])}return a};const Te=t=>{const a=window.SVG,{className:n}=t,o=ke(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:s,src:Ce()},o)):e.React.createElement("svg",Object.assign({className:s},o))};function Ee(a){const{isRTL:n,widgetId:o,widgetDomRef:s,jimuMapView:i,enableDataAction:c,allImDataSourceItems:l,notConfigDataSourceItems:u,configDataSourceItems:d,dataSourceItemRuntimeInfoMap:p,updateDataSourceItemRuntimeInfoForUid:m}=a,f=e.hooks.useTranslation(t.defaultMessages,r),[g,S]=e.React.useState({}),y=e.React.useMemo((()=>function(e,t){const a=[];return e.forEach((e=>{const n=e.uid,o=t[n];o&&a.push(o)})),a}(l,p)),[p,l]),h=e.React.useCallback((()=>{y.forEach((e=>{e.checked||m(e.uid,{checked:!0})}))}),[y,m]),v=e.React.useCallback((()=>{y.forEach((e=>{e.checked&&m(e.uid,{checked:!1})}))}),[y,m]),b=e.React.useCallback((()=>{y.forEach((e=>{m(e.uid,{checked:!e.checked})}))}),[y,m]),I=e.React.useCallback(((e,t)=>{S((a=>Object.assign({},a,{[e]:t})))}),[S]),R=e.React.useCallback((e=>e.filter((e=>{const t=e.uid;return!!p[t]}))),[p]),M=e.React.useMemo((()=>R(u)),[u,R]),x=e.React.useMemo((()=>R(d)),[d,R]),D=e.React.useMemo((()=>{const e=w(l,p),t={};e.forEach((e=>{const a=null==e?void 0:e.uid;a&&(t[a]=!0)}));const a=[];return Object.keys(g).forEach((e=>{if(t[e]){const t=g[e];t&&a.push(t)}})),a}),[l,p,g]),j=e.React.useMemo((()=>e.css`
      .layers-dropdown {
        margin-left: -4px;
      }

      .layers-dropdown-button {
        border: none;
      }

      .layers-header-tip {
        font-size: 0.875rem;
        color: var(--ref-palette-neutral-1100);
        font-weight: 600;
      }
    `),[]),N=f("batchLayerSelectableStatus");return(0,e.jsx)("div",{className:"data-attribute-select p-4",css:j},(0,e.jsx)("div",{className:"w-100 d-flex align-items-center","aria-label":f("layers"),role:"group"},(0,e.jsx)(t.Dropdown,{className:"layers-dropdown mr-1",direction:"down",menuItemCheckMode:"default",menuRole:"menu",size:"sm"},(0,e.jsx)(t.DropdownButton,{className:"layers-dropdown-button",size:"sm",icon:!0,arrow:!1,title:N,"aria-label":N},(0,e.jsx)(Te,{width:16,height:16})),(0,e.jsx)(t.DropdownMenu,null,(0,e.jsx)(t.DropdownItem,{onClick:h},f("allSelectable")),(0,e.jsx)(t.DropdownItem,{onClick:v},f("noneSelectable")),(0,e.jsx)(t.DropdownItem,{onClick:b},f("toggleAll")))),(0,e.jsx)(t.Label,{className:"layers-header-tip mb-0 w-100"}," ",f("layers")," "),c&&(0,e.jsx)(t.DataActionList,{widgetId:o,dataSets:D,disableDataSourceLevelActions:!0,buttonType:"tertiary",listStyle:t.DataActionListStyle.Dropdown,hideGroupTitle:!0,alwaysShowBatchIcon:!0})),(0,e.jsx)("div",{className:"ds-list-items"},M.map((t=>{const a=t.uid,r=p[a];return(0,e.jsx)(Ne,{key:a,isRTL:n,widgetId:o,widgetDomRef:s,jimuMapView:i,enableDataAction:c,imDataSourceItem:t,itemRuntimeInfo:r,updateDataSourceItemRuntimeInfoForUid:m,onDataRecordSetChange:I})}))),(0,e.jsx)("div",{className:"ds-list-items"},x.map((t=>{const a=t.uid,r=p[a];return(0,e.jsx)(Ne,{key:a,isRTL:n,widgetId:o,widgetDomRef:s,jimuMapView:i,enableDataAction:c,imDataSourceItem:t,itemRuntimeInfo:r,updateDataSourceItemRuntimeInfoForUid:m,onDataRecordSetChange:I})}))))}var Oe=i(62686),Ae=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};function Ve(a){const{widgetId:n,visible:o,allImDataSourceItems:s,dataSourceItemRuntimeInfoMap:i,imSpatialSelection:c,updateDataSourceItemRuntimeInfoForUid:l}=a,f=c.buffer;let g=!1,S=0,y=null;f&&(g=f.enable,S=f.distance,y=f.unit),"number"!=typeof S&&(S=0),y||(y=p.Meters);const[h,v]=e.React.useState({}),[I,R]=e.React.useState(c.relationships&&c.relationships[0]),[M,x]=e.React.useState(""),[D,j]=e.React.useState(S),[N,L]=e.React.useState(y),[C,k]=e.React.useState(-1),[T,E]=e.React.useState(!1),O=e.React.useRef([]),A=e.hooks.useTranslation(t.defaultMessages,r);e.React.useEffect((()=>{"number"==typeof S&&j(S)}),[S]),e.React.useEffect((()=>{y&&L(y)}),[y]);const V=e.React.useMemo((()=>e.css`
      border-bottom: 1px solid var(--ref-palette-neutral-400);

      .select-by-location-title {
        font-size: 0.875rem;
        color: var(--ref-palette-neutral-1100);
        font-weight: 600;
      }

      .select-by-location-param-title {
        font-weight: 500;
      }

      .feature-count-info {
        background: var(--primary-100, #E6F2FF);
        border-color: var(--info-300, #60CEFF);
        border-width: 1px;
        border-style: solid;
        min-height: 32px;
      }
    `),[]),P=e.React.useMemo((()=>{if(!M)return null;return h[M]||e.DataSourceManager.getInstance().getDataSource(M)}),[h,M]),z=e.React.useMemo((()=>{let e=null;return P&&(e=P.getMainDataSource()),e}),[P]),B=e.React.useMemo((()=>w(s,i).length),[s,i]),F=e.React.useMemo((()=>b(s,i)),[s,i]),U=F.length,G=e.React.useMemo((()=>{let e=I&&P&&!T&&B>0&&B===U;return e=!!e,e}),[T,B,U,I,P]),W=e.React.useCallback((()=>{O.current=F;const e=O.current||[];E(!0),e.forEach((e=>{const t=e.uid;l(t,{isSelecting:!0})}))}),[O,F,l]),J=e.React.useCallback((t=>{const a=O.current||[];O.current=[],E(!1),a.forEach((a=>{a.tryExecuteSelectingByGeometryInfoAndSqlUI(e.DataSourceSelectionMode.New,t)}))}),[O,E]),q=e.React.useCallback((()=>{const e=O.current||[];O.current=[],E(!1),e.forEach((e=>{const t=e.uid;l(t,{isSelecting:!1})}))}),[O,E,l]),H=e.React.useCallback((()=>{if(!I)return;if(!P)return;W();const t=function(t,a,n,o){return Ae(this,void 0,void 0,(function*(){const s={outFields:[],returnGeometry:!0,outSR:4326},r=yield t.ds.queryAll(s),i=yield(0,Oe.loadArcGISJSAPIModules)(["esri/geometry/support/jsonUtils","esri/geometry/operators/unionOperator"]),[c,l]=i,u=[];r&&r.records.length>0&&r.records.forEach((e=>{const t=e.getGeometry();if(t)if(t.declaredClass)u.push(t);else{const e=c.fromJSON(t);u.push(e)}}));let d=null;if(u.length>0)if(a&&n>0&&o){const t=m[o],a=yield e.geometryUtils.createBuffer(u,[n],t);d=Array.isArray(a)?1===a.length?a[0]:a.length>=2?l.executeMany(a):null:a}else d=1===u.length?u[0]:l.executeMany(u);return d}))}(new ye(P,n),g,D,N);t.then((t=>{if(!t)return void q();const a=e.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(t.type),n=u[I],o={geometry:t.toJSON(),geometryType:a,spatialRel:n};J(o)})).catch((e=>{console.error("can not get buffered union geometry",e),q()}))}),[D,N,g,q,J,W,I,P,n]);e.React.useEffect((()=>{k(-1),P&&P.queryCount({}).then((e=>{if(P.id===M){const t=(null==e?void 0:e.count)||0;k(t)}})).catch((e=>{console.error("query count error for location data source",e)}))}),[P,M]);const $=e.React.useCallback((e=>{if(P&&P.id===M&&Pe(P)){const t=(null==e?void 0:e.length)||0;k(t)}}),[P,M]),_=e.React.useCallback((e=>{const t=e.target.value;R(t)}),[R]),Y=e.React.useCallback((e=>{const t=e.target.value;x(t)}),[x]),Q=e.React.useCallback((e=>{e&&v((t=>{const a=e.id;return Object.assign({},t,{[a]:e})}))}),[v]),K=e.React.useCallback((e=>{j(e)}),[j]),Z=e.React.useCallback((e=>{const t=e.target.value;L(t)}),[L]),X=c.useDataSources,ee=e.React.useMemo((()=>{const e=[];return X.forEach((t=>{const a=t.dataSourceId,n=h[a];n&&e.push(n)})),e}),[h,X]);e.React.useEffect((()=>{if(!M&&X.length>0&&ee.length>0){const e=X[0]&&X[0].dataSourceId;if(e){ee.find((t=>t.id===e))&&x(e)}}}),[X,ee,M]);const te=A("selectByData"),ae=A("apply"),ne=A("relationship"),oe=A("selectingFeatures"),se=A("theBufferDistance"),re=A("bufferUnit"),[ie,ce]=e.React.useState("");return e.React.useEffect((()=>{setTimeout((()=>{const e=A("selectByLocationFeatureCountTip",{count:C});ce(e)}),500)}),[C,A]),(0,e.jsx)("div",{className:(0,e.classNames)(["select-by-location p-4",{"d-none":!o}]),css:V},(0,e.jsx)("div",{className:"d-flex w-100 align-items-center mb-2","aria-label":te,role:"group"},(0,e.jsx)("label",{className:"select-by-location-title w-100 mb-0",title:te},te),(0,e.jsx)(t.Button,{className:"nowrap",type:"primary",disabled:!G,size:"sm",onClick:H},ae)),(0,e.jsx)("div",{className:"relationship-param w-100 d-flex flex-column align-items-center mb-2"},(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:ne},ne),(0,e.jsx)(t.Select,{className:"relationship-select w-100",size:"sm",value:I,"aria-label":ne,onChange:_},c.relationships.map((t=>(0,e.jsx)("option",{key:t,value:t},A(d[t])))))),(0,e.jsx)("div",{className:"data-view-param w-100 d-flex flex-column align-items-center mb-2"},(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:oe},oe),(0,e.jsx)(t.Select,{className:"selecting-features-select w-100",size:"sm",value:M,"aria-label":oe,onChange:Y},ee.map((t=>(0,e.jsx)("option",{key:t.id,value:t.id},t.getLabel()||"")))),X.map((t=>(0,e.jsx)(e.DataSourceComponent,{key:t.dataSourceId,useDataSource:t,onDataSourceCreated:Q})))),P&&z&&Pe(P)&&(0,e.jsx)(e.DataSourceComponent,{dataSource:z,onSelectionChange:$}),g&&(0,e.jsx)("div",{className:"distance-unit-param w-100 d-flex flex-column align-items-center"},(0,e.jsx)("label",{className:"select-by-location-param-title w-100 mb-2",title:se},se),(0,e.jsx)("div",{className:"d-flex w-100 justify-content-between"},(0,e.jsx)(t.NumericInput,{className:"distance-input w-45 mr-1","aria-label":se,size:"sm",value:D,min:0,onChange:K}),(0,e.jsx)(t.Select,{className:"unit-select w-55",size:"sm",value:N,"aria-label":re,onChange:Z},Object.values(p).map((t=>(0,e.jsx)("option",{key:t,value:t},A(`unit_${t}`))))))),C>=0&&(0,e.jsx)(t.Alert,{type:"info",withIcon:!0,text:ie,className:"w-100 mt-3","aria-live":"polite",buttonType:"default",closable:!1,form:"basic",open:!0,size:"medium"}))}function Pe(t){return!!t&&(t.isDataView&&t.dataViewId===e.CONSTANTS.SELECTION_DATA_VIEW_ID)}function ze(t){const{isRTL:a,className:n,widgetProps:o,widgetDomRef:s,dataSourceItemRuntimeInfoMap:r,mixinDataSourceItemRuntimeInfoMap:i,updateDataSourceItemRuntimeInfoForUid:c,removeNotUsedDataSourceItemRuntimeInfoMap:l,updateWidgetDisplayMode:u}=t,d=e.React.useRef();d.current=l;const{widgetId:p,config:m,dataSourceCount:f,autoControlWidgetId:S}=o,{dataAttributeInfo:w,spatialSelection:b}=m,{allowGenerated:I,dataSourceItems:R}=w,M=!1!==o.enableDataAction,x=!!(null==b?void 0:b.enable),[D,j]=e.React.useState(!1),[N,C]=e.React.useState((0,e.Immutable)([])),k=e.React.useMemo((()=>N.concat(R)),[R,N]),T=e.React.useRef(k);T.current=k,e.React.useEffect((()=>{let e=null;if(k.length>0){e=v(k,r).length>0?g.Normal:g.Loading}else e=g.Placeholder;u(e)}),[k,r,u]),e.React.useEffect((()=>{if(!I)return void(0!==N.length&&C((0,e.Immutable)([])));const t=(0,e.getAppStore)().getState().dataSourcesInfo||(0,e.Immutable)({}),a=e.DataSourceManager.getInstance(),n=N.map((e=>e.useDataSource.dataSourceId)).asMutable(),o=[];Object.keys(t).forEach((t=>{if(t.includes("view_in_table"))return;const n=a.getDataSource(t);if(n){const t=n.isAssociatedFeatureLayer,a=n.getDataSourceJson(),s=null==a?void 0:a.isOutputFromWidget;n.isInAppConfig()||n.isDataView||n.isLocal||s||t||L(n.type)&&n.type!==e.DataSourceTypes.SubtypeGroupLayer&&o.push(n.id)}}));const{added:s,deleted:c,saved:l}=e.utils.diffArrays(!0,n,o);if(0===s.length&&0===c.length)return;const u=N.filter((e=>{const t=e.useDataSource.dataSourceId;return l.includes(t)})),d=[];if(s.length>0){s.forEach((e=>{const t=a.getDataSource(e);if(t){const e=h(t);d.push(e)}}));const e=y(!1,!0,d,r);i(e)}const p=u.concat(d);C(p)}),[f,I,N,i,C,r]),e.React.useEffect((()=>{const e=R.filter((e=>{const t=e.uid;return!r[t]}));if(e.length>0){const t=y(!1,!1,e,r);i(t)}}),[R,r,i]),e.React.useEffect((()=>{const e=setTimeout((()=>{if(T.current){const e=[];T.current.forEach((t=>{e.push(t.uid)})),d.current&&d.current(e)}}),100);return()=>{clearTimeout(e)}}),[k]);const E=["select-use-data-source-entry"];n&&E.push(n);const O=E.join(" ");return e.React.createElement("div",{className:O},e.React.createElement(te,{config:m,widgetId:p,mapWidgetId:"",autoControlWidgetId:S,activeJimuMapView:null,setSelectByLocationVisible:j,allImDataSourceItems:k,dataSourceItemRuntimeInfoMap:r}),x&&e.React.createElement(Ve,{widgetId:p,visible:D,allImDataSourceItems:k,dataSourceItemRuntimeInfoMap:r,imSpatialSelection:b,updateDataSourceItemRuntimeInfoForUid:c}),e.React.createElement(Ee,{isRTL:a,widgetId:p,widgetDomRef:s,jimuMapView:null,enableDataAction:M,allImDataSourceItems:k,notConfigDataSourceItems:N,configDataSourceItems:R,dataSourceItemRuntimeInfoMap:r,updateDataSourceItemRuntimeInfoForUid:c}))}var Be=function(e,t,a,n){return new(a||(a=Promise))((function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};function Fe(t){const{isRTL:a,className:n,widgetProps:o,widgetDomRef:s,dataSourceItemRuntimeInfoMap:r,mixinDataSourceItemRuntimeInfoMap:i,updateDataSourceItemRuntimeInfoForUid:c,clearAllDataSourceItemRuntimeInfoMap:l,removeNotUsedDataSourceItemRuntimeInfoMap:u,removeGeneratedJimuLayerViewDataSourceItemRuntimeInfoMap:d,updateWidgetDisplayMode:p}=t;e.React.useRef().current=r;const m=e.React.useRef();m.current=l;const f=e.React.useRef();f.current=u;const S=e.React.useRef();S.current=d;const{widgetId:w,config:b,dataSourceCount:I,mapWidgetId:R,autoControlWidgetId:M,state:x}=o,{spatialSelection:D}=b,j=b.mapInfo||function(){const t={};return(0,e.Immutable)(t)}(),N=!1!==o.enableDataAction,C=!!(null==D?void 0:D.enable),[O,V]=e.React.useState(!1),[P,z]=e.React.useState(null),B=e.React.useRef(P);B.current=P;const F=P?P.id:"",U=e.React.useMemo((()=>{let t=null;return j&&F&&(t=j[F]),t||(t=function(){const t={syncWithMap:!0,allowGenerated:!0,enableAttributeSelection:!1,dataSourceItems:void 0};return(0,e.Immutable)(t)}()),t}),[F,j]),G=!!U.syncWithMap,W=e.React.useRef(G);W.current=G;const J=G,q=e.React.useRef(J);q.current=J;const H=function(e,t){return!!e||t}(G,U.allowGenerated),$=e.React.useRef(H);$.current=H;const _=T(G,U.enableAttributeSelection);e.React.useRef(_).current=_;const[Y,Q]=e.React.useState((0,e.Immutable)([])),K=e.React.useRef(),Z=e.React.useCallback((()=>{if(!J&&!H||!P)return void(0!==Y.length&&Q((0,e.Immutable)([])));const t=e.DataSourceManager.getInstance(),a=Y.map((e=>e.useDataSource.dataSourceId)).asMutable(),n=[];Ue(P,J,H).forEach((t=>{const a=t.getLayerDataSource();if(a&&L(a.type)&&a.type!==e.DataSourceTypes.SubtypeGroupLayer){const e=a.getDataSourceJson();(null==e?void 0:e.isOutputFromWidget)||n.push(a.id)}}));const{added:o,saved:s}=e.utils.diffArrays(!0,a,n),r=Y.filter((e=>{const t=e.useDataSource.dataSourceId;return s.includes(t)})),i=[];o.length>0&&o.forEach((e=>{const a=t.getDataSource(e);if(a){const e=P.getJimuLayerViewByDataSourceId(a.id),t=h(a,null==e?void 0:e.id);i.push(t)}}));const c=r.concat(i).asMutable(),l=E(P,c),u=(0,e.Immutable)(l);Q(u)}),[P,H,J,Y]);K.current=Z,e.React.useEffect((()=>{const e=Y.filter((e=>{const t=e.uid;return!r[t]}));if(e.length>0){let t=!1;t=!!_;const a=y(!0,t,e,r);i(a)}}),[r,_,Y,i]);const X=e.React.useCallback((e=>{We(Ue(e,q.current,$.current)).finally((()=>{K.current&&K.current()}))}),[]),ee=e.React.useRef();ee.current=X,e.React.useEffect((()=>{m.current&&m.current(),ee.current&&B.current&&ee.current(B.current)}),[G]),e.React.useEffect((()=>{ee.current&&B.current&&ee.current(B.current)}),[H]),e.React.useEffect((()=>{S.current&&S.current()}),[_]),e.React.useEffect((()=>{m.current&&m.current(),ee.current&&ee.current(P);const t=t=>Be(this,void 0,void 0,(function*(){if(t&&Ge(t,q.current,$.current)&&t.type!==e.JSAPILayerTypes.SubtypeGroupLayer){yield We([t]);const e=t.getLayerDataSource();e&&L(e.type)&&K.current&&K.current()}})),a=e=>Be(this,void 0,void 0,(function*(){if(!W.current)return;const t=e.filter((e=>k(e)));if(t.length>0){const e=t.filter((e=>Ge(e,q.current,$.current)));e.length>0&&(yield We(e)),K.current&&K.current()}})),n=e=>{e&&e.fromRuntime&&K.current&&K.current()};return P&&(P.addJimuLayerViewCreatedListener(t),P.addJimuLayerViewsVisibleChangeListener(a),P.addJimuLayerViewRemovedListener(n)),()=>{P&&(P.removeJimuLayerViewCreatedListener(t),P.removeJimuLayerViewsVisibleChangeListener(a),P.removeJimuLayerViewRemovedListener(n))}}),[P]),e.React.useEffect((()=>{K.current&&K.current()}),[I]);const ae=e.React.useMemo((()=>{let t=null;if(U&&!G){const e=U.dataSourceItems;e&&e.length>0&&(t=e)}return t||(t=(0,e.Immutable)([])),t}),[U,G]),ne=e.React.useMemo((()=>Y.concat(ae)),[ae,Y]),oe=e.React.useRef(ne);oe.current=ne;const se=Y.length,re=e.React.useMemo((()=>{var e,t;let a=0;if(R){const n=A(R);(null===(e=n.useDataSources)||void 0===e?void 0:e.length)>0&&(a=null===(t=n.useDataSources)||void 0===t?void 0:t.length)}return a}),[R]);e.React.useEffect((()=>{let e=null;if(R){let t=0;if(j&&Object.values(j).forEach((e=>{if(e&&!e.syncWithMap&&e.dataSourceItems){const a=e.dataSourceItems.length;a>0&&(t+=a)}})),0===se&&0===t&&0===re)e=g.NoLayersTip;else if(F)if(ne.length>0){e=v(ne,r).length>0?g.Normal:g.Loading}else e=g.NoLayersTip;else e=g.Loading}else e=g.Placeholder;p(e)}),[F,ne,r,se,re,j,R,p]),e.React.useEffect((()=>{const e=ae.filter((e=>{const t=e.uid;return!r[t]}));if(e.length>0){const t=y(!0,!1,e,r);i(t)}}),[ae,r,i]),e.React.useEffect((()=>{const e=setTimeout((()=>{if(oe.current){const e=[];oe.current.forEach((t=>{e.push(t.uid)})),f.current&&f.current(e)}}),100);return()=>{clearTimeout(e)}}),[ne]);const ie=e.React.useCallback((e=>{z(e)}),[z]),ce=["select-use-map-entry"];n&&ce.push(n);const le=ce.join(" ");return e.React.createElement("div",{className:le},R&&e.React.createElement(Oe.JimuMapViewComponent,{useMapWidgetId:R,onActiveViewChange:ie}),e.React.createElement(te,{config:b,widgetId:w,mapWidgetId:R,autoControlWidgetId:M,widgetState:x,activeJimuMapView:P,setSelectByLocationVisible:V,allImDataSourceItems:ne,dataSourceItemRuntimeInfoMap:r}),C&&e.React.createElement(Ve,{widgetId:w,visible:O,allImDataSourceItems:ne,dataSourceItemRuntimeInfoMap:r,imSpatialSelection:D,updateDataSourceItemRuntimeInfoForUid:c}),e.React.createElement(Ee,{isRTL:a,widgetId:w,widgetDomRef:s,jimuMapView:P,enableDataAction:N,allImDataSourceItems:ne,notConfigDataSourceItems:Y,configDataSourceItems:ae,dataSourceItemRuntimeInfoMap:r,updateDataSourceItemRuntimeInfoForUid:c}))}function Ue(e,t,a){const n=[];return e&&Object.values(e.jimuLayerViews).forEach((e=>{e&&Ge(e,t,a)&&n.push(e)})),n}function Ge(e,t,a){return!!(e&&k(e)&&function(e){var t,a,n;if(e){const o=e.getJimuMapView(),s=(null===(n=null===(a=null===(t=null==o?void 0:o.view)||void 0===t?void 0:t.map)||void 0===a?void 0:a.layers)||void 0===n?void 0:n.toArray())||[],r=function(e){let t=null;if(e){const a=e.getJimuMapView();if(a){const n=a.getParentJimuLayerViews(e.id);t=n.length>0?n[n.length-1]:e}}return t}(e),i=null==r?void 0:r.layer;if((null==s?void 0:s.length)>0&&i)return s.includes(i)}return!1}(e)&&e.isLayerVisible())&&(e.fromRuntime?a:t)}function We(e){const t=e.map((e=>{const t=e.getLayerDataSource();if(t)return Promise.resolve(t);return function(e){return new Promise((t=>{e.then((e=>{t(e)})).catch((()=>{t(null)}))}))}(e.createLayerDataSource())}));return Promise.all(t)}var Je=i(32772),qe=i.n(Je);function He(e){const t=[];e.dataAttributeInfo&&e.dataAttributeInfo.dataSourceItems&&e.dataAttributeInfo.dataSourceItems.length>0&&e.dataAttributeInfo.dataSourceItems.forEach((e=>{const a=e.useDataSource.asMutable();t.push(a)})),e.mapInfo&&Object.values(e.mapInfo).forEach((e=>{const a=null==e?void 0:e.dataSourceItems;a&&a.length>0&&a.forEach((e=>{if(null==e?void 0:e.useDataSource){const a=e.useDataSource.asMutable();t.push(a)}}))})),e.spatialSelection&&e.spatialSelection.useDataSources&&e.spatialSelection.useDataSources.length>0&&e.spatialSelection.useDataSources.forEach((e=>{const a=e.asMutable();t.push(a)}));const a=[],n=[];if(t.forEach((e=>{const t=e.dataSourceId;a.includes(t)||(a.push(t),n.push(e))})),0!==n.length||!e.useMap)return n}class $e extends e.WidgetVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.15.0",description:"remove useless useDataSources from Select widget",upgradeFullInfo:!0,upgrader:e=>{var t,a,n;const o=null==e?void 0:e.widgetJson,s=null==o?void 0:o.config;if(!s)return e;let r=s;if(r.useMap)(null===(a=null===(t=r.dataAttributeInfo)||void 0===t?void 0:t.dataSourceItems)||void 0===a?void 0:a.length)>0&&(r=r.setIn(["dataAttributeInfo","dataSourceItems"],[]));else{const e=null===(n=r.mapInfo)||void 0===n?void 0:n.jimuMapViews;e&&Object.keys(e).length>0&&(r=r.setIn(["mapInfo","jimuMapViews"],{}))}if(s===r)return e;const i=He(r),c=o.set("config",r).set("useDataSources",i),l=Object.assign({},e);return l.widgetJson=c,l}},{version:"1.16.0",description:"Select widget supports syncWithMap option",upgradeFullInfo:!0,upgrader:e=>{const t=null==e?void 0:e.widgetJson,a=null==t?void 0:t.config;if(!a)return e;let n=a;const o=a.mapInfo;if(n=n.set("mapInfo",{}),o&&Object.keys(o).length>0){const e=!!o.allowGenerated,t=!!o.enableAttributeSelection,a=o.jimuMapViews;if(a){const o={};Object.keys(a).forEach((n=>{const s=a[n]||[];o[n]={syncWithMap:!1,allowGenerated:e,enableAttributeSelection:t,dataSourceItems:s}})),n=n.set("mapInfo",o)}}const s=He(n);let r=t.set("config",n).set("useDataSources",s);n.useMap||(r=r.set("useMapWidgetIds",null));const i=Object.assign({},e);return i.widgetJson=r,i}}]}}const _e=new $e,Ye=e.css`
  position: relative;
  overflow-x: hidden;
  overflow-y: auto;

  .nowrap {
    white-space: nowrap;
    text-wrap: nowrap;
  }

  .no-layers-panel-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding-left: 50px;
    padding-right: 50px;
    overflow-y: hidden;
  }

  :has(.select-custom-sql-builder) {
    .select-use-data-source-entry, .select-use-map-entry {
      display: none;
    }
  }
`,Qe=a=>{var n;const{isRTL:o,widgetId:i,config:c}=a,{useMap:l}=c,u=e.hooks.useTranslation(t.defaultMessages,r),d=e.React.useRef(),[p,m]=e.React.useState(g.Placeholder),f=e.React.useRef(p);f.current=p;const S=e.React.useRef(!1),y=e.React.useRef(null),[h,v]=e.React.useState({}),w=e.React.useCallback((e=>{if(e!==f.current){if(e===g.Loading){if(S.current)return;S.current=!0,y.current||(y.current=setTimeout((()=>{f.current===g.Loading&&m(g.NoLayersTip)}),2e4))}m(e)}}),[]);e.React.useEffect((()=>()=>{y.current&&clearTimeout(y.current)}),[]);const b=e.React.useCallback((e=>{e&&0!==Object.keys(e).length&&v((t=>Object.assign({},t,e)))}),[v]),I=e.React.useCallback(((e,t)=>{v((a=>{const n=a[e];if(!n)return a;const o=Object.assign({},n,t),s=Object.assign({},a);return s[e]=o,s}))}),[v]),R=e.React.useCallback((()=>{v((()=>({})))}),[v]),M=e.React.useRef();M.current=R;const x=e.React.useCallback((e=>{v((t=>{const a=[];if(Object.keys(t).forEach((t=>{e.includes(t)||a.push(t)})),a.length>0){const e=Object.assign({},t);return a.forEach((t=>{delete e[t]})),e}return t}))}),[v]),D=e.React.useCallback((()=>{v((e=>{const t=[];if(Object.keys(e).forEach((a=>{var n;const o=e[a];(null===(n=null==o?void 0:o.jimuLayerView)||void 0===n?void 0:n.fromRuntime)&&t.push(a)})),t.length>0){const a=Object.assign({},e);return t.forEach((e=>{delete a[e]})),a}return e}))}),[v]);e.hooks.useEffectWithPreviousValues((e=>{const t=e[0]||!1;l!==t&&M.current&&M.current()}),[l]);const j=p!==g.Placeholder,N=(0,e.classNames)(["jimu-widget widget-select border-0"],{"surface-1":j});return(0,e.jsx)("div",{ref:d,className:N,css:Ye},!l&&(0,e.jsx)(ze,{isRTL:o,className:p===g.Normal?"":"d-none",widgetProps:a,widgetDomRef:d,dataSourceItemRuntimeInfoMap:h,mixinDataSourceItemRuntimeInfoMap:b,updateDataSourceItemRuntimeInfoForUid:I,removeNotUsedDataSourceItemRuntimeInfoMap:x,updateWidgetDisplayMode:w}),l&&(0,e.jsx)(Fe,{isRTL:o,className:p===g.Normal?"":"d-none",widgetProps:a,widgetDomRef:d,dataSourceItemRuntimeInfoMap:h,mixinDataSourceItemRuntimeInfoMap:b,updateDataSourceItemRuntimeInfoForUid:I,clearAllDataSourceItemRuntimeInfoMap:R,removeNotUsedDataSourceItemRuntimeInfoMap:x,removeGeneratedJimuLayerViewDataSourceItemRuntimeInfoMap:D,updateWidgetDisplayMode:w}),p===g.NoLayersTip&&(0,e.jsx)("div",{className:"no-layers-panel w-100 h-100 d-flex align-items-center"},(0,e.jsx)("div",{className:"no-layers-panel-content w-100 h-100"},(0,e.jsx)(s,{width:24,height:24}),(0,e.jsx)("div",{className:"mt-2 mb-2"},u("noLayersAvailableTip")),(null===(n=window.jimuConfig)||void 0===n?void 0:n.isInBuilder)&&(0,e.jsx)("div",null,u("openSettingPanelTip")))),p===g.Loading&&(0,e.jsx)(t.Loading,{type:t.LoadingType.Secondary}),p===g.Placeholder&&(0,e.jsx)(t.WidgetPlaceholder,{widgetId:i,icon:qe(),name:u("_widgetLabel")}))};Qe.mapExtraStateProps=(t,a)=>{var n,o;let s=!1,r=0,i="",c="";const l=function(e,t){var a,n,o;if(e&&!e.useMap&&(null===(n=null===(a=e.dataAttributeInfo)||void 0===a?void 0:a.dataSourceItems)||void 0===n?void 0:n.length)>0){const a=null===(o=e.dataAttributeInfo)||void 0===o?void 0:o.dataSourceItems,n=function(e,t){let a=e;if(e&&e.length>0){const n=[];t&&t.length>0&&t.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&n.push(t)}));let o=!1;const s=e.filter((e=>{const t=null==e?void 0:e.useDataSource,a=null==t?void 0:t.dataSourceId,s=a&&n.includes(a);return s||(o=!0),s}));a=o?s:e}return a||(a=e),a}(a,t);n&&n!==a&&(e=e.setIn(["dataAttributeInfo","dataSourceItems"],n))}return e}(a.config,a.useDataSources)||a.config;(null===(n=t.appContext)||void 0===n?void 0:n.isRTL)&&(s=!0),t.dataSourcesInfo&&Object.values(t.dataSourcesInfo).forEach((t=>{t&&t.instanceStatus===e.DataSourceStatus.Created&&r++}));const u=a.useMapWidgetIds;return u&&u.length>0&&(i=u[0]),t.mapWidgetsInfo&&i&&(c=(null===(o=t.mapWidgetsInfo[i])||void 0===o?void 0:o.autoControlWidgetId)||""),{isRTL:s,dataSourceCount:r,mapWidgetId:i,autoControlWidgetId:c,config:l}},Qe.versionManager=_e;const Ke=Qe;function Ze(e){i.p=e}})(),c})())}}}));