System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/sql-expression-builder","jimu-arcgis"],(function(e,t){var a={},n={},s={},l={},o={},i={},r={};return{setters:[function(e){a.AppMode=e.AppMode,a.CONSTANTS=e.CONSTANTS,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.JSAPILayerTypes=e.JSAPILayerTypes,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.focusElementInKeyboardMode=e.focusElementInKeyboardMode,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.isKeyboardMode=e.isKeyboardMode,a.jsx=e.jsx,a.utils=e.utils,a.uuidv1=e.uuidv1},function(e){n.Alert=e.Alert,n.Button=e.Button,n.CollapsablePanel=e.CollapsablePanel,n.Collapse=e.Collapse,n.Icon=e.Icon,n.Label=e.Label,n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.MultiSelect=e.MultiSelect,n.MultiSelectItem=e.MultiSelectItem,n.NumericInput=e.NumericInput,n.Radio=e.Radio,n.Select=e.Select,n.Switch=e.Switch,n.TextArea=e.TextArea,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.defaultMessages=e.defaultMessages},function(e){s.JimuLayerViewSelector=e.JimuLayerViewSelector,s.MapWidgetSelector=e.MapWidgetSelector,s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper},function(e){l.List=e.List},function(e){o.DataSourceSelector=e.DataSourceSelector},function(e){i.SqlExpressionBuilderPopup=e.SqlExpressionBuilderPopup},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent}],execute:function(){e((()=>{var e={13089:e=>{"use strict";e.exports=o},14321:e=>{"use strict";e.exports=n},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},28359:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 3h12v2H2zm0 3v7h12V6zM1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1zm3 5h2v1H4zm8 0H7v1h5zm-8 2h2v1H4zm8 0H7v1h5z" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},53195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=r},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},71442:e=>{"use strict";e.exports=i},72529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=a},79298:e=>{"use strict";e.exports=s},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},98640:e=>{"use strict";e.exports=l}},t={};function c(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,c),s.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var a in t)c.o(t,a)&&!c.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{__set_webpack_public_path__:()=>Me,default:()=>De});var e=c(79244);function t(e){const t=[];e.dataAttributeInfo&&e.dataAttributeInfo.dataSourceItems&&e.dataAttributeInfo.dataSourceItems.length>0&&e.dataAttributeInfo.dataSourceItems.forEach((e=>{const a=e.useDataSource.asMutable();t.push(a)})),e.mapInfo&&Object.values(e.mapInfo).forEach((e=>{const a=null==e?void 0:e.dataSourceItems;a&&a.length>0&&a.forEach((e=>{if(null==e?void 0:e.useDataSource){const a=e.useDataSource.asMutable();t.push(a)}}))})),e.spatialSelection&&e.spatialSelection.useDataSources&&e.spatialSelection.useDataSources.length>0&&e.spatialSelection.useDataSources.forEach((e=>{const a=e.asMutable();t.push(a)}));const a=[],n=[];if(t.forEach((e=>{const t=e.dataSourceId;a.includes(t)||(a.push(t),n.push(e))})),0!==n.length||!e.useMap)return n}function a(t,a){if(!a)return!1;const n=t.filter((e=>!!(null==e?void 0:e.useDataSource)));if(0===n.length)return!0;if(n.find((e=>e.useDataSource.dataSourceId===a.dataSourceId||e.useDataSource.mainDataSourceId===a.mainDataSourceId)))return!1;const s=e.DataSourceManager.getInstance(),l=s.getDataSource(a.mainDataSourceId);if(l)if(l.type===e.DataSourceTypes.SubtypeGroupLayer){if(n.some((t=>{const a=s.getDataSource(t.useDataSource.mainDataSourceId);return!(!a||a.type!==e.DataSourceTypes.SubtypeSublayer||a.parentDataSource!==l)})))return!1}else if(l.type===e.DataSourceTypes.SubtypeSublayer){if(n.some((t=>{const a=s.getDataSource(t.useDataSource.mainDataSourceId);return!(!a||a.type!==e.DataSourceTypes.SubtypeGroupLayer||l.parentDataSource!==a)})))return!1}return!0}const n={_widgetLabel:"Select",sourceLabel:"Source",selectByAttrbute:"Select by attributes",newData:"New data",allowGeneratedData:"Allow selection of data generated at runtime",configureLayerAttribute:"Configure layer attribute",labelForAttribution:"Label for attribution",spatialSelection:"Spatial selection",selectByData:"Select by data",addSelectingData:"Add selecting data",selectableLayers:"Selectable layers",interactiveSelection:"Interactive selection",atLeastOneToolTip:"At least one interactive tool is required.",interactiveSelectionMode:"Interactive selection mode",partiallyWithin:"Partially within",whollyWithin:"Wholly within",addAttributionTip:"Add label for attribution",noDataSourceTooltip:"Click the \u201cNew data\u201d button to add and configure data sources to be selected.",selectionViewOnly:"Support selected features view only"};var s=c(14321),l=c(79298),o=c(98640),i=c(23662),r=c.n(i),d=c(62838),p=c.n(d),m=c(13089);const f=[e.DataSourceTypes.FeatureLayer,e.DataSourceTypes.SceneLayer,e.DataSourceTypes.BuildingComponentSubLayer,e.DataSourceTypes.OrientedImageryLayer,e.DataSourceTypes.ImageryLayer,e.DataSourceTypes.SubtypeGroupLayer,e.DataSourceTypes.SubtypeSublayer],g=(0,e.Immutable)(f);const S=[e.JSAPILayerTypes.FeatureLayer,e.JSAPILayerTypes.SceneLayer,e.JSAPILayerTypes.BuildingComponentSublayer,e.JSAPILayerTypes.OrientedImageryLayer,e.JSAPILayerTypes.ImageryLayer,e.JSAPILayerTypes.SubtypeGroupLayer,e.JSAPILayerTypes.SubtypeSublayer];function b(e,t){let a=e;if(e&&e.length>0){const n=[];t&&t.length>0&&t.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&n.push(t)}));let s=!1;const l=e.filter((e=>{const t=null==e?void 0:e.useDataSource,a=null==t?void 0:t.dataSourceId,l=a&&n.includes(a);return l||(s=!0),l}));a=s?l:e}return a||(a=e),a}function y(e,t){return!!e||t}function h(e,t){return!e&&t}function v(e,t){const a=t.slice();return e&&a.sort(((t,a)=>{const n=w(e,t),s=w(e,a);return n&&s?function(e,t){const a=e.split(".").map((e=>parseInt(e))),n=t.split(".").map((e=>parseInt(e)));for(;a.length>0&&n.length>0;){const e=a.shift(),t=n.shift();if(e<t)return-1;if(e>t)return 1}if(a.length>0)return 1;if(n.length>0)return-1;return 0}(n,s):0})),a}function w(e,t){let a="";if(e&&t){const n=t.jimuLayerViewId;if(n){const t=e.jimuLayerViews[n];t&&(a=t.hierarchyLevel)}}return a}function x(){var t;const a=function(){var t;return(null===(t=window.jimuConfig)||void 0===t?void 0:t.isBuilder)?(0,e.getAppStore)().getState().appStateInBuilder:(0,e.getAppStore)().getState()}();return(null===(t=null==a?void 0:a.appRuntimeInfo)||void 0===t?void 0:t.appMode)===e.AppMode.Express}function I(o){const i=o.rootSettingProps,{id:r,config:c}=i,u=e.hooks.useTranslation(s.defaultMessages,n),d=e.React.useCallback((n=>{const s=n&&n[0];if(!s)return;if(!a(c.dataAttributeInfo.dataSourceItems,s))return;const l=(0,e.uuidv1)(),u={uid:l,sqlHint:"",useDataSource:s},d=c.dataAttributeInfo.dataSourceItems.concat(u),p=c.setIn(["dataAttributeInfo","dataSourceItems"],d),m=t(p);i.onSettingChange({id:r,config:p,useDataSources:m}),o.onSelectNewDataSourceItem(l)}),[c,o,i,r]);return e.React.createElement(l.SettingSection,{title:u("sourceLabel")},e.React.createElement(l.SettingRow,{"aria-label":u("sourceLabel"),role:"group"},e.React.createElement(m.DataSourceSelector,{widgetId:r,isMultiple:!1,mustUseDataSource:!0,types:g,hideDataView:!0,hideCreateViewButton:!0,onChange:d})))}var j=c(71442);function R(o){var i,r;const[c,u]=e.React.useState(!1),{rootSettingProps:d,currentDataSourceItem:p,lastSelectNewDataSourceItemTimestampRef:f}=o,{id:S,config:b}=d,y=e.React.useRef(null),h=e.React.useRef(null);h.current=null==f?void 0:f.current,e.React.useEffect((()=>{const t=h.current;if("number"==typeof t&&t>0){if(Date.now()-t<1e3&&y.current){const t=y.current.querySelector(".ds-item");if(t){(0,e.isKeyboardMode)()&&setTimeout((()=>{(0,e.focusElementInKeyboardMode)(t)}),60)}}}}),[]);const v=e.hooks.useTranslation(s.defaultMessages,n),w=(0,e.Immutable)(p),x=(0,e.Immutable)([p.useDataSource]),I=p.sqlHint||"",R=e.DataSourceManager.getInstance().getDataSource(p.useDataSource.dataSourceId);let C=(null===(i=w.sqlExpression)||void 0===i?void 0:i.displaySQL)||"";w.sqlExpression&&R&&(C=null===(r=e.dataSourceUtils.getArcGISSQL(w.sqlExpression,R))||void 0===r?void 0:r.displaySQL),C=C||"";const D=e.React.useCallback((e=>{const a=b.dataAttributeInfo.dataSourceItems.map((t=>t.uid===p.uid?e:t)),n=b.setIn(["dataAttributeInfo","dataSourceItems"],a),s=t(n);d.onSettingChange({id:S,config:n,useDataSources:s})}),[b,p.uid,d,S]),M=e.React.useCallback((e=>{var t;const n=e&&e[0];if(!n)return;const s=null===(t=null==w?void 0:w.useDataSource)||void 0===t?void 0:t.dataSourceId;let l=null;l=s?b.dataAttributeInfo.dataSourceItems.filter((e=>{var t;return(null===(t=e.useDataSource)||void 0===t?void 0:t.dataSourceId)!==s})):b.dataAttributeInfo.dataSourceItems;if(!a(l,n))return;const o=w.set("useDataSource",n).set("sqlExpression",null);D(o)}),[w,D,b]),L=e.React.useCallback((e=>{const t=e.target.value,a=w.set("sqlHint",t);D(a)}),[w,D]),N=e.React.useCallback((()=>{u(!0)}),[u]),E=e.React.useCallback((()=>{u(!1)}),[u]),O=e.React.useCallback((e=>{const t=w.set("sqlExpression",e);D(t)}),[w,D]),k=e.React.useId();return e.React.createElement("div",{ref:y},e.React.createElement(l.SettingSection,{title:v("sourceLabel")},e.React.createElement(l.SettingRow,null,e.React.createElement(m.DataSourceSelector,{widgetId:S,isMultiple:!1,types:g,mustUseDataSource:!0,hideDataView:!0,hideCreateViewButton:!0,useDataSources:x,onChange:M,disableRemove:()=>!0}))),e.React.createElement(l.SettingSection,{title:v("labelForAttribution")},e.React.createElement(l.SettingRow,null,e.React.createElement(s.TextInput,{className:"w-100",size:"sm",value:I,"aria-label":v(I?"labelForAttribution":"addAttributionTip"),onChange:L}))),e.React.createElement(l.SettingSection,{title:v("sqlExpr"),"aria-label":v("sqlExpr"),role:"group"},e.React.createElement(l.SettingRow,{flow:"wrap",truncateLabel:!0,label:v("addSqlExprForSelection")},e.React.createElement("span",{id:k,className:"d-none"},v("addSqlExprForSelection")),e.React.createElement(s.Button,{className:"w-100 text-default set-link-btn",type:"primary",disabled:!1,onClick:N,title:v("sqlExpressionBuilder"),"aria-describedby":k},v("sqlExpressionBuilder"))),e.React.createElement(l.SettingRow,null,e.React.createElement(s.TextArea,{height:80,value:C,spellCheck:!1,readOnly:!0,placeholder:C?"":v("addSqlExprFirst"),onClick:e=>{e.currentTarget.select()}})),R&&e.React.createElement(j.SqlExpressionBuilderPopup,{dataSource:R,isOpen:c,toggle:E,expression:w.sqlExpression,onChange:O})))}function C(t){const{checked:a,titleKey:o,onSwitchChange:i}=t,r=!!t.disabled,c=e.hooks.useTranslation(s.defaultMessages,n);return(0,e.jsx)(l.SettingRow,{className:(0,e.classNames)("w-100",t.className),tag:"label",label:c(o)},(0,e.jsx)(s.Switch,{checked:a,disabled:r,onChange:i}))}var D=c(31027),M=c.n(D),L=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const N=t=>{const a=window.SVG,{className:n}=t,s=L(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:M()},s)):e.React.createElement("svg",Object.assign({className:l},s))},E=e.css`
  flex-direction: column;
  font-size: 0.875rem;
  text-align: center;
  color: var(--ref-palette-neutral-1000);
  span {
    padding: 0 1rem;
  }
`,O=t=>{const{text:a,style:n}=t;return(0,e.jsx)("div",{css:E,style:n,className:"d-flex align-items-center justify-content-center"},(0,e.jsx)(N,{size:48,color:"var(--ref-palette-neutral-800)"}),(0,e.jsx)("span",{className:"mt-4"},a))};var k,A=c(28359),T=c.n(A);function P(a){const{rootSettingProps:i}=a,{id:c,config:u,useDataSources:d,onSettingChange:m}=i,{dataAttributeInfo:f}=u,g=f.dataSourceItems,S=!!f.allowGenerated,y=e.React.useMemo((()=>b(g,d)),[g,d]),h=(null==y?void 0:y.length)>0,v=e.hooks.useTranslation(s.defaultMessages,n),[w,j]=e.React.useState({}),D=e.React.useRef(null),M=e.React.useRef(null),L=e.React.useRef(null),N=e.React.useRef(null),[E,A]=e.React.useState({status:k.None,currentDataSourceItemUid:null}),P=e.React.useMemo((()=>{let e=null;return E.currentDataSourceItemUid&&(e=g.find((e=>e.uid===E.currentDataSourceItemUid))),e}),[E.currentDataSourceItemUid,g]),V=E.status===k.AddNew,q=E.status===k.ShowDetail&&!!P,B=e.React.useCallback((e=>{e&&j((t=>{const a=e.id;return Object.assign({},t,{[a]:e})}))}),[j]),z=e.React.useCallback((()=>{A({status:k.None,currentDataSourceItemUid:null})}),[A]),W=e.React.useCallback((e=>{A({status:k.ShowDetail,currentDataSourceItemUid:e})}),[A]),J=e.React.useCallback((()=>{A({status:k.AddNew,currentDataSourceItemUid:null})}),[A]),H=e.React.useCallback(((e,t)=>{const a=u.setIn(["dataAttributeInfo","allowGenerated"],t);m({id:c,config:a})}),[u,m,c]),F=e.React.useRef(null),_=e.React.useCallback((e=>{F.current=Date.now(),N.current=D.current,W(e)}),[W]),U=e.React.useCallback((()=>{z()}),[z]),G=e.React.useCallback((()=>{z()}),[z]),K=e.React.useCallback((e=>{P&&P.uid===e&&z();const a=g.filter((t=>t.uid!==e)),n=u.setIn(["dataAttributeInfo","dataSourceItems"],a),s=t(n);m({id:c,config:n,useDataSources:s})}),[u,P,g,m,z,c]),Q=[];M.current&&Q.push(M.current),L.current&&Q.push(L.current);const $=null==E?void 0:E.currentDataSourceItemUid,X=e.React.useCallback((e=>{var t;const a=null===(t=null==e?void 0:e.props)||void 0===t?void 0:t.itemJsons,n=(null==a?void 0:a.length)>0?a[0]:null;if(n){let e=null;const t=n.itemKey;if(t)if(t===$)N.current=null,z();else{if((null==g?void 0:g.length)>0){const a=g.findIndex((e=>(null==e?void 0:e.uid)===t));if(a>=0){const t=L.current.getElementsByClassName("jimu-tree-item__body");t&&t.length>0&&a<=t.length-1&&(e=t[a])}}N.current=e,W(t)}}}),[$,g,z,W]),Y=e.React.useMemo((()=>{const e=[];return y.forEach((t=>{var a,n;const s=t.useDataSource.dataSourceId,l=!(!P||s!==P.useDataSource.dataSourceId);let o="";const i=w[s];i&&(o=i.getLabel());const r=[{label:v("remove"),iconProps:()=>({icon:p(),size:12}),action:({data:e})=>{const t=null==e?void 0:e.itemJsons,a=(null==t?void 0:t.length)>0?t[0]:null;if(a){const e=a.itemKey;K(e)}}}];(null===(n=null===(a=t.sqlExpression)||void 0===a?void 0:a.parts)||void 0===n?void 0:n.length)>0&&r.unshift({label:"",iconProps:{icon:T(),size:16},action:({data:e})=>{X(null==e?void 0:e.refComponent)}});const c={itemKey:t.uid,itemStateChecked:l,itemStateTitle:o,itemStateCommands:r};e.push(c)})),e}),[P,w,y,K,X,v]),Z=!h&&!x(),ee=e.React.useId();return(0,e.jsx)(e.React.Fragment,null,g.map((t=>{const a=t.useDataSource;return(0,e.jsx)(e.DataSourceComponent,{key:a.dataSourceId,useDataSource:a,onDataSourceCreated:B})})),(0,e.jsx)(l.SettingRow,null,(0,e.jsx)("div",{className:"w-100",ref:M},(0,e.jsx)(s.Button,{className:"w-100 text-default set-link-btn",onClick:J,type:"primary","aria-label":v("newData"),"aria-describedby":ee,ref:D},(0,e.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,e.jsx)(s.Icon,{icon:r(),className:"mr-1",size:14}),v("newData"))))),Z&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(O,{text:v("noDataSourceTooltip"),style:{height:"calc(100% - 15rem)"}}),(0,e.jsx)("span",{id:ee,className:"d-none"},v("noDataSourceTooltip"))),h&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(l.SettingRow,{flow:"wrap",label:v("selectableLayers"),"aria-label":v("selectableLayers"),role:"group"},(0,e.jsx)(C,{checked:S,titleKey:"allowGeneratedData",onSwitchChange:H})),(0,e.jsx)(l.SettingRow,null,(0,e.jsx)("div",{className:"w-100",ref:L},(0,e.jsx)(o.List,{dndEnabled:!1,showCheckbox:!1,itemsJson:Y,onClickItemBody:(e,t)=>{X(t)}})))),(0,e.jsx)(l.SidePopper,{isOpen:V,toggle:U,position:"right",trigger:Q,backToFocusNode:q?null:D.current,title:v("configureLayerAttribute")},V&&(0,e.jsx)(I,{rootSettingProps:i,onSelectNewDataSourceItem:_})),(0,e.jsx)(l.SidePopper,{isOpen:q,toggle:G,position:"right",trigger:Q,backToFocusNode:N.current,title:v("configureLayerAttribute")},q&&(0,e.jsx)(R,{rootSettingProps:i,currentDataSourceItem:P,lastSelectNewDataSourceItemTimestampRef:F})))}!function(e){e.None="None",e.AddNew="AddNew",e.ShowDetail="ShowDetail"}(k||(k={}));var V=c(62686),q=c(53195),B=c.n(q),z=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const W=t=>{const a=window.SVG,{className:n}=t,s=z(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:B()},s)):e.React.createElement("svg",Object.assign({className:l},s))};var J=c(72529),H=c.n(J),F=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const _=t=>{const a=window.SVG,{className:n}=t,s=F(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:H()},s)):e.React.createElement("svg",Object.assign({className:l},s))};var U=c(93303),G=c.n(U),K=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const Q=t=>{const a=window.SVG,{className:n}=t,s=K(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:G()},s)):e.React.createElement("svg",Object.assign({className:l},s))};var $=c(30655),X=c.n($),Y=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const Z=t=>{const a=window.SVG,{className:n}=t,s=Y(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:X()},s)):e.React.createElement("svg",Object.assign({className:l},s))};var ee=c(94064),te=c.n(ee),ae=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const ne=t=>{const a=window.SVG,{className:n}=t,s=ae(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:te()},s)):e.React.createElement("svg",Object.assign({className:l},s))};var se=c(28996),le=c.n(se),oe=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const ie=t=>{const a=window.SVG,{className:n}=t,s=oe(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:l,src:le()},s)):e.React.createElement("svg",Object.assign({className:l},s))};function re(t){var a,o;const{jimuMapView:i,currentDataSourceItem:r,onLayerItemDetailUpdate:c}=t,{jimuLayerViewId:u}=r,d=i.jimuLayerViews[u],p=(0,e.Immutable)(r),m=p.sqlHint||"",f=e.hooks.useTranslation(s.defaultMessages,n),[g,S]=e.React.useState(!1),[b,y]=e.React.useState(null);let h=(null===(a=p.sqlExpression)||void 0===a?void 0:a.displaySQL)||"";p.sqlExpression&&b&&(h=null===(o=e.dataSourceUtils.getArcGISSQL(p.sqlExpression,b))||void 0===o?void 0:o.displaySQL),h=h||"",e.React.useEffect((()=>{d&&d.createLayerDataSource().then((e=>{y(e)})).catch((e=>{console.error("LayerItemDetail create data source err",e)}))}),[d]);const v=e.React.useCallback((e=>{const t=e.target.value,a=p.set("sqlHint",t);c(a)}),[p,c]),w=e.React.useCallback((()=>{S(!0)}),[S]),x=e.React.useCallback((()=>{S(!1)}),[S]),I=e.React.useCallback((e=>{const t=p.set("sqlExpression",e);c(t)}),[p,c]),R=e.React.useId();return e.React.createElement("div",null,e.React.createElement(l.SettingSection,{title:f("labelForAttribution")},e.React.createElement(l.SettingRow,null,e.React.createElement(s.TextInput,{className:"w-100",size:"sm",value:m,"aria-label":f(m?"labelForAttribution":"addAttributionTip"),onChange:v}))),e.React.createElement(l.SettingSection,{title:f("sqlExpr"),"aria-label":f("sqlExpr"),role:"group"},e.React.createElement(l.SettingRow,{flow:"wrap",truncateLabel:!0,label:f("addSqlExprForSelection")},e.React.createElement("span",{id:R,className:"d-none"},f("addSqlExprForSelection")),e.React.createElement(s.Button,{className:"w-100 text-default set-link-btn",type:"primary",disabled:!1,onClick:w,title:f("sqlExpressionBuilder"),"aria-describedby":R},f("sqlExpressionBuilder"))),e.React.createElement(l.SettingRow,null,e.React.createElement(s.TextArea,{height:80,value:h,spellCheck:!1,readOnly:!0,placeholder:h?"":f("addSqlExprFirst"),onClick:e=>{e.currentTarget.select()}})),b&&e.React.createElement(j.SqlExpressionBuilderPopup,{dataSource:b,isOpen:g,toggle:x,expression:p.sqlExpression,onChange:I})))}var ce;!function(e){e.Intersects="Intersects",e.Contains="Contains",e.Crosses="Crosses",e.EnvelopeIntersects="EnvelopeIntersects",e.IndexIntersects="IndexIntersects",e.Overlaps="Overlaps",e.Touches="Touches",e.Within="Within"}(ce||(ce={}));ce.Intersects,ce.Contains,ce.Crosses,ce.EnvelopeIntersects,ce.IndexIntersects,ce.Overlaps,ce.Touches,ce.Within;const ue={[ce.Intersects]:"spatialRelation_Intersect",[ce.Contains]:"spatialRelation_Contain",[ce.Crosses]:"spatialRelation_Cross",[ce.EnvelopeIntersects]:"spatialRelation_EnvelopeIntersect",[ce.IndexIntersects]:"spatialRelation_IndexIntersect",[ce.Overlaps]:"spatialRelation_Overlap",[ce.Touches]:"spatialRelation_Touch",[ce.Within]:"spatialRelation_Within"};var de;!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(de||(de={}));de.Miles,de.Kilometers,de.Feet,de.Meters,de.NauticalMiles;function pe(){return{enable:!1,distance:0,unit:de.Meters}}function me(){const e=pe();return{enable:!1,useDataSources:[],relationships:[ce.Intersects],buffer:e}}var fe;function ge(){return{tools:[fe.Rectangle],partiallyWithin:!0}}!function(e){e.Point="point",e.Polyline="polyline",e.Rectangle="rectangle",e.Circle="circle",e.Polygon="polygon"}(fe||(fe={}));var Se=function(e,t,a,n){return new(a||(a=Promise))((function(s,l){function o(e){try{r(n.next(e))}catch(e){l(e)}}function i(e){try{r(n.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}r((n=n.apply(e,t||[])).next())}))};const be=e.css`
  .map-layers-header-setting-row.jimu-widget-setting--row-label {
    margin-top: 0 !important;
  }

  .map-layers-header-setting-row {
    width: calc(100% - 22px);
    max-width: calc(100% - 22px);

    .jimu-widget-setting--row-label {
      width: 100%;
      flex-basis: 100%;
      flex-shrink: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .map-title-icon-container {
      flex-wrap: no-wrap;
      flex-shrink: 0;
      flex-grow: 0;
      justify-content: flex-end;
      min-width: 20px;

      .setting-loading-container {
        position: relative;
        height: 16px;
        width: 16px;

        .donut-loading {
          width: 16px !important;
          height: 16px !important;
          left: 0 !important;
          right: 0 !important;
          top: 0 !important;
          bottom: 0 !important;
        }
      }
    }
  }
`;function ye(t){var a,i;const{jimuMapView:r,onJimuMapViewConfigInfoChange:c}=t,u=t.jimuMapViewConfigInfo||function(){const t={syncWithMap:!0,allowGenerated:!0,enableAttributeSelection:!1,dataSourceItems:void 0};return(0,e.Immutable)(t)}(),d=!!u.syncWithMap,p=!!u.allowGenerated,m=!!u.enableAttributeSelection,f=null===(a=t.jimuMapViewConfigInfo)||void 0===a?void 0:a.dataSourceItems,g=e.hooks.useTranslation(s.defaultMessages,n),b=e.DataSourceManager.getInstance().getDataSource(r.dataSourceId),w=(null==b?void 0:b.getLabel())||"",x=r.id,I=e.React.useRef(x);I.current=x;const j="3d"===(null===(i=r.view)||void 0===i?void 0:i.type),[R,D]=e.React.useState(!1),M=!f,L=e.React.useRef(M);L.current=M;const N=e.React.useMemo((()=>(0,e.Immutable)(f||[])),[f]),E=e.React.useMemo((()=>{const e=[];return N.forEach((t=>{e.push(t.jimuLayerViewId)})),e}),[N]),[O,k]=e.React.useState(!1),A=e.React.useRef(null),[P,V]=e.React.useState([]),[q,B]=e.React.useState(""),z=e.React.useMemo((()=>{const e={};return P.forEach((t=>{e[t.id]=!0;t.getAllAncestorJimuLayerViews().forEach((t=>{e[t.id]=!0}))})),e}),[P]),J=e.React.useMemo((()=>q?N.find((e=>e.jimuLayerViewId===q)):null),[q,N]),H=e.React.useCallback(((e,t)=>{const a=!t;let n=u.set("syncWithMap",a);a&&(n=n.set("allowGenerated",!0).set("enableAttributeSelection",!1).set("dataSourceItems",void 0)),c(x,n)}),[u,x,c]),F=e.React.useCallback(((e,t)=>{const a=u.set("allowGenerated",t);c(x,a)}),[u,x,c]),U=e.React.useCallback(((e,t)=>{let a=u.set("enableAttributeSelection",t);if(!t){const e=N.map((e=>e.set("sqlExpression",null)));a=a.set("dataSourceItems",e)}c(x,a)}),[N,u,x,c]),G=e.React.useCallback((e=>{const t=u.set("dataSourceItems",e);c(x,t)}),[u,x,c]),K=e.React.useCallback((t=>{const a=v(r,t),n=(0,e.Immutable)(a);G(n)}),[r,G]),$=e.React.useRef();$.current=K;const[X,Y]=e.React.useState(!1),ee=e.React.useRef(null),te=e.React.useRef(null),ae=e.React.useCallback((e=>{var t;let a=null;if(m){const n=null===(t=null==e?void 0:e.props)||void 0===t?void 0:t.itemJsons,s=(null==n?void 0:n.length)>0?n[0]:null,l=(null==n?void 0:n.length)>1?n[1]:null;if(s){const e=s.itemKey;if(e)if(e===q)B("");else if(B(e),ee.current&&l&&l.length>0&&l.indexOf){const e=l.indexOf(s);if(e>=0){const t=ee.current.getElementsByClassName("jimu-tree-item__body");t&&t.length>0&&e<=t.length-1&&(a=t[e])}}}}te.current=a}),[q,m]),se=e.React.useCallback(((t,a)=>{var n;const s=null===(n=null==a?void 0:a.props)||void 0===n?void 0:n.itemJsons;if((null==s?void 0:s.length)>=2){const t=s[1];if((null==t?void 0:t.length)>0){const a={},n=[];N.forEach((e=>{const t=null==e?void 0:e.jimuLayerViewId;t&&(a[t]=e,n.push(t))}));const s=n.join(","),l=[];t.forEach((e=>{const t=null==e?void 0:e.itemKey;t&&l.push(t)}));if(l.join(",")!==s){const t=[];l.forEach((e=>{const n=a[e];n&&t.push(n)}));const n=(0,e.Immutable)(t);G(n)}}}}),[N,G]),le=e.React.useMemo((()=>{const e=[];return N.forEach((t=>{var a,n;const{jimuLayerViewId:s,sqlExpression:l}=t;if(!s)return;const o=P.find((e=>e.id===s));if(!o)return;const i=!(!s||s!==q),r=(null===(a=o.layer)||void 0===a?void 0:a.title)||"";let c=[];(null===(n=null==l?void 0:l.parts)||void 0===n?void 0:n.length)>0&&(c=[{label:"",iconProps:{icon:T(),size:16},action:({data:e})=>{ae(null==e?void 0:e.refComponent)}}]);const u={itemKey:s,itemStateChecked:i,itemStateDisabled:!1,itemStateTitle:r,itemStateCommands:c};e.push(u)})),e}),[P,q,ae,N]);e.React.useEffect((()=>{!function(){Se(this,void 0,void 0,(function*(){const t=r.id,a=yield r.whenAllJimuLayerViewLoaded(),n=Object.values(a).filter((t=>!t.fromRuntime&&function(t){if(!t||!t.type)return!1;const a=t.type,n=a!==e.JSAPILayerTypes.BuildingComponentSublayer||a===e.JSAPILayerTypes.BuildingComponentSublayer&&t.view;return!(!S.includes(a)||!n)}(t))),s=n.map((e=>e.createLayerDataSource()));try{yield Promise.all(s)}catch(e){console.log(e)}var l;r.isActive||(yield(l=500,new Promise((e=>{setTimeout((()=>{e()}),l)}))));const o=n.filter((e=>!!e.getLayerDataSource()));I.current===t&&(V(o),D(!0))}))}()}),[r]),e.React.useEffect((()=>{if(R&&L.current&&!d){const t=P.filter((t=>{var a,n;if(!t.isLayerVisible())return!1;if(t.type===e.JSAPILayerTypes.SubtypeGroupLayer){if((null===(n=null===(a=t.layer)||void 0===a?void 0:a.sublayers)||void 0===n?void 0:n.length)>0)return!1}return!0})),a=t.map((e=>he(e)));$.current&&$.current(a)}}),[P,R,d]);const oe=e.React.useCallback((()=>{k(!0)}),[]),ce=e.React.useCallback((()=>{Y((e=>!e))}),[]),ue=e.React.useCallback((()=>{B("")}),[B]),de=e.React.useCallback((e=>{const t=N.map((t=>e.jimuLayerViewId&&t.jimuLayerViewId===e.jimuLayerViewId?e:t));G(t)}),[N,G]),pe=e.React.useCallback((()=>{k(!1)}),[]),me=e.React.useCallback((e=>{const t=e.id;return!z[t]}),[z]),fe=e.React.useCallback((e=>!P.includes(e)),[P]),ge=[];A.current&&ge.push(A.current);const ye=e.React.useId(),ve=!(!r||!J);return(0,e.jsx)("div",{className:"map-layers-setting",css:be},(0,e.jsx)("div",{className:"map-layers-header w-100 d-flex align-items-center mt-4"},j&&(0,e.jsx)(_,{className:"mr-2"}),!j&&(0,e.jsx)(W,{className:"mr-2"}),(0,e.jsx)(l.SettingRow,{flow:"no-wrap",className:"map-layers-header-setting-row w-100",label:(0,e.jsx)("span",{id:ye,title:w},w)},(0,e.jsx)("div",{className:"map-title-icon-container d-flex align-items-center"},!R&&(0,e.jsx)("div",{className:"setting-loading-container"},(0,e.jsx)(s.Loading,{type:s.LoadingType.Donut})),R&&0===P.length&&(0,e.jsx)(s.Tooltip,{id:ye,title:g("noAvailableLayers"),showArrow:!1,placement:"top"},(0,e.jsx)("span",null,(0,e.jsx)(s.Button,{className:"border-0",disabled:!R,type:"tertiary",icon:!0,size:"sm"},(0,e.jsx)(ie,{size:16,color:"var(--sys-color-warning-main)"})))),R&&P.length>0&&(0,e.jsx)(s.Tooltip,{title:g("customizeLayers"),showArrow:!1,placement:"top"},(0,e.jsx)(s.Button,{ref:A,"aria-haspopup":"dialog","aria-describedby":ye,className:"map-layers-setting-btn p-0 border-0",disabled:!R,type:"tertiary",icon:!0,size:"sm",onClick:oe},(0,e.jsx)(Q,{size:16}))),!d&&R&&P.length>0&&(0,e.jsx)(s.Button,{className:"layer-list-toggle-btn ml-1 p-0 border-0",type:"tertiary",icon:!0,title:g(X?"collapse":"expand"),"aria-label":g(X?"collapse":"expand"),"aria-expanded":X,size:"sm",onClick:ce},X&&(0,e.jsx)(ne,{size:16}),!X&&(0,e.jsx)(Z,{size:16}))))),!d&&(0,e.jsx)("div",{className:"w-100 customized-layer-list",ref:ee},(0,e.jsx)(o.List,{className:(0,e.classNames)(["w-100 mt-1",{"d-none":!X}]),dndEnabled:!0,showCheckbox:!1,itemsJson:le,onClickItemBody:(e,t)=>{ae(t)},onDidDrop:se})),(0,e.jsx)(l.SidePopper,{isOpen:O,toggle:pe,position:"right",trigger:ge,backToFocusNode:A.current,title:g("customizeLayers")},O&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(l.SettingRow,{className:"w-100 pl-4 pr-4",label:w,"aria-label":w}),(0,e.jsx)(l.SettingRow,{flow:"wrap",className:"w-100 pl-4 pr-4","aria-label":w},(0,e.jsx)(C,{checked:!d,titleKey:"customizeLayers",onSwitchChange:H}),(0,e.jsx)(C,{disabled:d,checked:y(d,p),titleKey:"allowGeneratedData",className:"mt-3",onSwitchChange:F}),(0,e.jsx)(C,{disabled:d,checked:h(d,m),titleKey:"attributeSelection",className:"mt-3",onSwitchChange:U})),!d&&(0,e.jsx)("div",{className:"select-jimu-layer-view-selector-container p-4"},(0,e.jsx)(l.JimuLayerViewSelector,{jimuMapViewId:x,isMultiSelection:!0,selectedValues:E.slice(),hideLayers:me,disableLayers:fe,onChange:t=>{t=Array.from(new Set(t));let a=[];const n=N.map((e=>e.jimuLayerViewId)).asMutable(),{added:s}=e.utils.diffArrays(!0,n,t);s.forEach((t=>{var n;if(t){const s=null===(n=r.jimuLayerViews)||void 0===n?void 0:n[t];if(s)if(s.type===e.JSAPILayerTypes.SubtypeGroupLayer){const e=r.getChildJimuLayerViewIds(s.id);a.push(...e)}else s.type===e.JSAPILayerTypes.SubtypeSublayer&&s.parentJimuLayerViewId&&a.push(s.parentJimuLayerViewId)}})),a=Array.from(new Set(a)),t=t.filter((e=>!a.includes(e))),t=Array.from(new Set(t));const l=P.map((e=>e.id));let{saved:o}=e.utils.diffArrays(!0,t,l);o=Array.from(new Set(o));const i={};N.forEach((e=>{const t=e.jimuLayerViewId;i[t]=e.asMutable()}));const c=[];o.forEach((e=>{let t=i[e];if(!t&&r){const a=r.jimuLayerViews[e];a&&(t=he(a))}t&&c.push(t)}));const u=(0,e.Immutable)(c);G(u)}})))),(0,e.jsx)(l.SidePopper,{isOpen:ve,toggle:ue,position:"right",trigger:ee.current,backToFocusNode:te.current,title:g("configureLayerAttribute")},ve&&(0,e.jsx)(re,{jimuMapView:r,currentDataSourceItem:J,onLayerItemDetailUpdate:de})))}function he(t){const a=(0,e.uuidv1)(),n=function(e){const t=e.getLayerDataSource(),a=t.id,n=t.getMainDataSource(),s=t.getRootDataSource(),l=n?n.id:a,o=s?s.id:"",i={dataSourceId:a,mainDataSourceId:l,rootDataSourceId:o};return i}(t);return{uid:a,sqlHint:"",useDataSource:n,sqlExpression:null,jimuLayerViewId:t.id}}function ve(a){const{rootSettingProps:o}=a,{id:i,config:r,useMapWidgetIds:c,onSettingChange:u}=o,d=r.mapInfo||function(){const t={};return(0,e.Immutable)(t)}(),p=e.hooks.useTranslation(s.defaultMessages,n),m=c&&c.length>0?c[0]:"",[f,g]=e.React.useState([]),S=e.React.useCallback((e=>{e||(e=[]);const a=r.set("mapInfo",{}),n=t(a);u({id:i,config:a,useMapWidgetIds:e,useDataSources:n})}),[r,u,i]);e.React.useEffect((()=>{g((e=>e.filter((e=>e.mapWidgetId===m))))}),[m,g]);const b=e.React.useCallback((e=>{const t=Object.values(e).filter((e=>e.dataSourceId&&e.mapWidgetId===m));g(t)}),[m,g]),y=e.React.useCallback(((e,a)=>{const n=d.set(e,a),s=r.set("mapInfo",n),l=t(s);u({id:i,config:s,useDataSources:l})}),[r,d,u,i]),h=function(t){const a=[];if(t){const s=window.jimuConfig.isBuilder?null===(n=(0,e.getAppStore)().getState().appStateInBuilder)||void 0===n?void 0:n.appConfig:(0,e.getAppStore)().getState().appConfig;if(s.widgets){const e=s.widgets[t];if(e){const n=e.useDataSources;n&&n.length>0&&n.forEach((e=>{const n=null==e?void 0:e.dataSourceId;if(n){const e=t+"-"+n;a.push(e)}}))}}}var n;return a}(m),v=(Object.keys(d)||[]).filter((e=>!h.includes(e)));e.React.useEffect((()=>{if(v.length>0){const e=d.without(...v),a=r.set("mapInfo",e),n=t(a);u({id:i,config:a,useDataSources:n})}}),[r,d,v,u,i]);const w=0===v.length,I=!m&&!x(),j=e.React.useId();return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(l.SettingRow,null,(0,e.jsx)(l.MapWidgetSelector,{useMapWidgetIds:c,"aria-describedby":j,onSelect:S})),I&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("span",{id:j,className:"d-none"},p("selectMapHint")),(0,e.jsx)(O,{text:p("selectMapHint"),style:{height:"calc(100% - 15rem)"}})),m&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(V.JimuMapViewComponent,{useMapWidgetId:m,onViewsCreate:b}),w&&0===f.length&&(0,e.jsx)(s.Alert,{closable:!1,className:"w-100 mt-4",form:"basic",text:p("noWebMapWebSceneTip"),type:"warning",withIcon:!1}),w&&f.map((t=>(0,e.jsx)(ye,{key:t.id,jimuMapView:t,jimuMapViewConfigInfo:d[t.id],onJimuMapViewConfigInfoChange:y})))))}const we=e.css`
.select-source-type-radio {
  cursor: pointer;
}

.select-source-type-label {
  cursor: pointer;
  word-break: break-all;
}
`;function xe(t){const{rootSettingProps:a,showPlaceholder:o,onConfigUpdate:i}=t,{config:r}=a,c=e.hooks.useTranslation(s.defaultMessages,n),u=!r.useMap,d=r.useMap,p=e.React.useCallback((e=>{let t=r.set("useMap",!1);if(!t.dataAttributeInfo){const e={allowGenerated:!1,dataSourceItems:[]};t=t.set("dataAttributeInfo",e)}t=t.set("mapInfo",{}),i(t)}),[r,i]),m=e.React.useCallback((e=>{let t=r.set("useMap",!0);if(!t.mapInfo){const e={};t=t.set("mapInfo",e)}t.dataAttributeInfo&&(t=t.setIn(["dataAttributeInfo","dataSourceItems"],[])),i(t)}),[r,i]),f=o?"h-100":"";return(0,e.jsx)(l.SettingSection,{title:c("sourceLabel"),className:f,css:we},(0,e.jsx)(l.SettingRow,null,(0,e.jsx)("div",{className:"source-radios",role:"radiogroup","aria-label":c("sourceLabel")},(0,e.jsx)("div",{className:"source-radio d-flex"},(0,e.jsx)(s.Radio,{id:"select-source-ds-radio",name:"select-source",checked:u,className:"select-source-type-radio",onChange:p}),(0,e.jsx)(s.Label,{for:"select-source-ds-radio",className:"ml-1 select-source-type-label","aria-label":c("selectByAttrbute")},c("selectByAttrbute"))),(0,e.jsx)("div",{className:"source-radio d-flex mt-3"},(0,e.jsx)(s.Radio,{id:"select-source-map-radio",name:"select-source",checked:d,className:"select-source-type-radio",onChange:m}),(0,e.jsx)(s.Label,{for:"select-source-map-radio",className:"ml-1 select-source-type-label","aria-label":c("interactWithMap")},c("interactWithMap"))))),u&&(0,e.jsx)(P,{rootSettingProps:a,showPlaceholder:o}),d&&(0,e.jsx)(ve,{rootSettingProps:a,showPlaceholder:o}))}function Ie(t){const{rootSettingProps:a,onSpatialSelectionUpdate:o}=t,{id:i}=a,r=e.hooks.useTranslation(s.defaultMessages,n),c=e.React.useMemo((()=>{let a=t.imSpatialSelection;return a||(a=(0,e.Immutable)(me())),a.useDataSources||(a=a.set("useDataSources",[])),a.buffer||(a=a.set("buffer",pe)),a}),[t]);let u=null,d=null,p=!1,f=0,S=null;const b=!!c.enable;if(b){if(u=c.useDataSources,c.relationships){const t=[];c.relationships.forEach((e=>{t.push(e)})),d=(0,e.Immutable)(t)}c.buffer&&(p=!!c.buffer.enable,f=c.buffer.distance,S=c.buffer.unit)}u||(u=(0,e.Immutable)([])),d||(d=(0,e.Immutable)([])),"number"!=typeof f&&(f=0),S||(S=de.Meters);const y=e.React.useMemo((()=>(0,e.Immutable)(Object.entries(ce).map((([e,t])=>({value:t,label:r(ue[t])}))))),[r]),h=e.React.useCallback(((e,t)=>{let a=c.set("enable",t);t||(a=a.set("useDataSources",[])),o(a)}),[c,o]),v=e.React.useCallback((t=>{const a=u.map((e=>e.dataSourceId)).asMutable(),n=t.map((e=>e.dataSourceId)),{added:s,deleted:l}=e.utils.diffArrays(!0,a,n),i=[];s.length>0&&0===l.length&&s.forEach((e=>{const a=t.find((t=>t.dataSourceId===e));a&&!a.dataViewId&&i.push(e)}));let r=null;if(i.length>0){const a=e.DataSourceManager.getInstance();r=t.map((t=>{if(i.includes(t.dataSourceId)){const n=Object.assign({},t),s=e.CONSTANTS.SELECTION_DATA_VIEW_ID;return n.dataViewId=s,n.dataSourceId=a.getDataViewDataSourceId(t.mainDataSourceId,s),n}return t}))}else r=t;const d=c.set("useDataSources",r);o(d)}),[c,u,o]),w=e.React.useCallback((e=>r("numSelected",{number:e.length})),[r]),I=e.React.useCallback(((e,t)=>{if(0===t.length)return;const a=c.set("relationships",t);o(a)}),[c,o]),j=e.React.useCallback(((e,t)=>{const a=c.setIn(["buffer","enable"],t);o(a)}),[c,o]),R=e.React.useCallback((e=>{const t=c.setIn(["buffer","distance"],e);o(t)}),[c,o]),D=e.React.useCallback((e=>{const t=e.target.value,a=c.setIn(["buffer","unit"],t);o(a)}),[c,o]),M=x()?r("selectionViewOnly"):"";return(0,e.jsx)(l.SettingSection,{role:"group","aria-label":r("spatialSelection"),title:""},(0,e.jsx)(s.CollapsablePanel,{label:r("spatialSelection"),level:1,type:"default"},(0,e.jsx)(C,{titleKey:"selectByData",checked:b,className:"title3 text-default mt-4",onSwitchChange:h}),(0,e.jsx)(s.Collapse,{isOpen:b},(0,e.jsx)(l.SettingRow,{flow:"wrap",truncateLabel:!0,label:M,className:"mt-4"},(0,e.jsx)(m.DataSourceSelector,{buttonLabel:r("addSelectingData"),widgetId:i,types:g,isMultiple:!0,disableDataView:!1,isMultipleDataView:!1,disableDataSourceList:!1,mustUseDataSource:!0,useDataSources:u,onChange:v})),(0,e.jsx)(l.SettingRow,{flow:"wrap",label:r("relationship")},(0,e.jsx)(s.MultiSelect,{"aria-label":r("relationship"),values:d,onChange:I,displayByValues:w,size:"sm"},y.map((t=>(0,e.jsx)(s.MultiSelectItem,{key:t.value,value:t.value,label:t.label}))))),(0,e.jsx)(l.SettingRow,{tag:"label",label:r("enableBuffer")},(0,e.jsx)(s.Switch,{checked:p,onChange:j})),p&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(l.SettingRow,{label:r("defaultDistance")},(0,e.jsx)(s.NumericInput,{css:e.css`
                    width: 40%;
                    flex: 0 0 40%;
                    flex-shrink: 0;
                    flex-grow: 0;
                  `,"aria-label":r("defaultDistance"),size:"sm",min:0,value:f,onChange:R})),(0,e.jsx)(l.SettingRow,{label:r("defaultUnit")},(0,e.jsx)(s.Select,{css:e.css`
                    width: 40%;
                    flex: 0 0 40%;
                    flex-shrink: 0;
                    flex-grow: 0;
                  `,size:"sm",value:S,"aria-label":r("defaultUnit"),onChange:D},Object.values(de).map((t=>(0,e.jsx)("option",{key:t,value:t},r(`unit_${t}`))))))))))}const je=e.css`
  .jimu-widget-setting--section.interactive-tools-setting-section,
  .jimu-widget-setting--section.interactive-selection-mode-setting-section {
    border-bottom: none;

    .jimu-widget-setting--section-header > * {
      font-size: 0.8125rem !important;
    }

    label.jimu-widget-setting--row:first-of-type {
      margin-top: 8px !important;
    }
  }

  .tool-alert-container {
    position: relative;
    min-height: 0.1px;

    .tool-alert {
      position: absolute;
      left: 0;
      top: 0;
      z-index: 1;
    }
  }
`;function Re(t){const{onInteractiveToolSectionUpdate:a}=t,o=e.hooks.useTranslation(s.defaultMessages,n),[i,r]=e.React.useState(!1),c=e.React.useRef(null),u=()=>{c.current&&(clearTimeout(c.current),c.current=null)};e.React.useEffect((()=>()=>{c.current&&(clearTimeout(c.current),c.current=null)}),[]);const d=e.React.useMemo((()=>{let a=t.imInteractiveTools;return a||(a=(0,e.Immutable)(ge())),a.tools||(a=a.set("tools",[fe.Rectangle])),"boolean"!=typeof a.partiallyWithin&&(a=a.set("partiallyWithin",!0)),a}),[t]),p=d.tools,m=e.React.useMemo((()=>[{value:fe.Rectangle,label:o("SelectionByRectangle")},{value:fe.Polygon,label:o("SelectionByLasso")},{value:fe.Circle,label:o("SelectionByCircle")},{value:fe.Polyline,label:o("SelectionByLine")},{value:fe.Point,label:o("SelectionByPoint")}]),[o]),f=(e,t)=>{let n=p.asMutable();if(t)n.includes(e)||n.push(e);else if(n=n.filter((t=>t!==e)),0===n.length)return r(!0),u(),void(c.current=setTimeout((()=>{r(!1)}),5e3));const s=d.set("tools",n);a(s)},g=e.React.useCallback(((e,t)=>{if(t){const e=d.set("partiallyWithin",!0);a(e)}}),[d,a]),S=e.React.useCallback(((e,t)=>{if(t){const e=d.set("partiallyWithin",!1);a(e)}}),[d,a]);return(0,e.jsx)(l.SettingSection,{role:"group","aria-label":o("interactiveSelection"),title:"",css:je},(0,e.jsx)(s.CollapsablePanel,{label:o("interactiveSelection"),level:1,type:"default"},(0,e.jsx)(l.SettingSection,{role:"group","aria-label":o("tools"),title:o("tools"),className:"pl-0 pr-0 pt-4 pb-0 interactive-tools-setting-section"},m.map((t=>(0,e.jsx)(l.SettingRow,{key:t.value,tag:"label",label:t.label,level:3,className:"mt-3"},(0,e.jsx)(s.Switch,{checked:p.includes(t.value),onChange:(e,a)=>{f(t.value,a)}}))))),(0,e.jsx)("div",{className:"tool-alert-container mt-2 mb-2"},(0,e.jsx)(s.Alert,{closable:!0,className:"tool-alert w-100",form:"basic",onClose:()=>{u(),r(!1)},open:i,text:o("atLeastOneToolTip"),type:"warning",withIcon:!0})),(0,e.jsx)(l.SettingSection,{role:"radiogroup","aria-label":o("interactiveSelectionMode"),title:o("interactiveSelectionMode"),className:"p-0 interactive-selection-mode-setting-section"},(0,e.jsx)(s.Label,{className:"w-100 d-flex align-items-center mt-2"},(0,e.jsx)(s.Radio,{name:"select-widget-interactive-selection-mode",className:"mr-2",checked:d.partiallyWithin,onChange:g}),o("partiallyWithin")),(0,e.jsx)(s.Label,{className:"w-100 d-flex align-items-center"},(0,e.jsx)(s.Radio,{name:"select-widget-interactive-selection-mode",className:"mr-2",checked:!d.partiallyWithin,onChange:S}),o("whollyWithin")))))}const Ce=e.css`
`;function De(a){var n;const{config:s,useMapWidgetIds:l,useDataSources:o}=a,i=s.useMap,r=e.React.useCallback((e=>{const n=t(e),s={id:a.id,config:e,useDataSources:n};i&&!e.useMap&&(s.useMapWidgetIds=null),a.onSettingChange(s)}),[a,i]),c=null===(n=null==s?void 0:s.dataAttributeInfo)||void 0===n?void 0:n.dataSourceItems,u=e.React.useMemo((()=>b(c,o)),[c,o]),d=(null==u?void 0:u.length)>0,p=l&&l.length>0?l[0]:"",m=i&&p,f=i&&p||!i&&d,g=i&&!p||!i&&!d;return(0,e.jsx)("div",{className:"jimu-widget-setting widget-setting-select",css:Ce},(0,e.jsx)(xe,{rootSettingProps:a,showPlaceholder:g,onConfigUpdate:r}),m&&(0,e.jsx)(Re,{rootSettingProps:a,imInteractiveTools:s.interactiveTools,onInteractiveToolSectionUpdate:e=>{const t=s.set("interactiveTools",e);r(t)}}),f&&(0,e.jsx)(Ie,{rootSettingProps:a,imSpatialSelection:s.spatialSelection,onSpatialSelectionUpdate:e=>{const t=s.set("spatialSelection",e);r(t)}}))}function Me(e){c.p=e}})(),u})())}}}));