"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_ba-infographic_node_modules_arcgis_business-analyst-components_dis-8c7a7a"],{4257:(e,t,i)=>{i.r(t),i.d(t,{buffer_drivetime_settings:()=>r});var o=i(8796),s=i(983),a=i(4280);const r=class{get el(){return(0,o.g)(this)}baseConfig;_localeSettings={};_popoverIsOpen=!1;_instanceId;_idPrefix="buffer-drivetime-settings-selector-";_elementIds={};_idButtonPrefix="drivetime-settings-selector-dropdown-button-";_idDropdownArrowPrefix="drivetime-settings-selector-dropdown-arrow-";_idDropdownLabelPrefix="drivetime-settings-selector-dropdown-label-";_idPopoverPrefix="drivetime-settings-selector-popover-";_idPopoverContentPrefix="drivetime-settings-selector-popover-content-";constructor(e){(0,o.r)(this,e),this.selectorPopupOpened=(0,o.c)(this,"selectorPopupOpened",7),this.selectorPopupClosed=(0,o.c)(this,"selectorPopupClosed",7),this.drivetimeOptionsChanged=(0,o.c)(this,"drivetimeOptionsChanged",7),this.colors=void 0,this.theme=void 0,this.langCode=void 0,this.sourceCountry=void 0,this.config=void 0,this.token=void 0,this.env=void 0,this.offsetTime=0,this.offsetHr="12:00 PM",this.offsetDay=s.D.mon,this.travelDirection=s.T.away,this.trafficType=s.b.live,this.useTrafficChecked=!1,this.useTrafficEnabled=!0,this.travelModes=[],this.isLoadingTravelModes=!1,this.stEnv=void 0,this.travelModeData={},this.selectedTravelModeId="FEgifRtFndKNcJMJ",this.lastBufferUnit="",this.baseConfig=new s.a("selector",this,this.onUpdateUI),s.A.announceVersion(),this.langCode=this.langCode||"en-us",s.B._initialize(this.langCode),this.sourceCountry=this.sourceCountry||"US",this.baseConfig.updateLocaleSettings({language:this.langCode,country:this.sourceCountry})}selectorPopupOpened;selectorPopupClosed;drivetimeOptionsChanged;_loadInstances(){this._instanceId||(this._instanceId=s.E.generateId(this._idPrefix).id),this._elementIds.label||(this._elementIds.label=s.E.generateId(this._idDropdownLabelPrefix).id),this._elementIds.button||(this._elementIds.button=s.E.generateId(this._idButtonPrefix).id),this._elementIds.popover||(this._elementIds.popover=s.E.generateId(this._idPopoverPrefix).id),this._elementIds.content||(this._elementIds.content=s.E.generateId(this._idPopoverContentPrefix).id),this._elementIds.arrow||(this._elementIds.arrow=s.E.generateId(this._idDropdownArrowPrefix).id)}setDefaultTravelModeForUnit(){const e=this.baseConfig?.config;if(!e||!this.travelModes.length)return;const t=e.infographicOptions?.bufferUnits;if(!t)return;const i=t.toLowerCase();let o;"minutes"===i?o=this.travelModes.find((e=>e.name.toLowerCase().includes("driving time")))||this.travelModes[0]:"miles"!==i&&"kilometers"!==i||(o=this.travelModes.find((e=>e.name.toLowerCase().includes("driving distance")))||this.travelModes[0]),o&&!this.travelModeData&&(this.travelModeData=o.travelModeData,this.selectedTravelModeId=o.itemId)}handleBufferUnitChange(){const e=this.baseConfig?.config;if(!e||!this.travelModes.length)return;const t=e.infographicOptions?.bufferUnits;if(!t)return;const i=t.toLowerCase();if(!this.travelModeData)return;const o="minutes"===i;if(o!==("object"==typeof this.travelModeData&&null!==this.travelModeData&&"impedanceAttributeName"in this.travelModeData&&"TravelTime"===this.travelModeData.impedanceAttributeName)){let e;e=o?this.travelModes.find((e=>e.name.toLowerCase().includes("driving time")))||this.travelModes[0]:this.travelModes.find((e=>e.name.toLowerCase().includes("driving distance")))||this.travelModes[0],e&&(this.travelModeData=e.travelModeData,this.selectedTravelModeId=e.itemId)}}async loadTravelModes(){if(!this.travelModes.length){this.isLoadingTravelModes=!0;try{const e=await a.G.getTravelModes(this.token,this.stEnv);if(e?.results?.length){const t=e.results.find((e=>"supportedTravelModes"===e.paramName));t?.value?.features?.length&&(this.travelModes=t.value.features.map((e=>{const t=e.attributes;let i={};try{"string"==typeof t.TravelMode&&(i=JSON.parse(t.TravelMode))}catch(e){console.warn("Error parsing TravelMode JSON:",e)}return i.travelModeData&&(console.warn("\u26a0\ufe0f Removing nested travelModeData from travel mode definition:",t.Name),delete i.travelModeData),{name:t.Name||t.AltName||"Unknown Mode",itemId:t.TravelModeId||"",type:i.type||"AUTOMOBILE",description:t.TravelMode||"",travelModeData:i}})))}this.travelModes.length||(console.warn("No travel modes returned; using defaults."),this.travelModes=this.getDefaultTravelModes()),!this.travelModeData&&this.travelModes.length>0&&(this.travelModeData=this.travelModes[0].travelModeData,this.selectedTravelModeId=this.travelModes[0].itemId),this.setDefaultTravelModeForUnit(),this._setDrivetimeDataFromConfig(),this.emitDrivetimeOptionsChanged()}catch(e){console.error("Error loading travel modes:",e),this.travelModes=this.getDefaultTravelModes(),!this.travelModeData&&this.travelModes.length>0&&(this.travelModeData=this.travelModes[0].travelModeData,this.selectedTravelModeId=this.travelModes[0].itemId),this.setDefaultTravelModeForUnit(),this._setDrivetimeDataFromConfig(),this.emitDrivetimeOptionsChanged()}finally{this.isLoadingTravelModes=!1}}}getDefaultTravelModes(){return[{name:"Driving Time",itemId:"FEgifRtFndKNcJMJ",type:"AUTOMOBILE",description:"Models the movement of cars and other similar small automobiles",travelModeData:{impedanceAttributeName:"TravelTime",timeAttributeName:"TravelTime"}},{name:"Rural Driving Time",itemId:"NmNhNDUwZmE1YTlj",type:"AUTOMOBILE",description:"Models car movement but does not discourage travel on unpaved roads",travelModeData:{impedanceAttributeName:"TravelTime",timeAttributeName:"TravelTime"}},{name:"Trucking Time",itemId:"ZzzRtYcPLjXFBKwr",type:"TRUCK",description:"Models basic truck travel by preferring designated truck routes",travelModeData:{impedanceAttributeName:"TruckTravelTime",timeAttributeName:"TruckTravelTime"}}]}async componentWillLoad(){this.config&&this.onConfigChange(this.config,""),this.baseConfig.setTheme(this.theme??"light");const e=this.baseConfig?.config;e?.infographicOptions?.bufferUnits&&(this.lastBufferUnit=e.infographicOptions.bufferUnits),this._setDrivetimeDataFromConfig(),this._loadInstances(),this.applyStyles(),await this.loadTravelModes()}componentDidUpdate(){this.baseConfig?.onComponentHasRendered(),this.applyStyles()}componentDidLoad(){const e=this;requestAnimationFrame((()=>{s.a.Log("buffer-drivetime-settings didLoad"),e._loadInstances();const t=t=>e.onClickDriveOptions(t);["button","label","arrow"].forEach((i=>{const o=e._elementIds[i],a=s.A.queryElementById.call(e.el,o);a&&(a.removeEventListener("click",t),a.addEventListener("click",t))}));const i=()=>e.hidePopover();window.removeEventListener("resize",i),window.addEventListener("resize",i),e.baseConfig?.onComponentHasRendered(),e.applyStyles()}))}applyStyles(){const e=this.baseConfig?.config?.colors;if(!e)return;const t=s.A.queryElement.call(this.el,"calcite-popover");t&&(t.style.setProperty("--calcite-color-foreground-1",e.foreground),t.style.setProperty("background-color",e.foreground),t.style.setProperty("z-index","2003"));const i=s.A.queryElement.call(this.el,"drivetime-settings-selector-dropdown");i?.style.setProperty("border",`solid 1px ${e.border}`);const o=s.A.queryElementAll.call(this,"calcite-segmented-control");o?.forEach((e=>{e.style.setProperty("--calcite-color-border-input","unset"),e.style.setProperty("--calcite-color-brand","#eaeaea"),e.style.setProperty("--calcite-color-text-inverse","#151515")}))}onEnvChanged(){this.stEnv=this.env,a.E.setEnvironment(this.env),this.baseConfig&&this.baseConfig.updateConfig({env:this.env})}onConfigChange(e,t){if(!this.baseConfig||!s.A.hasText(e))return;const i=JSON.parse(e);s.a.LogConfig("drivetime settings config change",i,t),this.baseConfig.updateConfig(i),this.applyStyles();const o=i.infographicOptions?.bufferUnits;o&&o!==this.lastBufferUnit&&(this.lastBufferUnit=o,this.handleBufferUnitChange()),this._drivetimeOptionsHaveChanged(e)&&this._setDrivetimeDataFromConfig()}onSelectedTravelModeIdChanged(e,t){e!==t&&s.a.Log("DRIVETIME-SETTINGS: selectedTravelModeId changed from",t,"to",e)}onUpdateUI(){this.applyStyles()}onClickDriveOptions(e){e.stopPropagation();const t=s.A.queryElementById.call(this.el,this._elementIds.popover),i=s.A.queryElementById.call(this.el,this._elementIds.arrow);if(t){const e=!t.open;t.open=e,this._popoverIsOpen=e,e?(this.selectorPopupOpened.emit(),i?.classList.add("drivetime-settings-selector-drop-open")):(this.selectorPopupClosed.emit(),i?.classList.remove("drivetime-settings-selector-drop-open"))}return!1}showPopover(){const e=s.A.queryElementById.call(this.el,this._elementIds.popover),t=s.A.queryElementById.call(this.el,this._elementIds.arrow);e&&(e.open=!0),this._popoverIsOpen=!0,t?.classList.add("drivetime-settings-selector-drop-open"),this.selectorPopupOpened.emit()}hidePopover(){const e=s.A.queryElementById.call(this.el,this._elementIds.popover),t=s.A.queryElementById.call(this.el,this._elementIds.arrow);e&&(e.open=!1),this._popoverIsOpen=!1,t?.classList.remove("drivetime-settings-selector-drop-open"),this.selectorPopupClosed.emit()}_drivetimeOptionsHaveChanged(e){if(!e)return!1;const t=JSON.parse(e)?.infographicOptions?.drivetimeOptions;if(!t)return!1;let i=!1;return t.travelModeData&&Object.keys(t.travelModeData).length>0&&(i=JSON.stringify(t.travelModeData)!==JSON.stringify(this.travelModeData)),i||t.offsetTime?.toString()!==this.offsetTime.toString()||t.offsetHr!==this.offsetHr||t.offsetDay!==this.offsetDay||t.travelDirection!==this.travelDirection||t.trafficType!==this.trafficType||t.useTrafficEnabled!==this.useTrafficEnabled||t.useTrafficChecked!==this.useTrafficChecked}_setDrivetimeDataFromConfig(){const e=this.baseConfig?.config;if(!e)return void s.a.Log("DRIVETIME-SETTINGS: No config available");const t=e.infographicOptions?.drivetimeOptions;if(t){if(s.a.Log("DRIVETIME-SETTINGS: Processing config drivetimeOptions",t),t.travelModeData&&Object.keys(t.travelModeData).length>0&&null!==t.travelModeData){s.a.Log("DRIVETIME-SETTINGS: Found travelModeData in config",t.travelModeData),s.a.Log("DRIVETIME-SETTINGS: Available travel modes",this.travelModes.length),this.travelModeData=t.travelModeData;let e=this.travelModes.find((e=>e.travelModeData?.id===t.travelModeData?.id));!e&&t.travelModeData?.name&&(e=this.travelModes.find((e=>e.name===t.travelModeData.name))),e||(e=this.travelModes.find((e=>JSON.stringify(e.travelModeData)===JSON.stringify(t.travelModeData)))),e?(this.selectedTravelModeId=e.itemId,s.a.Log("DRIVETIME-SETTINGS: Updated selectedTravelModeId to",e.itemId,"for mode",e.name)):(s.a.Log("DRIVETIME-SETTINGS: No matching travel mode found for",t.travelModeData),s.a.Log("DRIVETIME-SETTINGS: Available modes:",this.travelModes.map((e=>({name:e.name,id:e.itemId})))))}else s.a.Log("DRIVETIME-SETTINGS: No valid travelModeData in config");this.offsetTime=t.offsetTime??0,this.offsetHr=t.offsetHr||s.A.time24ToLocale(this.langCode??"en-us","12:00"),this.offsetDay=t.offsetDay??s.D.mon,this.travelDirection=t.travelDirection?.toString().toLowerCase().includes("away")?s.T.away:s.T.toward,this.trafficType=t.trafficType??s.b.live,this.useTrafficEnabled=!0,this.useTrafficChecked=t.useTrafficChecked??!1}else s.a.Log("DRIVETIME-SETTINGS: No drivetimeOptions in config")}handleDrivetimeOptionChange(e){const t=e.target;switch(t.id){case"travelMode":const e=t.value,i=this.travelModes.find((t=>t.itemId===e));this.travelModeData=i?.travelModeData,this.selectedTravelModeId=e;break;case"travelDirection":this.travelDirection=t.value;break;case"trafficType":this.trafficType=t.value;break;case"useTrafficCheckbox":this.useTrafficChecked=t.checked;break;case"offsetTime":this.offsetTime=Number(t.value);break;case"offsetDay":this.offsetDay=t.value;break;case"offsetHr":this.offsetHr=t.value;break;default:console.warn(`Unhandled drivetime option change (id: ${t.id})`)}this.emitDrivetimeOptionsChanged()}emitDrivetimeOptionsChanged(){const e={offsetTime:this.offsetTime,offsetHr:this.offsetHr,offsetDay:this.offsetDay,travelDirection:this.travelDirection,trafficType:this.trafficType,useTrafficEnabled:!0,useTrafficChecked:this.useTrafficChecked,travelModeData:this.travelModeData};this.drivetimeOptionsChanged.emit(e)}getTimeOffsets(){return[{value:0,label:s.B.i18n("now")},...Array.from({length:48},((e,t)=>{const i=15*(t+1),o=Math.floor(i/60),a=i%60;return{value:i,label:o>0?`+${o} ${s.B.i18n("offsetHr")} ${a>0?a+" "+s.B.i18n("min"):""}`:`+${a} ${s.B.i18n("min")}`}}))]}getDayOptions(){return Object.keys(s.D).map((e=>(0,o.h)("calcite-option",{value:s.D[e],selected:this.offsetDay===s.D[e]},s.B.i18n(e))))}getTimeOptions(){const e=[],t=["AM","PM"];for(let i=0;i<24;i++)for(let o=0;o<4;o++){const s=i%12==0?12:i%12,a=15*o==0?"00":15*o,r=t[Math.floor(i/12)];e.push(`${s}:${a} ${r}`)}return e.map((e=>(0,o.h)("calcite-option",{value:e,selected:this.offsetHr===e},e)))}getFilteredTravelModes(e){let t;if(e)t=e;else{const e=this.baseConfig?.config;t=e?.infographicOptions?.bufferUnits}if(!t)return this.travelModes;const i=t.toLowerCase(),o=["TravelTime","TruckTravelTime"];let s;return s="minutes"===i?["TravelTime","TruckTravelTime"]:["Kilometers","Miles"],this.travelModes.filter((e=>{const t=e.travelModeData?.impedanceAttributeName,i=e.travelModeData?.timeAttributeName;return s.includes(t)&&o.includes(i)}))}getTravelModeOptions(){if(this.isLoadingTravelModes)return(0,o.h)("calcite-option",{value:"",disabled:!0},s.B.i18n("loading")||"Loading...");return this.getFilteredTravelModes().sort(((e,t)=>e.name.localeCompare(t.name))).map((e=>{const t=this.selectedTravelModeId===e.itemId;return(0,o.h)("calcite-option",{value:e.itemId,selected:t,title:e.travelModeData?.description||e.description||""},e.name)}))}render(){const e={paddingTop:"10px"};return(0,o.h)("div",{id:this._instanceId,class:"drivetimeSettingsOuter"},(0,o.h)("div",{id:this._elementIds.button,class:"drivetime-settings-selector-dropdown"},(0,o.h)("div",{id:this._elementIds.label,class:"drivetime-settings-selector-dropdown-label"},s.B.i18n("driveTimeOptions")),(0,o.h)("svg",{id:this._elementIds.arrow,class:"drivetime-settings-selector-dropdown-arrow",width:"24",height:"24",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,o.h)("path",{fill:"currentColor","fill-rule":"evenodd",stroke:"currentColor",d:"M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738Z","clip-rule":"evenodd"}))),(0,o.h)("calcite-popover",{id:this._elementIds.popover,style:{position:"absolute",top:"0px",left:"0px",transform:"translate(-312px, 7px)",border:"none",boxShadow:"none",minWidth:"340px",zIndex:"1"},label:"Choose infographics","pointer-disabled":"true","trigger-disabled":"true","overlay-positioning":"fixed",placement:"bottom-start","offset-skidding":"4","auto-close":"true","focus-trap-disabled":"true",referenceElement:this._elementIds.button,onCalcitePopoverClose:e=>{if(e.target!==e.currentTarget)return;this._popoverIsOpen=!1,this.selectorPopupClosed.emit();const t=s.A.queryElementById.call(this.el,this._elementIds.arrow);t&&t.classList.remove("drivetime-settings-selector-drop-open")}},(0,o.h)("div",{id:this._elementIds.content,style:{width:"100%",minWidth:"340px",height:"auto"},onClick:e=>{e.stopPropagation()}},(0,o.h)("div",{style:{padding:"20px"}},(0,o.h)("div",null,(0,o.h)("calcite-label",null,s.B.i18n("driving-mode"),(0,o.h)("calcite-select",{label:"",id:"travelMode",onCalciteSelectChange:e=>this.handleDrivetimeOptionChange(e)},this.getTravelModeOptions()))),(0,o.h)("div",{class:"segmented-control",style:{padding:"10px 0px 10px 0px",borderBottom:"1px solid #eaeaea"}},(0,o.h)("calcite-segmented-control",{id:"travelDirection",required:!0,width:"full",onCalciteSegmentedControlChange:e=>this.handleDrivetimeOptionChange(e)},(0,o.h)("calcite-segmented-control-item",{value:s.T.away,checked:this.travelDirection===s.T.away},s.B.i18n("awayFacility")),(0,o.h)("calcite-segmented-control-item",{value:s.T.toward,checked:this.travelDirection===s.T.toward},s.B.i18n("towardFacility")))),this.useTrafficEnabled&&(0,o.h)("div",{class:"useTraffic-div",style:e},(0,o.h)("calcite-label",{layout:"inline",style:{margin:"5px 0px 0px 3px"}},(0,o.h)("calcite-checkbox",{id:"useTrafficCheckbox",checked:this.useTrafficChecked,onCalciteCheckboxChange:e=>this.handleDrivetimeOptionChange(e)}),s.B.i18n("useTraffic"))),this.useTrafficEnabled&&this.useTrafficChecked&&(0,o.h)("div",{class:"useTraffic-content-div"},(0,o.h)("div",{class:"segmented-control",style:{padding:"10px 0px 10px 0px"}},(0,o.h)("calcite-segmented-control",{id:"trafficType",required:!0,width:"full",onCalciteSegmentedControlChange:e=>this.handleDrivetimeOptionChange(e)},(0,o.h)("calcite-segmented-control-item",{value:s.b.live,checked:this.trafficType===s.b.live},s.B.i18n("liveTraffic")),(0,o.h)("calcite-segmented-control-item",{value:s.b.typical,checked:this.trafficType===s.b.typical},s.B.i18n("typicalTraffic")))),this.trafficType===s.b.live?(0,o.h)("div",{class:"use-liveTraffic-content-div",style:e},(0,o.h)("calcite-label",null,s.B.i18n("timeOffset"),(0,o.h)("calcite-select",{label:"",id:"offsetTime",onCalciteSelectChange:e=>this.handleDrivetimeOptionChange(e)},this.getTimeOffsets().map((e=>(0,o.h)("calcite-option",{key:e.value,value:e.value.toString(),selected:this.offsetTime===e.value},e.label)))))):(0,o.h)("div",{class:"use-typicalTraffic-content-div",style:e},(0,o.h)("calcite-label",null,(0,o.h)("calcite-select",{label:s.B.i18n("day"),id:"offsetDay",onCalciteSelectChange:e=>this.handleDrivetimeOptionChange(e)},this.getDayOptions())),(0,o.h)("calcite-label",null,(0,o.h)("calcite-select",{label:s.B.i18n("time"),id:"offsetHr",onCalciteSelectChange:e=>this.handleDrivetimeOptionChange(e)},this.getTimeOptions()))))))))}static get watchers(){return{env:["onEnvChanged"],config:["onConfigChange"],selectedTravelModeId:["onSelectedTravelModeIdChanged"]}}};r.style=":host{display:block}.drivetimeSettingsOuter{position:relative;width:100%;height:30px;justify-content:left;align-items:center;border:solid 0px;border-color:var(--calcite-ui-border-input)}.drivetime-settings-selector-label-placeholder{color:gray}.drivetime-settings-selector-dropdown-label{position:absolute;top:7px;left:6px;width:calc(100% - 35px);height:25px;font-size:10.5pt;font-weight:300;text-align:left;text-overflow:ellipsis;border-radius:0px;overflow:hidden;white-space:nowrap;cursor:pointer}.drivetime-settings-selector-dropdown{position:relative;height:32px;width:100%;cursor:pointer}.drivetime-settings-selector-dropdown-arrow{position:absolute;top:9px;right:7px;width:12px;height:12px;transition:all 0.15s 0.15s;transform:rotate(0)}.drivetime-settings-selector-drop-open{transform:rotate(180deg)}calcite-popover ::-webkit-scrollbar{background-color:var(--calcite-color-background-1);width:8px;height:8px}calcite-popover ::-webkit-scrollbar-thumb{background-color:var(--calcite-color-foreground-3)}calcite-popover ::-webkit-scrollbar-track{background-color:transparent}calcite-popover ::-webkit-scrollbar-corner{background-color:var(--calcite-color-background-1);width:8px;height:8px}"}}]);