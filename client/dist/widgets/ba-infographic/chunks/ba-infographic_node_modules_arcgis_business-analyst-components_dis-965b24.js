"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_ba-infographic_node_modules_arcgis_business-analyst-components_dis-965b24"],{4280:(e,t,r)=>{r.d(t,{E:()=>o,G:()=>u,S:()=>l,T:()=>s});var a=r(983);class s{static token={access_token:"",expires_in:null,persist:"true",ssl:"true",username:"mark_ba"};static getToken(){return new Promise((e=>{e(s.token.access_token)}))}static setToken(e,t){e&&e.length>0&&t&&t.length>0&&(this.token.access_token=t,this.token.username=e)}}class o{static _env="www";static portalUrl="";static geoenrichmentUrl="";static orgGeocoders=null;static geocodeUrl="";static setEnvironment(e){let t="prod"===e||"localhost"===e?"www":e;o._env=t}static getEnvironment(){return o._env}static setPortalUrl(e){o.portalUrl=e}static setGeoenrichmentUrl(e){o.geoenrichmentUrl=e}static setGeocodeUrl(e){o.geocodeUrl=a.A.fixUrlEndingSlash(e)}static getPortalBase(){if(o.portalUrl)return o.portalUrl;const e=o._env;if(!e)return"";return"https://"+("dev"===e?"devext":"qa"===e?"qaext":"www")+".arcgis.com"}static getGeocoders(){return new Promise(((e,t)=>{this.orgGeocoders?e():i.getPortalSettings().then((r=>{if(r&&r.helperServices&&r.helperServices.geocode){const s=r.helperServices.geocode;s.length>0?(o.orgGeocoders=[],s.forEach((e=>{o.orgGeocoders?.push({url:e.url,name:e.name})})),o.geocodeUrl||(o.geocodeUrl=a.A.fixUrlEndingSlash(s[0].url)),e()):t()}else t()})).catch(t)}))}static getUrl(e){if(a.a.Log("Environments.getUrl -  - - - --"),!o._env)return console.log("Environments error: env not set"),"";if(!e||!a.U.hasText(e))return console.log("Environments error: invalid subdomain"),"";const t=o.getPortalBase();if(""===t)return"";try{let r="";switch(e){case"geocode":if(o.geocodeUrl){r=a.A.fixUrlEndingSlash(o.geocodeUrl);break}r="qa"===o._env?"https://geocodeqa.arcgis.com/arcgis/rest/services/World/GeocodeServer":"dev"===o._env?"https://geocodedev.arcgis.com/arcgis/rest/services/World/GeocodeServer":"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer";break;case"arcgis":r=t;break;case"infographics":r="qa"===o._env?"https://baoqa.arcgis.com/InfographicsPlayer/BAMobile/25.R02/reportPlayer/ReportPlayerMobile.html":"dev"===o._env?"https://baodev.arcgis.com/InfographicsPlayer/BAMobile/25.R02/reportPlayer/ReportPlayerMobile.html":"https://bao.arcgis.com/InfographicsPlayer/BAMobile/25.R02/reportPlayer/ReportPlayerMobile.html";break;case"routing":r="qa"===o._env?"https://logisticsqa.arcgis.com/arcgis/rest/services/World/Utilities/GPServer":"dev"===o._env?"https://logisticsdev.arcgis.com/arcgis/rest/services/World/Utilities/GPServer":"https://logistics.arcgis.com/arcgis/rest/services/World/Utilities/GPServer";break;case"geoenrich":if(o.geoenrichmentUrl){r=o.geoenrichmentUrl;break}r="qa"===o._env?"https://geoenrichqa.arcgis.com/arcgis/rest/services/World/geoenrichmentserver":"dev"===o._env?"https://geoenrichdev.arcgis.com/arcgis/rest/services/World/geoenrichmentserver":"https://geoenrich.arcgis.com/arcgis/rest/services/World/geoenrichmentserver"}return r}catch(e){a.a.Error("Environments.getUrl() error ",e)}return""}static isOnlineGeocoder(e){return!!(e.toLowerCase().startsWith("https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer".toLowerCase())||e.toLowerCase().startsWith("https://geocodeqa.arcgis.com/arcgis/rest/services/World/GeocodeServer".toLowerCase())||e.toLowerCase().startsWith("https://geocodedev.arcgis.com/arcgis/rest/services/World/GeocodeServer".toLowerCase()))}static isAGOPortal(e){return!!(e.toLowerCase().startsWith("https://www.arcgis.com".toLowerCase())||e.toLowerCase().includes("qaext.arcgis.com")||e.toLowerCase().includes("devext.arcgis.com"))}}class i{static _lastSelfToken;static _selfResult;static executeSelf(){return new Promise(((e,t)=>{s.getToken().then((r=>{if(r===i._lastSelfToken)e(i._selfResult);else{let a={taskPath:"/portals/self",data:{culture:"en-us"}};i.executeRequest(a).then((t=>{i._lastSelfToken=r,i._selfResult=t,e(t)})).catch((e=>{i._lastSelfToken="",i._selfResult="",t(e)}))}})).catch((e=>t(e)))}))}static getGeoenrichmentUrl(){return o.getUrl("geoenrich")}static getHelperServiceUrl(e){return new Promise(((t,r)=>{i.executeSelf().then((function(a){let s=a.helperServices;if(s){let a=s[e];if(a){let s=Array.isArray(a)?a[0].url:a.url;s?t(s):r(e+" helper service is not configured.")}else r(e+" helper service is not configured.")}else r("Helper services are not configured.")})).catch((e=>r(e)))}))}static getPortalResource(e){return i.executeRequest({taskPath:"/portals/self/resources/"+e})}static getPortalSettings(){return i.executeRequest({taskPath:"/portals/self/settings"})}static getItemData(e){return i.executeRequest({taskPath:"/content/items/"+e+"/data"})}static searchAllItems(e,t){return new Promise(((r,a)=>{let s=[],o=this,i=function(e,t,n){o.searchItems(e,t,n).then((function(a){a.items.length&&(s=s.concat(a.items));let o=a.context;o.nextStart>0?i(e,t,o):r(s)}),(function(e){s&&s.length?r(s):a(e)}))};i(e,t,null)}))}static searchItems(e,t,r){return new Promise(((a,s)=>{let o=t?JSON.parse(JSON.stringify(t)):{};if(r){o.q=t.q;let e=r.total,s=r.nextStart;e&&s&&(s>0&&e>=s?o.start=s:a({items:[],context:r})),r.sortField&&r.sortOrder&&(o.sortOrder=r.sortOrder,o.sortField=r.sortField)}else{let t=[];Object.getOwnPropertyNames(e).forEach((function(r){t.push(r+':"'+e[r]+'"')})),t.length&&(o.q=t.join(" AND "))}i.portalSearch(o).then((e=>{let t=e.results,r={query:e.query,total:e.total,nextStart:e.nextStart,sortOrder:null,sortField:null};o.sortOrder&&o.sortField&&(r.sortOrder=o.sortOrder,r.sortField=o.sortField),a({items:t,context:r})})).catch(s)}))}static portalSearch(e){return i.executeRequest({taskPath:"/search",data:e})}static async getPortalUrl(){return o.getUrl("arcgis")+"/sharing/rest"}static executeRequest(e){return new Promise(((t,r)=>{s.getToken().then((async a=>{e.data||(e.data={}),e.data.f||(e.data.f="json"),e.data.token=a||e.data.token,e.data.token||delete e.data.token,e.data.langCode=e.data?.langCode?e.data.langCode:"en-us";const s=new FormData;for(let t in e.data)s.append(t,e.data[t]);let o;o=Object.prototype.hasOwnProperty.call(e,"url")?e.url:await i.getPortalUrl(),e.taskPath&&(o+=e.taskPath);let n={};if(e.isStandardGeoQuery){const t=new Headers;t.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");let r="",a=!0;for(const t in e.data)r+=a?"":"&",r+=t+"="+encodeURI(e.data[t]),a=!1;n={method:"POST",body:r,headers:t}}else n={method:"POST",body:s};fetch(o,n).then((t=>{if(!t.ok)throw new Error("Network response ended with error.");return"bin"===e.data.f?t.blob():t.json()})).then((e=>{e.error?r(e.error):t(e)})).catch((e=>{console.error("Error:",e),r(e)}))})).catch((e=>r(e)))}))}}class n{static getBusinessAnalystOrganizationalSettings(){return i.getPortalResource("BusinessAnalyst_Organizational_Settings.json")}static getDisabledReports(){return new Promise((e=>{let t=t=>{e({}),console.log("WebAppSettings error",t)};i.executeSelf().then((r=>{let a=r.user?.roleId||r.user?.role;a?n.getBusinessAnalystOrganizationalSettings().then((t=>{let r=t["userRoles.disabledAreas.reports"];r&&r[a]?e(r[a]):e({})})).catch(t):e({})})).catch(t)}))}static getUserGalleryInfographicReportIds(){return new Promise(((e,t)=>{n._searchGalleryInfographicPreferencesItem().then((r=>{if(!r)return void t(null);let a=r.id;i.getItemData(a).then((t=>{e(t&&t.data&&t.data.myGalleryInfographicReportIds)})).catch((e=>t(e)))})).catch((e=>t(e)))}))}static _searchGalleryInfographicPreferencesItem(){return n._searchUserItem("esriFavoriteReportTemplates")}static _searchUserItem(e){return new Promise(((t,r)=>{i.executeSelf().then((a=>{let s=a.user.username,o={type:"Web Mapping Application",typekeywords:e,owner:s};i.searchItems(o,{num:1},void 0).then((e=>{t(e&&e.length&&e[0])})).catch((e=>r(e)))})).catch((e=>r(e)))}))}}class l{static environment;static getEnvironment(){return new Promise((e=>{e(o.getEnvironment())}))}static setEnvironment(e){e&&e.length>0?o.setEnvironment(e):console.log("ba-reports error: setEnvironment() invalid arg")}static async getPortalBaseUrl(){return o.getUrl("arcgis")}static isTrueString(e){return"true"===String(e).toLowerCase()}}class c{static _geReportTemplatesCache={};static _condenseResultsArray(e){const t=e.map((e=>({id:e.id,title:e.title,date:e.modified,reportID:e.reportID}))),r=t.map((e=>e.title));return t.filter(((e,t)=>r.indexOf(e.title)==t))}static _condenseResultsArrayGEInfographics(e){let t,r,a;const s=e.map((e=>{try{e.metadata.lastRevisionDate&&(a=e.metadata.lastRevisionDate),e.metadata.creationDate&&(r=e.metadata.creationDate),r&&(t=a&&a>r?a:r)}catch(e){console.log("ReportTemplatesManager error",e)}return{id:e.itemID,reportID:e.reportID,title:e.metadata.title,date:t}})),o=s.map((e=>e.title));return s.filter(((e,t)=>o.indexOf(e.title)==t))}static async getReportTemplates(e,t=!1){let r={ge:void 0,shared:void 0,user:void 0,favoriteIds:void 0};let a=(await i.executeSelf()).user.username;const s=await Promise.allSettled([c._getSharedCustomReportTemplateItems(a),c._getMyCustomReportTemplateItems(a),c._getFavoriteReportsIds(a,e)]);r.ge=s[0].value?s[0].value:[],r.shared=await c._createReportTemplateInfos(s[1]&&s[1].value?s[1].value:[],e),r.user=await c._createReportTemplateInfos(s[2]&&s[2].value?s[2].value:[],e),r.favoriteIds=s[3]&&s[3].value?s[3].value:[];const o=await n.getDisabledReports();let l=r.ge,u=r.shared;return null!=l&&(r.ge=l.filter((e=>!o[e.reportID])),null!=u&&(r.shared=u.filter((e=>!o[e.reportID.itemid])))),t||(r.ge=c._condenseResultsArray(r.ge),r.shared=c._condenseResultsArray(r.shared),r.user=c._condenseResultsArray(r.user),r.favoriteIds=c._condenseResultsArray(r.favoriteIds)),r}static _getGEReportTemplates(e){return new Promise(((t,r)=>{let a=c._geReportTemplatesCache[e];a?t(a):u.execute({taskPath:"/GeoEnrichment/Reports/"+e}).then((r=>{let a=r.reports;c._geReportTemplatesCache[e]=a,t(a)})).catch(r)}))}static _getSharedCustomReportTemplateItems(e){let t='type:"Report Template" (access:shared OR access:org) typekeywords:(esriWebReport NOT esriWebInfographicReport) NOT owner:'+e;return c._searchItems(t,c._removeInfographicTemplates)}static _getMyCustomReportTemplateItems(e){let t='type:"Report Template" typekeywords:(esriWebReport NOT esriWebInfographicReport) owner:'+e;return c._searchItems(t,c._removeInfographicTemplates)}static _removeInfographicTemplates(e){return!l.isTrueString(e.properties.isGraphicReport)}static getInfographicReportTemplateItems(e,t=!1,r,a){return new Promise((async(s,o)=>{let l={public:[],shared:[],user:[],favoriteIds:[],gallery:[],tabular:[]},p=a||await u.getGEDefaultHierarchy(e,r);i.executeSelf().then((r=>{let a=r.user?.username,i=r.user?.orgId,u=[c._getEsriInfographicReportTemplateItems(e,p)];if(a&&i)u.push(c._getSharedInfographicReportTemplateItems(a,i),c._getUserInfographicReportTemplateItems(a),c._getFavoriteReportsIds(a,e));else{const e=new Promise((e=>e(!1)));u.push(e,e,e)}u.push(c._getGalleryInfographicReportTemplateItems()),u.push(c._getTabularReportTemplateItems()),Promise.allSettled(u).then((r=>{let a=c._byCountryAndDefaultHiearchy(e,p);l.public=r[0].value?r[0].value.filter(a):[],l.shared=r[1].value?r[1].value.filter(a):[],l.user=r[2].value?r[2].value.filter(a):[],l.favoriteIds=r[3].value?r[3].value:[],l.gallery=r[4].value?r[4].value.filter(a):[],l.tabular=r[5].value?r[5].value.filter(a):[];let i=l.user;null!=i&&i.sort((function(e,t){return e.title.localeCompare(t.title)})),n.getDisabledReports().then((e=>{let r=function(t){return!e[t.id]},a=l.public;null!=a&&(l.public=a.filter(r));let o=l.shared;null!=o&&(l.shared=o.filter(r));let i=l.gallery;null!=i&&(l.gallery=i.filter(r));let n=l.tabular;null!=n&&(l.tabular=n.filter(r)),t||(l.public=c._condenseResultsArrayGEInfographics(l.public),l.shared=c._condenseResultsArray(l.shared),l.user=c._condenseResultsArray(l.user),l.favoriteIds=c._condenseResultsArray(l.favoriteIds),l.gallery=c._condenseResultsArray(l.gallery),l.tabular=c._condenseResultsArray(l.tabular)),s(l)})).catch((e=>o(e)))}))})).catch((e=>o(e)))}))}static _byCountryAndDefaultHiearchy(e,t){return function(r){let a=r&&r.properties&&r.properties.countries.toLowerCase()||r&&r.metadata&&r.metadata.countries.toLowerCase();a=a.split(",").map((e=>e.trim()));let s=r&&r.properties&&r.properties.hierarchy||r&&r.metadata&&r.metadata.hierarchy;return s=s.split(",").map((e=>e.trim())),a&&a.includes(e.toLowerCase())&&s&&s.includes(t)}}static _getEsriInfographicReportTemplateItems(e,t){let r="/GeoEnrichment/Infographics/Standard/"+e;return t&&t.length>0&&(r+="/"+t),u.execute({taskPath:r}).then((e=>e.reports))}static _getSharedInfographicReportTemplateItems(e,t){let r='type:"Report Template" (access:shared OR access:org OR (access:public AND orgid:'+t+"))  typekeywords:esriWebInfographicReport  NOT owner:"+e;return c._searchItems(r,c._infographicFilter)}static _getGalleryInfographicReportTemplateItems(){let e='type:"Report Template"  typekeywords:esriWebGalleryInfographicReport  owner:(esri_reports)';return c._searchItems(e,c._infographicFilter,{start:1,num:1e3,sortField:"modified",sortOrder:"desc",q:e})}static _getTabularReportTemplateItems(){let e='type:"Report Template"  typekeywords:esriTabularInfographicReport  owner:(esri_reports)';return c._searchItems(e,(e=>{const t=c._infographicFilter(e),r=(e.title||e.metadata?.title||"").startsWith("Dominant Tapestry Map");return t&&!r}),{start:1,num:1e3,sortField:"modified",sortOrder:"desc",q:e})}static _getUserInfographicReportTemplateItems(e){return new Promise(((t,r)=>{let a='type:"Report Template" typekeywords:esriWebInfographicReport  owner:'+e,s=c._searchItems(a,c._infographicFilter),o=c._getUserGalleryInfographicReportTemplateItems();Promise.allSettled([s,o]).then((e=>{let r=e[0].value?e[0].value:[],a=e[1].value?e[1].value:[];t(r.concat(a))}),(e=>{r(e)}))}))}static _getFavoriteReportsIds(e,t){return new Promise(((r,a)=>{let s='type:"Web Mapping Application" typekeywords:"BAUserData.FavoriteReports" owner:'+e;c._searchItems(s,null).then((e=>{let s=e&&e[0];s?i.getItemData(s.id).then((e=>{if(!e)return void r([]);let a=e.data&&e.data["favorites"+t];if(!a)return void r([]);let s=a.map((function(e){return e.reportID}));r(s)})).catch((e=>a(e))):r([])})).catch((e=>a(e)))}))}static _getUserGalleryInfographicReportTemplateItems(){return new Promise(((e,t)=>{n.getUserGalleryInfographicReportIds().then((r=>{if(!r||!r.length)return void e([]);let a=r.map((e=>"id:"+e)).join(" OR ");c._searchItems(a,c._infographicFilter).then((t=>{e(t)})).catch((e=>t(e)))})).catch((e=>t(e)))}))}static _searchItems(e,t,r){return new Promise(((a,s)=>{let o=r||{start:1,num:1e3,sortField:"title",sortOrder:"asc",q:e};i.searchAllItems({},o).then((e=>{let r=t?e.filter(t):e;a(r)})).catch((e=>s(e)))}))}static async _createReportTemplateInfos(e,t){let r=[],a=[];async function s(e,t){const a=await u.getGEDefaultHierarchy(t);e.metadata.hierarchy=a,r.push(e)}e.forEach((function(e){let r=e.properties;if(r){let s=r.countries;if(l.isTrueString(r.isComparisonReport))return;if(s&&-1!==s.indexOf(t)){let t={reportID:{itemid:e.id},formats:r.formats&&r.formats.split(","),headers:[],metadata:{author:r.author,categories:[],countries:s,coverage:r.coverage,hierarchy:"",keywords:r.keywords,owner:e.owner,title:e.title,type:r.type}};a.push(t)}}}));for(let e=0;e<a.length;e++)await s(a[e],t);return r}static _infographicFilter(e){let t=e.properties;return l.isTrueString(t.isGraphicReport)&&!l.isTrueString(t.isSingleInfographic)&&!l.isTrueString(t.isHidden)&&!l.isTrueString(t.isBlank)}}class u{static _defaultHierarchyStorageName="GEClient-default-hierarchy";static _defaultHierarchies;static _validHierarchies;static _geographyLevelsCache;static _standardInfographicsCache;static _infographicItemIDtoReportIDMap;static appID="esriexperiencebuilder";static async getInfographicTemplatesList(e,t=!1,r,a){return await c.getInfographicReportTemplateItems(e||"US",t,r,a)}static async getClassicReportsTemplatesList(e,t=!1){return await c.getReportTemplates(e||"US",t)}static execute(e){return new Promise(((t,r)=>{const a=i.getGeoenrichmentUrl();var s=e?JSON.parse(JSON.stringify(e)):{};s.data||(s.data={}),s.data.forStorage=!1,s.data.appID=u.appID,i.executeRequest({url:a+s.taskPath,data:s.data,isStandardGeoQuery:s.isStandardGeoQuery}).then(t).catch(r)}))}static enrich=function(e){return new Promise((async(t,r)=>{const a=e;var s=o.getUrl("geoenrich")+"/Geoenrichment/Enrich";a.forStorage=!1,a.appID=u.appID,i.executeRequest({url:s,data:a}).then((function(e){var a=e&&e.results&&e.results.length&&e.results[0],s=a&&a.value&&a.value.FeatureSet&&a.value.FeatureSet.length&&a.value.FeatureSet[0];if(s.features&&s.features.length)t(e);else{var o=e&&e.messages&&e.messages.length&&e.messages[0].description;o||(o="getfacts-no-data"),r(o)}}),(function(e){r(e)}))}))};static getTravelModes=function(e,t){return new Promise((async(r,a)=>{if(e){t&&o.setEnvironment(t);var s=o.getUrl("routing")+"/GetTravelModes/execute";i.executeRequest({url:s,data:{appID:u.appID,token:e}}).then((function(e){try{const t={...e,results:e.results?.map((e=>"supportedTravelModes"===e.paramName&&e.value?.features?{...e,value:{...e.value,features:e.value.features.map((e=>{const t=e.attributes;let r=null;try{t.TravelMode&&"string"==typeof t.TravelMode&&(r=JSON.parse(t.TravelMode))}catch(e){console.warn(`Error parsing TravelMode JSON for ${t.Name}:`,e)}const a={...e,attributes:{...t,Name:t.Name||t.AltName||"Unknown Mode",TravelModeId:t.TravelModeId||"",TravelMode:t.TravelMode||"{}",AltName:t.AltName||t.Name||"Unknown Mode"}};return r&&(a.parsedTravelMode={impedanceAttributeName:r.impedanceAttributeName||"",timeAttributeName:r.timeAttributeName||"",distanceAttributeName:r.distanceAttributeName||"",description:r.description||"",type:r.type||"AUTOMOBILE",name:r.name||t.Name}),a})).filter((e=>{const t=e.attributes;return t.Name&&t.TravelModeId&&t.TravelMode}))}}:e))||[]};r(t)}catch(t){console.error("Error processing travel modes response:",t),r(e)}}),(function(e){a(e)}))}else a("Token is required for getTravelModes")}))};static createReport(e){return new Promise(((t,r)=>{const a=i.getGeoenrichmentUrl();e.appID=u.appID;let s=a.toString()+"/Geoenrichment/CreateReport";i.executeRequest({url:s,data:e}).then(t).catch(r)}))}static searchStdGeography(e,t){return new Promise((async(r,a)=>{if(!e||!e.length)return void r([]);let s=await this.getGEDefaultHierarchy(t?.sourceCountry||"US",t?.token),o={geographyQuery:e,featureLimit:t?.featureLimit||10,geographyLayers:t?.geographyLayers||["US.States","US.Counties","US.Places"],useFuzzySearch:t?.useFuzzySearch,sourceCountry:t?.sourceCountry||"US",langCode:t?.langCode||"en-us",optionalCountryHierarchy:t?.optionalCountryHierarchy||s,outSR:4326};this.standardGeographyQuery(o).then((e=>r(e))).catch((e=>a(e)))}))}static requestStdGeography(e,t,r){return new Promise((async(a,s)=>{let o=await this.getGEDefaultHierarchy(r?.sourceCountry||"US",r?.token),i={geographyLayers:[e],featureLimit:r?.featureLimit||1,returnGeometry:r?.returnGeometry,generalizationLevel:r?.generalizationLevel||0,geographyIDs:[t],sourceCountry:r?.sourceCountry||"US",langCode:r?.langCode||"en-us",optionalCountryHierarchy:r?.optionalCountryHierarchy||o,outSR:4326};this.standardGeographyQuery(i).then((e=>a(e))).catch((e=>s(e)))}))}static standardGeographyQuery(e){return new Promise(((t,r)=>{let a={data:e,isStandardGeoQuery:!0,taskPath:"/StandardGeographyQuery/execute",appID:u.appID};u.execute(a).then((e=>{let a=e&&e.results&&e.results.length&&e.results[0],s=a&&a.value&&a.value.features;if(s)t(s);else{let t=e&&e.messages&&e.messages.length;r(t)}})).catch((e=>{r(e)}))}))}static getStoredDefaultHierarchy(e){let t;if(window.localStorage){let r=localStorage.getItem(u._defaultHierarchyStorageName);if(r&&a.U.hasText(r)){let a=JSON.parse(r);t=a[e],u._defaultHierarchies=a}}return t}static setStoredDefaultHierarchy(e,t){try{u.getStoredDefaultHierarchy(e),u._defaultHierarchies||(u._defaultHierarchies={}),u._defaultHierarchies[e]=t,window.localStorage&&localStorage.setItem(u._defaultHierarchyStorageName,JSON.stringify(u._defaultHierarchies))}catch(e){console.log("GEClient error",e)}}static preStdInfographicIds={country:"US",list:{hardcoded:!0,"2020-census-summary":!0,"at-risk-population":!0,"childhood-and-female-equity":!0,"community-change-snapshot":!0,"community-summary":!0,"commute-profile":!0,"demographic-profile":!0,"demographic-summary":!0,"dominant-tapestry-profile":!0,"eating-places":!0,"economic-development-profile":!0,"emergency-information":!0,"employment-overview":!0,"executive-summary-call-outs":!0,"health-care-and-insurance":!0,"housing-market-characteristics":!0,"k12-education-overview":!0,"key-facts":!0,"multi-area-comparison":!0,"nonprofit-charitable-profile":!0,"office-market-profile":!0,"population-trends":!0,"property-details":!0,"retail-demand-by-industry-tabular":!0,"shopping-and-spending":!0,skyscraper:!0,"tapestry-profile":!0,"target-market-summary":!0,"whats-in-my-community":!0}};static async requestStandardInfographicIds(e,t,r,s){let n;e&&a.U.hasText(e)||(n="invalid country"),t&&a.U.hasText(t)||(n="invalid token"),r&&!a.U.hasText(r)&&(n="invalid env"),r&&o.setEnvironment(r);const l={country:n?"":e,list:{},error:n};if(!n&&"US"==e){if(!s){const e=u._standardInfographicsCache;if(e&&"US"==e.country&&!e.error&&!e.list.hardcoded)return e}let r=i.getGeoenrichmentUrl().toString()+"/Geoenrichment/Infographics/Standard/"+e+"?f=pjson";const a=t?{appID:u.appID,token:t}:{appID:u.appID},o=await i.executeRequest({url:r,data:a});o&&o.reports&&o.reports.length>0&&(o.reports.forEach((e=>{e.reportID&&(l.list[e.reportID]=!0)})),u._standardInfographicsCache=l)}return l}static async applyUseLatestDataSource(e,t,r,s,o){if(e&&"US"==t&&a.A.hasText(o)){const e=await u.requestStandardInfographicIds(t,s);if(e&&!a.A.hasText(e.error)){if(e&&e.list&&e.list[o])return""}else console.warn("InfographicCard: "+e.error)}return r}static getValidHierarchies(e,t,r){return new Promise(((s,o)=>{if(e&&a.U.hasText(e)&&t&&a.U.hasText(t),u._validHierarchies&&u._validHierarchies.country===e)s(u._validHierarchies);else if(r)u._validHierarchies=function(t){const r={country:e,dataSources:[]};if(t&&t.length>0)for(let e=0;e<t.length;e++){let a=t[e];"landscape"!==a.ID&&r.dataSources.push({id:a.ID,alias:a.alias})}return r}(r),s(u._validHierarchies);else{let r={country:e,dataSources:[]};let a=i.getGeoenrichmentUrl().toString()+"/Geoenrichment/Countries/"+e+"?f=pjson";const n=t?{appID:u.appID,token:t}:{appID:u.appID};i.executeRequest({url:a,data:n}).then((e=>{let t=e.countries[0].hierarchies;if(t&&t.length>0)for(let e=0;e<t.length;e++){let a=t[e];"landscape"!==a.ID&&r.dataSources.push({id:a.ID,alias:a.alias})}else o("getValidHierarchies: no hierarchies found");u._validHierarchies=r,s(u._validHierarchies)})).catch(o)}}))}static async getGEDefaultHierarchy(e,t,r){let s="US";async function o(e){if(r){if(!r.useLatestDataSource||r.country!=s||!r.reportID||!r.hierarchy)return r.hierarchy;return await u.applyUseLatestDataSource(r.useLatestDataSource,r.country,r.hierarchy,r.token,r.reportID)}return e}e&&a.U.hasText(e)&&(s=e);let n=u.getStoredDefaultHierarchy(s);if(n&&a.U.hasText(n)){if(r){r.hierarchy=n;return await o(n)}return n}{let n=i.getGeoenrichmentUrl().toString()+"/Geoenrichment/Countries/"+e+"?f=pjson";const l=t?{appID:u.appID,token:t}:{appID:u.appID};let c="";const p=await i.executeRequest({url:n,data:l}),h=p?.countries;if(h){const e=h.find((e=>e.id==s));if(e&&e.hierarchies&&e.hierarchies.length>=1){let t=e.hierarchies.find((e=>1==e.default));t&&a.A.hasText(t.ID)&&"landscape"!=t.ID&&(r?(r.hierarchy=t.ID,o(t.ID).then((e=>{e&&(c=e)}))):c=t.ID)}}return c}}static getStandardGeographyLevels(e,t,r,s){return new Promise(((o,n)=>{e&&a.U.hasText(e)||(e="US"),a.a.Log("GEClient.getStandardGeographyLevels -",e,t,r,s),u.getGEDefaultHierarchy(e,s).then((a=>{a=r||a,u._geographyLevelsCache||(u._geographyLevelsCache={});const n=a?e+"-"+a:e;if(!u._geographyLevelsCache[n]){let r=i.getGeoenrichmentUrl().toString()+"/Geoenrichment/StandardGeographyLevels/"+e;r+=a?"/"+a+"?f=pjson":"?f=pjson",s&&(r+="&token="+s),i.executeRequest({url:r,data:{langCode:t||"en-us",appID:u.appID}}).then((e=>{u._geographyLevelsCache[n]=e}))}const l=u._geographyLevelsCache[n];let c;if(l&&l.geographyLevels&&l.geographyLevels[0]&&l.geographyLevels[0].hierarchies){let e=l.geographyLevels[0].hierarchies;for(let t=0;t<e.length;t++)if(e[t].ID==a){c=e[t];break}c||(c=e[0])}o(c)})).catch(n)})).catch((e=>{console.log("GEClient error",e)}))}}}}]);