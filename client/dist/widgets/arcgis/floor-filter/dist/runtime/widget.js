System.register(["jimu-core","jimu-arcgis","esri/core/reactiveUtils.js","esri/widgets/FloorFilter","jimu-ui"],(function(e,t){var i={},o={},r={},l={},n={};return{setters:[function(e){i.ClauseLogic=e.ClauseLogic,i.ClauseOperator=e.ClauseOperator,i.React=e.React,i.dataSourceUtils=e.dataSourceUtils,i.jsx=e.jsx},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){r.watch=e.watch},function(e){l.default=e.default},function(e){n.WidgetPlaceholder=e.WidgetPlaceholder}],execute:function(){e((()=>{var e={10540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},14321:e=>{"use strict";e.exports=n},31601:e=>{"use strict";e.exports=function(e){return e[1]}},36449:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var o=i(31601),r=i.n(o),l=i(76314),n=i.n(l)()(r());n.push([e.id,".widget-floorfilter{width:100%;height:100%}.widget-floorfilter-nomap{color:var(--dark-600);background-color:var(--light-200)}.widget-floorfilter-header{margin:10px 10px 5px;font-weight:bold}.widget-floorfilter-msg{padding:12px;height:48px}.widget-floorfilter-container{overflow-y:auto;height:100%}.widget-floorfilter .esri-floor-filter__zoom-button.esri-button--disabled{opacity:1}ul.esri-floor-filter__filter-menu-items>li>button.esri-floor-filter__filter-menu-site,ul.esri-floor-filter__filter-menu-items>li>button.esri-floor-filter__filter-menu-facility,.esri-floor-filter__filter-menu-header .esri-icon-close,.esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-header-back{color:var(--dark-600) !important}.esri-floor-filter .esri-floor-filter__button-container .esri-widget--button-active{color:var(--primary)}.esri-view-height-less-than-small .esri-floor-filter .esri-floor-filter__close-levels-button,.esri-view-width-less-than-medium .esri-floor-filter .esri-floor-filter__close-levels-button{background-color:var(--light-100) !important}",""]);const s=n},41113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},53175:e=>{"use strict";e.exports=l},54312:e=>{"use strict";e.exports=r},54802:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M16.25 11.25H15V7.5h5V20h-1.25V8.75h-2.5zm-10-5v6.25H7.5V3.75h1.25V0h3.275l1.725 2.334v8.916H12.5V2.746L11.394 1.25H10V5H8.75v15H0V8.75h1.25v-2.5zm-2.5 7.5V12.5H5v-5H2.5V10H1.25v8.75H7.5v-5zm8.75-1.25h5V20H10v-5h2.5zm1.25 1.25v2.5h-2.5v2.5h5v-5zm-10 2.5h2.5V15h-2.5z"></path></svg>'},55056:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},62686:e=>{"use strict";e.exports=o},76314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",o=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),o&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),o&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,o,r,l){"string"==typeof e&&(e=[[null,e,void 0]]);var n={};if(o)for(var s=0;s<this.length;s++){var a=this[s][0];null!=a&&(n[a]=!0)}for(var d=0;d<e.length;d++){var u=[].concat(e[d]);o&&n[u[0]]||(void 0!==l&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=l),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},77659:e=>{"use strict";var t={};e.exports=function(e,i){var o=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(i)}},79244:e=>{"use strict";e.exports=i},85072:e=>{"use strict";var t=[];function i(e){for(var i=-1,o=0;o<t.length;o++)if(t[o].identifier===e){i=o;break}return i}function o(e,o){for(var l={},n=[],s=0;s<e.length;s++){var a=e[s],d=o.base?a[0]+o.base:a[0],u=l[d]||0,c="".concat(d," ").concat(u);l[d]=u+1;var f=i(c),h={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==f)t[f].references++,t[f].updater(h);else{var v=r(h,o);o.byIndex=s,t.splice(s,0,{identifier:c,updater:v,references:1})}n.push(c)}return n}function r(e,t){var i=t.domAPI(t);i.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,r){var l=o(e=e||[],r=r||{});return function(e){e=e||[];for(var n=0;n<l.length;n++){var s=i(l[n]);t[s].references--}for(var a=o(e,r),d=0;d<l.length;d++){var u=i(l[d]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}l=a}}},97825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var o="";i.supports&&(o+="@supports (".concat(i.supports,") {")),i.media&&(o+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(o+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),o+=i.css,r&&(o+="}"),i.media&&(o+="}"),i.supports&&(o+="}");var l=i.sourceMap;l&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(l))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={id:i,exports:{}};return e[i](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="",s.nc=void 0;var a={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(a),s.d(a,{__set_webpack_public_path__:()=>O,default:()=>M});var e=s(79244);const t={_widgetLabel:"Floor Filter",floorfilter_noMap:"Floor Filter",floorfilter_notFloorAware:"The selected map is not floor aware"};var i=s(62686),o=s(54312),r=function(e,t,i,o){return new(i||(i=Promise))((function(r,l){function n(e){try{a(o.next(e))}catch(e){l(e)}}function s(e){try{a(o.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,s)}a((o=o.apply(e,t||[])).next())}))};class l{constructor(){this.filterDataSources=!1,this.filterByActiveFloorOnly=!1,this.autoSetOnFeatureSelection=!1,this.zoomOnAutoSet=!1}clear(){this.clearHandles(),this.jimuMapView&&this.filterDataSources&&this.updateDataSources(this.jimuMapView,this.widgetId,null,!0)}clearHandles(){try{this.jimuMapView&&this.registeredLvCreatedListener&&this.jimuMapView.removeJimuLayerViewCreatedListener(this.registeredLvCreatedListener),this.jimuMapView&&this.registeredSelChangeListener&&this.jimuMapView.removeJimuLayerViewSelectedFeaturesChangeListener(this.registeredSelChangeListener),this.ffLevelHandle&&this.ffLevelHandle.remove(),this.vwFloorsHandle&&this.vwFloorsHandle.remove()}catch(e){console.error(e)}finally{this.registeredLvCreatedListener=null,this.registeredSelChangeListener=null,this.ffLevelHandle=null,this.vwFloorsHandle=null}}init(e,t,i){var r,l,n,s,a,d,u,c,f;this.clearHandles(),this.jimuMapView=e,this.coreFloorFilterWidget=i;const h=this.widgetId=null===(r=null==t?void 0:t.props)||void 0===r?void 0:r.id,v=this.filterDataSources=!!(null===(n=null===(l=null==t?void 0:t.props)||void 0===l?void 0:l.config)||void 0===n?void 0:n.filterDataSources),p=this.filterByActiveFloorOnly=!!(null===(a=null===(s=null==t?void 0:t.props)||void 0===s?void 0:s.config)||void 0===a?void 0:a.filterByActiveFloorOnly),g=this.autoSetOnFeatureSelection=!!(null===(u=null===(d=null==t?void 0:t.props)||void 0===d?void 0:d.config)||void 0===u?void 0:u.autoSetOnFeatureSelection),m=this.zoomOnAutoSet=!!(null===(f=null===(c=null==t?void 0:t.props)||void 0===c?void 0:c.config)||void 0===f?void 0:f.zoomOnAutoSet);e&&e.view&&i&&(v||g)&&(v&&(p?this.ffLevelHandle=o.watch((()=>i.level),(t=>{this.updateDataSources(e,h,t,p)})):this.vwFloorsHandle=o.watch((()=>i.view.floors),(()=>{const t=i.level;this.updateDataSources(e,h,t,p)})),this.registeredLvCreatedListener=t=>{const o=i.level;this.updateDataSources(e,h,o,p,t)},e.addJimuLayerViewCreatedListener(this.registeredLvCreatedListener),this.updateDataSources(e,h,i.level,p)),g&&(this.registeredSelChangeListener=e=>{this.selectedFeaturesChangeListener(e,i,m)},e.addJimuLayerViewSelectedFeaturesChangeListener(this.registeredSelChangeListener)))}selectedFeaturesChangeListener(e,t,i){var o,r,l,n,s,a,d;const u=null==e?void 0:e.getLayerDataSource(),c=null==u?void 0:u.layer,f=null==e?void 0:e.layer;let h=(null===(o=null==c?void 0:c.floorInfo)||void 0===o?void 0:o.floorField)||(null===(r=null==f?void 0:f.floorInfo)||void 0===r?void 0:r.floorField);if(u&&h&&t){const e=null==u?void 0:u.getSelectedRecords();if(1===(null==e?void 0:e.length)&&(null===(n=null===(l=e[0])||void 0===l?void 0:l.feature)||void 0===n?void 0:n.attributes)){null===(s=null==c?void 0:c.fields)||void 0===s||s.some((e=>h.toLowerCase()===e.name.toLowerCase()&&(h=e.name,!0)));const o=e[0].feature.attributes[h];if(o&&t.level!==o){const e=t.facility;if(null===(a=t.viewModel)||void 0===a?void 0:a.getLevel(o)){console.log("FloorFilter: auto changing level...",null==f?void 0:f.title,o),t.level=o;const r=t.facility,l=null===(d=t.viewModel)||void 0===d?void 0:d.getFacility(r);i&&l&&e!==r&&t.viewModel.goTo(l)}}}}}updateDataSources(t,i,o,l,n){var s,a,d,u,c,f;const h=null===(s=null==t?void 0:t.view)||void 0===s?void 0:s.floors,v=[];if("string"==typeof o&&o.startsWith("all--")){o=null;const e=null===(a=this.coreFloorFilterWidget)||void 0===a?void 0:a.facility,t=null===(f=null===(c=null===(u=null===(d=this.coreFloorFilterWidget)||void 0===d?void 0:d.viewModel)||void 0===u?void 0:u.filterFeatures)||void 0===c?void 0:c.levels)||void 0===f?void 0:f.levelsInfo;e&&t&&t.forEach((t=>{t.facilityId===e&&v.push(t.id)}))}const p=(e,t)=>{let i=t;if(t&&e&&e.length>0){const o=t.toLowerCase();e.some((e=>o===e.name.toLowerCase()&&(i=e.name,!0)))}return i},g=(t,i,r,n)=>{var s,a;let d=null,u=null;const c=null==i?void 0:i.getSelectedRecords();if(1===(null==c?void 0:c.length)&&(null===(a=null===(s=c[0])||void 0===s?void 0:s.feature)||void 0===a?void 0:a.attributes)&&(u=c[0].feature.attributes[t]),!l||r)if(h&&h.length>0){const o=[];if(h.forEach((i=>{if(i){const r=e.dataSourceUtils.createSQLClause(t,e.ClauseOperator.StringOperatorIs,[{value:i,label:i+""}]);o.push(r)}})),o.length>0){const r=e.dataSourceUtils.createSQLClause(t,e.ClauseOperator.StringOperatorIsBlank,[{value:null,label:"null"}]);o.push(r);const l=e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,o,i);d={where:l.sql,sqlExpression:l}}else d={where:"1=1",sqlExpression:null}}else d={where:"1=1",sqlExpression:null};else if(l)if(o){const r=e.dataSourceUtils.createSQLClause(t,e.ClauseOperator.StringOperatorIs,[{value:o,label:o+""}]),l=e.dataSourceUtils.createSQLClause(t,e.ClauseOperator.StringOperatorIsBlank,[{value:null,label:"null"}]),n=e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,[r,l],i);d={where:n.sql,sqlExpression:n}}else if(d={where:"1=1",sqlExpression:null},v&&v.length>0){const o=[];v.forEach((i=>{const r=e.dataSourceUtils.createSQLClause(t,e.ClauseOperator.StringOperatorIs,[{value:i,label:i+""}]);o.push(r)}));const r=e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,o,i);d={where:r.sql,sqlExpression:r}}return u&&this.autoSetOnFeatureSelection&&(console.log("FloorFilter: clearing single selection:",n,"on",u),i.clearSelection()),d},m=e=>r(this,void 0,void 0,(function*(){var t,r,n,s;const a=null==e?void 0:e.getLayerDataSource(),d=!1,u=null==a?void 0:a.layer,c=null==e?void 0:e.layer;if((null===(t=null==c?void 0:c.floorInfo)||void 0===t?void 0:t.floorField)&&"function"==typeof c.when&&"loading"===c.loadStatus&&(yield c.when()),a){let e=(null===(r=null==u?void 0:u.floorInfo)||void 0===r?void 0:r.floorField)||(null===(n=null==c?void 0:c.floorInfo)||void 0===n?void 0:n.floorField);if(e&&u&&("feature"===u.type||"scene"===u.type)){e=p(u.fields,e);const t=a;if("function"==typeof t.updateQueryParams){const o=g(e,t,d,null==c?void 0:c.title);o&&t.updateQueryParams(o,i)}}}else{let e=null===(s=null==c?void 0:c.floorInfo)||void 0===s?void 0:s.floorField;if(e&&c&&("feature"===(null==c?void 0:c.type)||"scene"===(null==u?void 0:u.type))){e=p(c.fields,e);const t=((e,t)=>{let i=[];if(!l||t?h&&h.length>0&&(i=h.toArray()):l&&o?i=[o]:l&&v&&v.length>0&&(i=v),i&&i.length>0)return i=i.map((e=>{return`'${t=e,"string"==typeof t?t.replace(/'/g,"''"):t}'`;var t})),`(${e} IN (${i.join(",")}))`;return"1=1"})(e,d);((e,t)=>{e.xtnOrigDefExpr||(e.xtnOrigDefExpr=e.definitionExpression||"none"),e.xtnOrigDefExpr&&"none"!==e.xtnOrigDefExpr&&(t="("+e.xtnOrigDefExpr+") AND "+t),e.definitionExpression=t})(c,t)}}}));if(n)m(n);else{const e=null==t?void 0:t.getAllJimuLayerViews();Array.isArray(e)&&e.forEach((e=>{m(e)}))}}}var n=s(53175),d=s(85072),u=s.n(d),c=s(97825),f=s.n(c),h=s(77659),v=s.n(h),p=s(55056),g=s.n(p),m=s(10540),w=s.n(m),y=s(41113),S=s.n(y),x=s(36449),C={};C.styleTagTransform=S(),C.setAttributes=g(),C.insert=v().bind(null,"head"),C.domAPI=f(),C.insertStyleElement=w();u()(x.A,C);x.A&&x.A.locals&&x.A.locals;var L=s(14321),F=s(54802),b=s.n(F);class M extends e.React.PureComponent{constructor(e){super(e),this.clearHandles=e=>{Array.isArray(e)&&e.forEach((e=>{try{e&&e.remove()}catch(e){console.error(e)}}))},this.handleActiveViewChange=e=>{var t;this.setState({hadMap:!(!this.state.hadMap&&!(null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.map)),jimuMapView:e})},this.hasFloorInfo=()=>{var e,t,i;return!!(null===(i=null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map)||void 0===i?void 0:i.floorInfo)},this.hasMap=()=>{var e,t;return!!(null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map)},this.nls=(e,i)=>this.props.intl?this.props.intl.formatMessage({id:e,defaultMessage:t[e]},i):e,this.dsFilter=new l,this.state={hadMap:!1,jimuMapView:null,wasMounted:!1}}componentDidMount(){this.setState({wasMounted:!0})}componentDidUpdate(e,t){const i=this.state,o=this.props;i.wasMounted&&!t.wasMounted?this.loadCoreWidget():i.jimuMapView!==t.jimuMapView||o.config.filterDataSources!==e.config.filterDataSources||o.config.filterByActiveFloorOnly!==e.config.filterByActiveFloorOnly||o.config.autoSetOnFeatureSelection!==e.config.autoSetOnFeatureSelection||o.config.zoomOnAutoSet!==e.config.zoomOnAutoSet?i.wasMounted&&this.loadCoreWidget():o.config.longNames!==e.config.longNames?this.coreWidget&&(this.coreWidget.longNames=!!o.config.longNames):o.config.position!==e.config.position&&this.coreWidget&&this.coreWidget.scheduleRender()}componentWillUnmount(){this.destroyCoreWidget()}destroyCoreWidget(){if(this.dsFilter.clear(),this.coreWidget){const e=this.coreWidget.view;this.coreWidget.destroy(),this.coreWidget=null,e&&(e.floors=this.vwOriginalFloors||null)}this.vwHeightHandle&&(this.clearHandles([this.vwHeightHandle]),this.vwHeightHandle=null),this.vwWidthHandle&&(this.clearHandles([this.vwWidthHandle]),this.vwWidthHandle=null)}fixBreakpoints(e){setTimeout((()=>{var t;const i=null===(t=this.coreWidget)||void 0===t?void 0:t.viewModel;let o="large";try{document.documentElement.classList.contains("size-mode-MEDIUM")?o="medium":document.documentElement.classList.contains("size-mode-SMALL")&&(o="xsmall")}catch(e){console.error(e)}!i||"both"!==e&&"widthBreakpoint"!==e||(i._viewWidthBreakpoint=o),!i||"both"!==e&&"heightBreakpoint"!==e||(i._viewHeightBreakpoint=o)}),100)}loadCoreWidget(){if(this.coreContainer){if(this.hasFloorInfo()){this.destroyCoreWidget();const e=document.createElement("div");this.coreContainer.appendChild(e);const t=!!this.props.config.longNames,i=this.state.jimuMapView.view;this.coreWidget=new n.default({container:e,longNames:t,view:i});let r=!0;const l=o.watch((()=>this.coreWidget.viewModel.filterFeatures),(()=>{r&&(r=!1,this.dsFilter.init(this.state.jimuMapView,this,this.coreWidget)),l.remove()}));this.coreWidget._getComponentPosition=()=>this.props.config.position||"top-left",this.vwOriginalFloors=i.floors&&i.floors.clone(),this.fixBreakpoints("both"),this.vwWidthHandle=o.watch((()=>i.widthBreakpoint),(()=>{this.fixBreakpoints("widthBreakpoint")})),this.vwHeightHandle=o.watch((()=>i.heightBreakpoint),(()=>{this.fixBreakpoints("heightBreakpoint")}))}else this.destroyCoreWidget()}}render(){var t;const o=this.props.config.displayLabel?this.props.label:null,r=this.hasMap(),l=this.hasFloorInfo(),n=!l;let s;r?l||(s=this.nls("floorfilter_notFloorAware")):s=this.nls("floorfilter_noMap");let a="jimu-widget widget-floorfilter";return s&&(a+=" widget-floorfilter-nomap"),(0,e.jsx)("div",{className:a},!n&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("h4",{className:"widget-floorfilter-header",style:{display:o?"block":"none"}},o),(0,e.jsx)("div",{className:"widget-floorfilter-msg",style:{display:s?"block":"none"}},(0,e.jsx)("span",{className:"esri-icon esri-icon-urban-model"}),(0,e.jsx)("span",{style:{margin:"0 8px"}},s)),(0,e.jsx)("div",{className:"widget-floorfilter-container",ref:e=>{this.coreContainer=e}})),(0,e.jsx)(i.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.handleActiveViewChange}),n&&this.renderWidgetPlaceholder())}renderWidgetPlaceholder(){const t=this.hasMap(),i=this.hasFloorInfo(),o=this.nls("_widgetLabel");let r;return t&&(i||(r=this.nls("floorfilter_notFloorAware"))),(0,e.jsx)(L.WidgetPlaceholder,{direction:"vertical",iconSize:"small",icon:b(),"aria-label":o,name:o,message:r})}}function O(e){s.p=e}})(),a})())}}}));