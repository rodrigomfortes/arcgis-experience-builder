System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-arcgis","jimu-ui/basic/list-tree","jimu-theme"],(function(e,t){var a={},n={},i={},o={},r={},l={};return{setters:[function(e){a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.React=e.React,a.ReactRedux=e.ReactRedux,a.SupportedJSAPILayerTypes=e.SupportedJSAPILayerTypes,a.classNames=e.classNames,a.css=e.css,a.hooks=e.hooks,a.jsx=e.jsx},function(e){n.Alert=e.Alert,n.Switch=e.Switch,n.defaultMessages=e.defaultMessages},function(e){i.JimuLayerViewSelector=e.JimuLayerViewSelector,i.MapWidgetSelector=e.MapWidgetSelector,i.SettingRow=e.SettingRow,i.SettingSection=e.SettingSection,i.SidePopper=e.SidePopper},function(e){o.MapViewManager=e.MapViewManager},function(e){r.List=e.List},function(e){l.useTheme=e.useTheme}],execute:function(){e((()=>{var e={1027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},1888:e=>{"use strict";e.exports=l},2529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},2686:e=>{"use strict";e.exports=o},3195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},3303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},4321:e=>{"use strict";e.exports=n},8640:e=>{"use strict";e.exports=r},9244:e=>{"use strict";e.exports=a},9298:e=>{"use strict";e.exports=i}},t={};function s(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var c={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(c),s.d(c,{__set_webpack_public_path__:()=>k,default:()=>C});var e=s(9244),t=s(4321),a=s(9298),n=s(2686),i=function(e,t,a,n){return new(a||(a=Promise))((function(i,o){function r(e){try{s(n.next(e))}catch(e){o(e)}}function l(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,l)}s((n=n.apply(e,t||[])).next())}))};const o=t=>{var a;const{type:n}=t,i=n===e.SupportedJSAPILayerTypes.ImageryLayer,o=n===e.SupportedJSAPILayerTypes.ImageryTileLayer,r=!!(null===(a=null==t?void 0:t.sourceJSON)||void 0===a?void 0:a.allowRasterFunction);return i&&r||o},r=e=>i(void 0,void 0,void 0,(function*(){var t;if(!e)return{};const a=n.MapViewManager.getInstance().getJimuMapViewById(e);return yield null==a?void 0:a.whenJimuMapViewLoaded(),null!==(t=null==a?void 0:a.jimuLayerViews)&&void 0!==t?t:{}})),l=(e="",t="")=>`${e}-${t}`,u=e=>!o(e.layer),d=(e,t)=>{var a,n;return null!==(n=null===(a=null==t?void 0:t[e])||void 0===a?void 0:a.isEnabled)&&void 0!==n&&n},p=(e,t)=>i(void 0,void 0,void 0,(function*(){const a=((e,t)=>{var a;return null===(a=null==t?void 0:t[e])||void 0===a?void 0:a.selectedLayerViewIds})(e,t);return(yield m(e)).filter((e=>a.includes(e)))})),m=e=>i(void 0,void 0,void 0,(function*(){const t=yield r(e),a=Object.keys(t);yield Promise.allSettled(a.map((e=>t[e].layer.load())));return a.filter((e=>o(t[e].layer)))})),v={customizeLayer:"Customize layers",selectLayers:"Select layers",noDataSourceWarning:"The selected Map widget does not contain a Web Map or a Web Scene."},g=n=>{const{jimuMapViewId:o,dataSourceId:r,settingProps:{id:l,config:s,onSettingChange:c}}=n,[g,y]=e.React.useState([]),f=d(o,s.customizeLayersOptions);e.React.useEffect((()=>{((e,t)=>i(void 0,void 0,void 0,(function*(){return e?d(e,t)?p(e,t):m(e):[]})))(o,s.customizeLayersOptions).then((e=>{y(e)}))}),[o,f]);const S=e.hooks.useTranslation(v),w=((t="")=>{var a,n;const i=e.DataSourceManager.getInstance().getDataSource(t);return null!==(n=null!==(a=null==i?void 0:i.getLabel())&&void 0!==a?a:null==i?void 0:i.getDataSourceJson().sourceLabel)&&void 0!==n?n:t})(r);return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(a.SettingRow,{tag:"label",label:S("customizeLayer"),className:"w-100 pl-4 pr-4"},(0,e.jsx)(t.Switch,{checked:f,"aria-label":S("customizeLayer"),onChange:e=>{((e,t)=>{c({id:l,config:s.setIn(["customizeLayersOptions",e],{isEnabled:t,selectedLayerViewIds:t?g:[]})})})(o,e.target.checked)}})),f&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(a.SettingRow,{className:"w-100 pl-4 pr-4",label:w,"aria-label":w}),(0,e.jsx)("div",{className:"select-jimu-layer-view-selector-container p-4"},(0,e.jsx)(a.JimuLayerViewSelector,{isMultiSelection:!0,jimuMapViewId:o,selectedValues:g,onChange:e=>{y(e),c({id:l,config:s.setIn(["customizeLayersOptions",o],{isEnabled:!0,selectedLayerViewIds:e})})},hideLayers:u}))))};var y=s(8640),f=s(3195),S=s.n(f),w=s(2529),h=s.n(w),x=s(3303),b=s.n(x),j=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a};const M=i=>{var o,r;const{mapWidgetId:s,sidePopperContent:c,onClick:u,"aria-describedby":d=""}=i,p=j(i,["mapWidgetId","sidePopperContent","onClick","aria-describedby"]),m=e.React.useRef(""),g=e.React.useRef(null),[f,w]=e.React.useState(!1),[x,M]=e.React.useState(null),[I,L]=e.React.useState(!1),O=e.ReactRedux.useSelector((e=>{var t,a,n;const i=e.appStateInBuilder;return i&&(null===(n=null===(a=null===(t=null==i?void 0:i.appConfig)||void 0===t?void 0:t.widgets)||void 0===a?void 0:a[s])||void 0===n?void 0:n.useDataSources)})),R=e.ReactRedux.useSelector((e=>{const t=e.appStateInBuilder;return t&&(null==t?void 0:t.dataSourcesInfo)}),((e,t)=>{if(O){for(const a of O)if(e&&t&&e[a.dataSourceId]!==t[a.dataSourceId])return!1;return!0}return!0})),V=e.hooks.useTranslation(t.defaultMessages,v);e.React.useEffect((()=>{if(!I)if(O&&0!==(null==O?void 0:O.length)){let t=0;for(const a of O){const n=null==R?void 0:R[a.dataSourceId];!n||n.instanceStatus!==e.DataSourceStatus.Created&&n.instanceStatus!==e.DataSourceStatus.CreateError||(t++,t===O.length&&L(!0))}}else L(!0)}),[I,R,O]);const z=e.React.useCallback((()=>{const t=[];for(let e=0;e<2;e++)t.push({itemKey:e.toString(),itemStateCommands:[{iconProps:()=>({icon:" ",size:12,style:{opacity:0}})}]});return(0,e.jsx)(y.List,{className:"w-100",itemsJson:t,dndEnabled:!1})}),[]),P=null===(r=null===(o=null==O?void 0:O.asMutable())||void 0===o?void 0:o.sort(((e,t)=>e.dataSourceId.localeCompare(t.dataSourceId))))||void 0===r?void 0:r.map((t=>{var a,i,o,r;const c=t.dataSourceId,u=e.DataSourceManager.getInstance().getDataSource(c),d=l(s,c),p=n.MapViewManager.getInstance().getJimuMapViewById(d),m="3d"===(null===(a=null==p?void 0:p.view)||void 0===a?void 0:a.type);let v=null;if(u){v={itemStateTitle:null!==(r=null!==(i=u.getLabel())&&void 0!==i?i:null===(o=u.getDataSourceJson())||void 0===o?void 0:o.sourceLabel)&&void 0!==r?r:c,itemKey:c,itemStateIcon:{icon:m?h():S()},itemStateCommands:[{label:V("selectLayers"),iconProps:()=>({icon:b()})}]}}else v={itemStateTitle:V("none"),itemKey:c,itemStateDisabled:!0};return v})),C=e.React.useCallback(((e,t)=>{const{itemJsons:a}=t.props,n=a[0];let i=0;const o=P;for(;i<o.length&&o[i].itemKey!==n.itemKey;i++);const r=g.current.querySelectorAll(".jimu-tree-item__body")[i];M(r),u&&u(n.itemKey),m.current===n.itemKey?(m.current="",w(!1)):(m.current=n.itemKey,w(!0))}),[P,u]);return(0,e.jsx)("div",{ref:g,className:"w-100 multiple-jimu-map-config-component",css:e.css`
    .jimu-tree-main {
      padding-top: 2px;
    }
    .jimu-tree-item {
      padding: 2px;
    }
    .jimu-tree-item__icon {
      width: 1rem;
      height: 1rem;
      margin-right: 0.5rem;
      svg {
        margin-right: 0!important;
      }
    }
    .jimu-tree-item__body {
      background-color: transparent!important;
    }
  `,"aria-describedby":d},I?(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(y.List,Object.assign({},p,{itemsJson:P,onClickItemCommand:C})),(0,e.jsx)(a.SidePopper,{position:"right",isOpen:f,toggle:()=>{w(!1),m.current="",null==g||g.current.focus()},title:V("selectLayers"),trigger:null==g?void 0:g.current,backToFocusNode:x},c)):z())};var I=s(1888),L=s(1027),O=s.n(L),R=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a};const V=t=>{const a=window.SVG,{className:n}=t,i=R(t,["className"]),o=(0,e.classNames)("jimu-icon jimu-icon-component",n);return a?e.React.createElement(a,Object.assign({className:o,src:O()},i)):e.React.createElement("svg",Object.assign({className:o},i))},z=t=>e.css`
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    font-size: 0.875rem;
    color: ${t.ref.palette.neutral[1e3]};
    overflow: hidden;
    svg {
      flex-shrink: 0;
    }
  `,P=t=>{const{text:a,icon:n,style:i}=t,o=(0,I.useTheme)();return(0,e.jsx)("div",{css:z(o),style:i},n||(0,e.jsx)(V,{size:48,color:o.ref.palette.neutral[800]}),(0,e.jsx)("div",{className:"mt-4 px-4"},a))},C=i=>{var o;const{id:r,useMapWidgetIds:s,onSettingChange:c}=i,[u,d]=e.React.useState(""),p=e.hooks.useTranslation(t.defaultMessages,v),m=(null==s?void 0:s.length)>0,y=null!==(o=null==s?void 0:s[0])&&void 0!==o?o:"",f=(e=>{var t,a,i;if(!e)return!0;const o=null===(t=n.MapViewManager.getInstance().getJimuMapViewGroup(e))||void 0===t?void 0:t.jimuMapViews;return!o||1===Object.keys(o).length&&!(null===(i=null===(a=Object.values(o))||void 0===a?void 0:a[0])||void 0===i?void 0:i.dataSourceId)})(y),S=l(y,u);return(0,e.jsx)(a.SettingSection,{className:"h-100",title:p("selectMapWidget")},(0,e.jsx)(a.SettingRow,{className:"w-100","aria-label":p("selectMapWidget")},(0,e.jsx)(a.MapWidgetSelector,{onSelect:e=>{c({id:r,useMapWidgetIds:e})},useMapWidgetIds:s})),m?(0,e.jsx)(a.SettingRow,{className:"w-100 mt-4","aria-label":p("selectLayers")},f?(0,e.jsx)(t.Alert,{type:"warning",text:p("noDataSourceWarning"),closable:!1,withIcon:!1,"aria-label":p("noDataSourceWarning")}):(0,e.jsx)(M,{mapWidgetId:null==s?void 0:s[0],sidePopperContent:(0,e.jsx)(g,{jimuMapViewId:S,dataSourceId:u,settingProps:i}),onClick:e=>{d(e)},"aria-label":p("selectLayers")})):(0,e.jsx)(P,{text:p("selectMapHint"),style:{height:"calc(100% - 6rem"}}))};function k(e){s.p=e}})(),c})())}}}));