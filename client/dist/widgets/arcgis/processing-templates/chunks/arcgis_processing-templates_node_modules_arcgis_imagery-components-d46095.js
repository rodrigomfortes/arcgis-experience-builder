/*! For license information please see arcgis_processing-templates_node_modules_arcgis_imagery-components-d46095.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_processing-templates_node_modules_arcgis_imagery-components-d46095"],{608:(e,t,i)=>{i.d(t,{a:()=>m,b:()=>b,c:()=>u,d:()=>f,e:()=>d,f:()=>r,g:()=>h,h:()=>c,i:()=>g,m:()=>s,u:()=>n});const s=10.9,n=Number.MAX_VALUE-1;function a(e,t){const i=new Date(e),{useFriendlyIsoFormat:s,intl:n,format:a}=t;if(s&&n)return n.formatDate(i,{...n.convertDateFormatToIntlOptions(a??"short-date-long-time"),timeZone:"UTC"});let l=new Date(e).toISOString();return l=`${l.slice(0,l.indexOf("."))}Z`,l}function l(e,t,i="long"){const s=new Date(2022,9,10);return s.setMonth(e-1),t.formatDate(s,{month:i})}function r(e,t,i={}){if(null==e)return"";const{intl:s,useRecurringTimeLabel:n}=i;if(n&&s&&!Array.isArray(e)){const i=t.unit?.toLowerCase().trim();if(function(e){return"StdTime"===e.name&&!!e.recurring}(t)&&("months"===i||"quarters"===i))return"months"===i?l(e,s):function(e,t){return`${l(3*(e-1)+1,t,"short")} - ${l(3*e,t,"short")}`}(e,s)}const r=t.values?.[t.values.length-1];return i.useStartOrEndForRangedValue&&Array.isArray(e)&&2===e.length&&Array.isArray(r)&&(e=e.join("-")===r.join("-")?e[1]:e[0]),m(t)?(i.useFriendlyIsoFormat&&!i.format&&(i={format:o(t),...i}),Array.isArray(e)?e.map((e=>a(e,i))).join(" - "):a(e,i)):Array.isArray(e)?e.map((e=>s?.formatNumber(e)??String(e))).join(" - "):s?.formatNumber(e)??String(e)}function o(e){let t=e.intervalUnit?.toLowerCase().trim()??"";const{extent:i}=e,s=e.interval??0,n=e.values?.length;if(!["years","months","days","hours"].includes(t)&&i?.length&&n){const e=(i[1]-i[0])/n,s=864e5;t=e>=365*s?"years":e>=28*s?"months":t}switch(t){case"months":t=s>11?"years":t;break;case"days":t=s>364?"years":s>27?"months":t;break;case"hours":t="days"}return"years"===t?"year":"months"===t?"short-month-year":"short-date"}function c(e,t){const i=t?.dimensions?.find((({name:t})=>t===e.name));if(!i?.extent)return e;const s=[...i.extent],{values:n}=e;if(n?.length){const t=n.filter((e=>Array.isArray(e)?null==s[1]||s[0]===s[1]?e[0]===s[0]:e[0]>=s[0]&&e[0]<=s[1]&&e[1]>=s[0]&&e[1]<=s[1]:e>=s[0]&&e<=s[1]));if(0===t.length){const e=n[n.length-1];Array.isArray(e)&&e[1]===s[0]&&t.push(e)}return{...e,extent:s,values:t}}return{...e,extent:s}}function d(e){const{values:t,extent:i,name:s}=e;let n=t?.[0]??i?.[0];return"stdz"===s.toLowerCase()&&!e.hasRanges&&i&&Math.abs(i[1])<=Math.abs(i[0])&&(n=t?.length?t[t.length-1]:i[1]),n}function u(e){return"imagery-tile"===e.type||"wcs"===e.type?e.multidimensionalDefinition:(e.mosaicRule??e.defaultMosaicRule)?.multidimensionalDefinition}async function h(e,t=!1){if("imagery-tile"===e.type||"wcs"===e.type)return e.serviceRasterInfo?.multidimensionalInfo;const{rasterFunction:i,version:s}=e;return t||s<=10.9||!i||"none"===i.functionName?.toLowerCase()?e.serviceRasterInfo.multidimensionalInfo:(await e.generateRasterInfo(e.rasterFunction).catch((()=>e.serviceRasterInfo))).multidimensionalInfo}function m(e,t=!1){return"StdTime"===e.name&&(t||!e.recurring)}function f(e,t,i){t=c(t,i);const s=r(e.values[0],t);if(!t.values?.some((e=>s===r(e,t)))){const i=d(t);e.values=null!=i?[i]:[]}}function g(e){return Array.isArray(e[0])}function b(e){return e.variables.map((({name:e,unit:t,description:i})=>({name:e,label:t?`${e} (${t})`:e,description:i})))}},2227:(e,t,i)=>{i.d(t,{D:()=>r});var s=i(608),n=i(3306),a=i(2939),l=i(2797);function r(e){const{position:t="default",dimensionInfo:i}=e,r="start"===t||"end"===t,{values:o}=i;let{selectedValue:c}=e;o&&(0,s.i)(o)&&"number"==typeof c&&(c=r?c=o.find((e=>"start"===t?e[0]===c:e[1]===c)):o.find((e=>e[0]===c))??o.find((e=>e[1]===c)));const d=c===s.u||e.selectedValue===s.u,u=d?"undefined":(0,s.f)(c,i,{intl:l,useRecurringTimeLabel:!0}),h=(e.isAscending?i.values:[...i.values].reverse()).map((e=>{const n=(0,s.f)(e,i,{intl:l,useRecurringTimeLabel:!0}),a=Array.isArray(e)?e.join(" - "):String(e),r=n===u;return{key:`${i.name}-${t}-${a}}`,value:a,label:n,selected:r}})),{messages:m}=e;e.showEnd&&h.push({key:`${i.name}-end-undefined`,value:String(s.u),label:m.extent.endUndefined,selected:d});const f=Math.max(0,h.findIndex((({selected:e})=>e)));return a.qy`<div class=${(0,n.CP)(e.className)}><arcgis-imagery-lazy-loading-select .selectedIndex=${f} .list=${h} .messages=${e.selectMessages} @arcgisChange=${t=>{t.stopPropagation();const i=t.detail.selectedValue.split(" - ").map((e=>Number(e)));e.onChange?.(1===i.length?i[0]:i)}} .containerTop=${e.containerTop}></arcgis-imagery-lazy-loading-select>${e.sortable&&function(e,t,i,n){const l=(0,s.a)(e)?t?"clock-up":"clock-down":t?"sort-ascending-arrow":"sort-descending-arrow";return a.qy`<calcite-action .icon=${l} scale=s .text=${i} slot=actions-end @click=${()=>n?.(e.name)}></calcite-action>`}(i,e.isAscending,m.display.sort,e.updateSorting)||""}</div>`}},3784:(e,t,i)=>{i.d(t,{u:()=>r});var s=i(2939),n=i(9901),a=i(157);const l=(e,t,i)=>{const s=new Map;for(let n=t;n<=i;n++)s.set(e[n],n);return s},r=(0,n.u$)(class extends n.WL{constructor(e){if(super(e),e.type!==n.OA.CHILD)throw Error("repeat() can only be used in text expressions")}dt(e,t,i){let s;void 0===i?i=t:void 0!==t&&(s=t);const n=[],a=[];let l=0;for(const t of e)n[l]=s?s(t,l):l,a[l]=i(t,l),l++;return{values:a,keys:n}}render(e,t,i){return this.dt(e,t,i).values}update(e,[t,i,n]){const r=(0,a.cN)(e),{values:o,keys:c}=this.dt(t,i,n);if(!Array.isArray(r))return this.ut=c,o;const d=this.ut??=[],u=[];let h,m,f=0,g=r.length-1,b=0,v=o.length-1;for(;f<=g&&b<=v;)if(null===r[f])f++;else if(null===r[g])g--;else if(d[f]===c[b])u[b]=(0,a.lx)(r[f],o[b]),f++,b++;else if(d[g]===c[v])u[v]=(0,a.lx)(r[g],o[v]),g--,v--;else if(d[f]===c[v])u[v]=(0,a.lx)(r[f],o[v]),(0,a.Dx)(e,u[v+1],r[f]),f++,v--;else if(d[g]===c[b])u[b]=(0,a.lx)(r[g],o[b]),(0,a.Dx)(e,r[f],r[g]),g--,b++;else if(void 0===h&&(h=l(c,b,v),m=l(d,f,g)),h.has(d[f]))if(h.has(d[g])){const t=m.get(c[b]),i=void 0!==t?r[t]:null;if(null===i){const t=(0,a.Dx)(e,r[f]);(0,a.lx)(t,o[b]),u[b]=t}else u[b]=(0,a.lx)(i,o[b]),(0,a.Dx)(e,r[f],i),r[t]=null;b++}else(0,a.KO)(r[g]),g--;else(0,a.KO)(r[f]),f++;for(;b<=v;){const t=(0,a.Dx)(e,u[v+1]);(0,a.lx)(t,o[b]),u[b++]=t}for(;f<=g;){const e=r[f++];null!==e&&(0,a.KO)(e)}return this.ut=c,(0,a.mY)(e,u),s.c0}})},5190:(e,t,i)=>{i.d(t,{_:()=>m,K:()=>b});var s=i(2939),n=i(157),a=i(9901);const l=(e,t)=>{const i=e._$AN;if(void 0===i)return!1;for(const e of i)e._$AO?.(t,!1),l(e,t);return!0},r=e=>{let t,i;do{if(void 0===(t=e._$AM))break;i=t._$AN,i.delete(e),e=t}while(0===i?.size)},o=e=>{for(let t;t=e._$AM;e=t){let i=t._$AN;if(void 0===i)t._$AN=i=new Set;else if(i.has(e))break;i.add(e),u(t)}};function c(e){void 0!==this._$AN?(r(this),this._$AM=e,o(this)):this._$AM=e}function d(e,t=!1,i=0){const s=this._$AH,n=this._$AN;if(void 0!==n&&0!==n.size)if(t)if(Array.isArray(s))for(let e=i;e<s.length;e++)l(s[e],!1),r(s[e]);else null!=s&&(l(s,!1),r(s));else l(this,e)}const u=e=>{e.type==a.OA.CHILD&&(e._$AP??=d,e._$AQ??=c)};class h extends a.WL{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,i){super._$AT(e,t,i),o(this),this.isConnected=e._$AU}_$AO(e,t=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),t&&(l(this,e),r(this))}setValue(e){if((0,n.Rt)(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}const m=()=>new f;class f{}const g=new WeakMap,b=(0,a.u$)(class extends h{render(e){return s.s6}update(e,[t]){const i=t!==this.G;return i&&void 0!==this.G&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=t,this.ht=e.options?.host,this.rt(this.ct=e.element)),s.s6}rt(e){if(this.isConnected||(e=void 0),"function"==typeof this.G){const t=this.ht??globalThis;let i=g.get(t);void 0===i&&(i=new WeakMap,g.set(t,i)),void 0!==i.get(this.G)&&this.G.call(this.ht,void 0),i.set(this.G,e),void 0!==e&&this.G.call(this.ht,e)}else this.G.value=e}get lt(){return"function"==typeof this.G?g.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}})},7368:(e,t,i)=>{i.r(t),i.d(t,{ArcgisImageryMultidimensionalSubset:()=>b});var s=i(7212),n=i(3784),a=i(608),l=i(2227),r=i(9047),o=i(4951),c=i(2e3),d=i(7516),u=i(5190),h=i(3306),m=i(6233),f=i(9916);const g=m.AH`.variable-section-boarder{border:1px solid var(--calcite-color-border-3)}.variable-select{display:flex;justify-content:center}.multidimensional-extent{>div{margin:10px 0}}.dimension-zone{padding:10px;border:1px solid var(--calcite-color-border-3);margin:10px 0}.dimension-select-container{display:flex;width:100%;align-items:center;.dimension-select{flex-grow:1}}`;class b extends h.WF{constructor(){super(...arguments),this.aoiIndex=0,this.allVariables=[],this.previousPickedListSize=-1,this._showFilterLength=5,this.refElement=(0,u._)(),this.dimensionStartValues={},this.dimensionEndValues={},this.sortDirections={},this.showAreaOfInterest=!1,this.collapseExtentSection=!1,this.multidimensionalSubset=void 0,this.arcgisChange=(0,h.lh)()}static{this.properties={sortDirections:16,showAreaOfInterest:5,collapseExtentSection:5,showFilterLength:[9,{hasChanged:()=>!1}],messages:0,multidimensionalInfo:0,multidimensionalSubset:0,view:0}}static{this.styles=g}get showFilterLength(){return this._showFilterLength}set showFilterLength(e){this._showFilterLength=e,this.renderPickListPopover()}async closePopover(){this.outsideContainer?.remove(),this.outsideContainer=void 0}load(){const{select:e,extent:t}=this.messages;this.selectMessages={clear:e.clearFilter,label:t.searchVariables,selectLabel:t.selectVariables},this.initMultidimensionalInfo()}willUpdate(e){if(this.hasUpdated&&(e.has("multidimensionalInfo")&&(this.closePopover(),this.initMultidimensionalInfo()),e.has("multidimensionalSubset")&&null==this.multidimensionalSubset)){this.multidimensionalSubset=this.getDefaultMultidimensionalSubset();const{multidimensionalInfo:e,outsideContainer:t}=this;e&&t&&this.previousPickedListSize>0&&this.renderPickListPopover()}}disconnectedCallback(){super.disconnectedCallback(),this.dimensionStartValues={},this.dimensionEndValues={},this.closePopover()}removeVariable(e){const t=this.multidimensionalSubset.clone();let i=t.subsetDefinitions?.filter((t=>t.variableName!==e));(null==i||0===i.length)&&(this.dimensionStartValues={},this.dimensionEndValues={},i=this.getDefaultMultidimensionalSubset().subsetDefinitions??void 0),t.subsetDefinitions=i,this.updateActiveMultidimensionalSubset(t)}initMultidimensionalInfo(){this.allVariables=(0,a.b)(this.multidimensionalInfo),this.dimensionStartValues={},this.dimensionEndValues={},this.multidimensionalSubset??=this.getDefaultMultidimensionalSubset()}updateExtentDimensionSubset(e,t,i="both"){const{multidimensionalSubset:s}=this,n=[...s.dimensions.find((t=>t.name===e)).extent];if("both"===i){if(Array.isArray(t)&&n[0]===t[0]&&n[1]===t[1])return;[n[0],n[1]]=t}else"start"===i?(n[0]=Array.isArray(t)?t[0]:t,this.dimensionEndValues[e]===a.u&&(n[1]=Array.isArray(t)?t[1]:t)):t===a.u?this.dimensionStartValues[e]&&this.dimensionStartValues[e].length>0?n[1]=this.dimensionStartValues[e][this.dimensionStartValues[e].length-1]:n[1]=n[0]:n[1]=Array.isArray(t)?t[t.length-1]:t;const l=s.clone(),{subsetDefinitions:r}=l;r.forEach((t=>{t.dimensionName===e&&(t.values=[n[0],n[1]])})),this.updateActiveMultidimensionalSubset(l)}updateExtentVariables(e){const{multidimensionalSubset:t}=this;if(e.length&&t.variables.length&&e.join(",")===t.variables.join(","))return;this.previousPickedListSize=e.length,0===e.length&&(e=this.allVariables.map((({name:e})=>e)));const i=this.getDefaultMultidimensionalSubset(e),{subsetDefinitions:s}=i.clone();s.forEach((e=>{const i=t.subsetDefinitions.find((t=>t.variableName===e.variableName&&t.dimensionName===e.dimensionName));if(i)e.values=i.values;else{const i=t.dimensions.find((t=>t.name===e.dimensionName));i&&(e.values=[...i.extent])}}));const n=t.clone();n.subsetDefinitions=s,this.updateActiveMultidimensionalSubset(n)}updateExtentAOI(e){const t=this.multidimensionalSubset.clone();t.areaOfInterest=e?.clone(),this.updateActiveMultidimensionalSubset(t)}getDefaultMultidimensionalSubset(e){const t=[];for(const i of this.multidimensionalInfo.variables){const{name:s,dimensions:n}=i;if(!e?.length||e.includes(s))if(0===n.length)t.push(new r.default({variableName:s,dimensionName:"",values:[],isSlice:!1}));else for(const e of n){const{name:i,values:n,extent:a}=e,l=a?.slice()??[];if(n?.length&&!l.length){const e=n[0],t=n[n.length-1];l[0]=Array.isArray(e)?e[0]:e,l[1]=Array.isArray(t)?t[t.length-1]:t}t.push(new r.default({variableName:s,dimensionName:i,values:l,isSlice:!1}))}}return new o.default({subsetDefinitions:t})}updateActiveMultidimensionalSubset(e){this.multidimensionalSubset=e;const t=this.getDefaultMultidimensionalSubset(),i=JSON.stringify(e.subsetDefinitions??void 0)!==JSON.stringify(t.subsetDefinitions??void 0),s=null!=e.areaOfInterest;if(i||s)if(i)this.arcgisChange.emit({subset:e});else{const t=e.clone();t.subsetDefinitions=[],this.arcgisChange.emit({subset:t})}else this.arcgisChange.emit({subset:void 0})}render(){return d.qy`<calcite-block .heading=${this.messages.extent.extent} collapsible .open=${!this.collapseExtentSection} @calciteBlockClose=${()=>{this.closePopover()}} ${(0,u.K)(this.refElement)}>${this.renderVariableList()}${this.allVariables.length>1&&this.renderVariableSelectButton()||""}${this.renderExtents()}${this.showAreaOfInterest&&this.renderAOI()||""}</calcite-block>`}renderExtents(){const e=[];return this.multidimensionalInfo.variables.forEach((({dimensions:t})=>e.push(...t))),this.multidimensionalSubset.dimensions.map((({name:t,extent:i})=>{const s=e.find((({name:e})=>e===t));return this.renderDimensionExtent(s,i)})).filter((e=>null!=e))}renderVariableSelectButton(){return d.qy`<div class="variable-select"><calcite-button scale=s appearance=outline-fill kind=neutral round alignment=center icon-start=plus @click=${()=>this.renderPickListPopover()}>${this.messages.extent.variables}</calcite-button></div>`}renderVariableList(){const e=this.multidimensionalSubset.variables,t=this.allVariables.filter((({name:t})=>!e.length||e.includes(t))),{messages:i}=this,s=1===this.allVariables.length;return d.qy`<div><calcite-label>${i.extent.variables}<calcite-list .label=${i.extent.variables} class="variable-section-boarder">${(0,n.u)(t,(({name:e})=>e),(({name:e,label:t,description:n})=>d.qy`<calcite-list-item .label=${t} .description=${n??""}><calcite-action icon=x scale=s .text=${i.general.close} slot=actions-end .hidden=${s} @click=${()=>this.removeVariable(e)}></calcite-action></calcite-list-item>`))}</calcite-list></calcite-label></div>`}renderAOI(){const{messages:e}=this,t=[{value:"default",label:e.extent.default,selected:0===this.aoiIndex},{value:"map",label:e.extent.mapExtent,selected:1===this.aoiIndex}],i=t.findIndex((({selected:e})=>e)),{top:s}=this.el.getBoundingClientRect();return d.qy`<div><calcite-label>${e.extent.aoi}<arcgis-imagery-lazy-loading-select .selectedIndex=${i} .list=${t} .messages=${this.selectMessages} @arcgisChange=${e=>{e.stopPropagation();const t=e.detail.selectedValue,i="default"===t?void 0:this.view?.extent;this.aoiIndex="default"===t?0:1,this.updateExtentAOI(i)}} .containerTop=${s}></arcgis-imagery-lazy-loading-select></calcite-label></div>`}renderDimensionList(e,t,i,s){const n=(0,a.i)(e),r="end"===s,o=n?e.filter((e=>r?e[0]>=t[0]:e[1]<=t[1])):e.filter((e=>r?e>t[0]:e<t[1])),c=t[1]===t[0]||n&&e.some((e=>e[0]===t[0]&&e[1]===t[1])),d=c&&!r?i:{...i,values:o},u=r?c?a.u:t[1]:t[0];r?this.dimensionEndValues[i.name]=u:n&&(this.dimensionStartValues[i.name]=e.find((e=>e[0]===u)));const{top:h}=this.el.getBoundingClientRect();return(0,l.D)({dimensionInfo:d,selectedValue:u,sortable:!1,isAscending:!0,className:"dimension-select-container",position:s,showEnd:r,onChange:e=>this.updateExtentDimensionSubset(i.name,e,s),messages:this.messages,selectMessages:this.selectMessages,containerTop:h})}renderSlider(e,t,i){const s=e.length,n=(0,u._)(),a=(0,c.sg)((()=>{const i=n.value?.value;if(null==i)return;const s=Array.isArray(i),a=s?i[0]:i,l=s?i[1]??i[0]:i,r=e[a],o=e[l],c=Array.isArray(r)?r[0]:r,d=Array.isArray(o)?o[1]:o;this.updateExtentDimensionSubset(t,[c,d])}),100);let l=0,r=s-1;const o=this.multidimensionalSubset.dimensions.find((({name:e})=>e===t))?.extent;return o?.length&&(l=e.findIndex((e=>(Array.isArray(e)?e[0]:e)===o[0])),-1===l&&(l=0),r=e.findIndex((e=>(Array.isArray(e)?e[1]:e)===o[1])),-1===r&&(r=s-1)),i[0]===i[1]?d.qy`<calcite-slider min=0 .max=${s-1} .value=${l} step=1 snap .ticks=${s} @calciteSliderInput=${a} @calciteSliderChange=${a} ${(0,u.K)(n)}></calcite-slider>`:d.qy`<calcite-slider min=0 .max=${s-1} .minValue=${l} .maxValue=${r} step=1 snap .ticks=${s} @calciteSliderInput=${a} @calciteSliderChange=${a} ${(0,u.K)(n)}></calcite-slider>`}renderDimensionExtent(e,t){const{name:i,values:s}=e;if(!s?.length)return null;const n=this.renderDimensionList(s,t,e,"start"),a=this.renderDimensionList(s,t,e,"end"),l=this.renderSlider(s,i,t),{extent:r}=this.messages,o="StdTime"===i?r.stdTimeExtent:"StdZ"===i?r.stdZExtent:r.generalExtent.replace("${dimensionName}",i);return d.qy`<div class="dimension-zone"><calcite-label>${o}</calcite-label>${l}<div class="multidimensional-extent"><div><calcite-label>${r.start}${n}</calcite-label></div><div><calcite-label>${r.end}${a}</calcite-label></div></div></div>`}renderPickListPopover(){const e=this.refElement.value;if(!e)return;this.outsideContainer??=(0,f.c)();const t=e.getBoundingClientRect().width,{selectVariables:i}=this.messages.extent;this.previousPickedListSize=-1;const{allVariables:s}=this,n=this.multidimensionalSubset.variables,a=s.map((e=>({name:e.name,alias:e.name,type:"String",description:e.description??""})));(0,d.XX)(d.qy`<arcgis-field-pick-list .heading=${i} .popoverProps=${{refElement:e,placement:"leading-start",offsetDistance:1,offsetSkidding:48,popoverWidth:t}} .fields=${a} .showFilterLength=${this.showFilterLength} .selectedFields=${n} .filterPlaceholderText=${i} show-description show-selection-all multiple @arcgisFieldPickListChange=${e=>{this.updateExtentVariables(e.detail.selectedFields||[])}} @arcgisFieldPickListDismissed=${()=>this.closePopover()}></arcgis-field-pick-list>`,this.outsideContainer)}}(0,s.c)("arcgis-imagery-multidimensional-subset",b)},9916:(e,t,i)=>{function s(){const e=document.createElement("div");return document.body.appendChild(e),e}i.d(t,{c:()=>s})}}]);