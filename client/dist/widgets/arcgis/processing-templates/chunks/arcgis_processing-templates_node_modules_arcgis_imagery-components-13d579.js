/*! For license information please see arcgis_processing-templates_node_modules_arcgis_imagery-components-13d579.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_processing-templates_node_modules_arcgis_imagery-components-13d579"],{4806:(e,t,i)=>{i.r(t),i.d(t,{ArcgisImageryItemFiltersPopover:()=>g});var s=i(7212),n=i(6629),r=i(4312),l=i(2e3),a=i(6250),c=i(8685),o=i(7516),u=i(3306),d=i(5190);const h=i(6233).AH`.aoi-select-button{border:1px solid var(--calcite-color-border-input)}.dropdown-container{display:flex;justify-content:space-between;gap:1rem}.slider-value-container{display:flex;gap:1rem}.slider-value-box{border:.8px solid var(--calcite-color-border-input);display:flex;width:50%;min-height:16px;padding:7px 12px;cursor:default;align-items:center}.filter-wrapper{padding:1rem;min-width:320px;background-color:var(--calcite-color-foreground-1)}`;class g extends u.WF{constructor(){super(...arguments),this.selectedAOI=a.A.DISPLAY_EXTENT,this.isOverviewsIncluded=!1,this.isQueryingImageItems=!1,this.isQueryingFieldValues=!1,this.selectedQueryFieldValues=[],this.fieldValuesForInput=[],this.fieldMinMaxValuesForInput=[],this.isRangeValueModeSelected=!0,this.isShowingIncludeOverviewTooltip=!1,this.isShowingRangeModeTooltip=!1,this.arcgisImageItemFilterApply=(0,u.lh)(),this.arcgisImageItemFiltersPopoverClose=(0,u.lh)()}static{this.properties={activeQueryField:16,selectedAOI:16,isOverviewsIncluded:16,isQueryingImageItems:16,isQueryingFieldValues:16,selectedQueryFieldValues:16,fieldValuesForInput:16,fieldMinMaxValuesForInput:16,isRangeValueModeSelected:16,isShowingIncludeOverviewTooltip:16,isShowingRangeModeTooltip:16,layer:0,messages:0,locale:1,open:5,view:0,currentFilterDetail:0,referenceElement:0}}static{this.styles=h}load(){this.currentMapExtent=this.view.extent;const e=(0,c.g)(this.layer?.fields),t=(0,c.a)(e);this.activeQueryField=t,this.manager.onLifecycle((()=>[(0,r.watch)((()=>[this.view.stationary,this.view.extent]),(0,l.sg)((()=>{this.view.stationary&&(this.selectedAOI===a.A.DISPLAY_EXTENT||this.selectedAOI===a.A.VISIBLE)&&!(0,c.c)(this.currentMapExtent,this.view)&&(this.fetchAndPopulateLayerAttributeValues(this.activeQueryField),this.currentMapExtent=this.view.extent)}),300)),(0,r.watch)((()=>this.view.timeExtent),(0,l.sg)((()=>{this.open&&this.view.stationary&&this.layer.useViewTime&&this.selectedAOI===a.A.VISIBLE&&this.view.timeExtent&&this.fetchAndPopulateLayerAttributeValues(this.activeQueryField)}),300))]))}willUpdate(e){e.has("open")&&this.updateModal(this.open)}updateModal(e){if(e){if(this.activeQueryField=this.layer.fields.find((e=>e.name===this.currentFilterDetail?.queryField?.name))??this.activeQueryField,this.currentFilterDetail){const{selectedAOI:e,isIncludeOverviews:t,isRangeModeEnabled:i}=this.currentFilterDetail;this.selectedAOI=e,this.isOverviewsIncluded=t,this.isRangeValueModeSelected=i??!0}this.fetchAndPopulateLayerAttributeValues(this.activeQueryField)}}handleImageItemQueryApply(){const{view:e,activeQueryField:t,isOverviewsIncluded:i,selectedAOI:s,selectedQueryFieldValues:n}=this,r=(0,c.b)(e),l={selectedAOI:s,queryField:t,queryValues:n,isIncludeOverviews:i,displayExtent:s===a.A.DISPLAY_EXTENT?r:null,isRangeModeEnabled:this.isRangeValueModeSelected,dropdownVals:this.fieldValuesForInput,sliderMinMaxVals:this.fieldMinMaxValuesForInput};this.arcgisImageItemFilterApply.emit(l)}async fetchAndPopulateLayerAttributeValues(e){const{layer:t,view:i,selectedAOI:s,fetchAbortController:n,locale:r}=this;n&&n.abort();try{if(this.fetchAbortController=new AbortController,this.isQueryingFieldValues=!0,this.fieldValuesForInput=[],this.selectedQueryFieldValues=[],(0,a.c)(e)||!(0,a.i)(e.type)&&"date"!==e.type){const n=(await(0,c.e)(t,e,s,i,this.fetchAbortController?.signal)).sort(((e,t)=>(0,a.d)(e,t,r)));this.fieldValuesForInput=n,n.length>0&&(this.selectedQueryFieldValues=this.currentFilterDetail?.queryValues&&this.currentFilterDetail.queryValues?.length>0&&this.currentFilterDetail.queryValues[0]&&n.includes(this.currentFilterDetail.queryValues[0])?[this.currentFilterDetail.queryValues[0]]:[n[0]])}else{const n=await(0,c.d)(t,e,s,i,this.fetchAbortController?.signal);this.fieldMinMaxValuesForInput=n;const[r,l]=n;if(this.selectedQueryFieldValues=[r,l],this.currentFilterDetail?.queryValues&&this.currentFilterDetail.queryValues.length>0){const[e,t]=this.currentFilterDetail.queryValues;e&&t&&e>=r&&t<=l&&(this.selectedQueryFieldValues=[e,t])}}this.isQueryingFieldValues=!1}catch(e){this.isQueryingFieldValues=(0,a.e)(e)}}getSliderStep(e,t){const i=Math.max((0,a.f)(e),(0,a.f)(t));return 0===i?1:Math.floor((t-e)/Math.pow(10,-i))<=1?Math.pow(10,-(i+2)):Math.pow(10,-i)}floorToFourDecimals(e){return Math.floor(1e4*e)/1e4}ceilToFourDecimals(e){return Math.ceil(1e4*e)/1e4}render(){const{messages:e,open:t}=this;return o.qy`<calcite-popover .open=${t} .label=${e.filters} .referenceElement=${this.referenceElement} closable .heading=${e.filters} placement=leading-start overlay-positioning=fixed pointer-disabled trigger-disabled offset-distance=10 offset-skidding=50 @calcitePopoverClose=${()=>this.arcgisImageItemFiltersPopoverClose.emit()}><calcite-panel>${this.renderFilterInput()}</calcite-panel></calcite-popover>`}renderFilterInput(){return o.qy`<div class="filter-wrapper">${this.renderAOISelectDropdown()}${this.renderAttributeSelectDropdown()}${this.renderAttributeInputField()}${this.renderIncludeOverviewSwitchButton()}${this.renderApplyButton()}</div>`}renderAOISelectDropdown(){const{messages:e,selectedAOI:t}=this,i=[{name:a.A.DISPLAY_EXTENT,label:e.displayExtent,description:e.displayExtentDesc},{name:a.A.VISIBLE,label:e.visible,description:e.visibleDesc},{name:a.A.ALL,label:e.all,description:e.allDesc}],s=i.find((e=>e.name===t)),n=i.map((e=>o.qy`<calcite-dropdown-item data-value=${e.name??o.s6} .selected=${e.name===s?.name}><strong>${e.label}</strong><div>${e.description}</div></calcite-dropdown-item>`));return o.qy`<calcite-label>${e.areaOfInterest}<calcite-dropdown width=m placement=bottom @calciteDropdownSelect=${e=>{const t=e.currentTarget?.selectedItems?.[0]?.getAttribute("data-value");this.selectedAOI=t,this.activeQueryField&&this.fetchAndPopulateLayerAttributeValues(this.activeQueryField)}}><calcite-button class="aoi-select-button" slot=trigger alignment=space-between icon-end=chevron-down appearance=transparent kind=neutral width=full>${s?.label}</calcite-button><calcite-dropdown-group>${n}</calcite-dropdown-group></calcite-dropdown></calcite-label>`}renderAttributeSelectDropdown(){const{messages:e,activeQueryField:t,layer:i}=this,s=(0,c.g)(i?.fields),n=s.filter((e=>!(0,a.h)(e))).map((e=>o.qy`<calcite-option .value=${e.name} .label=${e.alias??""} .selected=${e.name===t.name}></calcite-option>`));return o.qy`<calcite-label>${e.attribute}<calcite-select .label=${e.attribute} @calciteSelectChange=${e=>{const i=e.currentTarget.selectedOption.value;if(i!==t.name){const e=s.find((e=>e.name===i));this.selectedQueryFieldValues=[],this.activeQueryField=e,this.fetchAndPopulateLayerAttributeValues(this.activeQueryField)}}}>${n}</calcite-select></calcite-label>`}renderAttributeInputField(){const{messages:e,activeQueryField:t,isQueryingFieldValues:i}=this,s=t.type;return i?o.qy`<calcite-loader .label=${e.loading} scale=s inline></calcite-loader>`:(0,a.c)(t)||!(0,a.i)(s)&&"date"!==s?this.renderAttributeDropdownInput():this.renderAttributeSliderInput()}renderSliderSelectedVals(){const{selectedQueryFieldValues:e,activeQueryField:t,isRangeValueModeSelected:i}=this;if(2!==e?.length)return"";let s=null,n=null;return[s,n]=e,"date"===t.type?(s=(0,a.g)(s),n=(0,a.g)(n)):(s=this.floorToFourDecimals(s),n=this.ceilToFourDecimals(n)),o.qy`<div class="slider-value-container">${i&&null!==s&&""!==s&&o.qy`<div class="slider-value-box">${s}</div>`||""}${null!==n&&""!==n&&o.qy`<div class="slider-value-box">${n}</div>`||""}</div>`}renderAttributeSliderInput(){const{messages:e,fieldMinMaxValuesForInput:t,isRangeValueModeSelected:i,selectedQueryFieldValues:s,activeQueryField:r,isQueryingFieldValues:c}=this;if(c)return"";if(0===t.length)return this.renderNoImagesMatchFilterErrorMessage();const u=t.filter((e=>"number"==typeof e)),h=2===u.length&&u[0]!==u[1];if(2===u.length&&u[0]===u[1]){const[t]=u;return o.qy`<calcite-select .label=${e.select} @calciteSelectChange=${e=>{const t=e.currentTarget.selectedOption.value;this.selectedQueryFieldValues=[t]}}><calcite-option .value=${t} .label=${"date"===r.type?(0,a.g)(t)??"":t.toString()} .selected=${this.selectedQueryFieldValues?.length>0&&t.toString()===this.selectedQueryFieldValues[0]?.toString()}></calcite-option></calcite-select>`}if(h){const e=u[0],t=u[1],r=this.getSliderStep(e,t),a=(0,d._)(),c=(0,l.sg)((()=>{Array.isArray(a.value?.value)&&(this.selectedQueryFieldValues=a.value.value),"number"==typeof a.value?.value&&(this.selectedQueryFieldValues=[Math.min(s[0],a.value.value),Math.max(s[0],a.value.value)])}),10);return o.qy`<div>${this.renderRangeModeSwitchButton()}${this.renderSliderSelectedVals()}${i?(0,n.D)("range-value-slider",o.qy`<calcite-slider .minValue=${s[0]} .maxValue=${s[1]} .min=${e} .max=${t} snap .step=${r} precise @calciteSliderInput=${c} @calciteSliderChange=${c} ${(0,d.K)(a)}></calcite-slider>`):(0,n.D)("single-value-slider",o.qy`<calcite-slider .value=${s[1]} .min=${e} .max=${t} snap .step=${r} precise @calciteSliderInput=${c} @calciteSliderChange=${c} ${(0,d.K)(a)}></calcite-slider>`)}</div>`}return this.renderNoRecordErrorMessage()}renderAttributeDropdownInput(){const{messages:e,activeQueryField:t,fieldValuesForInput:i,isQueryingFieldValues:s}=this;if(s)return"";if(0===i.length)return this.renderNoImagesMatchFilterErrorMessage();const n=i.filter((e=>0===e||!!e));if(n.length>0){const i=(0,a.c)(t),r=n.map((e=>{if(null==e)return"";const s=i?t.domain.getName(e):e.toString();return o.qy`<calcite-option .value=${e} .label=${s} .selected=${this.selectedQueryFieldValues?.length>0&&e.toString()===this.selectedQueryFieldValues[0]?.toString()}></calcite-option>`}));return o.qy`<calcite-select .label=${e.select} .disabled=${s} width=full @calciteSelectChange=${e=>{const t=e.currentTarget.selectedOption.value;this.selectedQueryFieldValues=[t]}}>${r}</calcite-select>`}return this.renderNoRecordErrorMessage()}renderNoImagesMatchFilterErrorMessage(){const{messages:e}=this;return o.qy`<calcite-input-message icon=exclamation-mark-triangle status=invalid>${e.noImagesMatchFilterSettings}</calcite-input-message>`}renderNoRecordErrorMessage(){const{messages:e}=this;return o.qy`<calcite-input-message icon=exclamation-mark-triangle status=invalid>${e.noFieldAttributesErrorMessage}</calcite-input-message>`}renderRangeModeSwitchButton(){const{messages:e,isRangeValueModeSelected:t,isShowingRangeModeTooltip:i}=this,s="rangeModeSwitchAction";return o.qy`<calcite-label layout=inline>${e.rangeMode}<calcite-action id=${s} icon=information scale=s .text=${e.rangeMode} @mouseover=${()=>{this.isShowingRangeModeTooltip=!0}} @mouseout=${()=>{this.isShowingRangeModeTooltip=!1}} @click=${e=>{e.stopPropagation()}}></calcite-action><calcite-tooltip .open=${i} .referenceElement=${s}>${e.rangeModelHelpMessage}</calcite-tooltip><calcite-switch style=${(0,u.zl)({marginInlineStart:"auto"})} .checked=${t} @calciteSwitchChange=${e=>{const t=e.target.checked;this.isRangeValueModeSelected=t}}></calcite-switch></calcite-label>`}renderIncludeOverviewSwitchButton(){const{messages:e,isOverviewsIncluded:t,isShowingIncludeOverviewTooltip:i}=this,s="isIncludeOverviewsAction";return o.qy`<calcite-label layout=inline>${e.includeOverviews}<calcite-action icon=information scale=s .text=${e.includeOverviewsHelpMessage} id=${s} @mouseover=${()=>{this.isShowingIncludeOverviewTooltip=!0}} @mouseout=${()=>{this.isShowingIncludeOverviewTooltip=!1}} @click=${e=>{e.stopPropagation()}}></calcite-action><calcite-tooltip .open=${i} .referenceElement=${s}>${e.includeOverviewsHelpMessage}</calcite-tooltip><div style=${(0,u.zl)({marginInlineStart:"auto"})}><calcite-switch .checked=${t} scale=m @calciteSwitchChange=${e=>{const t=e.target.checked;this.isOverviewsIncluded=t}}></calcite-switch></div></calcite-label>`}renderApplyButton(){const{messages:e,isQueryingFieldValues:t,isQueryingImageItems:i}=this;return o.qy`<calcite-button .label=${e.apply} @click=${this.handleImageItemQueryApply} appearance=solid width=full .disabled=${t||i}>${e.apply}</calcite-button>`}}(0,s.c)("arcgis-imagery-item-filters-popover",g)},5190:(e,t,i)=>{i.d(t,{_:()=>g,K:()=>f});var s=i(2939),n=i(157),r=i(9901);const l=(e,t)=>{const i=e._$AN;if(void 0===i)return!1;for(const e of i)e._$AO?.(t,!1),l(e,t);return!0},a=e=>{let t,i;do{if(void 0===(t=e._$AM))break;i=t._$AN,i.delete(e),e=t}while(0===i?.size)},c=e=>{for(let t;t=e._$AM;e=t){let i=t._$AN;if(void 0===i)t._$AN=i=new Set;else if(i.has(e))break;i.add(e),d(t)}};function o(e){void 0!==this._$AN?(a(this),this._$AM=e,c(this)):this._$AM=e}function u(e,t=!1,i=0){const s=this._$AH,n=this._$AN;if(void 0!==n&&0!==n.size)if(t)if(Array.isArray(s))for(let e=i;e<s.length;e++)l(s[e],!1),a(s[e]);else null!=s&&(l(s,!1),a(s));else l(this,e)}const d=e=>{e.type==r.OA.CHILD&&(e._$AP??=u,e._$AQ??=o)};class h extends r.WL{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,i){super._$AT(e,t,i),c(this),this.isConnected=e._$AU}_$AO(e,t=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),t&&(l(this,e),a(this))}setValue(e){if((0,n.Rt)(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}const g=()=>new p;class p{}const m=new WeakMap,f=(0,r.u$)(class extends h{render(e){return s.s6}update(e,[t]){const i=t!==this.G;return i&&void 0!==this.G&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=t,this.ht=e.options?.host,this.rt(this.ct=e.element)),s.s6}rt(e){if(this.isConnected||(e=void 0),"function"==typeof this.G){const t=this.ht??globalThis;let i=m.get(t);void 0===i&&(i=new WeakMap,m.set(t,i)),void 0!==i.get(this.G)&&this.G.call(this.ht,void 0),i.set(this.G,e),void 0!==e&&this.G.call(this.ht,e)}else this.G.value=e}get lt(){return"function"==typeof this.G?m.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}})},6250:(e,t,i)=>{i.d(t,{A:()=>s,I:()=>n,S:()=>r,a:()=>v,b:()=>y,c:()=>d,d:()=>f,e:()=>a,f:()=>$,g:()=>g,h:()=>h,i:()=>u,j:()=>m,k:()=>l,s:()=>o});var s=(e=>(e.VISIBLE="visible",e.DISPLAY_EXTENT="displayExtent",e.ALL="all",e))(s||{}),n=(e=>(e.ALL="all",e.SELECT="select",e))(n||{}),r=(e=>(e.ASC="asc",e.DESC="desc",e))(r||{}),l=(e=>(e.BRAND="brand",e.DANGER="danger",e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e))(l||{});function a(e){return"object"==typeof e&&null!==e&&"name"in e&&"AbortError"===e.name}const c=new Set(["small-integer","big-integer","integer","single","double","oid"]),o=new Set([...c,"date","string"]);function u(e){return c.has(e)}function d(e){return!!e?.domain?.codedValues}function h(e){return d(e)&&"MosaicCatalogItemCategoryDomain"===e?.domain?.name}function g(e,t=!1){if(!e)return null;const i=new Date(e),s=t?i.getUTCFullYear():i.getFullYear(),n=t?i.getUTCMonth():i.getMonth(),r=t?i.getUTCDate():i.getDate(),l=t?i.getUTCHours():i.getHours(),a=t?i.getUTCMinutes():i.getMinutes(),c=t?i.getUTCSeconds():i.getSeconds();return`${s}-${p((n+1).toString(),2,"0")}-${p(r.toString(),2,"0")} ${p(l.toString(),2,"0")}:${p(a.toString(),2,"0")}:${p(c.toString(),2,"0")}`}function p(e,t,i){for(i=i||" ";e.length<t;)e=i+e;return e}function m(e,t,i){return e+t-1>i?i:e+t-1}function f(e,t,i="en"){return"string"==typeof e&&"string"==typeof t?e.localeCompare(t,i):e<t?-1:e>t?1:0}function y(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}function v(e,t){return`${e} IN (${t.map((e=>`${e}`)).join(",")})`}const $=(e,t="en")=>{const i=e.toString();if(i.includes("e")){const[e,t]=i.split("e"),s=$(Number.parseFloat(e)),n=Number.parseInt(t,10);return n<0?s-n:Math.max(0,s-n)}const s=i.indexOf(".");if(-1===s)return 0;const n=i.length-s-1;return new Intl.NumberFormat(t).formatToParts(1.1).find((e=>"decimal"===e.type))?n:0}},6629:(e,t,i)=>{i.d(t,{D:()=>l});var s=i(2939),n=i(9901),r=i(157);const l=(0,n.u$)(class extends n.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,r.mY)(e),this.key=t),i}})},8685:(e,t,i)=>{i.d(t,{a:()=>a,b:()=>g,c:()=>b,d:()=>m,e:()=>p,f:()=>h,g:()=>d,h:()=>v,i:()=>c,j:()=>o,k:()=>u,l:()=>$,m:()=>I,r:()=>w});var s=i(8423),n=i(2373),r=i(1552),l=i(6250);function a(e){const t=e.find((e=>"best"===e.name.toLowerCase()));if(t)return t;const i=e.find((e=>"acquisitiondate"===e.name.toLowerCase()));if(i)return i;return e.find((e=>"date"===e.name.toLowerCase()))||e.find((e=>"double"===e.type||"integer"===e.type))}async function c(e,t,i){return await e.queryObjectIds(t,{signal:i})}async function o(e,t,i){t.outFields=["*"],t.returnGeometry=!0;const s=await e.queryRasters(t,{signal:i,timeout:12e4});return s?.features?.length?s:null}function u(e,t){const i=e.fields;let s=i.find((e=>"name"===e.name.toLowerCase()));return s||(s=i.find((t=>t.name===e.objectIdField))),s&&s.name!==t.name?[s,t]:[t]}function d(e){return Array.isArray(e)?e.filter((e=>l.s.has(e.type))):[]}function h(e){const{layer:t,queryField:i,queryValues:s,isIncludeOverviews:n,extent:r,selectedImageItemOids:a}=e,c=t.createQuery();if(s&&s.length>0){let e="";if("date"===i?.type&&s[0]){const t=new Date(s[0]),n=(0,l.g)(s[0],!0),r=1===s.length||s[0]===s[1]?(0,l.g)(t.setDate(t.getDate()+1),!0):(0,l.g)(s[1],!0);e=`${i.name} BETWEEN timestamp '${n}' AND timestamp '${r}'`}else{const t=s.filter((e=>"string"==typeof e||"number"==typeof e));if(1===t.length||2===t.length){const[n,r]=s,l="string"==typeof n;e=1===t.length?`${i?.name}=${l?`'${n}'`:n}`:`${i?.name} BETWEEN ${l?`'${n}'`:n} AND ${l?`'${r}'`:r}`}}c.where=e}const o="(Category = 1)";if(n)c.where=c.where?.replace(o,"");else{const e=o+(c.where?` AND (${c.where})`:"");c.where=e}let u="";return a&&a.length>0&&(u=(0,l.a)(t.objectIdField,a)),c.where=u?`${c.where} AND (${u})`:c.where,t.definitionExpression&&(c.where=c.where?`${c.where} AND (${t.definitionExpression})`:t.definitionExpression),r&&(c.geometry=r),c}function g(e){return e.extent?.clone().expand(.75)}async function p(e,t,i,s,n){if(!t)return[];const r=[{onStatisticField:t.name,outStatisticFieldName:"cnt",statisticType:"count"}],a=await f(e,i,s,r,[t.name]);if(a){const i=await e.queryRasters(a,{signal:n});if(i?.features?.length>0){const e=(0,l.i)(t.type);return i.features.map((i=>{const s=i.attributes[t.name];return e?Number(s):s}))}}return[]}async function m(e,t,i,s,n){if(!t.name)return[];const r=[{statisticType:"min",onStatisticField:t.name,outStatisticFieldName:"min_field_value"},{statisticType:"max",onStatisticField:t.name,outStatisticFieldName:"max_field_value"}],l=await f(e,i,s,r);if(l){const t=await e.queryRasters(l,{signal:n});if(t?.features?.length>0){const[e]=t.features;return[e.attributes.min_field_value,e.attributes.max_field_value]}}return[]}async function f(e,t,i,s,n=[]){const r=e.createQuery();if(r.returnGeometry=!1,t===l.A.DISPLAY_EXTENT&&(r.geometry=g(i)),t===l.A.VISIBLE){const t=await y(e,i);if(!(t.length>0))return null;r.where=(0,l.a)(e.objectIdField,t)}return e.definitionExpression&&(r.where=r.where?`${r.where} AND (${e.definitionExpression})`:e.definitionExpression),r.outStatistics=s,n.length>0&&(r.groupByFieldsForStatistics=n),r}async function y(e,t){const i=[],n=function(e,t){const{extent:i,width:n,height:l}=t,a=i.width/n,c=i.height/l,o=new s.default({x:a,y:c});o.spatialReference=i.spatialReference;const u=new r.default;u.geometry=g(t),u.returnGeometry=!0,u.pixelSize=o,u.maxItemCount=e.sourceJSON?.maxMosaicImageCount,u.returnPixelValues=!1;const d=e.mosaicRule.clone();return e.definitionExpression&&(d.where=e.definitionExpression),u.mosaicRule=d,e.useViewTime&&t.timeExtent&&(u.timeExtent=t.timeExtent),u}(e,t),l=await e.identify(n,{timeout:12e4});if(!l?.catalogItems?.features||!l?.catalogItemVisibilities)return[];for(let t=0;t<l.catalogItems.features.length;t++)l.catalogItemVisibilities[t]>0&&i.push(l.catalogItems.features[t].attributes[e.objectIdField]);return i}async function v(e,t,i){const s=await y(e,t);if(!(s.length>0))return null;i.objectIds=s,i.outFields=["*"],i.returnGeometry=!0;const n=await e.queryRasters(i,{timeout:12e4});return n?.features?.length>0?n:null}function $(e,t){if(t.length){const i=new n.default;i.method="lock-raster",i.lockRasterIds=t,e.definitionExpression&&(i.where=e.definitionExpression),e.mosaicRule=i}}function w(e,t){t&&(e.mosaicRule=t.clone())}function I(e,t,i){const{title:s}=e,n=t.name;let r="";const a=i.map((e=>e.attributes[n])).map((e=>"date"===t.type?(0,l.g)(e):e));return a.sort(((e,t)=>"number"==typeof e&&"number"==typeof t?e-t:String(e).localeCompare(String(t)))),1===a.length&&(r=`(${a[0]})`),a.length>1&&(r=`(${a[0]} - ${a[a.length-1]})`),`${s} - ${n} ${r}`}function b(e,t){return Math.abs(t.extent.center.x-e.center.x)<t.resolution&&Math.abs(t.extent.center.y-e.center.y)<t.resolution}}}]);