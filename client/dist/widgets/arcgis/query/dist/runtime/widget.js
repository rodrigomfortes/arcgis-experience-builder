System.register(["jimu-core","jimu-ui","jimu-ui/basic/list-tree","jimu-theme","jimu-arcgis","jimu-ui/basic/sql-expression-runtime","jimu-layouts/layout-runtime"],(function(e,t){var a={},n={},l={},o={},s={},r={},i={};return{setters:[function(e){a.BaseVersionManager=e.BaseVersionManager,a.CONSTANTS=e.CONSTANTS,a.DataLevel=e.DataLevel,a.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.Immutable=e.Immutable,a.MessageManager=e.MessageManager,a.React=e.React,a.ReactRedux=e.ReactRedux,a.RecordSetChangeType=e.RecordSetChangeType,a.appConfigUtils=e.appConfigUtils,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.focusElementInKeyboardMode=e.focusElementInKeyboardMode,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.i18n=e.i18n,a.injectIntl=e.injectIntl,a.isKeyboardMode=e.isKeyboardMode,a.jsx=e.jsx,a.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,a.lodash=e.lodash,a.moduleLoader=e.moduleLoader,a.utils=e.utils},function(e){n.Button=e.Button,n.Checkbox=e.Checkbox,n.DataActionList=e.DataActionList,n.DataActionListStyle=e.DataActionListStyle,n.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,n.FloatingPanel=e.FloatingPanel,n.Icon=e.Icon,n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.MobilePanel=e.MobilePanel,n.Modal=e.Modal,n.ModalBody=e.ModalBody,n.ModalFooter=e.ModalFooter,n.NumericInput=e.NumericInput,n.Option=e.Option,n.Pagination=e.Pagination,n.PanelHeader=e.PanelHeader,n.Select=e.Select,n.Tooltip=e.Tooltip,n.WidgetPlaceholder=e.WidgetPlaceholder,n.defaultMessages=e.defaultMessages},function(e){l.List=e.List,l.TreeItemActionType=e.TreeItemActionType},function(e){o.withTheme=e.withTheme},function(e){s.JimuMapViewComponent=e.JimuMapViewComponent,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.SqlExpressionRuntime=e.SqlExpressionRuntime,r.getShownClauseNumberByExpression=e.getShownClauseNumberByExpression},function(e){i.LayoutItemSizeModes=e.LayoutItemSizeModes}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=o},4651:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2m5 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0m6 0a1 1 0 1 1 2 0 1 1 0 0 1-2 0" clip-rule="evenodd"></path></svg>'},7835:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.125c.241 0 .437-.224.437-.5s-.196-.5-.437-.5zM0 7.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 8 0 7.776 0 7.5M0 13.5c0-.276.196-.5.438-.5h15.125c.241 0 .437.224.437.5s-.196.5-.437.5H.438C.196 14 0 13.776 0 13.5"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},14321:e=>{"use strict";e.exports=n},20715:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><g fill="#000" clip-path="url(#a)"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm9 1H2a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path><path d="M15 13.5v-7l1-1v8a2.5 2.5 0 0 1-2.5 2.5h-8l1-1h7a1.5 1.5 0 0 0 1.5-1.5M2.964 9.328l6.364-6.364.708.708-6.364 6.364z"></path><path d="M9.328 10.036 2.964 3.672l.707-.708 6.364 6.364z"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'},23001:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m4 2 8 6-8 6z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},34682:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14M8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},34700:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#fff" d="M14.417 0H0v12.888h5.607v-.805H.8V.806h12.815V6.04h.801z"></path><path fill="#fff" fill-rule="evenodd" d="M10.413 14.902a4.37 4.37 0 0 0 2.867-1.067L15.434 16l.566-.57-2.161-2.173c.612-.761.979-1.73.979-2.785 0-2.447-1.973-4.43-4.405-4.43s-4.406 1.983-4.406 4.43 1.973 4.43 4.406 4.43m0-.805c1.99 0 3.604-1.623 3.604-3.625s-1.614-3.625-3.604-3.625c-1.991 0-3.605 1.623-3.605 3.625s1.614 3.625 3.605 3.625" clip-rule="evenodd"></path><path fill="#fff" d="M2.403 2.417h9.611v.805H2.403zM7.209 4.833H2.403v.806h4.806zM2.403 7.25h2.403v.805H2.403zM4.806 9.666H2.403v.806h2.403z"></path></svg>'},35737:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m14 4-6 8-6-8z"></path></svg>'},41496:e=>{"use strict";e.exports=i},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},52943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=s},76117:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=a},87782:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><g fill="#000" clip-path="url(#a)"><path d="m5.854 9.06 4.353-4.353L9.5 4 5.854 7.646 4.207 6l-.707.707z"></path><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm9 1H2a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path><path d="M15 13.5v-7l1-1v8a2.5 2.5 0 0 1-2.5 2.5h-8l1-1h7a1.5 1.5 0 0 0 1.5-1.5"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},98640:e=>{"use strict";e.exports=l}},t={};function u(a){var n=t[a];if(void 0!==n)return n.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,u),l.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{__set_webpack_public_path__:()=>yt,default:()=>ht});var e,t,a,n,l,o=u(79244),s=u(14321);!function(e){e.Point="Point",e.Polyline="Polyline",e.Polygon="Polygon",e.Rectangle="Rectangle",e.Circle="Circle"}(e||(e={})),function(e){e.NewSelection="NEW_SELECTION",e.AddToSelection="ADD_TO_CURRENT_SELECTION",e.RemoveFromSelection="REMOVE_FROM_CURRENT_SELECTION",e.SubsetSelection="SUBSET_FROM_CURRENT_SELECTION",e.SwitchSelection="SWITCH_CURRENT_SELECTION"}(t||(t={})),function(e){e.Block="BLOCK",e.Inline="INLINE",e.Popper="POPPER"}(a||(a={})),function(e){e.CurrentMapExtent="CurrentMapExtent",e.InteractiveDrawMode="InteractiveDrawMode",e.None=""}(n||(n={})),function(e){e.Intersect="intersects",e.Contain="contains",e.Cross="crosses",e.EnvelopeIntersect="envelope-intersects",e.IndexIntersect="index-intersects",e.Overlap="overlaps",e.Touch="touches",e.Within="within"}(l||(l={}));const r={[l.Intersect]:"esriSpatialRelIntersects",[l.Contain]:"esriSpatialRelContains",[l.Cross]:"esriSpatialRelCrosses",[l.EnvelopeIntersect]:"esriSpatialRelEnvelopeIntersects",[l.IndexIntersect]:"esriSpatialRelIndexIntersects",[l.Overlap]:"esriSpatialRelOverlaps",[l.Touch]:"esriSpatialRelTouches",[l.Within]:"esriSpatialRelWithin"};var i;!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(i||(i={}));const d={[i.Miles]:"esriSRUnit_StatuteMile",[i.Kilometers]:"esriSRUnit_Kilometer",[i.Feet]:"esriSRUnit_Foot",[i.Meters]:"esriSRUnit_Meter",[i.NauticalMiles]:"esriSRUnit_NauticalMile"};var p,g,f,m,v,h;!function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(p||(p={})),function(e){e.MultiPage="MultiPage",e.LazyLoad="LazyLoad"}(g||(g={})),function(e){e.PopupSetting="PopupSetting",e.SelectAttributes="SelectAttributes"}(f||(f={})),function(e){e.Asc="Asc",e.Desc="Desc"}(m||(m={})),function(e){e.Single="Single",e.Multiple="Multiple"}(v||(v={})),function(e){e.DefaultSymbol="DefaultSymbol",e.CustomSymbol="CustomSymbol"}(h||(h={}));const y={_widgetLabel:"Query",noDataAvailable:"Error in loading data",noQueryItem:"No query",newQueryHint:'Add content by clicking the "{label}" button on the configuration panel',attributeFilter:"Attribute filter",spatialFilter:"Spatial filter",spatialFilterType_CurrentMapExtent:"Current map extent",spatialFilterType_InteractiveDrawMode:"Drawn graphic",results:"Results",featuresDisplayed:"Features displayed",clearResult:"Clear results",checkResult:"Check results",mapMustBeVisible:"Map must be visible",chooseFilterType:"Choose the filter type",chooseGeometryType:"Choose the geometry type",clearDrawing:"Clear the graphic when applying",featureFromDs:"Selecting features from data source",featureFromMap:"Geometries from a map",chooseFilterLayer:"Choose a filter layer",selectedRecords:"{num} records are selected for the filter",spatialNotAvailable:"Spatial filter is not available here.",spatialNotAvailableDesc:"Spatial filter is not supported for a data source that already contains a spatial query.",preconfigured:"Preconfigured",runtime:"Runtime",selectLoaded:"Select loaded"};var S=u(28996),b=u.n(S),x=u(34682),R=u.n(x),I=u(96300),w=u.n(I),C=u(52943),j=u.n(C),M=u(9044),D=u.n(M),N=u(4651),O=u.n(N);const P=()=>({iconMap:{iconQuery:u(34700),iconWarning:b(),iconError:R(),arrowNavBack:w(),arrowRight:j(),toolDelete:D(),iconMore:O()}});class E extends o.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.5.0",description:"1.5.0",upgrader:e=>{var t;let a=e;return null===(t=e.queryItems)||void 0===t||t.forEach(((e,t)=>{null==e.useAttributeFilter&&(a=a.setIn(["queryItems",t,"useAttributeFilter"],!0)),null==e.useSpatialFilter&&(a=a.setIn(["queryItems",t,"useSpatialFilter"],!0))})),a}},{version:"1.6.0",description:"1.6.0",upgrader:e=>{var t;let a=e;if((null===(t=e.queryItems)||void 0===t?void 0:t.length)>0){const t=e.queryItems[0];a=a.set("resultListDirection",t.resultListDirection),a=a.set("resultPagingStyle",t.resultPagingStyle)}return a}}]}}const T=new E;var k=u(98640),L=u(1888);const{useState:A}=o.React;(0,L.withTheme)((e=>{const{theme:t,panelVisible:a,setPanelVisible:n,getI18nMessage:l,isModal:r=!0,title:i=l("queryMessage"),bodyContent:u="",hasHeader:c=!0,hasFooter:d=!0}=e,p=()=>{n(!1)},g=()=>(0,o.jsx)(o.React.Fragment,null,c&&(0,o.jsx)(s.PanelHeader,{className:"py-2",title:i,onClose:p}),(0,o.jsx)(s.ModalBody,null,u),d&&(0,o.jsx)(s.ModalFooter,null,(0,o.jsx)(s.Button,{onClick:p},l("ok")))),f="ui-unit-dialog-panel";return r?(0,o.jsx)(s.Modal,{className:f,isOpen:a,toggle:p,backdrop:"static"},g()):(0,o.jsx)("div",{className:`${f} modal-dialog ${a?"":"collapse"}`,css:o.css`
      &.ui-unit-dialog-panel.modal-dialog {
        margin: 0;
        width: 100%;
        .modal-content {
          background-color: ${t.ref.palette.neutral[600]};
          color: ${t.ref.palette.black};
          font-size: .75rem;
          font-weight: 400;
          border: none;
          .panel-header {
            font-size: .8125rem;
            padding: .625rem;
          }
          .modal-body {
            padding: 0 .625rem .75rem;
            white-space: normal;
          }
        }
      }
    `},(0,o.jsx)("div",{className:"modal-content"},g()))}));var B;!function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(B||(B={}));const z=(0,L.withTheme)((e=>{const{theme:t,className:a,title:n,statusType:l}=e;return l&&(0,o.jsx)("div",{className:`${null!=a?a:""} ui-unit-status-indicator ui-unit-status-indicator_status-type-${l}`,title:n,css:o.css`
    &.ui-unit-status-indicator {
      display: flex;
      &.ui-unit-status-indicator_status-type-loading {
        &:before {
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          content: '';
          width: 1rem;
          height: 1rem;
          display: block;
          border: 1px solid ${null===(r=null===(s=null==t?void 0:t.ref.palette)||void 0===s?void 0:s.neutral)||void 0===r?void 0:r[500]};
          border-radius: 50%;
          border-top: 1px solid ${null===(u=null===(i=null==t?void 0:t.sys.color)||void 0===i?void 0:i.primary)||void 0===u?void 0:u.main};
          box-sizing: border-box;
          animation: loading 2s infinite linear;
          margin-right: .25rem;
        }
      }
    }
  `});var s,r,i,u}));function F(e){const{widgetId:t,useDataSourceId:a}=e;return o.ReactRedux.useSelector((e=>{var n;let l;l=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig;return(null!==(n=l.widgets[t].useDataSources)&&void 0!==n?n:[]).some((e=>e.dataSourceId===a))}))}function _(e){var t,a,n;const{widgetId:l,useDataSource:r,onStatusChange:i,onDataSourceCreated:u,showMessage:c=!1}=e,d=o.hooks.useTranslation(s.defaultMessages),p=F({widgetId:l,useDataSourceId:r.dataSourceId}),[g,f]=o.React.useState(null),[m,v]=o.React.useState(null),h=o.React.useCallback((e=>{if(e){const{status:t,instanceStatus:a}=e;a===o.DataSourceStatus.NotCreated?(f("creating"),null==i||i(!1)):a===o.DataSourceStatus.CreateError||t===o.DataSourceStatus.LoadError?(f("error"),null==i||i(!1)):t===o.DataSourceStatus.NotReady?(f("warning"),null==i||i(!1)):(f(null),null==i||i(!0))}}),[i]),y=o.React.useCallback((e=>{v(e),null==u||u(e)}),[u]),S=o.React.useCallback((()=>{v(null),f("error"),null==i||i(!1)}),[i]);let x,I,w;if("creating"===g)x=R(),I=d("loading");else if(p&&"error"!==g){if("warning"===g){let e="";const l=null===(t=null==m?void 0:m.getOriginDataSources())||void 0===t?void 0:t[0];l?e=l.getLabel()||l.getDataSourceJson().sourceLabel:m&&(e=m.getLabel()||m.getDataSourceJson().label);const s=o.appConfigUtils.getWidgetIdByOutputDataSource(r),i=null===(n=((null===(a=null===window||void 0===window?void 0:window.jimuConfig)||void 0===a?void 0:a.isBuilder)?(0,o.getAppStore)().getState().appStateInBuilder:(0,o.getAppStore)().getState()).appConfig.widgets[s])||void 0===n?void 0:n.label;w="var(--sys-color-warning-dark)",x=b(),I=d("outputDataIsNotGenerated",{outputDsLabel:null!=e?e:"",sourceWidgetName:null!=i?i:""})}}else x=R(),I=d("dataSourceCreateError"),w="var(--sys-color-error-main)";return(0,o.jsx)(o.React.Fragment,null,p&&(0,o.jsx)(o.DataSourceComponent,{useDataSource:r,onDataSourceInfoChange:h,onDataSourceCreated:y,onCreateDataSourceFailed:S}),"creating"===g&&(0,o.jsx)(z,{statusType:B.Loading,title:I}),(!p||"error"===g||"warning"===g)&&(0,o.jsx)("div",{className:"d-flex align-items-center"},(0,o.jsx)(s.Tooltip,{title:I},(0,o.jsx)(s.Button,{size:"sm",type:"tertiary",icon:!0},(0,o.jsx)(s.Icon,{icon:x,color:w}))),c&&(0,o.jsx)("div",{className:"status-message"},I)))}const q=o.css`
  font-weight: 500;
  font-size: 0.875rem;
`;function U(e){const{icon:t,name:a}=e;return(0,o.jsx)("div",{className:"d-flex align-items-center text-truncate",css:q},t&&(0,o.jsx)(s.Icon,{className:"query-task-icon mr-2",icon:t.svg}),(0,o.jsx)("div",{className:"text-truncate",title:a},a))}const V={icon:null,displayLabel:!0,sqlExprObj:null,useAttributeFilter:!0,useSpatialFilter:!0,spatialMapWidgetIds:[],spatialFilterTypes:[],spatialInteractiveCreateToolTypes:[e.Point,e.Polyline,e.Polygon,e.Rectangle,e.Circle],spatialInteractiveEnableBuffer:!1,spatialInteractiveBufferDistance:0,spatialInteractiveBufferUnit:i.Meters,spatialRelations:[l.Intersect],spatialRelationUseDataSources:[],spatialRelationEnableSelectTool:!1,spatialRelationEnableBuffer:!1,spatialRelationBufferDistance:0,spatialRelationBufferUnit:i.Meters,resultListDirection:p.Vertical,resultPagingStyle:g.MultiPage,resultFieldsType:f.PopupSetting,resultSymbolType:h.DefaultSymbol,resultCustomSymbol:{angle:0,color:[255,255,255,255],outline:{color:[255,255,255,255],style:"esriSLSSolid",type:"esriSLS",width:1},size:6,style:"esriSMSCircle",type:"esriSMS",xoffset:0,yoffset:0},resultAllowChangeSymbol:!1,allowExport:!1,sortOptions:[],itemSizeMap:{arrangementHorizontalPopper:{minSize:{width:300,height:300},defaultSize:{width:360,height:480}}}},{iconMap:G}=P(),$=o.css`
  height: 32px;
  .jimu-btn {
    min-width: 26px;
  }
`;function J(e){const{widgetId:t,queryItem:a,onStatusChange:n}=e,[l,r]=o.React.useState(!0),i=Object.assign({},V,a),{icon:u,name:c,useDataSource:d}=i;return(0,o.jsx)("div",{className:"d-flex align-items-center pl-2 pr-1 w-100",css:$},(0,o.jsx)(U,{icon:u,name:c}),(0,o.jsx)("div",{className:"ml-auto"},(0,o.jsx)(_,{widgetId:t,useDataSource:d,onStatusChange:e=>{r(e),n(e)}})),(0,o.jsx)(s.Button,{"aria-label":c,className:"ml-2",size:"sm",type:"tertiary",disabled:!l,icon:!0},(0,o.jsx)(s.Icon,{size:16,icon:G.arrowRight,autoFlip:!0})))}var W=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const H=e=>{const t=window.SVG,{className:a}=e,n=W(e,["className"]),l=(0,o.classNames)("jimu-icon jimu-icon-component",a);return t?o.React.createElement(t,Object.assign({className:l,src:D()},n)):o.React.createElement("svg",Object.assign({className:l},n))};var K=u(62686),Q=u(76117);const Y=o.React.createContext({resetSymbol:null});function Z(e){const{distance:t=0,unit:a=i.Meters,onBufferChange:n}=e,l=o.hooks.useTranslation(s.defaultMessages,y),[r,u]=o.React.useState(t),[c,d]=o.React.useState(a),p=o.React.useContext(Y),g=o.React.useRef(p.resetSymbol);o.React.useEffect((()=>{let e=!1;t!==r&&(u(t),e=!0),a!==c&&(d(a),e=!0),e&&n(t,a)}),[t,a]),o.React.useEffect((()=>{p.resetSymbol&&p.resetSymbol!==g.current&&(g.current=p.resetSymbol,u(t),d(a),n(t,a))}),[p.resetSymbol,t,a,n]);const f=o.React.useCallback((e=>{u(e)}),[]),m=o.React.useCallback((e=>{u(e),n(e,c)}),[n,c]),v=o.React.useCallback((e=>{d(e.target.value),n(r,e.target.value)}),[n,r]);return(0,o.jsx)(o.React.Fragment,null,(0,o.jsx)(s.NumericInput,{"aria-label":l("theBufferDistance"),className:"mr-1",value:r,onChange:f,onAcceptValue:m}),(0,o.jsx)(s.Select,{"aria-label":l("unit"),value:c,onChange:v},Object.values(i).map((e=>(0,o.jsx)("option",{key:e,value:e},l(`unit_${e}`))))))}const X=o.css`margin-top: 0.75rem;`;function ee(e){var t;const{onSelectionChange:a,useDataSources:n=[],useRuntimeData:r,spatialRelations:i,enableBuffer:u,bufferDistance:c,bufferUnit:d,onBufferChange:p,onRelationChange:g}=e,f=o.hooks.useTranslation(s.defaultMessages,y),[m,v]=o.React.useState(n[0]),[h,S]=o.React.useState(),[b,x]=o.React.useState(0),[R,I]=o.React.useState(null==i?void 0:i[0]),w=o.React.useContext(Y),C=o.React.useRef(w.resetSymbol),j=o.hooks.useTranslation(),M=o.React.useMemo((()=>Object.entries(l).map((([e,t])=>({value:t,label:f(`spatialRelation_${e}`)})))),[f]),D=o.ReactRedux.useSelector((e=>{const t=[];return n.forEach((a=>{var n,l;(null===(l=null===(n=e.dataSourcesInfo)||void 0===n?void 0:n[a.mainDataSourceId])||void 0===l?void 0:l.instanceStatus)===o.DataSourceStatus.Created&&t.push(a.dataSourceId)})),t.length>0?t.join(","):""})),N=o.ReactRedux.useSelector((e=>{var t;return r?Object.keys(null!==(t=e.dataSourcesInfo)&&void 0!==t?t:{}).filter((t=>e.dataSourcesInfo[t].instanceStatus===o.DataSourceStatus.Created)).length:0})),O=o.React.useMemo((()=>{if(N>0)return function(){const e={};let t=!1;const a=o.DataSourceManager.getInstance().getDataSources();return Object.keys(a).forEach((n=>{const l=a[n];null==l.getGeometryType()||l.isInAppConfig()||l.getMainDataSource().id!==n||l.getDataSourceJson().isOutputFromWidget||(e[n]=l,t=!0)})),t?e:null}()}),[N]),P=Object.keys(null!=O?O:{}).length;o.hooks.useEffectOnce((()=>{(null==i?void 0:i.length)>0&&g(i[0]),u&&p(c,d)})),o.React.useEffect((()=>{w.resetSymbol&&w.resetSymbol!==C.current&&(C.current=w.resetSymbol,I(null==i?void 0:i[0]),g(null==i?void 0:i[0]))}),[w.resetSymbol,g,i]),o.React.useEffect((()=>{i?i.includes(R)||(I(i[0]),g(i[0])):I(null)}),[i,R,g]);const E=o.React.useCallback((e=>{const t=n.find((t=>t.dataSourceId===e));v((0,o.Immutable)(t)),S(null)}),[n]),T=o.React.useCallback((e=>{const t=o.DataSourceManager.getInstance().getDataSource(e);S(t),v(null)}),[]),k=o.React.useCallback((()=>{var e;const t=o.DataSourceManager.getInstance().getDataSource(null!==(e=null==m?void 0:m.dataSourceId)&&void 0!==e?e:null==h?void 0:h.id),n=null==t?void 0:t.getSelectedRecords();if((null==n?void 0:n.length)>0){const e=n.map((e=>e.getJSAPIGeometry()));a(e),x(n.length)}else a(null),x(0)}),[null==m?void 0:m.dataSourceId,null==h?void 0:h.id,a]),L=o.React.useCallback((e=>{I(e.target.value),g(e.target.value)}),[g]);return(0,o.jsx)("div",null,(0,o.jsx)("div",{css:X},f("chooseFilterLayer")),(0,o.jsx)(s.Select,{"aria-label":f("chooseFilterLayer"),value:null!==(t=null==m?void 0:m.dataSourceId)&&void 0!==t?t:null==h?void 0:h.id},P>0&&n.length>0&&(0,o.jsx)(s.Option,{header:!0},f("preconfigured")),n.map((e=>{const t=o.DataSourceManager.getInstance().getDataSource(e.dataSourceId);return D.includes(e.dataSourceId)||(null==t?void 0:t.getLabel())?(0,o.jsx)(s.Option,{key:e.dataSourceId,value:e.dataSourceId,onClick:()=>{E(e.dataSourceId)}},null==t?void 0:t.getLabel()):(0,o.jsx)(s.Option,{key:e.dataSourceId},j("loading"))})),P>0&&n.length>0&&(0,o.jsx)(s.Option,{divider:!0}),P>0&&(0,o.jsx)(s.Option,{header:!0},f("runtime")),Object.keys(null!=O?O:{}).map((e=>{const t=O[e];return(0,o.jsx)(s.Option,{key:e,value:e,onClick:()=>{T(e)}},t.getLabel())}))),(0,o.jsx)("div",{className:"mt-1 font-italic",css:o.css`color: var(--ref-palette-neutral-1100);`},f("selectedRecords",{num:b})),(null==i?void 0:i.length)>0&&(0,o.jsx)("div",{css:X},(0,o.jsx)("div",{className:"text-truncate mb-0"},f("relationship")),(0,o.jsx)(s.Select,{"aria-label":f("relationship"),value:R,onChange:L},i.map((e=>{return(0,o.jsx)("option",{key:e,value:e},(t=e,M.find((e=>e.value===t)).label));var t})))),u&&(0,o.jsx)("div",{role:"group","aria-label":f("theBufferDistance"),css:X},(0,o.jsx)("div",{className:"text-truncate"},f("theBufferDistance")),(0,o.jsx)("div",{className:"d-flex mt-1"},(0,o.jsx)(Z,{distance:c,unit:d,onBufferChange:p}))),(0,o.jsx)(o.DataSourceComponent,{useDataSource:m,dataSource:h,onDataSourceInfoChange:k}),n.map((e=>(0,o.jsx)(o.DataSourceComponent,{key:e.dataSourceId,useDataSource:e}))))}function te(e){const{onGeometryChange:t,mapWidgetIds:a}=e,[n,l]=o.React.useState(null),s=o.React.useRef(null);o.React.useEffect((()=>{if(null==n?void 0:n.view){const e=n.view.watch("extent",(e=>{s.current?t(s.current.fromExtent(e)):(0,K.loadArcGISJSAPIModules)(["esri/geometry/Polygon"]).then((a=>{s.current=a[0],t(s.current.fromExtent(e))}))}));return t(n.view.extent),()=>{e.remove()}}}),[n,t]);const r=o.React.useCallback((e=>{l(null!=(null==e?void 0:e.view)?e:null)}),[]);return(0,o.jsx)(o.React.Fragment,null,null==a?void 0:a.map(((e,t)=>(0,o.jsx)(K.JimuMapViewComponent,{key:t,useMapWidgetId:e,onActiveViewChange:r}))))}const ae={[e.Point]:{drawToolName:"point",esriClassName:"esri-icon-point",toolIndex:0},[e.Polyline]:{drawToolName:"polyline",esriClassName:"esri-icon-polyline",toolIndex:4},[e.Polygon]:{drawToolName:"polygon",esriClassName:"esri-icon-polygon",toolIndex:2},[e.Rectangle]:{drawToolName:"rectangle",esriClassName:"esri-icon-checkbox-unchecked",toolIndex:1},[e.Circle]:{drawToolName:"circle",esriClassName:"esri-icon-radio-unchecked",toolIndex:3}};function ne(e){const{toolTypes:t=[],jimuMapView:a,onDrawEnd:n,widgetId:l}=e,r=o.hooks.useTranslation(y),[i,u]=o.React.useState(null),c=o.React.useRef(null),d=o.React.useRef(null),[p,g]=o.React.useState(!1),f=o.React.useMemo((()=>({createTools:Object.entries(ae).reduce(((e,[a,n])=>Object.assign(Object.assign({},e),{[n.drawToolName]:t.includes(a)})),{point:!1}),selectionTools:{"lasso-selection":!1,"rectangle-selection":!1},settingsMenu:!1,undoRedoMenu:!1,deleteButton:!0})),[t]);o.hooks.useEffectOnce((()=>{o.moduleLoader.loadModule("jimu-ui/advanced/map").then((e=>{u(e)}))}));const m=o.React.useCallback((e=>{c.current=e.getGraphicsLayer}),[]),v=o.React.useCallback((()=>{c.current&&c.current().removeAll()}),[]),h=o.React.useCallback((e=>{d.current=e,n(e,c.current,p)}),[n,p]),S=o.React.useCallback((()=>{d.current=null,n(null)}),[n]),b=o.React.useCallback((e=>{d.current&&n(d.current,c.current,e.target.checked),g(e.target.checked)}),[n]),x=null==i?void 0:i.JimuDraw;if(!x)return(0,o.jsx)(z,{statusType:B.Loading});return Object.keys(f.createTools).some((e=>f.createTools[e]))?(0,o.jsx)("div",null,(0,o.jsx)(x,{jimuMapView:a,operatorWidgetId:l,disableSymbolSelector:!0,drawingOptions:{creationMode:i.JimuDrawCreationMode.Single,updateOnGraphicClick:!1,visibleElements:f},uiOptions:{isHideBorder:!0},onJimuDrawCreated:m,onDrawingStarted:v,onDrawingFinished:h,onDrawingCleared:S}),(0,o.jsx)("label",{className:"d-flex align-items-center"},(0,o.jsx)(s.Checkbox,{checked:p,onChange:b,className:"mr-2"}),r("clearDrawing"))):null}var le=function(e,t,a,n){return new(a||(a=Promise))((function(l,o){function s(e){try{i(n.next(e))}catch(e){o(e)}}function r(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}i((n=n.apply(e,t||[])).next())}))};function oe(e){const{onGeometryChange:t,createToolTypes:a,mapWidgetIds:n,enableBuffer:l,bufferDistance:r,bufferUnit:i,onBufferChange:u,widgetId:c}=e,[d,p]=o.React.useState(null),g=o.hooks.useTranslation(s.defaultMessages,y),f=o.React.useContext(Y),m=o.React.useRef(f.resetSymbol),v=o.React.useRef(null),h=o.React.useRef(null),S=o.React.useRef(null),b=o.React.useRef(null),x=o.React.useRef(null),R=o.React.useRef(r),I=o.React.useRef(i),w=o.React.useRef(null);o.hooks.useEffectOnce((()=>{l&&o.lodash.defer((()=>{u(r,i)})),(0,K.loadArcGISJSAPIModules)(["esri/Graphic"]).then((e=>{const t=e[0];w.current=new t({symbol:{type:"simple-fill",color:[51,51,204,.5],style:"solid",outline:{color:[51,51,204,.8],width:1}}})}))}));const C=o.React.useCallback((()=>le(this,void 0,void 0,(function*(){var e,t,a,n,s,r;if(!x.current||!l||0===R.current)return void(w.current.geometry=null);const i=("point"===(null===(e=x.current)||void 0===e?void 0:e.type)||"multipoint"===(null===(t=x.current)||void 0===t?void 0:t.type))&&R.current<0,u="polyline"===(null===(a=x.current)||void 0===a?void 0:a.type)&&R.current<0;if(i||u)return void(w.current.geometry=null);const c=x.current;if((null===(n=c.spatialReference)||void 0===n?void 0:n.isGeographic)&&!c.spatialReference.isWGS84){const e=o.utils.getGeometryService();if(!b.current){const e=yield(0,K.loadArcGISJSAPIModules)(["esri/rest/geometryService","esri/rest/support/BufferParameters"]);b.current={geometryService:e[0],bufferParameters:e[1]}}const{geometryService:t,bufferParameters:a}=b.current,n=yield t.buffer(e,new a({distances:[R.current],unit:o.lodash.kebabCase(I.current),geodesic:!0,bufferSpatialReference:c.spatialReference,outSpatialReference:c.spatialReference,geometries:[c]}));w.current.geometry=n[0]}else(null===(s=c.spatialReference)||void 0===s?void 0:s.isWGS84)||(null===(r=c.spatialReference)||void 0===r?void 0:r.isWebMercator)?(S.current||(S.current=yield(0,o.loadArcGISJSAPIModule)("esri/geometry/operators/geodesicBufferOperator")),S.current.isLoaded()||(yield S.current.load()),w.current.geometry=S.current.execute(c,R.current,{unit:o.lodash.kebabCase(I.current)})):(h.current||(h.current=yield(0,o.loadArcGISJSAPIModule)("esri/geometry/operators/bufferOperator")),w.current.geometry=h.current.execute(c,R.current,{unit:o.lodash.kebabCase(I.current)}))}))),[l]);o.React.useEffect((()=>{f.resetSymbol&&f.resetSymbol!==m.current&&(m.current=f.resetSymbol,v.current&&v.current().removeAll(),t(null))}),[f.resetSymbol,t]);const j=o.React.useCallback((e=>{const a=v.current&&v.current();a&&(a.removeAll(),t(null)),p(null!=(null==e?void 0:e.view)?e:null)}),[t]),M=o.React.useCallback(((e,t)=>{R.current=e,I.current=t,C(),u(e,t)}),[u,C]),D=o.React.useCallback(((e,a,n)=>{v.current=a;const l=v.current&&v.current();x.current!==(null==e?void 0:e.geometry)&&(x.current=null==e?void 0:e.geometry,C().then((()=>{w.current.geometry&&(null==l||l.add(w.current))}))),t(null==e?void 0:e.geometry,l,e,n)}),[t,C]);return(0,o.jsx)(o.React.Fragment,null,null==n?void 0:n.map(((e,t)=>(0,o.jsx)(K.JimuMapViewComponent,{key:t,useMapWidgetId:e,onActiveViewChange:j}))),(null==d?void 0:d.view)&&(0,o.jsx)(o.React.Fragment,null,(0,o.jsx)(ne,{jimuMapView:d,widgetId:c,toolTypes:a,onDrawEnd:D}),l&&(0,o.jsx)("div",{role:"group","aria-label":g("theBufferDistance"),css:o.css`margin-top: 0.75rem;`},(0,o.jsx)("div",{className:"text-truncate"},g("theBufferDistance")),(0,o.jsx)("div",{className:"d-flex mt-1"},(0,o.jsx)(Z,{distance:r,unit:i,onBufferChange:M})))))}var se=u(45508),re=u.n(se),ie=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const ue=e=>{const t=window.SVG,{className:a}=e,n=ie(e,["className"]),l=(0,o.classNames)("jimu-icon jimu-icon-component",a);return t?o.React.createElement(t,Object.assign({className:l,src:re()},n)):o.React.createElement("svg",Object.assign({className:l},n))};function ce(e){var t;const{label:a,desc:l,filterTypes:r,mapWidgetIds:u,onFilterChange:c,onRelationChange:d,onBufferChange:p,useDataSources:g,spatialRelations:f,useRuntimeData:m,dsEnableBuffer:v,dsBufferDistance:h,dsBufferUnit:S,drawEnableBuffer:b,drawBufferDistance:x,drawBufferUnit:R,createToolTypes:I,widgetId:w}=e,C=o.hooks.useTranslation(y),j=o.React.useRef(null),M=o.ReactRedux.useSelector((e=>{if((null==u?void 0:u.length)>0){const t=u[0];return null!=e.appConfig.widgets[t]}return!1})),D=o.React.useMemo((()=>M&&((null==r?void 0:r.includes(n.CurrentMapExtent))||(null==r?void 0:r.includes(n.InteractiveDrawMode)))),[r,M]),N=o.React.useMemo((()=>{const e=[];return((null==g?void 0:g.length)>0||m)&&e.push({value:"data",label:C("featureFromDs")}),D&&(null==r?void 0:r.includes(n.CurrentMapExtent))&&e.push({value:"map",label:C(`spatialFilterType_${n.CurrentMapExtent}`)}),D&&(null==r?void 0:r.includes(n.InteractiveDrawMode))&&e.push({value:"draw",label:C(`spatialFilterType_${n.InteractiveDrawMode}`)}),e}),[D,g,m,C,r]),[O,P]=o.React.useState(null===(t=null==N?void 0:N[0])||void 0===t?void 0:t.value);o.React.useEffect((()=>{var e;"none"===O||N.find((e=>e.value===O))||P(null===(e=null==N?void 0:N[0])||void 0===e?void 0:e.value)}),[O,N]),o.React.useEffect((()=>{"map"!==O&&"draw"!==O&&"none"!==O||(d(null),p(0,i.Meters),c({geometry:null})),"data"===O&&null==j.current&&c({geometry:null})}),[O,d,p,c]);const E=o.React.useCallback((e=>{P(e.target.value)}),[]),T=o.React.useCallback(((e,t,a,n)=>{c({geometry:e,graphic:a,layer:t,clearAfterApply:n})}),[c]),k=o.React.useCallback((e=>{j.current=e,c({geometry:e})}),[c]);return(null==g?void 0:g.length)>0||m||D?(0,o.jsx)("div",{role:"group",className:"px-4","aria-label":a},(0,o.jsx)("div",{className:(0,o.classNames)("form-title my-2 d-flex align-items-center",{"d-none":!a&&!l})},a&&(0,o.jsx)("div",{className:"mr-2"},a),l&&(0,o.jsx)(s.Tooltip,{placement:"bottom",css:o.css`white-space: pre-line;`,title:l},(0,o.jsx)(s.Button,{size:"sm",icon:!0,type:"tertiary"},(0,o.jsx)(ue,{color:"var(--sys-color-primary-main)",size:"s"})))),N.length>0&&(0,o.jsx)("div",null,(0,o.jsx)("div",null,C("chooseFilterType")),(0,o.jsx)(s.Select,{"aria-label":C("chooseFilterType"),css:o.css`height: 32px;`,value:O,onChange:E},(0,o.jsx)("option",{key:"-",value:"none"},"-"),N.map((e=>(0,o.jsx)("option",{key:e.value,value:e.value},e.label))))),"data"===O&&(0,o.jsx)(ee,{enableBuffer:v,bufferDistance:h,bufferUnit:S,spatialRelations:f,useDataSources:g,useRuntimeData:m,onSelectionChange:k,onRelationChange:d,onBufferChange:p}),"map"===O&&(0,o.jsx)(te,{mapWidgetIds:u,createToolTypes:I,onGeometryChange:T}),"draw"===O&&(0,o.jsx)(oe,{enableBuffer:b,bufferDistance:x,bufferUnit:R,mapWidgetIds:u,widgetId:w,createToolTypes:I,onGeometryChange:T,onBufferChange:p})):null}var de=u(41496);const pe=o.React.createContext(null);function ge(){const e=o.React.useContext(pe);let t,a;if(e.includes(":")){const n=e.split(":");t=n[0],a=n[1]}return o.ReactRedux.useSelector((e=>{var n,l,o,s;const r=null===(l=null===(n=e.appConfig.layouts[t])||void 0===n?void 0:n.content)||void 0===l?void 0:l[a];return(null===(s=null===(o=null==r?void 0:r.setting)||void 0===o?void 0:o.autoProps)||void 0===s?void 0:s.height)===de.LayoutItemSizeModes.Auto}))}const fe=e=>o.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .form-title {
      color: var(--ref-palette-neutral-1100);
      font-weight: 500;
      font-size: 0.8125rem;
      line-height: 1.5;
    }
    .query-form__content {
      flex: 1 1 ${e?"auto":0};
      max-height: ${e?"61.8vh":"none"};
      overflow: auto;
    }
  `;function me(e){const{widgetId:t,configId:a,outputDS:n,spatialFilterEnabled:r,datasourceReady:i,onFormSubmit:u,dataActionFilter:c}=e,d=o.hooks.usePrevious(c),p=o.ReactRedux.useSelector((e=>e.appConfig.widgets[t].config.queryItems.find((e=>e.configId===a)))),g=Object.assign({},V,p),f=o.hooks.useTranslation(y),[m,v]=o.React.useState(null),{useAttributeFilter:h,useSpatialFilter:S,spatialFilterTypes:b,sqlExprObj:x,spatialMapWidgetIds:R,spatialInteractiveCreateToolTypes:I,spatialRelationUseDataSources:w,spatialIncludeRuntimeData:C,spatialRelations:j,spatialRelationEnableBuffer:M,spatialRelationBufferDistance:D,spatialRelationBufferUnit:N,spatialInteractiveEnableBuffer:O,spatialInteractiveBufferDistance:P,spatialInteractiveBufferUnit:E,attributeFilterLabel:T=f("attributeFilter"),spatialFilterLabel:k=f("spatialFilter"),attributeFilterDesc:L,spatialFilterDesc:A}=g,[B,z]=o.React.useState(x),F=o.React.useRef(null),_=o.React.useRef(l.Intersect),q=o.React.useRef(null),U=ge(),G=o.React.useRef((0,Q.getShownClauseNumberByExpression)(x)),$=null==n?void 0:n.getOriginDataSources()[0];o.React.useEffect((()=>{x?(G.current=(0,Q.getShownClauseNumberByExpression)(x),z(x)):(G.current=0,z(null))}),[x]);const J=o.React.useCallback((()=>{var e,t,a;if(null===(e=null==n?void 0:n.selectRecordsByIds)||void 0===e||e.call(n,[]),n){const e=n.getOriginDataSources()[0];if(e){const t=e.getDataViewConfig(),a=null==t?void 0:t.maximum;null!=a&&a>0&&o.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(n,n.getDataSourceJson().setIn(["query","maximum"],a))}}let s=_.current;(null===(t=F.current)||void 0===t?void 0:t.geometry)&&null==s&&(s=l.Intersect),Array.isArray(null===(a=F.current)||void 0===a?void 0:a.geometry)?1===F.current.geometry.length?u(B,Object.assign(Object.assign({},F.current),{geometry:F.current.geometry[0],relation:s,buffer:q.current})):(0,K.loadArcGISJSAPIModules)(["esri/geometry/operators/unionOperator"]).then((e=>{const t=e[0].executeMany(F.current.geometry);u(B,Object.assign(Object.assign({},F.current),{geometry:t,relation:s,buffer:q.current}))})):u(B,Object.assign(Object.assign({},F.current),{relation:s,buffer:q.current}))}),[u,n,B]);o.React.useEffect((()=>{c&&c.where!==(null==d?void 0:d.where)&&J()}),[c,null==d?void 0:d.where,J]);const W=o.React.useCallback((()=>{G.current=(0,Q.getShownClauseNumberByExpression)(x),z(x),v(Symbol())}),[x]),H=o.React.useCallback((e=>{G.current=(0,Q.getShownClauseNumberByExpression)(e),z(e)}),[]),Z=o.React.useCallback((e=>{F.current=e}),[]),X=o.React.useCallback((e=>{_.current=e}),[]),ee=o.React.useCallback(((e,t)=>{q.current={distance:e,unit:t}}),[]),te=h&&null!=x,ae=r&&S&&(b.length>0||C||(null==w?void 0:w.length)>0);return(0,o.jsx)(Y.Provider,{value:{resetSymbol:m}},(0,o.jsx)("div",{className:"query-form",css:fe(U)},(0,o.jsx)("div",{className:"query-form__content"},te&&(0,o.jsx)("div",{role:"group",className:"px-4","aria-label":T},(0,o.jsx)("div",{className:(0,o.classNames)("form-title my-2 d-flex align-items-center",{"d-none":!T&&!L})},T&&(0,o.jsx)("div",{className:"mr-2"},T),L&&(0,o.jsx)(s.Tooltip,{placement:"bottom",css:o.css`white-space: pre-line;`,title:L},(0,o.jsx)(s.Button,{size:"sm",icon:!0,type:"tertiary"},(0,o.jsx)(ue,{color:"var(--sys-color-primary-main)",size:"s"})))),$&&(0,o.jsx)(Q.SqlExpressionRuntime,{widgetId:t,dataSource:$,expression:B,onChange:H})),te&&ae&&(0,o.jsx)("hr",{className:"m-4",css:o.css`border: none; height: 1px; background-color: var(--ref-palette-neutral-400);`}),ae&&(0,o.jsx)(ce,{widgetId:t,label:k,desc:A,filterTypes:b,mapWidgetIds:R,createToolTypes:I,onFilterChange:Z,onRelationChange:X,onBufferChange:ee,spatialRelations:j,dsEnableBuffer:M,dsBufferDistance:D,dsBufferUnit:N,drawEnableBuffer:O,drawBufferDistance:P,drawBufferUnit:E,useDataSources:w,useRuntimeData:C})),(0,o.jsx)("div",{className:"query-form__actions px-4 d-flex align-items-center"},(0,o.jsx)(s.Button,{color:"primary",className:"ml-auto",disabled:!i,onClick:J},f("apply")),(G.current>0||ae)&&(0,o.jsx)(s.Button,{className:"ml-2",onClick:W},f("reset")))))}var ve=u(23001),he=u.n(ve),ye=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const Se=e=>{const t=window.SVG,{className:a}=e,n=ye(e,["className"]),l=(0,o.classNames)("jimu-icon jimu-icon-component",a);return t?o.React.createElement(t,Object.assign({className:l,src:he()},n)):o.React.createElement("svg",Object.assign({className:l},n))};var be=u(35737),xe=u.n(be),Re=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const Ie=e=>{const t=window.SVG,{className:a}=e,n=Re(e,["className"]),l=(0,o.classNames)("jimu-icon jimu-icon-component",a);return t?o.React.createElement(t,Object.assign({className:l,src:xe()},n)):o.React.createElement("svg",Object.assign({className:l},n))};var we;!function(e){e.Pending="Pending",e.Fulfilled="Fulfilled",e.Rejected="Rejected"}(we||(we={}));const Ce=o.css`
  border: 1px solid var(--ref-palette-neutral-300);
  .esri-widget__heading {
    font-size: 0.875rem;
    font-weight: 500;
    margin: 0;
    color: var(--ref-palette-black);
  }

  .esri-feature__content-element {
    padding: 0;
  }

  .jimu-btn.expanded {
    align-self: flex-start;
  }

  .esri-feature.esri-widget {
    background-color: transparent;
  }
`;class je extends o.React.PureComponent{constructor(e){super(e),this.toggleExpanded=e=>{e.stopPropagation(),this.setState({showContent:!this.state.showContent})};const{togglable:t=!1,expandByDefault:a}=this.props;this.featureContainer=o.React.createRef(),this.state={showContent:!t||a,loadStatus:we.Pending}}componentDidMount(){this.createFeature()}componentDidUpdate(e){this.feature&&(e.popupTemplate!==this.props.popupTemplate||e.defaultPopupTemplate!==this.props.defaultPopupTemplate||e.graphic!==this.props.graphic?(this.destroyFeature(),this.createFeature()):this.feature.visibleElements=this.getVisibleElements())}destroyFeature(){this.feature&&!this.feature.destroyed&&this.feature.destroy()}getVisibleElements(){const{togglable:e=!1}=this.props,{showContent:t}=this.state,a=!e||t;return{title:!0,content:{fields:a,text:a,media:a,attachments:a},lastEditedInfo:!1}}createFeature(){let e;return e=this.Feature?Promise.resolve():(0,K.loadArcGISJSAPIModules)(["esri/widgets/Feature"]).then((e=>{[this.Feature]=e})),e.then((()=>{var e,t,a,n;const l=document&&document.createElement("div");l.className="jimu-widget",this.featureContainer.current.appendChild(l);const o=this.props.dataSource.getOriginDataSources(),s=null===(e=null==o?void 0:o[0])||void 0===e?void 0:e.getRootDataSource();this.destroyFeature();const r=this.props.graphic.layer;this.props.popupTemplate?this.props.graphic.popupTemplate=this.props.popupTemplate:this.props.graphic.popupTemplate=r&&null!==(t=r.popupTemplate)&&void 0!==t?t:this.props.defaultPopupTemplate,r&&!r.popupTemplate&&(r.popupTemplate=this.props.popupTemplate||this.props.defaultPopupTemplate),this.feature=new this.Feature({container:l,defaultPopupTemplateEnabled:!0,spatialReference:(null===(n=null===(a=this.props.dataSource)||void 0===a?void 0:a.layer)||void 0===n?void 0:n.spatialReference)||null,map:(null==s?void 0:s.map)||null,graphic:this.props.graphic,visibleElements:this.getVisibleElements()})})).then((()=>{this.setState({loadStatus:we.Fulfilled})}))}render(){const{togglable:e=!1,intl:t}=this.props,{showContent:a}=this.state;return(0,o.jsx)("div",{className:"feature-info-component d-flex align-items-center p-2",css:Ce},e&&(0,o.jsx)(s.Button,{"aria-label":t.formatMessage({id:a?"collapse":"expand"}),className:(0,o.classNames)("p-0 jimu-outline-inside",{expanded:a}),type:"tertiary",icon:!0,size:"sm",onClick:this.toggleExpanded},a?(0,o.jsx)(Ie,{size:"s"}):(0,o.jsx)(Se,{size:"s",autoFlip:!0})),(0,o.jsx)("div",{className:"flex-grow-1",ref:this.featureContainer}))}}const Me=(0,o.injectIntl)(je),De=o.css`
  overflow: auto;
  flex-flow: row;
  cursor: pointer;
  flex-shrink: 0;
  min-height: 2rem;
  &.selected {
    outline: 2px solid var(--sys-color-primary-main);
  }
`,Ne=e=>{const{widgetId:t,data:a,dataSource:n,popupTemplate:l,defaultPopupTemplate:s,onClick:r,expandByDefault:i=!1}=e,u=o.ReactRedux.useSelector((e=>{var t,l,o;return null===(o=null===(l=null===(t=e.dataSourcesInfo)||void 0===t?void 0:t[n.id])||void 0===l?void 0:l.selectedIds)||void 0===o?void 0:o.includes(a.getId())})),c=o.ReactRedux.useSelector((e=>e.appConfig.widgets[t].config.resultListDirection!==p.Horizontal)),d=o.React.useCallback((()=>{r(a)}),[r,a]),g=o.React.useCallback((e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),d())}),[d]);return(0,o.jsx)("div",{className:(0,o.classNames)("query-result-item",{selected:u}),onClick:d,onKeyUp:g,css:De,role:"option","aria-selected":u,tabIndex:0},(0,o.jsx)(Me,{graphic:a.feature,popupTemplate:l,defaultPopupTemplate:s,togglable:c,expandByDefault:i,dataSource:n}))};var Oe=function(e,t,a,n){return new(a||(a=Promise))((function(l,o){function s(e){try{i(n.next(e))}catch(e){o(e)}}function r(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}i((n=n.apply(e,t||[])).next())}))};function Pe(e,t,a){const n=new Set;if(null==e||e.forEach((e=>n.add(e))),t){const e=t.match(/\{\w*\}/g);(null==e?void 0:e.length)>0&&e.forEach((e=>n.add(e.substring(1,e.length-1))))}return a&&n.add(a),Array.from(n)}function Ee(e,t){return Oe(this,void 0,void 0,(function*(){var a;const{resultFieldsType:n,resultDisplayFields:l,resultTitleExpression:o=""}=t,s=e.getOriginDataSources()[0],r=s.getPopupInfo();if(n===f.SelectAttributes){let t;if(null==l){const a=function(e){var t;const a=[];return(null===(t=e.popupElements)||void 0===t?void 0:t.length)>0&&e.popupElements.forEach((e=>{var t;"fields"===e.type&&(null===(t=e.fieldInfos)||void 0===t?void 0:t.length)>0&&a.push(...e.fieldInfos)})),a}(r);if(a.length>0){const e=new Set(a.map((e=>e.fieldName)));t=Array.from(e)}else{const a=e.getSchema();t=(null==a?void 0:a.fields)?Object.values(a.fields).map((e=>e.jimuName)):[]}}else t=l.asMutable({deep:!0});if(r){const e=[];return t.forEach((t=>{const a=r.fieldInfos.find((e=>e.fieldName===t));a?(a.visible=!0,e.push(a)):e.push({fieldName:t,label:t})})),{popupTemplate:{fieldInfos:e,content:[{type:"fields"}],title:o}}}return{popupTemplate:{fieldInfos:t.map((e=>({fieldName:e,label:e}))),content:[{type:"fields"}],title:o}}}let i;return i=s.layer?s.layer:yield s.createJSAPILayerByDataSource(),i&&(yield i.load()),{defaultPopupTemplate:(null===(a=null==i?void 0:i.associatedLayer)||void 0===a?void 0:a.defaultPopupTemplate)||(null==i?void 0:i.defaultPopupTemplate)}}))}function Te(e,t,a,n){return Oe(this,void 0,void 0,(function*(){const t=a.getPopupInfo(),l=a.getLayerDefinition(),s=(e=>{return e.length?e:[{fieldName:null!==(t=null==l?void 0:l.objectIdField)&&void 0!==t?t:"objectid",label:"OBJECTID",tooltip:"",visible:!0}];var t})(((null==t?void 0:t.fieldInfos)||[]).filter((e=>e.visible)));let r=yield a.load(n,{widgetId:e});null==r&&(r=[]);const i=a.getOriginDataSources()[0],u=yield function(e){return Oe(this,void 0,void 0,(function*(){const t=yield e.createJSAPILayerByDataSource();return t&&(yield t.load()),t}))}(i);r.forEach((e=>{const t=e.feature;u&&(t.sourceLayer=u.associatedLayer||u),t.layer=t.sourceLayer}));const c={records:r,fields:s.map((e=>e.fieldName))},d=new o.DataRecordSetChangeMessage(e,o.RecordSetChangeType.CreateUpdate,[{records:a.getAllLoadedRecords(),fields:c.fields,dataSource:a,name:a.id,label:a.getLabel()}]);return o.MessageManager.getInstance().publishMessage(d),c}))}var ke=function(e,t,a,n){return new(a||(a=Promise))((function(l,o){function s(e){try{i(n.next(e))}catch(e){o(e)}}function r(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}i((n=n.apply(e,t||[])).next())}))};const{useRef:Le,useState:Ae}=o.React,Be=e=>o.css`
    display: flex;
    flex: 1 1 ${e?"auto":0};
    overflow: auto;
    max-height: ${e?"calc(61.8vh - 100px)":"none"};

    .query-result-item + .query-result-item {
      margin-left: 0.5rem;
      margin-top: 0;
    }

    &.vertical {
      flex-direction: column;
      .list-items {
        position: relative;
        flex-direction: column;
      }

      .feature-info-component {
        width: 100%;
      }

      .query-result-item + .query-result-item {
        margin-left: 0;
        margin-top: 0.5rem;
      }
    }
    .list-items {
      display: flex;
    }
    .lazyload-detector {
      height: 2px;
      width: 2px;
      opacity: 0;
    }
  `;function ze(e){const{widgetId:t,outputDS:a,queryParams:n,resultCount:l,records:r,queryItem:i,direction:u,onRenderDone:c,onEscape:d,onSelectChange:g,defaultPageSize:f=o.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE}=e,[m,v]=Ae(r),[h,y]=Ae(),[S,b]=Ae(),[x,R]=Ae(B.Init),I=o.hooks.useLatest(m),w=o.hooks.useLatest(l),C=o.hooks.useLatest(x),j=o.hooks.useLatest((null==m?void 0:m.length)===l),M=Le(0),D=Le(),N=Le(null),O=ge();o.React.useEffect((()=>{M.current=1,D.current.scrollTop=0,v(r)}),[r]);const P=()=>ke(this,void 0,void 0,(function*(){if(j.current||C.current===B.Loading)return;M.current=M.current+1,R(B.Loading),n.pageSize||(n.pageSize=f);const{records:e}=yield Te(t,0,a,Object.assign(Object.assign({},n),{page:M.current}));w.current>0&&I.current.length+e.length>=w.current&&(j.current=!0);const l=I.current.concat(e);v(l),null==c||c({dataItems:a.getAllLoadedRecords()}),R(B.Loaded)}));o.React.useEffect((()=>{Ee(a,i).then((e=>{y(e.popupTemplate),b(e.defaultPopupTemplate)}))}),[a,i]),o.hooks.useEffectOnce((()=>{const e=null==N?void 0:N.current;if(e){const t=new IntersectionObserver((e=>{e[0].isIntersecting&&P()}));return null==t||t.observe(e),()=>{null==t||t.disconnect()}}}));const E=o.React.useCallback((e=>{"Escape"===e.key&&(e.stopPropagation(),d())}),[d]),T=o.React.useCallback((e=>{" "===e.key&&e.preventDefault()}),[]);return(0,o.jsx)("div",{onKeyUp:E,onKeyDown:T,className:(0,o.classNames)({vertical:u===p.Vertical}),css:Be(O),ref:D},(0,o.jsx)("div",{className:"list-items px-4 py-1",role:"listbox"},null==m?void 0:m.map((e=>(0,o.jsx)(Ne,{key:e.getId(),data:e,dataSource:a,widgetId:t,popupTemplate:h,defaultPopupTemplate:S,expandByDefault:i.resultExpandByDefault,onClick:g})))),(0,o.jsx)("div",{ref:N,className:"lazyload-detector"},"\xa0"),x===B.Loading&&(0,o.jsx)(s.Loading,{type:s.LoadingType.Donut}))}var Fe=function(e,t,a,n){return new(a||(a=Promise))((function(l,o){function s(e){try{i(n.next(e))}catch(e){o(e)}}function r(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}i((n=n.apply(e,t||[])).next())}))};const{useRef:_e,useState:qe}=o.React,Ue=e=>o.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .list_items {
      flex: 1 1 ${e?"auto":0};
      max-height: ${e?"calc(61.8vh - 100px)":"none"};
      overflow: auto;
      display: flex;
      flex-direction: row;
    }

    .query-result-item + .query-result-item {
      margin-left: 0.5rem;
      margin-top: 0;
    }

    &.vertical {
      .list_items {
        flex-direction: column;
      }
      .feature-info-component {
        width: 100%;
      }
      .query-result-item + .query-result-item {
        margin-top: 0.5rem;
        margin-left: 0;
      }
    }
    .page-size-selector {
      width: auto;
    }

    .query-editable-select {
      .jimu-numeric-input {
        width: 60px;
      }
    }
  `;function Ve(e){const{widgetId:t,outputDS:a,queryItem:n,queryParams:l,resultCount:r,records:i,onRenderDone:u,onSelectChange:c,direction:d,onEscape:g,defaultPageSize:f=o.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE}=e,[m,v]=qe(i),[h,y]=qe(),[S,b]=qe(),[x,R]=qe(B.Init),I=_e(1),w=_e(f),[C,j]=qe(f),M=ge(),D=o.React.useMemo((()=>{const e=[f];return Math.round(f/2)!==e[0]&&e.push(Math.round(f/2)),Math.round(f/5)!==e[1]&&e.push(Math.round(f/5)),e.reverse()}),[f]);o.React.useEffect((()=>{I.current=1,v(i),j(w.current)}),[i]),o.React.useEffect((()=>{Ee(a,n).then((e=>{y(e.popupTemplate),b(e.defaultPopupTemplate)}))}),[a,n]);const N=o.React.useCallback(((e,n)=>Fe(this,void 0,void 0,(function*(){I.current=e,R(B.Loading);const o=yield Te(t,0,a,Object.assign(Object.assign({},l),{page:e,pageSize:n}));v(o.records),null==u||u({dataItems:a.getAllLoadedRecords(),pageSize:n,page:I.current}),R(B.Loaded)}))),[u,a,n,l,t]);o.React.useEffect((()=>{f!==w.current&&(f<w.current?v(m.slice(0,f)):N(1,f),w.current=f,j(f))}),[f,m,N]);const O=o.React.useCallback((e=>{"Escape"===e.key&&(e.stopPropagation(),g())}),[g]),P=o.React.useCallback((e=>{" "===e.key&&e.preventDefault()}),[]);return(0,o.jsx)("div",{onKeyUp:O,onKeyDown:P,className:(0,o.classNames)({vertical:d===p.Vertical}),css:Ue(M)},(0,o.jsx)("div",{className:"list_items mb-2 px-4 py-1",role:"listbox"},null==m?void 0:m.map((e=>(0,o.jsx)(Ne,{key:e.getId(),data:e,dataSource:a,widgetId:t,popupTemplate:h,defaultPopupTemplate:S,expandByDefault:n.resultExpandByDefault,onClick:c})))),x===B.Loading&&(0,o.jsx)(s.Loading,{type:s.LoadingType.Donut}),r>0&&(0,o.jsx)("div",{className:"d-flex justify-content-between align-items-center px-4"},(0,o.jsx)(s.Pagination,{className:"d-flex justify-content-end",disabled:x===B.Loading,current:I.current,totalPage:Math.ceil(r/C),onChangePage:e=>N(e,C),pageSize:C,maxPageSize:1e3,pageSizeOptions:D,onPageSizeChange:e=>{e>0&&(j(e),N(1,e))},showSizeChanger:!0})))}var Ge=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const $e=e=>{const t=window.SVG,{className:a}=e,n=Ge(e,["className"]),l=(0,o.classNames)("jimu-icon jimu-icon-component",a);return t?o.React.createElement(t,Object.assign({className:l,src:w()},n)):o.React.createElement("svg",Object.assign({className:l},n))};var Je=u(87782),We=u.n(Je),He=u(20715),Ke=u.n(He);const{iconMap:Qe}=P(),Ye=o.css`
  display: flex;
  flex-direction: column;

  .query-result__header {
    color: var(--ref-palette-neutral-1100);
    font-weight: 500;
    font-size: 0.875rem;
    line-height: 1.5;
    border-bottom: 1px solid var(--ref-palette-neutral-400);
    margin-bottom: 6px;
    padding-bottom: 8px;
  }

  .query-result-container {
    flex: 1 1 0;
    display: flex;
    flex-direction: column;
  }

  .query-result-info {
    height: 18px;
  }
`;function Ze(e){var t;const{queryItem:a,queryParams:n,resultCount:l,maxPerPage:r,records:i,defaultPageSize:u,widgetId:c,outputDS:d,onNavBack:m}=e,h=o.hooks.useTranslation(y),[S,b]=o.React.useState(null),[x,R]=o.React.useState([]),I=o.React.useRef(),w=o.React.useMemo((()=>function(e){return[{id:"query-select-loaded",label:o.i18n.getIntl(e).formatMessage({id:"selectLoaded",defaultMessage:y.selectLoaded}),intl:o.i18n.getIntl(e),icon:We(),destroy:()=>{},isSupported:(e,t)=>Promise.resolve(t===o.DataLevel.Records),onExecute:(e,t,a)=>{const n=e[0],{dataSource:l}=n;return l.selectAllLoadedRecords(),o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(a,l.getRecords(),[l.id])),Promise.resolve(!0)}},{id:"query-clear-selection",label:o.i18n.getIntl(e).formatMessage({id:"clearSelection",defaultMessage:s.defaultMessages.clearSelection}),intl:o.i18n.getIntl(e),icon:Ke(),destroy:()=>{},isSupported:(e,t)=>{if(t!==o.DataLevel.Records)return Promise.resolve(!1);const a=e[0],{dataSource:n}=a;return 0===n.getSelectedRecordIds().length?Promise.resolve(!1):Promise.resolve(!0)},onExecute:(e,t,a)=>{const n=e[0],{dataSource:l}=n;return l.clearSelection(),o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(a,[],[l.id])),Promise.resolve(!0)}}]}(c)),[c]),C=o.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets[c].enableDataAction)||void 0===t||t})),j=o.ReactRedux.useSelector((e=>e.appConfig.widgets[c].config.resultPagingStyle)),M=o.ReactRedux.useSelector((e=>e.appConfig.widgets[c].config.resultListDirection)),D=Object.assign({},V,a),N=null!=j?j:g.MultiPage,O=null!=M?M:p.Vertical,P=o.React.useMemo((()=>{const e={dataSource:d,type:(null==x?void 0:x.length)>0?"selected":"loaded",records:(null==x?void 0:x.length)>0?x:(null==S?void 0:S.records)||[],name:null==d?void 0:d.id,label:null==d?void 0:d.getLabel()};if(D.resultFieldsType===f.SelectAttributes&&null!=D.resultDisplayFields)e.fields=Pe(D.resultDisplayFields,D.resultTitleExpression);else if(d&&"getPopupInfo"in d){const t=d.getPopupInfo();(null==t?void 0:t.fieldInfos)&&(e.fields=t.fieldInfos.filter((e=>e.visible)).map((e=>e.fieldName)))}return e}),[x,d,S,D]);o.hooks.useEffectOnce((()=>{(0,o.focusElementInKeyboardMode)(I.current)})),o.React.useEffect((()=>{b({records:i,pageSize:u,page:1})}),[i,u]),o.React.useEffect((()=>{var e;d&&(o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(c,[],[d.id])),null===(e=d.selectRecordsByIds)||void 0===e||e.call(d,[]))}),[a.resultSelectMode,d,c]);const E=o.React.useCallback((({dataItems:e,pageSize:t,page:a})=>{b({records:e,pageSize:t,page:a})}),[]),T=o.React.useCallback((()=>{var e;const t=o.DataSourceManager.getInstance().getDataSource(null==d?void 0:d.id),a=null==t?void 0:t.getSelectedRecords(),n=null!==(e=null==t?void 0:t.getSelectedRecordIds())&&void 0!==e?e:[];let l=!1;l=n.length!==(null==x?void 0:x.length)||n.some((e=>null==x.find((t=>t.getId()===e)))),l&&R(a)}),[null==d?void 0:d.id,x]),k=o.React.useMemo((()=>(0,o.Immutable)({dataSourceId:a.outputDataSourceId,mainDataSourceId:a.outputDataSourceId})),[null==a?void 0:a.outputDataSourceId]),L=o.React.useCallback((()=>{(0,o.focusElementInKeyboardMode)(I.current)}),[]),A=o.React.useCallback((e=>{var t,n,l;const s=e.getId();let r=null!==(t=d.getSelectedRecords())&&void 0!==t?t:[];const i=null!==(n=d.getSelectedRecordIds())&&void 0!==n?n:[];a.resultSelectMode===v.Multiple?i.includes(s)?r=r.filter((e=>e.getId()!==s)):r.push(e):r=i.includes(s)?[]:[e],o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(c,r,[d.id])),null===(l=d.selectRecordsByIds)||void 0===l||l.call(d,r.map((e=>e.getId())))}),[d,a.resultSelectMode,c]);return(0,o.jsx)("div",{className:"query-result h-100",css:Ye,role:"listbox","aria-label":h("results")},(0,o.jsx)(o.DataSourceComponent,{useDataSource:k,onDataSourceInfoChange:T}),(0,o.jsx)("div",{className:"query-result__header d-flex align-items-center mx-4"},(0,o.jsx)(s.Button,{"aria-label":h("back"),ref:I,className:"p-0 mr-2",size:"sm",type:"tertiary",icon:!0,onClick:()=>{m()}},(0,o.jsx)($e,{autoFlip:!0})),null!==(t=D.resultsLabel)&&void 0!==t?t:h("results"),(0,o.jsx)(o.React.Fragment,null,(0,o.jsx)(s.Tooltip,{title:h("clearResult"),placement:"bottom"},(0,o.jsx)(s.Button,{className:"ml-auto",icon:!0,size:"sm",type:"tertiary",onClick:()=>{var e;m(!0),b(null),null===(e=d.selectRecordsByIds)||void 0===e||e.call(d,[])},"aria-label":h("clearResult")},(0,o.jsx)(s.Icon,{icon:Qe.toolDelete}))),C&&d&&(0,o.jsx)(o.React.Fragment,null,(0,o.jsx)("div",{css:o.css`width: 1px; height: 16px; background-color: var(--ref-palette-neutral-500);`}),(0,o.jsx)(s.DataActionList,{widgetId:c,dataSets:[P],listStyle:s.DataActionListStyle.Dropdown,buttonSize:"sm",buttonType:"tertiary",extraActions:w})))),(0,o.jsx)("div",{className:"query-result-container mt-1"},(0,o.jsx)("div",{className:"query-result-info mb-2 px-4",role:"alert","aria-live":"polite"},(()=>{var e;if(S){if(N===g.LazyLoad)return`${h("featuresDisplayed")}: ${null===(e=null==S?void 0:S.records)||void 0===e?void 0:e.length} / ${l}`;const{page:t=1,pageSize:a=u}=S,n=(t-1)*a+1,o=n+a-1;return l>0?`${h("featuresDisplayed")}: ${n} - ${Math.min(o,l)} / ${l}`:`${h("featuresDisplayed")}: 0 - 0 / 0`}return""})()),N===g.LazyLoad&&l>0&&(0,o.jsx)(ze,{widgetId:c,queryItem:a,outputDS:d,queryParams:n,resultCount:l,records:i,direction:O,onRenderDone:E,onEscape:L,onSelectChange:A}),N===g.MultiPage&&l>0&&(0,o.jsx)(Ve,{widgetId:c,queryItem:a,outputDS:d,queryParams:n,resultCount:l,maxPerPage:r,records:i,direction:O,onRenderDone:E,onEscape:L,defaultPageSize:u,onSelectChange:A})))}var Xe=u(7835),et=u.n(Xe),tt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const at=e=>{const t=window.SVG,{className:a}=e,n=tt(e,["className"]),l=(0,o.classNames)("jimu-icon jimu-icon-component",a);return t?o.React.createElement(t,Object.assign({className:l,src:et()},n)):o.React.createElement("svg",Object.assign({className:l},n))};var nt=function(e,t,a,n){return new(a||(a=Promise))((function(l,o){function s(e){try{i(n.next(e))}catch(e){o(e)}}function r(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}i((n=n.apply(e,t||[])).next())}))},lt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a};const ot=o.css`
  &.wrapped .query-form {
    height: 100%;
  }
  .query-task__content {
    display: flex;
    flex-direction: column;
    width: 100%;
    padding-top: 8px;
    &:has(> .query-form__header > div:not(.d-none)), &:has(> .query-result) {
      padding-top: 16px;
    }
  }
  .query-form__header {
    display: flex;
    &.has-content {
      border-bottom: 1px solid var(--ref-palette-neutral-400);
      margin-bottom: 6px;
      padding-bottom: 8px;
    }
    .nav-action {
      flex: 1 1 0;
      overflow: hidden;
      display: flex;
      .jimu-btn {
        min-width: 26px;
      }
    }
    .result-menu {
      display: flex;
    }
  }
`;function st(e){var t,a,n;const{queryItem:i,onNavBack:u,total:c,isInPopper:p=!1,defaultPageSize:m=o.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE,wrappedInPopper:v=!1,className:h="",index:S}=e,b=lt(e,["queryItem","onNavBack","total","isInPopper","defaultPageSize","wrappedInPopper","className","index"]),x=o.hooks.useTranslation(y),[R,I]=o.React.useState(0),[w,C]=o.React.useState(!0),[j,M]=o.React.useState(0),D=o.React.useRef(null),N=o.React.useRef(null),[O,P]=o.React.useState(null),[E,T]=o.React.useState(null),[k,L]=o.React.useState(!0),A=o.React.useRef(i.sqlExprObj),B=o.React.useRef(null),z=o.React.useRef(),[q,G]=o.React.useState(null),$=Object.assign({},V,i),{icon:J,name:W,displayLabel:K}=$,Q=F({widgetId:e.widgetId,useDataSourceId:null===(t=$.useDataSource)||void 0===t?void 0:t.dataSourceId});o.hooks.useEffectOnce((()=>{(0,o.focusElementInKeyboardMode)(z.current)}));const Y=o.ReactRedux.useSelector((t=>t.appConfig.widgets[e.widgetId].config.resultPagingStyle));o.React.useEffect((()=>{var e;(null===(e=i.useDataSource)||void 0===e?void 0:e.dataSourceId)&&o.DataSourceManager.getInstance().destroyDataSource(i.outputDataSourceId)}),[null===(a=i.useDataSource)||void 0===a?void 0:a.dataSourceId,i.outputDataSourceId]);const Z=o.React.useMemo((()=>(0,o.Immutable)({dataSourceId:i.outputDataSourceId,mainDataSourceId:i.outputDataSourceId})),[i.outputDataSourceId]),X=o.React.useCallback((e=>{var t,a;const n=null!=e?e:E;if(null===(t=null==n?void 0:n.getDataSourceJson())||void 0===t?void 0:t.isOutputFromWidget){const e=n;null!=(null===(a=e.getCurrentQueryParams)||void 0===a?void 0:a.call(e)).geometry?L(!1):L(!0)}}),[E]),ee=o.React.useCallback((e=>{C(e),X()}),[X]),te=o.React.useCallback(((e,t)=>{const a=i.outputDataSourceId,n=(null==e?void 0:e.widgetQueries)?e.widgetQueries[`setFilter-${a}`]:null;if(null==n)return;const l=(null==t?void 0:t.widgetQueries)?t.widgetQueries[`setFilter-${a}`]:null;(null==n?void 0:n.where)!==(null==l?void 0:l.where)&&G(n)}),[i.outputDataSourceId]),ae=o.React.useCallback((()=>nt(this,void 0,void 0,(function*(){if(!O)return;const t=new o.DataRecordSetChangeMessage(e.widgetId,o.RecordSetChangeType.Remove,[O.id]);o.MessageManager.getInstance().publishMessage(t),yield o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(e.widgetId,[],[O.id]))}))),[e.widgetId,O]),ne=o.React.useCallback((()=>{N.current=null,null==O||O.setStatus(o.DataSourceStatus.NotReady),M(0),ae()}),[O,ae]),le=o.React.useCallback((e=>{ne(),T(e),X(e),I(0)}),[X,ne]),oe=o.React.useCallback((e=>{P(e)}),[]),se=o.React.useCallback(((e=!1)=>{e&&(N.current=null,null==O||O.setStatus(o.DataSourceStatus.NotReady),M(0),ae()),I(0),o.lodash.defer((()=>{(0,o.focusElementInKeyboardMode)(z.current)}))}),[O,ae]),re=o.React.useCallback((()=>{I(1)}),[]),ie=o.React.useCallback(((t,a)=>nt(this,void 0,void 0,(function*(){A.current=t,B.current=a;const n=O;I(2),yield ae();let s=m;Y===g.LazyLoad&&(s=o.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE);const i=function(e,t,a,n,s,i){var u,c,p;const g=e.getDataSourceJson(),m=e.getOriginDataSources()[0];(null==g?void 0:g.isDataInDataSourceInstance)&&e.setSourceRecords(m.getSourceRecords());const{useAttributeFilter:v,useSpatialFilter:h,sortOptions:y,resultFieldsType:S,resultDisplayFields:b,resultTitleExpression:x}=n;let R=b;if(null==b){const t=e.getSchema();R=(null==t?void 0:t.fields)?Object.values(t.fields).map((e=>e.jimuName)):[]}const I=e.mergeQueryParams(null!==(u=m.getCurrentQueryParams())&&void 0!==u?u:{},{where:v&&(null==t?void 0:t.sql)?o.dataSourceUtils.getArcGISSQL(t,e).sql:"1=1",sqlExpression:v&&(null==t?void 0:t.sql)?t:null}),w=Object.assign({returnGeometry:!0,page:s,pageSize:i},I);if(h&&(null==a?void 0:a.geometry)){const{geometry:e,relation:t=l.Intersect,buffer:n}=a,s={geometryType:o.dataSourceUtils.changeJSAPIGeometryTypeToRestAPIGeometryType(e.type),geometry:e.toJSON(),spatialRel:r[t],distance:null==n?void 0:n.distance,units:(null==n?void 0:n.unit)?d[n.unit]:void 0};Object.assign(w,s)}if((null==y?void 0:y.length)>0&&Object.assign(w,{orderByFields:y.map((e=>`${e.jimuFieldName} ${e.order}`))}),S===f.SelectAttributes){const t=Pe(R,x,e.getIdField());Object.assign(w,{outFields:t})}else{const e=m.getPopupInfo(),t=Object.values(null!==(c=m.getSchema().fields)&&void 0!==c?c:{}).map((e=>e.name)),a=null===(p=null==e?void 0:e.fieldInfos)||void 0===p?void 0:p.filter((e=>!1!==e.visible&&t.includes(e.fieldName)));Object.assign(w,{outFields:null==a?void 0:a.map((e=>e.fieldName))})}return w}(n,t,a,$,1,s);D.current=i,n.setStatus(o.DataSourceStatus.Unloaded),n.setCountStatus(o.DataSourceStatus.Unloaded),function(e,t,a){return Oe(this,void 0,void 0,(function*(){const n=yield t.loadCount(a,{widgetId:e,refresh:!0});return null!=n?n:0}))}(e.widgetId,n,i).then((t=>(M(t),n.updateQueryParams(D.current,e.widgetId),Te(e.widgetId,0,n,D.current)))).then((e=>{N.current=e.records})).finally((()=>{(null==a?void 0:a.layer)&&(null==a?void 0:a.clearAfterApply)&&a.layer.removeAll(),I(1)}))}))),[$,i,e.widgetId,O,m,Y,ae]),{useAttributeFilter:ue,sqlExprObj:ce,useSpatialFilter:de,spatialFilterTypes:pe,spatialIncludeRuntimeData:ge,spatialRelationUseDataSources:fe}=$,ve=ue&&null!=ce,he=k&&de&&(pe.length>0||ge||(null==fe?void 0:fe.length)>0);return(0,o.jsx)("div",{className:(0,o.classNames)("query-task h-100 d-flex",h,{wrapped:v}),css:ot},(0,o.jsx)("div",{className:(0,o.classNames)("query-task__content",{"d-none":0!==R,[s.FOCUSABLE_CONTAINER_CLASS]:1!==R&&p})},(0,o.jsx)(o.DataSourceComponent,{useDataSource:Z,onDataSourceCreated:oe,onDataSourceInfoChange:te}),(0,o.jsx)("div",{className:(0,o.classNames)("query-form__header mx-4 align-items-center",{"in-popper":p,"has-content":ve||he})},(0,o.jsx)("div",{className:(0,o.classNames)("nav-action align-items-center",{"d-none":v})},(0,o.jsx)(s.Button,{className:(0,o.classNames)("p-0 mr-2",{"d-none":1===c}),size:"sm",type:"tertiary",icon:!0,onClick:u,"aria-label":x("back"),ref:z},(0,o.jsx)($e,{autoFlip:!0})),(0,o.jsx)(U,{icon:J,name:K?W:""})),(0,o.jsx)("div",{className:(0,o.classNames)("result-menu ml-auto align-items-center",{"d-none":0===j})},(0,o.jsx)(s.Tooltip,{title:x("checkResult"),placement:"bottom"},(0,o.jsx)(s.Button,{size:"sm",type:"tertiary","aria-label":x("checkResult"),icon:!0,className:"py-0",onClick:re},(0,o.jsx)(at,null))),(0,o.jsx)("div",{css:o.css`width: 1px; height: 16px; background-color: var(--ref-palette-neutral-500);`}),(0,o.jsx)(s.Tooltip,{title:x("clearResult"),placement:"bottom"},(0,o.jsx)(s.Button,{size:"sm",type:"tertiary","aria-label":x("clearResult"),icon:!0,className:"py-0",onClick:ne},(0,o.jsx)(H,null))))),w&&Q&&(0,o.jsx)(me,Object.assign({},b,{configId:i.configId,outputDS:O,datasourceReady:null!=E,spatialFilterEnabled:k,dataActionFilter:q,onFormSubmit:ie})),(0,o.jsx)(_,{widgetId:e.widgetId,useDataSource:i.useDataSource,showMessage:!0,onStatusChange:ee,onDataSourceCreated:le})),(0,o.jsx)("div",{className:(0,o.classNames)("query-task__content",{"d-none":1!==R,[s.FOCUSABLE_CONTAINER_CLASS]:1===R&&p})},(0,o.jsx)(Ze,{widgetId:e.widgetId,queryItem:i,queryParams:D.current,resultCount:j,maxPerPage:null===(n=null==E?void 0:E.getMaxRecordCount)||void 0===n?void 0:n.call(E),records:N.current,defaultPageSize:m,outputDS:O,onNavBack:se})),2===R&&(0,o.jsx)(s.Loading,{type:s.LoadingType.Donut}))}const rt=()=>({name:k.TreeItemActionType.RenderOverrideItem,children:[{name:k.TreeItemActionType.RenderOverrideItemBody,children:[{name:k.TreeItemActionType.RenderOverrideItemMainLine}]}]});function it(e){var t;const{queryItems:a,widgetId:n,defaultPageSize:l,isInPopper:r=!1,className:i=""}=e,[u,c]=o.React.useState(0),[d,p]=o.React.useState((0,o.Immutable)({})),[g,f]=o.React.useState({index:0,id:null===(t=null==a?void 0:a[0])||void 0===t?void 0:t.configId}),m=o.React.useMemo((()=>{var e;const{index:t,id:n}=g;if(t>=0){if((null===(e=a[t])||void 0===e?void 0:e.configId)===n)return t;let l=-1;return a.find(((e,t)=>e.configId===n&&(l=t,!0))),-1===l&&(c(0),f({index:-1,id:null})),l}return t}),[a,g]);return(0,o.jsx)("div",{className:`runtime-query__query-list h-100 ${i}`,css:o.css`.jimu-tree-item__body {width: 100%;}`},0===u&&a.length>1&&(0,o.jsx)(k.List,{itemsJson:Array.from(a).map(((e,t)=>{var a;return{itemStateDetailContent:e,itemStateDisabled:null!==(a=d[e.configId])&&void 0!==a&&a,itemKey:`${t}`}})),overrideItemBlockInfo:rt,onClickItemBody:(e,t)=>{const{itemJsons:a}=t.props,n=a[0];((e,t)=>{c(1),f({index:e,id:t})})(+n.itemKey,n.itemStateDetailContent.configId)},renderOverrideItemMainLine:(e,t)=>{const{itemJsons:l}=t.props,s=l[0],r=s.itemStateDetailContent,i=+s.itemKey;return(0,o.jsx)(J,{key:r.configId,widgetId:n,index:i,queryItem:r,onStatusChange:e=>{((e,t)=>{const n=a[e].configId;p((e=>e.set(n,!t)))})(i,e)}})},className:`pt-4 px-4 ${r?s.FOCUSABLE_CONTAINER_CLASS:""}`}),(1===u||1===a.length)&&(0,o.jsx)(st,{widgetId:n,index:a.length>1&&m>=0?m:0,total:a.length,queryItem:a[a.length>1&&m>=0?m:0],onNavBack:()=>{c(0),f({index:-1,id:null})},defaultPageSize:l,isInPopper:r}))}const ut={padding:1};function ct(e){const{id:t,icon:a,label:n,forceClose:l,onOpenedChange:r,popperTitle:i,minSize:u,defaultSize:c,onWidthChange:d,buttonType:p="tertiary",children:g}=e,f=o.React.useRef(),m=o.React.useRef(0),[v,h]=o.React.useState(!1),[y,S]=o.React.useState(0),b=o.hooks.useCheckSmallBrowserSizeMode();o.React.useEffect((()=>{l&&h(!1)}),[l]),o.hooks.useEffectOnce((()=>{if("function"==typeof d){m.current=Math.round(f.current.clientWidth),d(t,m.current);const e=new ResizeObserver(o.lodash.throttle((e=>{const a=Math.round(e[0].contentRect.width);m.current!==a&&(m.current=a,d(t,a))}),200));return e.observe(f.current),()=>{e.disconnect()}}}));const x=o.React.useCallback((()=>{"function"==typeof r&&r(t,!v),h(!v),S(y+1),v&&setTimeout((()=>{(0,o.isKeyboardMode)()&&(0,o.focusElementInKeyboardMode)(f.current)}),200)}),[t,v,y,r]);return(0,o.jsx)("div",{className:"runtime-query__widget-popper"},(0,o.jsx)(s.Button,{title:n,"aria-label":n,icon:!0,size:"sm",type:p,ref:f,onClick:x},a&&(0,o.jsx)(s.Icon,Object.assign({size:16},"string"==typeof a?{icon:a,color:""}:{icon:a.svg,color:a.properties.color})),n&&(0,o.jsx)("div",{css:o.css`
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            word-break: break-word;
            word-wrap: break-word;
            line-height: 1.2;
          `,className:(0,o.classNames)({"ml-2":null!=a})},n)),b?(0,o.jsx)(s.MobilePanel,{open:v,title:i,onClose:x},g):(0,o.jsx)(s.FloatingPanel,{className:"ui-unit-popper ui-unit-popper_k-arrangement-icon flex-grow-1",headerClassName:s.FOCUSABLE_CONTAINER_CLASS,open:v,onHeaderClose:x,toggle:x,headerTitle:i,minSize:u,defaultSize:c,dragBounds:"body",version:y,reference:f,placement:"bottom-start",shiftOptions:ut},g))}const{iconMap:dt}=P(),pt=o.css`
  > div {
    margin-right: 8px;
  }
`;function gt(e){const{queryItems:t,widgetId:a,minSize:n,defaultSize:l,defaultPageSize:s,widgetLabel:r,wrap:i=!1}=e,u=o.React.useRef(),c=o.React.useRef(0),d=o.React.useRef({}),[p,g]=o.React.useState(t.length),[f,m]=o.React.useState(-1),v=o.React.useRef(null),h=o.React.useCallback((()=>{let e=0;for(let a=0;a<p;a++){const n=t[a],l=d.current[n.configId];if(!(l>0))return;if(e+=l+8,e>=c.current&&p!==a)return void g(a)}g(t.length)}),[p,t]);o.React.useEffect((()=>(v.current&&v.current.disconnect(),v.current=new ResizeObserver(o.lodash.throttle((e=>{const t=Math.round(e[0].contentRect.width);c.current!==t&&(c.current=t,h())}),200)),v.current.observe(u.current),()=>{v.current.disconnect()})),[h]),o.hooks.useEffectOnce((()=>{var e;c.current=null===(e=u.current)||void 0===e?void 0:e.clientWidth,h()}));const y=o.React.useCallback(((e,a)=>{const n=t[e];d.current[n.configId]!==a&&(d.current[n.configId]=a,h())}),[t,h]),S=o.React.useCallback(((e,t)=>{t?m(e):e===f&&m(-1)}),[f]),[b,x]=o.React.useMemo((()=>{const e=[],a=[];for(let n=0;n<t.length;n++)n<p?e.push(t[n]):a.push(t[n]);return[e,a]}),[t,p]);return(0,o.jsx)("div",{ref:u,css:pt,className:(0,o.classNames)("runtime-query__query-list h-100 d-flex",{"flex-wrap":i,"align-content-start":i})},b.map(((e,t)=>{const r=Object.assign({},V,e);return(0,o.jsx)(ct,{id:t,key:r.configId,icon:r.icon,buttonType:"default",label:r.displayLabel?r.name:void 0,popperTitle:r.name,onWidthChange:y,minSize:n,defaultSize:l,onOpenedChange:S,forceClose:f>=0&&f!==t},(0,o.jsx)(st,{widgetId:a,index:t,total:1,isInPopper:!0,queryItem:r,wrappedInPopper:!0,className:"pb-4",defaultPageSize:s}))})),x.length>0&&(0,o.jsx)(ct,{id:b.length+1,icon:dt.iconMore,minSize:n,buttonType:"default",popperTitle:r,defaultSize:l,onOpenedChange:S,forceClose:f>=0&&f!==b.length+1},(0,o.jsx)(it,{widgetId:a,isInPopper:!0,defaultPageSize:s,queryItems:x,className:"pb-4"})))}const{iconMap:ft}=P(),mt=o.css`
  background-color: var(--ref-palette-white);
`;class vt extends o.React.PureComponent{render(){var e,t,n,l,r,i,u,c,d;const{config:p,id:g,icon:f,label:m,layoutId:v,layoutItemId:h,controllerWidgetId:S}=this.props,b=this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:y._widgetLabel});return(null===(e=p.queryItems)||void 0===e?void 0:e.length)?p.arrangeType!==a.Popper||S?p.arrangeType!==a.Inline||S?(0,o.jsx)("div",{className:"jimu-widget runtime-query pb-4 surface-1 border-0",css:mt},(0,o.jsx)(pe.Provider,{value:`${v}:${h}`},(0,o.jsx)(it,{widgetId:g,queryItems:p.queryItems,defaultPageSize:p.defaultPageSize}))):(0,o.jsx)(pe.Provider,{value:`${v}:${h}`},(0,o.jsx)(gt,{widgetId:g,widgetLabel:m,wrap:p.arrangeWrap,queryItems:p.queryItems,minSize:null===(u=null===(i=p.sizeMap)||void 0===i?void 0:i.arrangementIconPopper)||void 0===u?void 0:u.minSize,defaultSize:null===(d=null===(c=p.sizeMap)||void 0===c?void 0:c.arrangementIconPopper)||void 0===d?void 0:d.defaultSize,defaultPageSize:p.defaultPageSize})):(0,o.jsx)(pe.Provider,{value:`${v}:${h}`},(0,o.jsx)(ct,{id:0,icon:f,popperTitle:m,minSize:null===(n=null===(t=p.sizeMap)||void 0===t?void 0:t.arrangementIconPopper)||void 0===n?void 0:n.minSize,defaultSize:null===(r=null===(l=p.sizeMap)||void 0===l?void 0:l.arrangementIconPopper)||void 0===r?void 0:r.defaultSize},(0,o.jsx)(it,{widgetId:g,isInPopper:!0,queryItems:p.queryItems,defaultPageSize:p.defaultPageSize,className:"pb-4"}))):(0,o.jsx)(s.WidgetPlaceholder,{icon:ft.iconQuery,widgetId:this.props.id,name:b})}}vt.versionManager=T;const ht=vt;function yt(e){u.p=e}})(),c})())}}}));