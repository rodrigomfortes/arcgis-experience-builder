/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-a980c9.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-a980c9"],{28903:(e,t,a)=>{a.d(t,{a:()=>o,d:()=>i,t:()=>s});const i=["short-date","long-month-day-year","day-short-month-year","long-date","long-month-year","short-month-year","year"],s=["short-time","long-time","short-time-24","long-time-24"],o=new Map;o.set("short-date",{dateFormat:i[0],timeFormat:""}),o.set("short-date-short-time",{dateFormat:i[0],timeFormat:s[0]}),o.set("short-date-long-time",{dateFormat:i[0],timeFormat:s[1]}),o.set("short-date-short-time-24",{dateFormat:i[0],timeFormat:s[2]}),o.set("short-date-long-time-24",{dateFormat:i[0],timeFormat:s[3]}),o.set("long-month-day-year",{dateFormat:i[1],timeFormat:""}),o.set("long-month-day-year-short-time",{dateFormat:i[1],timeFormat:s[0]}),o.set("long-month-day-year-long-time",{dateFormat:i[1],timeFormat:s[1]}),o.set("long-month-day-year-short-time-24",{dateFormat:i[1],timeFormat:s[2]}),o.set("long-month-day-year-long-time-24",{dateFormat:i[1],timeFormat:s[3]}),o.set("day-short-month-year",{dateFormat:i[2],timeFormat:""}),o.set("day-short-month-year-short-time",{dateFormat:i[2],timeFormat:s[0]}),o.set("day-short-month-year-long-time",{dateFormat:i[2],timeFormat:s[1]}),o.set("day-short-month-year-short-time-24",{dateFormat:i[2],timeFormat:s[2]}),o.set("day-short-month-year-long-time-24",{dateFormat:i[2],timeFormat:s[3]}),o.set("long-date",{dateFormat:i[3],timeFormat:""}),o.set("long-date-short-time",{dateFormat:i[3],timeFormat:s[0]}),o.set("long-date-long-time",{dateFormat:i[3],timeFormat:s[1]}),o.set("long-date-short-time-24",{dateFormat:i[3],timeFormat:s[2]}),o.set("long-date-long-time-24",{dateFormat:i[3],timeFormat:s[3]}),o.set("long-month-year",{dateFormat:i[4],timeFormat:null}),o.set("short-month-year",{dateFormat:i[5],timeFormat:null}),o.set("year",{dateFormat:i[6],timeFormat:null}),o.set("default",{dateFormat:i[0],timeFormat:s[2]})},48278:(e,t,a)=>{a.r(t),a.d(t,{arcgis_attributes_formatting:()=>h});var i=a(11254),s=a(69811),o=a(56612),l=a(17840),n=a(28903),r=a(84947),d=a(14528);a(84661);const m=new Date("December 31, 1969 18:00:00"),h=class{constructor(e){(0,i.r)(this,e),this.arcgisChange=(0,i.c)(this,"arcgisChange",7),this.arcgisClose=(0,i.c)(this,"arcgisClose",7),this.arcgisFieldsDeleted=(0,i.c)(this,"arcgisFieldsDeleted",7),this.manager=(0,d.u)(this),this.layerFieldsMap=new Map,this.arcadeExpMap=new Map,this.selectedFieldInfosMap=new Map,this.hasCommonDataTypes=!0,this.fieldsAreDeletable=!1,this.mapView=void 0,this.layer=void 0,this.config=void 0,this.strings=void 0,this.popupTemplate=void 0,this.popoverProps=void 0,this.selectedFields=void 0,this.deleteFieldEnabled=!1}async reposition(){this.popoverNode?.reposition()}async setFocus(){this.panelNode?.setFocus()}async componentWillLoad(){const{layer:e,mapView:t,popupTemplate:a,selectedFields:i,deleteFieldEnabled:o}=this;if(this.intl=await(0,s.z)(),this.layerFieldsMap=await(0,l.f)(e),this.arcadeExpMap=(0,l.m)(a),i.forEach((e=>{const t=a.fieldInfos.find((t=>t.fieldName===e));t&&this.selectedFieldInfosMap.set(e,{index:a.fieldInfos.indexOf(t),fieldType:(0,l.n)(e,this.layerFieldsMap,this.arcadeExpMap),fieldInfo:t})})),this.firstSelectedFieldInfo=this.selectedFieldInfosMap.get(i[0]).fieldInfo,this.firstSelectedFieldType=this.selectedFieldInfosMap.get(i[0]).fieldType,this.hasCommonDataTypes=this.checkCommonDataTypes(this.firstSelectedFieldType),!this.firstSelectedFieldInfo.format&&this.hasCommonDataTypes&&await this.setUpDefaultFormat(this.firstSelectedFieldInfo,this.firstSelectedFieldType),o&&("feature"===e.type||"oriented-imagery"===e.type)&&e.portalItem&&(1===i?.length||i?.length>1&&this.enableMultipleDeletion(e.portalItem))){const a=e.fields.filter((e=>i.includes(e.name)));if(i.some((t=>!e.fields.find((e=>e.name===t)))))this.fieldsAreDeletable=!1;else{const i=await Promise.all(a.map((async a=>await(0,r.a)(t,e,a))));this.fieldsAreDeletable=!i.some((e=>!e))}}}componentDidLoad(){this.panelNode?.setFocus()}render(){const{strings:e,popoverProps:t,hasCommonDataTypes:a,selectedFields:s}=this;return(0,i.h)(i.H,{key:"8bfa592d6573d13d1dfc9a6011cbc12afb125715",class:"js-app-flyout"},(0,i.h)("calcite-popover",{key:"882caf4fff778bf8f18a72c6e2e9b2bf6f6e0293",class:"popover",placement:"leading-start",open:!0,pointerDisabled:!0,referenceElement:t.refElement,offsetDistance:0,offsetSkidding:45,label:e.attributesFormatting.formattingOptions,ref:e=>this.popoverNode=e},(0,i.h)("calcite-panel",{key:"b5d74d7dbbec8bdeaa6aa354853de8ddcf61935d",closable:!0,style:{width:`${t.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.arcgisClose.emit(),ref:e=>this.panelNode=e},(0,i.h)("div",{key:"00020bcfd76f02b88b6731fe0e054f6083524fee",slot:"header-content"},e.attributesFormatting.manageField),(0,i.h)("div",{key:"96f04bd684d4dc0dedf12e5300d34a0207f8f3a2",class:"formatting-div"},1===s.length?this.renderDisplayName():(0,i.h)("h3",null,e.attributesFormatting.multipleSelection.replace("${number}",`${s.length}`)),a?this.renderFormattingOptions():(0,i.h)("h3",null,e.attributesFormatting.selectCommon)),this.renderDeleteButton(),this.renderDoneButton())))}renderDisplayName(){const{strings:e,arcadeExpMap:t,firstSelectedFieldInfo:a}=this;return(0,i.h)("calcite-label",null,e.attributesFormatting.displayName,(0,i.h)("calcite-input",{type:"text",ref:e=>this.displayNameNode=e,value:(t.has(a.fieldName)?t.get(a.fieldName).title:a.label)??void 0,onCalciteInputInput:()=>this.handleDisplayNameChange()}))}renderFormattingOptions(){const{firstSelectedFieldInfo:e,firstSelectedFieldType:t}=this;if(e.format){if(t===o.a.integer||t===o.a.smallInteger||t===o.a.bigInteger)return this.renderThousandSeparator();if(t===o.a.single||t===o.a.double||t===o.a.long||t===o.a.number)return(0,i.h)("div",null,this.renderSignificantDigits(),this.renderThousandSeparator());if(t!==o.a.date&&t!==o.a.dateOnly&&t!==o.a.timeOnly&&t!==o.a.timestampOffset||!this.dateFormattingAvailable())return(0,i.h)(i.F,null);{const a=n.a.has(e.format.dateFormat)?n.a.get(e.format.dateFormat):t===o.a.dateOnly?n.a.get("short-date"):n.a.get("short-date-short-time");return(0,i.h)("div",null,t!==o.a.timeOnly&&this.renderDateFormat(a.dateFormat),t!==o.a.timeOnly&&t!==o.a.dateOnly&&this.renderShowTime(a.timeFormat),t!==o.a.dateOnly&&this.renderTimeFormat(a.timeFormat))}}return(0,i.h)(i.F,null)}renderThousandSeparator(){const{strings:e,firstSelectedFieldInfo:t}=this;return(0,i.h)("section",{class:"single-line-label-switch-section"},(0,i.h)("calcite-label",{class:"single-line-label-switch-label"},e.attributesFormatting.showThousandsSeparator),(0,i.h)("calcite-switch",{scale:"s",class:"single-line-label-switch-switch",checked:!!t.format.digitSeparator,onCalciteSwitchChange:e=>{e.stopPropagation(),this.handleCalciteSwitchChange()},ref:e=>this.thousandSeparatorSwitchNode=e}))}renderSignificantDigits(){const{strings:e,firstSelectedFieldInfo:t}=this;return(0,i.h)("section",null,(0,i.h)("calcite-label",null,e.attributesFormatting.significantDigits,(0,i.h)("calcite-select",{label:e.attributesFormatting.significantDigits,onCalciteSelectChange:e=>{const a=e.target;t.format.places=Number(a.selectedOption.value)||0,this.saveFieldInfo()}},[0,1,2,3,4,5,6,7,8].map((a=>(0,i.h)("calcite-option",{value:a.toString(),selected:t.format.places===a},`${a} ${e.attributesFormatting.decimalPlaces}`))))))}renderDateFormat(e){const{strings:t,intl:a}=this;return(0,i.h)("section",null,(0,i.h)("calcite-label",null,t.attributesFormatting.dateFormat,(0,i.h)("calcite-select",{label:t.attributesFormatting.dateFormat,onCalciteSelectChange:()=>this.changeDateTimeFormat(),ref:e=>this.dateFormatSelectNode=e},n.d.map((t=>(0,i.h)("calcite-option",{value:t,selected:e===t},a.formatDate(m,a.convertDateFormatToIntlOptions(t))))))))}renderShowTime(e){const{strings:t}=this;return(0,i.h)("section",{class:"single-line-label-switch-section",ref:e=>this.showTimeSectionNode=e},(0,i.h)("calcite-label",{class:"single-line-label-switch-label"},t.attributesFormatting.showTime),(0,i.h)("calcite-switch",{scale:"s",class:"single-line-label-switch-switch",checked:!!e,onCalciteSwitchChange:e=>{e.stopPropagation(),this.handleCalciteSwitchChange()},ref:e=>this.showTimeSwitchNode=e}))}renderTimeFormat(e){const{strings:t}=this;return(0,i.h)("section",{ref:e=>this.timeFormatSectionNode=e},(0,i.h)("calcite-label",null,t.attributesFormatting.timeFormat,(0,i.h)("calcite-select",{label:t.attributesFormatting.timeFormat,onCalciteSelectChange:()=>this.changeDateTimeFormat(),ref:e=>this.timeFormatSelectNode=e},n.t.map((t=>(0,i.h)("calcite-option",{value:t,selected:e===t},this.getTimeFormatString(t)))))))}renderDeleteButton(){const{layer:e,mapView:t,config:a,selectedFields:s,strings:o,fieldsAreDeletable:l}=this;return l?(0,i.h)("calcite-button",{appearance:"outline-fill",slot:"footer",width:"half",kind:"danger",onClick:i=>{const o=i.target;o.disabled=!0;const l=document.createElement("arcgis-portal-field-delete");l.layer=e,l.mapView=t,l.config=a,l.fieldNames=s,l.addEventListener("arcgisFieldsDeleted",(()=>{l.parentElement?.removeChild(l),this.arcgisFieldsDeleted.emit(s)})),l.addEventListener("arcgisClose",(e=>{l.parentElement?.removeChild(l),e.stopPropagation(),o.disabled=!1})),document.body.append(l)}},1===s.length?o.attributesFormatting.deleteField:o.attributesFormatting.deleteFields):(0,i.h)(i.F,null)}renderDoneButton(){const{strings:e,fieldsAreDeletable:t}=this;return(0,i.h)("calcite-button",{appearance:"outline-fill",slot:"footer",width:t?"half":"full",onClick:()=>this.arcgisClose.emit()},e.attributesFormatting.done)}enableMultipleDeletion(e){return"devext.arcgis.com"===e.portal?.portalHostname&&"1"===window.localStorage.getItem("allow-bulk-field-deletion-agol-mv")}checkCommonDataTypes(e){const{selectedFields:t,selectedFieldInfosMap:a}=this;for(let i=1;i<t.length;i++){const s=a.get(t[i]).fieldType;if(e===o.a.integer||e===o.a.smallInteger||e===o.a.bigInteger){if(![o.a.integer,o.a.smallInteger,o.a.bigInteger].includes(s))return!1}else if(e===o.a.single||e===o.a.double||e===o.a.long||e===o.a.number){if(![o.a.single,o.a.double,o.a.long,o.a.number].includes(s))return!1}else if(e===o.a.date||e===o.a.timestampOffset){if(![o.a.date,o.a.timestampOffset].includes(s))return!1}else if(e===o.a.dateOnly){if(![o.a.dateOnly].includes(s))return!1}else if(e===o.a.timeOnly&&![o.a.timeOnly].includes(s))return!1}return!0}async setUpDefaultFormat(e,t){const a=await(0,s.at)();t===o.a.integer||t===o.a.smallInteger||t===o.a.bigInteger?(e.format=new a({digitSeparator:!1}),this.saveFieldInfo()):t===o.a.single||t===o.a.double||t===o.a.long||t===o.a.number?(e.format=new a({digitSeparator:!1,places:2}),this.saveFieldInfo()):t!==o.a.date&&t!==o.a.dateOnly&&t!==o.a.timeOnly&&t!==o.a.timestampOffset||!this.dateFormattingAvailable()||(t===o.a.dateOnly?e.format=new a({dateFormat:"short-date"}):e.format=new a({dateFormat:"short-date-short-time"}),this.saveFieldInfo())}setUpDateTimeDisplay(){const{firstSelectedFieldInfo:e,firstSelectedFieldType:t,hasCommonDataTypes:a}=this;if((t===o.a.date||t===o.a.timeOnly||t===o.a.timestampOffset)&&e.format?.dateFormat&&a){const a=n.a.get(e.format.dateFormat);t===o.a.date||t===o.a.timestampOffset?""===a.timeFormat?(this.showTimeSwitchNode.checked=!1,this.showTimeSectionNode.style.display="flex",this.timeFormatSectionNode.style.display="none"):null===a.timeFormat?(this.showTimeSwitchNode.checked=!1,this.showTimeSectionNode.style.display="none",this.timeFormatSectionNode.style.display="none"):(this.showTimeSwitchNode.checked=!0,this.showTimeSectionNode.style.display="flex",this.timeFormatSectionNode.style.display="block"):t===o.a.timeOnly&&(this.timeFormatSectionNode.style.display="block")}}dateFormattingAvailable(){const{layer:e}=this;return(0,l.a)(e)!==o.s.scene||null!==e.associatedLayer}handleDisplayNameChange(){const{firstSelectedFieldInfo:e}=this;(0,l.i)(this.displayNameNode.value)||(this.displayNameNode.value=e.fieldName),this.arcadeExpMap.has(e.fieldName)?this.arcadeExpMap.get(e.fieldName).title=this.displayNameNode.value:e.label=this.displayNameNode.value,this.saveFieldInfo()}handleCalciteSwitchChange(){const{firstSelectedFieldInfo:e,firstSelectedFieldType:t}=this;e.format&&(t===o.a.date||t===o.a.timestampOffset?this.changeDateTimeFormat():(e.format.digitSeparator=!!this.thousandSeparatorSwitchNode?.checked,this.saveFieldInfo()))}changeDateTimeFormat(){const{firstSelectedFieldInfo:e,firstSelectedFieldType:t}=this,a=this.dateFormatSelectNode?.selectedOption?.value,i=this.timeFormatSelectNode?.selectedOption?.value;if(t===o.a.date||t===o.a.timestampOffset){const t=n.a.get(a);""===t.timeFormat?e.format.dateFormat=this.showTimeSwitchNode.checked?`${a}-${i}`:`${a}`:null===t.timeFormat&&(e.format.dateFormat=`${a}`)}else t===o.a.dateOnly?e.format.dateFormat=`${a}`:t===o.a.timeOnly&&(e.format.dateFormat=`short-date-${i}`);this.saveFieldInfo(),this.setUpDateTimeDisplay(),this.popoverNode?.reposition()}getTimeFormatString(e){const{strings:t}=this;return e===n.t[0]?t.attributesFormatting.shortTime:e===n.t[1]?t.attributesFormatting.longTime:e===n.t[2]?t.attributesFormatting.shortTime24:e===n.t[3]?t.attributesFormatting.longTime24:t.attributesFormatting.shortTime24}saveFieldInfo(){const{arcadeExpMap:e,selectedFieldInfosMap:t,selectedFields:a,firstSelectedFieldInfo:i,hasCommonDataTypes:s}=this;s&&(t.forEach((e=>{e.fieldInfo.fieldName===i.fieldName?e.fieldInfo=i.clone():e.fieldInfo.format=i.format.clone()})),1===a.length&&e.has(i.fieldName)&&this.popupTemplate.expressionInfos?.forEach(((t,a)=>{`${o.f.expression}${t.name}`!==i.fieldName||(this.popupTemplate.expressionInfos[a]=e.get(i.fieldName).clone())})),t.forEach((e=>{this.popupTemplate.fieldInfos[e.index]=e.fieldInfo.clone()})),Array.isArray(this.popupTemplate.content)&&this.popupTemplate.content.forEach((e=>{"fields"===e.type&&e.fieldInfos&&e.fieldInfos.forEach(((a,i)=>{if(t.has(a.fieldName)){const s=t.get(a.fieldName).fieldInfo.clone();s.visible=!0,e.fieldInfos[i]=s}}))})),this.arcgisChange.emit(this.popupTemplate.clone()))}get el(){return(0,i.a)(this)}};h.style=".popover {\n  --calcite-popover-z-index: 100;\n}\n\n.formatting-div {\n  padding: var(--calcite-spacing-md);\n  max-height: 60vh;\n}\n\n.single-line-label-switch-section {\n  display: flex;\n  margin: 0px;\n  padding: var(--calcite-spacing-sm) 0px;\n}\n\n.single-line-label-switch-label {\n  display: flex;\n  flex-flow: column nowrap;\n  flex: 1 0 0%;\n  overflow: hidden;\n}\n\n.single-line-label-switch-switch {\n  flex: 0 0 0%;\n  justify-self: flex-end;\n  margin: 0px;\n\n  input {\n    display: none;\n  }\n}\n"}}]);