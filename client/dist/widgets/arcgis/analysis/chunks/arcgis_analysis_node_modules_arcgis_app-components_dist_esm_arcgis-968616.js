/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-968616.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-968616"],{37362:(e,t,a)=>{a.d(t,{U:()=>i,a:()=>o,b:()=>r,g:()=>n});const i="/Categories",r=(e,t,a=!0)=>{const i=null!=e?e:"";return`${i}${i.endsWith("/")?"":"/"}${a?t.title.toLocaleLowerCase():t.title}`};function o(e){var t;let a=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.title;return a&&"/"!==a.charAt(0)&&(a=`/${a}`),a||i}const n=(e,t)=>`${e.replace(/\/([^\/]+)$/,`/${t}`)}`},46227:(e,t,a)=>{a.d(t,{g:()=>i});const i=()=>[2,1,1,1,3].map((e=>{let t="";for(let a=0;a<e;a++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t})).join("-")},53804:(e,t,a)=>{a.r(t),a.d(t,{arcgis_category_schema_editor:()=>I,arcgis_schema_editor:()=>A,arcgis_schema_editor_category:()=>D});var i=a(87849),r=a(37362),o=a(81034),n=a(64099),s=a(4429),c=a(80729),l=a(96034),h=a(46227),g=a(56274);a(931),a(93814),a(15332);const d=(e,t)=>{var a;return null!==(a=null==e?void 0:e.toLocaleLowerCase().replace(t.toLowerCase(),"").slice(1).split("/").length)&&void 0!==a?a:0},m=(e,t,a)=>{var i;const o=a.toLocaleLowerCase();if(null==t||t===o)return{targetCategory:e,targetIndex:1,parentCategory:null,originalPath:t};const n=t.slice(1).split("/");let s=0===t.toLocaleLowerCase().indexOf(o)?(0,r.b)("",{title:n.shift()}):"",c=null,l=e,h=0,g=s;do{s=(0,r.b)(s,{title:n.shift()}),c=l,h=l.categories.findIndex((e=>e.path.toLocaleLowerCase()===s.toLocaleLowerCase())),l=l.categories[h],g+=`/${null!==(i=null==l?void 0:l.title)&&void 0!==i?i:""}`}while(n.length>0&&l.categories.length);return g=g.replace(o,a),{targetCategory:l,targetIndex:h,parentCategory:c,originalPath:g}},y=e=>e.categories.map(u),u=e=>({title:e.title,categories:e.categories.map(u)}),p=({categoryAggregationData:e,categorySchema:t,parentPath:a,lowerCaseRootCategoryPath:i})=>t.map((t=>{var o,n,s;const c=(0,r.b)(null!=a?a:i,t),l=null===(o=e.fieldValues.find((e=>e.value===c)))||void 0===o?void 0:o.count,h=p({parentPath:c,categorySchema:null!==(n=t.categories)&&void 0!==n?n:[],categoryAggregationData:e,lowerCaseRootCategoryPath:i});return{title:null!==(s=t.displayName)&&void 0!==s?s:t.title,path:c,count:null!=l?l:0,categories:h}})),C=e=>e.reduce(((e,t)=>{var a;return e+1+C(null!==(a=t.categories)&&void 0!==a?a:[])}),0),v=({targetCategory:e,targetParentCategory:t})=>{var a;const i=null===(a=e.title.toLocaleLowerCase())||void 0===a?void 0:a.trim();if(!i)return{code:"emptyTitle"};const r=(0,c.a)(i);return(null==r?void 0:r.length)>0?{code:"invalidCharacters",invalidCharacters:(0,s.b)((0,c.a)(i))}:i.length>w?{code:"maxCharacter"}:t.categories.some((t=>t.title.toLowerCase()===i&&t.path!==e.path))?{code:"destinationHasSameName"}:null},f=({rootCategoryPath:e,uiCategory:t,uiPath:a})=>m(t,a,e).originalPath,w=100,S=e=>{e.forEach((e=>{e.description&&delete e.description,e.categories?S(e.categories):e.categories=[]}))},b=e=>{const t=structuredClone(e);return S(t),t},I=class{constructor(e){(0,i.r)(this,e),this.workflowCancel=(0,i.c)(this,"workflowCancel",7),this.newSchemaWorkflowComplete=(0,i.c)(this,"newSchemaWorkflowComplete",7),this.deleteAllSchema=(0,i.c)(this,"deleteAllSchema",7),this.hasChangeSinceLastOpen=!1,this.didFetchTemplates=!1,this.didConfirmUnsavedChanges=!1,this.templateInfo={custom:{schema:[{title:"Categories",categories:[]}]},arcgis:{schema:[],learnMoreId:"120001309",enterpriseLearnMoreId:"120001580"},iso:{schema:[],learnMoreId:"120001310",enterpriseLearnMoreId:"120001581"},inspire:{schema:[],learnMoreId:"120001311",enterpriseLearnMoreId:"120001582"}},this.fetchCategoryData=async()=>{var e,t;const{templateInfo:a,setCategorySchema:i,getCategorySchema:o,getCategoryAggregation:n,getStandardSetCategories:s,didFetchTemplates:c}=this,[{result:l},{result:h}]=await Promise.all([o(),n()]);if(null===(t=null===(e=null==l?void 0:l[0])||void 0===e?void 0:e.categories)||void 0===t?void 0:t.length)i(l),this.categoryAggregationData=h;else if(this.rootCategoryTitle=r.U.replace("/",""),this.categorySchema=[],this.newCategoryMode=!0,!c&&s){this.isFetchingTemplate=!0;const{result:e}=await s();a.arcgis.schema=e.LivingAtlas,a.iso.schema=e.ISO,a.inspire.schema=e.Inspire,this.didFetchTemplates=!0,this.isFetchingTemplate=!1}},this.setCategorySchema=e=>{this.rootCategoryTitle=e[0].title,this.categorySchema=e[0].categories},this.closeDialog=()=>{this.schemaToConfirm=null,this.hasUnsavedChanges=!1,this.workflowCancel.emit({hasChangeSinceLastOpen:this.hasChangeSinceLastOpen})},this.updateCategorySchema=async({schemaToUpdate:e,ignoreNewCategoryMode:t=!1,optimisticUpdate:a=!0})=>{const{rootCategoryTitle:i,handleError:r,fetchCategoryData:o,newCategoryMode:n,deleteAllSchema:s,deleteSchema:c,updateSchema:l}=this;if(n&&!t)return this.hasUnsavedChanges=e.length>0,this.categorySchema=e,!0;this.hasChangeSinceLastOpen=!0;const h=this.categorySchema;a&&(this.categorySchema=e);return(async()=>{if(this.error=null,0===e.length){const{error:e}=await c();return void(e?(r({code:"generic"}),a&&(this.categorySchema=h)):(this.newCategoryMode=!0,s.emit()))}const{error:t}=await l([{title:i,categories:n?b(e):e}]);t?(r({code:"generic"}),a&&(this.categorySchema=h)):(this.hasUnsavedChanges=!1,await o())})(),!0},this.handleError=e=>{const{i18n:t}=this,a=t.error,{code:i}=e;let r="";if("invalidCharacters"===i){const t=e.invalidCharacters;r=(0,o.f)(this.lang,a.invalidCharacters,t.length,{invalidCharacters:t.join(", ")})}else r=a[i].message,"maxCharacter"===i&&(r=r.replace("${maxCharacter}",`${w}`));this.error={title:t.error[i].title,message:r}},this.finishSetupNewCategorySchema=async()=>{const{newSchemaWorkflowComplete:e,categorySchema:t,updateCategorySchema:a}=this;await a({schemaToUpdate:t,ignoreNewCategoryMode:!0})&&(this.newCategoryMode=!1,e.emit({newSchema:t}))},this.renderTemplates=()=>{const{templateInfo:e,i18n:t,chosenTemplate:a,portal:r,config:o,setCategorySchema:n,customTemplateDescriptionText:s}=this,{helpBase:c,helpMap:l}=o;return(0,i.h)("div",{class:"template-container"},(0,i.h)("p",{class:"template-title"},t.template.title),(0,i.h)("calcite-tile-select-group",null,Object.keys(e).map((o=>{const{learnMoreId:h,enterpriseLearnMoreId:g}=e[o];return(0,i.h)("calcite-tile-select",{key:o,checked:a===o,description:s,heading:t.template.templateList[o].title,width:"auto",value:o,onCalciteTileSelectChange:t=>{const a=t.currentTarget.value;this.chosenTemplate=a,n(e[a].schema),this.hasUnsavedChanges="custom"!==a}},h&&(0,i.h)("calcite-link",{href:`${c}${l[r.isPortal?g:h]}`,role:"presentation",class:"template-link",iconEnd:"launch",target:"_blank",rel:"noopener noreferrer"},t.template.learnMore))}))))},this.renderConfirmationModal=()=>{const{i18n:e,handleUpdateSchemaWithCount:t,schemaToConfirm:a,lang:r,deleteConfirmMessage:n,changeTitleConfirmMessage:s}=this;if(!a)return null;const c="delete"===a.type,l=e.warning[c?"deleteInUseCategory":"changeTitleInUseCategory"],h=c?n:s,g=c?"danger":"brand";return(0,i.h)("calcite-dialog",{modal:!0,kind:g,scale:"m",width:"s",onCalciteDialogClose:e=>{e.stopPropagation(),this.schemaToConfirm=null},open:!!a,class:"confirm-modal",style:{"--calcite-dialog-background-color":"var(--calcite-color-foreground-1)","--calcite-dialog-size-y":"200px"},heading:l.title},(0,i.h)("div",{class:"confirm-modal-content"},(0,o.f)(r,h,a.count,{newTitle:"change-title"===a.type?a.newTitle:""})),(0,i.h)("calcite-button",{slot:"footer-end",appearance:"outline","data-id":"cancelButton",onClick:()=>{this.schemaToConfirm=null,"change-title"===a.type&&(this.categorySchema=[...this.categorySchema])}},e.cancel),(0,i.h)("calcite-button",{slot:"footer-end",appearance:"solid",kind:g,"data-id":"nextButton",onClick:t},l.cta))},this.handleUpdateSchemaWithCount=async()=>{const{schemaToConfirm:e,updateCategorySchema:t,updateSchemaFromPath:a,categoryAggregationData:i}=this;this.isUpdatingCategoryWithCount=!0,this.schemaToConfirm=null;await t({schemaToUpdate:e.schema})&&(await a({path:e.path,updateInfo:"delete"===e.type?{type:"delete"}:{type:"change-title",newTitle:e.newTitle}}),"change-title"===e.type&&(i.fieldValues=i.fieldValues.map((t=>{const a=e.path.toLowerCase(),i=(0,r.g)(a,e.newTitle.toLowerCase());return t.value.toLowerCase()===a?Object.assign(Object.assign({},t),{value:i}):t})),this.categoryAggregationData=Object.assign({},i))),this.isUpdatingCategoryWithCount=!1},this.getUnsavedChangesConfirmation=()=>window.confirm(this.i18n.hasUnsavedChanges),this.user=void 0,this.portal=void 0,this.config=void 0,this.canFetchCategories=void 0,this.dialogHeading=void 0,this.noticeTitle=void 0,this.noticeDescription=void 0,this.deleteConfirmMessage=void 0,this.changeTitleConfirmMessage=void 0,this.customTemplateDescriptionText=void 0,this.getDisabledWarning=void 0,this.getCategorySchema=void 0,this.getCategoryAggregation=void 0,this.getStandardSetCategories=void 0,this.updateSchema=void 0,this.deleteSchema=void 0,this.updateSchemaFromPath=void 0,this.isActive=void 0,this.alwaysShowInfoNotice=!1,this.newCategoryMode=!1,this.categorySchema=[],this.categoryAggregationData={fieldName:"categories",fieldValues:[]},this.hasUnsavedChanges=void 0,this.error=null,this.isFetchingSchemaOnActiveChange=!1,this.isUpdatingCategoryWithCount=!1,this.schemaToConfirm=void 0,this.rootCategoryTitle=void 0,this.isFetchingTemplate=!1,this.chosenTemplate="custom"}async componentWillLoad(){const e=await(0,n.g)(this.el);this.i18n=e[0],this.lang=e[1],this.handleIsActiveChange()}async handleIsActiveChange(){this.hasChangeSinceLastOpen=!1,this.chosenTemplate="custom",this.error=null,this.schemaToConfirm=null,this.isActive&&this.canFetchCategories&&(this.isFetchingSchemaOnActiveChange=!0,await this.fetchCategoryData(),this.isFetchingSchemaOnActiveChange=!1)}render(){const{newCategoryMode:e,categorySchema:t,categoryAggregationData:a,rootCategoryTitle:r,isActive:o,isFetchingSchemaOnActiveChange:n,closeDialog:s,i18n:c,updateCategorySchema:l,error:h,renderTemplates:g,chosenTemplate:d,workflowCancel:m,finishSetupNewCategorySchema:y,hasUnsavedChanges:u,handleError:p,renderConfirmationModal:C,isUpdatingCategoryWithCount:v,getUnsavedChangesConfirmation:f,dialogHeading:w,isFetchingTemplate:S,templateInfo:b,noticeTitle:I,noticeDescription:A,getDisabledWarning:D,didFetchTemplates:T,alwaysShowInfoNotice:x}=this;return!o||n?null:(0,i.h)("calcite-dialog",{modal:!0,open:o,beforeClose:async()=>{if(this.didConfirmUnsavedChanges)throw this.didConfirmUnsavedChanges=!1,new Error;if(this.didConfirmUnsavedChanges=!0,u&&!f())throw new Error},onCalciteDialogClose:s,scale:"m",class:{modal:!0,"modal--large":e},outsideCloseDisabled:!0,heading:w},(0,i.h)("div",{class:"stage"},(0,i.h)("arcgis-tunnel",{reference:this.el},C()),(0,i.h)("calcite-alert",{icon:!0,open:!!h,label:null==h?void 0:h.title,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,i.h)("div",{slot:"message"},null==h?void 0:h.message)),(S||v)&&(0,i.h)("calcite-scrim",{loading:!0},c.loadingText),e&&b&&T&&g(),(0,i.h)("div",{class:{"inner-container":!0,"inner-container--new-category":e}},(x||!e)&&(0,i.h)("calcite-notice",{open:!0,class:"help-text"},(0,i.h)("div",{slot:"title"},I),(0,i.h)("div",{slot:"message"},A)),(0,i.h)("arcgis-schema-editor",{newCategoryMode:e,showInputByDefault:"custom"===d,canEditCategory:()=>!0,categoryAggregationData:a,categorySchema:t,rootCategoryPath:`/${r}`,canCollapseAll:!e,getDisabledWarning:D,saveNewTitle:async({newSchema:e,categoryCount:t,path:a,newTitle:i})=>t?(this.schemaToConfirm={schema:e,count:t,path:a,newTitle:i,type:"change-title"},!0):l({schemaToUpdate:e,optimisticUpdate:!1}),saveNewCategory:async({newSchema:e})=>l({schemaToUpdate:e}),onArcgisSchemaEditorDelete:async({detail:{newSchema:e,categoryCount:t,path:a}})=>t?this.schemaToConfirm={schema:e,count:t,path:a,type:"delete"}:l({schemaToUpdate:e}),onArcgisSchemaEditorListOrderChange:async({detail:{newSchema:e}})=>l({schemaToUpdate:e}),onArcgisSchemaEditorInvalidMove:({detail:{error:e}})=>{p(e)},onArcgisSchemaEditorTitleInvalid:({detail:{error:e}})=>{p(e)}}))),e&&(0,i.h)(i.F,null,(0,i.h)("calcite-button",{slot:"footer-end",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{u&&!f()||m.emit()}},c.cancel),(0,i.h)("calcite-button",{slot:"footer-end",appearance:"solid","data-id":"nextButton",onClick:y,disabled:!u},c.finishSetup)))}get el(){return(0,i.a)(this)}static get watchers(){return{isActive:["handleIsActiveChange"]}}};I.style=".stage{height:100%;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));overflow:hidden;display:flex}.modal{--calcite-dialog-content-space:0;--calcite-dialog-size-x:48rem;--calcite-dialog-size-y:90vh;--calcite-dialog-background-color:var(--calcite-color-background)}.modal--large{--calcite-dialog-size-x:1080px}.template-container{overflow:auto;width:20rem;padding:1rem}.template-title{margin-top:0px;margin-bottom:0px;margin-bottom:1rem;font-size:1.125rem}.template-link{font-size:0.75rem}.inner-container{overflow:auto;box-sizing:border-box;width:100%;padding:2rem}.inner-container--new-category{padding-inline-start:0.5rem;padding:1rem}.help-text{margin-bottom:0.75rem}.confirm-modal{--calcite-modal-width:32rem;--calcite-modal-height:auto}.confirm-modal-content{padding:1rem}";const A=class{constructor(e){(0,i.r)(this,e),this.arcgisSchemaEditorListOrderChange=(0,i.c)(this,"arcgisSchemaEditorListOrderChange",7),this.arcgisSchemaEditorDelete=(0,i.c)(this,"arcgisSchemaEditorDelete",7),this.arcgisSchemaEditorInvalidMove=(0,i.c)(this,"arcgisSchemaEditorInvalidMove",7),this.arcgisSchemaEditorTitleInvalid=(0,i.c)(this,"arcgisSchemaEditorTitleInvalid",7),this.arcgisSchemaEditorReinitializeSortable=(0,i.c)(this,"arcgisSchemaEditorReinitializeSortable",7),this.prevChangeEventPayload=null,this.prevSchema=null,this.handleExpandCollapseAllClick=()=>{this.isCollapsedAll=!this.isCollapsedAll,this.itemRef.expandOrCollapseAll(this.isCollapsedAll)},this.handleListOrderChange=e=>{const{categorySchema:t,arcgisSchemaEditorListOrderChange:a,uiCategory:i,rootCategoryPath:r}=this,o=((e,{fromCategory:{path:t},toCategory:{path:a},fromIndex:i,toIndex:r},o)=>{const n=structuredClone(e),s=m(n,t,o);let c=s;t!==a&&(c=m(n,a,o));const[l]=s.targetCategory.categories.splice(i,1);return c.targetCategory.categories.splice(r,0,l),y(n)})(i,e,r);a.emit(Object.assign(Object.assign({},e),{newSchema:o})),this.prevSchema=t,this.arcgisSchemaEditorReinitializeSortable.emit()},this.handleDeleteClick=e=>{const{arcgisSchemaEditorDelete:t,uiCategory:a,rootCategoryPath:i}=this,r=((e,{path:t},a)=>{const i=structuredClone(e),{targetIndex:r,parentCategory:o}=m(i,t,a);return null==o||o.categories.splice(r,1),y(i)})(a,e,i);t.emit(Object.assign(Object.assign({},e),{path:f({uiPath:e.path,rootCategoryPath:i,uiCategory:a}),newSchema:r})),this.prevSchema=this.categorySchema},this.handleSaveNewTitle=async e=>{const{saveNewTitle:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:i,rootCategoryPath:o}=this,n=e.path,s=v({targetParentCategory:m(a,n,o).parentCategory,targetCategory:{path:n,title:e.newTitle}});if(s)return i.emit(Object.assign(Object.assign({},e),{error:s})),!1;const c=this.categorySchema,l=((e,{newTitle:t,path:a},i)=>{const r=structuredClone(e);return m(r,a,i).targetCategory.title=t,y(r)})(a,e,o),h=await t(Object.assign(Object.assign({},e),{path:f({uiPath:n,rootCategoryPath:o,uiCategory:a}),newSchema:l}));if(h){this.prevSchema=c;const{targetCategory:t,parentCategory:i}=m(a,e.path,o);t.title=e.newTitle,t.path=(0,r.b)(i.path,t)}return h},this.handleSaveNewCategory=async e=>{const{saveNewCategory:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:i,rootCategoryPath:r}=this,o=e.path,{parentCategory:n,targetCategory:s}=m(a,o,r),c=v({targetParentCategory:null!=s?s:n,targetCategory:{path:o,title:e.newTitle}});if(c)return i.emit(Object.assign(Object.assign({},e),{error:c})),!1;const l=this.categorySchema,h=((e,{newTitle:t,path:a},i)=>{const r=structuredClone(e),o=a.replace(/\/[^/]+$/,"");if(o){const{targetCategory:e}=m(r,o,i);e.categories.push({title:t,categories:[],count:0,path:null})}else r.categories.push({title:t,categories:[],count:0,path:null});return y(r)})(a,e,r),g=await t(Object.assign(Object.assign({},e),{newSchema:h}));return g&&(this.prevSchema=l),g},this.isMoveValid=e=>{const{maxDepth:t,arcgisSchemaEditorInvalidMove:a,prevChangeEventPayload:i,rootCategoryPath:r}=this,{fromCategory:o,toCategory:n,fromItemCategory:s}=e,{fromCategory:c,fromItemCategory:l,toCategory:h,fromIndex:g,toIndex:m}=null!=i?i:{};if(i&&c.path===o.path&&l.path===s.path&&h.path===n.path&&g===e.fromIndex&&m===e.toIndex)return this.prevChangeEventPayload=null,null;this.prevChangeEventPayload=e;const{path:y}=n;if("number"==typeof t&&y&&d(y,r)>t)return a.emit(Object.assign(Object.assign({},e),{error:{code:"maxDepthExceeded"}})),!1;const u=v({targetParentCategory:n,targetCategory:s});return!u||(a.emit(Object.assign(Object.assign({},e),{error:u})),!1)},this.categorySchema=void 0,this.rootCategoryPath=void 0,this.categoryAggregationData=void 0,this.showInputByDefault=!1,this.newCategoryMode=void 0,this.maxDepth=2,this.maxCategories=900,this.canCollapseAll=!0,this.canEditCategory=void 0,this.saveNewTitle=void 0,this.saveNewCategory=void 0,this.getDisabledWarning=void 0,this.isCollapsedAll=!1,this.uiCategory=void 0,this.canAddCategory=!1,this.canDeleteCategory=!1}async componentWillLoad(){const e=await(0,n.g)(this.el);this.i18n=e[0],this.categorySchemaChangeHandler()}async revertSchema(){this.categorySchema=this.prevSchema}categorySchemaChangeHandler(){const{categorySchema:e,categoryAggregationData:t,rootCategoryPath:a}=this;this.uiCategory=(({categoryAggregationData:e,categorySchema:t,rootCategoryPath:a})=>{var i,r;const o=a.toLocaleLowerCase();return{title:"",path:null,count:null!==(r=null===(i=e.fieldValues.find((e=>e.value===o)))||void 0===i?void 0:i.count)&&void 0!==r?r:0,categories:p({parentPath:null,categorySchema:t,categoryAggregationData:e,lowerCaseRootCategoryPath:o})}})({categorySchema:e,categoryAggregationData:t,rootCategoryPath:a});const i=C(e);this.canAddCategory=i<this.maxCategories,this.canDeleteCategory=!0}render(){const{uiCategory:e,rootCategoryPath:t,newCategoryMode:a,showInputByDefault:r,canAddCategory:o,canDeleteCategory:n,canEditCategory:s,canCollapseAll:c,i18n:l,isCollapsedAll:h,maxDepth:g,getDisabledWarning:d,handleExpandCollapseAllClick:m,handleListOrderChange:y,handleSaveNewTitle:u,handleSaveNewCategory:p,isMoveValid:C}=this;return(0,i.h)(i.H,{key:"3a6c80d613c537c27a1d949d702132ee3dd7de80"},c&&(0,i.h)("calcite-button",{key:"943c0b1f8c6fd655c95a9e927e54f1b0face0938",iconStart:h?"chevron-down":"chevron-up",appearance:"outline-fill",kind:"neutral",onClick:m,class:"expand-collapse-all"},h?l.expandAll:l.collapseAll),(0,i.h)("arcgis-schema-editor-category",{key:"141b1ad5ab857ca1f8757b6759091c4ab4b5ede9",category:e,rootCategoryPath:t,newCategoryMode:a,showInputByDefault:r,canAddCategory:o,canDeleteCategory:n,canEditCategory:s,getDisabledWarning:d,i18n:l,maxDepth:g,isMoveValid:C,onListOrderChanged:e=>y(e.detail),onArcgisSchemaEditorInternalDeleteClick:e=>this.handleDeleteClick(e.detail),saveNewTitle:u,saveNewCategory:p,ref:e=>this.itemRef=e}))}get el(){return(0,i.a)(this)}static get watchers(){return{rootCategoryPath:["categorySchemaChangeHandler"],categorySchema:["categorySchemaChangeHandler"],categoryAggregationData:["categorySchemaChangeHandler"]}}};A.style=".expand-collapse-all{margin-bottom:1rem}";const D=class{constructor(e){(0,i.r)(this,e),this.arcgisSchemaEditorInternalDeleteClick=(0,i.c)(this,"arcgisSchemaEditorInternalDeleteClick",7),this.arcgisSchemaEditorInternalDragHandleInteract=(0,i.c)(this,"arcgisSchemaEditorInternalDragHandleInteract",7),this.listOrderChanged=(0,i.c)(this,"listOrderChanged",7),this.itemRefs={},this.isSpecialDepthState=null,this.isRoot=!1,this.SORTABLE_ANIMATION_TIME=200,this.reinitializeSortable=async()=>{await(0,s.t)(100),this.sortable&&(this.sortable.destroy(),this.sortable=null),this.initializeSortable()},this.handleHandleKeyboardEvent=async({event:e,category:t})=>{var a;const i=e.code;if(!["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(i))return;const r=t.path,{sortable:o,getParentSortable:n,category:c,SORTABLE_ANIMATION_TIME:l}=this,{category:h}=null!==(a=null==n?void 0:n())&&void 0!==a?a:{category:null},g=o.toArray(),d=g.indexOf(r);let m=!1,y=d;const u=c;let p=u;const C=t;switch(g.splice(d,1),i){case"ArrowDown":y=(d+1)%(g.length+1),g.splice(y,0,r);break;case"ArrowUp":y=d-1,y<0&&(y=g.length),g.splice(y,0,r);break;case"ArrowLeft":if(!h)return;m=!1,p=h,y=h.categories.findIndex((e=>e.path===c.path));break;case"ArrowRight":const e=c.categories,t=e.length;if(t<2)return;m=!1,y=(d+1)%t,p=e[y]}const v={fromCategory:u,toCategory:p,fromItemCategory:C,fromIndex:d,toIndex:y},f=!this.isMoveValid||this.isMoveValid(v);null!==f&&f&&(m&&(o.sort(g,!0),await(0,s.t)(l)),this.listOrderChanged.emit(v))},this.renderCategoryContainer=()=>{const{category:e,rootCategoryPath:t,canAddCategory:a,isRoot:n,isCollapsed:s,isAddingCategory:c,isBeingDragged:l,canEditCategory:h,saveNewTitle:g,saveNewCategory:d,maxDepth:m,i18n:y,isMoveValid:u,canDeleteCategory:p,newCategoryMode:C,isSpecialDepthState:v,isLastInList:f,handleHandleKeyboardEvent:w,getDisabledWarning:S}=this,b=e.path,I=e.categories,A=I.length,D=!c,T=c||"max-depth"===v||l||!a||s,x=s||l||T&&D,_=!(A>0)||"next-depth-max"===v,E="rtl"===(0,o.g)(this.el);return(0,i.h)("div",{class:{"arcgis-schema-editor-category__outer-category-container":!0,"arcgis-schema-editor-category__outer-category-container--rtl":E,"arcgis-schema-editor-category__outer-category-container--last-in-list":f,"arcgis-schema-editor-category__outer-category-container--first-level":"first-level"===v,"arcgis-schema-editor-category__outer-category-container--hidden":x,"arcgis-schema-editor-category__outer-category-container--root":n}},(0,i.h)("ul",{class:"arcgis-schema-editor-category__category-container",ref:e=>{this.dragContainerRef=e,this.sortable||this.initializeSortable()}},I.map(((e,r)=>{const o=e.path;return(0,i.h)("li",{class:"arcgis-schema-editor-category__row-container",key:o,"data-sortable-id":o},(0,i.h)("arcgis-schema-editor-category",{isLastInList:r===A-1,category:e,rootCategoryPath:t,newCategoryMode:C,canAddCategory:a,canDeleteCategory:p,canEditCategory:h,getDisabledWarning:S,i18n:y,maxDepth:m,isMoveValid:u,saveNewTitle:g,saveNewCategory:d,getParentSortable:()=>({sortable:this.sortable,category:this.category,getParentSortable:this.getParentSortable}),ref:e=>this.itemRefs[o]=e,onArcgisSchemaEditorInternalDragHandleInteract:e=>{e.stopPropagation(),w(e.detail)}}))}))),(0,i.h)("arcgis-schema-editor-category-row",{class:{"arcgis-schema-editor-category__new-category--hide":D},category:{categories:[],count:0,path:(0,r.b)(b,{title:"new-category"}),title:""},isCollapsible:!1,isCollapsed:!0,isNewCategory:!0,getDisabledWarning:S,canDeleteCategory:!1,canEditCategory:()=>!0,i18n:y,onArcgisSchemaEditorInternalCancelClick:()=>this.isAddingCategory=!1,saveNewTitle:async e=>{const t=await d(e);return t&&(this.isAddingCategory=!1),t},ref:e=>this.newCategoryRef=e}),(0,i.h)("div",{class:{"arcgis-schema-editor-category__add-category-btn":!0,"arcgis-schema-editor-category__add-category-btn--hide":T}},(0,i.h)("div",{class:{"arcgis-schema-editor-category__add-category-btn-divider":_,"arcgis-schema-editor-category__add-category-btn-divider--rtl":E&&_}}),(0,i.h)("calcite-button",{appearance:"transparent",kind:"neutral",onClick:()=>this.isAddingCategory=!0,iconStart:"plus-circle",id:this.addCategoryButtonId}),(0,i.h)("calcite-tooltip",{referenceElement:this.addCategoryButtonId},(0,i.h)("div",null,n?y.categoryItem.addCategory:y.categoryItem.addSubcategory))))},this.category=void 0,this.rootCategoryPath=void 0,this.canAddCategory=void 0,this.canDeleteCategory=void 0,this.newCategoryMode=void 0,this.showInputByDefault=!1,this.canEditCategory=void 0,this.maxDepth=void 0,this.i18n=void 0,this.isMoveValid=void 0,this.saveNewTitle=void 0,this.saveNewCategory=void 0,this.getParentSortable=void 0,this.getDisabledWarning=void 0,this.isLastInList=!1,this.isCollapsed=!1,this.isBeingDragged=!1,this.isAddingCategory=!1}componentWillLoad(){const e=this.category.path;this.isRoot=null===e;const t=d(e,this.rootCategoryPath);this.isSpecialDepthState=t>this.maxDepth&&!this.isRoot?"max-depth":t===this.maxDepth?"next-depth-max":1===t?"first-level":null,this.isCollapsed=this.newCategoryMode&&!this.isRoot;const a=(0,h.g)();this.addCategoryButtonId=`add-category-button-${a}`,window.addEventListener(g.C,this.reinitializeSortable)}disconnectedCallback(){window.removeEventListener(g.C,this.reinitializeSortable)}componentDidLoad(){this.onShowInputByDefaultChange(),this.initializeSortable()}initializeSortable(){!this.sortable&&this.dragContainerRef&&(this.sortable=l.S.create(this.dragContainerRef,{group:"arcgis-schema-editor",dataIdAttr:"data-sortable-id",animation:this.SORTABLE_ANIMATION_TIME,handle:`.${g.A}`,chosenClass:"arcgis-schema-editor-category-row--dragging",swapThreshold:.65,onSort:e=>{var t,a,i,r,o,n,s;const{from:c,to:l,oldIndex:h,newIndex:g,item:d}=e,m=()=>{c.insertBefore(d,c.children[h>g?h+1:h])},y=null===(t=c.closest("arcgis-schema-editor-category"))||void 0===t?void 0:t.category,u=null===(a=l.closest("arcgis-schema-editor-category"))||void 0===a?void 0:a.category;if(!u||!y)return void m();const p={fromCategory:y,toCategory:u,fromItemCategory:null===(i=d.querySelector("arcgis-schema-editor-category"))||void 0===i?void 0:i.category,fromIndex:h,toIndex:g},C=!this.isMoveValid||this.isMoveValid(p);if(null===C)return;if(!C)return void m();this.listOrderChanged.emit(p);(null!==(o=null===(r=y.path)||void 0===r?void 0:r.split("/").length)&&void 0!==o?o:0)!==(null!==(s=null===(n=u.path)||void 0===n?void 0:n.split("/").length)&&void 0!==s?s:0)&&1===y.categories.length&&d.remove()},setData:e=>{e.setData("foo","bar")}}))}onShowInputByDefaultChange(){this.isAddingCategory=this.newCategoryMode&&this.isRoot&&this.showInputByDefault}onIsAddingCategoryChange(){var e;null===(e=this.newCategoryRef)||void 0===e||e.reset()}async expandOrCollapseAll(e){this.isRoot||(this.isCollapsed=e),Object.values(this.itemRefs).forEach((t=>{null==t||t.expandOrCollapseAll(e)}))}async setIsBeingDragged(e){this.category.categories.length>0&&(this.isBeingDragged=e)}render(){const{category:e,canDeleteCategory:t,canEditCategory:a,isRoot:r,isCollapsed:o,i18n:n,renderCategoryContainer:s,saveNewTitle:c,isSpecialDepthState:l,arcgisSchemaEditorInternalDeleteClick:h,arcgisSchemaEditorInternalDragHandleInteract:g,getDisabledWarning:d}=this;return(0,i.h)(i.H,{key:"8266c17ce93239572ded554817a4353799c7c6c5"},!r&&(0,i.h)("arcgis-schema-editor-category-row",{key:"a68bcbe97c547c1279e7ea242d7fae27b255ce3f",category:e,isCollapsible:"max-depth"!==l,isCollapsed:o,canDeleteCategory:t,canEditCategory:e=>a({category:e,parentCategory:this.category}),getDisabledWarning:d,i18n:n,onArcgisSchemaEditorInternalDeleteClick:e=>{e.stopPropagation(),h.emit(e.detail)},onArcgisSchemaEditorInternalExpandClick:e=>this.isCollapsed=e.detail.isCollapsed,saveNewTitle:c,onArcgisSchemaEditorRowInternalDragHandleInteract:({detail:e})=>{g.emit(e)}}),s())}get el(){return(0,i.a)(this)}static get watchers(){return{showInputByDefault:["onShowInputByDefaultChange"],isAddingCategory:["onIsAddingCategoryChange"]}}};D.style=".arcgis-schema-editor-category__category-container{list-style-type:none;margin-top:0px;margin-bottom:0px;padding-inline-start:0px}.arcgis-schema-editor-category__outer-category-container{margin-top:0.5rem;padding-inline-start:1rem;padding-bottom:1rem;margin-inline-start:1rem;border-left:1px solid var(--calcite-color-border-2)}.arcgis-schema-editor-category__outer-category-container:not(:last-child){margin-bottom:1.5rem}.arcgis-schema-editor-category__outer-category-container--last-in-list{padding-bottom:0.5rem}.arcgis-schema-editor-category__outer-category-container--first-level{padding-bottom:1.5rem}.arcgis-schema-editor-category__outer-category-container--rtl{border-left:none;border-right:1px solid var(--calcite-color-border-2)}.arcgis-schema-editor-category__outer-category-container--root{margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;border-width:0px}.arcgis-schema-editor-category__outer-category-container--hidden{display:none}.arcgis-schema-editor-category__row-container:not(:last-child){margin-bottom:0.5rem}.arcgis-schema-editor-category__add-category-btn-divider{margin-inline-start:1rem;margin-top:0.5rem;height:0.75rem;border-left:1px solid var(--calcite-color-border-2)}.arcgis-schema-editor-category__add-category-btn-divider--rtl{border-left:none;border-right:1px solid var(--calcite-color-border-2)}.arcgis-schema-editor-category__add-category-btn--hide,.arcgis-schema-editor-category__new-category--hide{display:none}"},56274:(e,t,a)=>{a.d(t,{A:()=>i,C:()=>r});const i="arcgis-schema-editor-category-row__drag-handle",r="arcgisSchemaEditorReinitializeSortable"},80729:(e,t,a)=>{a.d(t,{a:()=>r,g:()=>i});const i=e=>e.match(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F700}-\u{1F77F}]|[\u{1F780}-\u{1F7FF}]|[\u{1F800}-\u{1F8FF}]|[\u{1F900}-\u{1F9FF}]|[\u{1FA00}-\u{1FA6F}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu),r=e=>{const t=o(e);if(t)return t;const a=i(e);return a||null},o=e=>e.match(/[<>\/]/g)},93814:(e,t,a)=>{a.d(t,{c:()=>i,e:()=>r});var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==a.g?a.g:"undefined"!=typeof self?self:{},r={exports:{}};(function(e){var t={Promise:"undefined"!=typeof window?window.Promise:void 0},a="4.24",i="next";function r(e){if(e.toLowerCase()===i)return i;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function o(e){return void 0===e&&(e=a),"https://js.arcgis.com/".concat(e,"/")}function n(e){void 0===e&&(e=a);var t=o(e),n=r(e);if(n!==i&&3===n.major){var s=n.minor<=10?"js/":"";return"".concat(t).concat(s,"esri/css/esri.css")}return"".concat(t,"esri/themes/light/main.css")}function s(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}function c(e,t){if(t){var a=document.querySelector(t);a.parentNode.insertBefore(e,a)}else document.head.appendChild(e)}function l(e){return document.querySelector('link[href*="'.concat(e,'"]'))}function h(e){return!e||r(e)?n(e):e}function g(e,t){var a=h(e),i=l(a);return i||c(i=s(a),t),i}var d={};function m(e){var t=document.createElement("script");return t.type="text/javascript",t.src=e,t.setAttribute("data-esri-loader","loading"),t}function y(e,t,a){var i;a&&(i=u(e,a));var r=function(){t(e),e.removeEventListener("load",r,!1),i&&e.removeEventListener("error",i,!1)};e.addEventListener("load",r,!1)}function u(e,t){var a=function(i){t(i.error||new Error("There was an error attempting to load ".concat(e.src))),e.removeEventListener("error",a,!1)};return e.addEventListener("error",a,!1),a}function p(e){void 0===e&&(e={}),d=e}function C(){return document.querySelector("script[data-esri-loader]")}function v(){var e=window.require;return e&&e.on}function f(e){void 0===e&&(e={});var a={};[d,e].forEach((function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}));var i=a.version,r=a.url||o(i);return new t.Promise((function(e,t){var o=C();if(o){var n=o.getAttribute("src");n!==r?t(new Error("The ArcGIS API for JavaScript is already loaded (".concat(n,")."))):v()?e(o):y(o,e,t)}else if(v())t(new Error("The ArcGIS API for JavaScript is already loaded."));else{var s=a.css;s&&g(!0===s?i:s,a.insertCssBefore),y(o=m(r),(function(){o.setAttribute("data-esri-loader","loaded"),e(o)}),t),document.body.appendChild(o)}}))}function w(e){return new t.Promise((function(t,a){var i=window.require.on("error",a);window.require(e,(function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];i.remove(),t(e)}))}))}function S(e,t){if(void 0===t&&(t={}),v())return w(e);var a=C(),i=a&&a.getAttribute("src");return!t.url&&i&&(t.url=i),f(t).then((function(){return w(e)}))}e.utils=t,e.loadModules=S,e.getScript=C,e.isLoaded=v,e.loadScript=f,e.setDefaultOptions=p,e.loadCss=g,Object.defineProperty(e,"__esModule",{value:!0})})(r.exports)}}]);