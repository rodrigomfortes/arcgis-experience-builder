/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-7ae27a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-7ae27a"],{20259:(e,r,t)=>{t.r(r),t.d(r,{arcgis_new_item_pages_tile_layer_from_existing:()=>m});var a=t(87849),n=t(90310),s=t(59317),i=t(87744),o=t(32710),l=t(49770),c=t(3826),d=t(95878),u=t(99654),y=t(33547);t(50637),t(931),t(93814),t(50822),t(83929),t(68194),t(37762),t(76246),t(63054),t(15912),t(24869),t(72257),t(86562),t(15332),t(50020),t(75294),t(38295),t(51102),t(56175),t(43555),t(11163),t(90079),t(31544);const m=class{constructor(e){(0,a.r)(this,e),this.newItemUpdatePage=(0,a.c)(this,"newItemUpdatePage",7),this.selectedItem=void 0,this.error=void 0,this.isProcessing=!1}async handleNext(){var e;if("3dTiles"===c.a.tileLayerPublishType)return;this.error=null;const{selectedItem:r}=this;if(!r)return(0,y.f)("No layer selected"),void(this.error="noLayerSelected");const{id:t,url:a,title:d}=r;try{const y=c.a.tileLayerPublishType;this.isProcessing=!0;const m=s.c.portal,[{layers:h,tables:p,serviceInfo:w},{total:g,relatedItems:v}]=await Promise.all([(0,o.v)({serviceUrl:a,restBaseUrl:(0,i.g)(m),forceAddToken:!0}),(0,n.c)(t,m,{relationshipType:"Service2Service"})]),{result:f}=await(0,l.f)({itemId:t,itemUrl:a,publishType:"vectorTiles"===c.a.tileLayerPublishType?"vector":"raster",portal:m,fullLayers:h});if(g>0&&("vectorTiles"===y&&v.some((e=>"Vector Tile Service"===e.type))||"tiles"===y&&v.some((e=>"Map Service"===e.type))))return void(this.error="tileLayerAlreadyExist");const b=e=>(null!=e?e:[]).some((e=>{var r,t;const{drawingInfo:a,fields:n,layerDefinition:s}=e,i=null==s?void 0:s.drawingInfo,o=null!==(r=null==i?void 0:i.renderer)&&void 0!==r?r:null==a?void 0:a.renderer;return o&&n?!(0,l.c)(o,e.geometryType,n)||(0,l.l)(e):null!==(t=(0,l.l)(e))&&void 0!==t&&t}));if(b(h)||b(f.layers))return void(this.error="badRenderer");const S=e=>(0,l.a)(e,!0);if(!h.some(S)||(null===(e=null==f?void 0:f.layers)||void 0===e?void 0:e.length)>0&&!f.layers.some(S))return void(this.error="badLayer");c.a.sourceTitle=d,(0,u.s)(r),c.a.tileAutoCreation=!m.isPortal,c.a.tileLayerBasemapType="standard",c.a.tileLayerBasemapUrl="",c.a.tileLayerFromFeatureLayer=!0,c.a.tileLayerLayers=h,c.a.tileLayerTables=p,c.a.tileLayerServiceInfo=w,c.a.tileLayerData=f,c.a.item=r,this.isProcessing=!1,this.newItemUpdatePage.emit("tileLayerSettings")}catch(e){console.error(e)}}onError(){this.isProcessing=!1}componentWillLoad(){c.a.serviceInfo=null,c.a.selectedServiceInfoLayersNames=null,this.i18n=d.u.i18n.tileLayerFromExisting}render(){var e,r;const{error:t,i18n:n,isProcessing:s}=this;return(0,a.h)(a.H,{key:"8ede1b92788d8af09c7360c8e5190638e9edf04d"},(0,a.h)("arcgis-new-item-loader",{key:"19437110b24b65a92d7e6489c35b2d5d9352e31e",active:s}),(0,a.h)("arcgis-new-item-feature-layer-browser",{key:"3791a88ae95081951181f3019883eb9a632802b4",itemBrowserBucket:["my"],onItemSelected:({detail:e})=>this.selectedItem=e,query:'type:"Feature Service" AND typekeywords:"Hosted Service" NOT typekeywords:"Spatiotemporal"'}),(0,a.h)("arcgis-new-item-alert",{key:"46176ad5d4c7d2aaef36f901a653a56dc107a1b8",heading:"badLayer"===t?n.error.tileLayerAlreadyExist.title:null===(e=n.error[t])||void 0===e?void 0:e.title,description:"badLayer"===t||null===(r=n.error[t])||void 0===r?void 0:r.description,active:null!=t,onAlertDismiss:()=>{this.error=null}}))}static get watchers(){return{error:["onError"]}}}},68194:(e,r,t)=>{t.d(r,{r:()=>s});var a=t(50637),n=t(59317);const s=async(e,r,t={})=>{const{body:s,usePost:i,addTokenManually:o,api:l=(null===n.c||void 0===n.c?void 0:n.c.api),customToken:c}=t,d=new URLSearchParams;s&&Object.entries(s).forEach((([e,r])=>{void 0!==r&&d.append(e,r)}));const u=new URL(e);if(u.searchParams.append("f","json"),c)u.searchParams.append("token",c);else{const e=!1===o?null:await(0,a.b)(r,l);e&&u.searchParams.append("token",e)}const y=await fetch(u.toString(),{body:i?d:void 0,method:i?"POST":"GET"}),m=await y.json(),h=m.error;if(h)throw"string"==typeof h?new Error(h):h;return m}},90310:(e,r,t)=>{t.d(r,{a:()=>f,b:()=>u,c:()=>y,d:()=>m,f:()=>d,g:()=>h,l:()=>b});var a=t(50637),n=t(80379),s=t(50822),i=t(931),o=t(87744),l=t(83929),c=t(68194);const d=async(e,r,t)=>{const{owningSystemUrl:n}=await(0,a.f)((async()=>(0,l.g)(e)),"portalInfo",e.id);return(await Promise.all(r.map((async e=>{try{const{owningSystemUrl:r}=await(0,l.a)(e,t);return{owningSystemUrl:r,url:e}}catch(r){return console.error(r),{owningSystemUrl:null,url:e}}})))).filter((({owningSystemUrl:e})=>e===n)).map((({url:e})=>e))},u=async(e,r)=>{var t;try{return{result:await(0,c.r)(e,r,{addTokenManually:!1})}}catch(e){const r="token required";return(null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase().includes(r))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}};async function y(e,r,t){var n;const{relationshipType:s,direction:i}=t,l=`${(0,o.g)(r)}content/items/${e}/relatedItems`,c=await(0,a.r)(l,{relationshipType:s,direction:i,includeRecycleBin:!0});return(null===(n=null==c?void 0:c.relatedItems)||void 0===n?void 0:n.length)&&(c.relatedItems=c.relatedItems.filter((r=>(null==r?void 0:r.id)!==e))),c}const m=async(e,r,t)=>{const n=!!t,s=(0,o.g)(r),i=n?`${s}/content/groups/${t.id}/search`:`${s}/search`;try{return{result:(await(0,a.r)(i,{filter:`id:(${e.join(" OR ")})`,num:100})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},h=async(e,r,t)=>{try{const n=[],s=[],i=[];await Promise.all(e.map((async e=>{const{result:o,error:c}=await(0,a.f)((()=>u(e,r)),"itemMetadata",`${e}--no-token`);if("tokenRequired"!==(null==c?void 0:c.code))if(p(o))n.push(w(o,e));else try{const r=await(0,l.a)(e,t);i.push(Object.assign(Object.assign({},o),{owningSystemUrl:r.owningSystemUrl}))}catch(c){console.warn(c)}else s.push(e)})));const o=await d(r,s,t),y=(await Promise.all(o.map((async e=>({response:await(0,c.r)(e,r,{addTokenManually:!0}),owningSystemUrl:(await(0,l.a)(e,t)).owningSystemUrl,url:e}))))).reduce(((e,{response:r,url:t,owningSystemUrl:a})=>p(r)?(n.push(w(r,t)),e):[...e,Object.assign(Object.assign({},r),{owningSystemUrl:a})]),[]),m=await Promise.all([...i,...y].map((async({serviceItemId:e,owningSystemUrl:r})=>{if(!e)return null;const{result:t}=await v({itemId:e,owningSystemUrl:r});return{item:t,owningSystemUrl:r}}))),{result:g}=n.length<=0?{result:[]}:await h(n,r,t);return{result:[...m.filter((e=>!!e)),...g]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},p=e=>!!(null==e?void 0:e.sources),w=(e,r)=>{var t;const a=null===(t=Object.values(e.sources)[0])||void 0===t?void 0:t.url;return a?a.includes("..")?(0,o.t)({url:r,path:a}):a:null},g=e=>`${e}/sharing/rest`,v=async({itemId:e,owningSystemUrl:r,requestOptions:t})=>{try{const n=(0,s.g)(e,g(r));return{result:await(0,a.r)(n,{},Object.assign(Object.assign({},t),{addTokenManually:!1}))}}catch(e){return console.error(e),(0,n.a)(e)&&e.message.toLocaleLowerCase().includes("invalid token")?{error:{code:"invalidToken"}}:{error:{code:"unhandledError"}}}},f=async({itemId:e,owningSystemUrl:r,requestOptions:t})=>{try{const n=`${(0,s.g)(e,g(r))}/data`;return{result:await(0,a.r)(n,{},Object.assign(Object.assign({},t),{addTokenManually:!1}))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},b=async(e,r)=>{try{const[t]=await(0,i.l)(["esri/portal/PortalItem"]),a=new t({id:e,portal:r});return await a.load(),{result:a}}catch(e){return console.error("Fail to reload item",e),{error:{code:"unhandledError"}}}}}}]);