/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--abcc4e.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--abcc4e"],{14528:(e,i,s)=>{function t(e){const i=[];l=e,queueMicrotask((()=>{l===e&&(l=void 0)}));const s=e.componentWillLoad;return e.componentWillLoad=async()=>{await Promise.all(i.map((e=>e()))).then((()=>{})),await(s?.call(e))},{onLoad:e=>i.push(e)}}let l;function a(){return l}s.d(i,{r:()=>a,u:()=>t})},69837:(e,i,s)=>{s.d(i,{a:()=>d,b:()=>f,c:()=>h,d:()=>y,g:()=>m,r:()=>n,s:()=>r,u:()=>o});const t={facilityLayer:{facilityIdField:"FACILITY_ID",siteIdField:"SITE_ID",nameField:"NAME"},levelLayer:{levelIdField:"LEVEL_ID",facilityIdField:"FACILITY_ID",longNameField:"NAME",shortNameField:"NAME_SHORT",levelNumberField:"LEVEL_NUMBER",verticalOrderField:"VERTICAL_ORDER"},siteLayer:{siteIdField:"SITE_ID",nameField:"NAME"}};let l;const a=e=>{const i=e?.map;return l=l||i?.floorInfo||{...t},l.siteLayer=l?.siteLayer?.layerId?l.siteLayer:null,l},r=e=>{const i=e?.map,s=a(e);i&&c(s)?i.set("floorInfo",s):n(e)},o=(e,i)=>{const s=a(i),{name:l}=e,o=e.layer;if(o){const e="sublayer"===o.type;s[l]={...t[l]},s[l]&&(s[l].layerId=e?o.layer?.id:o.id,s[l].sublayerId=e?o.id:void 0)}else s[l]=void 0;r(i)},n=e=>{const i=e?.map;i&&(i.floorInfo=null)},c=e=>!(!e?.facilityLayer?.layerId||!e?.levelLayer?.layerId||e?.siteLayer&&!e?.siteLayer.layerId),d=e=>{const i=t[e];return Object.values(i)},h=e=>{const{map:i}=e,s=i?.allLayers;let t=[];return s?.forEach((e=>{const{type:i,floorInfo:s}=e;"map-image"===i?t=t.concat(e.allSublayers.filter((e=>e.fieldsIndex&&!e?.floorInfo)).toArray()):!s&&["feature","oriented-imagery"].includes(i)&&t.push(e)})),t},f=async e=>{const{map:i}=e,s=i?.allLayers,t=s?.map((async e=>await g(e))).filter((e=>"failed"!==e?.loadStatus)),l=t?await Promise.all(t):[];let a=[];return l.forEach((e=>{const{type:i,geometryType:s}=e;"map-image"===i?a=a.concat(e.allSublayers.filter((e=>e.fieldsIndex&&"esriGeometryPolygon"===e.sourceJSON?.geometryType)).toArray()):"feature"===i&&"polygon"===s&&a.push(e)})),a},g=async e=>(void 0!==e.loadAll?await e.loadAll():await e.load(),e),m=(e,i)=>{const s=i.map,t=s?.allLayers,l=a(i),r=l?.[e]?.layerId,o=l?.[e]?.sublayerId;let n=r?t?.find((e=>e.id===r)):null;return"map-image"===n?.type&&(n=n.allSublayers.find((e=>e.id===o))),n},y=e=>{const{layer:i}=e;let s;if(s="arcgis-field-list"===e?.localName||"arcgis-map-config-floor-field-list"===e?.localName?e.selection.values().next().value:e?.field,s){const e=i.floorInfo||{};e.floorField=s.name,i.set("floorInfo",e)}}},97309:(e,i,s)=>{s.r(i),s.d(i,{arcgis_map_config_floor_add_layers:()=>r,arcgis_map_config_floor_add_layers_flow:()=>o,arcgis_map_config_floor_replace_field:()=>n,arcgis_map_config_floor_select_fields:()=>c});var t=s(11254),l=s(69837),a=s(14528);const r=class{constructor(e){(0,t.r)(this,e),this.arcgisListChange=(0,t.c)(this,"arcgisListChange",7),this.manager=(0,a.u)(this),this.layers=void 0,this.selection=new Map,this.strings=void 0,this.view=void 0}selectionChange(){this.arcgisListChange.emit(this.selection)}render(){return(0,t.h)("arcgis-map-config-floor-layer-list",{key:"49b62316aadc1065695fa1d5833c5879d7b0712d",layers:(0,l.c)(this.view),multiple:!0,strings:this.strings,onArcgisListChange:e=>this.selection=e.detail})}get el(){return(0,t.a)(this)}static get watchers(){return{selection:["selectionChange"]}}},o=class{constructor(e){(0,t.r)(this,e),this.arcgisDismiss=(0,t.c)(this,"arcgisDismiss",7),this.arcgisDone=(0,t.c)(this,"arcgisDone",7),this.manager=(0,a.u)(this),this.layersForFieldSelect=[],this.layers=void 0,this.mode="add-layer",this.selectedLayers=void 0,this.strings=void 0,this.view=void 0,this.fieldSelect=!1}render(){return(0,t.h)("calcite-flow",{key:"677936254d38f59dfc35302e8db0ad77c47e726b"},"add-layer"===this.mode&&this.renderAddLayersPanel(),"replace-field"===this.mode&&this.renderReplaceFieldsPanel())}renderAddLayersPanel(){return(0,t.h)(t.F,null,(0,t.h)("calcite-flow-item",{heading:this.strings.addLayers,closable:!0,closed:!1,selected:"add-layer"===this.mode&&!this.fieldSelect,onCalciteFlowItemClose:e=>this.dismiss(e)},(0,t.h)("arcgis-map-config-floor-add-layers",{class:"content",layers:this.layers,view:this.view,strings:this.strings,onArcgisListChange:e=>{this.nextButtonNode&&(this.nextButtonNode.disabled=!e.detail?.length),this.layersForFieldSelect=Array.from(e.currentTarget.selection.values())}}),(0,t.h)("calcite-button",{slot:"footer",label:this.strings.cancel,width:"half",appearance:"outline-fill",onClick:e=>this.dismiss(e)},this.strings.cancel),(0,t.h)("calcite-button",{slot:"footer",label:this.strings.next,width:"half",appearance:"solid",disabled:!0,onClick:()=>{this.fieldSelect=!0},ref:e=>{e&&(this.nextButtonNode=e)}},this.strings.next)),this.renderSelectFieldsPanel())}renderReplaceFieldsPanel(){const e=this.layers[0];return(0,t.h)("calcite-flow-item",{heading:e.title||void 0,description:this.strings.replaceFloorField,closable:!0,closed:!1,selected:"replace-field"===this.mode,onCalciteFlowItemClose:e=>this.dismiss(e)},(0,t.h)("arcgis-map-config-floor-replace-field",{class:"content",view:this.view,layer:e,strings:this.strings,ref:e=>{e&&(this.replaceFieldPanelNode=e)}}),(0,t.h)("calcite-button",{slot:"footer",appearance:"solid",label:this.strings.replace,width:"full",onClick:async e=>{await this.replaceFieldPanelNode.commit(),this.done(e)}},this.strings.replace))}renderSelectFieldsPanel(){return(0,t.h)("calcite-flow-item",{closable:!0,selected:this.fieldSelect,heading:this.strings.selectFloorField,onCalciteFlowItemBack:()=>this.fieldSelect=!1},(0,t.h)("arcgis-map-config-floor-select-fields",{class:"content",layers:this.layersForFieldSelect,view:this.view,strings:this.strings,ref:e=>{e&&(this.selectFieldsPanelNode=e)}}),(0,t.h)("calcite-button",{slot:"footer",label:this.strings.cancel,appearance:"outline-fill",width:"half",onClick:e=>this.dismiss(e)},this.strings.cancel),(0,t.h)("calcite-button",{slot:"footer",label:this.strings.add,width:"half",appearance:"solid",onClick:async e=>{await(this.selectFieldsPanelNode?.commit()),this.done(e)}},this.strings.add))}done(e){e.stopPropagation(),this.arcgisDone.emit()}dismiss(e){e.stopPropagation(),this.arcgisDismiss.emit()}get el(){return(0,t.a)(this)}};o.style=".content{width:20vw;max-width:420px;min-width:240px;max-height:40vh}";const n=class{constructor(e){(0,t.r)(this,e),this.manager=(0,a.u)(this),this.layer=void 0,this.strings=void 0,this.view=void 0}async commit(){(this.el.shadowRoot?Array.from(this.el.shadowRoot.querySelectorAll("arcgis-map-config-floor-field-list")):[]).map((e=>(0,l.d)(e)))}render(){const e=this.layer;if(!e.floorInfo)return(0,t.h)(t.F,null);const i=this.findField(e.floorInfo.floorField);if(!i)return(0,t.h)(t.F,null);const s=new Map;return s.set(i.name,i),(0,t.h)("arcgis-map-config-floor-field-list",{strings:this.strings,layer:e,selection:s})}findField(e){return this.layer.fieldsIndex.get(e)}get el(){return(0,t.a)(this)}},c=class{constructor(e){(0,t.r)(this,e),this.manager=(0,a.u)(this),this.layers=void 0,this.strings=void 0,this.view=void 0}async commit(){(this.el.shadowRoot?Array.from(this.el.shadowRoot.querySelectorAll("arcgis-map-config-floor-field-select")):[]).forEach((e=>(0,l.d)(e)))}render(){const{layers:e}=this;return(0,t.h)("div",{key:"a6a4289f39d2ef2d750ce19cda0c40a936116208",class:"select-field-panel"},(0,t.h)("calcite-label",{key:"f6bcd3af1322f1e819fb747a24ed0ce71b1eefe2",class:"select-message"},this.strings.selectMessage),e.map((e=>this.renderSelect(e))))}renderSelect(e){return(0,t.h)("arcgis-map-config-floor-field-select",{layer:e})}get el(){return(0,t.a)(this)}};c.style=".select-field-panel{padding:12px;background-color:white}.select-message{margin:14px 0}"}}]);