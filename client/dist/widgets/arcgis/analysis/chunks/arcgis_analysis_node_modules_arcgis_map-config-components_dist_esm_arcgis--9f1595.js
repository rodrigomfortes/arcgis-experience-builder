/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--9f1595.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--9f1595"],{10465:(e,t,a)=>{a.d(t,{D:()=>r,a:()=>g,b:()=>o,c:()=>l,g:()=>b,s:()=>v});class r{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}const s=(e,t,a)=>(0,n(t).subscribe)((t=>{const r=t.some((t=>((e,t)=>{let a=e;for(;a;){if(a===t)return!0;if(!a.parentNode)return!1;a=a.parentNode instanceof ShadowRoot?a.parentNode.host:a.parentNode}return!1})(e,t.target)));r&&a()})),i={},n=e=>{const t=e.join(","),a=i[t];if(void 0!==a)return a;const r=new Set,s=new MutationObserver((e=>r.forEach((t=>t(e)))));globalThis.document&&s.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const n={subscribe:e=>(r.add(e),()=>{r.delete(e),0===r.size&&(s.disconnect(),i[t]=void 0)})};return i[t]=n,n},l=(e,t)=>{let a=e;for(;a;){const e=a.closest?.(t);if(e)return e;const r=a.getRootNode?.();if(r===globalThis.document)return null;a=r.host}return null},o=e=>c(e,"dir","ltr"),c=(e,t,a)=>{const r=l(e,`[${t}]`);return r?.getAttribute(t)??a},d=e=>{let t="";for(let a=0;a<e;a++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},g=()=>[d(2),d(1),d(1),d(1),d(3)].join("-"),u="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),h=new Set(u),f="en",y={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},m={},p=async(e,t)=>{const a=`${t}${e}.json`;try{const e=await fetch(a);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===f?{}:await p(f,t)},b=e=>{const t=c(e,"lang",globalThis.navigator?.language||f);return{lang:t,t9nLocale:L(t)}},L=e=>{const[t,a]=e.split("-"),r=t.toLowerCase();let s=r;return a&&(s=`${r}-${a.toUpperCase()}`),s=y[s]??s,h.has(s)?s:a?L(r):f},v=(e,t,a,r)=>{let i;const n=()=>I(e,t(),r).then((e=>{i?.lang===e.lang&&i.t9nLocale===e.t9nLocale&&i.t9nStrings===e.t9nStrings||a(e),i=e})).catch(console.error);return queueMicrotask(n),s(e,["lang"],n)},I=async(e,t,a=e.localName.split("-").slice(1).join("-"))=>{const{lang:r,t9nLocale:s}=b(e),i=`${t}/${a}/t9n`,n=null===a?{}:await(async(e,t,a="")=>{const r=`${t}/${a}`,s=`${r}${e}.json`;return m[s]??(m[s]=p(e,r)),await m[s]})(s,i,"messages.");return{lang:r,t9nLocale:s,t9nStrings:n}}},69837:(e,t,a)=>{a.d(t,{a:()=>d,b:()=>u,c:()=>g,d:()=>y,g:()=>f,r:()=>o,s:()=>n,u:()=>l});const r={facilityLayer:{facilityIdField:"FACILITY_ID",siteIdField:"SITE_ID",nameField:"NAME"},levelLayer:{levelIdField:"LEVEL_ID",facilityIdField:"FACILITY_ID",longNameField:"NAME",shortNameField:"NAME_SHORT",levelNumberField:"LEVEL_NUMBER",verticalOrderField:"VERTICAL_ORDER"},siteLayer:{siteIdField:"SITE_ID",nameField:"NAME"}};let s;const i=e=>{const t=e?.map;return s=s||t?.floorInfo||{...r},s.siteLayer=s?.siteLayer?.layerId?s.siteLayer:null,s},n=e=>{const t=e?.map,a=i(e);t&&c(a)?t.set("floorInfo",a):o(e)},l=(e,t)=>{const a=i(t),{name:s}=e,l=e.layer;if(l){const e="sublayer"===l.type;a[s]={...r[s]},a[s]&&(a[s].layerId=e?l.layer?.id:l.id,a[s].sublayerId=e?l.id:void 0)}else a[s]=void 0;n(t)},o=e=>{const t=e?.map;t&&(t.floorInfo=null)},c=e=>!(!e?.facilityLayer?.layerId||!e?.levelLayer?.layerId||e?.siteLayer&&!e?.siteLayer.layerId),d=e=>{const t=r[e];return Object.values(t)},g=e=>{const{map:t}=e,a=t?.allLayers;let r=[];return a?.forEach((e=>{const{type:t,floorInfo:a}=e;"map-image"===t?r=r.concat(e.allSublayers.filter((e=>e.fieldsIndex&&!e?.floorInfo)).toArray()):!a&&["feature","oriented-imagery"].includes(t)&&r.push(e)})),r},u=async e=>{const{map:t}=e,a=t?.allLayers,r=a?.map((async e=>await h(e))).filter((e=>"failed"!==e?.loadStatus)),s=r?await Promise.all(r):[];let i=[];return s.forEach((e=>{const{type:t,geometryType:a}=e;"map-image"===t?i=i.concat(e.allSublayers.filter((e=>e.fieldsIndex&&"esriGeometryPolygon"===e.sourceJSON?.geometryType)).toArray()):"feature"===t&&"polygon"===a&&i.push(e)})),i},h=async e=>(void 0!==e.loadAll?await e.loadAll():await e.load(),e),f=(e,t)=>{const a=t.map,r=a?.allLayers,s=i(t),n=s?.[e]?.layerId,l=s?.[e]?.sublayerId;let o=n?r?.find((e=>e.id===n)):null;return"map-image"===o?.type&&(o=o.allSublayers.find((e=>e.id===l))),o},y=e=>{const{layer:t}=e;let a;if(a="arcgis-field-list"===e?.localName||"arcgis-map-config-floor-field-list"===e?.localName?e.selection.values().next().value:e?.field,a){const e=t.floorInfo||{};e.floorField=a.name,t.set("floorInfo",e)}}},71313:(e,t,a)=>{a.r(t),a.d(t,{arcgis_map_config_floor:()=>o});var r=a(11254),s=a(14528),i=a(84260),n=a(69837),l=a(69811);a(10465);const o=class{constructor(e){(0,r.r)(this,e),this.arcgisChange=(0,r.c)(this,"arcgisChange",7),this.manager=(0,s.u)(this),this.strings=(0,i.u)({blocking:!0}),this.closedOnLoad=!1,this.disabled=!1,this.layer=void 0,this.view=void 0}async componentWillLoad(){this.reactiveUtils=await(0,l.l)(),this.disabled=this.disabled||await this.getDisabled()}render(){const{closedOnLoad:e,strings:t,disabled:a}=this;return(0,r.h)(r.H,{key:"eae49904ce76afc9187f8228af875027c19fbf05"},(0,r.h)("calcite-block",{key:"996dadd92735233c9f63c13ba0475a900a430c5f",class:"container",heading:t.heading,collapsible:!0,disabled:a,expanded:!e&&!a},this.renderFloorInfo()))}renderFloorInfo(){const{strings:e,view:t}=this,a=t.map,s=!!a?.floorInfo;return(0,r.h)("calcite-block-section",{text:e.enable,expanded:s,"toggle-display":"switch",onCalciteBlockSectionToggle:e=>e.currentTarget.open?this.addMapFloorInfo():this.removeFloorInfo()},(0,r.h)("calcite-label",{class:"layer-select-message"},e.summary),this.renderLayerPicker("siteLayer"),this.renderLayerPicker("facilityLayer"),this.renderLayerPicker("levelLayer"),this.renderAdditionalLayers())}renderLayerPicker(e){const t=(0,n.g)(e,this.view),a=(0,n.a)(e);return(0,r.h)("arcgis-map-config-floor-layer-picker",{view:this.view,label:this.strings[e],selectedLayer:t,requiredFields:a,strings:this.strings,onArcgisListChange:t=>this.updateFloorInfo({layer:t?.detail?t?.detail[0]:null,name:e})})}renderAdditionalLayers(){return(0,r.h)("calcite-block-section",{text:this.strings.additionalLayers,expanded:!0},(0,r.h)("arcgis-map-config-floor-additional-layers",{view:this.view,strings:this.strings,onArcgisDisable:e=>this.disableContainer(e)}))}addMapFloorInfo(){(0,n.s)(this.view),this.arcgisChange.emit()}disableContainer(e){const{detail:t}=e,a=this.el.closest("calcite-flow-item");a&&(a.disabled=t)}async getDisabled(){const e=this.view;await(this.reactiveUtils?.whenOnce((()=>e.allLayerViews.every((e=>!e.updating)))));const t=await(0,n.b)(e),a=["facilityLayer","levelLayer"].filter((e=>t.filter((t=>this.hasRequiredFields(t,(0,n.a)(e))))?.length));return!a?.length}hasRequiredFields(e,t){if(e){const{fieldsIndex:a}=e;return a&&t.every((e=>!!a.get(e)))||!1}return!1}removeFloorInfo(){(0,n.r)(this.view),this.arcgisChange.emit()}updateFloorInfo(e){(0,n.u)(e,this.view),this.arcgisChange.emit()}static get assetsDirs(){return["assets"]}get el(){return(0,r.a)(this)}};o.style=".layer-select-message{margin:14px 0}"},84260:(e,t,a)=>{a.d(t,{u:()=>n});var r=a(11254),s=a(10465),i=a(14528);function n({propertyName:e="strings",name:t}){let a=(0,i.r)();const n=(0,s.g)(a.el),o=new s.D,c={_lang:n.lang,_t9nLocale:n.t9nLocale};a.manager.onLoad((()=>o.promise));const d=new WeakRef(a);function g(){const e=d.deref();return e||h?.(),e}a=void 0;const u=l((()=>g()?.el)),h=(0,s.s)(u,(()=>(0,r.g)("./assets")),(({t9nLocale:t,t9nStrings:a,lang:r})=>{const s=g();if(!s)return;s[e]={...a,_lang:r,_t9nLocale:t},o.resolve()}),t);return c}const l=e=>new Proxy({},{get(t,a){const r=e();if(!r)return;const s=Reflect.get(r,a,r);return"function"==typeof s?s.bind(r):s}})}}]);