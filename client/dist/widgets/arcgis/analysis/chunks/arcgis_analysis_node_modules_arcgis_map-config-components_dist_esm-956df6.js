/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-956df6.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-956df6"],{10465:(e,t,i)=>{i.d(t,{D:()=>s,a:()=>h,b:()=>a,c:()=>l,g:()=>v,s:()=>C});class s{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}const n=(e,t,i)=>(0,r(t).subscribe)((t=>{const s=t.some((t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target)));s&&i()})),o={},r=e=>{const t=e.join(","),i=o[t];if(void 0!==i)return i;const s=new Set,n=new MutationObserver((e=>s.forEach((t=>t(e)))));globalThis.document&&n.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const r={subscribe:e=>(s.add(e),()=>{s.delete(e),0===s.size&&(n.disconnect(),o[t]=void 0)})};return o[t]=r,r},l=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const s=i.getRootNode?.();if(s===globalThis.document)return null;i=s.host}return null},a=e=>c(e,"dir","ltr"),c=(e,t,i)=>{const s=l(e,`[${t}]`);return s?.getAttribute(t)??i},d=e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},h=()=>[d(2),d(1),d(1),d(1),d(3)].join("-"),g="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),u=new Set(g),p="en",b={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},m={},f=async(e,t)=>{const i=`${t}${e}.json`;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===p?{}:await f(p,t)},v=e=>{const t=c(e,"lang",globalThis.navigator?.language||p);return{lang:t,t9nLocale:y(t)}},y=e=>{const[t,i]=e.split("-"),s=t.toLowerCase();let n=s;return i&&(n=`${s}-${i.toUpperCase()}`),n=b[n]??n,u.has(n)?n:i?y(s):p},C=(e,t,i,s)=>{let o;const r=()=>k(e,t(),s).then((e=>{o?.lang===e.lang&&o.t9nLocale===e.t9nLocale&&o.t9nStrings===e.t9nStrings||i(e),o=e})).catch(console.error);return queueMicrotask(r),n(e,["lang"],r)},k=async(e,t,i=e.localName.split("-").slice(1).join("-"))=>{const{lang:s,t9nLocale:n}=v(e),o=`${t}/${i}/t9n`,r=null===i?{}:await(async(e,t,i="")=>{const s=`${t}/${i}`,n=`${s}${e}.json`;return m[n]??(m[n]=f(e,s)),await m[n]})(n,o,"messages.");return{lang:s,t9nLocale:n,t9nStrings:r}}},36239:(e,t,i)=>{i.d(t,{A:()=>c,a:()=>a,b:()=>o,c:()=>r,d:()=>s,e:()=>n,f:()=>l,g:()=>d,h:()=>g,i:()=>h});const s=9,n=90,o=37.5,r=9,l=90,a=37.5;var c;function d(e){const t=e.featureReduction;if(t)return"binning"===t.type?"binning":"cluster"===t.type?function(e){const t=e.featureReduction;return!!t.renderer&&"pie-chart"===t.renderer.type&&!t?.renderer?.authoringInfo?.isAutoGenerated}(e)?"pie-chart":"cluster":void 0}function h(e){const t=e.featureReduction;return!t?.renderer||!!t?.renderer?.authoringInfo?.isAutoGenerated}function g(e,t){switch(e){case"sum":return t.fields.sum;case"avg":return t.fields.mean;case"min":return t.fields.min;case"max":return t.fields.max;case"stddev":return t.fields.stdDev;case"mode":return t.fields.mode;case"var":return t.fields.var;case"count":return t.fields.count;default:return""}}!function(e){e.CLUSTERING="clustering",e.CHART_CLUSTERING="chartClustering",e.BINNING="binning"}(c||(c={}))},53127:(e,t,i)=>{i.d(t,{a:()=>n,d:()=>s,t:()=>o});const s=(e,t)=>{let i,s="idle";const n=async(...n)=>await new Promise((o=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),o(e(...n))):o(null);break;case"invoked":clearTimeout(i),s="idle",o(e(...n));break;case"cancelled":clearTimeout(i),s="idle",o(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>{s="idle",o(e(...n))}),t)}}));return n.flush=async function(...e){return s="flushed",await n(...e)},n.invoke=async function(...e){return s="invoked",await n(...e)},n.cancel=async function(...e){return s="cancelled",await n(...e)},n.getStatus=function(){return s},n},n=(e,t)=>{let i;return async(...s)=>await new Promise((n=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,n(e(...s))}),t))}))};function o(e){return new Promise((t=>setTimeout(t,e)))}},56255:(e,t,i)=>{function s(e){return["simple-fill","simple-marker","simple-line","picture-marker","cim"].includes(e.type)}function n(e,t){return"picture-marker"===e.type||"cim"===e.type&&!function(e,t){const{cimSymbolUtils:i}=t;return!!i.getCIMSymbolColor(e)}(e,t)}function o(e){const{SimpleLineSymbol:t,SimpleMarkerSymbol:i,Color:s}=e;return new i({style:"circle",size:6.75,outline:new t({style:"solid",color:new s([92,92,92,64]),width:1}),color:new s([227,139,79,255])})}function r(e){return"picture-marker"!==e.type&&("cim"!==e.type&&!!e.outline?.color)}function l(e,t){const{cimSymbolUtils:i,Color:s}=t;return"cim"===e?.type?s.fromJSON(i.getCIMSymbolColor(e)?.toJSON()):"simple-marker"===e?.type&&["x","cross"].includes(e?.style)?e?.outline?.color:e?.color}function a(e,t){const{cimSymbolUtils:i}=t;return"cim"===e.type?i.getCIMSymbolSize(e):e.size?e.size:e.width}function c(e,t){return e.a=t,e}i.d(t,{a:()=>n,b:()=>l,c:()=>c,d:()=>a,g:()=>o,h:()=>r,i:()=>s})},96151:(e,t,i)=>{i.r(t),i.d(t,{arcgis_aggregation_binning:()=>g,arcgis_aggregation_clustering:()=>u,arcgis_aggregation_tile:()=>p});var s=i(11254),n=i(69811),o=i(10465),r=i(56612),l=i(53127),a=i(14528),c=i(17840),d=i(36239),h=i(56255);const g=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcgisBackClick=(0,s.c)(this,"arcgisBackClick",7),this.arcgisStyleBtnClick=(0,s.c)(this,"arcgisStyleBtnClick",7),this.arcgisStyleBtnBackClick=(0,s.c)(this,"arcgisStyleBtnBackClick",7),this.manager=(0,a.u)(this),this.onBinSizeChange=(0,l.d)((async e=>{const{layer:t,view:i,modules:s}=this,{colorCreator:n,AggregateField:o,rendererUtils:r}=s;t.featureReduction.fixedBinLevel=e;try{const e=await r.regenerateRenderer({layer:t,view:i,forBinning:!0});e&&(t.featureReduction.renderer=e)}catch{let e=t.featureReduction.fields.find((e=>"count"===e.statisticType));e||(e=new o({name:"aggregateCount",onStatisticField:void 0,alias:"aggregateCount",statisticType:"count",visible:!0}),t.featureReduction.fields.push(e));const s=await n.createContinuousRenderer({layer:t,view:i,field:e.name,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,defaultSymbolEnabled:!1,forBinning:!0});t.featureReduction.renderer=s.renderer}this.handleBinningChange()}),300),this.view=void 0,this.layer=void 0,this.portal=void 0,this.config=void 0,this.strings=void 0,this.flowNode=void 0,this.hideLayerTitle=!1,this.symbolStylerConfig={},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){this.flowItemNode?.setFocus()}async componentWillLoad(){const[e,t,i,s]=await Promise.all([(0,n.e)(),(0,n.h)(),(0,n.l)(),(0,n.ay)()]);this.modules={AggregateField:e,colorCreator:t,reactiveUtils:i,rendererUtils:s}}async componentDidLoad(){this.flowItemNode?.setFocus();const{modules:e,view:t,layer:i}=this,s=t;e.reactiveUtils.watch((()=>[i.featureReduction?.maxScale,s.scale]),(()=>{const e=i.featureReduction;e&&(s.scale<=e.maxScale&&!this.styleDivNode.classList.contains("btn-disabled")?(this.styleDivNode.classList.add("btn-disabled"),this.styleBtnNode.disabled=!0):s.scale>e.maxScale&&this.styleDivNode.classList.contains("btn-disabled")&&(this.styleDivNode.classList.remove("btn-disabled"),this.styleBtnNode.disabled=!1))}))}render(){const{layer:e,strings:t,hideLayerTitle:i}=this;return(0,s.h)(s.H,{key:"a1fd9f999f19714d92cf0d179270f6190d961a59",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"c731fe928357926762a2b87355e91e9609278b0b",heading:t.binning,description:i?void 0:e.title??void 0,selected:this.selected,showBackButton:!0,onCalciteFlowItemBack:()=>this.arcgisBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderBinSize(),this.renderScaleThresholdSlider(),this.renderFieldsBtn(),this.renderLabelBtn(),this.renderPopupBtn(),this.renderStyleBtn()))}renderBinSize(){const{layer:e,strings:t}=this,i="rtl"===(0,o.b)(this.el),n=e.featureReduction;return(0,s.h)("div",{class:"slider-title-wrapper"},(0,s.h)("calcite-label",{class:"slider-heading",layout:"inline"},t.bin.binSizeTitle),(0,s.h)("div",{class:"slider-div"},(0,s.h)("label",{class:"slider-label"},i?t.bin.large:t.bin.small),(0,s.h)("calcite-slider",{class:"slider-slider",min:1,max:9,value:10-(n.fixedBinLevel??3),step:1,minLabel:t.bin.binSizeTitle,onCalciteSliderInput:e=>{const t=e.target;this.onBinSizeChange(10-t.value)}}),(0,s.h)("label",{class:"slider-label"},i?t.bin.small:t.bin.large)))}renderScaleThresholdSlider(){const{layer:e,view:t,portal:i,strings:n}=this;return(0,s.h)("arcgis-aggregation-scale-threshold-slider",{view:t,portal:i,layer:e,strings:n})}renderFieldsBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,s.h)("div",{class:"btn-section"},(0,s.h)("button",{class:"btn",onClick:e=>{e.stopPropagation(),this.addFieldsPanel()},ref:e=>this.fieldsButtonNode=e},(0,s.h)("span",{class:"btn-text"},e.bin.editAttributes),(0,s.h)("span",{class:"btn-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderLabelBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,s.h)("div",{class:"btn-section"},(0,s.h)("button",{class:"btn",onClick:e=>{e.stopPropagation(),this.addLabelPanel()},ref:e=>this.labelsButtonNode=e},(0,s.h)("span",{class:"btn-text"},e.bin.editLabel),(0,s.h)("span",{class:"btn-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderPopupBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,s.h)("div",{class:"btn-section"},(0,s.h)("button",{class:"btn",onClick:e=>{e.stopPropagation(),this.addPopupPanel()},ref:e=>this.popupButtonNode=e},(0,s.h)("span",{class:"btn-text"},e.bin.editPopups),(0,s.h)("span",{class:"btn-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderStyleBtn(){const{layer:e,view:t,strings:i}=this,n="rtl"===(0,o.b)(this.el),r=t,l=e.featureReduction,a=r.scale<=l.maxScale;return(0,s.h)("div",{class:"btn-section "+(a?"btn-disabled":""),ref:e=>this.styleDivNode=e},(0,s.h)("button",{class:"btn",disabled:a,onClick:e=>{e.stopPropagation(),this.addStylePanel()},ref:e=>this.styleBtnNode=e},(0,s.h)("span",{class:"btn-text"},i.bin.editStyle),(0,s.h)("span",{class:"btn-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:n?"chevron-left":"chevron-right"}))))}addFieldsPanel(){const{layer:e,view:t,portal:i,strings:n,flowNode:o,hideLayerTitle:r}=this,l=document.createElement("arcgis-aggregation-fields");l.layer=e,l.mapView=t,l.portal=i,l.strings=n,l.hideLayerTitle=r??!1,l.flowNode=o,l.showBackButton=!0,l.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleBinningChange(),(0,s.f)(this.el)})),l.addEventListener("arcgisBackClick",(()=>{o.removeChild(l),this.selected=!0,setTimeout((()=>this.fieldsButtonNode?.focus()),300)})),o.appendChild(l),o.childNodes.forEach((e=>e.selected=!1)),l.selected=!0,this.selected=!1}addLabelPanel(){const{layer:e,view:t,portal:i,strings:n,flowNode:o,hideLayerTitle:l}=this,a=document.createElement("calcite-flow-item");a.heading=n.bin.labelBinFeaturesHeading,l||(a.description=e.title);const c=document.createElement("arcgis-map-config-label");c.layer=e,c.mapView=t,c.portal=i,c.layerDisplayType=r.l.cluster,c.calciteFlowProps={calciteFlowItem:a},c.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleBinningChange(),(0,s.f)(this.el)})),a.appendChild(c),a.addEventListener("calciteFlowItemBack",(()=>{o.removeChild(a),this.selected=!0,setTimeout((()=>this.labelsButtonNode?.focus()),300)})),o.appendChild(a),a.selected=!0,this.selected=!1,a.setFocus()}addPopupPanel(){const{layer:e,view:t,portal:i,config:n,strings:o,flowNode:l,hideLayerTitle:a}=this,c=document.createElement("calcite-flow-item");c.heading=o.bin.binPopupsHeading,a||(c.description=e.title);const d=document.createElement("arcgis-map-config-popup");d.layer=e,d.mapView=t,d.portal=i,d.config=n,d.layerDisplayType=r.l.cluster,d.calciteFlowProps={calciteFlow:l,calciteFlowItem:c},d.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleBinningChange(),(0,s.f)(this.el)})),c.appendChild(d),c.addEventListener("calciteFlowItemBack",(()=>{l.removeChild(c),this.selected=!0,setTimeout((()=>this.popupButtonNode?.focus()),300)})),l.appendChild(c),c.setFocus(),c.selected=!0,this.selected=!1,c.setFocus()}addStylePanel(){const{layer:e,view:t,portal:i,config:s,flowNode:n,symbolStylerConfig:o}=this,r=document.createElement("arcgis-smart-mapping");r.portal=i,r.layer=e,r.mapView=t,r.config=s,r.hideLayerTitle=!0,r.useFeatureReduction=!0,r.symbolStylerConfig=o,r.addEventListener("arcgisClose",(e=>{e.stopPropagation();const t=e.detail;this.selected=!0,r.parentElement?.removeChild(r),this.arcgisStyleBtnBackClick.emit(t),setTimeout((()=>this.styleBtnNode?.focus()),300)})),r.addEventListener("arcgisBeforeBack",(({detail:e})=>{this.arcgisStyleBtnBackClick.emit(e)})),n.appendChild(r),r.selected=!0,this.selected=!1,r.setFocus(),this.arcgisStyleBtnClick.emit()}handleBinningChange(){const{layer:e}=this,t=e.featureReduction;e.featureReduction=t.clone(),this.arcgisChange.emit()}get el(){return(0,s.a)(this)}};g.style=".sc-arcgis-aggregation-binning-h{display:none}[selected].sc-arcgis-aggregation-binning-h{display:flex}.block-section.sc-arcgis-aggregation-binning{padding:0 10px}.block-content.sc-arcgis-aggregation-binning{padding-top:10px}.slider-title-wrapper.sc-arcgis-aggregation-binning{background-color:var(--calcite-color-foreground-1);border-bottom:1px solid var(--calcite-color-foreground-3);padding:var(--calcite-spacing-lg)}.slider-div.sc-arcgis-aggregation-binning{display:flex;align-items:center;justify-content:space-between;flex-flow:row wrap}.slider-heading.sc-arcgis-aggregation-binning{display:inline-block;padding:var(--calcite-spacing-sm) 0}.slider-label.sc-arcgis-aggregation-binning{display:inline-block;order:2}.slider-slider.sc-arcgis-aggregation-binning{display:inline-block;width:100%;order:1}.btn-section.sc-arcgis-aggregation-binning{background-color:var(--calcite-color-foreground-1)}.btn.sc-arcgis-aggregation-binning{background:var(--calcite-color-transparent);border:none;border-bottom:solid 1px var(--calcite-color-foreground-3);display:flex;align-items:center;justify-content:space-between;padding:var(--calcite-spacing-lg) var(--calcite-spacing-lg);cursor:pointer;width:100%}.btn.sc-arcgis-aggregation-binning:hover{background-color:var(--calcite-color-foreground-3);border-color:var(--calcite-color-border-3)}.btn-disabled.sc-arcgis-aggregation-binning{opacity:var(--calcite-opacity-disabled)}.btn.sc-arcgis-aggregation-binning:focus{outline:none;border:2px solid var(--calcite-color-brand)}.btn-text.sc-arcgis-aggregation-binning{font-family:var(--calcite-font-family);font-size:var(--calcite-font-size)}.style-button-div.sc-arcgis-aggregation-binning{background-color:white;padding:10px}";const u=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcgisBackClick=(0,s.c)(this,"arcgisBackClick",7),this.manager=(0,a.u)(this),this.disableSizeSlider=!1,this.view=void 0,this.layer=void 0,this.portal=void 0,this.config=void 0,this.strings=void 0,this.flowNode=void 0,this.hideLayerTitle=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async done(){this.closePopovers()}async setFocus(){this.flowItemNode?.setFocus()}async componentWillLoad(){const[e,t,i,s,o]=await Promise.all([(0,n.a4)(),(0,n.am)(),(0,n.ab)(),(0,n.az)(),(0,n.aA)()]);this.modules={symbolUtils:e,cimSymbolUtils:t,Color:i,SimpleMarkerSymbol:s,SimpleLineSymbol:o};const{layer:r}=this,l=function(e,t,i){const s=e&&e.visualVariables;if(s){const e=s.filter((e=>{const s=e.target,n="$view.scale"===e.valueExpression;return e.type===t&&(!(0,c.i)(s)&&!(0,c.i)(i)&&!n||s===i||"auto"===i&&n&&!s)}));if(e.length)return e[0]}}(r.renderer,"size");this.disableSizeSlider=(0,c.i)(l)}async componentDidLoad(){this.flowItemNode?.setFocus();const{layer:e}=this,t=e.featureReduction;if("pie-chart"===t.renderer?.type){const t=await(0,n.g)(),i=await t.createRendererForClustering({layer:e});this.autoGeneratedPieChartClusterFields=i.fields?.map((e=>e.name))}}disconnectedCallback(){this.closePopovers()}render(){const{layer:e,strings:t,hideLayerTitle:i}=this,n=(0,d.i)(e),o=(0,d.g)(e);return(0,s.h)(s.H,{key:"c2fe761c8ed25569cc554375cce789c834a7435d",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"696d21ed43bd4f0d66580a23a6fa695f2fdb9373",heading:t.clustering,description:i?void 0:e.title??void 0,selected:this.selected,onCalciteFlowItemBack:()=>this.arcgisBackClick.emit(),ref:e=>this.flowItemNode=e},n&&this.renderSymbol(),"pie-chart"===o&&this.renderShape(),this.renderClusterRadius(),this.renderClusterSize(),this.renderScaleThresholdSlider(),this.renderFieldsBtn(),this.renderLabelBtn(),this.renderPopupBtn()))}renderSymbol(){const{layer:e,strings:t}=this,i=!!e.featureReduction.symbol;return(0,s.h)("calcite-block-section",{text:t.cluster.overrideSymbol,open:i,"toggle-display":"switch",class:"block-section",onCalciteBlockSectionToggle:()=>this.handleToggleSymbol(),ref:e=>this.symbolBlockSectionNode=e},this.renderSymbolContent())}renderSymbolContent(){const{layer:e,strings:t}=this;return e.featureReduction.symbol?(0,s.h)("div",{class:"block-content"},(0,s.h)("calcite-label",null,t.symbolStyle,(0,s.h)("div",{class:"symbol-button",tabIndex:0,role:"button","aria-label":t.symbolStyle,onClick:()=>this.openSymbolStylerPopover(),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.openSymbolStylerPopover()},ref:e=>this.symbolButtonNode=e},(0,s.h)("div",{class:"symbol",ref:e=>{e&&this.createSymbolPreview(e)}}),(0,s.h)("calcite-icon",{scale:"s",icon:"pencil",class:"symbol-icon"})))):(0,s.h)(s.F,null)}renderShape(){const{layer:e,strings:t}=this,i="rtl"===(0,o.b)(this.el),n=e.featureReduction;return(0,s.h)("div",{class:"slider-title-wrapper"},(0,s.h)("calcite-label",null,t.cluster.shape,(0,s.h)("div",{class:"slider-div"},(0,s.h)("label",{class:"slider-label"},i?t.cluster.donut:t.cluster.pie),(0,s.h)("calcite-slider",{class:"slider-slider",min:0,max:Math.max(.9,n.renderer.holePercentage),value:n.renderer.holePercentage??0,step:.1,minLabel:t.cluster.shape,onCalciteSliderInput:t=>{const i=e.featureReduction,s=t.target;i.renderer.holePercentage=s.value,this.handleClusteringChange()}}),(0,s.h)("label",{class:"slider-label"},i?t.cluster.pie:t.cluster.donut))))}renderClusterRadius(){const{layer:e,strings:t}=this,i="rtl"===(0,o.b)(this.el),n=e.featureReduction;return(0,s.h)("div",{class:"slider-title-wrapper"},(0,s.h)("label",{class:"slider-heading"},t.cluster.radiusTitle),(0,s.h)("div",{class:"slider-div"},(0,s.h)("label",{class:"slider-label"},i?t.cluster.high:t.cluster.low),(0,s.h)("calcite-slider",{class:"slider-slider",min:d.d,max:d.e,value:n.clusterRadius??d.b,step:1,minLabel:t.cluster.radiusTitle,onCalciteSliderInput:t=>{const i=e.featureReduction,s=t.target;i.clusterRadius=s.value,this.handleClusteringChange()}}),(0,s.h)("label",{class:"slider-label"},i?t.cluster.low:t.cluster.high)))}renderClusterSize(){const{layer:e,strings:t,disableSizeSlider:i}=this,n="rtl"===(0,o.b)(this.el),r=e.featureReduction;return(0,s.h)("div",{class:"slider-title-wrapper"},(0,s.h)("label",{class:"slider-heading"},t.cluster.sizeTitle),(0,s.h)("div",{class:"slider-div"},(0,s.h)("label",{class:"slider-label"},n?t.cluster.max:t.cluster.min),(0,s.h)("calcite-slider",{class:"slider-slider",min:d.c,max:d.f,minValue:r.clusterMinSize??d.c,maxValue:r.clusterMaxSize??d.f,step:1,disabled:i,minLabel:`${t.cluster.min} ${t.cluster.sizeTitle}`,maxLabel:`${t.cluster.max} ${t.cluster.sizeTitle}`,onCalciteSliderInput:t=>{const i=e.featureReduction,s=t.target;i.clusterMinSize=s.minValue,i.clusterMaxSize=s.maxValue,this.handleClusteringChange()}}),(0,s.h)("label",{class:"slider-label"},n?t.cluster.min:t.cluster.max)))}renderScaleThresholdSlider(){const{layer:e,view:t,portal:i,strings:n}=this;return(0,s.h)("arcgis-aggregation-scale-threshold-slider",{view:t,portal:i,layer:e,strings:n})}renderFieldsBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,s.h)("div",{class:"cluster-btn-section"},(0,s.h)("button",{class:"cluster-btn",onClick:e=>{e.stopPropagation(),this.addFieldsPanel()},ref:e=>this.fieldsButtonNode=e},(0,s.h)("span",{class:"cluster-btn-text"},e.cluster.editClusterAttributes),(0,s.h)("span",{class:"cluster-btn-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderLabelBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,s.h)("div",{class:"cluster-btn-section"},(0,s.h)("button",{class:"cluster-btn",onClick:e=>{e.stopPropagation(),this.addLabelPanel()},ref:e=>this.labelsButtonNode=e},(0,s.h)("span",{class:"cluster-btn-text"},e.cluster.editClusterLabel),(0,s.h)("span",{class:"cluster-btn-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderPopupBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,s.h)("div",{class:"cluster-btn-section"},(0,s.h)("button",{class:"cluster-btn",onClick:e=>{e.stopPropagation(),this.addPopupPanel()},ref:e=>this.popupButtonNode=e},(0,s.h)("span",{class:"cluster-btn-text"},e.cluster.editClusterPopups),(0,s.h)("span",{class:"cluster-btn-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}closePopovers(){this.stylerPopoverNode?.parentElement?.removeChild(this.stylerPopoverNode),this.stylerPopoverNode=void 0}handleToggleSymbol(){const{layer:e,modules:t}=this,i=e.featureReduction;this.symbolBlockSectionNode.open?this.lastSymbol?(i.symbol=this.lastSymbol,this.lastSymbol=void 0):i.symbol=(0,h.g)(t):(this.lastSymbol=i.symbol,i.symbol=void 0,this.closePopovers()),this.handleClusteringChange(),(0,s.f)(this.el)}createSymbolPreview(e){const{layer:t,modules:i}=this,{symbolUtils:s}=i,n=t.featureReduction;if(!n.symbol)return;const o=n.symbol,r="cim"===o.type?20:14;s.renderPreviewHTML(o,{size:r,symbolConfig:void 0}).then((t=>{t&&(e.childNodes.forEach((t=>e.removeChild(t))),e.appendChild(t))}))}async openSymbolStylerPopover(){const{layer:e,portal:t,strings:i}=this;this.stylerPopoverNode?(this.stylerPopoverNode.parentElement?.removeChild(this.stylerPopoverNode),this.stylerPopoverNode=void 0):(this.stylerPopoverNode=document.createElement("arcgis-aggregation-symbol-styler-popover"),this.stylerPopoverNode.props={layer:e,portal:t,strings:i},this.stylerPopoverNode.referenceElement=this.flowItemNode,this.stylerPopoverNode.addEventListener("arcgisClose",(()=>{this.closePopovers(),setTimeout((()=>this.symbolButtonNode?.focus()),300)})),this.stylerPopoverNode.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleClusteringChange(),(0,s.f)(this.el)})),document.body.appendChild(this.stylerPopoverNode),this.stylerPopoverNode?.setFocus())}addFieldsPanel(){this.closePopovers();const{layer:e,view:t,portal:i,strings:n,flowNode:o,hideLayerTitle:r,autoGeneratedPieChartClusterFields:l}=this,a=document.createElement("arcgis-aggregation-fields");a.layer=e,a.mapView=t,a.portal=i,a.strings=n,a.hideLayerTitle=r??!1,a.flowNode=o,a.autoGeneratedPieChartClusterFields=l,a.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleClusteringChange(),(0,s.f)(this.el)})),a.addEventListener("arcgisBackClick",(()=>{o.removeChild(a),this.selected=!0,setTimeout((()=>this.fieldsButtonNode?.focus()),300)})),o.appendChild(a),o.childNodes.forEach((e=>e.selected=!1)),a.selected=!0,this.selected=!1}addLabelPanel(){const{layer:e,view:t,portal:i,strings:n,flowNode:o,hideLayerTitle:l}=this;this.closePopovers();const a=document.createElement("calcite-flow-item");a.heading=n.cluster.labelClusterFeaturesHeading,l||(a.description=e.title);const c=document.createElement("arcgis-map-config-label");c.layer=e,c.mapView=t,c.portal=i,c.layerDisplayType=r.l.cluster,c.calciteFlowProps={calciteFlowItem:a},c.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleClusteringChange(),(0,s.f)(this.el)})),a.appendChild(c),a.addEventListener("calciteFlowItemBack",(()=>{o.removeChild(a),this.selected=!0,setTimeout((()=>this.labelsButtonNode?.focus()),300)})),o.appendChild(a),a.selected=!0,this.selected=!1,a.setFocus()}addPopupPanel(){const{layer:e,view:t,portal:i,config:n,strings:o,flowNode:l,hideLayerTitle:a}=this;this.closePopovers();const c=document.createElement("calcite-flow-item");c.heading=o.cluster.clusterPopupsHeading,a||(c.description=e.title);const d=document.createElement("arcgis-map-config-popup");d.layer=e,d.mapView=t,d.portal=i,d.config=n,d.layerDisplayType=r.l.cluster,d.calciteFlowProps={calciteFlow:l,calciteFlowItem:c},d.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleClusteringChange(),(0,s.f)(this.el)})),c.appendChild(d),c.addEventListener("calciteFlowItemBack",(()=>{l.removeChild(c),this.selected=!0,setTimeout((()=>this.popupButtonNode?.focus()),300)})),l.appendChild(c),c.selected=!0,this.selected=!1,c.setFocus()}handleClusteringChange(){const{layer:e}=this,t=e.featureReduction;e.featureReduction=t.clone(),this.arcgisChange.emit()}get el(){return(0,s.a)(this)}};u.style=".sc-arcgis-aggregation-clustering-h{display:none}[selected].sc-arcgis-aggregation-clustering-h{display:flex}.block-section.sc-arcgis-aggregation-clustering{padding:0 10px}.block-content.sc-arcgis-aggregation-clustering{padding-top:10px}.symbol-button.sc-arcgis-aggregation-clustering{border:solid 1px var(--calcite-color-foreground-3);display:flex;justify-content:space-between}.symbol-button.sc-arcgis-aggregation-clustering:hover{cursor:pointer}.symbol-button.sc-arcgis-aggregation-clustering:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}.symbol.sc-arcgis-aggregation-clustering{padding:5px}.symbol-icon.sc-arcgis-aggregation-clustering{padding:6px}.slider-title-wrapper.sc-arcgis-aggregation-clustering{background-color:var(--calcite-color-foreground-1);border-bottom:1px solid var(--calcite-color-foreground-3);padding:var(--calcite-spacing-lg)}.slider-div.sc-arcgis-aggregation-clustering{display:flex;align-items:center;justify-content:space-between;flex-flow:row wrap}.slider-heading.sc-arcgis-aggregation-clustering{display:inline-block;padding:var(--calcite-spacing-sm) 0}.slider-label.sc-arcgis-aggregation-clustering{display:inline-block;order:2}.slider-slider.sc-arcgis-aggregation-clustering{display:inline-block;width:100%;order:1}.cluster-btn-section.sc-arcgis-aggregation-clustering{background-color:var(--calcite-color-foreground-1)}.cluster-btn.sc-arcgis-aggregation-clustering{background:var(--calcite-color-transparent);border:none;border-bottom:solid 1px var(--calcite-color-foreground-3);display:flex;align-items:center;justify-content:space-between;padding:var(--calcite-spacing-lg);cursor:pointer;width:100%}.cluster-btn.sc-arcgis-aggregation-clustering:hover{background-color:var(--calcite-color-foreground-3);border-color:var(--calcite-color-border-3)}.cluster-btn.sc-arcgis-aggregation-clustering:focus{outline:none;border:2px solid var(--calcite-color-brand)}.cluster-btn-text.sc-arcgis-aggregation-clustering{font-family:var(--calcite-font-family);font-size:var(--calcite-font-size)}";const p=class{constructor(e){(0,s.r)(this,e),this.arcgisSelect=(0,s.c)(this,"arcgisSelect",7),this.arcgisOptionsClick=(0,s.c)(this,"arcgisOptionsClick",7),this.manager=(0,a.u)(this),this.documentClickHandler=void 0,this.panelScrollHandler=void 0,this.props=void 0,this.selected=void 0}async setFocus(){this.tileNode?.focus()}disconnectedCallback(){this.removeInfoPopover()}render(){const{props:e,selected:t}=this,{title:i,imagePath:n,strings:r}=e,l={tile:!0,"tile-selected":t},a={"tile-image":!0,"tile-image-selected":t},c={"tile-check":!0,rtl:"rtl"===(0,o.b)(this.el)};return(0,s.h)(s.H,{key:"fb5c3e71ee4075358125f52feab05ba8473c1039"},(0,s.h)("div",{key:"c9c3caa5adeac29c35f7c415fab190ce9b43cf81",class:l,role:"button",tabindex:"0","aria-label":`${i} ${r.tile.options}`,"aria-selected":t,ref:e=>{e&&(this.tileNode=e)},onClick:e=>{const{selected:t}=this;"CALCITE-CHECKBOX"!==e?.target?.nodeName&&(e.stopPropagation(),this.removeInfoPopover(),t?this.arcgisOptionsClick.emit():this.arcgisSelect.emit(),e.preventDefault())},onKeyUp:e=>{const{selected:t}=this;" "!==e.key&&"Enter"!==e.key||(e.stopPropagation(),this.removeInfoPopover(),t?this.arcgisOptionsClick.emit():this.arcgisSelect.emit(),e.preventDefault())},onKeyDown:e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())}},(0,s.h)("div",{key:"2bee0ac4278d9eaf1f84836a5878330812e9ab96",class:a,style:{backgroundImage:`url(${n})`},"aria-hidden":"true"}),(0,s.h)("div",{key:"7e4b51914d0920b6f8b1d40dd02b5541e6ced3f7",class:c,"aria-label":"","aria-hidden":"true"},(0,s.h)("calcite-checkbox",{key:"d4f44ef56862a94203c9e82d04b66b36e85df999",name:"style-tile-check-name",checked:t,tabindex:"-1",onCalciteCheckboxChange:e=>{e.preventDefault(),this.handleCheckboxChange()},ref:e=>{this.checkboxNode=e}})),this.renderTileLink()))}renderTileLink(){const{props:e,selected:t}=this,{strings:i}=e;return(0,s.h)("div",{class:"style-link","aria-label":e.title},(0,s.h)("div",{class:"style-link-title"},(0,s.h)("div",{"aria-hidden":"true"},e.title),(0,s.h)("calcite-button",{class:"style-link-info",scale:"s",iconStart:"information",appearance:"transparent",kind:"neutral",onClick:e=>{e.stopPropagation(),this.handleInfoClick()},label:i.tile.moreInfo,ref:e=>{e&&(this.infoIconNode=e,e.addEventListener("keyup",(e=>{e.stopPropagation(),(" "===e.key||!this.infoPopoverNode&&"Enter"===e.key)&&(e.stopPropagation(),this.handleInfoClick())})),e.addEventListener("keydown",(e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())})))}})),t&&this.renderStyleOptions())}renderStyleOptions(){const{props:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{appearance:"outline-fill",width:"full",scale:"s",label:t.tile.options},t.tile.options)}handleCheckboxChange(){const{selected:e}=this;this.checkboxNode.checked?(this.removeInfoPopover(),e?this.arcgisOptionsClick.emit():this.arcgisSelect.emit()):this.checkboxNode.checked=!0}handleInfoClick(){const{props:e}=this,{config:t,title:i,moreInfo:s,helpId:n,flowItemNode:o,strings:r}=e;this.removeInfoPopover(),this.infoPopoverNode=document.createElement("arcgis-aggregation-info-popover"),this.infoPopoverNode.props={title:i,moreInfo:s,helpId:n,config:t,flowItemNode:o,strings:r},this.infoPopoverNode.referenceElement=this.infoIconNode,this.infoPopoverNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.removeInfoPopover(),setTimeout((()=>{this.infoIconNode?.setFocus()}),200)})),this.infoPopoverNode.addEventListener("arcgisDisconnected",(e=>{e.stopPropagation(),this.removeInfoPopover()})),document.body.appendChild(this.infoPopoverNode),setTimeout((()=>this.infoPopoverNode?.setFocus()),100),setTimeout((()=>{this.documentClickHandler=e=>{this.isInsideInfoPopoverNode(e.target)||(this.removeInfoPopover(),setTimeout((()=>this.infoIconNode?.setFocus()),200))},document.addEventListener("click",this.documentClickHandler),this.panelScrollHandler=()=>this.removeInfoPopover(),o?.addEventListener("calciteFlowItemScroll",this.panelScrollHandler)}),100)}isInsideInfoPopoverNode(e){if("ARCGIS-AGGREGATION-INFO-POPOVER"===e?.tagName)return!0;{let t=e?.parentElement;for(;t;){if("ARCGIS-AGGREGATION-INFO-POPOVER"===t.tagName)return!0;t=t.parentElement}}return!1}removeInfoPopover(){const{props:e}=this,{flowItemNode:t}=e;document.body.querySelectorAll(".arcgis-aggregation-popover").forEach((e=>document.body.removeChild(e))),this.infoPopoverNode=void 0,this.documentClickHandler&&(document.removeEventListener("click",this.documentClickHandler),this.documentClickHandler=void 0),this.panelScrollHandler&&(t?.removeEventListener("calciteFlowItemScroll",this.panelScrollHandler),this.panelScrollHandler=void 0)}get el(){return(0,s.a)(this)}};p.style=".tile {\n  background-color: white;\n  position: relative;\n  margin: 6px;\n  cursor: pointer;\n  box-shadow:\n    0 1px 10px 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px #e0e0e0;\n  transition: box-shadow 125ms ease-in-out;\n\n  &:hover {\n    z-index: 5;\n    box-shadow:\n      0 1px 0 2px rgba(0, 0, 0, 0.05),\n      0 0 0 1px #e0e0e0;\n  }\n  &:focus {\n    outline: 2px solid var(--calcite-color-brand);\n  }\n}\n\n.tile-selected {\n  box-shadow:\n    0 1px 10px 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px var(--calcite-color-brand);\n}\n.tile-selected:hover {\n  z-index: 5;\n  box-shadow:\n    0 1px 0 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px var(--calcite-color-brand);\n}\n\n.tile-check {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n}\n.tile-check.rtl {\n  right: auto;\n  left: 10px;\n  overflow-x: hidden;\n}\n.style-link {\n  padding: 9px 9px;\n}\n\n.style-link-title {\n  display: flex;\n  font-weight: bold;\n  padding-bottom: 5px;\n}\n.style-link-options {\n  color: #0079c1;\n  display: flex;\n  flex-direction: row nowrap;\n  svg {\n    fill: #0079c1;\n  }\n}\n.tile-image {\n  height: 100px;\n  width: 100%;\n  background-size: cover;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.tile-image-selected {\n  height: 68px;\n  background-size: auto 100px;\n}\n.style-sub-text {\n  font-size: 80%;\n  padding: 0 0 6px 0;\n}\n.style-link-info {\n  height: 18px;\n  margin-top: -2px;\n  margin-inline-start: 5px;\n}\n"}}]);