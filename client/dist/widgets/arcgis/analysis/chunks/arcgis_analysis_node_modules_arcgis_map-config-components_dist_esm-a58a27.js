/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-a58a27.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-a58a27"],{1664:(e,i,n)=>{n.d(i,{a:()=>w,b:()=>b,c:()=>k,d:()=>u,e:()=>C,f:()=>h,g:()=>g,h:()=>t,i:()=>m,j:()=>F,k:()=>R,l:()=>d,m:()=>S,n:()=>I,o:()=>z,p:()=>v,q:()=>x,r:()=>E,s:()=>O,u:()=>B,w:()=>s});n(56612);var l=n(76744),a=n(17840),r=n(39715);function s(e,i,n){const{layer:a,mapView:r,useFeatureReduction:s}=e;if(!s||!("featureReduction"in a)||"binning"!==a.featureReduction.type)return;const t=e.modules.reactiveUtils.watch((()=>r.scale),(()=>{const s=a.featureReduction;r.scale<=s.maxScale&&!i.disabled?((0,l.J)(),function(e,i,n){const l=document.createElement("arcgis-smart-mapping-scale-alert-popover");l.smartMappingState=e,l.refElement=i,l.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",(()=>{o(),n()})),document.body.append(l)}(e,i,n),(0,l.P)(i,!0)):r.scale>s.maxScale&&i.disabled&&(o(),(0,l.P)(i,!1),i.setFocus())}));return t}function o(){document.querySelectorAll("arcgis-smart-mapping-scale-alert-popover").forEach((e=>{e.parentElement?.removeChild(e)}))}async function t(e,i){const{layer:n,useFeatureReduction:r,mapImageSublayer:s,mapView:o,selectedFields:t,modules:u}=e,d=n;i=i||{};const f=(0,l.at)(e,(0,l.g)(e));return await u.PredominanceCreator.createRenderer({layer:d,view:o,fields:c(e,i.fieldInfos),predominanceScheme:i.predominanceScheme||(0,l.ax)(e),includeOpacityVariable:"subtype-sublayer"!==d.type&&(!(0,a.i)(i.includeOpacityVariable)||(0,a.i)(i.includeOpacityVariable)),includeSizeVariable:!!(0,a.i)(i.includeSizeVariable)&&i.includeSizeVariable,outlineOptimizationEnabled:!s&&"subtype-sublayer"!==d.type&&((0,a.i)(i.outlineOptimizationEnabled)?i.outlineOptimizationEnabled:(0,l.e)(e)),sizeOptimizationEnabled:!s&&"subtype-sublayer"!==d.type&&(!(0,a.i)(i.sizeOptimizationEnabled)||i.sizeOptimizationEnabled),legendOptions:i.legendOptions,defaultSymbolEnabled:!1,forBinning:"featureReduction"in d&&"binning"===d.featureReduction?.type&&r}).then((n=>{(0,l.au)(f,n.renderer,{notOpacity:!0});const r=(0,l.k)(e);if(!(0,a.i)(i.includeOpacityVariable)&&["predominance","predominance-size"].includes(r)){const a=(0,l.r)(e),r=t.map((e=>e.field)).sort(),s=a.map((e=>e.field)).sort();if(r.toString()===s.toString()){const a=(0,l.b)((0,l.g)(e),"opacity"),r=(0,l.d)((0,l.g)(e),"opacity");n.renderer.visualVariables=(0,l.a)(n.renderer,"opacity")||[],a&&n.renderer.visualVariables.push(a),n.renderer.authoringInfo.visualVariables=(0,l.c)(n.renderer,"opacity")||[],r&&n.renderer.authoringInfo.visualVariables.push(r);const s=n.renderer.uniqueValueInfos[0].symbol.clone();n.renderer.uniqueValueInfos=(0,l.g)(e).uniqueValueInfos,(0,l.e)(e)&&("predominance-size"===(0,l.k)(e)&&!0!==i.includeSizeVariable?(0,l.ay)(e,n.renderer,s):"predominance"===(0,l.k)(e)&&!0===i.includeSizeVariable&&(0,l.az)(e,n.renderer,s))}}return n}))}async function u(e,i){const{layer:n,useFeatureReduction:r,mapImageSublayer:s,mapView:o,modules:t}=e,u=n;i=i||{};const d=(0,l.g)(e),f=(0,l.b)(d,"size"),m=(0,l.d)(d,"size"),b=(0,l.at)(e,d),p=i.fieldInfos?i.fieldInfos:d.uniqueValueGroups[0].classes.map((e=>({field:e.values[0].value,simpleFieldType:l.w.NUMBER})));let y,z=!0;if(i.fieldInfos&&(d.uniqueValueGroups[0].classes.forEach(((e,n)=>{e.values[0].value!==i.fieldInfos[n].field&&(z=!1)})),z&&(delete i.fieldInfos,(0,l.aw)(i))))return{renderer:d.clone()};z&&(y=d.uniqueValueInfos.map((e=>e.value)),b.opacityVisVar=(0,l.b)(d,"opacity"),b.authOpacityVisVar=(0,l.d)(d,"opacity"));const g=(0,l.g)(e),h=g.uniqueValueInfos?.length?g.uniqueValueInfos[0].symbol:null,V=d.defaultSymbol,v=d.defaultLabel,I=d.backgroundFillSymbol;let S=!1;f&&(S=f.minSize.stops?f.minSize.stops[0].size>f.maxSize.stops[0].size:f.minSize>f.maxSize);const E=(0,a.i)(i.includeSizeVariable)?i.includeSizeVariable:!!f,O=p[0];return p[0]=p[1],p[1]=O,await t.PredominanceCreator.createRenderer({layer:u,view:o,fields:c(e,p),predominanceScheme:i.predominanceScheme||(0,l.ax)(e),includeOpacityVariable:(0,a.i)(i.includeOpacityVariable)?i.includeOpacityVariable:!!b.opacityVisVar,includeSizeVariable:E,outlineOptimizationEnabled:!s&&((0,a.i)(i.outlineOptimizationEnabled)?i.outlineOptimizationEnabled:!!b.sizeOutlineVisVar),sizeOptimizationEnabled:(0,a.i)(i.sizeOptimizationEnabled)?i.sizeOptimizationEnabled:!!b.sizeAutoVisVar,legendOptions:void 0,defaultSymbolEnabled:(0,a.i)(i.defaultSymbolEnabled)?i.defaultSymbolEnabled:!!V,forBinning:"binning"===u.featureReduction?.type&&r}).then((n=>{const r=n.renderer.uniqueValueInfos[0].symbol.clone();if(!i.fieldInfos&&f){const e=(0,l.b)(n.renderer,"size");if(e.minDataValue=f.minDataValue,e.maxDataValue=f.maxDataValue,m){const e=(0,l.d)(n.renderer,"size");e.minSliderValue=m.minSliderValue,e.maxSliderValue=m.maxSliderValue}}if(!(0,a.i)(i.includeOpacityVariable)&&z&&b.opacityVisVar&&b.authOpacityVisVar&&(n.renderer.visualVariables=(0,l.a)(n.renderer,"opacity"),n.renderer.authoringInfo.visualVariables=(0,l.c)(n.renderer,"opacity"),n.renderer.visualVariables.push(b.opacityVisVar),n.renderer.authoringInfo.visualVariables=n.renderer.authoringInfo.visualVariables||[],n.renderer.authoringInfo.visualVariables.push(b.authOpacityVisVar)),(0,l.au)(b,n.renderer,{notOpacity:!0}),y&&n.renderer.uniqueValueInfos.sort(((e,i)=>{const n=y.indexOf(e.value),l=y.indexOf(i.value);return n>-1&&l>-1&&n<l?-1:n>-1&&l>-1&&n>l?1:n>-1?-1:l>-1?1:0})),z&&n.renderer.uniqueValueInfos.forEach(((e,i)=>{e.label=d.uniqueValueInfos[i].label})),h&&n.renderer.uniqueValueInfos?.length){const i=n.renderer.uniqueValueInfos.slice();i.forEach(((i,n)=>{let a;z?a=d.uniqueValueInfos[n].symbol:(a=h.clone(),(0,l.j)(e,a,(0,l.h)(e,i.symbol))),i.symbol=a})),n.renderer.uniqueValueInfos=i,(0,l.e)(e)&&("predominance-size"!==(0,l.k)(e)||E?"predominance"===(0,l.k)(e)&&E&&(0,l.az)(e,n.renderer,r):(0,l.ay)(e,n.renderer,r))}if(V&&(n.renderer.defaultSymbol=V,n.renderer.defaultLabel=v),I&&(n.renderer.backgroundFillSymbol=I),S){const e=(0,l.b)(n.renderer,"size"),i=e.minSize;e.minSize=e.maxSize,e.maxSize=i}return n}))}async function d(e,i){const{layer:n,useFeatureReduction:l,mapView:a,modules:r}=e,s=n;return i=i||{},await r.predominantCategories({layer:s,view:a,fields:i.fieldInfos.map((e=>e.field)),forBinning:"binning"===s.featureReduction?.type&&l})}function c(e,i){return i.map((i=>({name:i.field,label:f(e,i.field)})))}function f(e,i){const n=e.fields.filter((e=>e.layerField.name===i));return n.length?n[0].label:""}async function m(e,i){const{layer:n,useFeatureReduction:r,mapView:s,selectedFields:o,modules:t}=e,u=n;i=i||{};const d=(0,l.at)(e,(0,l.g)(e)),c=!!(0,a.i)(i.includeSizeVariable)&&i.includeSizeVariable;return await t.PieChartCreator.createRenderer({layer:u,view:s,attributes:p(e,i.fieldInfos),pieChartScheme:i.pieChartScheme||(0,l.aA)(e),includeSizeVariable:c,outlineOptimizationEnabled:(0,a.i)(i.outlineOptimizationEnabled)?i.outlineOptimizationEnabled:(0,l.e)(e)&&c,sizeOptimizationEnabled:!(0,a.i)(i.sizeOptimizationEnabled)||i.sizeOptimizationEnabled,legendOptions:i.legendOptions,forBinning:"binning"===u.featureReduction?.type&&r}).then((i=>{(0,l.au)(d,i.renderer,{notOpacity:!0});const n=(0,l.k)(e);if(["chart","chart-size"].includes(n)){const n=(0,l.r)(e),a=o.map((e=>e.field)),r=n.map((e=>e.field)),s=a.toString()===r.toString(),u=t.esriLang.clone(a),d=t.esriLang.clone(r);u.sort(),d.sort();u.toString()===d.toString()&&(i.renderer.attributes=(0,l.g)(e).attributes,s||i.renderer.attributes.sort(((e,i)=>a.indexOf(e.field)-a.indexOf(i.field))),i.renderer.othersCategory=(0,l.g)(e).othersCategory,i.renderer.holePercentage=(0,l.g)(e).holePercentage)}return i}))}async function b(e,i){const{layer:n,useFeatureReduction:r,mapView:s,modules:o}=e,t=n;i=i||{};const u=(0,l.g)(e),d=(0,l.b)(u,"size"),c=(0,l.d)(u,"size"),f=(0,l.at)(e,u),m=i.fieldInfos?i.fieldInfos:u.attributes.map((e=>({field:e.field,simpleFieldType:l.w.NUMBER})));let b,y=!0;if(i.fieldInfos&&(u.attributes.forEach(((e,n)=>{e.field!==i.fieldInfos[n].field&&(y=!1)})),y&&(delete i.fieldInfos,(0,l.aw)(i))))return{renderer:u.clone()};y&&(b=u.attributes.map((e=>e.field)));const z=(0,l.g)(e),g=z.attributes?.length?z.attributes[0].color:null,h=u.backgroundFillSymbol;let V=!1;d&&(V=d.minSize.stops?d.minSize.stops[0].size>d.maxSize.stops[0].size:d.minSize>d.maxSize);const v=m[0];return m[0]=m[1],m[1]=v,await o.PieChartCreator.createRenderer({layer:t,view:s,attributes:p(e,m),pieChartScheme:i.pieChartScheme||(0,l.aA)(e),includeSizeVariable:(0,a.i)(i.includeSizeVariable)?i.includeSizeVariable:!!d,outlineOptimizationEnabled:(0,a.i)(i.outlineOptimizationEnabled)?i.outlineOptimizationEnabled:!!f.sizeOutlineVisVar,sizeOptimizationEnabled:(0,a.i)(i.sizeOptimizationEnabled)?i.sizeOptimizationEnabled:!!f.sizeAutoVisVar,legendOptions:void 0,forBinning:"binning"===t.featureReduction?.type&&r}).then((e=>{if(!i.fieldInfos&&d){const i=(0,l.b)(e.renderer,"size");if(i.minDataValue=d.minDataValue,i.maxDataValue=d.maxDataValue,c){const i=(0,l.d)(e.renderer,"size");i.minSliderValue=c.minSliderValue,i.maxSliderValue=c.maxSliderValue}}if(y&&f.opacityVisVar&&f.authOpacityVisVar&&(e.renderer.visualVariables=(0,l.a)(e.renderer,"opacity"),e.renderer.authoringInfo.visualVariables=(0,l.c)(e.renderer,"opacity"),e.renderer.visualVariables.push(f.opacityVisVar),e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(f.authOpacityVisVar)),(0,l.au)(f,e.renderer,{notOpacity:!0}),b&&e.renderer.attributes.sort(((e,i)=>{const n=b.indexOf(e.field),l=b.indexOf(i.field);return n>-1&&l>-1&&n<l?-1:n>-1&&l>-1&&n>l?1:n>-1?-1:l>-1?1:0})),y&&e.renderer.attributes.forEach(((e,i)=>{e.label=u.attributes[i].label})),e.renderer.size=u.size,e.renderer.holePercentage=u.holePercentage,e.renderer.othersCategory=u.othersCategory,g&&e.renderer.attributes?.length&&e.renderer.attributes.forEach(((e,i)=>{y&&(e.color=u.attributes[i].color)})),h&&(e.renderer.backgroundFillSymbol=h),V){const i=(0,l.b)(e.renderer,"size"),n=i.minSize;i.minSize=i.maxSize,i.maxSize=n}return e}))}function p(e,i){return i.map((i=>({field:i.field,label:y(e,i.field)})))}function y(e,i){const n=e.fields.filter((e=>e.layerField.name===i));return n.length?n[0].label:""}const z=500;async function g(e,i){const{layer:n,useFeatureReduction:r,mapImageSublayer:s,mapView:o,modules:t}=e,u=n;i=i||{};const d=(0,l.at)(e,(0,l.g)(e)),c=i.fieldInfos[0];return await t.TypeCreator.createRenderer({layer:u,view:o,field:c.field,valueExpression:c.expression,valueExpressionTitle:c.expressionTitle,numTypes:i.numTypes||10,sortBy:i.sortBy||"count",typeScheme:i.typeScheme||(0,l.ac)(e,z),returnAllCodedValues:!0,outlineOptimizationEnabled:!s&&"subtype-sublayer"!==u.type&&(!(0,a.i)(i.outlineOptimizationEnabled)||i.outlineOptimizationEnabled),sizeOptimizationEnabled:!s&&"subtype-sublayer"!==u.type&&(!(0,a.i)(i.sizeOptimizationEnabled)||i.sizeOptimizationEnabled),legendOptions:i.legendOptions,defaultSymbolEnabled:!0,forBinning:"featureReduction"in u&&"binning"===u.featureReduction?.type&&r}).then((n=>{if(n.excludedUniqueValueInfos.length||(n.renderer.defaultLabel=void 0,n.renderer.defaultSymbol=void 0),O(e,i)){const i=(0,l.g)(e).clone(),a=(0,l.b)(i,"size","auto"),r=(0,l.b)(i,"size","outline"),s=(0,l.d)(i,"spike");if(n.renderer.visualVariables=[],a&&(n.renderer.visualVariables=n.renderer.visualVariables||[],n.renderer.visualVariables.push(a)),r&&(n.renderer.visualVariables=n.renderer.visualVariables||[],n.renderer.visualVariables.push(r)),n.renderer.uniqueValueInfos=i.uniqueValueInfos,n.renderer.field2=i.field2,n.renderer.field3=i.field3,((0,l.e)(e)||s)&&"type-size"===(0,l.k)(e)){const i=(0,l.f)(e),a=n.renderer.uniqueValueInfos?.slice();a?.forEach((n=>{const a=(0,l.h)(e,n.symbol);n.symbol=i.clone(),(0,l.j)(e,n.symbol,a)})),n.renderer.uniqueValueInfos=a}}return(0,l.au)(d,n.renderer),n}))}async function h(e,i){const{layer:n,useFeatureReduction:r,mapImageSublayer:s,mapView:o,modules:t}=e,u=n,d=(i=i||[]).fieldInfos?i.fieldInfos[0]:null,c=(0,l.g)(e),f=(0,l.at)(e,c),m=c.uniqueValueInfos?.length?c.uniqueValueInfos[0].symbol:null,b=c.defaultSymbol,p=c.defaultLabel,y=d&&(d.field!==c.field||d.expression!==c.valueExpression);return i=i||{},await t.TypeCreator.createRenderer({layer:u,view:o,field:d?d.field:c.field,valueExpression:d?d.expression:c.valueExpression,valueExpressionTitle:d?d.expressionTitle:c.valueExpressionTitle,numTypes:i.numTypes||(y?10:c.uniqueValueInfos.length),sortBy:i.sortBy||"count",typeScheme:(0,l.ac)(e,z),outlineOptimizationEnabled:!s&&((0,a.i)(i.outlineOptimizationEnabled)?i.outlineOptimizationEnabled:!!f.sizeOutlineVisVar),sizeOptimizationEnabled:!s&&((0,a.i)(i.sizeOptimizationEnabled)?i.sizeOptimizationEnabled:!!f.sizeAutoVisVar),legendOptions:i.legendOptions||c.legendOptions,defaultSymbolEnabled:(0,a.i)(i.defaultSymbolEnabled)||!!c.defaultSymbol,forBinning:"binning"===u.featureReduction?.type&&r}).then((i=>{if((0,l.au)(f,i.renderer),m&&i.renderer.uniqueValueInfos?.length){const n=i.renderer.uniqueValueInfos.slice();n.forEach((i=>{const n=m.clone();(0,l.j)(e,n,(0,l.h)(e,i.symbol)),i.symbol=n})),i.renderer.uniqueValueInfos=n}return b&&(i.renderer.defaultSymbol=b,i.renderer.defaultLabel=p),i}))}const V={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};function v(e,i,n){const{allUniqueValues:a,mapView:r,modules:s}=e;if(n?.simpleFieldType===l.w.DATE){let e;a&&(e=s.rendererSupportUtils.calculateDateFormatInterval(a.map((e=>e.value))));const n=new Date(i);if("unknown"===r.timeZone)return s.intl.formatDate(n,{...s.intl.convertDateFormatToIntlOptions(e?V[e]:"long-month-day-year"),timeZone:"utc",timeZoneName:"shortOffset"});{const i=new Date(n.getTime()+6e4*n.getTimezoneOffset());return s.intl.formatDate(i,{...s.intl.convertDateFormatToIntlOptions(e?V[e]:"long-month-day-year"),timeZone:r.timeZone})}}return s.intl.formatDateOnly(i,s.intl.convertDateFormatToIntlOptions("long-month-day-year"))}function I(e){const{allUniqueValues:i,modules:n}=e,r=(0,l.g)(e);if(!i?.length||!(0,a.i)(i[0].count))return[];let s=[];r.uniqueValueGroups.forEach((e=>{const i=[];e.classes.forEach((e=>e.values.forEach((e=>i.push(`${e.value}`))))),s=s.concat(i)}));return i.filter((e=>!s.includes(null===e.value?"<Null>":`${e.value}`))).map((e=>new n.UniqueValueClass({label:e.label,symbol:e.symbol,values:[{value:e.value}]})))}function S(e){const{allUniqueValues:i}=e,n=(0,l.g)(e);if(!i?.length||!(0,a.i)(i[0].count))return[];let r=[];n.uniqueValueGroups.forEach((e=>{const i=[];e.classes.forEach((e=>e.values.forEach((e=>i.push("<Null>"===e.value?"null":`${e.value}`))))),r=r.concat(i)}));return i.filter((e=>!r.includes(`${e.value}`)))}function E(e,i){const{strings:n}=e;let l=1,a=n.panels.type.defaultGroupName.replace("${number}",l.toString());for(;i.find((e=>e.heading===a));)a=n.panels.type.defaultGroupName.replace("${number}",(++l).toString());return a}function O(e,i){if(["type","type-size"].includes((0,l.k)(e))){const n=(0,l.g)(e),a={field:n.field,expression:n.valueExpression,expressionTitle:n.valueExpressionTitle};if((0,l.D)(i.fieldInfos[0],a))return!0}return!1}function x(e,i,n){const{modules:a}=e,r=(0,l.g)(e),s=(0,l.y)(e,r.field),o=s&&["small-integer","integer","big-integer","long"].includes((0,l.F)(e,s.layerField)),t=s?.simpleFieldType===l.w.DATE,u="date-only"===(0,l.F)(e,s?.layerField),d=[],c=(0,l.ac)(e);let f=0;i.classes.forEach(((r,m)=>{if(1===r.values.length||n&&!n.includes(m))d.push(r),f++;else if(!n||n.includes(m)){const n=r.symbol?.type,m=null!=n&&["simple-marker","simple-line","simple-fill","cim"].includes(n)?r.symbol:(0,l.f)(e,(0,l.k)(e));r.values.forEach(((n,r)=>{const b=a.esriLang.clone(m);if(r>0)if(c){const n=c.colors[(i.classes.length+f)%c.colors.length];n&&(0,l.j)(e,b,n)}else{const n=(0,l.aB)(e).colors,r=new a.EsriColor(n[(i.classes.length+f)%10]);r&&(0,l.j)(e,b,r)}const p=s?.layerField?.domain,y=p?p.codedValues?.find((e=>e.code===n.value)):null,z=y?y.name:t||u?v(e,n.value,s):s?.simpleFieldType===l.w.NUMBER?a.intl.formatNumber(o?Number.parseInt(n.value):Number.parseFloat(n.value)):n.value;d.push(new a.UniqueValueClass({values:[new a.UniqueValue({value:n.value})],label:z,symbol:b})),f++}))}})),i.classes=d}async function k(e,i){const{layer:n,useFeatureReduction:r,mapImageSublayer:s,mapView:o,modules:t}=e,u=n,d=(0,l.k)(e);let c=i.relationshipScheme;if(!c&&["relationship","relationship-size"].includes(d)&&(c=(0,l.aC)(e)),i=i||{},"relationship-size"===d){const n=(0,l.g)(e).clone(),a=n.authoringInfo,r=(0,l.d)(n,"spike");if(a&&i.fieldInfos?.length>1&&i.fieldInfos[0].field===a.field1.field&&i.fieldInfos[1].field===a.field2.field){if(n.visualVariables=(0,l.a)(n,"size"),n.authoringInfo.visualVariables=(0,l.c)(n,"size"),(0,l.e)(e)||r){const i=(0,l.f)(e),a=n.uniqueValueInfos.slice();a.forEach((n=>{const a=(0,l.h)(e,n.symbol);n.symbol=i.clone(),(0,l.j)(e,n.symbol,a)})),n.uniqueValueInfos=a}return{renderer:n}}}const f=(0,l.at)(e,(0,l.g)(e)),m={layer:u,view:o,field1:{field:i.fieldInfos[0].field},field2:{field:i.fieldInfos[1].field},classificationMethod:"quantile",numClasses:3,focus:"HH",relationshipScheme:c,outlineOptimizationEnabled:!s&&(!(0,a.i)(i.outlineOptimizationEnabled)||i.outlineOptimizationEnabled),sizeOptimizationEnabled:!s&&(!(0,a.i)(i.sizeOptimizationEnabled)||i.sizeOptimizationEnabled),legendOptions:i.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===u.featureReduction?.type&&r};return await t.RelationshipCreator.createRenderer(m).then((e=>((0,l.au)(f,e.renderer),e)))}async function w(e,i){const{layer:n,useFeatureReduction:r,mapImageSublayer:s,mapView:o,modules:t}=e,u=n;i=i||{};const d=(0,l.g)(e),c=(0,l.k)(e),f=d.authoringInfo,m=(0,l.b)(d,"size");if(i.fieldInfos&&i.fieldInfos.length>1&&i.fieldInfos[0].field===f.field1.field&&i.normalizationField1===f.field1.normalizationField&&i.fieldInfos[1].field===f.field2.field&&i.normalizationField2===f.field2.normalizationField&&(delete i.fieldInfos,delete i.normalizationField1,delete i.normalizationField2,(0,l.aw)(i)&&!m))return{renderer:d.clone()};let b=i.relationshipScheme;!b&&["relationship","relationship-size"].includes(c)&&(b=(0,l.aC)(e));const p=(0,l.at)(e,d),y=i.fieldInfos?i.fieldInfos[0]:{field:f.field1.field,simpleFieldType:l.w.NUMBER},z=i.fieldInfos?i.fieldInfos[1]:{field:f.field2.field,simpleFieldType:l.w.NUMBER},g=void 0!==i.normalizationField1?i.normalizationField1:f.field1.normalizationField,h=void 0!==i.normalizationField2?i.normalizationField2:f.field2.normalizationField,V=d.uniqueValueInfos?.length?d.uniqueValueInfos[0].symbol:null,v=d.defaultSymbol,I=d.defaultLabel,S=i.numClasses?i.numClasses:f.numClasses,E={layer:u,view:o,field1:{field:y?y.field:d.field,normalizationField:g},field2:{field:z?z.field:d.field,normalizationField:h},classificationMethod:i.classificationMethod?i.classificationMethod:"manual"!==f.classificationMethod?f.classificationMethod:"quantile",numClasses:S,focus:i.focus?i.focus:f.focus,relationshipScheme:b,outlineOptimizationEnabled:!s&&((0,a.i)(i.outlineOptimizationEnabled)?i.outlineOptimizationEnabled:!!p.sizeOutlineVisVar),sizeOptimizationEnabled:!s&&((0,a.i)(i.sizeOptimizationEnabled)?i.sizeOptimizationEnabled:!!p.sizeAutoVisVar),legendOptions:i.legendOptions?i.legendOptions:d.legendOptions,defaultSymbolEnabled:(0,a.i)(i.defaultSymbolEnabled)?i.defaultSymbolEnabled:!!d.defaultSymbol,forBinning:"binning"===u.featureReduction?.type&&r};return await t.RelationshipCreator.createRenderer(E).then((i=>{if((0,l.au)(p,i.renderer),V){i.renderer.uniqueValueInfos.forEach((i=>{const n=V.clone();(0,l.j)(e,n,(0,l.h)(e,i.symbol)),i.symbol=n}))}return(0,l.g)(e).uniqueValueInfos.forEach((e=>{const n=i.renderer.uniqueValueInfos.find((i=>e.value===i.value));n&&(n.label=e.label)})),v&&(i.renderer.defaultSymbol=v,i.renderer.defaultLabel=I),i}))}async function B(e,i){const{modules:n}=e;i=i||{};const a=(0,l.g)(e),r=a.authoringInfo;return await n.RelationshipCreator.updateRenderer({field1:r.field1,field2:r.field2,numClasses:i.numClasses?i.numClasses:r.numClasses,focus:i.focus?"none"===i.focus?null:i.focus:r.focus,colors:i.colors,renderer:a})}async function F(e,i){const{layer:n,useFeatureReduction:s,mapImageSublayer:o,mapView:t,modules:u}=e,d=n;i=i||{};const c=(0,l.k)(e),f=(0,l.at)(e,(0,l.g)(e)),m=i.fieldInfos?i.fieldInfos[0]:null,b=i.theme?i.theme:"high-to-low",p={layer:d,view:t,field:m.field,valueExpression:m.expression,valueExpressionTitle:m.expressionTitle,normalizationField:i.normalizationField,theme:b,legendOptions:i.legendOptions,colorOptions:{colorScheme:i.colorScheme||(0,l.aD)(e,b),isContinuous:!!(0,a.i)(i.isContinuous)&&i.isContinuous},symbolOptions:(0,l.H)(e)?void 0:{symbolStyle:i.symbolOptions||"caret"},symbols:i.symbols||void 0,minValue:i.min,maxValue:i.max,sizeOptimizationEnabled:!o&&"above-and-below"!==b&&(!!(0,a.i)(i.sizeOptimizationEnabled)&&i.sizeOptimizationEnabled),defaultSymbolEnabled:!1,forBinning:"binning"===d.featureReduction?.type&&s};return await u.UnivariateColorSizeCreator.createContinuousRenderer(p).then((n=>{if(!i.noReuse&&["color","color-size","color-size-age"].includes(c)&&(0,r.s)(e,i)){const i=(0,l.b)((0,l.g)(e),"color"),a=(0,l.d)((0,l.g)(e),"color");i&&a&&b===a.univariateTheme&&(n.renderer.visualVariables=[i],f.sizeOutlineVisVar&&n.renderer.visualVariables.push(f.sizeOutlineVisVar),n.renderer.authoringInfo.visualVariables=[a],(0,l.aE)(e,n.renderer))}return(0,l.au)(f,n.renderer),n}))}async function C(e,i){const{layer:n,useFeatureReduction:r,mapImageSublayer:s,mapView:o,modules:t}=e,u=n;i=i||{};const d=(0,l.g)(e),c=(0,l.b)(d,"color");if(c&&i.fieldInfos?.[0]&&i.fieldInfos?.[0].field===c.field&&i.fieldInfos?.[0].expression===c.valueExpression&&i.normalizationField===c.normalizationField&&(delete i.fieldInfos,(0,l.aw)(i)))return{renderer:d.clone()};const f=(0,l.at)(e,d),m=(0,l.b)(d,"size"),b=d.authoringInfo,p=(0,l.d)(d,"size"),y=i.fieldInfos?i.fieldInfos[0]:c?{field:c.field,expression:c.valueExpression,expressionTitle:c.valueExpressionTitle,simpleFieldType:(0,l.y)(e,c.field)?.simpleFieldType||l.w.NUMBER}:{field:d.field,expression:d.valueExpression,expressionTitle:d.valueExpressionTitle,simpleFieldType:(0,l.y)(e,d.field)?.simpleFieldType||l.w.NUMBER},z=null===i.normalizationField?void 0:i.normalizationField?i.normalizationField:c?c.normalizationField:d.normalizationField,g=i.theme?i.theme:b?b.univariateTheme:"high-to-low",h="above-and-below"===b.univariateTheme,V="above-and-below"===g,v="custom"===b.univariateSymbolStyle;"custom"!==i.symbolStyle||i.symbols||(1===d.classBreakInfos.length?i.symbols=[t.esriLang.clone(d.classBreakInfos[0].symbol),t.esriLang.clone(d.classBreakInfos[0].symbol)]:i.symbols=[t.esriLang.clone(d.classBreakInfos[0].symbol),t.esriLang.clone(d.classBreakInfos[1].symbol)]);const I=(0,a.i)(i.isContinuous)?i.isContinuous:!(!h&&V)&&!!c,S="picture-marker"===d.classBreakInfos[0].symbol?.type||"picture-marker"===d.classBreakInfos[2===d.classBreakInfos.length?1:0].symbol?.type,E=!h&&V||S&&I?"caret":V?i.symbolStyle?["single","custom"].includes(i.symbolStyle)?void 0:i.symbolStyle:i.symbols?void 0:"custom"!==b.univariateSymbolStyle?b.univariateSymbolStyle:void 0:void 0,O=!(S&&I)&&("custom"===i.symbolStyle||!i.symbolStyle&&v);let x=V&&!(0,l.H)(e)?{symbolStyle:E,symbols:E?void 0:2===i.symbols?.length?{below:i.symbols[0],above:i.symbols[1]}:1===i.symbols?.length?void 0:O?{below:d.classBreakInfos[0].symbol,above:d.classBreakInfos[2===d.classBreakInfos.length?1:0].symbol}:void 0}:void 0;x?.symbolStyle||x?.symbols||(x=void 0),I&&x?.symbols&&((0,l.j)(e,x?.symbols.below,new t.EsriColor([0,0,0,.5])),(0,l.j)(e,x?.symbols.above,new t.EsriColor([0,0,0,.5])));const k=d.defaultSymbol,w=d.defaultLabel,B=d.backgroundFillSymbol;let F=!1;g===b?.univariateTheme&&(0,a.i)(m.minSize)&&(F=m.minSize.stops?m.minSize.stops[0].size>m.maxSize.stops[0].size:m.minSize>m.maxSize);let C=!1;(null===i.normalizationField||i.normalizationField||i.fieldInfos?.[0])&&(C=!0);const R=V&&!h||!V&&h,q=i.discardMinMax?void 0:(0,a.i)(i.min)?i.min:C?void 0:p?p.minSliderValue:void 0,T=i.discardMinMax?void 0:(0,a.i)(i.max)?i.max:C?void 0:p?p.maxSliderValue:void 0,D="below"===b.univariateTheme,L="below"===g,M=L&&!D||!L&&D,U=i.colorScheme||!R&&(0,l.aD)(e,g),j={layer:u,view:o,field:y.field,valueExpression:y.expression,valueExpressionTitle:y.expressionTitle,theme:g,legendOptions:i.legendOptions||m.legendOptions,colorOptions:{colorScheme:U,isContinuous:I},symbolOptions:x,normalizationField:z,minValue:q,maxValue:T,sizeOptimizationEnabled:!s&&"above-and-below"!==g&&((0,a.i)(i.sizeOptimizationEnabled)?i.sizeOptimizationEnabled:!!f.sizeAutoVisVar),defaultSymbolEnabled:(0,a.i)(i.defaultSymbolEnabled)?i.defaultSymbolEnabled:!!d.defaultSymbol,forBinning:"binning"===u.featureReduction?.type&&r};return await t.UnivariateColorSizeCreator.createContinuousRenderer(j).then((n=>{if(i.discardMinMax){const e=(0,l.b)(d,"color"),i=(0,l.b)(n.renderer,"color");e?.stops.forEach(((e,n)=>e.value=i?.stops[n].value));const a=(0,l.b)(d,"size"),r=(0,l.b)(n.renderer,"size");"above-and-below"===b.univariateTheme?a.stops?.forEach(((e,i)=>{r.stops&&(e.value=r.stops[i].value)})):(a.minDataValue=r.minDataValue,a.maxDataValue=r.maxDataValue)}if((0,l.au)(f,n.renderer),V){const a=(0,l.h)(e,n.renderer.classBreakInfos[0].symbol),r=n.renderer.classBreakInfos[1]?(0,l.h)(e,n.renderer.classBreakInfos[1].symbol):a;if(!E)if(1===i.symbols?.length&&1===n.renderer.classBreakInfos.length)n.renderer.classBreakInfos[0].symbol=i.symbols[0];else if(2===i.symbols?.length&&1===n.renderer.classBreakInfos.length){const e=t.esriLang.clone(d.classBreakInfos[0].symbol);n.renderer.classBreakInfos[0].symbol=e}else if("single"===i.symbolStyle&&2===n.renderer.classBreakInfos.length){const i=t.esriLang.clone(d.classBreakInfos[0].symbol);n.renderer.classBreakInfos[0].symbol=i.clone(),(0,l.j)(e,i,(0,l.h)(e,n.renderer.classBreakInfos[1].symbol)),n.renderer.classBreakInfos[1].symbol=i,n.renderer.authoringInfo.univariateSymbolStyle=void 0}else{let e=t.esriLang.clone(d.classBreakInfos[0].symbol);n.renderer.classBreakInfos[0].symbol=e,n.renderer.classBreakInfos[1]&&(e=d.classBreakInfos[1]?t.esriLang.clone(d.classBreakInfos[1].symbol):t.esriLang.clone(d.classBreakInfos[0].symbol),n.renderer.classBreakInfos[1].symbol=e)}const s=(0,l.b)(n.renderer,"color");if(s){const i=new t.EsriColor([0,0,0,.5]);(0,l.j)(e,n.renderer.classBreakInfos[0].symbol,i),n.renderer.classBreakInfos[1]&&(0,l.j)(e,n.renderer.classBreakInfos[1].symbol,i)}else c||s?((0,l.j)(e,n.renderer.classBreakInfos[0].symbol,a),n.renderer.classBreakInfos[1]&&(0,l.j)(e,n.renderer.classBreakInfos[1].symbol,r)):((0,l.j)(e,n.renderer.classBreakInfos[0].symbol,(0,l.h)(e,d.classBreakInfos[0].symbol)),(0,l.j)(e,n.renderer.classBreakInfos[1].symbol,(0,l.h)(e,d.classBreakInfos[1].symbol)))}else V||(1===i.symbols?.length?n.renderer.classBreakInfos[0].symbol=i.symbols[0]:1===d.classBreakInfos?.length&&(n.renderer.classBreakInfos[0].symbol=d.classBreakInfos[0].symbol));if(h&&V&&!C){const e=(0,l.b)(n.renderer,"size"),i=(0,l.b)(n.renderer,"color");e.stops=t.esriLang.clone(m.stops),i&&i.stops.forEach(((e,i)=>{e.value=m.stops[i].value})),2===n.renderer.classBreakInfos.length&&(n.renderer.classBreakInfos[0].maxValue=m.stops[2].value,n.renderer.classBreakInfos[1].minValue=m.stops[2].value)}if(M&&U&&c){const e=(0,l.b)(n.renderer,"color"),i=c.stops.length-1;e.stops.forEach(((e,n)=>{e.color=c.stops[i-n].color}))}if(k&&(n.renderer.defaultSymbol=k,n.renderer.defaultLabel=w),n.renderer.backgroundFillSymbol=B||void 0,F){const e=(0,l.b)(n.renderer,"size"),i=e.minSize;e.minSize=e.maxSize,e.maxSize=i}return n}))}function R(e){const{mapView:i}=e,n=(0,l.g)(e),a=(0,l.b)(n,"color"),r=(0,l.b)(n,"size"),s=i.scale,{minSize:o,maxSize:t}=r;let u;if(r.stops)u=a.stops.map(((e,i)=>{const n=r.stops[i];return{color:e.color,size:n.size,value:n.value}}));else{const e=a.stops.length-1;if("number"==typeof o)u=a.stops.map(((i,n)=>({color:i.color,value:i.value,size:0===n?o:n===e?t:null})));else{let i,n;const l=o.stops.length-1;s>o.stops[l].value?(i=o.stops[l].size,n=t.stops[l].size):o.stops.forEach(((e,l)=>{s<=e.value&&(i=e.size,n=t.stops[l].size)}));const d=r.minDataValue,c=r.maxDataValue,f=(c-d)/4;u=a.stops.map(((l,a)=>({color:l.color,value:0===a?d:a===e?c:d+a*f,size:0===a?i:a===e?n:void 0})))}}return u}}}]);