/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-cdf53b.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-cdf53b"],{3175:(e,t,i)=>{i.d(t,{a:()=>o,g:()=>r});var s=i(20173);function o(e){const{customBaseUrl:t,portalHostname:i,urlKey:s}=e,{protocol:o}=window.location;return`${o}//${s?`${s}.${t}`:i}`}function r(e){return(0,s.a)(e.restUrl)}},4573:(e,t,i)=>{function s(e,t,i){window.localStorage.setItem(e,i?JSON.stringify(t):t)}function o(e){window.localStorage.removeItem(e)}function r(e,t){const i=window.localStorage.getItem(e);return i&&t?JSON.parse(i):i}function n(e,t,i){window.sessionStorage.setItem(e,i?JSON.stringify(t):t)}function a(e,t){const i=window.sessionStorage.getItem(e);return i&&t?JSON.parse(i):i}i.d(t,{a:()=>a,b:()=>n,g:()=>r,r:()=>o,s:()=>s})},20173:(e,t,i)=>{i.d(t,{a:()=>s});const s=e=>e&&!e.endsWith("/")?`${e}/`:e},37059:(e,t,i)=>{i.d(t,{c:()=>r});var s=i(69811);const o=[0,0,0,0];async function r(e,t=!1){const i=e?o:void 0,r=await(0,s.ab)();return t?r.fromJSON(i):new r(i)}},49944:(e,t,i)=>{i.r(t),i.d(t,{arcgis_map_config_item_palette:()=>v,arcgis_map_config_symbol_picker:()=>Ae,arcgis_map_config_symbol_picker_file_upload:()=>Te,arcgis_map_config_symbol_styler_browse_styles:()=>Pe,arcgis_map_config_symbol_styler_color_ramp_input:()=>He,arcgis_map_config_symbol_styler_section:()=>Ke,arcgis_map_config_symbol_styler_symbol_preview:()=>Qe});var s=i(11254),o=i(37059),r=i(10588),n=i(69811),a=i(4573),l=i(14528),c=i(10465),d=i(84260),m=i(3175),h=i(57464),y=i(17840),p=i(53127);i(56612);const u="item-palette",g="item",b="item--active",f="item--selected",S=(e,t,i)=>e+i*t;const v=class{constructor(e){(0,s.r)(this,e),this.arcgisItemSelect=(0,s.c)(this,"arcgisItemSelect",7),this.handleFocus=()=>{const{items:e,selected:t}=this,i=e.findIndex((e=>"function"==typeof t?t(e):e===t));this.selectedItemIndex=i,this.activeItemIndex=i<0?0:i},this.handleKeyDown=e=>{const{key:t}=e,{el:i,itemsPerRow:s,items:o}=this;if([" ","Enter","ArrowDown","ArrowLeft","ArrowRight","ArrowUp"].includes(t))return;"ArrowLeft"===t?this.activeItemIndex=this.moveItemIndex("left",s):"ArrowRight"===t?this.activeItemIndex=this.moveItemIndex("right",s):"ArrowUp"===t?this.activeItemIndex=this.moveItemIndex("up",s):"ArrowDown"===t?this.activeItemIndex=this.moveItemIndex("down",s):"Enter"!==t&&" "!==t||this.selectItem(o[this.activeItemIndex]);const r=i.querySelectorAll(`.${g}`)[this.activeItemIndex];!function(e,t){if(!e)return;const i=e?.getBoundingClientRect(),s=t.getBoundingClientRect(),o=s.top+s.height,r=i.top+i.height;if(o>r){const t=Math.abs(r-o);return void(e.scrollTop+=t)}if(s.top<i.top){const t=Math.abs(s.top-i.top);e.scrollTop-=t}}(i.parentElement,r),e.preventDefault(),e.stopPropagation()},this.moveItemIndex=(e,t)=>{const i=this.activeItemIndex,s=this.items.length;let{x:o,y:r}={x:(n=i)%(a=t),y:Math.floor(n/a)};var n,a;const l=o,c=r;"left"===e?o-=1:"right"===e&&(o+=1),o<0?o=0:o>t-1?o=t-1:"up"===e?r-=1:"down"===e&&(r+=1);const d=Math.ceil(s/t);r<0?r=0:r>d-1&&(r=d-1);return o+t*r>s-1?S(l,c,t):S(o,r,t)},this.handleClick=e=>{const t=e.currentTarget,i=Number(t.getAttribute("data-index"));this.selectItem(this.items[i])},this.selectItem=e=>{const{items:t,arcgisItemSelect:i}=this,s=t.indexOf(e);this.selectedItemIndex=s,this.activeItemIndex=s,i.emit(e)},this.extraItemProps=void 0,this.ItemRenderer=void 0,this.items=void 0,this.itemsPerRow=5,this.itemProperty=void 0,this.selected=void 0,this.activeItemIndex=0,this.selectedItemIndex=0}async setFocus(){this.handleFocus();const e=this.el.querySelector(`.${f}`);"DIV"===e?.tagName&&e.focus()}render(){const{items:e,ItemRenderer:t,extraItemProps:i,itemProperty:o,selected:r,itemsPerRow:n}=this,a=[],l=Math.ceil(e.length/n),c=Array(n).fill("auto").join(" ");for(let c=0;c<l;c++)for(let l=0,d=S(l,c,n);l<n;l++,d=S(l,c,n)){const n=e[d];if(d>=e.length)break;a.push((0,s.h)("div",{class:{[g]:!0,[b]:d===this.activeItemIndex,[f]:"function"==typeof r?r(n):n===r},"data-index":d,key:d,onClick:this.handleClick,tabIndex:-1,"aria-label":n.item?.data?n.item.data.title||n.item.data.name:n.name},(0,s.h)(t,{...o?{[o]:n}:n,...i})))}return(0,s.h)("div",{key:"7598bdf344ab3490264fa5ebae91b448e76d8436",class:u,"data-row-size":n,onFocus:this.handleFocus,onKeyDown:this.handleKeyDown,tabIndex:0,style:{gridTemplateColumns:c}},a)}get el(){return(0,s.a)(this)}};function w(e){return{authMode:"public"===e.access?"anonymous":"auto"}}v.style=".sc-arcgis-map-config-item-palette-h {\n  display: flex;\n  flex-wrap: wrap;\n  width: 100%;\n}\n\n.item-palette.sc-arcgis-map-config-item-palette {\n  \n  display: grid;\n  justify-content: space-between;\n  -moz-column-gap: 4px;\n       column-gap: 4px;\n  row-gap: 4px;\n  width: 100%;\n\n  &:focus-within {\n    .item--active:not(.item--selected) {\n      border-color: #ccc;\n    }\n  }\n}\n\n.item.sc-arcgis-map-config-item-palette {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  border: 2px solid transparent;\n  outline: none;\n}\n\n.item--selected.sc-arcgis-map-config-item-palette {\n  border-color: #0079c1;\n  font-weight: bolder;\n}\n\n.marker-item.sc-arcgis-map-config-item-palette > div.sc-arcgis-map-config-item-palette > img.sc-arcgis-map-config-item-palette {\n  width: 100%;\n}";const I=[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Triangle",type:"esriSMS",style:"esriSMSTriangle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],k=[{type:"esriSLS",color:[0,0,0,255],width:.75,style:"esriSLSSolid"}],_=[{type:"esriSFS",color:[0,0,0,64],outline:{type:"esriSLS",color:[0,0,0,255],width:.75,style:"esriSLSSolid"},style:"esriSFSSolid"}];function x(e){return[{title:e.symbolSources.circle,name:"Circle",primitive:"circle"},{title:e.symbolSources.square,name:"Square",primitive:"square"},{title:e.symbolSources.cross,name:"Cross",primitive:"cross"},{title:e.symbolSources.x,name:"X",primitive:"x"},{title:e.symbolSources.kite,name:"Kite",primitive:"kite"},{title:e.symbolSources.triangle,name:"Triangle",primitive:"triangle"}].map((e=>({dimensionality:"flat",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[{type:"Icon",resource:{primitive:e.primitive},material:{color:r.e?.gfxUtils?.defaultThematicColor},outline:{color:[0,0,0]}}]})))}function C(e){return[{title:e.symbolSources.sphere,name:"Sphere",primitive:"sphere"},{title:e.symbolSources.tallCylinder,name:"Tall_Cylinder",primitive:"cylinder",mixins:{width:5,height:10,depth:5}},{title:e.symbolSources.cylinder,name:"Cylinder",primitive:"cylinder"},{title:e.symbolSources.tallCube,name:"Tall_Cube",primitive:"cube",mixins:{width:5,height:10,depth:5,anchor:"bottom"}},{title:e.symbolSources.cube,name:"Cube",primitive:"cube"},{title:e.symbolSources.tallCone,name:"Tall_Cone",primitive:"cone",mixins:{width:5,height:10,depth:5}},{title:e.symbolSources.cone,name:"Cone",primitive:"cone"},{title:e.symbolSources.invertedCone,name:"Inverted_Cone",primitive:"invertedCone"},{title:e.symbolSources.diamond,name:"Diamond",primitive:"diamond"},{title:e.symbolSources.tetrahedron,name:"Tetrahedron",primitive:"tetrahedron"}].map((e=>({dimensionality:"volumetric",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[{type:"Object",resource:{primitive:e.primitive},...e.mixins}]})))}async function E(e,t,i,s){try{await r.e.symbolUtils.renderPreviewHTML(t,{node:e,...i})}catch(t){e.appendChild(F(s))}return e}function F(e){const t=document.createElement("span");return t.setAttribute("alt",""),t.innerHTML=e,t}function U(e="2d"){return{async getEsriSymbol(t){const{data:i,parentData:s,portalItem:n}=t,a=await async function(e,t,i,s){const o=function(e){for(const t of e.typeKeywords)if(/^Esri.*Style$/u.test(t)&&"Esri Style"!==t)return t;return}(i);let n=null;o||(n=`${i.itemUrl}/data`);const a={data:e,baseUrl:i.itemUrl,styleName:o,styleUrl:n},{portal:l}=i;return await r.e.webStyleSymbolUtils.fetchSymbolFromStyle(a,t,{portal:l},s,r.e.styleUtils.symbolUrlFromStyleItem,w(i))}(s,i.name,n,s.cimVersion&&"2d"===e?"cimRef":"webRef");return"point-3d"===a.type&&a.symbolLayers.forEach((e=>{if(e.material?.color)if("icon"===e.type){const t=null!=e.material?e.material:{};t.color=r.e.gfxUtils.defaultThematicColor.clone(),e.material=t}else if("object"===e.type){const t=null!=e.material?e.material:{};t.color=t.color||(0,o.c)([255,255,255]),e.material=t}})),a},getThumbnail:async e=>await async function(e){const t=e.data;let i=t.thumbnail?.href;const s=t.thumbnail?.imageData,o=t.title||e.strings?.symbolSources.noTitle,n=document.createElement("div"),a=!!t.cimRef,l=function(e){const t=e.formats?.includes("web3d"),i=e.formatInfos?.some((e=>"gltf"===e.type||"gltf_basisu"===e.type));return t||i}(t),c={size:l&&"volumetric"===t.dimensionality?42:24,disableUpsampling:!1};if(a&&!l){const t=await e.getEsriSymbol();if(!(0,r.i)(t))return(0,r.a)(t)&&delete c.size,await E(n,t,c,o)}if(r.e.devEnvironmentUtils?.isDevEnvironment(globalThis.location.hostname)&&(i=r.e.devEnvironmentUtils.adjustStaticAGOUrl(i)),!i&&!s)return n.appendChild(F(o)),n;const d=new(0,r.e.WebStyleSymbol)({name:t.name,styleUrl:`${e.portalItem.itemUrl}/data`,thumbnail:{url:s?`data:image/jpeg;base64, ${s}`:r.e.urlUtils.makeAbsolute(i,e.portalItem.itemUrl)}});return await E(n,d,c,o)}(e)}}const A={getEsriSymbol:async e=>(await(0,n.aj)()).fromJSON(e.data),async getThumbnail(e){const t=await e.getEsriSymbol(),i={size:"line"===(0,r.g)(t)?{width:24}:24};return await r.e.symbolUtils.renderPreviewHTML(t,i)}},T={getEsriSymbol:async e=>r.e.jsonUtils.fromJSON(e.data),async getThumbnail(e){const t=await e.getEsriSymbol();return await r.e.symbolUtils.renderPreviewHTML(t,{size:38})}},D=Function.prototype;class P{constructor({data:e,parentData:t,portalItem:i,strategy:s,strings:o}){this.data=e,this.parentData=t,this.portalItem=i,this.strategy=s,this.strings=o}async getEsriSymbol(){if(!this._symbol){const e=this._symbolRequest||(this._symbolRequest=this.strategy?.getEsriSymbol(this));this._symbol=await e}return this._symbol.clone()}async getThumbnail(e){if(this._thumbnail)return e.appendChild(this._thumbnail),D;const t=this._thumbnailRequest||(this._thumbnailRequest=this.strategy?.getThumbnail(this));return this._thumbnail=await t,()=>this._thumbnail&&e.appendChild(this._thumbnail)}}class R{constructor({portalItem:e,strings:t,symbolType:i}){this.symbolType="2d",this.portalItem=e,this.strings=t,i&&(this.symbolType=i)}get data(){return this._data}get id(){return this.portalItem?.id}get keywords(){return this.portalItem?.typeKeywords||[]}get name(){return this.portalItem?.name}get title(){return this.portalItem?.title}async fetchData(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();return this._data||(this._data=await this.portalItem.fetchData("json",{...e,...w(this.portalItem)})),this._data}}class L extends R{constructor(){super(...arguments),this.type="symbol-set"}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();if(!this._items){const t=await this.fetchData(e);this._items=t.map((e=>new P({data:e,parentData:t,portalItem:this.portalItem,strategy:A,strings:this.strings})))}return this._items}}class N extends R{constructor(){super(...arguments),this.type="web-style"}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();if(!this._items){const t=await this.fetchData(e);this._items=t.items.map((e=>new P({data:e,parentData:t,portalItem:this.portalItem,strategy:U(this.symbolType),strings:this.strings})))}return this._items}}class O{constructor({strings:e}){this.id="",this.keywords=[],this.name="Basic",this.type="symbol-set",this.title=e.symbolSources.basic}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();return this._items||(this._items=this.data.map((e=>new P({data:e,strategy:A,strings:this.strings})))),this._items}}const $="basic-symbol-set:point",M="basic-symbol-set:line",j="basic-symbol-set:polygon";class z extends O{constructor(){super(...arguments),this.data=I,this.id=$,this.keywords=["Point"]}}class G extends O{constructor(){super(...arguments),this.data=k,this.id=M,this.keywords=["Line"]}}class B extends O{constructor(){super(...arguments),this.data=_,this.id=j,this.keywords=["Polygon"]}}class q{constructor({strings:e}){this.keywords=["3d"],this.id="basic-web-style:flat",this.name="Basic",this.type="web-style",this.data={items:x(e)},this.title=e.symbolSources.basic}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();return this._items||(this._items=this.data.items.map((e=>new P({data:e,strategy:A,strings:this.strings})))),this._items}}class V{constructor({strings:e}){this.id="basic-web-style:volumetric",this.keywords=["3d","volumetric"],this.name="Basic",this.type="web-style",this.data={items:C(e)},this.title=e.symbolSources.basic}async getItems(e){if(r.e.promiseUtils.isAborted(e))throw r.e.promiseUtils.createAbortError();return this._items||(this._items=this.data.items.map((e=>new P({data:e,parentData:this.data,strategy:T,strings:this.strings})))),this._items}}const J="marker-item",H="calcite-mode-dark",K=({item:e,index:t,observer:i})=>{const o=e.data.title?(0,s.h)("calcite-tooltip",{"reference-element":e.data.name},e.data.title):null;return(0,s.h)("span",{class:`${J} ${H}`,ref:s=>{if(!s)return;const o=s;o.item||(o.item=e,o.index=t,i.observe(s))},id:e.data.name,slot:"thumbnail"},o)};async function Q(e,t,i){return i?[]:await async function(e){return await ee({portal:e,queries:{group:e.symbolSetsGroupQuery,item:'type:"Symbol Set" AND (typekeywords:"by value" AND typekeywords:"marker")'}}).then(te)}(e).then((e=>e.map((e=>new L({portalItem:e,strings:t})))))}async function W(e,t,i){return await async function(e,t){const i="2d"===t?e.stylesGroupQuery2d:e.stylesGroupQuery3d;if(!i)return[];return await ee({portal:e,queries:{group:i,item:'type:"Style"'}}).then(te)}(e,t).then((e=>e.map((e=>new N({portalItem:e,symbolType:t,strings:i})))))}async function X(e,t,i,s){return s?.length?await async function(e,t){let i="",s="";return t.forEach((e=>{i+=`${s}id:${e}`,s=" OR "})),await ee({portal:e,queries:{item:i}})}(e,s).then((e=>e.map((e=>new N({portalItem:e,symbolType:t,strings:i}))))):[]}function Y(e,t){return"flat"===e?new q({strings:t}):new V({strings:t})}function Z(e,t){const i={strings:e};return"line"===t?new G(i):"polygon"===t?new B(i):new z(i)}async function ee(e){const t=e.portal,i=e.queries.group,s=e.queries.item;if(i){const{results:e}=await t.queryGroups({query:i,disableExtraQuery:!0});if(0===e.length)return[];const[o]=e;return(await o.queryItems({query:s,disableExtraQuery:!0,num:100,sortField:o.sortField})).results}return(await t.queryItems({query:s,disableExtraQuery:!0,num:100})).results}function te(e){const t=[];return e.forEach((e=>{var i;i="default",e.typeKeywords.includes(i)?t.unshift(e):t.push(e)})),t}const ie="pointSymbol",se="lineSymbol",oe="polygonSymbol",re=e=>!!e.portal;async function ne(e,t){return await Promise.all(e.map(t)).then((t=>e.filter(((e,i)=>t[i]))))}async function ae(e,t,i,s,o,n){const a=ue(i),l="2d"===o?function(e,t){function i(i){if(t.includes("all"))return!0;const{data:s}=i,{dimensionality:o,type:r}=s;if("volumetric"===o)return!1;if("point"===e){if(t.includes("picture")&&"esriPMS"===r)return!0;if(t.includes("simple")&&"esriSMS"===r)return!0}if("line"===e&&t.includes("simple")&&"esriSLS"===r)return!0;if("polygon"===e&&t.includes("simple")&&"esriSFS"===r)return!0;const{formats:n}=s;return!(!pe(t)||!pe(n))}return async function(s,o){const n="point"===e?r.c:"line"===e?r.a:r.i;if(!i(s))return!1;const a=t.includes("cim:picture"),l=t.includes("cim:vector"),c=a&&l||!a&&!l,d=ce(o)&&!me(o)&&!he(o),m=me(o)&&!ce(o)&&!he(o),h=he(o)&&!ce(o)&&!me(o),y="line"===e?se:"polygon"===e?oe:ie;if((d||m||h)&&c||"web-style"!==o.type||s.data.itemType===y)return!0;const p=await s.getEsriSymbol();return!(0,r.b)(p)||n(p)}}(s,a):(c=a,async function(e){if(c.includes("all")||c.includes("3d"))return!0;const{data:{dimensionality:t}}=e;return c.includes("3d:flat")&&"flat"===t||c.includes("3d:volumetric")&&"volumetric"===t});var c;return await ne(t,(async t=>n?await n(t,e,l):await l(t,e)))}const le={point:"Point",line:"Line",polygon:"Polygon"};function ce({keywords:e}){return e.includes(le.point)||e.includes("pointSymbol")}function de({keywords:e}){return e.includes("marker")}function me({keywords:e}){return e.includes(le.line)||e.includes("lineSymbol")}function he({keywords:e}){return e.includes(le.polygon)||e.includes("polygonSymbol")}async function ye(e,t,i,s,o){const r=ue(t),n="2d"===s?function(e,t){return async i=>{const s=i.keywords.includes("3d"),o=i.keywords.includes("Dictionary"),r="point"===e?ce(i)||de(i):"line"===e?me(i):he(i),n=ce(i)||de(i)||me(i)||he(i);if(s||o||!r&&n)return!1;if(t.includes("all"))return!0;function a(){return"point"===e?$:"line"===e?M:j}const l=a();return!(!t.includes("picture")||i.id===l||"symbol-set"!==i.type)||(!(!t.includes("simple")||i.id!==l)||!(!pe(t)||"web-style"!==i.type))}}(i,r):function(e){const t={EsriThematicShapesStyle:!0};return async i=>{if(i.keywords.every((e=>!t[e]))&&"web-style"===i.type&&(e.includes("all")||e.includes("3d")))return!0;if(function(e){return"portalItem"in e}(i)){const t=await i.fetchData(),[s]=t.items,{dimensionality:o}=s;return e.includes("3d:flat")&&"flat"===o||e.includes("3d:volumetric")&&"volumetric"===o}return e.includes("3d:flat")&&"basic-web-style:flat"===i.id||e.includes("3d:volumetric")&&"basic-web-style:volumetric"===i.id}}(r);return await ne(e,(async e=>o?await o(e,n):await n(e)))}function pe(e){return Array.isArray(e)&&e.some((e=>e.includes("cim")))}function ue(e="all"){const t=Array.isArray(e)?e:[e],i=t.find((e=>"cim"===e&&t.find((e=>e.includes("cim:")))));return i?t.filter((e=>!e.includes("cim:"))):t}async function ge(e,t,i,s,o,r,n){const a={};t&&await t(e,a),await e.load();const l=await("2d"===o?async function(e,t,i,s){const o=e.symbolSetsGroupQuery;e.symbolSetsGroupQuery='owner:esri AND title:"Map Viewer Beta Symbols"';const[r,n,a]=await Promise.all([Q(e,t,s),W(e,"2d",t),X(e,"2d",t,i)]),l=e=>e.keywords.every((e=>"Basic"!==e)),c=s?[...r.filter(l),...n.filter(l),...a.filter(l)]:[Z(t,"point"),Z(t,"line"),Z(t,"polygon"),...r.filter(l),...n.filter(l),...a.filter(l)];return e.symbolSetsGroupQuery=o,c}(e,s,r,n):async function(e,t){const[i]=await Promise.all([W(e,"3d",t)]),s=e=>e.keywords.every((e=>"Basic"!==e)),o=[Y("flat",t),Y("volumetric",t),...i.filter(s)];return o}(e,s));return i&&await i(e,a),l}const be="arcgis-symbol-styler-storage-styles",fe="arcgis-map-config-symbol-picker__container",Se="incompatible-symbols-notice",ve="empty-category-content",we="marker-source-select",Ie="marker-selection",ke="scroller",_e="item-palette",xe="file-upload",Ce="categories",Ee="categories-center-action",Fe="symbol-div",Ue="empty-filter",Ae=class{constructor(e){(0,s.r)(this,e),this.arcgisActiveSymbolChange=(0,s.c)(this,"arcgisActiveSymbolChange",7),this.arcgisActiveSymbolItemChange=(0,s.c)(this,"arcgisActiveSymbolItemChange",7),this.arcgisActiveSourceIdChange=(0,s.c)(this,"arcgisActiveSourceIdChange",7),this.arcgisSymbolSourcesChange=(0,s.c)(this,"arcgisSymbolSourcesChange",7),this.arcgisActiveSourceItemsChange=(0,s.c)(this,"arcgisActiveSourceItemsChange",7),this.manager=(0,l.u)(this),this.allCustomFileInfos=[],this.customSymbolsStorageId="arcgis-symbol-picker-custom-symbols",this.actionEls=[],this._onSymbolSourceChange=e=>{const t=e.currentTarget,{selectedItems:i}=t,s=i.find((e=>e.getAttribute("data-value")!==this._activeSourceId));this._activeSourceId=s?.getAttribute("data-value")||this._activeSourceId,t.querySelectorAll("calcite-dropdown-item").forEach((e=>{e!==s&&(e.selected=!1)})),e.stopPropagation(),this.displayEmptyFilterMsg=!1},this.symbol=void 0,this.portal=void 0,this.symbolFilter=void 0,this.activeSourceId=void 0,this.activeSymbolItem=void 0,this.hideHeader=!1,this.symbolType="2d",this.customSymbolItemFilter=void 0,this.customSymbolSourceFilter=void 0,this.itemsPerRow=4,this.symbolSources=void 0,this.activeSymbolItems=void 0,this.hideSvgUploadSymbols=!1,this.hideClassicSymbols=!1,this.strings=(0,d.u)({blocking:!0}),this._activeSourceId=void 0,this._symbolSources=void 0,this._activeSymbolItems=void 0,this.customSymbolError=void 0,this.isGridView=!0,this.displayEmptyFilterMsg=!1,this._activeSymbolFetch=void 0}async handleActiveSourceItemIdChanges(){if(this._activeSourceId)if("custom-symbol-set"===this._activeSourceId)this._setupCustomSymbols();else{const e=this._symbolSources?.find((({id:e})=>e===this._activeSourceId));e&&await this._fetchAndSetUpSymbolItems(e)}}get editGeometry(){return(0,r.g)(this.symbol)}async handleFileUploadChange({detail:e}){const t=e,i=t.cim&&JSON.stringify(t.cim.toJSON());if(t.dataURL&&t.dataURL.length>2e5)return void(this.customSymbolError="too-large");if(t.cim&&i&&i.length>2e5)return void(this.customSymbolError="too-large");this.customSymbolError=void 0;const s=this.allCustomFileInfos.find((e=>t.dataURL&&e.dataURL&&e.dataURL===t.dataURL&&e.fileName===t.fileName||t.cim&&e.cim&&e.fileName===t.fileName&&i===JSON.stringify(e.cim.toJSON())));try{let e;if(s)e=this._activeSymbolItems?.find((e=>e.data.name===s.fileName));else{const i=[...this.allCustomFileInfos,t];(0,a.s)(this.customSymbolsStorageId,i.map((e=>e.dataURL?e:{...e,cim:JSON.stringify(e.cim?.toJSON())})),!0),this.allCustomFileInfos=i,this._setupCustomSymbols(),e=this._activeSymbolItems?.[this._activeSymbolItems.length-1]}this.activeSymbolItem=e,this.arcgisActiveSymbolItemChange.emit(this.activeSymbolItem);const i=await(this.activeSymbolItem?.getEsriSymbol());this.arcgisActiveSymbolChange.emit(i),setTimeout((()=>requestAnimationFrame((()=>{this.itemPaletteNode?.setFocus(),this.updateListSelection()}))),1)}catch(e){this.customSymbolError="storage-full"}}handleInvalidFile(){this.customSymbolError="invalid-file"}handleFileUploadError(){this.customSymbolError="error"}async getStyleItemIds(){return this._symbolSources.filter((e=>"web-style"===e.type)).map((e=>e.id))}_renderSymbolSourceOptions(e,t){const{strings:i,savedStyleIds:o}=this,r=e.filter((e=>"symbol-set"===e.type&&!o?.includes(e.id))),n=e.filter((e=>"web-style"===e.type&&!o?.includes(e.id))),a=e.filter((e=>o?.includes(e.id)));a.sort(((e,t)=>e.title.localeCompare(t.title)));const l=this.symbolFilter?Array.isArray(this.symbolFilter)?this.symbolFilter:[this.symbolFilter]:void 0,c=!("point"!==this.editGeometry||l&&!l.find((e=>"custom"===e||"picture"===e))&&!o?.length),d="3d"!==this.symbolType&&(c||this.savedStyleIds?.length)&&(0,s.h)("calcite-dropdown-group",{groupTitle:i.addedStyles,selectionMode:"multiple",key:"custom"},this._renderSourceDropdownItem(a,t),c&&(!l||!!l.find((e=>"custom"===e)))&&(0,s.h)("calcite-dropdown-item",{key:"custom","data-value":"custom-symbol-set",selected:"custom-symbol-set"===t},i.customSymbols)),m=r.length&&(0,s.h)("calcite-dropdown-group",{groupTitle:i.classicSymbols,selectionMode:"multiple",key:"classic"},this._renderSourceDropdownItem(r,t)),h=n.length&&(0,s.h)("calcite-dropdown-group",{groupTitle:r.length?i.newSymbols:i.symbols,selectionMode:"multiple",key:"webstyles"},this._renderSourceDropdownItem(n,t));return d?m?h?[m,h,d]:[m,d]:[h,d]:m&&h?[m,h]:(0,s.h)("calcite-dropdown-group",{key:"one-group"},this._renderSourceDropdownItem([...r,...n],t))}_renderSourceDropdownItem(e,t){return e.map((e=>(0,s.h)("calcite-dropdown-item",{key:e.id,"data-value":e.id,selected:e.id===t},e.title)))}_setupCustomSymbols(){const e=this.allCustomFileInfos.map((e=>{let t=24,i=24;if(e.width>e.height?i=Math.round(t/e.width*e.height):e.width<e.height&&(t=Math.round(i/e.height*e.width)),e.dataURL){const s=e.fileName.split(".")[1].toLowerCase();return new P({data:{angle:0,contentType:"png"===s?"image/png":"gif"===s?"image/gif":"image/jpeg",height:i,imageData:e.dataURL.split(",")[1],name:e.fileName,type:"esriPMS",url:void 0,width:t,xoffset:0,yoffset:0},parentData:null,portalItem:void 0,strategy:A,strings:this.strings})}return new P({data:{symbol:e.cim,name:e.fileName},parentData:{cimVersion:"2.6.0"},portalItem:void 0,strategy:{getEsriSymbol:async e=>e.data.symbol,async getThumbnail(e){const t=E(document.createElement("div"),e.data.symbol,{size:24,disableUpsampling:!1},e.data.title);return await t}},strings:this.strings})}));this.setUpSymbolIntersectionObserver(),this.customSymbolError=void 0,this._activeSymbolFetch=null,this._activeSymbolItems=e,this.arcgisActiveSourceIdChange.emit("custom-symbol-set"),this.arcgisActiveSourceItemsChange.emit(e.map((e=>new P({...e}))))}async _fetchAndSetUpSymbolItems(e){this._activeSymbolFetch&&this._activeSymbolFetch.controller.abort();const t=new AbortController,i=t.signal;this._activeSymbolFetch={controller:t,id:e.id};const s=!this._activeSymbolItems&&this.activeSymbolItems||await e.getItems(t);if(i?.aborted)return;const o=await ae(e,s,this.symbolFilter,this.editGeometry,this.symbolType,this.customSymbolItemFilter);i?.aborted||(this.setUpSymbolIntersectionObserver(),this.customSymbolError=void 0,this._activeSymbolFetch=null,this._activeSymbolItems=o,this.arcgisActiveSourceIdChange.emit(this._activeSourceId),this.arcgisActiveSourceItemsChange.emit(o.map((e=>new P({...e})))))}tearDownSymbolIntersectionObserver(){this._symbolIntersectionObserver?.disconnect(),this._symbolIntersectionObserver=void 0}setUpSymbolIntersectionObserver(){this.tearDownSymbolIntersectionObserver();let e=0;const t={};this._symbolIntersectionObserver=new IntersectionObserver(((i,s)=>{function o(){e++,t[e]&&(t[e](),delete t[e],o())}i.forEach((i=>{if(!i.isIntersecting)return;const r=i.target;r.item.getThumbnail(r).then((i=>{r.index===e?(i(),o()):t[r.index]=i})),r.item.getEsriSymbol(),s.unobserve(r)}))}))}async _fetchSources(){this._sourcesFetchController&&this._sourcesFetchController.abort(),this._sourcesFetchController=new AbortController;const e=this._sourcesFetchController.signal,t=this.portal,i=re(t)?t.portal:t,s=re(t)?t.before:null,o=re(t)?t.after:null,n=i?this.symbolSources||await ge(i,s,o,this.strings,this.symbolType,this.savedStyleIds,this.hideClassicSymbols):[];if(e?.aborted)return;this._symbolSources=await ye(n,this.symbolFilter,(0,r.g)(this.symbol),this.symbolType,this.customSymbolSourceFilter);const a=this._symbolSources.filter((e=>this.savedStyleIds?.includes(e.id)));if(a.length!==this.savedStyleIds?.length){const e=a.map((e=>e.id)),t=this.savedStyleIds?.filter((t=>!e.includes(t)));this.savedStyleIds=e,this.removeStyleIds(t)}if(this.arcgisSymbolSourcesChange.emit(this._symbolSources),!this._activeSourceId){let e=this.activeSourceId;if(e){this._symbolSources.find((e=>e.id===this.activeSourceId))||(e=void 0)}this._activeSourceId=e||this._symbolSources[0].id}}_getCustomSymbolsFromStorage(){if("3d"===this.symbolType||"point"!==this.editGeometry)return;const e=(0,a.g)(this.customSymbolsStorageId,!0);e&&(this.allCustomFileInfos=e.map((e=>e.dataURL?e:{...e,cim:r.e.CIMSymbol?.fromJSON(JSON.parse(e.cim))})))}_renderSourceSelection(){const{strings:e}=this,t=this._symbolSources;if(!t)return(0,s.h)("div",null);const i=this._symbolSources?.find((e=>e.id===this._activeSourceId)),o="custom-symbol-set"===this._activeSourceId?e.customSymbols:i?.title,r=1===t.length,n=(0,s.h)("calcite-dropdown",{class:{[we]:!0},hidden:r,maxItems:7,onCalciteDropdownSelect:this._onSymbolSourceChange,overlayPositioning:"fixed"},(0,s.h)("calcite-button",{alignment:"space-between",appearance:"outline-fill",kind:"neutral",iconEnd:"chevron-down",scale:"m",slot:"trigger",width:"full"},o),this._renderSymbolSourceOptions(t,this._activeSourceId));return(0,s.h)("div",{class:"section",key:"header"},(0,s.h)("calcite-label",{class:"section"},this.hideHeader?null:this.strings.category,(0,s.h)("div",{class:Ce},n,(0,s.h)("calcite-action",{id:"symbol-picker-grid",active:this.isGridView,appearance:"transparent",icon:"grid",scale:"s",class:Ee,text:this.strings.gridView,onClick:()=>{this.isGridView=!0,(0,s.f)(this.el)}}),(0,s.h)("calcite-tooltip",{"reference-element":"symbol-picker-grid",overlayPositioning:"fixed"},this.strings.gridView),(0,s.h)("calcite-action",{id:"symbol-picker-list",active:!this.isGridView,appearance:"transparent",icon:"list",iconFlipRtl:!0,scale:"s",text:this.strings.listView,onClick:()=>{this.isGridView=!1,(0,s.f)(this.el)}}),(0,s.h)("calcite-tooltip",{"reference-element":"symbol-picker-list",overlayPositioning:"fixed"},this.strings.listView))))}_renderItemSelection(){const{portal:e,strings:t}=this,i=this._activeSymbolFetch,o=re(e)?e.portal:e,r=(0,s.h)("div",{class:"remove-button"},(0,s.h)("calcite-button",{appearance:"transparent",kind:"danger",width:"full",onClick:()=>this.removeStyle()},t.removeStyle));return(0,s.h)("div",{class:{[ke]:!0,[Ie]:this.isGridView},key:"gallery"},i?(0,s.h)("calcite-loader",{label:""}):0===this._activeSymbolItems?.length&&"custom-symbol-set"===this._activeSourceId?(0,s.h)("arcgis-map-config-symbol-picker-file-upload",{portal:o,hideSvgUploadSymbols:this.hideSvgUploadSymbols}):this._activeSymbolItems&&this._activeSymbolItems.length>0?(0,s.h)("div",{class:_e,key:this._activeSymbolItems?.length},this.isGridView?this._renderGridView():this._renderListView(),"custom-symbol-set"===this._activeSourceId&&(0,s.h)("arcgis-map-config-symbol-picker-file-upload",{class:xe,portal:o,hideSvgUploadSymbols:this.hideSvgUploadSymbols}),this.displayEmptyFilterMsg&&(0,s.h)("div",{class:Ue},this.strings.noFilterSymbolsAvailable),this._activeSourceId&&this.savedStyleIds?.includes(this._activeSourceId)&&r):(0,s.h)("div",null,(0,s.h)("div",{class:ve},this.strings.noSymbolsAvailable),this._activeSourceId&&this.savedStyleIds?.includes(this._activeSourceId)&&r))}_renderGridView(){return(0,s.h)("arcgis-map-config-item-palette",{key:this._activeSourceId,items:this._activeSymbolItems?.map(((e,t)=>({item:e,index:t,observer:this._symbolIntersectionObserver}))),ItemRenderer:K,itemsPerRow:this.itemsPerRow,selected:({item:e})=>e?.data===this.activeSymbolItem?.data,onArcgisItemSelect:async e=>{const{detail:{item:t}}=e;this.customSymbolError=void 0,this.arcgisActiveSymbolItemChange.emit(t),this.activeSymbolItem=t;const i=await t.getEsriSymbol();this.arcgisActiveSymbolChange.emit(i),e.stopPropagation()},ref:e=>this.itemPaletteNode=e})}_renderListView(){const{strings:e}=this,t="rtl"===(0,c.b)(this.el);return(0,s.h)("calcite-list",{label:e.symbols,key:this._activeSourceId,filterEnabled:this._activeSymbolItems&&this._activeSymbolItems.length>10,filterPlaceholder:e.filterPlaceholder,onCalciteListFilter:e=>{const t=e.target;this.displayEmptyFilterMsg=!!t.filterText&&0===t.filteredItems.length}},this._activeSymbolItems?.map(((e,i)=>(0,s.h)("calcite-list-item",{key:i,label:e.data.title||e.data.name,value:i,selected:this.activeSymbolItem?.data.name===e.data.name,metadata:e.data.tags?.toString(),onCalciteListItemSelect:async e=>{const t=e.target,i=this._activeSymbolItems?.[t.value];this.customSymbolError=void 0,this.arcgisActiveSymbolItemChange.emit(i),this.activeSymbolItem=i;const s=await(i?.getEsriSymbol());this.arcgisActiveSymbolChange.emit(s),e.stopPropagation()}},(0,s.h)("div",{slot:"actions-start",class:Fe,key:e.data.name,ref:t=>{t&&(e.getThumbnail(t).then((e=>e())),e.getEsriSymbol())}}),"custom-symbol-set"===this._activeSourceId&&(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.removeSymbol,ref:e=>{e&&(this.actionEls[i]=e)},onClick:()=>{this.removeCustomSymbol(i),(0,s.f)(this.el)},onMouseOver:()=>this.addTooltip({referenceElement:this.actionEls[i],placement:t?"right-start":"left-start",innerHTML:this.strings.removeSymbol}),onMouseOut:()=>this.removeTooltip()},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))))))}updateListSelection(){this.el.querySelectorAll("CALCITE-LIST-ITEM").forEach((e=>{e.selected=e.value===this.activeSymbolItem?.data.name,e.selected&&e.setFocus()}))}removeCustomSymbol(e){this.allCustomFileInfos.splice(e,1),(0,a.s)(this.customSymbolsStorageId,this.allCustomFileInfos.map((e=>e.dataURL?e:{...e,cim:JSON.stringify(e.cim?.toJSON())})),!0),this._setupCustomSymbols(),this.activeSymbolItem=void 0}addTooltip(e){this.removeTooltip(),this.tooltipEl=document.createElement("calcite-tooltip"),this.tooltipEl.placement=e.placement||"auto",this.tooltipEl.referenceElement=e.referenceElement,this.tooltipEl.overlayPositioning="fixed",this.tooltipEl.innerHTML=e.innerHTML,this.tooltipEl.open=!0,this.el.parentElement?.appendChild(this.tooltipEl)}removeTooltip(){this.tooltipEl?.parentNode&&(this.tooltipEl.parentNode.removeChild(this.tooltipEl),this.tooltipEl=void 0)}removeStyle(){this.savedStyleIds=this.savedStyleIds?.filter((e=>e!==this._activeSourceId)),this._activeSourceId&&this.removeStyleIds([this._activeSourceId]),this._activeSourceId=this.savedStyleIds?.[0]||this._symbolSources?.[0].id}removeStyleIds(e){const t=(0,a.g)(be,!0)||{};let i=t.point||[];i=i.filter((t=>!e?.includes(t))),t.point=i.length?i:void 0;let s=t.lline||[];s=s.filter((t=>!e?.includes(t))),t.line=s.length?s:void 0;let o=t.polygon||[];o=o.filter((t=>!e?.includes(t))),t.polygon=o.length?o:void 0,JSON.stringify(t)===JSON.stringify({})?(0,a.r)(be):(0,a.s)(be,t,!0),this._fetchSources()}async componentWillLoad(){await r.e.load();const e=(0,r.g)(this.symbol),t=(0,a.g)(be,!0)||{};this.savedStyleIds=t?.[e]||[]}componentDidLoad(){this._symbolSources||this._fetchSources(),this._getCustomSymbolsFromStorage()}connectedCallback(){this.setUpSymbolIntersectionObserver(),this._activeSymbolFetch?.controller.abort(),this._sourcesFetchController?.abort()}disconnectedCallback(){this.tearDownSymbolIntersectionObserver()}render(){const e=this._symbolSources,t=this._activeSymbolFetch;if(!e||t)return(0,s.h)("div",{class:fe},(0,s.h)("calcite-loader",{label:""}));const i=this._symbolSources?.find((e=>e.id===this._activeSourceId)),o=i?.keywords.includes("Adobe");let r;return o&&(r=this.strings.adobeCopyright.replace("${year}","2024")),(0,s.h)("div",{class:fe},this._renderSourceSelection(),this._renderItemSelection(),o?(0,s.h)("calcite-notice",{open:!0,kind:"danger",key:"copyright",scale:"s"},(0,s.h)("div",{slot:"message",innerHTML:r})):null,this.customSymbolError?(0,s.h)("calcite-notice",{open:!0,class:Se,closable:!0,icon:"exclamation-mark-circle",kind:"danger",key:"large-symbol",onCalciteNoticeClose:()=>this.customSymbolError=void 0,scale:"s"},(0,s.h)("div",{slot:"message"},"too-large"===this.customSymbolError?this.strings.customSymbolErrors.tooLarge:"invalid-file"===this.customSymbolError?this.strings.customSymbolErrors.invalidFile:"storage-full"===this.customSymbolError?this.strings.customSymbolErrors.outOfSpace:"error"===this.customSymbolError?this.strings.customSymbolErrors.error:void 0)):null)}static get assetsDirs(){return["assets"]}get el(){return(0,s.a)(this)}static get watchers(){return{_activeSourceId:["handleActiveSourceItemIdChanges"]}}};Ae.style='.sc-arcgis-map-config-symbol-picker-h, .arcgis-map-config-symbol-picker__container.sc-arcgis-map-config-symbol-picker {\n  display: flex;\n  flex: 1 1 auto;\n  flex-flow: column nowrap;\n  align-items: stretch;\n}\n\n.categories.sc-arcgis-map-config-symbol-picker {\n  display: flex;\n  align-content: normal;\n}\n\n.categories-center-action.sc-arcgis-map-config-symbol-picker {\n  padding: 0 5px;\n}\n\n.marker-selection.sc-arcgis-map-config-symbol-picker {\n  padding: 8px;\n}\n\n.symbol-div.sc-arcgis-map-config-symbol-picker {\n  padding: 0 8px;\n}\n\n.marker-source-select.sc-arcgis-map-config-symbol-picker {\n  width: calc(100% - 74px);\n  display: block;\n}\n\n.marker-source-select[hidden].sc-arcgis-map-config-symbol-picker + .marker-selection.sc-arcgis-map-config-symbol-picker {\n  border-top: 1px solid lightgray;\n  background-color: var(--calcite-color-foreground-1);\n}\n\n.empty-category-content.sc-arcgis-map-config-symbol-picker {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.empty-filter.sc-arcgis-map-config-symbol-picker {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 8px;\n}\n\n.incompatible-symbols-notice.sc-arcgis-map-config-symbol-picker {\n  margin: 8px 0;\n}\n\n.marker-item.sc-arcgis-map-config-symbol-picker {\n  [slot="thumbnail"] > div {\n    margin: 8px 10px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n}\n\n.item-palette.sc-arcgis-map-config-symbol-picker {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.file-upload.sc-arcgis-map-config-symbol-picker {\n  margin-top: 20px;\n  width: auto;\n}\n\n.remove-button.sc-arcgis-map-config-symbol-picker {\n  padding: 10px 0;\n}\n\n.scroller.sc-arcgis-map-config-symbol-picker {\n  max-height: var(--scroller-max-height, min(100vh - 380px, 320px));\n  overflow-y: auto;\n  min-width: 200px;\n  overflow-x: hidden;\n  display: flex;\n  justify-content: center;\n}';const Te=class{constructor(e){(0,s.r)(this,e),this.arcgisSymbolPickerFileUploadChange=(0,s.c)(this,"arcgisSymbolPickerFileUploadChange",7),this.arcgisSymbolPickerFileUploadInvalidFile=(0,s.c)(this,"arcgisSymbolPickerFileUploadInvalidFile",7),this.arcgisSymbolPickerFileUploadError=(0,s.c)(this,"arcgisSymbolPickerFileUploadError",7),this.manager=(0,l.u)(this),this.strings=(0,d.u)({blocking:!0,name:"symbol-picker"}),this.handleDragOver=e=>{e.preventDefault()},this.handleDrop=async e=>{e.preventDefault(),e.dataTransfer?.files[0]&&await this.processFile(e.dataTransfer?.files[0])},this.handleFileInputChange=async e=>{const t=e.target;t.files?.length&&await this.processFile(t.files[0])},this.portal=void 0,this.hideSvgUploadSymbols=!1}render(){const e=this.hideSvgUploadSymbols?this.strings.fileUpload.dragDropNoSvg:this.strings.fileUpload.dragDrop;return(0,s.h)("div",{key:"f73f91a96120c94aca745ce303c6501e6e7fc87e",class:"file-step","aria-label":e,onDragOver:this.handleDragOver,onDragEnter:this.handleDragOver,onDrop:this.handleDrop},(0,s.h)("div",{key:"bf744bb527013ac923614b0d9e88ddfd23fde1ae"},(0,s.h)("div",{key:"6a900e0ba9cf325d1589328f5bf10b4c0ad6a0b6",class:"file-step__drag-text","aria-label":e},e),(0,s.h)("calcite-button",{key:"4a334a7127e7d937c10975ce97366ccac0dabb30",class:"file-step__browse-button",appearance:"transparent",iconStart:"image",onClick:()=>this.fileInput?.click()},this.strings.fileUpload.browse),(0,s.h)("input",{key:"57755b431c3f204f6a86ba0ea106cefe000d9f72",ref:e=>{this.fileInput=e},onChange:this.handleFileInputChange,class:"file-step__file-input",type:"file",accept:".jpg,.gif,.png,.svg,image/jpg,image/gif,image/png,image/svg+xml"})))}async processFile(e){const{portal:t}=this;if(e&&e){if(!this.isValidFile(e))return void this.arcgisSymbolPickerFileUploadInvalidFile.emit();if(this.isSVGFile(e)){const i=await(0,n.aN)(),s=t.helperServices.symbols.url,o=new FileReader;o.onload=async t=>{const o={svgImage:t.target?.result};i.generateSymbol(s,o).then((t=>{this.arcgisSymbolPickerFileUploadChange.emit({cim:t.symbol,fileName:e.name||"",width:t.symbol.width,height:t.symbol.height})}))},o.readAsText(e)}else{const t=new FileReader;t.onload=async t=>{const i=new Image;i.src=t.target?.result,i.onload=()=>{this.arcgisSymbolPickerFileUploadChange.emit({dataURL:t.target?.result,fileName:e.name||"",width:i.width,height:i.height})},i.onerror=()=>{this.arcgisSymbolPickerFileUploadError.emit()}},t.readAsDataURL(e)}}}isValidFile(e){const t=this.hideSvgUploadSymbols?/\.(gif|jpg|jpeg|png)$/iu:/\.(gif|jpg|jpeg|png|svg)$/iu;return e?.name&&t.test(e.name)}isSVGFile(e){return e?.name&&/\.(svg)$/iu.test(e.name)}get el(){return(0,s.a)(this)}};Te.style=":host{display:inline-block;background-color:white;width:100%;padding:20px 5px 15px 5px;border-color:var(--calcite-color-border-1);border-width:2px;border-style:dashed;box-sizing:border-box}.file-step{text-align:center}.file-step__upload-icon{margin-bottom:0.5rem;margin-top:0.25rem;color:var(--calcite-color-text-3)}.file-step__upload-icon calcite-icon{width:4rem;height:4rem}.file-step__drag-text{font-size:0.9rem;margin-bottom:0.25rem}.file-step__browse-button{margin-top:1rem}.file-step__file-input{display:none}";const De="arcgis-symbol-styler-storage-styles",Pe=class{constructor(e){(0,s.r)(this,e),this.arcgisSymbolStylerBrowseStylesClose=(0,s.c)(this,"arcgisSymbolStylerBrowseStylesClose",7),this.manager=(0,l.u)(this),this.cardNodes={},this.editGeometry=void 0,this.excludeItemIds=void 0,this.portal=void 0,this.strings=void 0,this.items=void 0,this.pagination=void 0,this.selectedCount=0}async componentWillLoad(){const{editGeometry:e}=this,t=(0,a.g)(De,!0)||{};this.savedStyleIds=t?.[e]||[]}render(){const{portal:e,editGeometry:t,savedStyleIds:i,excludeItemIds:o,strings:r}=this,n=e.user;let a="";i?.forEach((e=>a+=` -id:${e}`)),o?.length&&o.forEach((e=>a+=` -id:${e}`));const l=`type:"Style" typekeywords:"web2d" ${"point"===t?'typekeywords:"pointSymbol"':"line"===t?'typekeywords:"lineSymbol"':'typekeywords:"polygonSymbol"'}${a}`,c=`${(0,m.a)(e)}/home/`;return(0,s.h)(s.H,{key:"35eb01a23b0b51f73ec61541a2a656587c77f5bf"},(0,s.h)("calcite-dialog",{key:"701c850136f44d0ddff739370bbd5196b4237498",class:"styles-dialog",open:!0,modal:!0,scale:"l",escapeDisabled:!0,outsideCloseDisabled:!0,onCalciteDialogClose:()=>this.arcgisSymbolStylerBrowseStylesClose.emit(),heading:this.strings.addStyles},(0,s.h)("arcgis-item-browser",{key:"0d9093fce4f42ffdad89ab40346535bde98a9800",view:"list",selection:"multiple",filter:l,portal:e,user:n,api:4,config:{baseUrl:c},onArcgisItemBrowserUpdate:e=>{const{results:t,num:i,start:s,total:o}=e.detail;this.items=t,this.pagination={start:s,num:i,total:o}},onArcgisItemBrowserSelect:()=>this.selectedCount=this.itemBrowserNode?.selectedItems?.length,ref:e=>this.itemBrowserNode=e},(0,s.h)("arcgis-item-browser-top-bar",{key:"af8e52061acb7e7276c5ad88cfb03d4be545eb7b",slot:"top-bar","filter-toggle":!0},(0,s.h)("arcgis-item-browser-bucket-select",{key:"9f4930afe5b5c465f51fbcc16b2b854f004f8679",slot:"bucket",options:e.isPortal?["my","favorites","group","org","living atlas"]:void 0}),(0,s.h)("arcgis-item-browser-search",{key:"01797a21102d05d71012a4a03696b0e4c5ba5338",slot:"search",term:""})),(0,s.h)("arcgis-item-browser-sort",{key:"b601443ee3f5bb5d0800b2928d92b5b1e6014581",options:["modified","title","relevance"],slot:"sort"}),(0,s.h)("arcgis-item-browser-filters",{key:"bd82b6f3435df2a40f0484341ea8dc3e92a10919",slot:"filters"},e.user&&(0,s.h)("arcgis-item-browser-filter-folder",{key:"bbf56930e2d14c5b34517b3fea1a6adcd9a10446"}),(0,s.h)("arcgis-item-browser-filter-categories",{key:"b8b982cee061f13af0599581fccd9cdd83cf3c11"}),(0,s.h)("arcgis-item-browser-filter-sharing",{key:"0227b219a0ab56dddf697b9bcdcd29c7986bbc40"}),(0,s.h)("arcgis-item-browser-filter-collaborations",{key:"8751d3b4daa3cbe07e75b46c01404ca10a3883b4"}),(0,s.h)("arcgis-item-browser-filter-tags",{key:"e4ed1065b715b991563d27332cfec45002ee05f3"}),(0,s.h)("arcgis-item-browser-filter-content-status",{key:"b486ff7abd50b34c8aadeb11dc0212d9781140d8"}),(0,s.h)("arcgis-item-browser-filter-date",{key:"ae2e84906d49493fdd0ce8febb236f3a2f6bf3ba",property:"modified"}),(0,s.h)("arcgis-item-browser-filter-date",{key:"f83be4b71616a3b6164eb2cf8029e811fee7c4c3",property:"created"})),(0,s.h)("arcgis-item-browser-content",{key:"c5206104a37620c4c4ed8e36c11aa70692982b08",slot:"content"},(this.items||[]).map((t=>(0,s.h)("arcgis-item-browser-card",{key:`card-${t.id}`,item:t,portal:e,baseUrl:c,showItemType:!0,showDateUpdated:!0,showOwner:!0,showSummary:!0,showThumbnail:!0,ref:e=>this.cardNodes[t.id]=e},(0,s.h)("calcite-button",{label:r.viewItemDetail,scale:"s",appearance:"outline-fill",kind:"neutral",slot:"actions-end",target:"_blank",href:`${c}/item.html?id=${t.id}`},r.viewItemDetail))))),(0,s.h)("arcgis-item-browser-pagination",{key:"d2123c123ba7d4a564d505fb23e1543182a4ad7b",slot:"pagination",total:this.pagination?.total,start:this.pagination?.start,num:this.pagination?.num})),(0,s.h)("calcite-button",{key:"4fa8c788be5aa220e11be411cfa27f273b68a5ff",slot:"footer-end",appearance:"outline-fill",alignment:"center",onClick:()=>this.arcgisSymbolStylerBrowseStylesClose.emit()},this.strings.cancel),(0,s.h)("calcite-button",{key:"97ea0cd994e50ada8c1bf9b56c89e34096ff8927",slot:"footer-end",alignment:"center",appearance:"solid",disabled:!this.selectedCount,onClick:()=>{this.saveNewStyleItemsInLocalStorage(this.itemBrowserNode.selectedItems),this.arcgisSymbolStylerBrowseStylesClose.emit(this.itemBrowserNode.selectedItems.length?this.itemBrowserNode.selectedItems.map((e=>e.id)):[])}},this.strings.add)))}saveNewStyleItemsInLocalStorage(e){const{editGeometry:t}=this,i=(0,a.g)(De,!0)||{},s=i?.[t]||[];if(e.map((e=>e.id)).forEach((e=>{s.includes(e)||s.push(e)})),this.savedStyleIds=s,i[t]=s,["point","polygon"].includes(t)){const t=e.filter((e=>e.typeKeywords.includes("lineSymbol"))).map((e=>e.id)),s=i.line||[];t.forEach((e=>{s.includes(e)||s.push(e)})),s.length&&(i.line=s)}if(["point","line"].includes(t)){const t=e.filter((e=>e.typeKeywords.includes("polygonSymbol"))).map((e=>e.id)),s=i.polygon||[];t.forEach((e=>{s.includes(e)||s.push(e)})),s.length&&(i.polygon=s)}if(["line","polygon"].includes(t)){const t=e.filter((e=>e.typeKeywords.includes("pointSymbol"))).map((e=>e.id)),s=i.point||[];t.forEach((e=>{s.includes(e)||s.push(e)})),s.length&&(i.point=s)}(0,a.s)(De,i,!0)}get el(){return(0,s.a)(this)}};Pe.style=".styles-dialog{--calcite-dialog-size-y:min(900px, calc(80vh + 100px));--calcite-dialog-size-x:1080px;--calcite-dialog-content-space:0px}";const Re="color-picker-container";let Le=0;const Ne="color-ramp-item",Oe=({stops:e,style:t="continuous",allowTransparency:i=!1,name:o,layout:r="vertical",width:n=20,height:a=70})=>{const l=Le+++"-color-ramp-gradient",c="vertical"===r?"rotate(90)":"";return(0,s.h)("span",{title:o,class:Ne},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",height:a,width:n},(0,s.h)("defs",null,(0,s.h)("linearGradient",{id:l,gradientTransform:c},"continuous"===t?function(e,t){const i=1/(e.length-1);return e.slice().map((({r:e,g:o,b:r,a:n},a)=>{const l=a*i*100;return(0,s.h)("stop",{"stop-color":`rgb(${e}, ${o}, ${r})`,"stop-opacity":`${t?n:"1"}`,offset:`${l}%`})}))}(e,i):function(e){const t=1/e.length,i=[];return e.slice().forEach((({r:e,g:o,b:r},n)=>{const a=n*t*100,l=(n+1)*t*100;i.push((0,s.h)("stop",{"stop-color":`rgb(${e}, ${o}, ${r})`,offset:`${a}%`}),(0,s.h)("stop",{"stop-color":`rgb(${e}, ${o}, ${r})`,offset:`${l}%`}))})),i}(e))),(0,s.h)("rect",{x:"0",y:"0",fill:`url('#${l}')`,width:"100%",height:"100%"})))};const $e="color-ramp-item",Me=({stops:e,name:t,opacity:i,size:o=48})=>{const{svgUtils:n}=r.e,a=Math.sqrt(e.length),l=(0,h.H)(e),c=Math.sqrt(o**2+o**2)+0;let d;(0,y.i)(i)&&(d={opacity:`${i}`});const m=[],p=[],u=[],g=(o||75)/a;for(let e=0;e<a;e++){const t=e*g;for(let i=0;i<a;i++){const s=i*g,o=qe(l[e][i]),r=Ve(),a={type:"rect",x:s,y:t,width:g,height:g};m.push(je(o)),p.push(Be(a,o.fill,r)),u.push(n.getBoundingBox(a))}}const b=n.computeBBox(u),f=n.getTransformMatrix(b,c,c,0,!1,0,!1);return(0,s.h)("span",{title:t,class:$e},(0,s.h)("div",{style:d},(0,s.h)("svg",{width:c,height:c,style:undefined,xmlns:"http://www.w3.org/2000/svg"},(0,s.h)("defs",null,m),(0,s.h)("g",{transform:f},p))))};function je(e){const{pattern:t,linearGradient:i}=e;if(t)return(0,s.h)("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},(0,s.h)("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(i){const e=i.stops.map(((e,t)=>(0,s.h)("stop",{key:`${t}-stop`,offset:e.offset,"stop-color":e.color})));return(0,s.h)("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},e)}return null}let ze=0,Ge=0;function Be(e,t,i,o){if(e){if("circle"===e.type)return(0,s.h)("circle",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if("ellipse"===e.type)return(0,s.h)("ellipse",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if("rect"===e.type)return(0,s.h)("rect",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if("image"===e.type)return(0,s.h)("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if("path"===e.type){const o="string"!=typeof e.path?e.path.map((e=>`${e.command} ${e.values.join(" ")}`)).join(" ").trim():e.path;return(0,s.h)("path",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:o})}if("text"===e.type)return(0,s.h)("text",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":o?.align,"text-decoration":o?.decoration,kerning:o?.kerning,rotate:o?.rotate,"text-rendering":"auto","font-style":o?.font.style,"font-variant":o?.font.variant,"font-weight":o?.font.weight,"font-size":o?.font.size,"font-family":o?.font.family,x:e.x,y:e.y},e.text)}return null}function qe(e){const t={fill:"none",pattern:void 0,linearGradient:void 0};if(e)if("type"in e&&"pattern"===e.type){const i="patternId-"+ ++ze;t.fill=`url(#${i})`,t.pattern={id:i,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&"linear"===e.type){const i="linearGradientId-"+ ++Ge;t.fill=`url(#${i})`,t.linearGradient={id:i,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map((e=>({offset:e.offset,color:e.color&&(0,h.c)(e.color).toString()})))}}else if(e){const i=(0,h.c)(e);t.fill=i.toString()}return t}function Ve(e){const t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(e&&(null!=e.width&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=(0,h.c)(e.color).toString()),e.style)){let i="";if(e.style in Je&&(i=Je[e.style]),Array.isArray(i)){i=i.slice(0);for(let t=0;t<i.length;++t)i[t]*=e.width??1;if("butt"!==e.cap){for(let t=0;t<i.length;t+=2)i[t]-=e.width??1,i[t]<1&&(i[t]=1);for(let t=1;t<i.length;t+=2)i[t]+=e.width??1}i=i.join(",")}t.dashArray=i}return t}const Je={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},He=class{constructor(e){(0,s.r)(this,e),this.manager=(0,l.u)(this),this.setInlineInputRef=e=>{this.inlineInputEl=e},this.disabled=!1,this.options=void 0,this.placement="auto",this.popoverProps=void 0,this.strings=void 0}async setFocus(){await(this.inlineInputEl?.setFocus())}async close(){await(this.inlineInputEl?.close())}render(){const{disabled:e,strings:t}=this;return(0,s.h)(s.H,{key:"0de74909ed0ed40ec2455e46d8f7c09cf8529bdc"},(0,s.h)("arcgis-picker-input",{key:"ff2b076c2339fc37b57a3af0be04d10d026e998c",disabled:e,intlDone:t.done,heading:t.ramp,label:this.options.heading,popoverProps:this.popoverProps,ref:this.setInlineInputRef},(0,s.h)("div",{key:"9679c9dfa151e2c07bbf81103d652bec9dcee6c9",class:Re,slot:"content"},this.renderRampsContent(this.options)),(0,s.h)("div",{key:"30a1e7fb3310c0c7b298d51c0331a2191dbffa89",slot:"preview"},(0,s.h)(Oe,{key:"af073709ea2b123e43abd71a1d32d7651e2c96f6",stops:this.options.colorRampStops.slice().reverse(),allowTransparency:this.options.allowTransparency,style:this.options.style,layout:"horizontal",height:"100%",width:"100%"}))))}renderRampsContent({activeCategory:e,colorRamps:t,isSelected:i,onCategoryChange:o,onFlip:r,onSelect:n,style:a}){const{strings:l}=this,{categories:c,ramps:d}=this.getCategoriesAndColorRampsBySelectedCategory(e,t),m="2d"===a,y=m?"rotate":"arrow-up-down",p=m?l.rotateColors:l.flipColors,u=m?Me:Oe,g=m?3:6;return[(0,s.h)("div",{class:"section"},(0,s.h)("calcite-label",null,this.strings.category,(0,s.h)("calcite-select",{width:"full",label:this.strings.category,onCalciteSelectChange:o},c.map((t=>(0,s.h)("calcite-option",{value:t,label:l.categories[t],selected:t===e}))))),(0,s.h)("calcite-button",{class:h.C.colorRampFlipper,appearance:"transparent",onClick:e=>{e.preventDefault(),e.stopImmediatePropagation(),r()},scale:"s",width:"full"},(0,s.h)("calcite-icon",{icon:y,scale:"s",style:m?{transform:"rotateY(180deg)"}:void 0}),p)),(0,s.h)("div",{class:{[h.C.scroller]:!0,[h.C.colorRampSelection]:!0}},(0,s.h)("arcgis-map-config-item-palette",{items:d,extraItemProps:{style:a},ItemRenderer:u,itemsPerRow:g,selected:i,onArcgisItemSelect:n}))]}getCategoriesAndColorRampsBySelectedCategory(e,t){const i=h.I[e],s=t.filter((t=>"all"===e||i.some((e=>t.tags.includes(e))))),o=new Set;t.forEach((e=>e.tags.forEach((e=>o.add(e)))));return{categories:Object.keys(h.I).filter((e=>"all"===e||h.I[e].some((e=>o.has(e))))),ramps:s}}get el(){return(0,s.a)(this)}};He.style='.scroller {\n  max-height: var(--scroller-max-height, 200px);\n  overflow-y: auto;\n  min-width: 200px;\n  overflow-x: hidden;\n  display: flex;\n  justify-content: center;\n}\n\n.color-ramp-item {\n  display: inline-flex;\n  flex-grow: 1;\n  svg {\n    display: flex;\n  }\n}\n\n.color-picker-container {\n  display: flex;\n  flex-direction: column;\n\n  arcgis-map-config-item-palette .item-palette {\n    gap: 20px;\n  }\n}\n\ncalcite-color-picker-swatch {\n  width: 200px;\n}\n\n.section {\n  display: flex;\n  flex-direction: column;\n  padding: 12px;\n  background-color: var(--calcite-color-foreground-1);\n}\n\n.color-ramp-selection {\n  padding: 4px 20px 4px 4px; /* FF needs space for scroll bars */\n  border: 1px solid lightgray;\n  border-top: none;\n}\n\n:dir(rtl) {\n  .color-ramp-selection {\n    padding: 4px 4px 4px 20px; /* FF needs space for scroll bars */\n  }\n}\n\n.color-ramp-flipper {\n  calcite-icon {\n    margin: 0 0.5rem;\n  }\n}\n\n[slot="preview"] {\n  .color-ramp-item {\n    height: 24px;\n  }\n}\n';const Ke=class{constructor(e){(0,s.r)(this,e),this.disabled=!1,this.embedded=!1}render(){return(0,s.h)(s.H,{key:"a21b1247849e54079ea65caf4da701ffe23ce5e9",tabindex:this.disabled?-1:""},(0,s.h)("slot",{key:"37dfa31415c937a7533b3245673a0a9ec5a822a5"}))}};Ke.style=":host{display:flex;flex-direction:column;background-color:var(---calcite-color-foreground-1);padding:16px 12px}:host([disabled]){opacity:var(--calcite-opacity-disabled);pointer-events:none}:host([embedded]){padding:0}";const Qe=class{constructor(e){(0,s.r)(this,e),this.manager=(0,l.u)(this),this.updatePreview=(0,p.d)((async()=>{const{symbol:e}=this;if(!e)return;const t={...this.options,size:this.options?.size&&"object"==typeof this.options.size?{...this.options.size}:this.options?.size};"cim"===e.type&&"CIMPolygonSymbol"===e.data.symbol?.type?delete t?.size:"cim"===e.type&&"CIMLineSymbol"===e.data.symbol.type&&t.size&&"object"==typeof t.size&&(t.size.height=20);const i=e.clone();"picture-marker"===i.type&&t.size&&"number"==typeof t.size?(i.width=i.width/i.height*t.size,i.height=t.size):"simple-line"===i.type&&t.size&&"object"==typeof t.size&&(i.width=t.size.height);const s=r.e.symbolUtils.renderPreviewHTML(i,t);this.lastPreviewRender=s;const o=await s;this.lastPreviewRender!==s||(this.lastPreview?.remove(),this.lastPreview=o,o&&this.el.shadowRoot?.append(o),this.backgroundTheme=r.e.previewSymbol2D.getContrastingBackgroundTheme(e,245))}),250),this.backgroundTheme="light",this.contrast=!1,this.options=void 0,this.symbol=void 0}watchSymbolAndOptions(){this.updatePreview()}async componentDidLoad(){await this.updatePreview()}render(){return(0,s.h)(s.H,{key:"bef5327da56cd828407a6227250f2c8aaa6277a6",class:{dark:this.contrast&&"dark"===this.backgroundTheme}})}get el(){return(0,s.a)(this)}static get watchers(){return{symbol:["watchSymbolAndOptions"],options:["watchSymbolAndOptions"]}}};Qe.style=":host{display:inline-block}:host(.dark){background-color:#f3f3f3}img{vertical-align:middle}"}}]);