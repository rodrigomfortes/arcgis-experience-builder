/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-84844a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-84844a"],{6048:(e,t,i)=>{i.d(t,{F:()=>a});var s=i(11254),o=i(56612);const a=({fieldType:e})=>e===o.a.oid||e===o.a.guid||e===o.a.globalId?(0,s.h)("calcite-icon",{scale:"s",icon:"key"}):e===o.a.integer||e===o.a.smallInteger||e===o.a.bigInteger?(0,s.h)("calcite-icon",{scale:"s",icon:"integer"}):e===o.a.single||e===o.a.double||e===o.a.long||e===o.a.number?(0,s.h)("calcite-icon",{scale:"s",icon:"number"}):e===o.a.string?(0,s.h)("calcite-icon",{scale:"s",icon:"string"}):e===o.a.date?(0,s.h)("calcite-icon",{scale:"s",icon:"date-time"}):e===o.a.dateOnly?(0,s.h)("calcite-icon",{scale:"s",icon:"calendar"}):e===o.a.timestampOffset?(0,s.h)("calcite-icon",{scale:"s",icon:"time-zone"}):e===o.a.timeOnly?(0,s.h)("calcite-icon",{scale:"s",icon:"clock"}):(0,s.h)("calcite-icon",{scale:"s",icon:"string"})},23474:(e,t,i)=>{i.d(t,{a:()=>l,c:()=>d,g:()=>h,l:()=>r,r:()=>p,u:()=>m});var s=i(56612),o=i(17840),a=i(14528),n=i(10465);function l(e){let t=[...e.map?.allLayers?.toArray()||[],...e.map?.allTables?.toArray()||[]];return t.forEach((e=>{if("map-image"===e.type||"subtype-group"===e.type){const i=e;t=t.concat([...i.sublayers])}})),t}async function r(e,t,i){const o=e.capabilities?.queryRelated?.supportsCount,a=e.capabilities?.queryRelated?.supportsPagination;if([s.s.feature,s.s.scene,s.s.mapImage,s.s.subtype].includes(i)&&e?.relationships?.length&&o&&a)for(const i of e.relationships){const s=l(t);for(const t of s){const s=t;if(await c(e,s,i))return await s.load(),await Promise.resolve(!0)}}return await Promise.resolve(!1)}async function d(e,t){const{layer:i,mapView:s}=e;if(!i)return await Promise.resolve(!1);for(const e of i.relationships)if(e.id===t.relationshipId){const t=l(s);for(const s of t){const t=s;if(await c(i,t,e))return await t.load(),await Promise.resolve(!0)}return await Promise.resolve(!1)}return await Promise.resolve(!1)}async function c(e,t,i){const s=t.url?t.url===e.url||u(t)===u(e):"type"in t.parent&&"group"===t.parent.type&&"portalItem"in e&&t.parent?.portalItem?.id===e.portalItem?.id;["feature","scene"].includes(t.type)&&s&&"layerId"in t&&!(0,o.i)(t.layerId)&&await t.load();const a="sublayer"===t.type||"subtype-sublayer"===t.type;return await Promise.resolve(["feature","scene","sublayer","subtype-group","subtype-sublayer"].includes(t.type)&&s&&(!a&&t.layerId===i.relatedTableId||a&&t.id===i.relatedTableId))}function p(e,t,i){const s=t.url?t.url===e.url||u(t)===u(e):"type"in t.parent&&"group"===t.parent.type&&"portalItem"in e&&t.parent?.portalItem?.id===e.portalItem?.id,o="sublayer"===t.type||"subtype-sublayer"===t.type;return["feature","scene","sublayer","subtype-group","subtype-sublayer"].includes(t.type)&&s&&(!o&&t.layerId===i.relatedTableId||o&&t.id===i.relatedTableId)}async function h(e,t,i){if([s.s.feature,s.s.scene,s.s.mapImage,s.s.subtype].includes(i)&&e?.relationships?.length)for(const i of e.relationships){const s=l(t);for(const t of s){const s=t;if(await c(e,s,i))return await s.load(),{relationship:i,currLayer:s}}}}function u(e){return["feature","subtype-sublayer"].indexOf(e.type)&&e.url.toLocaleLowerCase().endsWith("/featureserver")?e.url.substring(0,e.url.length-14):["feature","map-image","sublayer"].includes(e.type)&&e.url.toLocaleLowerCase().endsWith("/mapserver")?e.url.substring(0,e.url.length-10):["feature","map-image","sublayer"].includes(e.type)&&e.url.toLocaleLowerCase().includes("/mapserver/")?e.url.substring(0,e.url.toLocaleLowerCase().indexOf("/mapserver/")):"scene"===e.type&&e.url.toLocaleLowerCase().endsWith("/sceneserver")?e.url.substring(0,e.url.length-12):e.url}function m(){const e=(0,a.r)(),t=e;e.manager.onLoad((()=>{t.popupState=function(e,t){const i=g.get(e);if(i)return i;const s=(0,n.c)(e,t);if(s&&"store"in s)return g.set(e,s.store),s.store;return null}(e.el,"arcgis-popup").state}))}const g=new WeakMap},43568:(e,t,i)=>{i.d(t,{a:()=>s,b:()=>o});const s=["attachment","connectivity","container","content","structure"];var o;!function(e){e.title="title",e.description="description",e.displayCount="displayCount"}(o||(o={}))},53127:(e,t,i)=>{i.d(t,{a:()=>o,d:()=>s,t:()=>a});const s=(e,t)=>{let i,s="idle";const o=async(...o)=>await new Promise((a=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),a(e(...o))):a(null);break;case"invoked":clearTimeout(i),s="idle",a(e(...o));break;case"cancelled":clearTimeout(i),s="idle",a(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>{s="idle",a(e(...o))}),t)}}));return o.flush=async function(...e){return s="flushed",await o(...e)},o.invoke=async function(...e){return s="invoked",await o(...e)},o.cancel=async function(...e){return s="cancelled",await o(...e)},o.getStatus=function(){return s},o},o=(e,t)=>{let i;return async(...s)=>await new Promise((o=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,o(e(...s))}),t))}))};function a(e){return new Promise((t=>setTimeout(t,e)))}},60262:(e,t,i)=>{i.d(t,{p:()=>n});var s=i(69811),o=i(56612),a=i(17840);const n=async(e,t,i)=>{e.closePopup();const s=(0,a.a)(t);if(s!==o.s.parquet&&s!==o.s.voxel){if(s!==o.s.scene||t?.associatedLayer){const o=await l(e,t,i,s);return o?(await e.openPopup({features:[o],location:o.geometry?.extent?.center??o.geometry}),e.popup&&"dockEnabled"in e.popup&&(e.popup.dockEnabled=!0),await Promise.resolve(o)):void await Promise.resolve(void 0)}await Promise.resolve(void 0)}else await Promise.resolve(void 0)},l=async(e,t,i,n)=>{try{let l,c;if(n===o.s.ogcFeature){l=await e.whenLayerView(t);const i=await(0,s.l)();await i.whenOnce((()=>!l.updating))}else if(n===o.s.stream){l=await e.whenLayerView(t);const i=await(0,s.l)();await i.whenOnce((()=>!l.updating))}else l=t;if(n===o.s.imageryTile||n===o.s.wcs){const i=e.allLayerViews.find((e=>e.layer.id===t.id)),s=await i.fetchPopupFeaturesAtLocation(t.fullExtent?.center);return s?.[0]}if(n===o.s.mapImage&&t.layer.version>=10.5&&!t.layer.capabilities?.operations?.supportsQuery&&t.layer.capabilities?.operations?.supportsIdentify){const i=await(0,a.h)(t,e);return i&&(i.sourceLayer=t),Promise.resolve(i)}const p="isTable"in t&&t.isTable,h=l.createQuery();p||(h.geometry=e.center,h.distance=e.resolution),h.outFields=["*"];const u=await l.queryFeatures(h,{signal:i.signal});if(0===u?.features?.length){const s=l.createQuery();s.geometry=e.extent,s.outFields=["*"],"knowledge-graph-sublayer"===t.type&&(s.returnGeometry=!0);const a=await l.queryFeatures(s,{signal:i.signal});if(a?.features?.length>0)c=await d(a,e,t);else{const s=l.createQuery();s.where=l.definitionExpression||"1=1",s.outFields=["*"],(t.sourceJSON?.advancedQueryCapabilities?.supportsPagination||n===o.s.ogcFeature)&&(s.start=0,s.num=1),s.outSpatialReference=e.spatialReference,c=(await l.queryFeatures(s,{signal:i.signal}))?.features?.[0]}}else c=u?.features?.[0];return c&&n===o.s.imagery&&(c=await r(t,c)),Promise.resolve(c)}catch(e){return console.log(e),void await Promise.resolve(void 0)}},r=async(e,t)=>{const i=e.createQuery();i.outFields=["*"].concat(e.rasterFields.map((e=>e.name)).filter((e=>e.startsWith("Raster.")))),i.geometry=t.geometry,i.outSpatialReference=t.geometry.spatialReference;const s=await e.queryVisibleRasters(i,{returnTopmostRaster:!0,returnDomainValues:!0});return s?.[0]??t},d=async(e,t,i)=>{const o=await(0,a.b)(i);if("point"===o){let i=[void 0,void 0];for(let s=0;s<e.features.length;s++){const o=e.features[s].geometry.distance(t.center);(0===s||(0,a.i)(i?.[1]&&i[1]>o))&&(i=[e.features[s],o])}return i[0]}if("polyline"===o){let i=[void 0,void 0];const o=await(0,s.a2)();for(let s=0;s<e.features.length;s++){const n=o.getNearestVertex(e.features[s].geometry,t.center).distance;(0===s||(0,a.i)(i?.[1]&&i[1]>n))&&(i=[e.features[s],n])}return i[0]}if("polygon"===o||"imagery"===(0,a.a)(i)){let i=[void 0,void 0];for(let s=0;s<e.features.length;s++){const o=e.features[s].geometry.centroid.distance(t.center);(0===s||(0,a.i)(i?.[1]&&i[1]>o))&&(i=[e.features[s],o])}return i[0]}return e.features[0]}},66285:(e,t,i)=>{i.r(t),i.d(t,{arcgis_attributes:()=>b,arcgis_calcite_block_options:()=>v,arcgis_popup_arcade:()=>N,arcgis_popup_associations:()=>k,arcgis_popup_attachments:()=>w,arcgis_popup_attributes:()=>F,arcgis_popup_expressions:()=>I,arcgis_popup_multimedia:()=>L,arcgis_popup_relationship:()=>E,arcgis_popup_richtext:()=>x,arcgis_popup_title:()=>S});var s=i(11254),o=i(6048),a=i(56612),n=i(17840),l=i(84947),r=i(53127),d=i(51523),c=i(60262),p=i(14528),h=i(84260),u=i(53287),m=i(82780),g=i(23474),f=i(43568),y=i(92030),C=i(69811),P=i(10465);i(84661);const b=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.attributesUpdated=(0,s.c)(this,"attributesUpdated",7),this.arcgisClose=(0,s.c)(this,"arcgisClose",7),this.arcgisAttributesDismissedChange=(0,s.c)(this,"arcgisAttributesDismissedChange",7),this.arcgisFieldAdded=(0,s.c)(this,"arcgisFieldAdded",7),this.arcgisAttributesFieldAdded=(0,s.c)(this,"arcgisAttributesFieldAdded",7),this.arcgisFieldsDeleted=(0,s.c)(this,"arcgisFieldsDeleted",7),this.arcgisAttributesFieldDeleted=(0,s.c)(this,"arcgisAttributesFieldDeleted",7),this.manager=(0,p.u)(this),this.strings=(0,h.u)({blocking:!0}),this.layerFieldsMap=new Map,this.arcadeExpMap=new Map,this.popupOpenForLayer=!1,this.listItemNodes=[],this.allowFieldAdd=!1,this.debouncedAttributeUpdates=(0,r.d)((()=>{this.layerDisplayType===a.l.feature?this.layer.popupTemplate=this.popupTemplate.clone():this.layerDisplayType===a.l.cluster&&(this.layer.featureReduction.popupTemplate=this.popupTemplate.clone()),this.attributesUpdated.emit(),this.arcgisChange.emit()}),1e3),this.mapView=void 0,this.portal=void 0,this.layer=void 0,this.config=void 0,this.hidePopup=!1,this.displayPopup=!0,this.dismissible=!1,this.hideLayerTitle=!1,this.addFieldEnabled=!1,this.deleteFieldEnabled=!1,this.calciteFlowProps=!1,this.layerDisplayType=a.l.feature,this.reRender=!1,this.totalSelectedFields=0,this.lastSortBy="default",this.filterFields=void 0}async done(){this.closePopovers(!0),await this.showPreviewPopup(!1)}async setFocus(){this.panelNode?this.panelNode.setFocus():this.listNode?.setFocus()}async componentWillLoad(){console.warn("%cmap-config-components","background: #007AC2; color: #fff; border-radius: 4px; padding: 2px 4px;",'[arcgis-attributes] component in @arcgis/map-config-components is deprecated and will be removed soon. Use "arcgis-map-config-fields" instead.'),this.displayPopup||this.hidePopup||(this.hidePopup=!0);const{mapView:e,layer:t,layerDisplayType:i}=this,s=(0,n.a)(t);if(i===a.l.feature){const o="type"in t?t.type:"sublayer",n=e.popup?.visible?e.popup.selectedFeature?.sourceLayer:void 0;this.popupOpenForLayer="subtype-sublayer"===o?n?.subtypeCode===t.subtypeCode&&n?.parent.id===t.parent.id:"sublayer"===o?n?.id===t.id&&n?.layer.id===t.layer?.id:"id"in t&&n?.id===t.id,s!==a.s.mapImage||t.popupTemplate||(t.popupEnabled=!1),this.popupTemplate=t.popupTemplate?t.popupTemplate.clone():t.createPopupTemplate(),this.popupTemplate.fieldInfos=[...await(0,d.g)(t,this.popupTemplate)],i===a.l.feature?t.popupTemplate=this.popupTemplate.clone():i===a.l.cluster&&(t.featureReduction.popupTemplate=this.popupTemplate.clone())}else this.popupTemplate=t.featureReduction.popupTemplate.clone();const o=window.customElements?.get("arcgis-field-add");this.allowFieldAdd=(0,n.i)(o)&&this.addFieldEnabled&&await(0,l.c)(t)}async componentWillRender(){this.layerFieldsMap=await(0,n.f)(this.layer),this.arcadeExpMap=(0,n.m)(this.popupTemplate)}async componentDidLoad(){await this.showPreviewPopup(!0),this.setupResizeObserver()}disconnectedCallback(){this.resizeObserver?.disconnect()}render(){const{strings:e,layer:t,hideLayerTitle:i,dismissible:o,allowFieldAdd:a,calciteFlowProps:n}=this,l=window.customElements?.get("arcgis-field-add");return(0,s.h)(s.H,{key:"0025beae1f90032759dce2177bf399c9a3f5d297",class:"calcite-match-height"},n?(0,s.h)("div",null,this.renderList()):(0,s.h)("calcite-panel",{heading:e.attributesHeading,description:i?void 0:t.title??void 0,closable:o,ref:e=>this.panelNode=e,onCalcitePanelClose:async e=>{e.stopPropagation(),await this.done(),this.arcgisAttributesDismissedChange.emit(),this.arcgisClose.emit()}},this.renderList(),l&&a&&this.renderFieldAddFab()))}renderList(){const{strings:e}=this;this.listItemNodes=[];const t=this.getSortedFieldList().filter((e=>-1===e.fieldName?.indexOf(a.f.relationship)));return(0,s.h)("calcite-list",{label:e.attributesHeading,filterEnabled:t.length>=5,filterPlaceholder:e.searchFields,selectionMode:"multiple",onCalciteListFilter:()=>{this.filterFields=this.listNode?.filteredItems?.map((e=>e.value))??[],this.dropdownActionNode.disabled=this.filterFields.length<=2},ref:e=>this.listNode=e},this.popupTemplate.fieldInfos.length>=5?this.renderSort():(0,s.h)(s.F,null),this.totalSelectedFields>0?(0,s.h)("div",{class:"total-selected-div"},(0,s.h)("calcite-chip",{label:e.numberFieldsSelected.replace("${number}",`${this.totalSelectedFields}`),value:"selected-fields",closable:!0,onCalciteChipClose:e=>{e.stopPropagation(),this.closePopovers(!0)}},e.numberFieldsSelected.replace("${number}",`${this.totalSelectedFields}`))):(0,s.h)(s.F,null),t.map((e=>this.renderListItem(e))))}renderSort(){const{strings:e}=this,t=this.popupTemplate.fieldInfos.every((e=>!!(0,n.n)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap)));return(0,s.h)("calcite-dropdown",{slot:"filter-actions-end",placement:"bottom-end",overlayPositioning:"fixed"},(0,s.h)("calcite-action",{slot:"trigger",text:e.sort,title:e.sort,ref:e=>this.dropdownActionNode=e,disabled:this.allowFieldAdd&&this.filterFields&&this.filterFields.length<=2},(0,s.h)("calcite-icon",{scale:"s",icon:"sortDescending",flipRtl:!0})),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("calcite-dropdown-item",{selected:"default"===this.lastSortBy,onClick:()=>this.lastSortBy="default",onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="default")}},e.default),(0,s.h)("calcite-dropdown-item",{selected:"display"===this.lastSortBy,onClick:()=>this.lastSortBy="display",onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="display")}},e.displayName),t&&(0,s.h)("calcite-dropdown-item",{selected:"type"===this.lastSortBy,onClick:()=>this.lastSortBy="type",onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="type")}},e.type),(0,s.h)("calcite-dropdown-item",{selected:"field"===this.lastSortBy,onClick:()=>this.lastSortBy="field",onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="field")}},e.fieldName)))}renderFieldAddFab(){const{strings:e}=this;return(0,s.h)("calcite-fab",{ref:e=>this.fieldAddFabNode=e,scale:"s",class:"floating-add-field-button",slot:"fab",kind:"neutral",appearance:"outline-fill","text-enabled":!0,text:e.addField,onClick:()=>{this.fieldAddFabNode.disabled=!0,this.openFieldAddModal()}})}async showPreviewPopup(e){const{mapView:t,layer:i,hidePopup:s,layerDisplayType:o}=this;s||o!==a.l.feature||this.popupOpenForLayer||(e&&i.popupEnabled&&i.popupTemplate?(this.previewPopupController=new AbortController,await(0,c.p)(t,i,this.previewPopupController)):(this.previewPopupController?.abort(),t.closePopup()))}setupResizeObserver(){const e=this.el?.parentElement;(0,n.i)(e.collapsed)&&(this.resizeObserver=new ResizeObserver((async()=>{e.collapsed&&await this.done()})),this.resizeObserver.observe(e))}getSortedFieldList(){const e=[...this.popupTemplate.fieldInfos];return"display"===this.lastSortBy?e.sort(((e,t)=>(0,n.o)(e,this.arcadeExpMap).localeCompare((0,n.o)(t,this.arcadeExpMap)))):"field"===this.lastSortBy?e.sort(((e,t)=>e.fieldName.localeCompare(t.fieldName))):"type"===this.lastSortBy&&e.sort(((e,t)=>{const i=(0,n.n)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap),s=(0,n.n)(t.fieldName,this.layerFieldsMap,this.arcadeExpMap);return i.localeCompare(s)})),e}renderListItem(e){return(0,s.h)("calcite-list-item",{id:e.fieldName,key:e.fieldName,label:(0,n.o)(e,this.arcadeExpMap),description:`{${e.fieldName}}`,value:e.fieldName,metadata:{label:(0,n.o)(e,this.arcadeExpMap),fieldName:e.fieldName},onClick:()=>this.handleListItemClick(e.fieldName),onKeyDown:t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopPropagation(),this.handleListItemClick(e.fieldName))},ref:e=>this.listItemNodes.push(e)},(0,s.h)("div",{slot:"actions-end",class:"field-icons"},(0,s.h)(o.F,{fieldType:(0,n.n)(e.fieldName,this.layerFieldsMap,this.arcadeExpMap)})))}async handleListItemClick(e){const{strings:t,mapView:i,layer:s,config:o,deleteFieldEnabled:a}=this;this.closePopovers(!1);const n=[...this.listNode.selectedItems.map((e=>e.value))];this.totalSelectedFields=n.length,this.lastSelectedFieldName=e,!this.attributesFormattingNode&&n.length&&(this.attributesFormattingNode=document.createElement("arcgis-attributes-formatting"),this.attributesFormattingNode.strings=t,this.attributesFormattingNode.config=o,this.attributesFormattingNode.popoverProps={refElement:this.el},this.attributesFormattingNode.selectedFields=n,this.attributesFormattingNode.layer=s,this.attributesFormattingNode.mapView=i,this.attributesFormattingNode.popupTemplate=this.popupTemplate.clone(),this.attributesFormattingNode.deleteFieldEnabled=a,this.attributesFormattingNode.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.popupTemplate=e.detail.clone(),this.debouncedAttributeUpdates(),this.reRender=!this.reRender})),this.attributesFormattingNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.closePopovers(!0)})),this.attributesFormattingNode.addEventListener("arcgisFieldsDeleted",(async e=>{e.stopPropagation(),this.attributesFormattingNode?.parentElement?.removeChild(this.attributesFormattingNode),this.attributesFormattingNode=void 0,this.popupTemplate=this.layer.popupTemplate?.clone(),this.listItemNodes.forEach((e=>{e&&(e.selected=!1)})),this.totalSelectedFields=0,this.arcgisAttributesFieldDeleted.emit(e.detail),this.arcgisFieldsDeleted.emit(e.detail),this.debouncedAttributeUpdates()})),document.body.appendChild(this.attributesFormattingNode))}openFieldAddModal(){this.fieldAddNode=document.createElement("arcgis-field-add"),this.fieldAddNode.layer=this.layer,this.fieldAddNode.addEventListener("arcgisFieldAddFieldAdded",(async e=>{const{layer:t}=this;this.layer.popupTemplate.fieldInfos=[...t.popupTemplate.fieldInfos],this.popupTemplate=this.layer.popupTemplate.clone();const i=this.layer.popupTemplate.fieldInfos.find((t=>t.fieldName===e.detail));this.popupTemplate.fieldInfos=[...await(0,d.g)(this.layer,this.popupTemplate),i],this.arcgisAttributesFieldAdded.emit(e.detail),this.arcgisFieldAdded.emit(e.detail),this.debouncedAttributeUpdates(),this.removeFieldAddNodes()})),this.fieldAddNode.addEventListener("arcgisWorkflowCancel",(async()=>this.removeFieldAddNodes())),document.body.appendChild(this.fieldAddNode)}removeFieldAddNodes(){this.fieldAddFabNode.disabled=!1,this.fieldAddNode?.parentElement?.childNodes.forEach((e=>{"ARCGIS-FIELD-ADD"===e.nodeName&&(this.fieldAddNode?.parentElement?.removeChild(e),this.fieldAddNode=void 0)}))}closePopovers(e){if(this.attributesFormattingNode&&(this.attributesFormattingNode.parentElement?.removeChild(this.attributesFormattingNode),this.attributesFormattingNode=void 0,e)){const e=this.listNode.selectedItems,t=e.find((e=>e.id===this.lastSelectedFieldName));for(const t of e.values())t.selected=!1;this.totalSelectedFields=0,this.lastSelectedFieldName=void 0,setTimeout((()=>{t?t.setFocus():this.listItemNodes[0].setFocus()}),300)}}static get assetsDirs(){return["assets"]}get el(){return(0,s.a)(this)}};b.style=".total-selected-div{padding:var(--calcite-spacing-xs)}.field-icons{padding:0 var(--calcite-spacing-xl);display:flex;align-items:center}.floating-add-field-button{padding-bottom:0.5rem}";const v=class{constructor(e){(0,s.r)(this,e),this.arcgisDelete=(0,s.c)(this,"arcgisDelete",7),this.arcgisDuplicate=(0,s.c)(this,"arcgisDuplicate",7),this.arcgisRename=(0,s.c)(this,"arcgisRename",7),this.manager=(0,p.u)(this),this.strings=(0,h.u)({blocking:!0}),this.calciteBlockOptions={disableDuplicate:!1,hasDelete:!0,hasDuplicate:!0,hasRename:!0}}async componentWillLoad(){console.warn("%cmap-config-components","background: #007AC2; color: #fff; border-radius: 4px; padding: 2px 4px;",'[arcgis-calcite-block-options] component in @arcgis/map-config-components is deprecated and will be removed soon. Use "arcgis-map-config-block-options" instead.')}async setFocus(){this.dropdownActionNode?.setFocus()}async closeDropdown(){this.dropdownNode?.open&&(this.dropdownNode.open=!1)}render(){const{calciteBlockOptions:e,strings:t}=this,{hasDelete:i,hasDuplicate:o,hasRename:a}=e;return(0,s.h)(s.H,{key:"0e7a5082a99433ff70742f1a0c7447118ad77568",title:t.options},(0,s.h)("calcite-dropdown",{key:"2306599a02c63a8c75256d000520a895ec61963d",scale:"s",overlayPositioning:"fixed",placement:"bottom-end",ref:e=>this.dropdownNode=e},(0,s.h)("calcite-action",{key:"5d6a66790862b104d96ea4854f21a7b1fe11df91",ref:e=>this.dropdownActionNode=e,slot:"trigger",text:t.options},(0,s.h)("calcite-icon",{key:"28b3d7c7ed8df984be5e6cccd2a537febd913584",scale:"s",icon:"ellipsis"})),(0,s.h)("calcite-dropdown-group",{key:"fc35a073435e97f57abf676c0329293556fb7b5e"},i?this.renderDelete():(0,s.h)(s.F,null),o?this.renderDuplicate():(0,s.h)(s.F,null),a?this.renderRename():(0,s.h)(s.F,null))))}renderDelete(){const{strings:e}=this;return(0,s.h)("calcite-dropdown-item",{onClick:e=>{e.stopPropagation(),this.arcgisDelete.emit()},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||this.arcgisDelete.emit()}},e.delete)}renderDuplicate(){const{strings:e}=this;return(0,s.h)("calcite-dropdown-item",{disabled:this.calciteBlockOptions.disableDuplicate,onClick:e=>{e.stopPropagation(),this.arcgisDuplicate.emit()},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||this.arcgisDuplicate.emit()}},e.duplicate)}renderRename(){const{strings:e}=this;return(0,s.h)("calcite-dropdown-item",{onClick:e=>{e.stopPropagation(),this.arcgisRename.emit()},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||this.arcgisRename.emit()}},e.rename)}static get assetsDirs(){return["assets"]}get el(){return(0,s.a)(this)}};v.style=":host{display:flex;height:100%;justify-content:stretch}calcite-action{height:100%}";const N=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.manager=(0,p.u)(this),this.popupState=(0,g.u)(),this.blockOpen=!1,this.expressionContent=void 0}async componentDidLoad(){this.blockOpen&&await this.launchArcade()}render(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"797fb942ddde685f3f9db65bdd9864b9a719df8a"},(0,s.h)("calcite-button",{key:"5abba50828d99e5cfd9c9fe825e8c969653852c7",disabled:e.blockFeatureReductionArcade,appearance:"transparent",width:"full",onClick:async()=>await this.launchArcade()},t.editExpression))}async launchArcade(){const{popupState:e}=this,{layer:t,mapView:i,layerDisplayType:s,popupTemplate:o,serviceType:a,strings:n}=e;this.arcadeEditorNode||(this.disablePopupPanel.emit(!0),this.arcadeEditorNode=document.createElement("arcgis-modal-arcade"),this.arcadeEditorNode.arcadeProfile=await(0,u.a)(t,i,a,o,s),this.arcadeEditorNode.testData=await(0,u.b)(t,i,s,o),this.arcadeEditorNode.arcadeScript=(0,u.c)(this.expressionContent.expressionInfo?.expression,s,n),this.arcadeEditorNode.suggestions=(0,u.e)(t,n,"popupElement"),this.arcadeEditorNode.addExistingExpressions=!0,this.arcadeEditorNode.layer=t,this.arcadeEditorNode.arcadeTitle=this.expressionContent.expressionInfo?.title||n.arcadeDefaultTitle,this.arcadeEditorNode.arcadeTitleEditable=!0,this.arcadeEditorNode.arcadeTitleEditingEnabled=!this.expressionContent.expressionInfo?.title,this.arcadeEditorNode.returnPredictOutputType=!1,document.body.appendChild(this.arcadeEditorNode),this.arcadeEditorNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.arcadeSetup(e.detail)})))}arcadeSetup(e){e&&(this.expressionContent.expressionInfo.expression=e.script,this.expressionContent.expressionInfo.title=e.title,(0,s.f)(this.el),this.arcgisChange.emit()),this.disablePopupPanel.emit(!1),document.body.removeChild(this.arcadeEditorNode),this.arcadeEditorNode=void 0}get el(){return(0,s.a)(this)}},k=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcgisDelete=(0,s.c)(this,"arcgisDelete",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.manager=(0,p.u)(this),this.popupState=(0,g.u)(),this.referenceElement=void 0,this.blockOpen=!1,this.associationsContent=void 0}closePopupPopoversHandler(){this.associationConfigPopoverNode?.parentElement?.removeChild(this.associationConfigPopoverNode),this.associationConfigPopoverNode=void 0,this.pickListNode?.parentElement?.removeChild(this.pickListNode),this.pickListNode=void 0,this.disablePopupPanel.emit(!1)}componentDidLoad(){const{blockOpen:e,associationsContent:t}=this;e&&(this.addAssociationsButtonNode?.scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),1===t.associationTypes.length&&this.openAssociationConfigPopoverNode(t.associationTypes[0]))}componentDidUpdate(){this.arcgisChange.emit()}render(){const{popupState:e}=this,{strings:t}=e,{associationsContent:i}=this,o=f.a.every((e=>(0,n.i)(i.associationTypes.find((t=>t.type===e)))));return(0,s.h)(s.H,{key:"4944056ba11fa19ba730daa31f4bc6af0519085b"},this.renderFormInput(t.title,f.b.title,i.title,t.enterTitle,(e=>this.titleNode=e)),this.renderFormInput(t.desc,f.b.description,i.description,t.enterDescription,(e=>this.descriptionNode=e)),this.renderFormInput(t.associations.previewCount,f.b.displayCount,`${i.displayCount??""}`,t.associations.enterPreviewCount),(0,s.h)("calcite-label",{key:"9783dcc482a9cccd07ec8920fadd5f37934f44d1",class:"disable-spacing",scale:"s"},t.associations.types),(0,s.h)("calcite-list",{key:"ff22a8e70828e8ad60b9402da18257a725328f50",label:t.associations.types,dragEnabled:!0,onCalciteListOrderChange:e=>{const t=e.detail.oldIndex,i=e.detail.newIndex;this.handleListOrderChange(t,i)}},this.associationsContent.associationTypes.map(((e,i)=>(0,s.h)("calcite-list-item",{key:e.type,label:e.title?this.getAssociationsBlockCustomDescription(e.title):t.noTitle,description:this.getAssociationTypeString(e.type),onClick:t=>{t.stopPropagation(),this.closePopupPopovers.emit(),this.openAssociationConfigPopoverNode(e)}},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:t.remove,onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.associationsContent.associationTypes.splice(i,1),0===this.associationsContent.associationTypes.length?this.arcgisDelete.emit():this.arcgisChange.emit(),(0,s.f)(this.el)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))))),o?(0,s.h)(s.F,null):(0,s.h)("calcite-button",{ref:e=>this.addAssociationsButtonNode=e,title:t.associations.addAssociation,appearance:"outline-fill",round:!0,scale:"s",class:"add-association-button",iconStart:"plus",onClick:e=>{if(e.stopPropagation(),this.closePopupPopovers.emit(),!this.associationConfigPopoverNode){const e=this.associationsContent.associationTypes.map((e=>e.type)),t={type:f.a.filter((t=>!e.includes(t)))[0]};this.associationsContent.associationTypes.push(t),this.openAssociationConfigPopoverNode(t),this.arcgisChange.emit()}}}))}renderFormInput(e,t,i,o,a){const{popupState:n}=this,{strings:l,popupTemplate:r}=n;return(0,s.h)("calcite-label",{scale:"s"},e,t===f.b.displayCount?(0,s.h)("calcite-input-number",{autofocus:!0,integer:!0,min:0,max:100,value:i,placeholder:o,onCalciteInputNumberInput:e=>{e.stopPropagation();const t=e.target,i=t.value,s=this.associationsContent.displayCount,o=Number.parseInt(i);s!==o&&(Number.isNaN(o)?(this.associationsContent.displayCount=null,t.value=""):o>t.max?(this.associationsContent.displayCount=t.max,t.value=`${t.max}`):o<t.min?(this.associationsContent.displayCount=t.min,t.value=`${t.min}`):this.associationsContent.displayCount=o,this.arcgisChange.emit())},onClick:()=>this.closePopupPopovers.emit()}):(0,s.h)("div",{class:"form-input-button"},t===f.b.title?(0,s.h)("calcite-input",{class:"input",type:"text",autofocus:!0,value:i,placeholder:o,onCalciteInputInput:e=>{e.stopPropagation();const t=e.target.value;this.associationsContent.title=t,this.arcgisChange.emit()},onClick:()=>this.closePopupPopovers.emit(),ref:a}):(0,s.h)("calcite-text-area",{resize:"vertical",autofocus:!0,value:i,placeholder:o,onCalciteTextAreaInput:e=>{e.stopPropagation();const t=e.target.value;this.associationsContent.description=t,(0,s.f)(this.el),this.arcgisChange.emit()},ref:a}),r.fieldInfos?.length?(0,s.h)("calcite-action",{text:l.attributes,scale:"s",icon:"brackets-curly",onClick:()=>{const{popupState:e}=this;this.closePopupPopovers.emit(),this.pickListNode||(this.pickListNode=document.createElement("arcgis-popup-field-pick-list"),this.pickListNode.popupState=e,this.pickListNode.popoverProps={refElement:this.referenceElement,offsetSkidding:50},this.pickListNode.heading=l.addField,this.pickListNode.multiple=!1,this.pickListNode.addEventListener("arcgisChange",(e=>{e.stopPropagation();const i=e.detail.selectedFields[0];this.handlePickListChange(i,t)})),this.pickListNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.closePopupPopovers.emit()})),document.body.appendChild(this.pickListNode),this.disablePopupPanel.emit(!0))}}):(0,s.h)(s.F,null)))}handleListOrderChange(e,t){const i=this.associationsContent.associationTypes[e];this.associationsContent.associationTypes.splice(e,1),this.associationsContent.associationTypes.splice(t,0,i),this.arcgisChange.emit(),this.closePopupPopovers.emit(),(0,s.f)(this.el)}getAssociationsBlockCustomDescription(e){return`${e.substring(0,25)}${e.length>25?"...":""}`}getAssociationTypeString(e){const{popupState:t}=this,{strings:i}=t;switch(e){case"attachment":return i.associations.attachment;case"connectivity":return i.associations.connectivity;case"container":return i.associations.container;case"content":return i.associations.content;case"structure":return i.associations.structure}}handlePickListChange(e,t){t===f.b.title?((0,y.a)(this.titleNode,e),this.associationsContent.title=this.titleNode.value):((0,y.a)(this.descriptionNode,e),this.associationsContent.description=this.descriptionNode.value),this.closePopupPopovers.emit(),this.arcgisChange.emit()}openAssociationConfigPopoverNode(e){const{popupState:t}=this;this.associationConfigPopoverNode=document.createElement("arcgis-popup-association-config-popover"),this.associationConfigPopoverNode.popupState=t,this.associationConfigPopoverNode.referenceElement=this.referenceElement,this.associationConfigPopoverNode.associationsContent=this.associationsContent,this.associationConfigPopoverNode.associationType=e,this.associationConfigPopoverNode.addEventListener("arcgisChange",(e=>{e.stopPropagation(),(0,s.f)(this.el)})),document.body.appendChild(this.associationConfigPopoverNode),this.disablePopupPanel.emit(!0)}get el(){return(0,s.a)(this)}};k.style=".disable-spacing{--calcite-label-margin-bottom:0}.form-input-button{display:flex}.input{width:100%}calcite-text-area{width:100%;--calcite-text-area-min-width:0;--calcite-text-area-min-height:42px}.add-association-button{display:flex;justify-content:center;margin-top:var(--calcite-spacing-sm)}";const w=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.manager=(0,p.u)(this),this.attachmentSortOptionsMap=new Map,this.popupState=(0,g.u)(),this.popupFlowItem=void 0,this.blockOpen=!1,this.attachmentsContent=void 0,this.layerSupportsResizeAttachments=void 0,this.layerSupportsOrderingAttachments=void 0}closePopupPopoversHandler(){this.pickListNode&&(document.body.removeChild(this.pickListNode),this.pickListNode=void 0,this.disablePopupPanel.emit(!1))}componentWillLoad(){this.setUpAttachmentSortByMap(),this.layerSupportsResizeAttachments?this.attachmentsContent.displayType||(this.attachmentsContent.displayType=m.A.AUTO,this.arcgisChange.emit()):this.attachmentsContent.displayType=m.A.LIST,this.attachmentsContent.title=this.attachmentsContent.title||"",this.attachmentsContent.description=this.attachmentsContent.description||""}componentDidUpdate(){this.arcgisChange.emit()}disconnectedCallback(){this.pickListNode&&document.body.removeChild(this.pickListNode)}render(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"2eb64ca3d627768e0581bbd75bd9f3287dadb6d7"},this.renderAttachmentDisplayType(),(0,s.h)("div",{key:"50850b41801b6f3d3727282d6bd5fd65f4b236b2"},this.renderFormInput("title",t.title,this.attachmentsContent.title,t.enterTitle,(e=>this.attachmentsTitleNode=e)),this.renderFormInput("description",t.desc,this.attachmentsContent.description,t.enterDescription,(e=>this.attachmentsDescriptionNode=e)),this.layerSupportsOrderingAttachments&&this.renderSortBy(),this.layerSupportsOrderingAttachments&&this.renderSortOrder(),!this.layerSupportsResizeAttachments&&this.renderListOnlyMessage()))}renderAttachmentDisplayType(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)("calcite-label",null,t.displayAttachmentsAs,(0,s.h)("calcite-segmented-control",{width:"full",scale:"s",disabled:!this.layerSupportsResizeAttachments,onCalciteSegmentedControlChange:e=>{const t=e.target.selectedItem;this.attachmentsContent.displayType=t.value,(0,s.f)(this.el)}},(0,s.h)("calcite-segmented-control-item",{value:m.A.AUTO,iconStart:"check",checked:this.attachmentsContent.displayType===m.A.AUTO},t.auto),(0,s.h)("calcite-segmented-control-item",{value:m.A.LIST,iconStart:"list",checked:this.attachmentsContent.displayType===m.A.LIST},t.list),(0,s.h)("calcite-segmented-control-item",{value:m.A.PREVIEW,iconStart:"image",checked:this.attachmentsContent.displayType===m.A.PREVIEW},t.gallery)),(0,s.h)("calcite-label",{scale:"s"},this.getDisplayTypeMessage()))}renderFormInput(e,t,i,o,a){const{popupState:n}=this,{strings:l,popupTemplate:r}=n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},"title"===e?(0,s.h)("calcite-input",{class:"input",type:"text",autofocus:!0,value:i,placeholder:o,onCalciteInputInput:e=>{e.stopPropagation();const t=e.target.value;this.attachmentsContent.title=t,(0,s.f)(this.el)},onClick:()=>this.closePopupPopovers.emit(),ref:a}):(0,s.h)("calcite-text-area",{resize:"vertical",autofocus:!0,value:i,placeholder:o,onCalciteTextAreaInput:e=>{e.stopPropagation();const t=e.target.value;this.attachmentsContent.description=t,(0,s.f)(this.el),this.arcgisChange.emit()},ref:a}),r.fieldInfos?.length&&(0,s.h)("calcite-action",{text:l.attributes,scale:"s",icon:"brackets-curly",onClick:()=>{const{popupState:t}=this;this.closePopupPopovers.emit(),this.pickListNode||(this.pickListNode=document.createElement("arcgis-popup-field-pick-list"),this.pickListNode.popoverProps={refElement:this.popupFlowItem},this.pickListNode.multiple=!1,this.pickListNode.heading=l.addField,this.pickListNode.popupState=t,this.pickListNode.addEventListener("arcgisChange",(t=>{t.stopPropagation();const i=t.detail.selectedFields[0];this.handlePickListChange(i,e)})),this.pickListNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.closePopupPopovers.emit()})),document.body.appendChild(this.pickListNode),this.disablePopupPanel.emit(!0))}})))}renderSortBy(){const{popupState:e,attachmentSortOptionsMap:t}=this,{strings:i}=e,o=(0,n.i)(this.attachmentsContent.orderByFields?.[0]),a=Array.from(t.entries()).map((([e,t])=>{const a=o?this.attachmentsContent.orderByFields[0].field===t:"id"===e;return(0,s.h)("calcite-dropdown-item",{selected:a,onClick:()=>{o?this.attachmentsContent.orderByFields[0].field=t:this.attachmentsContent.orderByFields=[{field:t,order:"ascending"}],(0,s.f)(this.el)}},i[e])}));return(0,s.h)("calcite-label",null,i.sortBy,(0,s.h)("calcite-dropdown",{overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full"},o?i[Array.from(t.entries()).find((([,e])=>this.attachmentsContent.orderByFields[0].field===e))[0]]:i.id),a))}renderSortOrder(){const{popupState:e}=this,{strings:t}=e,i=(0,n.i)(this.attachmentsContent.orderByFields?.[0]);return(0,s.h)("calcite-label",null,t.sortOrder,(0,s.h)("calcite-dropdown",{overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full"},i?t[this.attachmentsContent.orderByFields[0].order]:t.ascending),(0,s.h)("calcite-dropdown-item",{selected:!i||"ascending"===this.attachmentsContent.orderByFields[0].order,onClick:()=>{i?this.attachmentsContent.orderByFields[0].order="ascending":this.attachmentsContent.orderByFields=[{field:this.attachmentSortOptionsMap.get("id"),order:"ascending"}],(0,s.f)(this.el)}},t.ascending),(0,s.h)("calcite-dropdown-item",{selected:"descending"===this.attachmentsContent.orderByFields?.[0]?.order,onClick:()=>{i?this.attachmentsContent.orderByFields[0].order="descending":this.attachmentsContent.orderByFields=[{field:this.attachmentSortOptionsMap.get("id"),order:"descending"}],(0,s.f)(this.el)}},t.descending)))}renderListOnlyMessage(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)("div",{class:"list-warning-wrapper"},(0,s.h)("span",{class:"list-warning-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:"exclamation-mark-triangle"})),(0,s.h)("span",{class:"list-warning-text"},t.layerOnlySupportsListView))}setUpAttachmentSortByMap(){const{popupState:e}=this,{layer:t}=e;if(this.attachmentSortOptionsMap.set("id","ATTACHMENTID"),this.attachmentSortOptionsMap.set("contentType","CONTENT_TYPE"),this.attachmentSortOptionsMap.set("name","ATT_NAME"),this.attachmentSortOptionsMap.set("size","DATA_SIZE"),"fields"in t){t.fields.find((e=>"global-id"===e.type))&&this.attachmentSortOptionsMap.set("globalId","AttachmentGlobalId")}}getDisplayTypeMessage(){const{popupState:e}=this,{strings:t}=e;switch(this.attachmentsContent.displayType){case m.A.AUTO:return t.autoDisplayMessage;case m.A.LIST:return t.listDisplayMessage;case m.A.PREVIEW:return t.previewDisplayMessage;default:return t.listDisplayMessage}}handlePickListChange(e,t){"title"===t?((0,y.a)(this.attachmentsTitleNode,e),this.attachmentsContent.title=this.attachmentsTitleNode.value):"description"===t&&((0,y.a)(this.attachmentsDescriptionNode,e),this.attachmentsContent.description=this.attachmentsDescriptionNode.value),this.closePopupPopovers.emit(),(0,s.f)(this.el)}get el(){return(0,s.a)(this)}};w.style=".form-input-button{display:flex}.input{width:100%}calcite-text-area{width:100%;--calcite-text-area-min-width:0;--calcite-text-area-min-height:42px}.list-warning-wrapper{border:1px solid var(--calcite-color-foreground-3);display:flex;font-size:var(--calcite-font-size-sm)}.list-warning-icon{display:flex;align-items:center;padding:0 var(--calcite-spacing-sm);background-color:var(--calcite-color-foreground-2)}.list-warning-text{padding:var(--calcite-spacing-xs) var(--calcite-spacing-sm)}";const F=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.manager=(0,p.u)(this),this.arcadeExpMap=new Map,this.listItems=[],this.popupState=(0,g.u)(),this.popupFlowItem=void 0,this.fieldsContent=void 0}arcadeChangeNotificationHandler(){(0,s.f)(this.el)}closePopupPopoversHandler(){this.selectFieldsPickListNode&&(document.body.removeChild(this.selectFieldsPickListNode),this.selectFieldsPickListNode=void 0,this.blockOptionsNode?.setFocus(),this.disablePopupPanel.emit(!1)),this.fieldsContentPickListNode&&(document.body.removeChild(this.fieldsContentPickListNode),this.fieldsContentPickListNode=void 0,this.disablePopupPanel.emit(!1))}async syncWithFieldsList(){this.fieldsContent.fieldInfos.forEach(((e,t)=>{this.fieldInfoMap.has(e.fieldName)&&(this.fieldsContent.fieldInfos[t]=this.fieldInfoMap.get(e.fieldName).clone(),this.fieldsContent.fieldInfos[t].visible=!0)})),(0,s.f)(this.el)}componentWillLoad(){this.setUpFieldMapInfo()}componentWillRender(){const{popupState:e}=this,{popupTemplate:t}=e;this.setUpFieldMapInfo(),this.arcadeExpMap=(0,n.m)(t),this.listItems=[],this.fieldsContent.fieldInfos.forEach((e=>this.listItems.push(this.renderListItem(e))))}componentDidUpdate(){this.arcgisChange.emit()}disconnectedCallback(){this.selectFieldsPickListNode&&document.body.removeChild(this.selectFieldsPickListNode),this.fieldsContentPickListNode&&document.body.removeChild(this.fieldsContentPickListNode)}render(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"4506f6b1e4c23be2654daa2c5ce6356de387f579"},this.renderFormInput("title",t.title,this.fieldsContent.title,t.enterTitle,(e=>this.titleNode=e)),this.renderFormInput("description",t.desc,this.fieldsContent.description,t.enterDescription,(e=>this.descriptionNode=e)),(0,s.h)("calcite-button",{key:"9e7ac6572257fd6dff4c8d9285aeb05247091982",class:"select-fields-button",appearance:"transparent",width:"full",onClick:e=>{e.stopPropagation(),this.openSelectFieldsPickList()}},t.selectAttributes),(0,s.h)("calcite-list",{key:"dff81de6dcc75e4146ee47c4a632e291b1095b4d",label:t.attributes,dragEnabled:!0,onCalciteListOrderChange:e=>{const t=e.target,i=[];t.childNodes.forEach((e=>{this.fieldsContent.fieldInfos.forEach((t=>{t.fieldName===e.value&&i.push(t)}))})),this.fieldsContent.fieldInfos=i,this.arcgisChange.emit()}},this.listItems))}renderListItem(e){const{popupState:t}=this,{strings:i}=t;return(0,s.h)("calcite-list-item",{key:e.fieldName,label:(0,n.o)(e,this.arcadeExpMap),value:e.fieldName},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:i.remove,onClick:()=>this.removeField(e.fieldName)},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}renderFormInput(e,t,i,o,a){const{popupState:n}=this,{strings:l,popupTemplate:r}=n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},"title"===e?(0,s.h)("calcite-input",{class:"input",type:"text",autofocus:!0,value:i,placeholder:o,onCalciteInputInput:e=>{e.stopPropagation();const t=e.target.value;this.fieldsContent.title=t,(0,s.f)(this.el),this.arcgisChange.emit()},onClick:()=>this.closePopupPopovers.emit(),ref:a}):(0,s.h)("calcite-text-area",{resize:"vertical",autofocus:!0,value:i,placeholder:o,onCalciteTextAreaInput:e=>{e.stopPropagation();const t=e.target.value;this.fieldsContent.description=t,(0,s.f)(this.el),this.arcgisChange.emit()},ref:a}),r.fieldInfos?.length&&(0,s.h)("calcite-action",{text:l.attributes,scale:"s",icon:"brackets-curly",onClick:()=>{const{popupState:t}=this;this.closePopupPopovers.emit(),this.fieldsContentPickListNode||(this.fieldsContentPickListNode=document.createElement("arcgis-popup-field-pick-list"),this.fieldsContentPickListNode.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.fieldsContentPickListNode.multiple=!1,this.fieldsContentPickListNode.heading=l.addField,this.fieldsContentPickListNode.popupState=t,this.fieldsContentPickListNode.addEventListener("arcgisChange",(t=>{t.stopPropagation();const i=t.detail.selectedFields[0];this.handleFieldsContentPickListChange(i,e)})),this.fieldsContentPickListNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.closePopupPopovers.emit()})),document.body.appendChild(this.fieldsContentPickListNode),this.disablePopupPanel.emit(!0))}})))}setUpFieldMapInfo(){const{popupState:e}=this,{popupTemplate:t}=e;this.fieldInfoMap=new Map(t.fieldInfos.map((e=>[e.fieldName,e])))}openSelectFieldsPickList(){const{popupState:e}=this,{strings:t}=e;this.closePopupPopovers.emit(),this.selectFieldsPickListNode||(this.selectFieldsPickListNode=document.createElement("arcgis-popup-field-pick-list"),this.selectFieldsPickListNode.popoverProps={refElement:this.popupFlowItem},this.selectFieldsPickListNode.selectedFields=this.getSelectedFields(),this.selectFieldsPickListNode.hideCancel=!0,this.selectFieldsPickListNode.multiple=!0,this.selectFieldsPickListNode.heading=t.selectFields,this.selectFieldsPickListNode.okBtnText=t.done,this.selectFieldsPickListNode.popupState=e,this.selectFieldsPickListNode.addEventListener("arcgisChange",(e=>{e.stopPropagation();const t=e.detail.selectedFields;this.handleSelectFieldsPickListChange(t)})),this.selectFieldsPickListNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.closePopupPopovers.emit()})),document.body.appendChild(this.selectFieldsPickListNode),this.disablePopupPanel.emit(!0))}getSelectedFields(){return this.fieldsContent.fieldInfos.map((e=>e.fieldName))}handleSelectFieldsPickListChange(e){this.setUpFieldMapInfo();const t=[];e.forEach((e=>{if(this.fieldInfoMap.has(e)){const i=this.fieldInfoMap.get(e)?.clone();i.visible=!0,t.push(i)}})),this.fieldsContent.fieldInfos=[...t],(0,s.f)(this.el),this.arcgisChange.emit()}handleFieldsContentPickListChange(e,t){"title"===t?((0,y.a)(this.titleNode,e),this.fieldsContent.title=this.titleNode.value):"description"===t&&((0,y.a)(this.descriptionNode,e),this.fieldsContent.description=this.descriptionNode.value),this.closePopupPopovers.emit(),(0,s.f)(this.el),this.arcgisChange.emit()}removeField(e){this.closePopupPopovers.emit();const t=this.fieldsContent.fieldInfos.find((t=>t.fieldName===e));t&&this.fieldsContent.fieldInfos.splice(this.fieldsContent.fieldInfos.indexOf(t),1),(0,s.f)(this.el),this.arcgisChange.emit()}get el(){return(0,s.a)(this)}};F.style=".form-input-button{display:flex}.input{width:100%}calcite-text-area{width:100%;--calcite-text-area-min-width:0;--calcite-text-area-min-height:42px}.select-fields-button{margin-bottom:var(--calcite-spacing-sm)}";const I=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.manager=(0,p.u)(this),this.filterLength=5,this.calciteListItems=[],this.popupState=void 0}async componentWillLoad(){await this.loadAllModules()}componentWillRender(){const{popupState:e}=this,{popupTemplate:t}=e;this.calciteListItems=[],t.expressionInfos?.length&&t.expressionInfos.forEach((e=>this.calciteListItems.push(this.getCalciteListItem(e))))}async setFocus(){this.panelNode?.setFocus()}render(){const{popupState:e,filterLength:t}=this,{strings:i,popupTemplate:o}=e;return(0,s.h)(s.H,{key:"ade46b77b6864e1510a9660a20a956107c666962",class:"calcite-match-height"},(0,s.h)("calcite-panel",{key:"eae54fb8a38aeccc9a51f5678f86b5a6c225f09c",ref:e=>this.panelNode=e},o.expressionInfos?.length?(0,s.h)("calcite-list",{label:i.manageExpressions,filterEnabled:this.calciteListItems.length>=t},this.calciteListItems):null,this.renderAddExpression()))}renderAddExpression(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)("calcite-fab",{disabled:e.blockFeatureReductionArcade,slot:"fab",class:"fab",icon:"plus",scale:"s",appearance:"outline-fill",kind:"neutral",label:t.addExpression,text:t.addExpression,textEnabled:!0,onClick:e=>{e.stopPropagation(),this.launchArcade()},ref:e=>this.fabNode=e})}async loadAllModules(){this.FieldInfo=await(0,C.f)(),this.PopupExpressionInfo=await(0,C.aB)()}getCalciteListItem(e){const{popupState:t}=this,{strings:i}=t;return(0,s.h)("calcite-list-item",{disabled:t.blockFeatureReductionArcade,label:e.title,description:`{${a.f.expression}${e.name}}`,value:e.name,onClick:t=>{t.stopPropagation(),this.launchArcade(e)}},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:i.remove,onClick:t=>{t.stopPropagation(),this.handleRemoveArcadeExpression(e.name)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}async launchArcade(e){const{popupState:t}=this,{layer:i,mapView:s,layerDisplayType:o,strings:a,serviceType:n,popupTemplate:l}=t;this.arcadeEditorNode||(this.panelNode.disabled=!0,this.arcadeEditorNode=document.createElement("arcgis-modal-arcade"),this.arcadeEditorNode.arcadeProfile=await(0,u.a)(i,s,n,l,o),this.arcadeEditorNode.testData=await(0,u.b)(i,s,o,l),this.arcadeEditorNode.arcadeScript=(0,u.c)(e?.expression,o,a),this.arcadeEditorNode.suggestions=(0,u.e)(i,a,"attributeExpression"),this.arcadeEditorNode.addExistingExpressions=!0,this.arcadeEditorNode.layer=i,this.arcadeEditorNode.arcadeTitle=e?.title||a.arcadeDefaultTitle,this.arcadeEditorNode.arcadeTitleEditable=!0,this.arcadeEditorNode.arcadeTitleEditingEnabled=!e?.title,document.body.appendChild(this.arcadeEditorNode),this.arcadeEditorNode.addEventListener("arcgisClose",(t=>{t.stopPropagation(),this.arcadeSetup(t.detail,e),setTimeout((()=>{this.fabNode?.setFocus()}),300)})))}async arcadeSetup(e,t){const{popupState:i}=this,{popupTemplate:s}=i;e&&((0,u.s)(e,t?.name,this.PopupExpressionInfo,s),await this.setUpPopupExpressionDisplay()),this.panelNode.disabled=!1,document.body.removeChild(this.arcadeEditorNode),this.arcadeEditorNode=void 0}async setUpPopupExpressionDisplay(){const{popupState:e}=this;await(0,u.f)(e,this.FieldInfo),this.arcadeChangeNotification.emit(),(0,s.f)(this.el),this.arcgisChange.emit()}handleRemoveArcadeExpression(e){const{popupState:t}=this,{popupTemplate:i}=t,s=i.expressionInfos.find((t=>t.name===e));if(s){i.expressionInfos.splice(i.expressionInfos.indexOf(s),1);i.content.filter((e=>"fields"===e.type)).forEach((t=>{const i=t.fieldInfos.find((t=>t.fieldName===`${a.f.expression}${e}`));i&&t.fieldInfos.splice(t.fieldInfos.indexOf(i),1)}));i.content.filter((e=>"media"===e.type)).forEach((t=>{t.mediaInfos.filter((e=>"image"!==e.type)).forEach((t=>{const i=t.value.fields,s=t.value.normalizeField,o=i.find((t=>t===`${a.f.expression}${e}`));o&&i.splice(i.indexOf(o),1),s===`${a.f.expression}${e}`&&(t.value.normalizeField=null)}))}))}this.setUpPopupExpressionDisplay()}get el(){return(0,s.a)(this)}};I.style=":host{height:100%}";const L=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcgisDelete=(0,s.c)(this,"arcgisDelete",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.manager=(0,p.u)(this),this.popupState=(0,g.u)(),this.popupFlowItem=void 0,this.blockOpen=!1,this.mediaContent=void 0}arcadeChangeNotificationHandler(){(0,s.f)(this.el)}closePopupPopoversHandler(){this.imageNode&&(document.body.removeChild(this.imageNode),this.imageNode=void 0,this.addMediaButtonNode?.setFocus(),this.disablePopupPanel.emit(!1)),this.chartNode&&(document.body.removeChild(this.chartNode),this.chartNode=void 0,this.addMediaButtonNode?.setFocus(),this.disablePopupPanel.emit(!1)),this.mediaContentPopoverNode&&(document.body.removeChild(this.mediaContentPopoverNode),this.mediaContentPopoverNode=void 0,this.addMediaButtonNode.disabled=!1,this.addMediaButtonNode?.setFocus(),this.disablePopupPanel.emit(!1)),this.pickListNode&&(document.body.removeChild(this.pickListNode),this.pickListNode=void 0,this.disablePopupPanel.emit(!1))}async resetMultimediaIndex(){this.setActiveMediaInfoIndex(0,!0)}async componentWillLoad(){await this.loadAllModules(),this.modules.reactiveUtils.watch((()=>this.popupState.mapView.popup?.selectedFeature),(()=>this.setActiveMediaInfoIndex(0))),this.modules.reactiveUtils.watch((()=>this.popupState.mapView.popup?.visible),(()=>this.setActiveMediaInfoIndex(0))),this.mediaContent.title=this.mediaContent.title||"",this.mediaContent.description=this.mediaContent.description||""}componentDidLoad(){this.blockOpen&&(this.addMediaButtonNode?.scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),1===this.mediaContent.mediaInfos.length&&this.openMediaInfoPopover(this.mediaContent.mediaInfos[0],0))}componentDidUpdate(){this.arcgisChange.emit()}disconnectedCallback(){this.imageNode&&document.body.removeChild(this.imageNode),this.chartNode&&document.body.removeChild(this.chartNode),this.mediaContentPopoverNode&&document.body.removeChild(this.mediaContentPopoverNode),this.pickListNode&&document.body.removeChild(this.pickListNode)}render(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"ca3d12c1170e9f32c8d49a9f1dd184dc45a07b8f"},this.renderFormInput("title",t.title,this.mediaContent.title,t.enterTitle,(e=>this.titleNode=e)),this.renderFormInput("description",t.desc,this.mediaContent.description,t.enterDescription,(e=>this.descriptionNode=e)),(0,s.h)("calcite-label",{key:"95d3c62d2e51fb00ba5661ae29da20e5f6092f88",class:"disable-spacing",scale:"s"},t.mediaContent),(0,s.h)("calcite-list",{key:"06f4e5683a50338e8aeea2b14484f58f62086d85",label:t.mediaContent,dragEnabled:!0,onCalciteListOrderChange:e=>{const t=e.detail.oldIndex,i=e.detail.newIndex;this.handleListOrderChange(t,i)}},this.mediaContent.mediaInfos.map(((e,i)=>(0,s.h)("calcite-list-item",{key:JSON.stringify(e),label:e.title&&`${e.title.substring(0,25)}${e.title.length>25?"...":""}`||t.noTitle,description:this.getMultimediaTypeString(e.type),onClick:t=>{t.stopPropagation(),this.closePopupPopovers.emit();t.composedPath().some((e=>"CALCITE-SORT-HANDLE"===e.tagName))||this.openMediaInfoPopover(e,i)}},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:t.remove,onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.mediaContent.mediaInfos.splice(i,1),0===this.mediaContent.mediaInfos.length?this.arcgisDelete.emit():(this.setActiveMediaInfoIndex(0),this.arcgisChange.emit()),(0,s.f)(this.el)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))))),(0,s.h)("calcite-button",{key:"3c9464c02eabfe45636c4a1f81324286b03e1e98",title:t.addMedia,appearance:"outline-fill",round:!0,scale:"s",class:"add-media-button",iconStart:"plus",onClick:e=>{const{popupState:t}=this;e.stopPropagation(),this.closePopupPopovers.emit(),this.mediaContentPopoverNode||(this.mediaContentPopoverNode=document.createElement("arcgis-popup-add-content-popover"),this.mediaContentPopoverNode.referenceElement=this.addMediaButtonNode,this.mediaContentPopoverNode.popoverPanelWidth=this.el.getBoundingClientRect().width,this.mediaContentPopoverNode.isMultimediaContent=!0,this.mediaContentPopoverNode.popupState=t,this.mediaContentPopoverNode.addEventListener("arcgisAddMultimediaContent",(e=>{const t=e.detail;this.handleAddMultimediaContentToExistingContent(t)})),document.body.appendChild(this.mediaContentPopoverNode),this.addMediaButtonNode.disabled=!0,this.disablePopupPanel.emit(!0))},ref:e=>this.addMediaButtonNode=e}))}renderFormInput(e,t,i,o,a){return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},"title"===e?(0,s.h)("calcite-input",{class:"input",type:"text",autofocus:!0,value:i,placeholder:o,onCalciteInputInput:e=>{e.stopPropagation();const t=e.target.value;this.mediaContent.title=t,(0,s.f)(this.el)},onClick:()=>this.closePopupPopovers.emit(),ref:a}):(0,s.h)("calcite-text-area",{resize:"vertical",autofocus:!0,value:i,placeholder:o,onCalciteTextAreaInput:e=>{e.stopPropagation();const t=e.target.value;this.mediaContent.description=t,(0,s.f)(this.el),this.arcgisChange.emit()},ref:a}),this.popupState.popupTemplate.fieldInfos?.length&&(0,s.h)("calcite-action",{text:this.popupState.strings.attributes,scale:"s",icon:"brackets-curly",onClick:()=>{const{popupState:t}=this;this.closePopupPopovers.emit(),this.pickListNode||(this.pickListNode=document.createElement("arcgis-popup-field-pick-list"),this.pickListNode.popoverProps={refElement:this.popupFlowItem},this.pickListNode.multiple=!1,this.pickListNode.heading=t.strings.addField,this.pickListNode.popupState=t,this.pickListNode.addEventListener("arcgisChange",(t=>{t.stopPropagation();const i=t.detail.selectedFields[0];this.handlePickListChange(i,e)})),this.pickListNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.closePopupPopovers.emit()})),document.body.appendChild(this.pickListNode),this.disablePopupPanel.emit(!0))}})))}async loadAllModules(){const[e,t,i,s,o]=await Promise.all([(0,C.l)(),(0,C.X)(),(0,C.Y)(),(0,C.Z)(),(0,C._)()]);this.modules={reactiveUtils:e,ImageMediaInfo:t,ColumnChartMediaInfo:i,ImageMediaInfoValue:s,ChartMediaInfoValue:o}}async handleAddMultimediaContentToExistingContent(e){const{modules:t}=this;let i;this.closePopupPopovers.emit(),e===m.C.IMAGES?i=new t.ImageMediaInfo({title:"",caption:"",altText:"",value:new t.ImageMediaInfoValue({sourceURL:"",linkURL:""})}):e===m.C.CHARTS&&(i=new t.ColumnChartMediaInfo({title:"",caption:"",altText:"",value:new t.ChartMediaInfoValue({fields:[]})})),this.mediaContent.mediaInfos.push(i),(0,s.f)(this.el),this.openMediaInfoPopover(i,this.mediaContent.mediaInfos.length-1)}getMultimediaTypeString(e){const{popupState:t}=this,{strings:i}=t;return e===m.P.IMAGE?i.image:e===m.P.BAR_CHART||e===m.P.COLUMN_CHART?i.barChart:e===m.P.LINE_CHART?i.lineChart:e===m.P.PIE_CHART?i.pieChart:i.image}setActiveMediaInfoIndex(e,t){this.mediaContent.activeMediaInfoIndex=e||0,t&&this.arcgisChange.emit()}openMediaInfoPopover(e,t){const{popupState:i}=this;e.type===m.P.IMAGE?(this.imageNode=document.createElement("arcgis-popup-image"),this.imageNode.referenceElement=this.popupFlowItem,this.imageNode.imageMediaInfo=e,this.imageNode.mediaIndexPosition=t,this.imageNode.popupState=i,this.imageNode.addEventListener("arcgisMultimediaChange",(e=>{const t=e.detail;this.setActiveMediaInfoIndex(t),(0,s.f)(this.el)})),document.body.appendChild(this.imageNode)):(this.chartNode=document.createElement("arcgis-popup-chart"),this.chartNode.referenceElement=this.popupFlowItem,this.chartNode.chartMediaInfo=e,this.chartNode.mediaContent=this.mediaContent,this.chartNode.mediaIndexPosition=t,this.chartNode.popupState=i,this.chartNode.addEventListener("arcgisMultimediaChange",(e=>{const t=e.detail;this.setActiveMediaInfoIndex(t),(0,s.f)(this.el)})),document.body.appendChild(this.chartNode)),this.disablePopupPanel.emit(!0)}handlePickListChange(e,t){"title"===t?((0,y.a)(this.titleNode,e),this.mediaContent.title=this.titleNode.value):"description"===t&&((0,y.a)(this.descriptionNode,e),this.mediaContent.description=this.descriptionNode.value),this.closePopupPopovers.emit(),(0,s.f)(this.el)}handleListOrderChange(e,t){const i=this.mediaContent.mediaInfos[e];this.mediaContent.mediaInfos.splice(e,1),this.mediaContent.mediaInfos.splice(t,0,i),this.arcgisChange.emit(),this.closePopupPopovers.emit(),this.setActiveMediaInfoIndex(0,!0),(0,s.f)(this.el)}get el(){return(0,s.a)(this)}};L.style=".add-media-button{display:flex;justify-content:center;margin-top:var(--calcite-spacing-sm)}.form-input-button{display:flex}.input{width:100%}calcite-text-area{width:100%;--calcite-text-area-min-width:0;--calcite-text-area-min-height:42px}.disable-spacing{--calcite-label-margin-bottom:0}";const E=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.manager=(0,p.u)(this),this.maxPreviewCount=11,this.popupState=(0,g.u)(),this.popupFlowItem=void 0,this.relationshipContent=void 0,this.hasRelationshipLayer=!0}closePopupPopoversHandler(){this.relationshipFormInputPickListNode&&(document.body.removeChild(this.relationshipFormInputPickListNode),this.relationshipFormInputPickListNode=void 0,this.disablePopupPanel.emit(!1)),this.sortByPickerNode&&(document.body.removeChild(this.sortByPickerNode),this.sortByPickerNode=void 0,this.disablePopupPanel.emit(!1))}async componentWillLoad(){const{popupState:e}=this;await this.loadAllModules(),this.hasRelationshipLayer=await(0,g.c)(e,this.relationshipContent),this.relationshipContent.title=this.relationshipContent.title||"",this.relationshipContent.description=this.relationshipContent.description||""}componentDidLoad(){this.setUpLayerTableListWatcher()}componentDidUpdate(){this.arcgisChange.emit()}disconnectedCallback(){this.relationshipFormInputPickListNode&&document.body.removeChild(this.relationshipFormInputPickListNode),this.sortByPickerNode&&document.body.removeChild(this.sortByPickerNode),this.layerTableListWatcher?.remove()}render(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"6479383da8447c484573dab888ab57c47404303f"},this.renderFormInput("title",t.title,this.relationshipContent.title,t.enterTitle,(e=>this.relationshipTitleNode=e)),this.renderFormInput("description",t.desc,this.relationshipContent.description,t.enterDescription,(e=>this.relationshipDescriptionNode=e)),this.renderRelationshipSelector(),this.renderSortBy(),this.renderSortOrder(),this.renderPreviewCount())}renderFormInput(e,t,i,o,a){return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},"title"===e?(0,s.h)("calcite-input",{class:"input",type:"text",autofocus:!0,value:i,placeholder:o,disabled:!this.hasRelationshipLayer,onCalciteInputInput:e=>{e.stopPropagation();const t=e.target.value;this.relationshipContent.title=t,(0,s.f)(this.el)},onClick:()=>this.closePopupPopovers.emit(),ref:a}):(0,s.h)("calcite-text-area",{resize:"vertical",autofocus:!0,value:i,placeholder:o,onCalciteTextAreaInput:e=>{e.stopPropagation();const t=e.target.value;this.relationshipContent.description=t,(0,s.f)(this.el),this.arcgisChange.emit()},ref:a}),this.popupState.popupTemplate.fieldInfos?.length&&(0,s.h)("calcite-action",{text:this.popupState.strings.attributes,scale:"s",icon:"brackets-curly",disabled:!this.hasRelationshipLayer,onClick:()=>{const{popupState:t}=this;this.closePopupPopovers.emit(),this.relationshipFormInputPickListNode||(this.relationshipFormInputPickListNode=document.createElement("arcgis-popup-field-pick-list"),this.relationshipFormInputPickListNode.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.relationshipFormInputPickListNode.multiple=!1,this.relationshipFormInputPickListNode.heading=this.popupState.strings.addField,this.relationshipFormInputPickListNode.popupState=t,this.relationshipFormInputPickListNode.addEventListener("arcgisChange",(t=>{t.stopPropagation();const i=t.detail.selectedFields[0];this.handleRelationshipFormInputPickListChange(i,e)})),this.relationshipFormInputPickListNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.closePopupPopovers.emit()})),document.body.appendChild(this.relationshipFormInputPickListNode),this.disablePopupPanel.emit(!0))}})))}renderRelationshipSelector(){const{popupState:e}=this,{strings:t,layer:i,mapView:o}=e,a=i.relationships.find((e=>e.id===this.relationshipContent.relationshipId)),n=i.relationships.map((e=>{const a=(0,g.a)(o);for(const o of a){const a=o;if((0,g.r)(i,a,e))return(0,s.h)("calcite-dropdown-item",{selected:this.relationshipContent.relationshipId===e.id,onClick:async()=>{await a.load(),this.relationshipContent.relationshipId=e.id,this.relationshipContent.orderByFields=[new this.RelatedRecordsInfoFieldOrder({field:a.fields.find((e=>e.visible)).name,order:this.relationshipContent.orderByFields?.[0].order||"asc"})],(0,s.f)(this.el)}},e.name||t.relationship)}}));return(0,s.h)("calcite-label",null,t.relationship,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed",class:"dropdown"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full"},a?.name||t.relationship),(0,s.h)("calcite-dropdown-group",null,n)))}renderSortBy(){const{popupState:e}=this,{strings:t,layer:i,mapView:o}=e;return(0,s.h)("calcite-label",null,t.sortBy,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",disabled:!this.hasRelationshipLayer,onClick:()=>{i.relationships.map((async e=>{const t=(0,g.a)(o);for(const s of t){const t=s;this.relationshipContent.relationshipId===e.id&&(0,g.r)(i,t,e)&&this.openSortByPickList(t)}}))}},this.relationshipContent?.orderByFields?.[0]?.field||t.default))}renderSortOrder(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)("calcite-label",null,t.sortOrder,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full"},"desc"===this.relationshipContent.orderByFields?.[0].order?t.descending:t.ascending),(0,s.h)("calcite-dropdown-item",{selected:"asc"===this.relationshipContent.orderByFields?.[0].order,onClick:()=>{this.relationshipContent.orderByFields[0].order="asc",(0,s.f)(this.el)}},t.ascending),(0,s.h)("calcite-dropdown-item",{selected:"desc"===this.relationshipContent.orderByFields?.[0].order,onClick:()=>{this.relationshipContent.orderByFields[0].order="desc",(0,s.f)(this.el)}},t.descending)))}renderPreviewCount(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)("calcite-label",null,t.previewCount,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full"},(0===this.relationshipContent.displayCount?t.none:this.relationshipContent.displayCount)??1),(0,s.h)("calcite-dropdown-group",null,[...Array(this.maxPreviewCount).keys()].map((e=>(0,s.h)("calcite-dropdown-item",{selected:this.relationshipContent.displayCount===e,onClick:()=>{this.relationshipContent.displayCount=e,(0,s.f)(this.el)}},0===e?t.none:e))))))}async loadAllModules(){this.RelatedRecordsInfoFieldOrder=await(0,C.aC)(),this.reactiveUtils=await(0,C.l)()}handleRelationshipFormInputPickListChange(e,t){"title"===t?((0,y.a)(this.relationshipTitleNode,e),this.relationshipContent.title=this.relationshipTitleNode.value):"description"===t&&((0,y.a)(this.relationshipDescriptionNode,e),this.relationshipContent.description=this.relationshipDescriptionNode.value),this.closePopupPopovers.emit(),(0,s.f)(this.el)}openSortByPickList(e){const{popupState:t}=this,{mapView:i}=t;this.closePopupPopovers.emit(),this.sortByPickerNode||(this.sortByPickerNode=document.createElement("arcgis-field-pick-list"),this.sortByPickerNode.popoverProps={triggerDisabled:!0,refElement:this.popupFlowItem,offsetSkidding:50},this.sortByPickerNode.fields=e.fields.filter((e=>e.visible)),this.sortByPickerNode.layer=e,this.sortByPickerNode.mapView=i,this.sortByPickerNode.showFieldInfo=!0,this.sortByPickerNode.showFieldName=!0,this.sortByPickerNode.selectedFields=this.relationshipContent?.orderByFields?.[0]?.field?[this.relationshipContent?.orderByFields?.[0]?.field]:[],this.sortByPickerNode.addEventListener("arcgisClose",(e=>{e.stopPropagation();const t=e.detail?.selectedFields?.[0];this.handleSortByPickListChange(t)})),document.body.appendChild(this.sortByPickerNode),this.sortByPickerNode.setFocus(),this.disablePopupPanel.emit(!0))}handleSortByPickListChange(e){e&&(this.relationshipContent.orderByFields[0].field=e,(0,s.f)(this.el)),this.closePopupPopovers.emit()}setUpLayerTableListWatcher(){const{reactiveUtils:e}=this;this.layerTableListWatcher=e.watch((()=>[this.popupState.mapView.map?.allLayers.length,this.popupState.mapView.map?.allTables.length]),(async()=>{const{popupState:e}=this;this.hasRelationshipLayer=await(0,g.c)(e,this.relationshipContent)}))}get el(){return(0,s.a)(this)}};E.style=".form-input-button{display:flex}.input{width:100%}calcite-text-area{width:100%;--calcite-text-area-min-width:0;--calcite-text-area-min-height:42px}.dropdown{width:100%}";const x=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.manager=(0,p.u)(this),this.arcadeExpMap=new Map,this.popupState=(0,g.u)(),this.popupFlowItem=void 0,this.blockOpen=!1,this.popupTextContent=void 0,this.fieldExpressionData=void 0,this.arcgisColorPickerData=void 0}arcadeChangeNotificationHandler(){this.setUpCkEditorMentionFields()}closePopupPopoversHandler(){this.ckEditorPopoverNode&&(document.body.removeChild(this.ckEditorPopoverNode),this.ckEditorPopoverNode=void 0,this.disablePopupPanel.emit(!1))}async componentWillLoad(){this.intl=await(0,C.z)()}componentDidLoad(){this.setUpCkEditorMentionFields(),this.blockOpen&&this.openRichTextEditor()}componentDidUpdate(){this.arcgisChange.emit()}disconnectedCallback(){this.ckEditorPopoverNode&&document.body.removeChild(this.ckEditorPopoverNode)}render(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"9c6c51c3757e7f32476c715a82aee4a14348d49f"},(0,s.h)("calcite-button",{key:"42583f22682c0cf33c059ee7d0f51db8428947ee",appearance:"transparent",width:"full",onClick:()=>this.openRichTextEditor()},t.editText))}setUpCkEditorMentionFields(){const{popupState:e}=this,{popupTemplate:t}=e;this.ckEditorMentionFields=[],this.arcadeExpMap=(0,n.m)(t),t.fieldInfos?.forEach((e=>{e.fieldName&&this.ckEditorMentionFields.push({id:`{${e.fieldName}}`,name:(0,n.o)(e,this.arcadeExpMap)})}))}openRichTextEditor(){const{popupState:e,intl:t}=this,{strings:i,popupTemplate:o}=e;this.closePopupPopovers.emit(),this.ckEditorPopoverNode=document.createElement("arcgis-ckeditor5-popover"),this.ckEditorPopoverNode.guid=(0,P.a)(),this.ckEditorPopoverNode.refElement=this.popupFlowItem,this.ckEditorPopoverNode.intlOk=i.ok,this.ckEditorPopoverNode.intlCancel=i.cancel,this.ckEditorPopoverNode.addEventListener("arcgisPopoverClosed",(e=>{e.stopPropagation(),(0,n.i)(e.detail?.data?.length)&&(this.popupTextContent.text=e.detail.data,(0,s.f)(this.el)),this.closePopupPopovers.emit()}));const a=document.createElement("arcgis-ckeditor5");a.customConfig={FieldExpression:{...this.fieldExpressionData,layer:void 0,mapView:void 0},ArcgisColorPicker:{...this.arcgisColorPickerData,enableFields:!!this.arcgisColorPickerData.data?.length}},a.textData=this.popupTextContent.text??"",a.mentionFields=this.ckEditorMentionFields,a.intlTextPlaceHolder=o.fieldInfos?.length?i.textPlaceHolder:i.textPlaceHolderLabel,a.currentLanguage=t.getLocale(),a.setFocus(),this.ckEditorPopoverNode.appendChild(a),document.body.appendChild(this.ckEditorPopoverNode),this.disablePopupPanel.emit(!0)}get el(){return(0,s.a)(this)}},S=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.manager=(0,p.u)(this),this.popupState=(0,g.u)(),this.referenceElement=void 0}closePopupPopoversHandler(){this.pickListNode&&(document.body.removeChild(this.pickListNode),this.pickListNode=void 0,this.inputNode.setFocus(),this.disablePopupPanel.emit(!1))}render(){const{popupState:e}=this,{popupTemplate:t,strings:i}=e,o=t.title;return(0,s.h)(s.H,{key:"dad7307870756e850558d8c288ce4f87c27e7831"},(0,s.h)("calcite-block",{key:"b16d11b886a5802a1ed66e41703e5ab38af02448",collapsible:!0,heading:i.popupTitle,description:o&&`${o.substring(0,25)}${o.length>25?"...":""}`},(0,s.h)("div",{key:"145e97796fff52d0cc41df6594509b23f9590543",slot:"icon"},(0,s.h)("calcite-icon",{key:"d39c53e462c1cb96438271b51a2a6f49f88f53aa",icon:"title"})),(0,s.h)("div",{key:"dd841f1be63cbd48dd2c67c22f084795336e5ecd",class:"form-input-button"},(0,s.h)("calcite-input",{key:"a7c99dc62a6f2ca44fcf5d7f60f41942b470d339",class:"input",type:"text",autofocus:!0,value:o,onCalciteInputInput:e=>{e.stopPropagation(),this.handleTitleChange()},onClick:()=>this.closePopupPopovers.emit(),ref:e=>this.inputNode=e}),t.fieldInfos?.length&&(0,s.h)("calcite-action",{key:"cae77f31cf7d5b0e9da48c05e067aab853baa1d6",scale:"s",text:i.attributes,icon:"brackets-curly",onClick:e=>{e.stopPropagation(),this.openPickList()}}))))}handleTitleChange(){const{popupState:e}=this,{popupTemplate:t}=e;t.title=this.inputNode.value,(0,s.f)(this.el),this.arcgisChange.emit()}openPickList(){this.closePopupPopovers.emit();const{popupState:e}=this,{strings:t}=e;this.pickListNode=document.createElement("arcgis-popup-field-pick-list"),this.pickListNode.popupState=e,this.pickListNode.popoverProps={refElement:this.referenceElement},this.pickListNode.heading=t.addField,this.pickListNode.multiple=!1,this.pickListNode.addEventListener("arcgisChange",(e=>{e.stopPropagation();const t=e.detail.selectedFields;this.handlePickListChange(t)})),this.pickListNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.closePopupPopovers.emit()})),document.body.appendChild(this.pickListNode),this.disablePopupPanel.emit(!0)}handlePickListChange(e){const t=e[0];(0,y.a)(this.inputNode,t),this.handleTitleChange(),this.closePopupPopovers.emit()}get el(){return(0,s.a)(this)}};S.style=".form-input-button{display:flex}.input{width:100%}"},92030:(e,t,i)=>{function s(e,t){const i="CALCITE-INPUT"===e.tagName,s=i?e.shadowRoot.querySelector("input"):e.shadowRoot.querySelector("textarea"),o=s.selectionStart,a=[e.value.slice(0,o),`{${t}}`,e.value.slice(o)].join("");e.value=a;const n=o+2+t.length;setTimeout((()=>{i?e.setFocus():(s?.setSelectionRange(n,n),s?.focus()),s?.setSelectionRange(n,n)}),1)}i.d(t,{a:()=>s})}}]);