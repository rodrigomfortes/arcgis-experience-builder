/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-abe0e5.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-abe0e5"],{10465:(e,t,i)=>{i.d(t,{D:()=>n,a:()=>h,b:()=>a,c:()=>l,g:()=>v,s:()=>C});class n{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}const s=(e,t,i)=>(0,r(t).subscribe)((t=>{const n=t.some((t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target)));n&&i()})),o={},r=e=>{const t=e.join(","),i=o[t];if(void 0!==i)return i;const n=new Set,s=new MutationObserver((e=>n.forEach((t=>t(e)))));globalThis.document&&s.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const r={subscribe:e=>(n.add(e),()=>{n.delete(e),0===n.size&&(s.disconnect(),o[t]=void 0)})};return o[t]=r,r},l=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const n=i.getRootNode?.();if(n===globalThis.document)return null;i=n.host}return null},a=e=>c(e,"dir","ltr"),c=(e,t,i)=>{const n=l(e,`[${t}]`);return n?.getAttribute(t)??i},d=e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},h=()=>[d(2),d(1),d(1),d(1),d(3)].join("-"),u="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),p=new Set(u),g="en",f={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},m={},b=async(e,t)=>{const i=`${t}${e}.json`;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===g?{}:await b(g,t)},v=e=>{const t=c(e,"lang",globalThis.navigator?.language||g);return{lang:t,t9nLocale:y(t)}},y=e=>{const[t,i]=e.split("-"),n=t.toLowerCase();let s=n;return i&&(s=`${n}-${i.toUpperCase()}`),s=f[s]??s,p.has(s)?s:i?y(n):g},C=(e,t,i,n)=>{let o;const r=()=>k(e,t(),n).then((e=>{o?.lang===e.lang&&o.t9nLocale===e.t9nLocale&&o.t9nStrings===e.t9nStrings||i(e),o=e})).catch(console.error);return queueMicrotask(r),s(e,["lang"],r)},k=async(e,t,i=e.localName.split("-").slice(1).join("-"))=>{const{lang:n,t9nLocale:s}=v(e),o=`${t}/${i}/t9n`,r=null===i?{}:await(async(e,t,i="")=>{const n=`${t}/${i}`,s=`${n}${e}.json`;return m[s]??(m[s]=b(e,n)),await m[s]})(s,o,"messages.");return{lang:n,t9nLocale:s,t9nStrings:r}}},33853:(e,t,i)=>{i.r(t),i.d(t,{arcgis_map_config_feature_reduction_binning:()=>u,arcgis_map_config_feature_reduction_clustering:()=>p,arcgis_map_config_feature_reduction_tile:()=>g});var n=i(11254),s=i(69811),o=i(10465),r=i(56612),l=i(53127),a=i(14528),c=i(17840),d=i(89268),h=i(69989);const u=class{constructor(e){(0,n.r)(this,e),this.arcgisChange=(0,n.c)(this,"arcgisChange",7),this.arcgisBackClick=(0,n.c)(this,"arcgisBackClick",7),this.arcgisStyleBtnClick=(0,n.c)(this,"arcgisStyleBtnClick",7),this.arcgisStyleBtnBackClick=(0,n.c)(this,"arcgisStyleBtnBackClick",7),this.manager=(0,a.u)(this),this.onBinSizeChange=(0,l.d)((async e=>{const{layer:t,view:i,modules:n}=this,{colorCreator:s,AggregateField:o,rendererUtils:r}=n;t.featureReduction.fixedBinLevel=e;try{const e=await r.regenerateRenderer({layer:t,view:i,forBinning:!0});e&&(t.featureReduction.renderer=e)}catch{let e=t.featureReduction.fields.find((e=>"count"===e.statisticType));e||(e=new o({name:"aggregateCount",onStatisticField:void 0,alias:"aggregateCount",statisticType:"count",visible:!0}),t.featureReduction.fields.push(e));const n=await s.createContinuousRenderer({layer:t,view:i,field:e.name,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,defaultSymbolEnabled:!1,forBinning:!0});t.featureReduction.renderer=n.renderer}this.handleBinningChange()}),300),this.view=void 0,this.layer=void 0,this.portal=void 0,this.config=void 0,this.strings=void 0,this.flowNode=void 0,this.hideLayerTitle=!1,this.symbolStylerConfig={},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){this.flowItemNode?.setFocus()}async componentWillLoad(){const[e,t,i,n]=await Promise.all([(0,s.e)(),(0,s.h)(),(0,s.l)(),(0,s.ay)()]);this.modules={AggregateField:e,colorCreator:t,reactiveUtils:i,rendererUtils:n}}async componentDidLoad(){this.flowItemNode?.setFocus();const{modules:e,view:t,layer:i}=this,n=t;e.reactiveUtils.watch((()=>[i.featureReduction?.maxScale,n.scale]),(()=>{const e=i.featureReduction;e&&(n.scale<=e.maxScale&&!this.styleDivNode.classList.contains("btn-disabled")?(this.styleDivNode.classList.add("btn-disabled"),this.styleBtnNode.disabled=!0):n.scale>e.maxScale&&this.styleDivNode.classList.contains("btn-disabled")&&(this.styleDivNode.classList.remove("btn-disabled"),this.styleBtnNode.disabled=!1))}))}render(){const{layer:e,strings:t,hideLayerTitle:i}=this;return(0,n.h)(n.H,{key:"4f1a70d69edde963bc233118cde42996fdae9bc7",class:"calcite-match-height"},(0,n.h)("calcite-flow-item",{key:"20af77372b72fb65ae22a6c2328a9d6da01c965f",heading:t.binning,description:i?void 0:e.title??void 0,selected:this.selected,showBackButton:!0,onCalciteFlowItemBack:()=>this.arcgisBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderBinSize(),this.renderScaleThresholdSlider(),this.renderFieldsBtn(),this.renderLabelBtn(),this.renderPopupBtn(),this.renderStyleBtn()))}renderBinSize(){const{layer:e,strings:t}=this,i="rtl"===(0,o.b)(this.el),s=e.featureReduction;return(0,n.h)("div",{class:"slider-title-wrapper"},(0,n.h)("calcite-label",{class:"slider-heading",layout:"inline"},t.bin.binSizeTitle),(0,n.h)("div",{class:"slider-div"},(0,n.h)("label",{class:"slider-label"},i?t.bin.large:t.bin.small),(0,n.h)("calcite-slider",{class:"slider-slider",min:1,max:9,value:10-(s.fixedBinLevel??3),step:1,minLabel:t.bin.binSizeTitle,onCalciteSliderInput:e=>{const t=e.target;this.onBinSizeChange(10-t.value)}}),(0,n.h)("label",{class:"slider-label"},i?t.bin.small:t.bin.large)))}renderScaleThresholdSlider(){const{layer:e,view:t,portal:i,strings:s}=this;return(0,n.h)("arcgis-map-config-feature-reduction-scale-threshold-slider",{view:t,portal:i,layer:e,strings:s})}renderFieldsBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,n.h)("div",{class:"btn-section"},(0,n.h)("button",{class:"btn",onClick:e=>{e.stopPropagation(),this.addFieldsPanel()},ref:e=>this.fieldsButtonNode=e},(0,n.h)("span",{class:"btn-text"},e.bin.editAttributes),(0,n.h)("span",{class:"btn-icon"},(0,n.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderLabelBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,n.h)("div",{class:"btn-section"},(0,n.h)("button",{class:"btn",onClick:e=>{e.stopPropagation(),this.addLabelPanel()},ref:e=>this.labelsButtonNode=e},(0,n.h)("span",{class:"btn-text"},e.bin.editLabel),(0,n.h)("span",{class:"btn-icon"},(0,n.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderPopupBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,n.h)("div",{class:"btn-section"},(0,n.h)("button",{class:"btn",onClick:e=>{e.stopPropagation(),this.addPopupPanel()},ref:e=>this.popupButtonNode=e},(0,n.h)("span",{class:"btn-text"},e.bin.editPopups),(0,n.h)("span",{class:"btn-icon"},(0,n.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderStyleBtn(){const{layer:e,view:t,strings:i}=this,s="rtl"===(0,o.b)(this.el),r=t,l=e.featureReduction,a=r.scale<=l.maxScale;return(0,n.h)("div",{class:"btn-section "+(a?"btn-disabled":""),ref:e=>this.styleDivNode=e},(0,n.h)("button",{class:"btn",disabled:a,onClick:e=>{e.stopPropagation(),this.addStylePanel()},ref:e=>this.styleBtnNode=e},(0,n.h)("span",{class:"btn-text"},i.bin.editStyle),(0,n.h)("span",{class:"btn-icon"},(0,n.h)("calcite-icon",{scale:"s",icon:s?"chevron-left":"chevron-right"}))))}addFieldsPanel(){const{layer:e,view:t,portal:i,strings:s,flowNode:o,hideLayerTitle:r}=this,l=document.createElement("arcgis-map-config-feature-reduction-fields");l.layer=e,l.mapView=t,l.portal=i,l.strings=s,l.hideLayerTitle=r??!1,l.flowNode=o,l.showBackButton=!0,l.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleBinningChange(),(0,n.f)(this.el)})),l.addEventListener("arcgisBackClick",(()=>{o.removeChild(l),this.selected=!0,setTimeout((()=>this.fieldsButtonNode?.focus()),300)})),o.appendChild(l),o.childNodes.forEach((e=>e.selected=!1)),l.selected=!0,this.selected=!1}addLabelPanel(){const{layer:e,view:t,portal:i,strings:s,flowNode:o,hideLayerTitle:l}=this,a=document.createElement("calcite-flow-item");a.heading=s.bin.labelBinFeaturesHeading,l||(a.description=e.title);const c=document.createElement("arcgis-map-config-label");c.layer=e,c.mapView=t,c.portal=i,c.layerDisplayType=r.l.cluster,c.calciteFlowProps={calciteFlowItem:a},c.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleBinningChange(),(0,n.f)(this.el)})),a.appendChild(c),a.addEventListener("calciteFlowItemBack",(()=>{o.removeChild(a),this.selected=!0,setTimeout((()=>this.labelsButtonNode?.focus()),300)})),o.appendChild(a),a.selected=!0,this.selected=!1,a.setFocus()}addPopupPanel(){const{layer:e,view:t,portal:i,config:s,strings:o,flowNode:l,hideLayerTitle:a}=this,c=document.createElement("calcite-flow-item");c.heading=o.bin.binPopupsHeading,a||(c.description=e.title);const d=document.createElement("arcgis-map-config-popup");d.layer=e,d.mapView=t,d.portal=i,d.config=s,d.layerDisplayType=r.l.cluster,d.calciteFlowProps={calciteFlow:l,calciteFlowItem:c},d.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleBinningChange(),(0,n.f)(this.el)})),c.appendChild(d),c.addEventListener("calciteFlowItemBack",(()=>{l.removeChild(c),this.selected=!0,setTimeout((()=>this.popupButtonNode?.focus()),300)})),l.appendChild(c),c.setFocus(),c.selected=!0,this.selected=!1,c.setFocus()}addStylePanel(){const{layer:e,view:t,portal:i,config:n,flowNode:s,symbolStylerConfig:o}=this,r=document.createElement("arcgis-smart-mapping");r.portal=i,r.layer=e,r.mapView=t,r.config=n,r.hideLayerTitle=!0,r.useFeatureReduction=!0,r.symbolStylerConfig=o,r.addEventListener("arcgisClose",(e=>{e.stopPropagation();const t=e.detail;this.selected=!0,r.parentElement?.removeChild(r),this.arcgisStyleBtnBackClick.emit(t),setTimeout((()=>this.styleBtnNode?.focus()),300)})),r.addEventListener("arcgisBeforeBack",(({detail:e})=>{this.arcgisStyleBtnBackClick.emit(e)})),s.appendChild(r),r.selected=!0,this.selected=!1,r.setFocus(),this.arcgisStyleBtnClick.emit()}handleBinningChange(){const{layer:e}=this,t=e.featureReduction;e.featureReduction=t.clone(),this.arcgisChange.emit()}get el(){return(0,n.a)(this)}};u.style=".sc-arcgis-map-config-feature-reduction-binning-h{display:none}[selected].sc-arcgis-map-config-feature-reduction-binning-h{display:flex}.block-section.sc-arcgis-map-config-feature-reduction-binning{padding:0 10px}.block-content.sc-arcgis-map-config-feature-reduction-binning{padding-top:10px}.slider-title-wrapper.sc-arcgis-map-config-feature-reduction-binning{background-color:var(--calcite-color-foreground-1);border-bottom:1px solid var(--calcite-color-foreground-3);padding:var(--calcite-spacing-lg)}.slider-div.sc-arcgis-map-config-feature-reduction-binning{display:flex;align-items:center;justify-content:space-between;flex-flow:row wrap}.slider-heading.sc-arcgis-map-config-feature-reduction-binning{display:inline-block;padding:var(--calcite-spacing-sm) 0}.slider-label.sc-arcgis-map-config-feature-reduction-binning{display:inline-block;order:2}.slider-slider.sc-arcgis-map-config-feature-reduction-binning{display:inline-block;width:100%;order:1}.btn-section.sc-arcgis-map-config-feature-reduction-binning{background-color:var(--calcite-color-foreground-1)}.btn.sc-arcgis-map-config-feature-reduction-binning{background:var(--calcite-color-transparent);border:none;border-bottom:solid 1px var(--calcite-color-foreground-3);display:flex;align-items:center;justify-content:space-between;padding:var(--calcite-spacing-lg) var(--calcite-spacing-lg);cursor:pointer;width:100%}.btn.sc-arcgis-map-config-feature-reduction-binning:hover{background-color:var(--calcite-color-foreground-3);border-color:var(--calcite-color-border-3)}.btn-disabled.sc-arcgis-map-config-feature-reduction-binning{opacity:var(--calcite-opacity-disabled)}.btn.sc-arcgis-map-config-feature-reduction-binning:focus{outline:none;border:2px solid var(--calcite-color-brand)}.btn-text.sc-arcgis-map-config-feature-reduction-binning{font-family:var(--calcite-font-family);font-size:var(--calcite-font-size)}.style-button-div.sc-arcgis-map-config-feature-reduction-binning{background-color:white;padding:10px}";const p=class{constructor(e){(0,n.r)(this,e),this.arcgisChange=(0,n.c)(this,"arcgisChange",7),this.arcgisBackClick=(0,n.c)(this,"arcgisBackClick",7),this.manager=(0,a.u)(this),this.disableSizeSlider=!1,this.view=void 0,this.layer=void 0,this.portal=void 0,this.config=void 0,this.strings=void 0,this.flowNode=void 0,this.hideLayerTitle=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async done(){this.closePopovers()}async setFocus(){this.flowItemNode?.setFocus()}async componentWillLoad(){const[e,t,i,n,o]=await Promise.all([(0,s.a4)(),(0,s.am)(),(0,s.ab)(),(0,s.az)(),(0,s.aA)()]);this.modules={symbolUtils:e,cimSymbolUtils:t,Color:i,SimpleMarkerSymbol:n,SimpleLineSymbol:o};const{layer:r}=this,l=function(e,t,i){const n=e&&e.visualVariables;if(n){const e=n.filter((e=>{const n=e.target,s="$view.scale"===e.valueExpression;return e.type===t&&(!(0,c.i)(n)&&!(0,c.i)(i)&&!s||n===i||"auto"===i&&s&&!n)}));if(e.length)return e[0]}}(r.renderer,"size");this.disableSizeSlider=(0,c.i)(l)}async componentDidLoad(){this.flowItemNode?.setFocus();const{layer:e}=this,t=e.featureReduction;if("pie-chart"===t.renderer?.type){const t=await(0,s.g)(),i=await t.createRendererForClustering({layer:e});this.autoGeneratedPieChartClusterFields=i.fields?.map((e=>e.name))}}disconnectedCallback(){this.closePopovers()}render(){const{layer:e,strings:t,hideLayerTitle:i}=this,s=(0,d.i)(e),o=(0,d.g)(e);return(0,n.h)(n.H,{key:"68605c5117c29464286bbc52ea7d2eb2c25ef85d",class:"calcite-match-height"},(0,n.h)("calcite-flow-item",{key:"ec09d3b6a9bcfb1ce513f19200dae84c6dad2678",heading:t.clustering,description:i?void 0:e.title??void 0,selected:this.selected,onCalciteFlowItemBack:()=>this.arcgisBackClick.emit(),ref:e=>this.flowItemNode=e},s&&this.renderSymbol(),"pie-chart"===o&&this.renderShape(),this.renderClusterRadius(),this.renderClusterSize(),this.renderScaleThresholdSlider(),this.renderFieldsBtn(),this.renderLabelBtn(),this.renderPopupBtn()))}renderSymbol(){const{layer:e,strings:t}=this,i=!!e.featureReduction.symbol;return(0,n.h)("calcite-block-section",{text:t.cluster.overrideSymbol,open:i,"toggle-display":"switch",class:"block-section",onCalciteBlockSectionToggle:()=>this.handleToggleSymbol(),ref:e=>this.symbolBlockSectionNode=e},this.renderSymbolContent())}renderSymbolContent(){const{layer:e,strings:t}=this;return e.featureReduction.symbol?(0,n.h)("div",{class:"block-content"},(0,n.h)("calcite-label",null,t.symbolStyle,(0,n.h)("div",{class:"symbol-button",tabIndex:0,role:"button","aria-label":t.symbolStyle,onClick:()=>this.openSymbolStylerPopover(),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.openSymbolStylerPopover()},ref:e=>this.symbolButtonNode=e},(0,n.h)("div",{class:"symbol",ref:e=>{e&&this.createSymbolPreview(e)}}),(0,n.h)("calcite-icon",{scale:"s",icon:"pencil",class:"symbol-icon"})))):(0,n.h)(n.F,null)}renderShape(){const{layer:e,strings:t}=this,i="rtl"===(0,o.b)(this.el),s=e.featureReduction;return(0,n.h)("div",{class:"slider-title-wrapper"},(0,n.h)("calcite-label",null,t.cluster.shape,(0,n.h)("div",{class:"slider-div"},(0,n.h)("label",{class:"slider-label"},i?t.cluster.donut:t.cluster.pie),(0,n.h)("calcite-slider",{class:"slider-slider",min:0,max:Math.max(.9,s.renderer.holePercentage),value:s.renderer.holePercentage??0,step:.1,minLabel:t.cluster.shape,onCalciteSliderInput:t=>{const i=e.featureReduction,n=t.target;i.renderer.holePercentage=n.value,this.handleClusteringChange()}}),(0,n.h)("label",{class:"slider-label"},i?t.cluster.pie:t.cluster.donut))))}renderClusterRadius(){const{layer:e,strings:t}=this,i="rtl"===(0,o.b)(this.el),s=e.featureReduction;return(0,n.h)("div",{class:"slider-title-wrapper"},(0,n.h)("label",{class:"slider-heading"},t.cluster.radiusTitle),(0,n.h)("div",{class:"slider-div"},(0,n.h)("label",{class:"slider-label"},i?t.cluster.high:t.cluster.low),(0,n.h)("calcite-slider",{class:"slider-slider",min:d.d,max:d.e,value:s.clusterRadius??d.b,step:1,minLabel:t.cluster.radiusTitle,onCalciteSliderInput:t=>{const i=e.featureReduction,n=t.target;i.clusterRadius=n.value,this.handleClusteringChange()}}),(0,n.h)("label",{class:"slider-label"},i?t.cluster.low:t.cluster.high)))}renderClusterSize(){const{layer:e,strings:t,disableSizeSlider:i}=this,s="rtl"===(0,o.b)(this.el),r=e.featureReduction;return(0,n.h)("div",{class:"slider-title-wrapper"},(0,n.h)("label",{class:"slider-heading"},t.cluster.sizeTitle),(0,n.h)("div",{class:"slider-div"},(0,n.h)("label",{class:"slider-label"},s?t.cluster.max:t.cluster.min),(0,n.h)("calcite-slider",{class:"slider-slider",min:d.c,max:d.f,minValue:r.clusterMinSize??d.c,maxValue:r.clusterMaxSize??d.f,step:1,disabled:i,minLabel:`${t.cluster.min} ${t.cluster.sizeTitle}`,maxLabel:`${t.cluster.max} ${t.cluster.sizeTitle}`,onCalciteSliderInput:t=>{const i=e.featureReduction,n=t.target;i.clusterMinSize=n.minValue,i.clusterMaxSize=n.maxValue,this.handleClusteringChange()}}),(0,n.h)("label",{class:"slider-label"},s?t.cluster.min:t.cluster.max)))}renderScaleThresholdSlider(){const{layer:e,view:t,portal:i,strings:s}=this;return(0,n.h)("arcgis-map-config-feature-reduction-scale-threshold-slider",{view:t,portal:i,layer:e,strings:s})}renderFieldsBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,n.h)("div",{class:"cluster-btn-section"},(0,n.h)("button",{class:"cluster-btn",onClick:e=>{e.stopPropagation(),this.addFieldsPanel()},ref:e=>this.fieldsButtonNode=e},(0,n.h)("span",{class:"cluster-btn-text"},e.cluster.editClusterAttributes),(0,n.h)("span",{class:"cluster-btn-icon"},(0,n.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderLabelBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,n.h)("div",{class:"cluster-btn-section"},(0,n.h)("button",{class:"cluster-btn",onClick:e=>{e.stopPropagation(),this.addLabelPanel()},ref:e=>this.labelsButtonNode=e},(0,n.h)("span",{class:"cluster-btn-text"},e.cluster.editClusterLabel),(0,n.h)("span",{class:"cluster-btn-icon"},(0,n.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}renderPopupBtn(){const{strings:e}=this,t="rtl"===(0,o.b)(this.el);return(0,n.h)("div",{class:"cluster-btn-section"},(0,n.h)("button",{class:"cluster-btn",onClick:e=>{e.stopPropagation(),this.addPopupPanel()},ref:e=>this.popupButtonNode=e},(0,n.h)("span",{class:"cluster-btn-text"},e.cluster.editClusterPopups),(0,n.h)("span",{class:"cluster-btn-icon"},(0,n.h)("calcite-icon",{scale:"s",icon:t?"chevron-left":"chevron-right"}))))}closePopovers(){this.stylerPopoverNode?.parentElement?.removeChild(this.stylerPopoverNode),this.stylerPopoverNode=void 0}handleToggleSymbol(){const{layer:e,modules:t}=this,i=e.featureReduction;this.symbolBlockSectionNode.open?this.lastSymbol?(i.symbol=this.lastSymbol,this.lastSymbol=void 0):i.symbol=(0,h.g)(t):(this.lastSymbol=i.symbol,i.symbol=void 0,this.closePopovers()),this.handleClusteringChange(),(0,n.f)(this.el)}createSymbolPreview(e){const{layer:t,modules:i}=this,{symbolUtils:n}=i,s=t.featureReduction;if(!s.symbol)return;const o=s.symbol,r="cim"===o.type?20:14;n.renderPreviewHTML(o,{size:r,symbolConfig:void 0}).then((t=>{t&&(e.childNodes.forEach((t=>e.removeChild(t))),e.appendChild(t))}))}async openSymbolStylerPopover(){const{layer:e,portal:t,strings:i}=this;this.stylerPopoverNode?(this.stylerPopoverNode.parentElement?.removeChild(this.stylerPopoverNode),this.stylerPopoverNode=void 0):(this.stylerPopoverNode=document.createElement("arcgis-map-config-feature-reduction-symbol-styler-popover"),this.stylerPopoverNode.props={layer:e,portal:t,strings:i},this.stylerPopoverNode.referenceElement=this.flowItemNode,this.stylerPopoverNode.addEventListener("arcgisClose",(()=>{this.closePopovers(),setTimeout((()=>this.symbolButtonNode?.focus()),300)})),this.stylerPopoverNode.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleClusteringChange(),(0,n.f)(this.el)})),document.body.appendChild(this.stylerPopoverNode),this.stylerPopoverNode?.setFocus())}addFieldsPanel(){this.closePopovers();const{layer:e,view:t,portal:i,strings:s,flowNode:o,hideLayerTitle:r,autoGeneratedPieChartClusterFields:l}=this,a=document.createElement("arcgis-map-config-feature-reduction-fields");a.layer=e,a.mapView=t,a.portal=i,a.strings=s,a.hideLayerTitle=r??!1,a.flowNode=o,a.autoGeneratedPieChartClusterFields=l,a.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleClusteringChange(),(0,n.f)(this.el)})),a.addEventListener("arcgisBackClick",(()=>{o.removeChild(a),this.selected=!0,setTimeout((()=>this.fieldsButtonNode?.focus()),300)})),o.appendChild(a),o.childNodes.forEach((e=>e.selected=!1)),a.selected=!0,this.selected=!1}addLabelPanel(){const{layer:e,view:t,portal:i,strings:s,flowNode:o,hideLayerTitle:l}=this;this.closePopovers();const a=document.createElement("calcite-flow-item");a.heading=s.cluster.labelClusterFeaturesHeading,l||(a.description=e.title);const c=document.createElement("arcgis-map-config-label");c.layer=e,c.mapView=t,c.portal=i,c.layerDisplayType=r.l.cluster,c.calciteFlowProps={calciteFlowItem:a},c.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleClusteringChange(),(0,n.f)(this.el)})),a.appendChild(c),a.addEventListener("calciteFlowItemBack",(()=>{o.removeChild(a),this.selected=!0,setTimeout((()=>this.labelsButtonNode?.focus()),300)})),o.appendChild(a),a.selected=!0,this.selected=!1,a.setFocus()}addPopupPanel(){const{layer:e,view:t,portal:i,config:s,strings:o,flowNode:l,hideLayerTitle:a}=this;this.closePopovers();const c=document.createElement("calcite-flow-item");c.heading=o.cluster.clusterPopupsHeading,a||(c.description=e.title);const d=document.createElement("arcgis-map-config-popup");d.layer=e,d.mapView=t,d.portal=i,d.config=s,d.layerDisplayType=r.l.cluster,d.calciteFlowProps={calciteFlow:l,calciteFlowItem:c},d.addEventListener("arcgisChange",(e=>{e.stopPropagation(),this.handleClusteringChange(),(0,n.f)(this.el)})),c.appendChild(d),c.addEventListener("calciteFlowItemBack",(()=>{l.removeChild(c),this.selected=!0,setTimeout((()=>this.popupButtonNode?.focus()),300)})),l.appendChild(c),c.selected=!0,this.selected=!1,c.setFocus()}handleClusteringChange(){const{layer:e}=this,t=e.featureReduction;e.featureReduction=t.clone(),this.arcgisChange.emit()}get el(){return(0,n.a)(this)}};p.style=".sc-arcgis-map-config-feature-reduction-clustering-h{display:none}[selected].sc-arcgis-map-config-feature-reduction-clustering-h{display:flex}.block-section.sc-arcgis-map-config-feature-reduction-clustering{padding:0 10px}.block-content.sc-arcgis-map-config-feature-reduction-clustering{padding-top:10px}.symbol-button.sc-arcgis-map-config-feature-reduction-clustering{border:solid 1px var(--calcite-color-foreground-3);display:flex;justify-content:space-between}.symbol-button.sc-arcgis-map-config-feature-reduction-clustering:hover{cursor:pointer}.symbol-button.sc-arcgis-map-config-feature-reduction-clustering:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}.symbol.sc-arcgis-map-config-feature-reduction-clustering{padding:5px}.symbol-icon.sc-arcgis-map-config-feature-reduction-clustering{padding:6px}.slider-title-wrapper.sc-arcgis-map-config-feature-reduction-clustering{background-color:var(--calcite-color-foreground-1);border-bottom:1px solid var(--calcite-color-foreground-3);padding:var(--calcite-spacing-lg)}.slider-div.sc-arcgis-map-config-feature-reduction-clustering{display:flex;align-items:center;justify-content:space-between;flex-flow:row wrap}.slider-heading.sc-arcgis-map-config-feature-reduction-clustering{display:inline-block;padding:var(--calcite-spacing-sm) 0}.slider-label.sc-arcgis-map-config-feature-reduction-clustering{display:inline-block;order:2}.slider-slider.sc-arcgis-map-config-feature-reduction-clustering{display:inline-block;width:100%;order:1}.cluster-btn-section.sc-arcgis-map-config-feature-reduction-clustering{background-color:var(--calcite-color-foreground-1)}.cluster-btn.sc-arcgis-map-config-feature-reduction-clustering{background:var(--calcite-color-transparent);border:none;border-bottom:solid 1px var(--calcite-color-foreground-3);display:flex;align-items:center;justify-content:space-between;padding:var(--calcite-spacing-lg);cursor:pointer;width:100%}.cluster-btn.sc-arcgis-map-config-feature-reduction-clustering:hover{background-color:var(--calcite-color-foreground-3);border-color:var(--calcite-color-border-3)}.cluster-btn.sc-arcgis-map-config-feature-reduction-clustering:focus{outline:none;border:2px solid var(--calcite-color-brand)}.cluster-btn-text.sc-arcgis-map-config-feature-reduction-clustering{font-family:var(--calcite-font-family);font-size:var(--calcite-font-size)}";const g=class{constructor(e){(0,n.r)(this,e),this.arcgisSelect=(0,n.c)(this,"arcgisSelect",7),this.arcgisOptionsClick=(0,n.c)(this,"arcgisOptionsClick",7),this.manager=(0,a.u)(this),this.documentClickHandler=void 0,this.panelScrollHandler=void 0,this.props=void 0,this.selected=void 0}async setFocus(){this.tileNode?.focus()}disconnectedCallback(){this.removeInfoPopover()}render(){const{props:e,selected:t}=this,{title:i,imagePath:s,strings:r}=e,l={tile:!0,"tile-selected":t},a={"tile-image":!0,"tile-image-selected":t},c={"tile-check":!0,rtl:"rtl"===(0,o.b)(this.el)};return(0,n.h)(n.H,{key:"d3f5fce08ff0892efb339e2be4b386392741550d"},(0,n.h)("div",{key:"088c0b3089d631163094d7f228c703c8c98295e7",class:l,role:"button",tabindex:"0","aria-label":`${i} ${r.tile.options}`,"aria-selected":t,ref:e=>{e&&(this.tileNode=e)},onClick:e=>{const{selected:t}=this;"CALCITE-CHECKBOX"!==e?.target?.nodeName&&(e.stopPropagation(),this.removeInfoPopover(),t?this.arcgisOptionsClick.emit():this.arcgisSelect.emit(),e.preventDefault())},onKeyUp:e=>{const{selected:t}=this;" "!==e.key&&"Enter"!==e.key||(e.stopPropagation(),this.removeInfoPopover(),t?this.arcgisOptionsClick.emit():this.arcgisSelect.emit(),e.preventDefault())},onKeyDown:e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())}},(0,n.h)("div",{key:"e91444720a7222b38047a21d813c2761def3877f",class:a,style:{backgroundImage:`url(${s})`},"aria-hidden":"true"}),(0,n.h)("div",{key:"85d6f9ec0dd466c586572d201cf0aa73434e4086",class:c,"aria-label":"","aria-hidden":"true"},(0,n.h)("calcite-checkbox",{key:"242a10488b251d72eb038c0700f882efd0bf0d6a",name:"style-tile-check-name",checked:t,tabindex:"-1",onCalciteCheckboxChange:e=>{e.preventDefault(),this.handleCheckboxChange()},ref:e=>{this.checkboxNode=e}})),this.renderTileLink()))}renderTileLink(){const{props:e,selected:t}=this,{strings:i}=e;return(0,n.h)("div",{class:"style-link","aria-label":e.title},(0,n.h)("div",{class:"style-link-title"},(0,n.h)("div",{"aria-hidden":"true"},e.title),(0,n.h)("calcite-button",{class:"style-link-info",scale:"s",iconStart:"information",appearance:"transparent",kind:"neutral",onClick:e=>{e.stopPropagation(),this.handleInfoClick()},label:i.tile.moreInfo,ref:e=>{e&&(this.infoIconNode=e,e.addEventListener("keyup",(e=>{e.stopPropagation(),(" "===e.key||!this.infoPopoverNode&&"Enter"===e.key)&&(e.stopPropagation(),this.handleInfoClick())})),e.addEventListener("keydown",(e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())})))}})),t&&this.renderStyleOptions())}renderStyleOptions(){const{props:e}=this,{strings:t}=e;return(0,n.h)("calcite-button",{appearance:"outline-fill",width:"full",scale:"s",label:t.tile.options},t.tile.options)}handleCheckboxChange(){const{selected:e}=this;this.checkboxNode.checked?(this.removeInfoPopover(),e?this.arcgisOptionsClick.emit():this.arcgisSelect.emit()):this.checkboxNode.checked=!0}handleInfoClick(){const{props:e}=this,{config:t,title:i,moreInfo:n,helpId:s,flowItemNode:o,strings:r}=e;this.removeInfoPopover(),this.infoPopoverNode=document.createElement("arcgis-map-config-feature-reduction-info-popover"),this.infoPopoverNode.props={title:i,moreInfo:n,helpId:s,config:t,flowItemNode:o,strings:r},this.infoPopoverNode.referenceElement=this.infoIconNode,this.infoPopoverNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.removeInfoPopover(),setTimeout((()=>{this.infoIconNode?.setFocus()}),200)})),this.infoPopoverNode.addEventListener("arcgisDisconnected",(e=>{e.stopPropagation(),this.removeInfoPopover()})),document.body.appendChild(this.infoPopoverNode),setTimeout((()=>this.infoPopoverNode?.setFocus()),100),setTimeout((()=>{this.documentClickHandler=e=>{this.isInsideInfoPopoverNode(e.target)||(this.removeInfoPopover(),setTimeout((()=>this.infoIconNode?.setFocus()),200))},document.addEventListener("click",this.documentClickHandler),this.panelScrollHandler=()=>this.removeInfoPopover(),o?.addEventListener("calciteFlowItemScroll",this.panelScrollHandler)}),100)}isInsideInfoPopoverNode(e){if("ARCGIS-MAP-CONFIG-FEATURE_REDUCTION-INFO-POPOVER"===e?.tagName)return!0;{let t=e?.parentElement;for(;t;){if("ARCGIS-MAP-CONFIG-FEATURE_REDUCTION-INFO-POPOVER"===t.tagName)return!0;t=t.parentElement}}return!1}removeInfoPopover(){const{props:e}=this,{flowItemNode:t}=e;document.body.querySelectorAll(".arcgis-map-config-feature-reduction-popover").forEach((e=>document.body.removeChild(e))),this.infoPopoverNode=void 0,this.documentClickHandler&&(document.removeEventListener("click",this.documentClickHandler),this.documentClickHandler=void 0),this.panelScrollHandler&&(t?.removeEventListener("calciteFlowItemScroll",this.panelScrollHandler),this.panelScrollHandler=void 0)}get el(){return(0,n.a)(this)}};g.style=".tile {\n  background-color: white;\n  position: relative;\n  margin: 6px;\n  cursor: pointer;\n  box-shadow:\n    0 1px 10px 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px #e0e0e0;\n  transition: box-shadow 125ms ease-in-out;\n\n  &:hover {\n    z-index: 5;\n    box-shadow:\n      0 1px 0 2px rgba(0, 0, 0, 0.05),\n      0 0 0 1px #e0e0e0;\n  }\n  &:focus {\n    outline: 2px solid var(--calcite-color-brand);\n  }\n}\n\n.tile-selected {\n  box-shadow:\n    0 1px 10px 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px var(--calcite-color-brand);\n}\n.tile-selected:hover {\n  z-index: 5;\n  box-shadow:\n    0 1px 0 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px var(--calcite-color-brand);\n}\n\n.tile-check {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n}\n.tile-check.rtl {\n  right: auto;\n  left: 10px;\n  overflow-x: hidden;\n}\n.style-link {\n  padding: 9px 9px;\n}\n\n.style-link-title {\n  display: flex;\n  font-weight: bold;\n  padding-bottom: 5px;\n}\n.style-link-options {\n  color: #0079c1;\n  display: flex;\n  flex-direction: row nowrap;\n  svg {\n    fill: #0079c1;\n  }\n}\n.tile-image {\n  height: 100px;\n  width: 100%;\n  background-size: cover;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.tile-image-selected {\n  height: 68px;\n  background-size: auto 100px;\n}\n.style-sub-text {\n  font-size: 80%;\n  padding: 0 0 6px 0;\n}\n.style-link-info {\n  height: 18px;\n  margin-top: -2px;\n  margin-inline-start: 5px;\n}\n"},53127:(e,t,i)=>{i.d(t,{a:()=>s,d:()=>n,t:()=>o});const n=(e,t)=>{let i,n="idle";const s=async(...s)=>await new Promise((o=>{switch(n){case"flushed":n="idle",i?(clearTimeout(i),o(e(...s))):o(null);break;case"invoked":clearTimeout(i),n="idle",o(e(...s));break;case"cancelled":clearTimeout(i),n="idle",o(null);break;default:i&&clearTimeout(i),n="pending",i=setTimeout((()=>{n="idle",o(e(...s))}),t)}}));return s.flush=async function(...e){return n="flushed",await s(...e)},s.invoke=async function(...e){return n="invoked",await s(...e)},s.cancel=async function(...e){return n="cancelled",await s(...e)},s.getStatus=function(){return n},s},s=(e,t)=>{let i;return async(...n)=>await new Promise((s=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,s(e(...n))}),t))}))};function o(e){return new Promise((t=>setTimeout(t,e)))}},69989:(e,t,i)=>{function n(e){return["simple-fill","simple-marker","simple-line","picture-marker","cim"].includes(e.type)}function s(e,t){return"picture-marker"===e.type||"cim"===e.type&&!function(e,t){const{cimSymbolUtils:i}=t;return!!i.getCIMSymbolColor(e)}(e,t)}function o(e){const{SimpleLineSymbol:t,SimpleMarkerSymbol:i,Color:n}=e;return new i({style:"circle",size:6.75,outline:new t({style:"solid",color:new n([92,92,92,64]),width:1}),color:new n([227,139,79,255])})}function r(e){return"picture-marker"!==e.type&&("cim"!==e.type&&!!e.outline?.color)}function l(e,t){const{cimSymbolUtils:i,Color:n}=t;return"cim"===e?.type?n.fromJSON(i.getCIMSymbolColor(e)?.toJSON()):"simple-marker"===e?.type&&["x","cross"].includes(e?.style)?e?.outline?.color:e?.color}function a(e,t){const{cimSymbolUtils:i}=t;return"cim"===e.type?i.getCIMSymbolSize(e):e.size?e.size:e.width}function c(e,t){return e.a=t,e}i.d(t,{a:()=>s,b:()=>l,c:()=>c,d:()=>a,g:()=>o,h:()=>r,i:()=>n})},89268:(e,t,i)=>{i.d(t,{F:()=>c,a:()=>a,b:()=>o,c:()=>r,d:()=>n,e:()=>s,f:()=>l,g:()=>d,h:()=>u,i:()=>h});const n=9,s=90,o=37.5,r=9,l=90,a=37.5;var c;function d(e){const t=e.featureReduction;if(t)return"binning"===t.type?"binning":"cluster"===t.type?function(e){const t=e.featureReduction;return!!t.renderer&&"pie-chart"===t.renderer.type&&!t?.renderer?.authoringInfo?.isAutoGenerated}(e)?"pie-chart":"cluster":void 0}function h(e){const t=e.featureReduction;return!t?.renderer||!!t?.renderer?.authoringInfo?.isAutoGenerated}function u(e,t){switch(e){case"sum":return t.fields.sum;case"avg":return t.fields.mean;case"min":return t.fields.min;case"max":return t.fields.max;case"stddev":return t.fields.stdDev;case"mode":return t.fields.mode;case"var":return t.fields.var;case"count":return t.fields.count;default:return""}}!function(e){e.CLUSTERING="clustering",e.CHART_CLUSTERING="chartClustering",e.BINNING="binning"}(c||(c={}))}}]);