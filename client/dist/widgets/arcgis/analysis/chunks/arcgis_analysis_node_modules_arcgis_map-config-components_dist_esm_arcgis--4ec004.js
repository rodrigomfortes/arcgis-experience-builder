/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--4ec004.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--4ec004"],{20173:(t,e,o)=>{o.d(e,{a:()=>n});const n=t=>t&&!t.endsWith("/")?`${t}/`:t},84260:(t,e,o)=>{o.d(e,{u:()=>a});var n=o(11254),s=o(10465),i=o(14528);function a({propertyName:t="strings",name:e}){let o=(0,i.r)();const a=(0,s.g)(o.el),r=new s.D,c={_lang:a.lang,_t9nLocale:a.t9nLocale};o.manager.onLoad((()=>r.promise));const d=new WeakRef(o);function h(){const t=d.deref();return t||f?.(),t}o=void 0;const p=l((()=>h()?.el)),f=(0,s.s)(p,(()=>(0,n.g)("./assets")),(({t9nLocale:e,t9nStrings:o,lang:n})=>{const s=h();if(!s)return;s[t]={...o,_lang:n,_t9nLocale:e},r.resolve()}),e);return c}const l=t=>new Proxy({},{get(e,o){const n=t();if(!n)return;const s=Reflect.get(n,o,n);return"function"==typeof s?s.bind(n):s}})},89477:(t,e,o)=>{o.r(e),o.d(e,{arcgis_map_config_font_picker:()=>f});var n=o(11254),s=o(59350),i=o(20173),a=o(14528),l=o(84260),r=o(10465),c=o(69811);function d(t){return t.credential?.token||t.token||t.user?.credential?.token||t.portalUser?.token||""}const h=["Arial Bold","Arial Bold Italic","Arial Italic","Arial Regular","Arial Unicode MS Bold Italic","Arial Unicode MS Italic","Avenir Bold","Avenir Bold Italic","Avenir Italic","Avenir Regular","Palatino Linotype Regular","Times New Roman Bold","Times New Roman Bold Italic","Times New Roman Italic","Times New Roman Regular","Verdana Bold","Verdana Bold Italic","Verdana Italic","Verdana Regular"];var p;!function(t){t.ASCENDING="ascending",t.DESCENDING="descending"}(p||(p={}));const f=class{constructor(t){(0,n.r)(this,t),this.arcgisClose=(0,n.c)(this,"arcgisClose",7),this.arcgisChange=(0,n.c)(this,"arcgisChange",7),this.manager=(0,a.u)(this),this.strings=(0,l.u)({blocking:!0}),this.currentFont="",this.mapSpecificFontMap=new Map,this.view=void 0,this.enableMapSpecificFontList=!1,this.fontMap=void 0,this.font=void 0,this.popoverProps=void 0,this.hideCancel=!1,this.lastSortBy=p.ASCENDING,this.currentFontGroup=this.enableMapSpecificFontList&&this.view?"map-fonts":"static-fonts"}async setFocus(){this.panelNode?.setFocus()}async reposition(){this.popoverNode?.reposition()}async componentWillLoad(){const{font:t,enableMapSpecificFontList:e}=this;this.currentFont=t&&(0,s.f)(t),await this.loadAllModules(),await this.loadAllFonts(),e&&await this.loadMapSpecificFonts()}async componentDidLoad(){const{font:t}=this;t&&setTimeout((()=>this.listNode?.selectedItems?.[0]?.scrollIntoView({behavior:"auto",block:"center",inline:"center"})),300),setTimeout((()=>requestAnimationFrame((()=>this.panelNode?.setFocus()))),300)}render(){const{strings:t,popoverProps:e}=this,o={width:`${e.popoverWidth??e.refElement.getBoundingClientRect().width}px`};return e.maxHeight&&(o.maxHeight=e.maxHeight),(0,n.h)(n.H,{key:"8c997877438d0746b6f472c387df5f48e350f01a",class:"js-app-flyout"},(0,n.h)("calcite-popover",{key:"0986a3b5f078eeca4c5a1cead379fadbe093de8c",dir:(0,r.b)(this.el),class:"popover",placement:e.placement||"leading-start",open:!0,pointerDisabled:!0,referenceElement:e.refElement,offsetDistance:e.offsetDistance??-Math.round(e.refElement.getBoundingClientRect().width),offsetSkidding:e.offsetSkidding??0,overlayPositioning:e.overlayPositioning,triggerDisabled:!0,autoClose:e.autoClose,label:t.fonts,ref:t=>this.popoverNode=t},(0,n.h)("calcite-panel",{key:"e2123e7d246fcba361f311cae1d8de7a51c63cee",class:"panel",heading:t.fonts,closable:!0,style:o,onCalcitePanelClose:()=>this.arcgisClose.emit(),ref:t=>this.panelNode=t},this.renderFontControls(),(0,n.h)("calcite-list",{key:"72351ccdea9cf0739744ba5823b98d63f8d28fe9",label:t.fonts,class:"content",filterEnabled:!0,filterPlaceholder:t.searchFonts,selectionMode:"single-persist",ref:t=>this.listNode=t},this.renderSortDropdown(),[...this.getSortedFontList(this.currentFontGroup)].map((([t])=>this.renderListItem(t)))),this.renderCancelButton())))}renderFontControls(){const{strings:t,view:e,enableMapSpecificFontList:o}=this;return e&&o?(0,n.h)("div",{slot:"content-top",class:"font-mode-wrapper"},(0,n.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:async t=>{const e=t.target.value;"map-fonts"===e&&(this.mapSpecificFontMap=new Map,await this.loadMapSpecificFonts()),this.currentFontGroup=e,setTimeout((()=>{this.listNode.selectedItems?.[0]?.scrollIntoView({behavior:"auto",block:"center",inline:"center"})}),300)}},(0,n.h)("calcite-segmented-control-item",{value:"map-fonts",checked:!0},t.mapFonts),(0,n.h)("calcite-segmented-control-item",{value:"static-fonts",checked:!1},t.allFonts))):(0,n.h)(n.F,null)}renderListItem(t){const{strings:e,fontMap:o,mapSpecificFontMap:s,currentFont:i,currentFontGroup:a}=this,l="static-fonts"===a?o:s;return(0,n.h)("calcite-list-item",{key:t,label:t,value:t,selected:i===t,metadata:{label:t},onCalciteListItemSelect:async()=>{const t=await this.getSelectedFont();this.arcgisChange.emit(t),this.arcgisClose.emit()}},(0,n.h)("div",{class:"font-preview",slot:"actions-end",style:{fontFamily:l.get(t).font.family,fontStyle:l.get(t).font.style,fontWeight:l.get(t).font.weight}},e.fontPreview))}renderSortDropdown(){const{strings:t}=this;return(0,n.h)("calcite-dropdown",{slot:"filter-actions-end",overlayPositioning:"fixed",placement:"bottom-end"},(0,n.h)("calcite-action",{slot:"trigger",icon:"sortDescending",text:t.sort,title:t.sort,iconFlipRtl:!0}),(0,n.h)("calcite-dropdown-group",null,(0,n.h)("calcite-dropdown-item",{selected:this.lastSortBy===p.ASCENDING,onClick:()=>this.lastSortBy=p.ASCENDING,onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||(this.lastSortBy=p.ASCENDING)}},t.ascending),(0,n.h)("calcite-dropdown-item",{selected:this.lastSortBy===p.DESCENDING,onClick:()=>this.lastSortBy=p.DESCENDING,onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||(this.lastSortBy=p.DESCENDING)}},t.descending)))}renderCancelButton(){const{strings:t,hideCancel:e}=this;return e?(0,n.h)(n.F,null):(0,n.h)("calcite-button",{slot:"footer",appearance:"outline-fill",width:"full",onClick:()=>this.arcgisClose.emit()},t.cancel)}async loadAllModules(){const[t,e,o,n]=await Promise.all([(0,c.m)(),(0,c.J)(),(0,c.p)(),(0,c.K)()]);this.modules={portalItem:t,symbolFontUtils:e,request:o,fontUtils:n}}async loadAllFonts(){const{modules:t,fontMap:e}=this,o=Array.from(e.entries());Promise.all(o.map((async e=>{try{h.includes(e[0])||await t.fontUtils.loadFont(e[1].font)}catch(t){}})))}async loadMapSpecificFonts(){const{view:t}=this;if(!t)return(0,n.h)(n.F,null);const e=t.map?.allLayers;if(e?.length){const t=e.flatten((t=>"sublayers"in t?t.sublayers:null));await this.loadLayerFonts(t)}const o=t.map.portalItem;o&&await this.loadItemFonts(o)}async loadLayerFonts(t){const e=[],o=t.filter((t=>"vector-tile"!==t.type))??[],n=t.filter((t=>"vector-tile"===t.type))??[];o.forEach((async t=>{const o=[...t.labelingInfo??[],...t.featureReduction?.labelingInfo??[]];o.length&&o.forEach((t=>{t.symbol?.font&&e.push(t.symbol.font)}))})),this.loadNonVectorTileLayerFonts(e),await this.loadVectorTileLayerFonts(n)}async loadItemFonts(t){const{modules:e}=this,o=`${n=t.portal,(0,i.a)(n.restUrl)}content/items/${t.id}/data`;var n;const s=await e.request(o,{query:{f:"json"},responseType:"json",method:"get",token:d(t.portal)});if(s?.data){const t=s.data,o=[...t.operationalLayers??[],...t.baseMap?.baseMapLayers??[]];if(o.length){const t=o.filter((t=>"VectorTileLayer"!==t.layerType))??[],n=o.filter((t=>"VectorTileLayer"===t.layerType))??[],s=[];t.forEach((t=>{const o=[...t.layerDefinition?.drawingInfo?.labelingInfo??[],...t.layerDefinition?.featureReduction?.drawingInfo?.labelingInfo??[]];o.length&&o.forEach((t=>{t.symbol?.font&&s.push(e.symbolFontUtils.fromJSON(t.symbol?.font))}))})),this.loadNonVectorTileLayerFonts(s),await this.loadVectorTileLayerFonts(n)}}}loadNonVectorTileLayerFonts(t){const{fontMap:e}=this;t.map((async t=>{const o=(0,s.f)(t);e.get(o)&&this.mapSpecificFontMap.set(o,e.get(o))}))}async loadVectorTileLayerFonts(t){const{modules:e}=this,o=t.map((async t=>await e.request(t.styleUrl,{query:{f:"json"},method:"get",responseType:"json"})));(await Promise.all(o)).forEach((t=>{const e=t?.data;if(e?.layers){const t=[];e.layers.forEach((e=>{const o=e.layout?.["text-font"]?.[0];o&&!t.includes(o)&&t.push(o)})),t.forEach((t=>{const e=this.fontMap.get(t);e&&this.mapSpecificFontMap.set(t,e)}))}}))}getSortedFontList(t){const{fontMap:e,mapSpecificFontMap:o,lastSortBy:n}=this,s="static-fonts"===t?e:o;return n===p.ASCENDING?[...s].sort():[...s].sort().reverse()}async getSelectedFont(){const{fontMap:t,font:e}=this;return t.get(this.listNode.selectedItems[0].value)?.font??e}static get assetsDirs(){return["assets"]}get el(){return(0,n.a)(this)}};f.style=".popover{--calcite-popover-z-index:100}.panel{min-height:300px}.content{max-height:60vh}.font-mode-wrapper{width:100%}.font-preview{min-width:40px}"}}]);