/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-cd8edf.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-cd8edf"],{10465:(e,t,i)=>{i.d(t,{D:()=>n,a:()=>d,b:()=>a,c:()=>l,g:()=>b,s:()=>T});class n{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}const r=(e,t,i)=>(0,s(t).subscribe)((t=>{const n=t.some((t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target)));n&&i()})),o={},s=e=>{const t=e.join(","),i=o[t];if(void 0!==i)return i;const n=new Set,r=new MutationObserver((e=>n.forEach((t=>t(e)))));globalThis.document&&r.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const s={subscribe:e=>(n.add(e),()=>{n.delete(e),0===n.size&&(r.disconnect(),o[t]=void 0)})};return o[t]=s,s},l=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const n=i.getRootNode?.();if(n===globalThis.document)return null;i=n.host}return null},a=e=>c(e,"dir","ltr"),c=(e,t,i)=>{const n=l(e,`[${t}]`);return n?.getAttribute(t)??i},u=e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},d=()=>[u(2),u(1),u(1),u(1),u(3)].join("-"),m="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),p=new Set(m),f="en",y={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},g={},h=async(e,t)=>{const i=`${t}${e}.json`;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===f?{}:await h(f,t)},b=e=>{const t=c(e,"lang",globalThis.navigator?.language||f);return{lang:t,t9nLocale:S(t)}},S=e=>{const[t,i]=e.split("-"),n=t.toLowerCase();let r=n;return i&&(r=`${n}-${i.toUpperCase()}`),r=y[r]??r,p.has(r)?r:i?S(n):f},T=(e,t,i,n)=>{let o;const s=()=>v(e,t(),n).then((e=>{o?.lang===e.lang&&o.t9nLocale===e.t9nLocale&&o.t9nStrings===e.t9nStrings||i(e),o=e})).catch(console.error);return queueMicrotask(s),r(e,["lang"],s)},v=async(e,t,i=e.localName.split("-").slice(1).join("-"))=>{const{lang:n,t9nLocale:r}=b(e),o=`${t}/${i}/t9n`,s=null===i?{}:await(async(e,t,i="")=>{const n=`${t}/${i}`,r=`${n}${e}.json`;return g[r]??(g[r]=h(e,n)),await g[r]})(r,o,"messages.");return{lang:n,t9nLocale:r,t9nStrings:s}}},76744:(e,t,i)=>{i.d(t,{$:()=>ht,A:()=>ue,B:()=>m,C:()=>L,D:()=>U,E:()=>A,F:()=>P,G:()=>S,H:()=>v,I:()=>b,J:()=>c,K:()=>d,L:()=>H,M:()=>W,N:()=>V,O:()=>D,P:()=>u,Q:()=>j,R:()=>$,S:()=>E,T:()=>Ue,U:()=>tt,V:()=>K,W:()=>Be,X:()=>Et,Y:()=>ft,Z:()=>Tt,_:()=>X,a:()=>at,a0:()=>Q,a1:()=>N,a2:()=>yt,a3:()=>mt,a4:()=>pt,a5:()=>le,a6:()=>St,a7:()=>vt,a8:()=>bt,a9:()=>y,aA:()=>Re,aB:()=>ze,aC:()=>Ie,aD:()=>Ee,aE:()=>de,aF:()=>Me,aG:()=>we,aH:()=>h,aI:()=>R,aJ:()=>pe,aK:()=>ye,aL:()=>O,aM:()=>Le,aN:()=>x,aO:()=>p,aP:()=>g,aQ:()=>F,aR:()=>k,aS:()=>I,aT:()=>gt,aU:()=>oe,aV:()=>ne,aa:()=>Ft,ab:()=>f,ac:()=>Fe,ad:()=>It,ae:()=>ke,af:()=>qe,ag:()=>Ge,ah:()=>We,ai:()=>Qe,aj:()=>et,ak:()=>De,al:()=>Ze,am:()=>xe,an:()=>Xe,ao:()=>Ye,ap:()=>it,aq:()=>nt,ar:()=>Pe,as:()=>$e,at:()=>ut,au:()=>dt,av:()=>B,aw:()=>a,ax:()=>Ne,ay:()=>He,az:()=>Ke,b:()=>st,c:()=>ct,d:()=>lt,e:()=>T,f:()=>Ve,g:()=>ge,h:()=>Oe,i:()=>q,j:()=>Ae,k:()=>ce,l:()=>w,m:()=>Y,n:()=>Z,o:()=>G,p:()=>ie,q:()=>z,r:()=>me,s:()=>n,t:()=>be,u:()=>ee,v:()=>Se,w:()=>r,x:()=>_,y:()=>M,z:()=>he});i(56612);var n,r,o=i(10465),s=i(17840),l=i(39020);function a(e){return 0===Object.keys(e).length&&e.constructor===Object}function c(){document.querySelectorAll("calcite-popover").forEach((e=>{let t=!1;if(e.classList.forEach((e=>{e.startsWith("smart-mapping-")&&e.endsWith("-popover")&&(t=!0)})),t){e.setAttribute("open","false");const t=e.parentNode;t?.removeChild(e)}})),document.querySelectorAll("arcgis-smart-mapping-styler-popover, arcgis-smart-mapping-info-popover, arcgis-smart-mapping-symbol-pair-popover, arcgis-smart-mapping-dropdown, arcgis-smart-mapping-field-pick-list, .arcgis-smart-mapping-attribute-input-field-pick-list").forEach((e=>e?.parentNode?.removeChild(e)))}function u(e,t){const i=function(e){if("CALCITE-PANEL"===e?.tagName)return e;if("CALCITE-FLOW-ITEM"===e?.tagName)return e;{let t=e?.parentElement;for(;t;){if("CALCITE-PANEL"===t.tagName)return t;if("CALCITE-FLOW-ITEM"===t.tagName)return t;t=t.parentElement}}}(e);i&&(i.disabled=t)}function d(e){const t=e?.parentElement;if("CALCITE-FLOW"===t?.tagName){let i=0;return t.childNodes.forEach(((t,n)=>{t===e&&(i=n)})),0===i}return!1}function m(e,t){const{containsFlow:i}=e;return i?(0,l.f)(t,"calcite-flow"):(0,l.f)(t,"arcgis-smart-mapping")}function p(e,t,i,n=!0){const r=document.getElementById(i);r?.parentNode&&r.parentNode.removeChild(r);const o=document.createElement("calcite-tooltip");o.className="smart-mapping-tooltip",o.id=i,o.referenceElement=e,o.open=n,o.innerHTML=t,document.body.append(o)}function f(e,t,i=!0,n){const r=document.createElement("calcite-tooltip");r.className="smart-mapping-tooltip",r.referenceElement=e,r.open=i,r.innerHTML=t,r.placement=n??"auto",document.body.append(r)}function y(){document.querySelectorAll(".smart-mapping-tooltip").forEach((e=>{e.parentNode?.removeChild(e)}))}function g(e){const t=document.getElementById(e);"smart-mapping-tooltip"===t?.className&&t?.parentNode&&t.parentNode.removeChild(t)}function h(e){return e.min===e.max&&E(e.min)&&(e.min>0?(e.min=0,e.max*=2):e.min<0?(e.min*=2,e.max=0):(e.min=-10,e.max=10)),e}function b(e){const{layer:t,useFeatureReduction:i}=e;return"featureReduction"in t&&"binning"===t.featureReduction?.type&&i||"imagery"===t.type||"imagery-tile"===t.type||"wcs"===t.type?"polygon":"geo-rss"===t.type?"point":t.geometryType}function S(e){const{layer:t}=e;return"stream"===t.type||"point"===b(e)||"multipoint"===b(e)}function T(e){const{layer:t}=e;return!("stream"===t.type)&&"polygon"===b(e)}function v(e){const{layer:t}=e;return!("stream"===t.type)&&"polyline"===b(e)}function E(e){return null!=e}function I(e){if(e.simpleFieldType===r.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}function F(e){setTimeout((()=>{e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),setTimeout((()=>{const e=document.getElementsByTagName("calcite-shell")?.[0];e&&(e.scrollTop=0)}),100)}),100)}function N(e,t){const{modules:i}=e,n=(0,o.b)(t),r=new Intl.NumberFormat(i.intl.getLocale(),{style:"percent"}).format(0);return"rtl"===n?r.endsWith("%"):r.startsWith("%")}function R(e,t){return e.minValue<.001&&e.maxValue<.001?`${e.minValue.toFixed(t).toLocaleString()} - ${e.maxValue.toFixed(t).toLocaleString()}`:`${e.minValue.toLocaleString()} - ${e.maxValue.toLocaleString()}`}function w(e){return"feature"===e.type}!function(e){e.MISSING="missing",e.IN_PROGRESS="inProgress",e.SUCCESS="success",e.FAILED="failed"}(n||(n={})),function(e){e.NUMBER="number",e.STRING="string",e.DATE="date",e.OID="oid",e.GUID="guid",e.UNKNOWN="unknown"}(r||(r={}));let C=["id","fips","fid","objectid","_objectid","__objectid","x","y","lat","long","latitude","longitude","shape","shape_length","shape_leng","shape_area","perimeter","stretched_value","fnode_","tnode_","lpoly_","rpoly_","poly_","subclass","rings_ok","rings_nok","st_length(shape)","st_area(shape)"];async function z(e){const{layer:t,mapImageSublayer:i}=e;let{layerFields:n}=e;if(!t||n)return;e.layerFields=function(e){const{layer:t,useFeatureReduction:i,modules:n}=e;if("featureReduction"in t&&"binning"===t.featureReduction?.type&&i){const i=t.featureReduction.fields,r=[];return i.forEach((i=>{const o=t.fields.find((e=>e.name===i.onStatisticField));i.onStatisticField&&!o||r.push(new n.Field({name:i.name,alias:i.alias||i.name,type:P(e,i)}))})),r}return"fields"in t&&E(t.fields)?t.fields??[]:[]}(e);const o=i?.layer;if(o?.portalItem&&o.url.includes("https://demographics")&&o.url.includes(".arcgis.com")){const e=o.portalItem;try{const t=await e.fetchData();if(t?.thematicGroup){const e=t.thematicGroup.fieldNames;e&&(n=n.filter((t=>e.includes(t.name))))}}catch{}}!function(e){const{layer:t,mapImageSublayer:i,layerFields:n,supportsArcade:o}=e,s="capabilities"in t&&null!=t.capabilities&&"query"in t.capabilities&&"supportsSqlExpression"in t.capabilities.query&&t.capabilities?.query?.supportsSqlExpression;e.fields=[],e.stringFieldsCount=0,e.dateFieldsCount=0,e.numberFieldsCount=0;const l="popupTemplate"in t&&t.popupTemplate?t.popupTemplate.fieldInfos:[],a=me(e),c=a.filter((e=>!!e.field)).map((e=>e.field.toLowerCase()));c?.length&&(C=C.filter((e=>!c.includes(e))));n.forEach((n=>{if(C.includes(n.name.toLowerCase()))return;if("date"===n.type&&(i&&!o||"stream"!==t.type&&!s))return;if("date-only"===n.type&&i)return;const a=l?l.filter((e=>e.fieldName===n.name)):null,u=a?.length?a[0].label:null,d={layerField:n,label:u||n.alias||n.name};!function(e,t,i){const{useFeatureReduction:n}=e;let o=P(e,t.layerField);n&&o&&["date","timestamp-offset"].includes(o)&&(o="string");switch(o){case"string":case"date-only":t.simpleFieldType=r.STRING,e.stringFieldsCount++;break;case"date":t.simpleFieldType=r.DATE,e.dateFieldsCount++;break;case"oid":i.includes(t.layerField.name.toLowerCase())&&(t.simpleFieldType=r.OID);break;case"guid":i.includes(t.layerField.name.toLowerCase())&&(t.simpleFieldType=r.GUID);break;case"small-integer":case"big-integer":case"integer":case"single":case"double":case"long":t.simpleFieldType=r.NUMBER,e.numberFieldsCount++}}(e,d,c),d.simpleFieldType&&e.fields.push(d)}))}(e)}function M(e,t){if(q(e)){const i=Ft(e).filter((e=>e.name===t));if(i.length){const e=i[0];return{label:e.alias??"",layerField:e,simpleFieldType:r.STRING}}}else{const i=e.fields.filter((e=>e.layerField.name===t));if(i.length)return i[0]}}function k(e){const t=e.fields.filter((e=>e.simpleFieldType===r.NUMBER));if(t.length)return t[0]}function x(e){return e.numberFieldsCount>0}function _(e){const{selectedFields:t}=e,i={string:0,number:0,date:0,unknown:0,expression:0,featureReductionExpression:0};return t.forEach((t=>{let n;if(i.expression+=t.expression?1:0,i.featureReductionExpression+=t.featureReductionExpression?1:0,t.field){const i=M(e,t.field);n=i?i.simpleFieldType:r.UNKNOWN}else n=t.simpleFieldType;switch(n){case r.NUMBER:case r.OID:case r.GUID:i.number++;break;case r.STRING:i.string++;break;case r.DATE:i.date++;break;case r.UNKNOWN:i.unknown++}})),i}function V(e,t){const{fields:i}=e;t=t||i;const n={string:0,number:0,date:0,expression:0};return t?.forEach((e=>{switch(e.simpleFieldType){case r.NUMBER:case r.OID:case r.GUID:n.number++;break;case r.STRING:n.string++;break;case r.DATE:n.date++}})),n}function D(e,t){const{layer:i}=e;"featureReduction"in i&&i.featureReduction&&"binning"===i.featureReduction.type||B(e,t)}function B(e,t){const{layer:i}=e;"geojson"!==i.type&&"wfs"!==i.type&&"feature"!==i.type&&"parquet"!==i.type||(i.outFields=t)}function L(e,t){let i=!0;return e.length===t.length&&(e.forEach(((e,n)=>{i&&!U(e,t[n])&&(i=!1)})),i)}function U(e,t){return e&&t&&(e.field??null)===(t.field??null)&&(e.expression??null)===(t.expression??null)&&(e.expressionTitle??null)===(t.expressionTitle??null)}function O(e){return e.simpleFieldType===r.DATE}function A(e,t){const i=t.layerField;switch(P(e,i)){case"small-integer":case"big-integer":case"integer":case"single":case"double":if("domain"in i&&i.domain)return"string";switch("valueType"in i&&i.valueType){case"name-or-title":case"type-or-category":case"description":case"location-or-place-name":case"ordered-or-ranked":case"binary":case"unique-identifier":case"date-and-time":return"string";case"count-or-amount":return"integer";default:return"double"}case"string":case"date-only":return"string";case"date":return"date";default:return"string"}}function P(e,t){const{layer:i}=e;if(t&&"fields"in i){if("type"in t)return t.type;if("statisticType"in t){if(t.onStatisticExpression)return"number"===t.onStatisticExpression.returnType?"double":t.onStatisticExpression.returnType;const e=i.fields?.find((e=>e.name===t.onStatisticField));if(!t.onStatisticField||e){if("count"===t.statisticType)return"integer";if("avg"===t.statisticType)return"double";if(["min","max","sum","mode"].includes(t.statisticType))return e?.type||"integer"}}else;}}function q(e){const{layer:t}=e;return["imagery","imagery-tile","wcs"].includes(t.type)}async function G(e){return("imagery"===e.type||"imagery-tile"===e.type?await e.generateRasterInfo(e.rasterFunction).catch((()=>e.serviceRasterInfo)):"wcs"===e.type?e.serviceRasterInfo:void 0)??void 0}var $,j;!function(e){e.ARCGIS_COMPONENT_NOTIFICATIONS="arcgisComponent_notifications"}($||($={})),function(e){e.SMART_MAPPING_TIP1_DISMISSED="arcgis_smart_mapping_tip1_dismissed",e.SMART_MAPPING_TIP2_DISMISSED="arcgis_smart_mapping_tip2_dismissed"}(j||(j={}));const J=e=>{const t=(e=>localStorage.getItem(e))(e);return t?JSON.parse(t):{}},W=(e,t)=>{const i=J(e);i[t.key]=t.value,((e,t)=>{localStorage.setItem(e,t)})(e,JSON.stringify(i))},H=(e,t)=>{const i=J(e);return Object.keys(i).includes(t)?i[t]:null};function K(e,t){const{layer:i}=e,n=i;return("imagery"===n.type||"imagery-tile"===n.type)&&n.activePresetRendererName?n.activePresetRendererName:t}function X(e){const{layer:t}=e,i=t;if(("imagery"===i.type||"imagery-tile"===i.type)&&i.activePresetRendererName)return i.presetRenderers.find((e=>e.name===i.activePresetRendererName))}function Y(e){const{layer:t}=e,i=t;return("imagery"===i.type||"imagery-tile"===i.type)&&i.activePresetRendererName?X(e)?.renderer??i.renderer:i.renderer}function Q(e){const t=X(e);if(t)return t.bandIds;{const{layer:t}=e;return t.bandIds??void 0}}function Z(e,t){const{layer:i}=e,n=i;let r;if(t)r=t.renderer;else{r=("imagery"===n.type||"imagery-tile"===n.type)&&n.activePresetRendererName?Y(e):n.renderer}switch(r?.type){case"flow":return"raster-flow";case"vector-field":return"raster-vector-field";case"class-breaks":return"raster-class-breaks";case"unique-value":return"raster-unique-value";case"raster-stretch":return gt(e,t)?"raster-rgb":"raster-stretch";case"raster-shaded-relief":return"raster-shaded-relief";default:return r?.type}}function ee(e,t){const{modules:i}=e;te(e,i.esriLang.clone(t||Y(e)))}function te(e,t){const{layer:i}=e,n=i;("imagery"===n.type||"imagery-tile"===n.type)&&n.activePresetRendererName?ne(n.activePresetRendererName,n,t):n.renderer=t}async function ie(e){const{layer:t,modules:i}=e,n=t,r=n.rasterFunction;if(!n.bandIds){const e=await i.smartMappingRasterUtils.getDefaultBandCombination({layer:n,rasterFunction:r});n.bandIds=e}const o=await i.smartMappingRasterUtils.getSupportedRendererInfo({layer:n,rasterFunction:r});return te(e,o.defaultRenderer),o.defaultRenderer}function ne(e,t,i){const n=t.presetRenderers?.find((({name:t})=>t===e));if(!n)return;const{bandIds:r,method:o,name:s,value:l}=n;t.bandIds=r,"raster-function-template"===o?function(e,t){const i=t.rasterFunction?.functionName;if(e===i)return;if(re(e,t))return;const n={functionName:e};if("imagery-tile"===t.type)t.rasterFunction="none"===e?.toLowerCase()?null:n;else if(t.rasterFunction=n,t.mosaicRule?.multidimensionalDefinition){const e=t.mosaicRule.multidimensionalDefinition.map((e=>(e.variableName="",e)));t.mosaicRule.multidimensionalDefinition=e}}(l,t):"variable"===o&&function(e,t){const{type:i}=t;if("imagery-tile"===i){const i=t.multidimensionalDefinition?.map((t=>(t.variableName=e,t)));t.multidimensionalDefinition=i}else{const i=t.mosaicRule?.multidimensionalDefinition?.map((t=>(t.variableName=e,t)));t.mosaicRule.multidimensionalDefinition=i}}(l,t),i&&(n.renderer=i),t.renderer=n.renderer,t.activePresetRendererName=s}function re(e,t){if(!e)return!1;return!se(t).includes(e)}function oe(e){const t=se(e),i=e?.rasterFunction?.functionName;return i&&re(i,e)&&t.unshift(i),t}function se(e){const{type:t}=e;return"imagery-tile"===t?["None"]:e.rasterFunctionInfos?.map((({name:e})=>e))??[]}function le(e,t){const{modules:i}=e;if(!t)return[new i.EsriColor([0,0,0,1]),new i.EsriColor([50,50,50,1]),new i.EsriColor([73,73,73,1]),new i.EsriColor([140,140,140,1]),new i.EsriColor([255,255,255,1])];if("multipart"!==t?.type)return[t.fromColor,t.toColor];const n=t.colorRamps??[],r=n.map((e=>e.fromColor));return r.push(n[n.length-1].toColor),r}const ae="polygon";function ce(e){return ue(e,ge(e))}function ue(e,t){let i="unknown";if(!t)return i;const n=ot(t,"size"),r=ot(t,"color"),o=st(t,"color"),s=lt(t,"color"),l=lt(t,"size"),a=lt(t,"reference-size"),c=lt(t,"spike");if(t.normalizationType&&"field"!==t.normalizationType)return"unknown";if("simple"===t.type)i="simple";else if("dot-density"===t.type)i="dot-density";else if("heatmap"===t.type)i="heatmap";else if("class-breaks"===t.type){const u=t;if(r)i=u.valueExpression&&!s?"color":n?l?.units?"color-size-age":s?.units?"color-age-size":"color-size":s?.style&&o.normalizationField?"compare":s?.units?n?"color-age-size":"color-age":a||c?"color-size":"color";else if(n)i="univariate-color-size"===u.authoringInfo?.type?"color-size":u.valueExpression&&!l?"size":l?.units?"size-age":"size";else{const n=t,r=n.authoringInfo;i=r?"class-breaks-color"===r.type?"color":"class-breaks-size"===r.type||a||c||Te(n.classBreakInfos)?"size":"color":T(e)?n.valueExpression?Te(n.classBreakInfos)?"size":"color":n.backgroundFillSymbol?"size":"color":Te(n.classBreakInfos)?"size":"color"}}else"unique-value"===t.type?r||(i=t.valueExpression?t.authoringInfo&&"predominance"===t.authoringInfo.type||"Predominant category"===t.valueExpressionTitle?ot(t,"size")?"predominance-size":"predominance":t.authoringInfo&&"relationship"===t.authoringInfo.type?ot(t,"size")||a||c?"relationship-size":"relationship":ot(t,"size")||a||c?"type-size":"type":n?l?.units?"type-size-age":"type-size":a||c?"type-size":"type"):"pie-chart"===t.type&&(i=ot(t,"size")?"chart-size":"chart");return i}function de(e,t){const i=st(t,"color"),n=st(t,"size"),r=ue(e,t);i?.normalizationField?(t.normalizationField=i.normalizationField,t.normalizationType="field"):["color-size","color-age-size","color-size-age"].includes(r)&&i?(t.normalizationField=void 0,t.normalizationType=void 0):"size"===r&&n?.normalizationField&&(t.normalizationField=n.normalizationField,t.normalizationType="field")}function me(e,t){t=t||ge(e);let i=[];switch(ue(e,t)){case"relationship":case"relationship-size":{i=[{field:t.authoringInfo.field1.field,simpleFieldType:r.NUMBER},{field:t.authoringInfo.field2.field,simpleFieldType:r.NUMBER}];const n=st(t,"size"),o=lt(t,"reference-size"),s=lt(t,"spike");if(n){const t=M(e,n.field);i.push({field:n.field,expression:n.valueExpression,expressionTitle:n.valueExpressionTitle,simpleFieldType:n.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER})}else o?i.push({field:o.field,simpleFieldType:r.NUMBER}):s&&i.push({field:s.field,simpleFieldType:r.NUMBER});break}case"predominance":case"predominance-size":i=t.uniqueValueInfos.map((t=>({field:`${t.value}`,simpleFieldType:M(e,`${t.value}`)?.simpleFieldType||r.NUMBER})));break;case"chart":case"chart-size":i=t.attributes.map((t=>{const i=M(e,t.field);return{field:t.field,expression:t.valueExpression,expressionTitle:t.valueExpressionTitle,simpleFieldType:t.field&&i?i.simpleFieldType:r.NUMBER}}))}if(i.length)return i;switch(t.type){case"dot-density":i=t.attributes.map((t=>({field:t.field,simpleFieldType:M(e,t.field)?.simpleFieldType||r.NUMBER})));break;case"heatmap":{const n=t;i=n.field?[{field:n.field,simpleFieldType:M(e,n.field)?.simpleFieldType||r.NUMBER}]:[];break}case"class-breaks":{const n=t,o=M(e,n.field);i=[{field:n.field,expression:o?void 0:n.valueExpression,expressionTitle:o?void 0:n.valueExpressionTitle,simpleFieldType:n.field&&o?.simpleFieldType?o.simpleFieldType:r.NUMBER}];const s=st(t,"color"),l=st(t,"size"),a=lt(t,"color"),c=lt(t,"size"),u=lt(t,"reference-size"),d=lt(t,"spike");if(s&&l)if(s.field===l.field&&s.valueExpression===l.valueExpression&&s.valueExpressionTitle===l.valueExpressionTitle){const t=M(e,s.field);i=[{field:s.field,expression:t?void 0:s.valueExpression,expressionTitle:t?void 0:s.valueExpressionTitle,simpleFieldType:s.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER}]}else{if(a?.units)i=[{field:a.field,simpleFieldType:r.DATE}];else{const t=M(e,s.field);i=[{field:s.field,expression:t?void 0:s.valueExpression,expressionTitle:t?void 0:s.valueExpressionTitle,simpleFieldType:s.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER}]}if(c?.units)i.push({field:c.field,simpleFieldType:r.DATE});else{const t=M(e,l.field);i.push({field:l.field,expression:t?void 0:l.valueExpression,expressionTitle:t?void 0:l.valueExpressionTitle,simpleFieldType:l.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER})}}else if(s){if(a?.units)i=[{field:a.field,simpleFieldType:r.DATE}];else{const t=M(e,s.field);i=[{field:s.field,expression:t?void 0:s.valueExpression,expressionTitle:t?void 0:s.valueExpressionTitle,simpleFieldType:s.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER}]}u&&i.push({field:u.field,simpleFieldType:r.NUMBER}),d&&i.push({field:d.field,simpleFieldType:r.NUMBER})}else if(l)if(c?.units)i=[{field:c.field,simpleFieldType:r.DATE}];else{const t=M(e,l.field);i=[{field:l.field,expression:t?void 0:l.valueExpression,expressionTitle:t?void 0:l.valueExpressionTitle,simpleFieldType:l.field&&t?.simpleFieldType?t.simpleFieldType:r.NUMBER}]}else u?i=[{field:u.field,simpleFieldType:r.NUMBER}]:d&&(i=[{field:d.field,simpleFieldType:r.NUMBER}]);if(a?.style&&s&&s.normalizationField){const t=M(e,s.field),n=M(e,s.normalizationField);i=[{field:s.field,simpleFieldType:t?.simpleFieldType?t.simpleFieldType:r.NUMBER},{field:s.normalizationField,simpleFieldType:n?.simpleFieldType?n.simpleFieldType:r.NUMBER}]}break}case"unique-value":if("predominance"===t.authoringInfo?.type){i=t.uniqueValueInfos.map((t=>{const i=M(e,`${t.value}`);return{field:`${t.value}`,simpleFieldType:i?i.simpleFieldType:r.NUMBER}}))}else if("chart"===t.authoringInfo?.type){i=t.uniqueValueInfos.map((t=>{const i=M(e,`${t.value}`);return{field:`${t.value}`,simpleFieldType:i?i.simpleFieldType:r.NUMBER}}))}else if("relationship"===t.authoringInfo?.type){const n=M(e,t.authoringInfo.field1.field),o=M(e,t.authoringInfo.field2.field);i=[{field:t.authoringInfo.field1.field,simpleFieldType:n?.simpleFieldType?n.simpleFieldType:r.NUMBER},{field:t.authoringInfo.field2.field,simpleFieldType:o?.simpleFieldType?o.simpleFieldType:r.NUMBER}]}else{const n=t,o=M(e,n.field);let s=r.NUMBER;n.field&&o?s=o.simpleFieldType||r.NUMBER:n.valueExpression&&n.uniqueValueInfos?.[0]&&"string"==typeof n.uniqueValueInfos[0].value&&(s=r.STRING),i=[{field:n.field,expression:o?void 0:n.valueExpression,expressionTitle:o?void 0:n.valueExpressionTitle,simpleFieldType:s}];const l=st(t,"size"),a=lt(t,"reference-size"),c=lt(t,"spike");if(l){let n=l.field;if(!n){n=(lt(t,"size")||{}).field}const o=M(e,n);i.push({field:n,expression:o?void 0:l.valueExpression,expressionTitle:o?void 0:l.valueExpressionTitle,simpleFieldType:n&&o?.simpleFieldType?o.simpleFieldType:r.NUMBER})}else a?i.push({field:a.field,simpleFieldType:r.NUMBER}):c&&i.push({field:c.field,simpleFieldType:r.NUMBER})}}return i}function pe(e,t,i=!1){if(!e||t&&5!==t.length)return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!1,visibleElements:{interactiveTrack:!0}};switch(e){case"high-to-low":case"above":case"below":return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!1,visibleElements:{interactiveTrack:!0}};case"above-and-below":return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!0,syncedSegmentsEnabled:!i,visibleElements:{interactiveTrack:!i}};case"centered-on":case"extremes":return{handlesSyncedToPrimary:!1,primaryHandleEnabled:!0,syncedSegmentsEnabled:!0,visibleElements:{interactiveTrack:!0}}}}function fe(e){const{mapView:t}=e,i=t.map?.basemap?.baseLayers?.getItemAt(0);if(!i)return"topo";if(!i.url)return"esri.layers.OpenStreetMapLayer"===i.declaredClass?"osm":"topo";const n=i.url.toLowerCase();return n.includes("arcgis/rest/services/World_Street_Map".toLowerCase())?"streets":n.includes("ArcGIS/rest/services/Canvas/World_Light_Gray_Base".toLowerCase())?"gray":n.includes("arcgis/rest/services/World_Topo_Map".toLowerCase())||n.includes("arcgis/rest/services/USGSTopo".toLowerCase())?"topo":n.includes("ArcGIS/rest/services/World_Terrain_Base".toLowerCase())?"terrain":n.includes("arcgis/rest/services/NatGeo_World_Map".toLowerCase())?"national-geographic":n.includes("arcgis/rest/services/Ocean/World_Ocean_Base".toLowerCase())?"oceans":n.includes("arcgis/rest/services/World_Imagery".toLowerCase())?"satellite":n.includes("ArcGIS/rest/services/Reference/World_Boundaries_and_Places".toLowerCase())?"hybrid":n.includes("arcgis/rest/services/Canvas/World_Dark_Gray_Base".toLowerCase())?"dark-gray":"topo"}function ye(e,t,i){if(!(0,s.i)(t)||!(0,s.i)(i))return;const n=e[0].value,r=e[e.length-1].value,o=.3*(r-n);return{min:n-o>t?n-o:void 0,max:r+o<i?r+o:void 0,minMaxSame:n===r}}function ge(e){const{layer:t}=e,i=t,{useFeatureReduction:n}=e;return"featureReduction"in i&&"binning"===i.featureReduction?.type&&n?i.featureReduction.renderer:i.renderer}function he(e,t){const i=ge(e),n="authoringInfo"in i?i.authoringInfo:void 0,r=lt(ge(e),"color"),o=lt(ge(e),"size"),s=lt(ge(e),"reference-size"),l=lt(ge(e),"spike");return s&&"size"===t?"reference-size":l&&"size"===t?"spike":("color"===t?r?.theme:"size"===t?o?.theme:n?.univariateTheme||r?.theme||o?.theme)||""}function be(e,t){const{layer:i,mapImageSublayer:n}=e;if("geo-rss"===i.type){const e=i;e.pointSymbol=e.pointSymbol.clone(),e.lineSymbol=e.lineSymbol.clone(),e.polygonSymbol=e.polygonSymbol.clone()}else!function(e,t){const{layer:i,useFeatureReduction:n}=e;"featureReduction"in i&&"binning"===i.featureReduction?.type&&n?i.featureReduction.renderer=t:!n&&"renderer"in i&&(i.renderer=t)}(e,(t||ge(e)).clone()),n&&(n.renderer=(t||ge(e)).clone())}function Se(e,t,i){const{layer:n,modules:r}=e;i&&"featureReduction"in n&&(n.featureReduction=null),be(e,r.rendererJsonUtils.fromJSON(t)),i&&"featureReduction"in n&&(n.featureReduction=i)}function Te(e){let t,i;for(t=0;t<e.length;t++){const n=e[t].symbol;for(i=0;i<e.length;i++){const r=e[i].symbol;if(t!==i&&ve(n,r))return!0}}return!1}function ve(e,t){return"picture-marker"!==e.type&&("cross"===e.style||"x"===e.style?"cross"===t.style||"x"===t.style?!e.outline.color&&!t.outline.color||e.outline.color&&t.outline.color&&e.outline.color.toString()===t.outline.color.toString():!e.outline.color&&!t.color||e.outline.color&&t.color&&e.outline.color.toString()===t.color.toString():"cross"===t.style||"x"===t.style?!e.color&&!t.outline.color||e.color&&t.outline.color&&e.color.toString()===t.outline.color.toString():!e.color&&!t.color||e.color&&t.color&&e.color.toString()===t.color.toString())}function Ee(e,t){const{modules:i}=e,n=ge(e),r=ce(e);if(["unique-size","unique-size-age"].includes(r))return null;let o;const s=st(n,"color"),l=n.classBreakInfos?n.classBreakInfos:n.uniqueValueInfos;let a;return s?(a=s.stops.map((e=>e.color)),o=i.colorSchemes.getMatchingSchemes({theme:t||"high-to-low",colors:a,geometryType:b(e)||ae})):l&&l.length>=1&&(a=l?l.map((t=>Oe(e,t.symbol))).filter((e=>e)):null,a?.length&&(a.length>10&&(a=a.slice(0,9)),o=function(e,t,i){const{modules:n}=e;let r=n.colorSchemes.getMatchingSchemes({theme:i||"high-to-low",colors:t,geometryType:b(e)||ae});i&&(!r||r&&!r.length)&&(r=n.colorSchemes.getMatchingSchemes({theme:"high-to-low",colors:t,geometryType:b(e)||ae}));(!r||r&&!r.length)&&(r=n.colorSchemes.getMatchingSchemes({theme:"above-and-below",colors:t,geometryType:b(e)||ae}));return r}(e,a,t))),o?.length?o[0]:null}function Ie(e){const{mapView:t,modules:i}=e,n=ge(e).uniqueValueInfos;if(!n||n.length<2)return null;const r=Math.sqrt(n.length),o=i.relationshipSchemes.getSchemes({basemap:t.map?.basemap||"topo",geometryType:b(e)}),s=[o.primaryScheme].concat(o.secondarySchemes),l=[];return s.forEach((t=>{let o=[];t.colorsForClassBreaks[r-2].colors.forEach((e=>{o=o.concat(i.esriLang.clone(e))}));n.some((t=>{const i=Oe(e,t.symbol);return!!i&&!o.find((e=>Me(e,i)))}))||l.push(t)})),l.length?l[0]:null}function Fe(e,t){const{mapView:i,modules:n}=e,r=ge(e);if(!r.uniqueValueInfos||r.uniqueValueInfos.length<2)return null;return Ce(e,n.typeSchemes.getSchemes({basemap:i.map?.basemap,geometryType:b(e)||ae,numColors:t??r.uniqueValueInfos.length}))}function Ne(e){const{mapView:t,modules:i}=e,n=ge(e);if(!n.uniqueValueInfos||n.uniqueValueInfos.length<2)return null;return Ce(e,i.predominanceSchemes.getSchemes({basemap:t.map?.basemap,geometryType:b(e),numColors:10}))}function Re(e){const{mapView:t,modules:i}=e,n=ge(e);if(!n.attributes||n.attributes.length<2)return null;return Ce(e,i.pieChartSchemes.getSchemes({basemap:t.map?.basemap,geometryType:b(e),numColors:10}))}function we(e){const{mapView:t,modules:i}=e,n=ge(e).colorStops.filter(((e,t)=>t>=3)).map((e=>e.color)),r=i.heatmapSchemes.getSchemes({basemap:t.map?.basemap||"topo"}),o=[r.primaryScheme].concat(r.secondarySchemes),s=[];return o.forEach((e=>{n.some(((t,i)=>!Me(e.colors[i],t)))||s.push(e)})),s.length?s[0]:null}function Ce(e,t){const i=ge(e).uniqueValueInfos;if(!i||i.length<2)return null;const n=ke(t,Math.min(i.length,10)),r=[];return n.forEach((t=>{i.filter(((e,t)=>t<10)).some(((i,n)=>{const r=Oe(e,i.symbol);return!!r&&!Me(t.colors[n],r)}))||r.push(t.scheme)})),r.length?r[0]:null}function ze(e){const{mapView:t,modules:i}=e;return i.typeSchemes.getSchemes({basemap:t.map?.basemap,geometryType:b(e)||ae}).primaryScheme}function Me(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b}function ke(e,t){const i=_e(e),n=[];return i.forEach((e=>{const i=t>0,r=!!e.colorsForClassBreaks;let o;o=i&&r?function(e,t){const i=e.length;let n=[];for(let r=0;r<i;r++){const i=e[r];if(t<i.numClasses)break;n=i.colors}return n}(e.colorsForClassBreaks,t):e.colors,n.push({colors:o,scheme:e})})),n}function xe(e){const t=_e(e);let i=[];return t.forEach((e=>{e.colors&&(i=i.concat(e.colors))})),function(e){const t={};return e.filter((e=>{const i=!t[e.toHex()];return i&&(t[e.toHex()]=1),i}))}(i)}function _e(e){return[e.primaryScheme].concat(e.secondarySchemes)}function Ve(e,t){const{modules:i}=e,n=i.typeSchemes.getSchemes({theme:"default",basemap:fe(e),geometryType:b(e)}).primaryScheme;let r;if(S(e)||t&&["size","color-size","color-age-size","color-size-age","color-age-size-age","type-size","predominance-size","chart-size","relationship-size"].includes(t)){const e=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.outline.color),width:n.outline.width});r=new i.SimpleMarkerSymbol({style:"circle",size:n.size,outline:e,color:n.noDataColor})}else if(T(e)){const e=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.outline.color),width:n.outline.width});r=new i.SimpleFillSymbol({style:"solid",outline:e,color:n.noDataColor})}else v(e)&&(r=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.noDataColor),width:n.width}));return r}function De(e,t){const{modules:i}=e,n=i.typeSchemes.getSchemes({theme:"default",basemap:fe(e),geometryType:"line"===t?"polyline":t}).primaryScheme;let r;if("point"===t){const e=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.outline.color),width:n.outline.width});r=new i.SimpleMarkerSymbol({style:"circle",size:n.size,outline:e,color:n.noDataColor})}else if("polygon"===t){const e=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.outline.color),width:n.outline.width});r=new i.SimpleFillSymbol({style:"solid",outline:e,color:n.noDataColor})}else"line"===t&&(r=new i.SimpleLineSymbol({style:"solid",color:new i.EsriColor(n.noDataColor),width:n.width}));return r}function Be(e){const{modules:t}=e;return new t.SimpleFillSymbol({color:[184,184,184,1],style:"solid",outline:{type:"simple-line",color:"white",width:1}})}function Le(e,t){if(!t)return!1;let i=!1;const n=Oe(e,t);if(t&&"esri.symbols.SimpleFillSymbol"===t.declaredClass){const e=t.outline;n&&0!==n.a||e&&(!e||e.color)&&0!==e.color.a||(i=!0)}else if(t&&"esri.symbols.SimpleLineSymbol"===t.declaredClass)n&&0!==n.a||(i=!0);else if(t&&"esri.symbols.SimpleMarkerSymbol"===t.declaredClass){const e=t.outline;n&&0!==n.a||e&&(!e||e.color)&&0!==e.color.a||(i=!0)}return i}function Ue(e,t){const{modules:i}=e;if(t){return"dark"===i.previewSymbol2D.getContrastingBackgroundTheme(t,245)}return!1}function Oe(e,t){const{modules:i}=e;return"cim"===t?.type?i.EsriColor.fromJSON(i.cimSymbolUtils.getCIMSymbolColor(t)?.toJSON()):"simple-marker"===t?.type&&["x","cross"].includes(t?.style)?t?.outline?.color:t?.color}function Ae(e,t,i){const{modules:n}=e;"picture-marker"!==t.type&&("cim"===t.type?n.cimSymbolUtils.applyCIMSymbolColor(t,i):"simple-marker"===t.type&&t.style&&["cross","x"].includes(t.style)?(t.outline||(t.outline=new __esri.SimpleLineSymbol),t.outline.color=i):t.color=i)}function Pe(e,t){return e&&(e.a=t),e}function qe(e,t){const{modules:i}=e;return"cim"===t.type?i.cimSymbolUtils.getCIMSymbolSize(t):t.size?t.size:t.width}function Ge(e,t,i){const{modules:n}=e;if("cim"===t.type)n.cimSymbolUtils.scaleCIMSymbolTo(t,i);else if((0,s.i)(t.size))t.size=i;else{const e=t.height/t.width;t.width=i,t.height=t.width*e}}function $e(e){const t=e.data.symbol.symbolLayers?.find((e=>["CIMSolidStroke","CIMPictureStroke"].includes(e.type)));return t?.width??0}function je(e,t){const{modules:i}=e;return"cim"===t.type?i.cimSymbolUtils.getCIMSymbolRotation(t,!0):["simple-marker","picture-marker"].includes(t.type)?t.angle:void 0}function Je(e,t,i){const{modules:n}=e;null!=i&&("cim"===t.type?n.cimSymbolUtils.applyCIMSymbolRotation(t,i,!0):["simple-marker","picture-marker"].includes(t.type)&&(t.angle=i))}function We(e){return"picture-marker"!==e.type&&("cim"===e.type?["CIMPolygonSymbol"].includes(e.data.symbol.type)&&!!Ye(e):!!e.outline?.color)}function He(e,t,i){if(t.uniqueValueInfos?.length){const n=t.uniqueValueInfos.slice();n.forEach((t=>{const n=i.clone();Ae(e,n,Oe(e,t.symbol)),t.symbol=n})),t.uniqueValueInfos=n}else if(t.classBreakInfos?.length){const n=t.classBreakInfos.slice();n.forEach((t=>{const n=i.clone();Ae(e,n,Oe(e,t.symbol)),t.symbol=n})),t.classBreakInfos=n}else if(t.symbol){const n=i.clone();Ae(e,n,Oe(e,t.symbol)),t.symbol=n}}function Ke(e,t,i){if(t.uniqueValueInfos?.length){const n=t.uniqueValueInfos.slice();n.forEach((t=>{const n=i.clone();Ae(e,n,Oe(e,t.symbol)),t.symbol=n})),t.uniqueValueInfos=n}else if(t.classBreakInfos?.length){const n=t.classBreakInfos.slice();n.forEach((t=>{const n=i.clone();Ae(e,n,Oe(e,t.symbol)),t.symbol=n})),t.classBreakInfos=n}else if(t.symbol){const n=i.clone();Ae(e,n,Oe(e,t.symbol)),t.symbol=n}}function Xe(e){return"cim"===e.type&&"CIMLineSymbol"===e.data.symbol?.type}function Ye(e){return"CIMPointSymbol"===e.data.symbol?.type?function(e){const t=e.data.symbol.symbolLayers;return t.find((e=>"CIMSolidStroke"===e.type))}(e):"CIMLineSymbol"===e.data.symbol?.type?function(e){const t=e.data.symbol.symbolLayers;return t[0]}(e):"CIMPolygonSymbol"===e.data.symbol?.type?function(e){const t=e.data.symbol.symbolLayers;return t.find((e=>"CIMSolidStroke"===e.type))}(e):void 0}function Qe(e){const{mapImageSublayer:t,layer:i}=e;return!t||!!i.sourceJSON?.cimVersion}function Ze(e){return!(!e.style||!["cross","x"].includes(e.style))}function et(e,t){return"picture-marker"===t.type||"cim"===t.type&&!function(e,t){const{modules:i}=e;return!!i.cimSymbolUtils.getCIMSymbolColor(t)}(e,t)}function tt(e,t){return"simple-line"===e.type?{width:12,height:3}:"cim"===e.type&&"CIMLineSymbol"===e.data.symbol.type?void 0:"simple-fill"===e.type?14:"cim"===e.type&&"CIMPolygonSymbol"===e.data.symbol.type?t?18:void 0:"cim"===e.type?20:14}function it(e,t,i){if(t.type!==i.type)return{hasOtherChanges:!0,any:!0};const n=je(e,t)!==je(e,i),r=Math.abs(qe(e,t)-qe(e,i))>.01,o=JSON.stringify(Oe(e,t)?.toJSON())!==JSON.stringify(Oe(e,i)?.toJSON()),s=!!["simple-marker","simple-fill"].includes(t.type)&&JSON.stringify(t.outline?.toJSON())!==JSON.stringify(i.outline?.toJSON()),l=t.clone();Ge(e,l,qe(e,i)),Ae(e,l,Oe(e,i)),["simple-marker","simple-fill"].includes(t.type)&&(l.outline=i.outline.clone()),Je(e,l,je(e,i));const a=!function(e,t){if(JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON()))return!0;if("cim"===e.type&&"cim"===t.type)return rt(e.toJSON().symbol,t.toJSON().symbol);return!1}(l,i);return{rotation:n&&!r&&!o&&!s&&!a,size:r&&!n&&!o&&!s&&!a,outline:s&&!n&&!r&&!o&&!a,color:o&&!n&&!r&&!s&&!a,other:a,any:n||r||s||o||a}}function nt(e,t,i,n,r){return r.rotation?Je(e,t,je(e,i)):r.size?Ge(e,t,qe(e,i)):r.color?("picture-marker"===t.type&&(t=i.clone()),Ae(e,t,n)):r.outline?"picture-marker"===t.type?t=i.clone():t.outline=i.outline?.clone():Ae(e,t=i.clone(),n),t}function rt(e,t){const i=Object.keys,n=typeof e;return e&&t&&"object"===n&&n===typeof t?i(e).length===i(t).length&&i(e).every((i=>"size"===i||"width"===i?Math.abs(e[i]-t[i])<.01:rt(e[i],t[i]))):e===t}function ot(e,t,i){const n=e&&e.visualVariables;return!!n&&n.some((e=>{const n=e.target,r="$view.scale"===e.valueExpression;return e.type===t&&(!(0,s.i)(n)&&!(0,s.i)(i)&&!r||n===i||"auto"===i&&r)}))}function st(e,t,i){const n=e&&e.visualVariables;if(n){const e=n.filter((e=>{const n=e.target,r="$view.scale"===e.valueExpression;return e.type===t&&(!(0,s.i)(n)&&!(0,s.i)(i)&&!r||n===i||"auto"===i&&r&&!n)}));if(e.length)return e[0]}}function lt(e,t,i){if(!e?.authoringInfo)return;const n=e?.authoringInfo?.visualVariables;if(n){const e=n.filter((e=>{const n=e.target;return"reference-size"===t?"size"===e.type&&"reference-size"===e.theme:"spike"===t?"size"===e.type&&"spike"===e.theme:e.type===t&&(!(0,s.i)(n)&&!(0,s.i)(i)||n===i)}));if(e.length)return e[0]}}function at(e,t,i){const n=e&&e.visualVariables;if(n){const e=n.filter((e=>{const n=e.target,r="$view.scale"===e.valueExpression;return!(e.type===t&&(!(0,s.i)(n)&&!(0,s.i)(i)&&!r||n===i||"auto"===i&&r))}));if(e.length)return e}}function ct(e,t,i){if(!("authoringInfo"in e)||!e.authoringInfo)return;let n=e?.authoringInfo?.visualVariables;if(n){"reference-size"===t&&(n=n.filter((e=>!("size"===e.type&&"reference-size"===e?.theme)))),"spike"===t&&(n=n.filter((e=>!("size"===e.type&&"spike"===e?.theme))));const e=n.filter((e=>{const n=e.target;return!(e.type===t&&(!(0,s.i)(n)&&!(0,s.i)(i)||n===i))}));if(e.length)return e}}function ut(e,t){const i=ue(e,t),n=st(t,"size","outline"),r=st(t,"size","auto"),o=st(t,"rotation");let s,l;return["predominance","predominance-size"].includes(i)||(s=st(t,"opacity"),l=lt(t,"opacity")),{sizeOutlineVisVar:n,sizeAutoVisVar:r,opacityVisVar:s,authOpacityVisVar:l,rotationVisVar:o}}function dt(e,t,i){const{sizeOutlineVisVar:n,opacityVisVar:r,authOpacityVisVar:o,rotationVisVar:s}=e;!lt(t,"reference-size")&&n&&(t.visualVariables=at(t,"size","outline")||[],t.visualVariables.push(n)),r&&o&&!i?.notOpacity&&(t.visualVariables=at(t,"opacity")||[],t.visualVariables.push(r),t.authoringInfo=t.authoringInfo||{},t.authoringInfo.visualVariables=ct(t,"opacity")||[],t.authoringInfo.visualVariables.push(o)),s&&(t.visualVariables=t.visualVariables||[],t.visualVariables.push(s))}var mt;!function(e){e.NONE="none",e.MINIMUM_MAXIMUM="min-max",e.PERCENT_CLIP="percent-clip",e.STANDARD_DEVIATION="standard-deviation"}(mt||(mt={}));const pt={STD_DEV:2,MIN_PERCENT:2,MAX_PERCENT:2,GAMMA:1,STRETCH_TYPE:mt.NONE};async function ft(e){const{layer:t,modules:i}=e,n=t,r="imagery"===n.type?n.rasterFunction:void 0;return n.bandIds=await ht(e),await i.RasterRGBCreator.createRenderer({layer:n,rasterFunction:r,rgbBandIds:n.bandIds}).then((t=>(n.effect=void 0,ee(e,t.renderer),t)))}async function yt(e,t){const{layer:i,modules:n}=e,r=i,o=Y(e),s="imagery"===r.type?r.rasterFunction:void 0;return t=t||{},await n.RasterRGBCreator.createRenderer({layer:r,rasterFunction:s,rgbBandIds:r.bandIds,stretchType:t.stretchType||o.stretchType,useGamma:t.useGamma||o.useGamma,gamma:t.gamma||o.useGamma?o.gamma:[1,1,1]}).then((e=>(e.renderer.dynamicRangeAdjustment=o.dynamicRangeAdjustment,e.renderer.colorRamp=o.colorRamp,e.renderer.customStatistics=o.customStatistics,E(e.renderer.numberOfStandardDeviations)&&0!==e.renderer.numberOfStandardDeviations||(e.renderer.numberOfStandardDeviations=pt.STD_DEV),e)))}function gt(e,t){const{layer:i,rasterInfo:n}=e,r=i,o=t?"raster-stretch"===t.renderer.type:"raster-stretch"===Y(e)?.type;if(!o)return!1;const s=t?t.bandIds:r.bandIds,l=!!(s&&s.length>1),a=n.bandCount>1,c=t?t.renderer.gamma?.length>1:Y(e).gamma?.length>1;return o&&(l||a&&c)}async function ht(e){const{layer:t,rasterInfo:i,modules:n}=e,r=t,{bandCount:o}=i,s=n.esriLang.clone(await n.smartMappingRasterUtils.getDefaultBandCombination({layer:r})),l=s.length;3!==l&&s.push(...new Array(3-l).fill(o-1));const a=X(e);return a&&3!==a.bandIds?.length?a.bandIds=s:3!==r.bandIds?.length&&(r.bandIds=s),a?a.bandIds:r.bandIds}var bt;!function(e){e.NONE="none",e.MINIMUM_MAXIMUM="min-max",e.PERCENT_CLIP="percent-clip",e.STANDARD_DEVIATION="standard-deviation"}(bt||(bt={}));const St={STD_DEV:2,MIN_PERCENT:2,MAX_PERCENT:2,GAMMA:1,BAND_INDEX:0,STRETCH_TYPE:bt.NONE};async function Tt(e){const{layer:t,modules:i}=e,n=t,r="imagery"===n.type?n.rasterFunction??void 0:void 0;return n.bandIds=[0],await i.RasterStretchCreator.createRenderer({layer:n,rasterFunction:r}).then((t=>(n.effect=void 0,ee(e,t.renderer),t)))}async function vt(e,t){const{layer:i,modules:n}=e,r=i,o=Y(e),s="imagery"===r.type?r.rasterFunction??void 0:void 0;return t=t||{},await n.RasterStretchCreator.createRenderer({layer:r,rasterFunction:s,stretchType:t.stretchType||o.stretchType,useGamma:t.useGamma||o.useGamma,gamma:t.gamma||o.useGamma&&o.gamma?.[0]?o.gamma[0]:1}).then((e=>(e.renderer.dynamicRangeAdjustment=o.dynamicRangeAdjustment,e.renderer.colorRamp=o.colorRamp,e.renderer.customStatistics=o.customStatistics,E(e.renderer.numberOfStandardDeviations)&&0!==e.renderer.numberOfStandardDeviations||(e.renderer.numberOfStandardDeviations=St.STD_DEV),e)))}async function Et(e){const{layer:t,modules:i}=e,n=t,r="imagery"===n.type?n.rasterFunction??void 0:void 0;return await i.RasterUniqueValueCreator.createRenderer({layer:n,rasterFunction:r})}async function It(e,t){const{layer:i,modules:n}=e,r=i,o=Y(e),s="imagery"===r.type?r.rasterFunction??void 0:void 0;return t=t||{},await n.RasterUniqueValueCreator.createRenderer({layer:r,rasterFunction:s,classFieldName:t.field||o.field,colorRamp:t.colorRamp??null})}function Ft(e){const{rasterInfo:t,modules:i,strings:n}=e;let r;const o=t?.attributeTable?.fields;return r=o?o.filter((e=>"oid"!==e.type)):[new i.Field({name:"value",alias:n.panels.uniqueValue.value})],r}}}]);