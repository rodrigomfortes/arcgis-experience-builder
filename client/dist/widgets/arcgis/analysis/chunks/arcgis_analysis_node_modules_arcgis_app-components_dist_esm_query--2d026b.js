/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_query--2d026b.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_query--2d026b"],{41976:(t,e,n)=>{n.d(e,{M:()=>b,a:()=>C,b:()=>j,c:()=>F,d:()=>I,e:()=>q,f:()=>E,g:()=>$,h:()=>A,i:()=>k,j:()=>m,k:()=>M,q:()=>O});var r=n(90310),i=n(83929),o=n(50020),s=n(96295),l=n(50637),a=n(4429),u=n(87744),c=n(66337),d=n(44388),g=n(80030),v=n(43555),p=n(72411),y=n(58857);async function m(t){const e=(0,u.d)(t),{collaborations:n}=await(0,l.r)(`${e}portals/self/collaborationsSummary`,{includeParticipantInfo:!0});return n}async function f(t,e,n,r,i){return async function(t,e,n,r,i){const o=(0,u.d)(n);return await(0,l.r)(`${o}portals/self/collaboratedItems`,Object.assign(Object.assign({collaborationId:t},e?{participantId:e}:{}),{start:r,num:i}))}(t,e,n,r,i)}const b=175,h=["nonspatial","point","polygon","multipoint","polyline"];let w;function $(t,e,n){var r;const i={};null===(r=t.results)||void 0===r||r.forEach((t=>{var e;null===(e=(0,p.f)(null==t?void 0:t.tags))||void 0===e||e.forEach((t=>{t&&(i[t]=(i[t]||0)+1)}))}));const o=Object.entries(i).sort(((t,e)=>e[1]-t[1])).map((([t])=>t));return(0,a.b)([...e||[],...o||[],...n||[]])}async function O({portal:t,query:e,user:n,contentUser:r,userContentGroups:a,store:c,config:g,allowedSubscriptionContentTypes:v,groupId:p,showHiddenItems:y}){var m,$,O,j,I,P,q,C,E;let M=(0,u.g)(t),F={};const{num:L,start:R,sortOrder:x,sortField:G,filters:B,baseQuery:H,baseFilter:U,searchTerm:D,bucket:N,allowedGeometries:W}=e;if((null==w?void 0:w.signal)&&w.abort(),c.state.recycleBin)return w=new AbortController,"my"===N?_({query:e,portal:t,user:r||n}):T({query:e,portal:t});if("group"===N&&a&&0===a.length)return{highlights:[],nextStart:-1,num:60,results:[],start:1,total:0};const z=p||"group"===N&&(null===(m=null==B?void 0:B.group)||void 0===m?void 0:m.id)&&"all"!==(null===($=null==B?void 0:B.group)||void 0===$?void 0:$.group)&&(null===(O=null==B?void 0:B.group)||void 0===O?void 0:O.group)||"living atlas"===N&&(null!==(j=null==c?void 0:c.state.livingAtlasGroupId)&&void 0!==j?j:await async function(t,e){var n,r;const o=await(0,i.q)({q:t.livingAtlasGroupQuery,num:1,sortField:"title",sortOrder:"asc"},t),s=(null===(r=null===(n=o.results)||void 0===n?void 0:n[0])||void 0===r?void 0:r.id)||"";e&&(e.state.livingAtlasGroupId=s);return s}(t,c))||"living atlas analysis"===N&&(null!==(I=null==c?void 0:c.state.livingAtlasAnalysisGroupId)&&void 0!==I?I:await async function(t,e){var n,r;const o=await(0,i.q)({q:S(t),num:1,sortField:"title",sortOrder:"asc"},t),s=(null===(r=null===(n=o.results)||void 0===n?void 0:n[0])||void 0===r?void 0:r.id)||"";e&&(e.state.livingAtlasAnalysisGroupId=s);return s}(t,c));if("subscription content"===N)return A(t,n,v);await k(t,N)&&(M="https://www.arcgis.com/sharing/rest/",F.addTokenManually=!1);const Q=z?`content/groups/${z}/`:"",V=`${M}${Q}search`,J=function(t,e){if(!(null==t?void 0:t.length)||t.length===(null==h?void 0:h.length)||(null==e?void 0:e.isPortal))return"";return`((-typekeywords:"Hosted Service") OR (typekeywords:"Hosted Service" AND geometrytype:(${t.map((t=>`"${t}"`)).join(" OR ")})))`}(W,t),K=Object.keys(B||{}),X=N?await async function({bucket:t,contentUser:e,user:n,portal:r,filters:i}){switch(t){case"my":return`owner: ${(e||n).username}`;case"org":return`orgid:${r.id} ${r.isPortal?"-owner:esri_apps -owner:esri_webstyles -owner:esri_nav -owner:esri_livingatlas":""}`;case"favorites":return`group: ${await(0,o.h)()}`;case"group":if(!(null==i?void 0:i.group)||"all"===(null==i?void 0:i.group.group)){const t=await(0,o.e)(n);return(null==t?void 0:t.length)>b?"":`group:(${null==t?void 0:t.map((({id:t})=>t)).join(" OR ")})`}default:return""}}({bucket:N,user:n,contentUser:r,portal:t,store:c,filters:B}):"",Y=D&&(null===(P=(0,d.c)(D))||void 0===P?void 0:P.length)?`(${(0,d.c)(D)}) `:"",Z=!(!(null==g?void 0:g.semanticSearchEnabled)||!(null===(q=null==t?void 0:t.portalProperties)||void 0===q?void 0:q.semanticSearchEnabled))||n&&!n.orgId,tt=Object.assign(Object.assign(Object.assign({},U?{filter:`${U}`}:{}),Z?{enriched:!0}:{}),{q:`${H||""} ${J} ${X} ${Y} ${y?"":s.H}`,displaySublayers:!0,displayHighlights:!0,displayServiceProperties:!0}),et=Boolean(B.collaborations);let nt;et&&(nt=await async function(t,e,n,r){var i,o,s;const l=e.collaboration.id,a=null===(s=null===(o=null===(i=e.additionalParams)||void 0===i?void 0:i.origin)||void 0===o?void 0:o.split("__"))||void 0===s?void 0:s[1],u=await f(l,a,t,n,r),c=(null==u?void 0:u.collaboratedItems.map((t=>Object.keys(t)[0])))||[];return e.value=c.length?`id:(${c.join(" OR ")})`:"",u}(t,B.collaborations,R,L));const rt=[],it=K.reduce(((t,e)=>{const{param:n,value:r,additionalParams:i}=B[e];if(N&&"group"===e&&"group"!==N||"group"===e&&Q||"folder"===e&&"my"!==N||"contentType"===e||"region"===e&&!["living atlas","living atlas analysis"].includes(N))return t;"categories"===e&&r&&rt.push(B[e].category),"region"===e&&r&&rt.push(B[e].categoryValue);const o="categories"===n?{}:{[n]:`${t[n]||""} ${r}`};return Object.assign(Object.assign(Object.assign({},t),o),null!=i?i:{})}),tt),ot=Object.assign(Object.assign({num:L,start:et?1:R},"relevance"===G?{}:{sortField:G,sortOrder:x}),it||{}),st=rt.length?rt.map((t=>`categories=${encodeURIComponent(JSON.stringify([t]))}`)).join("&"):"",lt=rt.length?"?":"";try{const t=await(0,l.r)(`${V}${lt}${st}`,ot,F);let e=Object.assign(Object.assign({},t),{queryParams:ot});return B.collaborations&&nt&&(null===(C=e.results)||void 0===C?void 0:C.length)&&(e=function(t,e){const{start:n,num:r,nextStart:i,total:o}=e;if(null!=n&&null!=r&&null!=o&&null!=i){const e=Object.assign(Object.assign({},t),{start:n,num:r,total:o});return e.queryParams.start=n,e.queryParams.num=r,e}return t}(e,nt)),e}catch(t){if(498===(null===(E=null==t?void 0:t.details)||void 0===E?void 0:E.httpStatus)&&"Invalid token."===(null==t?void 0:t.message)){const t=await(0,l.r)(`${V}${lt}${st}`,ot,Object.assign(Object.assign({},F),{addTokenManually:!1}));return Object.assign(Object.assign({},t),{queryParams:ot})}}}function j(t,e){if(!e.deepLayerSearchEnabled)return{};const n={};return(t.highlights||[]).forEach((e=>{var r;const i=null===(r=t.results)||void 0===r?void 0:r.find((t=>t.id===e.id));if(!(null==i?void 0:i.sublayers))return;const o=Object.keys(e).filter((t=>"id"!==t&&t.includes("sublayers."))).reduce(((t,n)=>{const r=function(t){const e=t.replace("sublayers.","");return{fieldaliases:"fieldAliases",title:"title"}[e]||e}(n);return t[r]=e[n].map((t=>t.replaceAll("<em>","").replaceAll("</em>",""))),t}),{}),s=i.sublayers.filter((t=>Object.keys(t).some((e=>{var n;return null===(n=o[e])||void 0===n?void 0:n.some((n=>t[e].includes(n)))})))).map((t=>t.id));n[e.id]=Object.assign(Object.assign({},e),{sublayers:s})})),n}function S(t){return`title:"Living Atlas Analysis Layers" AND owner:${!0===t.isPortal?"esri_livingatlas":"esri"}`}async function k(t,e){var n;if((null==t?void 0:t.isPortal)&&"all"===e){const e=await(0,i.f)(t);if(null===(n=null==e?void 0:e.portalConfigProperties)||void 0===n?void 0:n.searchArcGISOnlineEnabled)return!0}return!1}async function I(t,e){return t&&e?(0,l.f)((async()=>{const n=`${(0,u.g)(e)}community/users/${t.username}/provisionedListings`;return(0,c.f)(n,{},"provisionedListings")}),"provisionedListings",`${e.id}-${t.username}`):[]}async function A(t,e,n){return e?(0,l.f)((async()=>{const i=await I(e,t);if(!(null==i?void 0:i.length))return{total:0,results:[],start:-1,num:100,nextStart:0};const o=null==i?void 0:i.map((t=>t.itemId)),s=await Promise.all(o.map((e=>async function(t,e){try{return(0,g.d)(t,e)}catch(t){return null}}(e,t)))),l=await Promise.all(null==o?void 0:o.map((e=>async function(t,e){var n;try{return null!==(n=(await(0,r.c)(t,e,{relationshipType:"Listed2ImplicitlyListed",direction:"forward"})).relatedItems)&&void 0!==n?n:[]}catch(t){return[]}}(e,t)))),a=l.reduce(((t,e)=>t.concat(e)),s).filter((t=>function(t,e){return null!=e||(e=["Map Service","Image Service","Feature Service","Stream Service","Vector Tile Service","WMS","WFS","WMTS","KML","Feature Collection","Feed"]),e.includes(null==t?void 0:t.type)}(t,n)));return{total:a.length,results:a,start:a.length?1:0,num:100,nextStart:0}}),"subscriptionContent",`${t.id}-${e.username}`):{total:0,results:[],start:0,num:100,nextStart:0}}async function P(t,e){return new Promise((async(n,r)=>{var i;null===(i=null==w?void 0:w.signal)||void 0===i||i.addEventListener("abort",(()=>{r(new DOMException("Aborted","AbortError"))}));const{start:o,num:a,sortField:u,sortOrder:c,searchTerm:d}=t,g=await(0,l.r)(e,{foldersContent:!0,inRecycleBin:!0,ignoreTypes:s.R,start:o,num:a,sortField:u,sortOrder:c}),v=d?g.items.filter((t=>t.title.toLowerCase().includes(d.toLowerCase()))):g.items,p=!!d&&v.length!==g.items.length;return n(Object.assign(Object.assign({},g),{results:v,num:a,queryParams:t,partial:p}))}))}const q=async({portal:t,user:e,forOrg:n})=>{var r;const i={start:0,num:100,sortField:"size",sortOrder:"desc"},o=n?await T({portal:t,query:i}):await _({query:i,portal:t,user:e});return null===(r=null==o?void 0:o.results)||void 0===r?void 0:r.reduce(((t,e)=>t+e.size),0)};async function _({query:t,portal:e,user:n}){return P(t,`${(0,u.g)(e)}content/users/${n.username}/`)}async function T({query:t,portal:e}){return P(t,`${(0,u.g)(e)}content/portals/${e.id}/`)}async function C(t,e,n){if(!(null==e?void 0:e.length)||!(null==n?void 0:n.length))return{result:{}};try{const r=[];(0,a.g)(e,100).forEach((e=>{r.push((0,l.r)(`${(0,u.g)(t)}content/itemsgroups`,{items:n.map((t=>t.id)).join(","),groups:e.map((t=>t.id)).join(",")}))}));const i=(await Promise.all(r)).reduce(((t,e)=>(Object.values(e).forEach((e=>{const{groupId:n,items:r}=e;r.forEach((({itemId:e})=>{t[e]=[...t[e]||[],n]}))}),{}),t)),{});return{result:i}}catch(t){return{result:{}}}}async function E(t,e){try{const n=`${(0,u.g)(t)}search`;return{result:(await(0,l.r)(n,{q:`id:(${e.join(" OR ")})`})).results}}catch(t){return{result:[]}}}async function M(t,e,n,r){var i;const o=await k(e,r.state.bucket),s=o?`https://www.arcgis.com/sharing/rest/content/items/${t.id}`:(0,v.g)(t.id,e),a=o||!n?{disableIdentityLookup:!0,addTokenManually:!1}:{};try{return{result:await(0,l.r)(s,{},a)}}catch(t){if("SB_0005"===(null===(i=null==t?void 0:t.details)||void 0===i?void 0:i.messageCode))return{error:{code:"disabledSubscription"}}}return{error:{code:"unhandledError"}}}function F({bucket:t,oldBucket:e,filters:n,user:r,switchingBucket:i,keepSpecialFilters:o}){var s,l,a,u;const c=Object.assign({},n);"my"===t||o&&"recycle"!==(null===(s=c.folder)||void 0===s?void 0:s.folder)||delete c.folder,"org"!==t&&("recycle"===(null===(l=c.contentType)||void 0===l?void 0:l.contentType)?c.contentType.contentType="all":o||delete c.contentType),"group"===t||o||delete c.group;const d="recycle"===(null===(a=null==n?void 0:n.folder)||void 0===a?void 0:a.folder)||"recycle"===(null===(u=null==n?void 0:n.contentType)||void 0===u?void 0:u.contentType);if((0,y.u)(r,t,d)||delete c.deleteProtection,i){const n=["group","living atlas","living atlas analysis","subscription content"];(n.includes(t)||n.includes(e))&&delete c.categories,"living atlas"===t?(delete c.modified,delete c.created,delete c.sharing,delete c.collaborations):delete c.region}return c}},44388:(t,e,n)=>{n.d(e,{c:()=>i,r:()=>o});var r=n(15332);function i(t=""){return(0,r.s)(t).replace(/[<>\/\\?]/g,"\\$&").trim()}function o(t,{start:e,end:n,total:r}){const i="rtl"===document.documentElement.dir;return t.replace("${start}",i?n:e).replace("${end}",i?e:n).replace("${total}",r)}},58857:(t,e,n)=>{n.d(e,{u:()=>i});var r=n(66111);function i(t,e,n){return!!t&&(!e||["my","org"].includes(e))&&!n&&("org"!==e||(0,r.q)(t))}},66337:(t,e,n)=>{n.d(e,{f:()=>i});var r=n(50637);async function i(t,e,n="results",i=!1){let o,s,l,a,u=1,c=[];e.start=u,e.num||(e.num=100);try{const d=await(0,r.r)(t,e);if(!(null==d?void 0:d[n]))return c;for(c=[...c,...d[n]],u=d.nextStart,o=d.total-c.length,s=Math.ceil(o/e.num),l=[],a=0;a<s;a++)if(e.start=u+a*e.num,i){const i=await(0,r.r)(t,e);(null==i?void 0:i[n])&&(c=[...c,...i[n]])}else l.push((0,r.r)(t,e));if(!i){(await Promise.all(l)).forEach((t=>{c=[...c,...t[n]]}))}return c}catch(t){return c}}},96295:(t,e,n)=>{n.d(e,{H:()=>r,R:()=>i});const r='-typekeywords:("MapAreaPackage") -type:("Map Area" OR "Indoors Map Configuration" OR "Code Attachment")',i="Indoors Map Configuration,Code Attachment"}}]);