/*! For license information please see arcgis_analysis_node_modules_arcgis_common-components_dist_compone-b2541a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_common-components_dist_compone-b2541a"],{10674:(e,t,i)=>{i.r(t),i.d(t,{ArcgisCommonSqlExpressionConfigCondition:()=>G});var s=i(6364),a=i(85282),n=i(59836),l=i(61833),r=i(70757),o=i(75430),u=i(24457),d=i(72349),c=i(74968),p=i(52797),h=i(5294),m=i(54312),g=i(91021),v=i(51546),f=i(12762),y=i(80666),$=i(53550),b=i(24186),I=(i(34031),i(43284),i(55088));const S="field-selection",C="delete-action",N="filter-condition",q="operator-dropdown",T="input-plus-unique",E="input-plus-unique-date",O="input",V="label",F="blank-button",D="select-unique-button",P="between-values-input",x="select-values",U="list",M="unique-values-content-list-msg",w="in-the-last",A="in-the-last-count",k="in-the-last-unit",L="date-picker",R="histogram-content",_="small-loader",B="time-zone",H="time-zone-icon",Z=I.AH`.field-selection{display:flex;align-items:normal}.delete-action{padding:0 0 0 4px}:dir(rtl){.delete-action{padding:0 4px 0 0}}.operator-dropdown{width:100%;margin:5px 0}.input-plus-unique{display:flex;flex-direction:row;width:100%}.input-plus-unique-date,.input{width:100%}.blank-button{height:22px;border:var(--calcite-color-border-input) 1px solid}.blank-button.active{cursor:pointer}.blank-button.inactive:focus{outline:none}.select-unique-button{height:32px;border-top:var(--calcite-color-border-input) 1px solid;border-bottom:var(--calcite-color-border-input) 1px solid;border-right:var(--calcite-color-border-input) 1px solid}:dir(rtl){.select-unique-button{border-right:none;border-left:var(--calcite-color-border-input) 1px solid}}.between-values-input.first{margin-bottom:5px}.select-values{margin-bottom:4px}.field-button-trash{inline-size:calc(100% - 36px)}.list{max-height:200px;overflow-y:auto}.unique-values-content-list-msg{font-size:90%;margin-top:5px;margin-bottom:5px}.in-the-last{display:flex}.in-the-last-count,.in-the-last-unit{width:50%}.date-picker{width:100%}.date-picker.first{margin-bottom:5px}.label{margin-top:10px}.time-zone{margin-top:5px}.time-zone-icon{opacity:60%}.histogram-content{height:120px;overflow:hidden;margin:var(--calcite-spacing-xs) calc(-1 * var(--calcite-spacing-xl)) calc(-1 * var(--calcite-spacing-md-plus)) calc(-1 * var(--calcite-spacing-xl));padding:0 var(--calcite-spacing-xl) var(--calcite-spacing-md-plus) var(--calcite-spacing-xl)}.histogram-content.slim{height:40px}.small-loader{margin-left:calc((100% - 16px)/2);margin-top:10px}calcite-input-time-zone[read-only]{--calcite-color-border-input: transparent;--calcite-color-background: transparent;--calcite-font-weight-medium: normal;pointer-events:none;margin-left:-10px}:dir(rtl){.small-loader{margin-left:auto;margin-right:8px}calcite-input-time-zone[read-only]{margin-left:auto;margin-right:-10px}}`;class G extends l.WF{constructor(){super(),this.fieldNode=(0,r._)(),this.uniqueSelectNode=(0,r._)(),this.uniqueListNode=(0,r._)(),this.histogramSlider=void 0,this.isEditorField=!1,this.timeNode=(0,r._)(),this.timeNode2=(0,r._)(),this.debouncedOnValueChange=(0,g.sg)((e=>this.onValueChange(e)),500),this.debouncedOnValueChangeMaybe=(0,g.sg)((e=>this.onValueChangeMaybe(e)),500),this.debouncedOnValue2ChangeMaybe=(0,g.sg)((e=>this.onValue2ChangeMaybe(e)),500),this.hasFocus=!1,this.showDelete=!1,this.arcgisChanged=(0,l.lh)(),this.arcgisDeleted=(0,l.lh)(),this.arcgisDisablePanel=(0,l.lh)(),this.arcgisValuesReturned=(0,l.lh)(),this.constructor.K.c=void 0,this.listenOn(window,"arcgisValuesReturned",this.arcgisValuesReturnedHandler)}static{this.properties={props:0,uid:1,fieldName:[0,{attribute:"field"}],operator:1,uniqueValuesSortBy:[0,{attribute:"sort-by"}],value:1,value2:1,values:0,unit:0,histogramClosed:5,hasFocus:[4,{attribute:"focus"}],invalidValue:1,showDelete:5}}static{this.styles=Z}async onEdits(){this.onDisplayUniqueValues(this.fieldName)}async load(){const e=(0,b.p)({fields:this.props.fields});this.fieldName=this.fieldName||e.layerField.name,this.operator=this.operator||(0,b.q)(this.props,e),this.hasFocus=!!this.hasFocus}loaded(){(function(e){if(!e||!f.default)return;let t=f.default.assetsPath;t.endsWith("/")||(t+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${t}esri/themes/light/main.css" />`)})(this.el.shadowRoot),this.setFocus()}disconnectedCallback(){super.disconnectedCallback(),this.removeFieldPickList(),this.removeUniquePopover()}_setUniqueActionNode(e){e&&(this.uniqueActionNode=e)}_setDateNode(e){e&&(this.dateNode=e)}_setDateNode2(e){e&&(this.dateNode2=e)}setFocus(){setTimeout((()=>{this.el.querySelector(".autofocus")?.setFocus()}),500)}onValueChange(e,t){t=t??this.getNewValue(e);const{props:i,fieldName:s,operator:a,value:n,value2:l}=this,{layer:r,view:o}=i,u=(0,b.g)(s,i),d=e;if(t=e?this.getNewValue(e):t,!(0,y.i)(t)&&(t=(0,b.r)(i,u,a).value,d))if(u.simpleFieldType===y.s.DATE){const e=(0,$.f)(t,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0);if("CALCITE-INPUT-DATE-PICKER"===d.tagName)d.value=e;else{const t=(0,$.e)(e);t&&(d.value=t)}}else u.simpleFieldType===y.s.DATE_ONLY?d.value=new Date(t).toISOString():u.simpleFieldType===y.s.TIME_ONLY?d.value=(0,$.a)(t):d.value=(0,y.i)(t)?`${t}`:"";if(n!==t){if((0,y.i)(t)&&(0,b.i)(i,a)&&t>=l&&d)if(u.simpleFieldType===y.s.DATE)if(t=l-1e3,"CALCITE-INPUT-TIME-PICKER"===d.tagName){const e=(0,$.f)(t,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0),i=(0,$.e)(e);i&&requestAnimationFrame((()=>d.value=i))}else d.value=(0,$.f)(t,o?.timeZone,"preferredTimeZone"in r?r.preferredTimeZone??void 0:void 0);else if(u.simpleFieldType===y.s.DATE_ONLY){const e=new Date(l-864e5);d.value=new Date(e).toISOString(),t=new Date(e).getTime()}else u.simpleFieldType===y.s.TIME_ONLY?(t=l-1e3,requestAnimationFrame((()=>d.value=(0,$.a)(t)))):(t=l-1,d.value=`${t}`);("CALCITE-INPUT-DATE-PICKER"===d?.tagName||"CALCITE-INPUT-TIME-PICKER"===d?.tagName||"CALCITE-INPUT"===d?.tagName&&"number"===d?.type||"CALCITE-INPUT-NUMBER"===d?.tagName)&&this.adjustHistogramMinMax(t),this.changeValues(t,l)}}onValueChangeMaybe(e){const{props:t,operator:i,value2:s}=this,a=this.getNewValue(e);(0,y.i)(a)&&(0,b.i)(t,i)&&a>=s||this.onValueChange(e,a)}onValue2ChangeMaybe(e){const{props:t,operator:i,value:s}=this,a=this.getNewValue(e);(0,y.i)(a)&&(0,b.i)(t,i)&&a<=s||this.onValue2Change(e,a)}handleRemoveSelectedValue(e){const{values:t}=this,i=t.indexOf(e);t.splice(i,1),this.emitChangeEvent({values:t.length?(0,h.clone)(t):null,histogramClosed:this.histogramClosed}),this.requestUpdate()}handleFieldPickListChange(e){this.removeFieldPickList(),e&&this.afterFieldSelect(e)}arcgisValuesReturnedHandler(e){const t=e.detail;this.fieldName===t&&(this.checkDefaultValues((0,b.g)(t,this.props)),this.requestUpdate())}afterCreateSliderDiv(e){const{fieldName:t,props:i,histogramSlider:s}=this;e&&setTimeout((()=>{if(!s)return;const a=document.createElement("div");if(e.appendChild(a),s.container){const e=(0,b.g)(t,i);if(!e)return;const{bins:n,average:l,min:r,max:o,values:u,precision:d,rangeType:p}=s,h={container:a,bins:n,average:l,min:r,max:o,values:u,precision:d,rangeType:p};[y.s.DATE,y.s.DATE_ONLY,y.s.TIME_ONLY].includes(e.simpleFieldType)&&(h.hasTimeData=!0,this.addDateFormatFunctions(h,e)),this.destroyHistogramSlider(),this.histogramSlider=new c.default(h),this.createSliderChangeEvents(e)}else s.container=a}),1)}onFieldSelect(){this.hasFocus=!0,this.openFieldPickList()}onOperatorSelect(e){const{props:t,fieldName:i,operator:s,value:a,value2:n}=this,l=e.target.selectedOption.value,r=(0,b.g)(i,t),o=(0,b.b)(t,s),u=(0,b.b)(t,l),d=o||u,c=o&&u,p=(0,b.i)(t,s),h=(0,b.i)(t,l),m=p&&h,g={value:a,value2:n,operator:s};this.value=(d&&!c?void 0:r.statistics&&!(0,y.i)(a)?r.statistics.avg:a)??void 0,this.value2=(h?n??((0,b.s)(r)&&r.statistics?.max?Math.round(r.statistics?.max):r.statistics?.max):d||!m?void 0:n)??void 0,this.operator=l;const v=this.checkDefaultValues(r),f={value:this.value??v.value,value2:this.value2??(h?v.value2:null),operator:this.operator,unit:this.unit||v.unit,histogramClosed:this.histogramClosed};this.value=g.value,this.value2=g.value2,this.operator=g.operator,this.emitChangeEvent(f)}onValue2Change(e,t){const{value:i,props:s,fieldName:a,operator:n}=this,{layer:l,view:r}=s,o=(0,b.g)(a,s),u=e;if(t=t??this.getNewValue(e)??void 0,!(0,y.i)(t))if(t=(0,b.r)(s,o,n).value2,o.simpleFieldType===y.s.DATE){const e=(0,$.f)(t,r?.timeZone,"preferredTimeZone"in l?l.preferredTimeZone??void 0:void 0);if("CALCITE-INPUT-DATE-PICKER"===u.tagName)u.value=e;else{const t=(0,$.e)(e);t&&(u.value=t)}}else o.simpleFieldType===y.s.DATE_ONLY?u.value=new Date(t).toISOString():o.simpleFieldType===y.s.TIME_ONLY?u.value=(0,$.a)(t):u.value=(0,y.i)(t)?`${t}`:"";if((0,y.i)(t)&&t<=i)if(o.simpleFieldType===y.s.DATE)if(t=i+1e3,"CALCITE-INPUT-TIME-PICKER"===u.tagName){const e=(0,$.f)(t,r?.timeZone,"preferredTimeZone"in l?l.preferredTimeZone??void 0:void 0),i=(0,$.e)(e);i&&requestAnimationFrame((()=>u.value=i))}else u.value=(0,$.f)(t,r?.timeZone,"preferredTimeZone"in l?l.preferredTimeZone??void 0:void 0);else if(o.simpleFieldType===y.s.DATE_ONLY){const e=new Date(i+864e5);u.value=new Date(e).toISOString(),t=new Date(e).getTime()}else o.simpleFieldType===y.s.TIME_ONLY?(t=i+1e3,requestAnimationFrame((()=>u.value=(0,$.a)(t)))):(t=i+1,u.value=`${t}`);("CALCITE-INPUT-DATE-PICKER"===u.tagName||"CALCITE-INPUT-TIME-PICKER"===u?.tagName||"CALCITE-INPUT"===u.tagName&&"number"===u.type||"CALCITE-INPUT-NUMBER"===u?.tagName)&&this.adjustHistogramMinMax(t),this.changeValues(i,t)}onUnitSelect(e){const t=e.target;this.emitChangeEvent({unit:t.selectedOption.value,histogramClosed:this.histogramClosed})}onSelectUniqueValue(e){e.stopPropagation(),this.onSelectUnique(!1)}onSelectUniqueValues(){const{props:e,fieldName:t,operator:i}=this,s=(0,b.g)(t,e),a=(0,b.t)(s),n=(0,b.a)(e,i),l=a&&!n;this.onSelectUnique(!l)}onSelectUnique(e){const{props:t,value:i,values:s,fieldName:n,uid:o,uniqueValuesSortBy:u}=this,{_messages:d}=t;if(this.uniquePopoverNode)return void this.closeFilterPopovers();this.closeFilterPopovers();const c=(0,b.g)(n,t);if(!c)return;const p=this.fieldNode.value?.getBoundingClientRect().width,m=p?p+2:204,g=((0,v.q)(this.el,"calcite-panel")||(0,v.q)(this.el,"calcite-flow-item"))?.clientHeight,f=g?Math.max(Math.min(g/3,400),200):400,I=(0,l.dN)(a.qy`<calcite-popover .label=${d.chooseFromUnique} .id=${`arcgis-common-sql-expression-config-unique-popover_${o}`} placement=bottom-end auto-close offset-distance=0 offset-skidding=0 pointer-disabled overlay-positioning=fixed trigger-disabled .referenceElement=${e?this.uniqueSelectNode.value:this.uniqueActionNode} @calcitePopoverClose=${()=>{this.uniquePopoverNode&&(this.removeUniquePopover(),this.uniqueActionNode?.setFocus())}}><arcgis-common-sql-expression-config-unique-list .uid=${o} .props=${t} .uniqueValues=${(0,h.clone)(c.uniqueValueInfos)} .selectedValues=${e?s:i?[i]:[]} .fieldDomains=${c.fieldDomains} .layerFieldType=${c.layerField.type} .multiple=${e} .sortBy=${u} .partialUniqueValues=${c.partialUniqueValues} .maxHeight=${f} style=${(0,l.zl)({width:`${m}px`})} @arcgisChanged=${e=>{const{detail:t}=e;if(t.uid===this.uid){const e=t.selectedValues;if(t.multiple)this.emitChangeEvent({values:e,uniqueValuesSortBy:t.sortBy,histogramClosed:this.histogramClosed});else{this.uniqueValuesSortBy=t.sortBy;let i=e?.length?e[0]:void 0;const{fieldName:s,props:a}=this,n=(0,b.g)(s,a);(0,y.i)(i)&&"string"==typeof i&&n.simpleFieldType===y.s.TIME_ONLY&&(i=(0,$.t)(i)),this.onValueChange(null,i),this.removeUniquePopover(),this.uniqueActionNode?.setFocus()}}}} @arcgisSortByChanged=${e=>{const{detail:t}=e;t.uid===this.uid&&(this.uniqueValuesSortBy=t.sortBy)}} @arcgisDone=${e=>{const{detail:t}=e;t===this.uid&&(this.removeUniquePopover(),this.uniqueActionNode?.setFocus())}} ${(0,r.K)(this.uniqueListNode)}></arcgis-common-sql-expression-config-unique-list></calcite-popover>`);document.body.appendChild(I),this.uniqueListNode.value.requestUpdate(),this.uniqueListNode.value.setFocus(),I.reposition(),this.uniquePopoverNode=I,setTimeout((()=>{I.open=!0}),50)}afterCreateList(e){e&&this.scrollExprIntoView(e)}scrollExprIntoView(e){setTimeout((()=>{e&&(e=(0,v.q)(e,".filter-expression"),e?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}),100)}removeUniquePopover(){this.uniquePopoverNode&&(this.uniquePopoverNode.open=!1,this.uniquePopoverNode?.parentElement?.removeChild(this.uniquePopoverNode),this.uniquePopoverNode=void 0)}async onDisplayUniqueValues(e){const{props:t}=this,{layer:i,view:s,mode:a}=t,n=(0,b.g)(e,t);if(n&&"sublayer"!==i.type&&n.uniqueValuesStatus===y.b.MISSING&&i){n.uniqueValuesStatus=y.b.IN_PROGRESS;try{const l=await(0,d.default)({layer:i,view:s,field:e,sqlWhere:"basic"===a&&"definitionExpression"in i?i.definitionExpression??void 0:void 0,forBinning:"feature-reduction"===a&&["binning","cluster"].includes(i.featureReduction?.type)}),r=(0,b.h)(n),o=l.uniqueValueInfos.filter((e=>!!(0,y.i)(e.value)&&("string"===n.simpleFieldType&&!r||"guid"===n.simpleFieldType?"<Null>"!==e.value&&""!==`${e.value}`.trim():("number"===n.simpleFieldType||n.simpleFieldType,"<Null>"!==e.value&&""!==e.value))));o.sort(((e,t)=>e.count>t.count?-1:e.count<t.count?1:0)),(0,b.t)(n)&&n.fieldDomains.forEach((e=>{o.find((t=>t.value===e.code))||o.push({value:e.code,count:0})}));const u=2e3===l.uniqueValueInfos.length;t.fields=t.fields.map((t=>t.layerField.name===e?{...t,uniqueValueInfos:o,uniqueValuesStatus:y.b.SUCCESS,partialUniqueValues:u}:t)),this.arcgisValuesReturned.emit(n.layerField.name)}catch(i){if(console.error("error-uniqueValues",i),(0,b.t)(n)){const i=[];n.fieldDomains.forEach((e=>{i.find((t=>t.value===e.code))||i.push({value:e.code,count:void 0})})),t.fields=t.fields.map((t=>t.layerField.name===e?{...t,uniqueValueInfos:i,uniqueValuesStatus:y.b.SUCCESS,partialUniqueValues:!1}:t))}else t.fields=t.fields.map((t=>t.layerField.name===e?{...t,uniqueValuesStatus:y.b.FAILED}:t));this.requestUpdate()}}}onHistogramBlockToggle(e){e.currentTarget.open?this.onHistogramOpen():this.onHistogramClose()}async onHistogramCollapsed(){const{props:e,fieldName:t}=this;let i=(0,b.g)(t,e);i&&(await this.getSummaryStatistics(),i=(0,b.g)(t,e),this.checkDefaultValues(i))}async onHistogramOpen(){const{props:e,fieldName:t}=this,{layer:i,view:s,mode:a}=e;let n=(0,b.g)(t,e);if(i&&"sublayer"!==i.type&&n){if("subtype-group"===i.type)return e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:y.b.FAILED,histogramStatus:y.b.FAILED}:e)),this.histogramClosed=!0,void this.requestUpdate();if(n.statistics&&n.histogramStatus!==y.b.MISSING)this.checkDefaultValues(n),this.histogramClosed=!1;else{let l=n.statistics;if(l||(e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:y.b.IN_PROGRESS}:e)),l=await this.getSummaryStatistics(),this.checkDefaultValues(n)),n=(0,b.g)(t,e),n.histogramStatus!==y.b.MISSING)return;e.fields=e.fields.map((e=>e.layerField.name===t?{...e,histogramStatus:y.b.IN_PROGRESS}:e));try{const n=await(0,o.default)({layer:i,view:s,field:t,sqlWhere:"basic"===a&&"definitionExpression"in i?i.definitionExpression??void 0:void 0,numBins:30,minValue:l?.min||void 0,maxValue:l?.max||void 0,forBinning:"feature-reduction"===a&&["binning","cluster"].includes(i.featureReduction?.type)});e.fields=e.fields.map((e=>e.layerField.name===t?{...e,histogram:n,histogramStatus:y.b.SUCCESS}:e)),this.histogramClosed=!1,this.requestUpdate()}catch(i){console.error("error-histogram",i),e.fields=e.fields.map((e=>e.layerField.name===t?{...e,histogramStatus:y.b.FAILED}:e)),this.requestUpdate()}}}}onHistogramClose(){this.histogramClosed=!0}async onMinMaxChange(e,t,i){const{props:s,value:a,value2:n}=this,{layer:l,view:r,mode:u}=s,d=(0,b.g)(i,s);if(d&&"sublayer"!==l.type){this.value=Math.min(Math.max(a,e),t),(0,y.i)(n)&&(this.value2=Math.min(Math.max(n,e),t)),this.histogramClosed=!1,s.fields=s.fields.map((e=>e.layerField.name===i?{...e,histogramStatus:y.b.IN_PROGRESS}:e));try{const a=await(0,o.default)({layer:l,view:r,field:d.layerField.name,sqlWhere:"basic"===u&&"definitionExpression"in l?l.definitionExpression??void 0:void 0,numBins:30,minValue:e,maxValue:t,forBinning:"feature-reduction"===u&&["binning","cluster"].includes(l.featureReduction?.type)});s.fields=s.fields.map((e=>e.layerField.name===i?{...e,histogram:a,histogramStatus:y.b.SUCCESS}:e)),this.requestUpdate()}catch(e){console.error("error-histogram",e),s.fields=s.fields.map((e=>e.layerField.name===i?{...e,histogramStatus:y.b.FAILED}:e))}}}async getSummaryStatistics(){const{props:e,fieldName:t}=this,{layer:i,view:s,mode:a}=e;if("sublayer"!==i.type)try{const n=await(0,u.default)({layer:i,view:s,field:t,sqlWhere:"basic"===a&&"definitionExpression"in i?i.definitionExpression??void 0:void 0,forBinning:"feature-reduction"===a&&["binning","cluster"].includes(i.featureReduction?.type),outStatisticTypes:{exclude:["median"]}});return(0,y.i)(n.avg)&&(0,y.i)(n.min)&&(0,y.i)(n.max)?(n.min===n.max&&((0,y.i)(n.min)&&(0,y.i)(n.max)&&n.min>0?(n.min=n.min-.1*n.min,n.max=n.max+.1*n.max):(0,y.i)(n.min)&&(0,y.i)(n.max)&&n.min<0?(n.min=n.min+.1*n.min,n.max=n.max-.1*n.max):(n.min=-1,n.max=1)),e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statistics:n,statisticsStatus:y.b.SUCCESS}:e)),n):(e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:y.b.FAILED}:e)),void(this.histogramClosed=!0))}catch(i){return console.error("error-summaryStatistics",i),e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:y.b.FAILED,histogramStatus:y.b.FAILED}:e)),this.histogramClosed=!0,void this.requestUpdate()}}adjustHistogramMinMax(e){const{histogramSlider:t}=this;t&&(t.min>e&&t.set({min:e}),t.max<e&&t.set({max:e}))}prepareSlider(e){const{histogramSliderFieldName:t}=this;let{value:i,value2:s,histogramSlider:a}=this;const n=e.statistics;if(e.histogramStatus===y.b.IN_PROGRESS)return!1;(0,y.i)(i)&&"number"!=typeof i&&(i=void 0),(0,y.i)(s)&&"number"!=typeof s&&(s=void 0),this.checkDefaultValues(e);const l=[];if(l.push(i),(0,y.i)(s)&&l.push(s),(0,b.s)(e)){if((0,y.i)(l[0])){const e=Math.round(l[0]);e!==l[0]&&this.changeValues(e,s),l[0]=e}if((0,y.i)(l[1])){const e=Math.round(l[1]);e!==l[1]&&this.changeValues(i,e),l[1]=e}}let r=e.histogram?e.histogram.minValue:n.min,o=e.histogram?e.histogram.maxValue:n.max;if((0,y.i)(l[0])&&(0,y.i)(l[1])?(r=Math.min(r,l[0]),o=Math.max(o,l[1])):(0,y.i)(l[0])&&(r=Math.min(r,l[0]),o=Math.max(o,l[0])),a&&t!==e.layerField.name&&(this.destroyHistogramSlider(),a=this.histogramSlider),a){const t={bins:e.histogram?.bins,average:Math.round(10*n.avg)/10,min:r,max:o,values:void 0===l?.[0]?void 0:l,rangeType:this.getSliderRangeType()};a.set(t)}else{const t={bins:e.histogram?.bins,average:Math.round(10*n.avg)/10,min:r,max:o,values:void 0===l?.[0]?void 0:l,rangeType:this.getSliderRangeType(),precision:(0,b.s)(e)?0:4};[y.s.DATE,y.s.DATE_ONLY,y.s.TIME_ONLY].includes(e.simpleFieldType)&&(t.hasTimeData=!0,this.addDateFormatFunctions(t,e)),this.histogramSliderFieldName=e.layerField.name,this.histogramSlider=new c.default(t),this.createSliderChangeEvents(e)}return!0}createSliderChangeEvents(e){const{histogramSlider:t}=this;t&&(t.on("min-change",(i=>{const s=t;this.onMinMaxChange(i.value,s.max,e.layerField.name)})),t.on("max-change",(i=>{const s=t;this.onMinMaxChange(s.min,i.value,e.layerField.name)})),(0,m.watch)((()=>t.values),(0,g.sg)((()=>{const i=t;let s=i.values?.[0],a=i.values?.[1];[y.s.DATE,y.s.DATE_ONLY,y.s.TIME_ONLY].includes(e.simpleFieldType)&&(s=Math.round(s)),(0,b.s)(e)&&(a||0===s?(s=Math.floor(s),a=Math.ceil(a)):s=Math.round(s)),this.changeValues(s,a)}),150)),t.on("segment-drag",(()=>{const i=t;let s=i.values[0],a=i.values[1];(0,b.s)(e)&&(a||0===s?(s=Math.floor(s),a=Math.ceil(a)):s=Math.round(s)),this.changeValues(s,a)})))}getSliderRangeType(){const{props:e,operator:t}=this,{_messages:i}=e;switch(t){case i.operators.numberOperatorIs:case i.operators.dateOperatorIsOn:return"equal";case i.operators.numberOperatorIsNot:case i.operators.dateOperatorIsNotOn:return"not-equal";case i.operators.numberOperatorIsLessThan:case i.operators.dateOperatorIsBefore:return"less-than";case i.operators.numberOperatorIsGreaterThan:case i.operators.dateOperatorIsAfter:return"greater-than";case i.operators.numberOperatorIsAtMost:case i.operators.dateOperatorIsBeforeOrEqual:return"at-most";case i.operators.numberOperatorIsAtLeast:case i.operators.dateOperatorIsAfterOrEqual:return"at-least";case i.operators.numberOperatorIsBetween:case i.operators.dateOperatorIsBetween:return"between";case i.operators.numberOperatorIsNotBetween:case i.operators.dateOperatorIsNotBetween:return"not-between";default:return""}}destroyHistogramSlider(){this.histogramSlider?.destroy(),this.histogramSlider=void 0}getNewValue(e){const{fieldName:t,props:i}=this,{layer:s,view:a}=i,n=e;let l;if("CALCITE-INPUT-DATE-PICKER"===n?.tagName||"CALCITE-INPUT-TIME-PICKER"===n?.tagName){const e=(0,b.g)(t,i),r=n.getAttribute("data-value");if("CALCITE-INPUT-DATE-PICKER"===n?.tagName){if(l=n.value,!l)return;l=e.simpleFieldType===y.s.DATE?(0,$.h)(`${l} ${"second"===r?this.timeNode2.value?.value:this.timeNode.value?.value}`,s.fieldsIndex.getTimeZone(t),a?.timeZone,"preferredTimeZone"in s?s.preferredTimeZone??void 0:void 0):(0,$.d)(l)}else{if(l=n.value,!l)return;l=e.simpleFieldType===y.s.DATE?(0,$.h)(`${"second"===r?this.dateNode2?.value:this.dateNode?.value} ${l}`,s.fieldsIndex.getTimeZone(t),a?.timeZone,"preferredTimeZone"in s?s.preferredTimeZone??void 0:void 0):(0,$.t)(l)}}else if("CALCITE-INPUT"===n?.tagName&&"number"===n.type||"CALCITE-INPUT-NUMBER"===n?.tagName){if(l=n.value,!l)return;l=Number.parseFloat(l)}else"CALCITE-INPUT"===n?.tagName&&(l=n.value,l?.length||(l=void 0));return l}addDateFormatFunctions(e,t){const{props:i}=this,{view:s}=i,a=s?.timeZone||"system";e.labelFormatFunction=e=>t.simpleFieldType===y.s.DATE?(0,$.g)(e,a,"short-date"):t.simpleFieldType===y.s.DATE_ONLY?(0,$.b)(e):(0,$.c)(e)}changeValues(e,t){const{props:i,fieldName:s}=this,a=(0,b.g)(s,i),n=a.simpleFieldType&&[y.s.NUMBER,y.s.DATE,y.s.OID].includes(a.simpleFieldType)&&Number.isNaN(e)?void 0:e,l=a.simpleFieldType&&[y.s.NUMBER,y.s.DATE,y.s.OID].includes(a.simpleFieldType)&&Number.isNaN(t)?void 0:t;(this.value!==n||this.value2!==l)&&this.emitChangeEvent({value:n??void 0,value2:l??void 0,histogramClosed:this.histogramClosed})}checkDefaultValues(e){const{props:t,operator:i,value:s,value2:a,histogramSlider:n}=this,l=e.statistics,r=(0,b.r)(t,e,i);if((0,b.b)(t,i)){if(!(0,y.i)(s)){let e,t;if(l){const i=(new Date).getTime(),s=Math.abs(i-l.avg);s>2*y.t.YEAR?(e=Math.round(s/y.t.YEAR),t=y.d.YEAR):s>2*y.t.MONTH?(e=Math.round(s/y.t.MONTH),t=y.d.MONTH):s>2*y.t.WEEK?(e=Math.round(s/y.t.WEEK),t=y.d.WEEK):s>2*y.t.DAY?(e=Math.round(s/y.t.DAY),t=y.d.DAY):s>2*y.t.HOUR?(e=Math.round(s/y.t.HOUR),t=y.d.HOUR):(e=Math.round(s/y.t.MINUTE),t=y.d.MINUTE)}else e=1,t=y.d.YEAR;this.emitChangeEvent({value:e,unit:t,histogramClosed:this.histogramClosed})}}else if((0,b.i)(t,i))if((0,y.i)(s))if((0,y.i)(a))a<s&&(n&&n.values[0]===s?this.changeValues(s,s):this.changeValues(a,a));else{const t=l?.max??s+1,i=(0,b.s)(e)?Math.round(t):t;this.changeValues(s,i)}else if((0,y.i)(a)){const i=l?(0,b.u)(l.avg,t,e):a-1;this.changeValues(i,a)}else this.changeValues(r.value,r.value2);else(0,y.i)(s)||this.changeValues(r.value,r.value2);return r}openFieldPickList(){const{props:e,fieldName:t,fieldPickListSortBy:i}=this,{layer:s,fieldPickListLayer:n,view:r,mode:o,panelNode:u,insideDialog:d}=e;this.closeFilterPopovers();const c=u?.getBoundingClientRect().width||240,p=Math.min(Math.round(c),500),h=-1*Math.round(p+(c-p)/2);let m;u instanceof HTMLDivElement&&(m=(0,v.q)(this.el,"calcite-panel")??(0,v.q)(this.el,"calcite-flow-item")),this.arcgisFieldPickList=(0,l.dN)(a.qy`<arcgis-field-pick-list .fields=${this.createPickerFields()} .layer=${n??s} .mapView=${r} .showFieldInfo=${"feature-reduction"!==o} .selectedFields=${[t]} .sortBy=${i??"default"} .popoverProps=${{placement:"leading",offsetDistance:h,offsetSkidding:0,popoverWidth:p,overlayPositioning:"fixed",triggerDisabled:!0,refElement:m??u,zIndex:d?900:"effects"===o?101:void 0}} @arcgisClose=${e=>{e.stopPropagation();const t=e.detail?.selectedFields?.[0];this.handleFieldPickListChange(t)}} @arcgisSortByChange=${e=>this.fieldPickListSortBy=e.detail}></arcgis-field-pick-list>`),document.body.appendChild(this.arcgisFieldPickList),this.arcgisFieldPickList.setFocus(),this.arcgisDisablePanel.emit(!0)}createPickerFields(){const{props:e}=this,{fields:t}=e;return t.map((e=>({name:e.layerField.name,alias:e.label,type:e.simpleFieldType})))}removeFieldPickList(){this.arcgisDisablePanel.emit(!1),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=void 0,setTimeout((()=>this.fieldNode.value?.setFocus()),1))}afterFieldSelect(e){const{props:t,fieldName:i,operator:s,histogramClosed:a}=this,{_messages:n}=t,l=(0,b.g)(i,t),r=(0,b.g)(e,t);let o;const u=(0,b.v)(t,l,r,s),d=(0,b.g)(e,t);d.simpleFieldType===y.s.STRING&&d.uniqueValuesStatus===y.b.SUCCESS&&d.uniqueValueInfos?.length&&[n.operators.stringOperatorIs,n.operators.stringOperatorIsNot].includes(u)&&(o=d.uniqueValueInfos[0].value??void 0),this.emitChangeEvent({hasFocus:!0,fieldName:e,operator:u,value:o,value2:void 0,values:void 0,uniqueValuesSortBy:void 0,histogramClosed:r.simpleFieldType&&![y.s.NUMBER,y.s.DATE,y.s.DATE_ONLY,y.s.TIME_ONLY].includes(r.simpleFieldType)||r.statisticsStatus===y.b.FAILED?void 0:!0===a&&l.statisticsStatus!==y.b.FAILED||void 0})}emitChangeEvent(e){const{uid:t,fieldName:i,operator:s,uniqueValuesSortBy:a,value:n,values:l,unit:r,histogramClosed:o,hasFocus:u,props:d}=this,c=(0,b.b)(d,s)&&e.unit&&r&&e.unit!==r,p={uid:t,fieldName:e.fieldName||i,operator:e.operator||s,uniqueValuesSortBy:void 0===e.uniqueValuesSortBy?void 0:e.uniqueValuesSortBy||a,value:c?e.value??n:void 0===e.value?void 0:e.value??n,value2:void 0===e.value2?void 0:e.value2,values:void 0===e.values?void 0:e.values||l,unit:e.unit||r,histogramClosed:void 0===e.histogramClosed?void 0:e.histogramClosed||o,hasFocus:e.hasFocus||u};this.arcgisChanged.emit(p)}waitOnUser(e,t){this.typingHndl&&(clearTimeout(this.typingHndl),this.typingHndl=void 0);const i=e.value,s=Number.parseFloat(i);i?(!i.startsWith("-")||0!==s&&!Number.isNaN(s))&&t(e):this.typingHndl=setTimeout((()=>{this.typingHndl=void 0,t(e)}),2e3)}closeFilterPopovers(){this.removeFieldPickList(),this.removeUniquePopover()}render(){const{fieldName:e,props:t}=this,{layer:i}=t,s=(0,b.g)(e,t);if(!s?.simpleFieldType)return a.qy`<div></div>`;const n="sourceJSON"in i?i.sourceJSON?.editFieldsInfo:void 0;this.isEditorField=e===n?.creatorField||e===n?.editorField;const r=(0,g.O)(this.el);return(0,l.Bq)(this.el,"dir",r),a.qy`<div class=${(0,l.CP)(N)}>${this.renderFieldSelection()}${this.renderOperatorSelection(s)}${this.renderValueInput(s)}${this.renderTimeZone(s)}${this.renderHistogram(s)}</div>`}renderFieldSelection(){const{hasFocus:e,fieldName:t,showDelete:i,props:s}=this,{fields:n,_messages:o}=s,u=(0,b.g)(t,s);return a.qy`<div class=${(0,l.CP)(S)}><calcite-button appearance=outline-fill kind=neutral width=full alignment=icon-end-space-between .disabled=${n.length<=1} icon-end=chevron-down class=${`${i?"field-button-trash":""} ${e?"autofocus":""}`} @click=${n.length>1?this.onFieldSelect:void 0} ${(0,r.K)(this.fieldNode)}>${u?.label||""}</calcite-button>${i?a.qy`<calcite-action class=${(0,l.CP)(C)} .label=${o.remove} text scale=s icon=trash @click=${()=>this.arcgisDeleted.emit()}></calcite-action>`:null}</div>`}renderOperatorSelection(e){const{props:t}=this,{operators:i,_messages:s}=t;let n=e.simpleFieldType;if(!n)return;n===y.s.GUID&&(n=y.s.STRING),n===y.s.OID&&(n=y.s.NUMBER),(0,b.t)(e)&&(n=y.s.DOMAIN);let r=i?.get(n);this.isEditorField&&(r=r.filter((e=>!(0,b.c)(t,e.name)&&!(0,b.d)(t,e.name))));const o=r.map((e=>this.renderOperatorOption(e.name)));return a.qy`<calcite-select width=full .label=${s.accessibility.operator} class=${(0,l.CP)(q)} @calciteSelectChange=${this.onOperatorSelect}>${o}</calcite-select>`}renderOperatorOption(e){const{operator:t}=this;return a.qy`<calcite-option .value=${e} .label=${e} .selected=${e===t}></calcite-option>`}renderValueInput(e){const{props:t,operator:i,invalidValue:s}=this,n=s?"invalid":void 0;let l;return(0,b.c)(t,i)||(0,b.d)(t,i)||(0,b.e)(t,i)?l="":(0,b.a)(t,i)?l=this.renderUniqueValues(e):(0,b.b)(t,i)?l=this.renderInTheLast(e):e.simpleFieldType===y.s.STRING||e.simpleFieldType===y.s.GUID||(0,b.t)(e)?l=this.renderValueInputString(e,{status:n}):e.simpleFieldType===y.s.NUMBER?l=this.renderValueInputNumber(e,{status:n}):e.simpleFieldType===y.s.DATE?l=this.renderValueInputDate(e):e.simpleFieldType===y.s.DATE_ONLY?l=this.renderValueInputDateOnly(e):e.simpleFieldType===y.s.TIME_ONLY?l=this.renderValueInputTimeOnly(e):e.simpleFieldType===y.s.OID&&(l=this.renderValueInputOid(e,{status:n})),s?a.qy`<calcite-label>${l}<calcite-input-message icon .status=${n}>${s}</calcite-input-message></calcite-label>`:l}renderUniqueButton(e,t,i){const{props:s}=this,{_messages:n}=s;if(e)return a.qy`<calcite-action class=${(0,l.CP)(D)} .disabled=${t} .loading=${!!i} .text=${n.chooseFromUnique} scale=s icon=chevron-down @click=${t?void 0:this.onSelectUniqueValue} ${(0,r.K)(this._setUniqueActionNode)}></calcite-action>`}renderValueInputString(e,t){const{props:i,value:s,operator:o}=this,{_messages:u}=i,d=e.uniqueValuesStatus,c=e.uniqueValueInfos,p=[u.operators.stringOperatorIs,u.operators.stringOperatorIsNot].includes(o),h=p&&(d===y.b.FAILED||d===y.b.SUCCESS&&!c?.length),m=(0,b.t)(e),g=m?(0,b.w)(s,e):s,v=d===y.b.MISSING||d===y.b.IN_PROGRESS;return d===y.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),m?(0,y.i)(g)?(0,n.D)("value-input-string",a.qy`<div>${(0,n.D)(g,a.qy`<calcite-button appearance=outline-fill kind=neutral width=full alignment=icon-end-space-between .iconEnd=${v?"spinner":h?void 0:"chevron-down"} .disabled=${h} @click=${h?void 0:this.onSelectUniqueValue} ${(0,r.K)(this._setUniqueActionNode)}>${g?`${g}`:""}</calcite-button>`)}</div>`):(0,n.D)("value-input-string",a.qy`<div class=${(0,l.CP)(T)}>${(0,n.D)("value-input-string-button",a.qy`<div class=${`${O} ${F} ${d===y.b.SUCCESS?"active":"inactive"}`} tabindex=-1 @click=${d===y.b.SUCCESS?this.onSelectUniqueValue:void 0}></div>`)}${this.renderUniqueButton(p,h,v)}</div>`):(0,n.D)("value-input-string",a.qy`<div class=${(0,l.CP)(T)}><calcite-input type=text .value=${g?`${g}`:""} class=${(0,l.CP)(O)} .label=${u.accessibility.value} @calciteInputInput=${e=>this.debouncedOnValueChange(e.target)} .status=${t.status}></calcite-input>${this.renderUniqueButton(p,h,v)}</div>`)}renderValueInputNumber(e,t){const{props:i,value:s,value2:r,operator:o}=this,{_messages:u}=i,d=(0,b.x)(e);if([u.operators.numberOperatorIsBetween,u.operators.numberOperatorIsNotBetween].includes(o))return a.qy`<div><calcite-input type=number .value=${(0,y.i)(s)?`${s}`:""} .step=${d?"any":1} .label=${u.accessibility.fromValue} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValueChangeMaybe)} .status=${t.status}></calcite-input><div class=${`${P} first`}></div><calcite-input type=number .value=${(0,y.i)(r)?`${r}`:""} .step=${d?"any":1} class=${(0,l.CP)(P)} .label=${u.accessibility.toValue} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValue2ChangeMaybe)} .status=${t.status}></calcite-input></div>`;{const i=e.uniqueValuesStatus,r=e.uniqueValueInfos,c=[u.operators.numberOperatorIs,u.operators.numberOperatorIsNot,u.operators.numberOperatorIsAtLeast,u.operators.numberOperatorIsAtMost,u.operators.numberOperatorIsGreaterThan,u.operators.numberOperatorIsLessThan].includes(o),p=a.qy`<calcite-input class=${(0,l.CP)(O)} type=number .value=${(0,y.i)(s)?`${s}`:""} .step=${d?"any":1} .label=${u.accessibility.value} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValueChange)} .status=${t.status}></calcite-input>`;return i===y.b.FAILED||i===y.b.SUCCESS&&!r?.length||!c?(0,n.D)("value-input-number",a.qy`<div>${p}</div>`):i===y.b.MISSING||i===y.b.IN_PROGRESS?(i===y.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-number",a.qy`<div class=${(0,l.CP)(T)}>${p}${this.renderUniqueButton(c,!0,!0)}</div>`)):(0,n.D)("value-input-number",a.qy`<div class=${(0,l.CP)(T)}>${p}${this.renderUniqueButton(c,!e.uniqueValueInfos?.length)}</div>`)}}renderValueInputDate(e){const{props:t,value:i,value2:s,operator:o}=this,{layer:u,view:d,_messages:c}=t,p="number"==typeof i?(0,$.f)(i,d?.timeZone,"preferredTimeZone"in u?u.preferredTimeZone??void 0:void 0):i,h=(0,$.e)(p);if([c.operators.dateOperatorIsBetween,c.operators.dateOperatorIsNotBetween].includes(o)){const e="number"==typeof s?(0,$.f)(s,d?.timeZone,"preferredTimeZone"in u?u.preferredTimeZone??void 0:void 0):s,t=(0,$.e)(e);return a.qy`<div><calcite-label class=${(0,l.CP)(V)}>${c.startDate}</calcite-label><calcite-input-date-picker class=${`${L} first`} .value=${p} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValueChange(e.target)} ${(0,r.K)(this._setDateNode)}></calcite-input-date-picker><calcite-input-time-picker class=${`${L} ${O}}`} .value=${h} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValueChange(e.target)} ${(0,r.K)(this.timeNode)}></calcite-input-time-picker><calcite-label class=${(0,l.CP)(V)}>${c.endDate}</calcite-label><calcite-input-date-picker class=${`${L} first`} .value=${e} data-value=second overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValue2Change(e.target)} ${(0,r.K)(this._setDateNode2)}></calcite-input-date-picker><calcite-input-time-picker class=${`${L} ${O}`} .value=${t} data-value=second step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValue2Change(e.target)} ${(0,r.K)(this.timeNode2)}></calcite-input-time-picker></div>`}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,s=[c.operators.dateOperatorIsOn,c.operators.dateOperatorIsNotOn,c.operators.dateOperatorIsAfter,c.operators.dateOperatorIsBefore,c.operators.dateOperatorIsAfterOrEqual,c.operators.dateOperatorIsBeforeOrEqual].includes(o),u=a.qy`<div class=${(0,l.CP)(E)}><calcite-input-date-picker class=${`${L} ${O} first`} .value=${p} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValueChange(e.target)} ${(0,r.K)(this._setDateNode)}></calcite-input-date-picker><calcite-input-time-picker class=${`${L} ${O}`} .value=${h} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValueChange(e.target)} ${(0,r.K)(this.timeNode)}></calcite-input-time-picker></div>`;return t===y.b.FAILED||t===y.b.SUCCESS&&!i?.length||!s?(0,n.D)("value-input-date",a.qy`<div>${u}</div>`):t===y.b.MISSING||t===y.b.IN_PROGRESS?(t===y.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-date",a.qy`<div class=${(0,l.CP)(T)}>${u}${this.renderUniqueButton(s,!0,!0)}</div>`)):(0,n.D)("value-input-date",a.qy`<div class=${(0,l.CP)(T)}>${u}${this.renderUniqueButton(s,!e.uniqueValueInfos?.length)}</div>`)}}renderValueInputDateOnly(e){const{props:t,value:i,value2:s,operator:r}=this,{_messages:o}=t,u="number"==typeof i?new Date(i).toISOString():i;if([o.operators.dateOperatorIsBetween,o.operators.dateOperatorIsNotBetween].includes(r)){const e="number"==typeof s?new Date(s).toISOString():s;return a.qy`<div><calcite-input-date-picker class=${`${L} first`} .value=${u} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValueChange(e.target)}></calcite-input-date-picker><calcite-input-date-picker class=${(0,l.CP)(L)} .value=${e} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValue2Change(e.target)}></calcite-input-date-picker></div>`}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,s=[o.operators.dateOperatorIsOn,o.operators.dateOperatorIsNotOn,o.operators.dateOperatorIsAfter,o.operators.dateOperatorIsBefore,o.operators.dateOperatorIsAfterOrEqual,o.operators.dateOperatorIsBeforeOrEqual].includes(r),d=a.qy`<calcite-input-date-picker class=${`${L} ${O}`} .value=${u} overlay-positioning=fixed @calciteInputDatePickerChange=${e=>this.onValueChange(e.target)}></calcite-input-date-picker>`;return t===y.b.FAILED||t===y.b.SUCCESS&&!i?.length||!s?(0,n.D)("value-input-date",a.qy`<div>${d}</div>`):t===y.b.MISSING||t===y.b.IN_PROGRESS?(t===y.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-date",a.qy`<div class=${(0,l.CP)(T)}>${d}${this.renderUniqueButton(s,!0,!0)}</div>`)):(0,n.D)("value-input-date",a.qy`<div class=${(0,l.CP)(T)}>${d}${this.renderUniqueButton(s,!e.uniqueValueInfos?.length)}</div>`)}}renderValueInputTimeOnly(e){const{props:t,value:i,value2:s,operator:r}=this,{_messages:o}=t,u="number"==typeof i?(0,$.a)(i):i;if([o.operators.dateOperatorIsBetween,o.operators.dateOperatorIsNotBetween].includes(r)){const e="number"==typeof s?(0,$.a)(s):s;return a.qy`<div><calcite-input-time-picker class=${`${L} first`} .value=${u} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValueChange(e.target)}></calcite-input-time-picker><calcite-input-time-picker class=${(0,l.CP)(L)} .value=${e} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValue2Change(e.target)}></calcite-input-time-picker></div>`}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,s=[o.operators.dateOperatorIsOn,o.operators.dateOperatorIsNotOn,o.operators.dateOperatorIsAfter,o.operators.dateOperatorIsBefore,o.operators.dateOperatorIsAfterOrEqual,o.operators.dateOperatorIsBeforeOrEqual].includes(r),d=a.qy`<calcite-input-time-picker class=${`${L} ${O}`} .value=${u} step=1 overlay-positioning=fixed @calciteInputTimePickerChange=${e=>this.onValueChange(e.target)}></calcite-input-time-picker>`;return t===y.b.FAILED||t===y.b.SUCCESS&&!i?.length||!s?(0,n.D)("value-input-time",a.qy`<div>${d}</div>`):t===y.b.MISSING||t===y.b.IN_PROGRESS?(t===y.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-time",a.qy`<div class=${(0,l.CP)(T)}>${d}${this.renderUniqueButton(s,!0,!0)}</div>`)):(0,n.D)("value-input-time",a.qy`<div class=${(0,l.CP)(T)}>${d}${this.renderUniqueButton(s,!e.uniqueValueInfos?.length)}</div>`)}}renderValueInputOid(e,t){const{props:i,value:s,value2:r,operator:o}=this,{_messages:u}=i;if(e.simpleFieldType===y.s.OID)if((0,y.i)(s)&&(0,y.i)(r)){const e=Math.round(s),t=Math.round(r);(e!==s||t!==r)&&this.changeValues(e,t)}else if((0,y.i)(s)){const e=Math.round(s);e!==s&&this.changeValues(e,r)}else if((0,y.i)(r)){const e=Math.round(r);e!==r&&this.changeValues(s,e)}if([u.operators.numberOperatorIsBetween,u.operators.numberOperatorIsNotBetween].includes(o))return a.qy`<div><calcite-input type=number .value=${(0,y.i)(s)?`${s}`:""} min=0 step=1 .label=${u.accessibility.fromValue} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValueChangeMaybe)} .status=${t.status}></calcite-input><div class=${`${P} first`}></div><calcite-input type=number .value=${(0,y.i)(r)?`${r}`:""} min=0 step=1 class=${(0,l.CP)(P)} .label=${u.accessibility.toValue} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValue2ChangeMaybe)} .status=${t.status}></calcite-input></div>`;{const i=e.uniqueValuesStatus,r=e.uniqueValueInfos,d=[u.operators.numberOperatorIs,u.operators.numberOperatorIsNot,u.operators.numberOperatorIsAtLeast,u.operators.numberOperatorIsAtMost,u.operators.numberOperatorIsGreaterThan,u.operators.numberOperatorIsLessThan].includes(o),c=a.qy`<calcite-input class=${(0,l.CP)(O)} type=number .value=${(0,y.i)(s)?`${s}`:""} min=0 step=1 .label=${u.accessibility.value} @calciteInputInput=${e=>this.waitOnUser(e.target,this.debouncedOnValueChange)} .status=${t.status}></calcite-input>`;return i===y.b.FAILED||i===y.b.SUCCESS&&!r?.length||!d?(0,n.D)("value-input-oid",a.qy`<div>${c}</div>`):i===y.b.MISSING||i===y.b.IN_PROGRESS?(i===y.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,n.D)("value-input-oid",a.qy`<div class=${(0,l.CP)(T)}>${c}${this.renderUniqueButton(d,!0,!0)}</div>`)):(0,n.D)("value-input-oid",a.qy`<div class=${(0,l.CP)(T)}>${c}${this.renderUniqueButton(d,!e.uniqueValueInfos?.length)}</div>`)}}renderUniqueValues(e){const{props:t,values:i,fieldName:s}=this,{_messages:o}=t,u=e.uniqueValuesStatus,d=e.uniqueValueInfos;if(u===y.b.MISSING||u===y.b.IN_PROGRESS)return u===y.b.MISSING&&this.onDisplayUniqueValues(e.layerField.name),a.qy`<div><calcite-loader class=${(0,l.CP)(_)} inline label></calcite-loader></div>`;if(u===y.b.FAILED)return a.qy`<div class=${(0,l.CP)(M)}><calcite-button appearance=transparent width=full alignment=center class=${(0,l.CP)(x)} disabled .label=${o.selectValues}>${o.selectValues}</calcite-button>${o.errors.errorUniqueValues}</div>`;{const t=a.qy`<div class=${(0,l.CP)(M)}>${!i?.length&&d?.length?o.selectOneValue:""}</div>`;let u;d?.length||(u=a.qy`<div class=${(0,l.CP)(M)}>${o.errors.noUniqueValues}</div>`);const c=i?.map((t=>this.renderSelectedUniqueValue(t,e)));return a.qy`<div>${t}<calcite-button appearance=transparent width=full alignment=center class=${(0,l.CP)(x)} .disabled=${!d?.length} @click=${d?.length?this.onSelectUniqueValues:void 0} .label=${o.selectValues} ${(0,r.K)(this.uniqueSelectNode)}>${o.selectValues}</calcite-button>${u}${i?.length?(0,n.D)(`unique-values-list-${s}`,a.qy`<calcite-list class=${(0,l.CP)(U)} .label=${o.values} ${(0,r.K)(this.afterCreateList)}>${c}</calcite-list>`):null}</div>`}}renderSelectedUniqueValue(e,t){const{props:i}=this,{view:s,_messages:n}=i,l=s?.timeZone||"system",r=(0,b.t)(t)?(0,b.w)(e,t):(0,b.j)(t)?(0,$.g)(e,l):(0,b.k)(t)?(0,$.b)(e):(0,b.l)(t)?(0,$.c)(e):(0,b.h)(t)?(0,p.formatNumber)(e):e;return a.qy`<calcite-list-item .label=${`${r}`} .value=${`${e}`}><calcite-action slot=actions-end .text=${n.remove} icon=x @click=${()=>this.handleRemoveSelectedValue(e)}></calcite-action></calcite-list-item>`}renderInTheLast(e){const{props:t,value:i,unit:s}=this,{_messages:n}=t,r=(0,b.k)(e);return a.qy`<div class=${(0,l.CP)(w)}><calcite-input-number inputmode=decimal min=1 integer .value=${(0,y.i)(i)?`${i}`:""} class=${(0,l.CP)(A)} .label=${n.accessibility.value} @calciteInputNumberInput=${e=>this.onValueChange(e.target)}></calcite-input-number><calcite-select width=full .label=${n.accessibility.units} class=${(0,l.CP)(k)} @calciteSelectChange=${this.onUnitSelect}>${!r&&this.renderInTheLastOption(y.d.MINUTE,s===y.d.MINUTE)||""}${!r&&this.renderInTheLastOption(y.d.HOUR,s===y.d.HOUR)||""}${this.renderInTheLastOption(y.d.DAY,s===y.d.DAY)}${this.renderInTheLastOption(y.d.WEEK,s===y.d.WEEK)}${this.renderInTheLastOption(y.d.MONTH,s===y.d.MONTH)}${this.renderInTheLastOption(y.d.YEAR,s===y.d.YEAR)}</calcite-select></div>`}renderInTheLastOption(e,t){const{props:i}=this,{_messages:s}=i;return a.qy`<calcite-option .value=${e} .label=${s.units[e]} .selected=${t}></calcite-option>`}renderTimeZone(e){const{props:t}=this,{view:i,_messages:s}=t;if(e.simpleFieldType!==y.s.DATE)return;const n=i&&"system"!==i.timeZone?"unknown"===i.timeZone?s.timeZoneUnknown:void 0:s.timeZoneSystem;return a.qy`<calcite-label class=${(0,l.CP)(B)} scale=s layout=inline alignment=start><calcite-icon icon=time-zone scale=s class=${(0,l.CP)(H)}></calcite-icon>${n||a.qy`<calcite-input-time-zone mode=region read-only .value=${i?.timeZone} tabindex=-1></calcite-input-time-zone>`}</calcite-label>`}renderHistogram(e){const{props:t,histogramClosed:i,operator:s,fieldName:n}=this,{_messages:l}=t;if(e?.simpleFieldType)if(e.statisticsStatus!==y.b.FAILED)if((0,b.y)(n,s,t)){if(!0!==i||e.statisticsStatus!==y.b.MISSING)return(void 0===i||!i&&e.histogramStatus===y.b.MISSING)&&this.onHistogramOpen(),a.qy`<calcite-block-section .open=${!0!==i} .text=${e.histogramStatus===y.b.FAILED?l.valueRange:l.histogram} @calciteBlockSectionToggle=${this.onHistogramBlockToggle}>${this.renderHistogramContent(e)}</calcite-block-section>`;this.onHistogramCollapsed()}else this.destroyHistogramSlider();else this.destroyHistogramSlider();else this.destroyHistogramSlider()}renderHistogramContent(e){const{histogramClosed:t}=this,i=e.layerField.name;if(!0!==t)return e.statistics&&e.histogramStatus!==y.b.IN_PROGRESS?this.prepareSlider(e)?(0,n.D)(`histogram-content-${i}-${e.statistics}`,a.qy`<div class=${`${R} ${e.histogram?"":"slim"}`} dir=${(0,g.O)(this.el)??l.s6} ${(0,r.K)(this.afterCreateSliderDiv)}></div>`):void 0:(0,n.D)(`histogram-content-${i}-${e.statistics}`,a.qy`<div class=${`${R} ${e.histogram?"":"slim"}`}><calcite-loader class=${(0,l.CP)(_)} inline label></calcite-loader></div>`)}}(0,s.c)("arcgis-common-sql-expression-config-condition",G)},59836:(e,t,i)=>{i.d(t,{D:()=>l});var s=i(85282),a=i(34670),n=i(42466);const l=(0,a.u$)(class extends a.WL{constructor(){super(...arguments),this.key=s.s6}render(e,t){return this.key=e,t}update(e,[t,i]){return t!==this.key&&((0,n.mY)(e),this.key=t),i}})}}]);