/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-b97288.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-b97288"],{10465:(e,t,i)=>{i.d(t,{D:()=>s,a:()=>p,b:()=>n,c:()=>c,g:()=>m,s:()=>b});class s{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}const o=(e,t,i)=>(0,h(t).subscribe)((t=>{const s=t.some((t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target)));s&&i()})),r={},h=e=>{const t=e.join(","),i=r[t];if(void 0!==i)return i;const s=new Set,o=new MutationObserver((e=>s.forEach((t=>t(e)))));globalThis.document&&o.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const h={subscribe:e=>(s.add(e),()=>{s.delete(e),0===s.size&&(o.disconnect(),r[t]=void 0)})};return r[t]=h,h},c=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const s=i.getRootNode?.();if(s===globalThis.document)return null;i=s.host}return null},n=e=>a(e,"dir","ltr"),a=(e,t,i)=>{const s=c(e,`[${t}]`);return s?.getAttribute(t)??i},l=e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},p=()=>[l(2),l(1),l(1),l(1),l(3)].join("-"),d="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),u=new Set(d),g="en",k={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},S={},y=async(e,t)=>{const i=`${t}${e}.json`;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===g?{}:await y(g,t)},m=e=>{const t=a(e,"lang",globalThis.navigator?.language||g);return{lang:t,t9nLocale:f(t)}},f=e=>{const[t,i]=e.split("-"),s=t.toLowerCase();let o=s;return i&&(o=`${s}-${i.toUpperCase()}`),o=k[o]??o,u.has(o)?o:i?f(s):g},b=(e,t,i,s)=>{let r;const h=()=>w(e,t(),s).then((e=>{r?.lang===e.lang&&r.t9nLocale===e.t9nLocale&&r.t9nStrings===e.t9nStrings||i(e),r=e})).catch(console.error);return queueMicrotask(h),o(e,["lang"],h)},w=async(e,t,i=e.localName.split("-").slice(1).join("-"))=>{const{lang:s,t9nLocale:o}=m(e),r=`${t}/${i}/t9n`,h=null===i?{}:await(async(e,t,i="")=>{const s=`${t}/${i}`,o=`${s}${e}.json`;return S[o]??(S[o]=y(e,s)),await S[o]})(o,r,"messages.");return{lang:s,t9nLocale:o,t9nStrings:h}}},20819:(e,t,i)=>{i.r(t),i.d(t,{arcgis_sketch_layer_editor:()=>u});var s=i(11254),o=i(58262),r=i(17840),h=i(10588),c=i(14528),n=i(84260),a=i(69811),l=i(93345);i(10465),i(56612);class p{constructor(e,t,i,s,o,r,h){this.mapNotesLayer=e,this.mapView=t,this.sketchViewModelPoint=new i({layer:this.mapNotesLayer.pointLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelPoint.on("create",(e=>r(e,this.sketchViewModelPoint))),this.sketchViewModelPoint.on("update",(e=>h(e))),this.sketchViewModelLine=new i({layer:this.mapNotesLayer.polylineLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelLine.on("create",(e=>r(e,this.sketchViewModelLine))),this.sketchViewModelLine.on("update",(e=>h(e))),this.sketchViewModelPolygon=new i({layer:this.mapNotesLayer.polygonLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelPolygon.on("create",(e=>r(e,this.sketchViewModelPolygon))),this.sketchViewModelPolygon.on("update",(e=>h(e))),this.sketchViewModelText=new i({layer:this.mapNotesLayer.textLayer??void 0,view:this.mapView,defaultCreateOptions:{hasZ:!1,mode:"hybrid"},updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},snappingOptions:s,tooltipOptions:o}),this.sketchViewModelText.on("create",(e=>r(e,this.sketchViewModelText))),this.sketchViewModelText.on("update",(e=>h(e)))}updateOnGraphicClick(e,t){this.hitTestHandle?.remove(),e&&(this.hitTestHandle=this.mapView.on("click",(async e=>{const i=(await this.mapView.hitTest(e,{include:this.mapNotesLayer})).results;if(i.length){const e=["point","polyline","polygon"];i.sort(((t,i)=>e.indexOf(t.graphic.geometry.type)-e.indexOf(i.graphic.geometry.type)));const t=i[0].graphic;switch(t.layer){case this.mapNotesLayer.pointLayer:await this.updatePoint([t]);break;case this.mapNotesLayer.textLayer:await this.updateText([t]);break;case this.mapNotesLayer.polylineLayer:await this.updateLine([t]);break;case this.mapNotesLayer.polygonLayer:await this.updatePolygon([t]);break;default:return}}else t&&t({state:"complete"})})))}duplicate(){this._duplicatePoint(),this._duplicateLine(),this._duplicatePolygon(),this._duplicateText()}delete(){this._deletePoint(),this._deleteLine(),this._deletePolygon(),this._deleteText()}cancel(){this._cancelPoint(),this._cancelLine(),this._cancelPolygon(),this._cancelText()}destroy(){this._destroyPoint(),this._destroyLine(),this._destroyPolygon(),this._destroyText()}getPointSVM(){return this.sketchViewModelPoint}getPoint(){return this.sketchViewModelPoint.pointSymbol}setPoint(e){this.sketchViewModelPoint.pointSymbol=e}createPoint(){this.sketchViewModelPoint.create("point")}async updatePoint(e){await this.sketchViewModelPoint.update(e)}_duplicatePoint(){this.sketchViewModelPoint.duplicate()}_deletePoint(){this.sketchViewModelPoint.delete()}_cancelPoint(){this.sketchViewModelPoint.cancel()}_destroyPoint(){this.sketchViewModelPoint.destroy()}getLineSVM(){return this.sketchViewModelLine}getLine(){return this.sketchViewModelLine.polylineSymbol}setLine(e){this.sketchViewModelLine.polylineSymbol=e}createLine(e){this.sketchViewModelLine.create("polyline",{mode:e?"click":"hybrid"})}async updateLine(e){const t=1===e.length&&!!e[0].geometry?.curvePaths?.length;await this.sketchViewModelLine.update(e,{reshapeOptions:{edgeOperation:t?"none":"split"}})}_duplicateLine(){this.sketchViewModelLine.duplicate()}_deleteLine(){this.sketchViewModelLine.delete()}_cancelLine(){this.sketchViewModelLine.cancel()}_destroyLine(){this.sketchViewModelLine.destroy()}getPolygonSVM(){return this.sketchViewModelPolygon}getPolygon(){return this.sketchViewModelPolygon.polygonSymbol}setPolygon(e){this.sketchViewModelPolygon.polygonSymbol=e}createPolygon(e){this.sketchViewModelPolygon.create(e)}async updatePolygon(e){await this.sketchViewModelPolygon.update(e)}_duplicatePolygon(){this.sketchViewModelPolygon.duplicate()}_deletePolygon(){this.sketchViewModelPolygon.delete()}_cancelPolygon(){this.sketchViewModelPolygon.cancel()}_destroyPolygon(){this.sketchViewModelPolygon.destroy()}getTextSVM(){return this.sketchViewModelText}getText(){return this.sketchViewModelText.pointSymbol}setText(e){this.sketchViewModelText.pointSymbol=e}createText(){this.sketchViewModelText.create("point")}async updateText(e){await this.sketchViewModelText.update(e)}_duplicateText(){this.sketchViewModelText.duplicate()}_deleteText(){this.sketchViewModelText.delete()}_cancelText(){this.sketchViewModelText.cancel()}_destroyText(){this.sketchViewModelText.destroy()}}const d="isTemporaryBezierRepresentation",u=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.sketchUpdated=(0,s.c)(this,"sketchUpdated",7),this.arcgisContentReRender=(0,s.c)(this,"arcgisContentReRender",7),this.sketchContentReRender=(0,s.c)(this,"sketchContentReRender",7),this.arcgisCopyToNewSketchLayer=(0,s.c)(this,"arcgisCopyToNewSketchLayer",7),this.arcgisSketchCopyToNewSketchLayer=(0,s.c)(this,"arcgisSketchCopyToNewSketchLayer",7),this.arcgisRecentColorsUpdate=(0,s.c)(this,"arcgisRecentColorsUpdate",7),this.arcgisClose=(0,s.c)(this,"arcgisClose",7),this.arcgisSketchDismissedChange=(0,s.c)(this,"arcgisSketchDismissedChange",7),this.manager=(0,c.u)(this),this.strings=(0,n.u)({blocking:!0}),this.sketchLayerEditorState=(0,o.u)(),this.sketchMode="update",this.escKey=!1,this.deleteInProgress=!1,this.duplicateInProgress=!1,this.selectedBezierGraphics=new Map,this.graphicsToConvertToBezierGraphics=[],this.hasUnderlyingBezierGraphics=!1,this.keepSelectionMessage="",this.keepSelectionTool=void 0,this.needsMapViewHandles=!1,this.onGraphicUpdate=async e=>{if("start"===e.state)if(this.mapView.closePopup(),this.multipleSelectedGraphics.length<=1&&1===e.graphics.length){this.currentSketchInfo.graphics=[e.graphics[0]],this.currentSketchInfo.symbol=this.currentSketchInfo.graphics[0].symbol,this.currentSketchInfo.tool=this.currentSketchInfo.graphics[0].geometry.curvePaths?.length?"bezier-curve":(0,o.g)(this.currentSketchInfo.graphics[0]),this.currentSketchInfo.title=this.currentSketchInfo.graphics[0].attributes?.title||this.getDefaultGraphicTitle(),this.currentSketchInfo.popup=this.currentSketchInfo.graphics[0].popupTemplate??void 0,this.multipleSelectedGraphics.length||this.multipleSelectedGraphics.push(this.currentSketchInfo.graphics[0]),await(this.sketchContentEl?.rerender()),this.showSketchContent=!0,this.sketchContentReRender.emit(),this.arcgisContentReRender.emit();const t=e.graphics[0].geometry.curvePaths?.length?e.graphics[0]:void 0;t&&!this.hasUnderlyingBezierGraphics&&(this.createShadowBezierGraphicfromCurrentGraphic(t,0),this.graphicsToConvertToBezierGraphics.push(t),this.hasUnderlyingBezierGraphics=!0)}else if(this.multipleSelectedGraphics.length){this.currentSketchInfo.graphics=this.multipleSelectedGraphics,this.currentSketchInfo.symbol=this.currentSketchInfo.graphics[0].symbol,this.currentSketchInfo.tool=(0,o.g)(this.currentSketchInfo.graphics[0]);const t=this.currentSketchInfo.graphics[0].attributes?.title||this.getDefaultGraphicTitle(),i=this.currentSketchInfo.graphics.every((e=>e.attributes?.title===t)),s=this.currentSketchInfo.graphics[0].popupTemplate,r=this.currentSketchInfo.graphics.every((e=>JSON.stringify(e.popupTemplate)===JSON.stringify(s)));this.currentSketchInfo.title=i?t:void 0,this.currentSketchInfo.popup=r?s??void 0:void 0,await(this.sketchContentEl?.rerender()),this.showSketchContent=!0,this.sketchContentReRender.emit(),this.arcgisContentReRender.emit();const h=e.graphics.some((e=>!!e.geometry.curvePaths?.length));e.graphics.forEach(((e,t)=>{e.geometry.curvePaths?.length&&(this.hasUnderlyingBezierGraphics||(this.createShadowBezierGraphicfromCurrentGraphic(e,t),this.graphicsToConvertToBezierGraphics.push(e)))})),h&&(this.hasUnderlyingBezierGraphics=!0)}else this.updateSketchMessage(void 0);if("active"===e.state){const t=this.sketchLayerEditorSVModel?.getLineSVM();if(!t?.updateGraphics.length)return;1===this.selectedBezierGraphics.size&&1===this.multipleSelectedGraphics.length&&"reshape"===t.activeTool&&["move-start","reshape-start"].includes(e.toolEventInfo?.type)&&(this.currentSketchInfo.graphics[0].visible=!1),"transform"===t.activeTool&&e.graphics.forEach((e=>{const{modules:t}=this;e.attributes[d]&&(e.geometry=(0,o.a)(t.Polyline,e.geometry))}))}if("complete"===e.state){this.removeHighlight(),this.hasUnderlyingBezierGraphics&&(this.selectedBezierGraphics.forEach((e=>e.removeHandles())),this.duplicateInProgress||this.selectedBezierGraphics?.forEach((e=>e.layer?.remove(e))),this.convertNonBezierGraphicsToBezierGraphics(),this.deleteInProgress&&this.selectedBezierGraphics.forEach((e=>e.layer?.remove(e))),this.selectedBezierGraphics.clear(),this.hasUnderlyingBezierGraphics=!1);const{keepSelectionTool:e}=this,t=e!==this.sketchToolsEl.activeSelectTool;!e||t?(this.currentSketchInfo.graphics=void 0,this.multipleSelectedGraphics=[],this.closeSketchPopovers(),this.handleInternalSketchUpdate(),await(this.sketchContentEl?.rerender()),this.sketchContentReRender.emit(),this.arcgisContentReRender.emit()):this.deleteInProgress||(this.currentSketchInfo.graphics=void 0,this.multipleSelectedGraphics=[],this.keepSelectToolSelection())}},this.mapView=void 0,this.layer=void 0,this.portal=void 0,this.dismissible=!1,this.showSketchToolsOnly=!1,this.activeSketchTool=void 0,this.sketchToolsToHide=[],this.hideSelectionTools=!1,this.sketchToolsReferenceElement=void 0,this.selectedSketchFeaturesFeatures=void 0,this.snappingSessionStorageIds={current:"current",webmap:"webmap"},this.sketchTooltipSessionStorageIds={current:"currenttooltip",webmap:"webmaptooltip"},this.symbolStylerConfig={},this.store=(0,l.c)({mapView:void 0,portal:void 0,layer:void 0,strings:void 0,sketchMessage:"",sketchLayerEditorSVModel:void 0,snappingOptions:void 0,sketchTooltipOptions:void 0,snappingSessionStorageIds:void 0,sketchTooltipSessionStorageIds:void 0}),this.currentSketchInfo={tool:void 0,symbol:void 0,graphics:void 0,popup:void 0,title:void 0,sourceIds:{}},this.multipleSelectedGraphics=[],this.showSketchContent=!0}async setFocus(e){"dismiss-button"!==e||this.dismissButtonEl?.setFocus()}async deactivate(){const e=[this.sketchLayerEditorSVModel.getPointSVM(),this.sketchLayerEditorSVModel.getLineSVM(),this.sketchLayerEditorSVModel.getPolygonSVM(),this.sketchLayerEditorSVModel.getTextSVM()],t=this.sketchToolsEl?.activeSelectTool;this.tempCreatedGraphic=void 0,this.removeHighlight(),e.forEach((e=>e.cancel())),t||await(this.sketchToolsEl?.activateSingleSelection())}async done(){this.removeHighlight(),this.snappingSessionStorageIds?.current&&(0,o.s)(this.snappingOptions,this.snappingSessionStorageIds.current),this.sketchTooltipSessionStorageIds?.current&&(0,o.b)(this.sketchTooltipOptions,this.sketchTooltipSessionStorageIds.current),this.closeSketchPopovers(),this.sketchLayerEditorSVModel.destroy(),this.sketchToolsEl?.remove(),this.sketchToolsEl=void 0,this.removeSketchShortcuts(),this.mapView.popupEnabled=!0}async activateLayer(e,t){if(this.sketchLayerEditorSVModel?.destroy(),this.sketchLayerEditorSVModel?.updateOnGraphicClick(!1),this.layer=e,this.initializeSessionStorageOptions(),this.initializeSVModel(),t?.length){const e=t.map((e=>e.clone()));let i=[],s=[],r=[],h=[];e.forEach((e=>{switch((0,o.g)(e)){case"point":e.layer=this.layer.pointLayer,i=[...i,e];break;case"polyline":e.layer=this.layer.polylineLayer,s=[...s,e];break;case"polygon":e.layer=this.layer.polygonLayer,r=[...r,e];break;default:e.layer=this.layer.textLayer,h=[...h,e]}})),this.currentSketchInfo.graphics=e,this.updateCurrentSketchInfo(),setTimeout((()=>{this.multipleSelectedGraphics=[...i,...s,...r,...h],i.length&&this.sketchLayerEditorSVModel.updatePoint(i),s.length&&this.sketchLayerEditorSVModel.updateLine(s),r.length&&this.sketchLayerEditorSVModel.updatePolygon(r),h.length&&this.sketchLayerEditorSVModel.updateText(h),this.sketchMode="update"}),300)}}async updateSketchTools(){this.sketchToolsEl&&(this.sketchToolsEl.sketchToolsToHide=this.sketchToolsToHide,this.sketchToolsEl.hideSelectionTools=this.hideSelectionTools,this.sketchToolsEl.activeSketchTool=this.activeSketchTool)}async componentWillLoad(){const{sketchLayerEditorState:e}=this;await this.loadAllModules(),this.initializeSessionStorageOptions(),this.initializeSVModel(),e.sketchLayerEditorSVModel=this.sketchLayerEditorSVModel,e.mapView=this.mapView,e.layer=this.layer,e.portal=this.portal,e.strings=this.strings,e.snappingOptions=this.snappingOptions,e.sketchTooltipOptions=this.sketchTooltipOptions,e.snappingSessionStorageIds=this.snappingSessionStorageIds,e.sketchTooltipSessionStorageIds=this.sketchTooltipSessionStorageIds,this.selectedSketchFeaturesFeatures?.length&&(this.selectedSketchFeaturesFeatures.forEach((e=>{switch((0,o.g)(e)){case"point":e.layer=this.layer.pointLayer,e.sourceLayer=this.layer;break;case"polyline":e.layer=this.layer.polylineLayer,e.sourceLayer=this.layer;break;case"polygon":e.layer=this.layer.polygonLayer,e.sourceLayer=this.layer;break;default:e.layer=this.layer.textLayer,e.sourceLayer=this.layer}})),this.multipleSelectedGraphics=this.selectedSketchFeaturesFeatures.filter((e=>(0,r.i)(e))),this.currentSketchInfo.graphics=this.multipleSelectedGraphics,this.updateCurrentSketchInfo())}componentDidLoad(){this.needsMapViewHandles&&(this.mapView.focus(),this.watchDeleteOnMapView(!0),this.watchEscapeOnMapView(!0)),this.mapView.popupEnabled=!1,this.createSketchTools()}disconnectedCallback(){this.watchEscapeOnMapView(!1),this.watchDeleteOnMapView(!1),this.removeSketchShortcuts(),this.removeSketchShortcutsTooltip(),this.selectorOperation?.cancel(),this.sketchLayerEditorSVModel.updateOnGraphicClick(!1)}render(){const{showSketchToolsOnly:e}=this;return(0,s.h)(s.H,{key:"c7c5db01f90b8bf069a0b01be642f551542754ae",class:"calcite-match-height"},!e&&this.renderSketchFlowPanel())}renderSketchFlowPanel(){const{sketchLayerEditorState:e,currentSketchInfo:t,showSketchContent:i,dismissible:o}=this,{strings:r,layer:h}=e;return(0,s.h)("calcite-flow",{ref:e=>this.flowEl=e},(0,s.h)("calcite-flow-item",{ref:e=>this.sketchFlowItemEl=e,heading:r.sketch,disabled:!h.capabilities.operations.supportsMapNotesEditing},o&&this.renderDismissButton(),this.renderShortcutAndSnapping(),this.renderSketchMessage(),t.graphics?.length?(0,s.h)("div",{class:"multiple-selection"},this.renderSelectionMultipleLabel(),(0,s.h)("div",{id:"multiple-selection-buttons",class:"buttons"},this.renderDuplicateMultiple(),this.renderCopyToNewSketchLayer(),this.renderDeleteMultiple())):null,i&&(0,s.h)("arcgis-sketch-layer-editor-content",{currentSketchInfo:t,flowEl:this.flowEl,symbolStylerRefElement:this.dismissButtonEl,symbolStylerConfig:this.symbolStylerConfig,onArcgisSymbolChange:async()=>{await(this.sketchContentEl?.rerender()),this.sketchContentReRender.emit(),this.arcgisContentReRender.emit()},onArcgisGraphicUpdates:e=>{const t=e.detail;this.handleGraphicUpdates(t)},onArcgisLoadPanel:e=>{const t=e.detail;this.sketchFlowItemEl.loading=t},onArcgisDisablePanel:e=>{const t=e.detail;this.handleDisablePanel(t)},ref:e=>this.sketchContentEl=e})))}renderDismissButton(){return(0,s.h)("calcite-action",{text:"close",icon:"x",slot:"header-actions-end",ref:e=>this.dismissButtonEl=e,onClick:e=>{e.stopPropagation(),this.updateSketchMessage(void 0),this.sketchLayerEditorSVModel.cancel(),this.clearHighlightAndPopup(),this.arcgisSketchDismissedChange.emit(),this.arcgisClose.emit()}})}renderShortcutAndSnapping(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("div",{class:"snapping",ref:e=>this.shortcutSnappingEl=e},(0,s.h)("calcite-button",{class:"snapping-controls-button",alignment:"icon-end-space-between",appearance:"outline-fill",kind:"neutral",width:"full",iconStart:"gear",iconEnd:"chevron-down",label:t.sketchSettings,onClick:e=>{e.stopPropagation(),this.sketchSnappingEl||(this.sketchSnappingEl=document.createElement("arcgis-sketch-layer-editor-snapping"),this.sketchSnappingEl.sketchLayerEditorState=this.sketchLayerEditorState,this.sketchSnappingEl.refElement=this.shortcutSnappingEl,this.sketchSnappingEl.addEventListener("arcgisCloseSnappingPopovers",(()=>this.closeSnappingPopovers())),document.body.appendChild(this.sketchSnappingEl),this.handleDisablePanel(!0))}},t.sketchSettings),(0,s.h)("calcite-button",{appearance:"outline-fill",class:"sketch-keyboard-button",kind:"neutral",iconStart:"keyboard",label:t.sketchShortcuts,onClick:()=>{this.removeSketchShortcutsTooltip(),this.arcgisSketchLayerEditorShortcutsEl||(this.arcgisSketchLayerEditorShortcutsEl=document.createElement("arcgis-sketch-layer-editor-shortcuts"),this.arcgisSketchLayerEditorShortcutsEl.sketchLayerEditorState=this.sketchLayerEditorState,this.arcgisSketchLayerEditorShortcutsEl.refElement=this.shortcutSnappingEl,document.body.appendChild(this.arcgisSketchLayerEditorShortcutsEl),this.arcgisSketchLayerEditorShortcutsEl.addEventListener("arcgisClose",(()=>this.removeSketchShortcuts())))},onMouseOver:()=>this.addSketchShortcutsTooltip(),onMouseOut:()=>this.removeSketchShortcutsTooltip(),ref:e=>this.sketchShortcutsButtonEl=e}))}renderSketchMessage(){const{sketchLayerEditorState:e}=this,{sketchMessage:t}=e,{currentSketchInfo:i}=this;return!(!t||i.graphics&&i.graphics.length>1)?(0,s.h)("div",{class:"sketch-message"},(0,s.h)("calcite-notice",{width:"full",open:!0},(0,s.h)("div",{slot:"message"},t))):(0,s.h)(s.F,null)}renderSelectionMultipleLabel(){const{sketchLayerEditorState:e,currentSketchInfo:t}=this,{strings:i}=e;return(0,s.h)("calcite-label",{alignment:"center",for:"multiple-selection-buttons"},t.graphics&&t.graphics.length<=1?i.singleFeatureSelected:i.featuresSelected.replace("${number}",t.graphics.length.toString()))}renderDuplicateMultiple(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{appearance:"outline-fill",alignment:"center",iconStart:"duplicate",kind:"neutral",width:"full",onClick:async e=>{e.stopPropagation(),this.duplicateInProgress=!0,this.convertNonBezierGraphicsToBezierGraphics(),this.selectedBezierGraphics.size&&this.cleanUpBezierGraphics(),this.sketchLayerEditorSVModel.duplicate(),await this.offsetDuplicatedFeatures(),this.duplicateInProgress=!1}},t.duplicate)}renderCopyToNewSketchLayer(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{appearance:"outline-fill",alignment:"center",iconStart:"copy",kind:"neutral",width:"full",onClick:e=>{e.stopPropagation(),this.convertNonBezierGraphicsToBezierGraphics(),this.selectedBezierGraphics.forEach((e=>{e.removeHandles(),e.layer.remove(e)}));const t=this.currentSketchInfo.graphics.map((e=>e.clone()));this.arcgisSketchCopyToNewSketchLayer.emit({features:t}),this.arcgisCopyToNewSketchLayer.emit({features:t})}},t.copyToNewSketchLayer)}renderDeleteMultiple(){const{sketchLayerEditorState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{appearance:"outline-fill",alignment:"center",iconStart:"trash",kind:"danger",width:"full",onClick:e=>{e.stopPropagation();const{sketchLayerEditorSVModel:t}=this;this.deleteInProgress=!0,t.delete(),this.deleteInProgress=!1,this.multipleSelectedGraphics=[],this.keepSelectToolSelection()}},t.delete)}async loadAllModules(){await h.e.load();const[e,t,i,s,o,r,c,n,l,p]=await Promise.all([(0,a.a3)(),(0,a.a7)(),(0,a.y)(),(0,a.a8)(),(0,a.a6)(),(0,a.a9)(),(0,a.a5)(),(0,a.aa)(),(0,a.u)(),(0,a.l)()]);this.modules={SketchViewModel:e,TextSymbol:t,ColorUtils:i,CIMSymbol:s,SnappingOptions:o,SketchTooltipOptions:r,drawUtils:c,SelectionOperation:n,Polyline:l,reactiveUtils:p}}initializeSessionStorageOptions(){const{modules:e,layer:t,mapView:i,snappingSessionStorageIds:s,sketchTooltipSessionStorageIds:r}=this;this.snappingOptions=(0,o.c)(s,t,i,e.SnappingOptions),this.sketchTooltipOptions=(0,o.d)(r,e.SketchTooltipOptions)}initializeSVModel(){const{modules:e}=this;this.sketchLayerEditorSVModel=new p(this.layer,this.mapView,e.SketchViewModel,this.snappingOptions,this.sketchTooltipOptions,((e,t)=>this.onGraphicCreate(e,t)),this.onGraphicUpdate)}updateCurrentSketchInfo(){this.currentSketchInfo.symbol=this.currentSketchInfo.graphics[0].symbol,this.currentSketchInfo.tool=(0,o.g)(this.currentSketchInfo.graphics[0]);const e=this.currentSketchInfo.graphics[0].attributes?.title||this.getDefaultGraphicTitle(),t=this.currentSketchInfo.graphics.every((t=>t.attributes?.title===e)),i=this.currentSketchInfo.graphics[0].popupTemplate,s=this.currentSketchInfo.graphics.every((e=>JSON.stringify(e.popupTemplate)===JSON.stringify(i)));this.currentSketchInfo.title=t?e??void 0:void 0,this.currentSketchInfo.popup=s?i??void 0:void 0,this.showSketchContent=!0,this.sketchLayerEditorSVModel.updateOnGraphicClick(!0,this.onGraphicUpdate),this.needsMapViewHandles=!0}setCurrentSketchSymbol(){const{currentSketchInfo:e}=this;"point"===e.tool?this.sketchLayerEditorSVModel.setPoint(e.symbol):"polyline"===e.tool||"bezier-curve"===e.tool?this.sketchLayerEditorSVModel.setLine(e.symbol):["circle","polygon","rectangle"].includes(e.tool)?this.sketchLayerEditorSVModel.setPolygon(e.symbol):"text"===e.tool&&this.sketchLayerEditorSVModel.setText(e.symbol)}getDefaultGraphicTitle(){const{sketchLayerEditorState:e,currentSketchInfo:t}=this,{strings:i}=e;switch(t.tool){case"point":default:return i.point;case"polyline":return i.line;case"bezier-curve":return i.curve;case"polygon":return i.polygon;case"rectangle":return i.rectangle;case"circle":return i.circle;case"text":return i.text}}createSketchTools(){const{sketchLayerEditorState:e}=this;this.sketchToolsEl=document.createElement("arcgis-sketch-layer-editor-tools"),this.sketchToolsEl.sketchLayerEditorState=e,this.sketchToolsEl.sketchToolsToHide=this.sketchToolsToHide,this.sketchToolsEl.activeSketchTool=this.activeSketchTool,this.sketchToolsEl.hideSelectionTools=this.hideSelectionTools,this.sketchToolsEl.refElement=this.sketchToolsReferenceElement??this.el,this.selectedSketchFeaturesFeatures&&(this.sketchToolsEl.mapNotesFeatures=this.selectedSketchFeaturesFeatures,this.sketchToolsEl.activeSelectTool=1===this.multipleSelectedGraphics.length?"select":"rectangle"),this.sketchToolsEl.addEventListener("arcgisActionOnSelectFeatures",(async e=>{const t=e.detail.sketchMessage,i=e.detail.multipleSelectTool;await this.handleSelectFeatures(t,i)})),this.sketchToolsEl.addEventListener("arcgisActionOnDrawFeatures",(async e=>{const t=e.detail.sketchMessage,i=e.detail.tool;await this.handleDrawFeatures(t,i)})),document.body.appendChild(this.sketchToolsEl),this.sketchContentEl&&!this.sketchContentEl.symbolStylerRefElement&&(this.sketchContentEl.symbolStylerRefElement=this.dismissButtonEl)}clearHighlightAndPopup(){const{mapView:e}=this;this.removeHighlight(),e.closePopup()}highlightGraphic(e){const{mapView:t}=this;this.removeHighlight(),setTimeout((()=>{const i=t.allLayerViews?.items.find((({layer:e})=>e===this.layer));this.createdGraphicHighlightHandle=i?.highlight(e)}),1)}removeHighlight(){this.createdGraphicHighlightHandle?.remove(),this.createdGraphicHighlightHandle=void 0}watchEscapeOnMapView(e){e&&!this.watchEscapeHandle?this.watchEscapeHandle=this.mapView.on("key-down",(e=>{"Escape"!==e.key||"active"!==this.sketchLayerEditorSVModel.getPointSVM().state&&"active"!==this.sketchLayerEditorSVModel.getLineSVM().state&&"active"!==this.sketchLayerEditorSVModel.getPolygonSVM().state&&"active"!==this.sketchLayerEditorSVModel.getTextSVM().state||(e.stopPropagation(),this.escKey=!0,this.sketchLayerEditorSVModel.cancel())})):(this.watchEscapeHandle?.remove(),this.watchEscapeHandle=void 0)}watchDeleteOnMapView(e){e&&!this.watchDeleteHandle?this.watchDeleteHandle=this.mapView.on("key-down",(e=>{"Delete"!==e.key&&"Backspace"!==e.key||(this.deleteInProgress=!0,this.sketchLayerEditorSVModel.delete(),this.deleteInProgress=!1,this.keepSelectToolSelection())})):(this.watchDeleteHandle?.remove(),this.watchDeleteHandle=void 0)}async onGraphicCreate(e,t){"start"===e.state&&(this.tempCreatedGraphic=void 0,this.removeHighlight());const i=e.toolEventInfo;if("bezier-curve"===this.currentSketchInfo.tool&&"vertex-add"===i?.type){const t=e.graphic;if(2===t.geometry.paths[0].length){const e=this.sketchLayerEditorSVModel?.getLineSVM();e?.complete();const{modules:i}=this;t.geometry=(0,o.a)(i.Polyline,t.geometry)}}if("cancel"===e.state&&this.escKey){this.escKey=!1;const e="text"===this.currentSketchInfo.tool?"point":"bezier-curve"===this.currentSketchInfo.tool?"polyline":this.currentSketchInfo.tool;t.create(e)}if("complete"===e.state){e.graphic&&(this.handleInternalSketchUpdate(),e.graphic.popupTemplate=this.currentSketchInfo.popup,e.graphic.attributes={title:this.currentSketchInfo.title},this.currentSketchInfo.graphics=[e.graphic],this.tempCreatedGraphic=e.graphic,this.highlightGraphic(e.graphic));const i="text"===this.currentSketchInfo.tool?"point":"bezier-curve"===this.currentSketchInfo.tool?"polyline":this.currentSketchInfo.tool;if("bezier-curve"===this.currentSketchInfo.tool){this.sketchMode="update";const t=this.sketchLayerEditorSVModel?.getLineSVM();t?.update([e.graphic],{tool:"reshape",reshapeOptions:{edgeOperation:"none"}}),await(this.sketchToolsEl?.activateSingleSelection())}else t.create(i)}}async handleSelectFeatures(e,t){const{sketchLayerEditorSVModel:i,currentSketchInfo:s,selectedSketchFeaturesFeatures:o,selectorOperation:r}=this;this.keepSelectionMessage=e,this.keepSelectionTool=t,this.clearHighlightAndPopup(),this.watchEscapeOnMapView(!1),this.closeSketchPopovers(),this.updateSketchMessage(this.keepSelectionMessage),this.tempCreatedGraphic=void 0,s.graphics=void 0,s.symbol=void 0,s.tool=void 0,o&&!o.length&&(this.watchDeleteOnMapView(!1),this.multipleSelectedGraphics=[]),this.sketchMode="update",i.cancel(),this.keepSelectionTool?this.actionOnMultipleSelections(this.keepSelectionTool):(r?.cancel(),i.updateOnGraphicClick(!0),this.selectedSketchFeaturesFeatures=void 0),await(this.sketchContentEl?.rerender()),this.sketchContentReRender.emit(),this.arcgisContentReRender.emit()}async handleDrawFeatures(e,t){const{sketchLayerEditorState:i,modules:s}=this,{strings:r}=i;switch(this.clearHighlightAndPopup(),this.watchEscapeOnMapView(!0),this.watchDeleteOnMapView(!1),this.updateSketchMessage(e),"update"===this.sketchMode&&this.closeSketchPopovers(),this.sketchMode="continuous",this.sketchLayerEditorSVModel.cancel(),this.sketchLayerEditorSVModel.updateOnGraphicClick(!1),this.tempCreatedGraphic=void 0,this.currentSketchInfo.graphics=void 0,this.currentSketchInfo.tool=t,t){case"point":this.sketchLayerEditorSVModel.setPoint(await(0,o.j)(s.CIMSymbol,this.mapView,s.ColorUtils)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getPoint(),this.sketchLayerEditorSVModel.createPoint();break;case"polyline":this.sketchLayerEditorSVModel.setLine(await(0,o.i)(this.mapView,s.ColorUtils)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getLine(),this.sketchLayerEditorSVModel.createLine();break;case"bezier-curve":this.sketchLayerEditorSVModel.setLine(await(0,o.h)(this.mapView,s.ColorUtils)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getLine(),this.sketchLayerEditorSVModel.createLine(!0);break;case"polygon":case"rectangle":case"circle":this.sketchLayerEditorSVModel.setPolygon(await(0,o.f)(this.mapView,s.ColorUtils)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getPolygon(),this.sketchLayerEditorSVModel.createPolygon(t);break;case"text":this.sketchLayerEditorSVModel.setText(await(0,o.e)(this.mapView,s.ColorUtils,s.TextSymbol,r.textContentPlaceholder)),this.currentSketchInfo.symbol=this.sketchLayerEditorSVModel.getText(),this.sketchLayerEditorSVModel.createText()}this.currentSketchInfo.popup=void 0,this.currentSketchInfo.title=this.getDefaultGraphicTitle(),await(this.sketchContentEl?.rerender(t)),this.showSketchContent=!0,this.sketchContentReRender.emit(t),this.arcgisContentReRender.emit(t)}getSymbolProps(e){return{size:(0,o.k)(e),rotation:(0,o.l)(e),color:(0,o.m)(e),outline:(0,o.n)(e),outlineStyle:e.outline?.style,strokeStyle:e.style,marker:e.marker}}actionOnMultipleSelections(e){if(this.duplicateInProgress)return;const{mapView:t,modules:i}=this;if(this.selectedSketchFeaturesFeatures?.length)return void(this.selectedSketchFeaturesFeatures=void 0);const s=[this.layer.pointLayer,this.layer.polylineLayer,this.layer.polygonLayer,this.layer.textLayer],r="rectangle"===e?{createTool:"rectangle"}:{createTool:"polygon",mode:"freehand"},h=new i.SelectionOperation.createSelectionOperation(t,s,r);this.selectorOperation=h,h.once("complete",(e=>{const{selection:t}=e;if(this.clearHighlightAndPopup(),!e.aborted&&t.length){let e=[],i=[],s=[],r=[];t.forEach((t=>{switch((0,o.g)(t)){case"point":default:e=[...e,t];break;case"polyline":case"bezier-curve":i=[...i,t];break;case"polygon":s=[...s,t];break;case"text":r=[...r,t]}})),this.multipleSelectedGraphics=[...e,...i,...s,...r],e.length&&this.sketchLayerEditorSVModel.updatePoint(e),i.length&&this.sketchLayerEditorSVModel.updateLine(i),s.length&&this.sketchLayerEditorSVModel.updatePolygon(s),r.length&&this.sketchLayerEditorSVModel.updateText(r),this.watchDeleteOnMapView(!0)}})),this.sketchLayerEditorSVModel.updateOnGraphicClick(!1)}async offsetDuplicatedFeatures(){const{modules:e,mapView:t}=this;this.multipleSelectedGraphics.forEach((i=>e.drawUtils.move(i.geometry,15*t.resolution,15*t.resolution)));let i=[],s=[],r=[],h=[];this.multipleSelectedGraphics.forEach((e=>{switch((0,o.g)(e)){case"polyline":s=[...s,e];break;case"polygon":r=[...r,e];break;case"text":h=[...h,e];break;default:i=[...i,e]}})),this.currentSketchInfo.graphics=this.multipleSelectedGraphics,i.length&&this.sketchLayerEditorSVModel.updatePoint(i),s.length&&(s.forEach((t=>{t.geometry.curvePaths?.length&&(t.geometry=(0,o.a)(e.Polyline,t.geometry))})),await this.sketchLayerEditorSVModel.updateLine(s)),r.length&&this.sketchLayerEditorSVModel.updatePolygon(r),h.length&&this.sketchLayerEditorSVModel.updateText(h)}keepSelectToolSelection(){this.sketchToolsEl.activeSelectTool&&this.handleSelectFeatures(this.keepSelectionMessage,this.keepSelectionTool)}updateSketchMessage(e){const{sketchLayerEditorState:t}=this;t.sketchMessage=e}handleGraphicUpdates(e){if("symbol"===e.type&&e.symbolSwitchFromRecent){const e=(0,o.m)(this.currentSketchInfo.symbol.clone())?.toHex();e&&this.arcgisRecentColorsUpdate.emit(e)}if("update"===this.sketchMode&&this.currentSketchInfo.graphics?.length){const t=this.currentSketchInfo.graphics.length>1,i=this.currentSketchInfo.graphics[0].symbol.clone(),s=this.currentSketchInfo.symbol.clone(),h=this.getSymbolProps(i),c=this.getSymbolProps(s);this.currentSketchInfo.graphics.forEach(((i,s)=>{if("title"===e.type){if(i.attributes&&i.attributes.title!==this.currentSketchInfo.title?this.currentSketchInfo.graphics[s].attributes={...this.currentSketchInfo.graphics[s].attributes,title:this.currentSketchInfo.title}:i.attributes||(this.currentSketchInfo.graphics[s].attributes={title:this.currentSketchInfo.title}),this.selectedBezierGraphics.get(s)){const e=this.selectedBezierGraphics.get(s);e.attributes&&e.attributes.title!==this.currentSketchInfo.title?e.attributes={...e.attributes,title:this.currentSketchInfo.title}:e.attributes||(e.attributes={title:this.currentSketchInfo.title})}}else if("popup"===e.type){if(JSON.stringify(this.currentSketchInfo.graphics[s].popupTemplate?.toJSON())!==JSON.stringify(this.currentSketchInfo.popup?.toJSON())&&(this.currentSketchInfo.graphics[s].popupTemplate=this.currentSketchInfo.popup),this.selectedBezierGraphics.get(s)){const e=this.selectedBezierGraphics.get(s);JSON.stringify(e.popupTemplate?.toJSON())!==JSON.stringify(this.currentSketchInfo.popup?.toJSON())&&(e.popupTemplate=this.currentSketchInfo.popup)}}else if("symbol"===e.type)if(!t||e.symbolSwitchFromRecent){const t=this.currentSketchInfo.symbol.clone();"recent-text"===e.textProp&&(t.text=this.currentSketchInfo.graphics[s].symbol.clone().text),this.currentSketchInfo.graphics[s].symbol=t,this.hasUnderlyingBezierGraphics&&this.selectedBezierGraphics.get(s)&&(this.selectedBezierGraphics.get(s).symbol=t)}else if(e.symbolSwitch){const e=this.currentSketchInfo.graphics[s].symbol.clone(),t=this.currentSketchInfo.symbol.clone(),i=this.getSymbolProps(e),h=this.getSymbolProps(t);(0,r.i)(i.size)&&(0,r.i)(h.size)&&(0,o.o)(t,i.size),(0,r.i)(i.rotation)&&(0,r.i)(h.rotation)&&(0,o.p)(t,i.rotation),this.currentSketchInfo.graphics[s].symbol=t,this.hasUnderlyingBezierGraphics&&this.selectedBezierGraphics.get(s)&&(this.selectedBezierGraphics.get(s).symbol=t)}else{const t=this.currentSketchInfo.graphics[s].symbol.clone(),i=this.getSymbolProps(t);if(h.size!==c.size&&(0,o.o)(t,c.size),h.rotation!==c.rotation&&(0,o.p)(t,c.rotation),JSON.stringify(h.color)!==JSON.stringify(c.color)&&(h.color.a===c.color.a?(i.color.r=c.color.r,i.color.g=c.color.g,i.color.b=c.color.b):i.color.a=c.color.a,(0,o.q)(t,i.color)),(0,r.i)(h.outline)&&(0,r.i)(c.outline)&&JSON.stringify(h.outline)!==JSON.stringify(c.outline)){const e=h.outline.width===c.outline.width,s=h.outline.color.a===c.outline.color.a;e?s?(i.outline.color.r=c.outline.color.r,i.outline.color.g=c.outline.color.g,i.outline.color.b=c.outline.color.b):i.outline.color.a=c.outline.color.a:i.outline.width=c.outline.width,(0,o.r)(t,i.outline)}if(JSON.stringify(h.outlineStyle)!==JSON.stringify(c.outlineStyle)&&t.outline&&(t.outline.style=c.outlineStyle),JSON.stringify(h.strokeStyle)!==JSON.stringify(c.strokeStyle)&&(t.style=c.strokeStyle),JSON.stringify(h.marker)!==JSON.stringify(c.marker)&&(t.marker=c.marker),e.textProp){const i=this.currentSketchInfo.symbol.clone();switch(e.textProp){case"text":t.text=i.text;break;case"font":t.font.family=i.font.family,t.font.weight=i.font.weight,t.font.style=i.font.style;break;case"font-size":t.font.size=i.font.size;break;case"color":t.color.r=i.color.r,t.color.g=i.color.g,t.color.b=i.color.b;break;case"color-transparency":t.color.a=i.color.a;break;case"rotation":t.angle=i.angle;break;case"halo":t.haloColor=i.haloColor,t.haloSize=i.haloSize;break;case"halo-color":t.haloColor?(t.haloColor.r=i.haloColor.r,t.haloColor.g=i.haloColor.g,t.haloColor.b=i.haloColor.b):t.haloColor=i.haloColor;break;case"halo-color-transparency":t.haloColor&&(t.haloColor.a=i.haloColor.a);break;case"halo-size":t.haloSize=i.haloSize;break;case"background":t.backgroundColor=i.backgroundColor,t.borderLineColor=i.borderLineColor,t.borderLineSize=i.borderLineSize;break;case"background-color":t.backgroundColor?(t.backgroundColor.r=i.backgroundColor.r,t.backgroundColor.g=i.backgroundColor.g,t.backgroundColor.b=i.backgroundColor.b):t.backgroundColor=i.backgroundColor;break;case"background-color-transparency":t.backgroundColor&&(t.backgroundColor.a=i.backgroundColor.a);break;case"border-line-color":t.borderLineColor?(t.borderLineColor.r=i.borderLineColor.r,t.borderLineColor.g=i.borderLineColor.g,t.borderLineColor.b=i.borderLineColor.b):(t.backgroundColor=i.backgroundColor,t.borderLineColor=i.borderLineColor,t.borderLineSize=i.borderLineSize);break;case"border-line-color-transparency":t.borderLineColor&&(t.borderLineColor.a=i.borderLineColor.a);break;case"border-line-size":t.borderLineSize=i.borderLineSize}}this.currentSketchInfo.graphics[s].symbol=t,this.hasUnderlyingBezierGraphics&&this.selectedBezierGraphics.get(s)&&(this.selectedBezierGraphics.get(s).symbol=t)}}))}else this.tempCreatedGraphic&&(this.tempCreatedGraphic.attributes&&this.tempCreatedGraphic.attributes.title!==this.currentSketchInfo.title?this.tempCreatedGraphic.attributes={...this.tempCreatedGraphic.attributes,title:this.currentSketchInfo.title}:this.tempCreatedGraphic.attributes||(this.tempCreatedGraphic.attributes={title:this.currentSketchInfo.title}),JSON.stringify(this.tempCreatedGraphic.popupTemplate?.toJSON())!==JSON.stringify(this.currentSketchInfo.popup?.toJSON())&&(this.tempCreatedGraphic.popupTemplate=this.currentSketchInfo.popup),this.tempCreatedGraphic.symbol=this.currentSketchInfo.symbol);this.currentSketchInfo.graphics?.[0]&&this.mapView.popup&&(this.mapView.popup.features=[this.currentSketchInfo.graphics[0]]),this.setCurrentSketchSymbol(),this.handleInternalSketchUpdate()}handleInternalSketchUpdate(){this.sketchUpdated.emit(),this.arcgisChange.emit()}handleDisablePanel(e){this.sketchFlowItemEl.disabled=e}removeSketchShortcuts(){this.arcgisSketchLayerEditorShortcutsEl&&(this.arcgisSketchLayerEditorShortcutsEl.removeEventListener("arcgisClose",(()=>this.removeSketchShortcuts())),document.body.removeChild(this.arcgisSketchLayerEditorShortcutsEl),this.arcgisSketchLayerEditorShortcutsEl=void 0)}addSketchShortcutsTooltip(){const{sketchLayerEditorState:e}=this,{strings:t}=e,i=document.createElement("calcite-tooltip");i.referenceElement=this.sketchShortcutsButtonEl,i.open=!0,i.innerHTML=t.sketchShortcuts,this.sketchShortcutsTooltipEl=i,document.body.append(i)}removeSketchShortcutsTooltip(){this.sketchShortcutsTooltipEl&&(this.sketchShortcutsTooltipEl.parentElement?.removeChild(this.sketchShortcutsTooltipEl),this.sketchShortcutsTooltipEl=void 0)}closeSketchPopovers(){this.sketchToolsEl?.activeSelectTool&&"select"!==this.sketchToolsEl.activeSelectTool&&this.updateSketchMessage(void 0),this.showSketchContent=!1,this.closeSnappingPopovers(),this.removeSketchShortcuts(),this.setFocus()}closeSnappingPopovers(){this.sketchSnappingEl&&(document.body.removeChild(this.sketchSnappingEl),this.sketchSnappingEl=void 0,this.handleDisablePanel(!1)),this.setFocus()}createShadowBezierGraphicfromCurrentGraphic(e,t){const{modules:i}=this,s=e.clone();s.attributes={...s.attributes,[d]:!0},s.visible=!0;const{mapView:o}=this,r=o.allLayerViews?.items.find((({layer:e})=>e===this.layer)),h=r?.highlight(s);s.addHandles([i.reactiveUtils.watch((()=>e.geometry.paths?.[0]),(t=>this.handleCurvedGraphicPathChange(s,e,t))),h]),this.layer.polylineLayer.add(s),this.selectedBezierGraphics.set(t,s)}handleCurvedGraphicPathChange(e,t,i){const{modules:s}=this;t.visible=!1,e.geometry&&Array.isArray(i)&&(e.geometry=(0,o.a)(s.Polyline,t.geometry))}cleanUpBezierGraphics(){this.selectedBezierGraphics.forEach((e=>{e.removeHandles(),e.layer.remove(e)})),this.selectedBezierGraphics.clear()}convertNonBezierGraphicsToBezierGraphics(){this.graphicsToConvertToBezierGraphics.forEach((e=>{const t=(0,o.a)(this.modules.Polyline,e.geometry);JSON.stringify(t)!==JSON.stringify(e.geometry)&&(e.geometry=t),e.visible=!0})),this.graphicsToConvertToBezierGraphics=[]}static get assetsDirs(){return["assets"]}get el(){return(0,s.a)(this)}};u.style=":host {\n  display: flex;\n  flex: 1 1 auto;\n  overflow: hidden;\n}\n\n.snapping {\n  display: flex;\n  padding: var(--calcite-spacing-sm);\n  background-color: var(--calcite-color-foreground-1);\n}\n\n.snapping-controls-button {\n  min-width: 0px;\n}\n\n.sketch-message {\n  padding: var(--calcite-spacing-sm);\n}\n\n.sketch-keyboard-button {\n  margin-left: 0.3em;\n}\n\n.multiple-selection {\n  margin: 1em;\n}\n\n.multiple-selection calcite-button {\n  margin-top: 0.3em;\n}\n\n:dir(rtl) {\n  .sketch-keyboard-button {\n    margin-left: unset;\n    margin-right: 0.3em;\n  }\n}\n"},84260:(e,t,i)=>{i.d(t,{u:()=>h});var s=i(11254),o=i(10465),r=i(14528);function h({propertyName:e="strings",name:t}){let i=(0,r.r)();const h=(0,o.g)(i.el),n=new o.D,a={_lang:h.lang,_t9nLocale:h.t9nLocale};i.manager.onLoad((()=>n.promise));const l=new WeakRef(i);function p(){const e=l.deref();return e||u?.(),e}i=void 0;const d=c((()=>p()?.el)),u=(0,o.s)(d,(()=>(0,s.g)("./assets")),(({t9nLocale:t,t9nStrings:i,lang:s})=>{const o=p();if(!o)return;o[e]={...i,_lang:s,_t9nLocale:t},n.resolve()}),t);return a}const c=e=>new Proxy({},{get(t,i){const s=e();if(!s)return;const o=Reflect.get(s,i,s);return"function"==typeof o?o.bind(s):o}})},93345:(e,t,i)=>{i.d(t,{c:()=>n});var s=i(11254);const o=e=>!("isConnected"in e)||e.isConnected,r=((e,t)=>{let i;return(...s)=>{i&&clearTimeout(i),i=setTimeout((()=>{i=0,e(...s)}),t)}})((e=>{for(let t of e.keys())e.set(t,e.get(t).filter(o))}),2e3),h=e=>"function"==typeof e?e():e,c=(e,t)=>{const i=e.indexOf(t);i>=0&&(e[i]=e[e.length-1],e.length--)},n=(e,t)=>{const i=((e,t=(e,t)=>e!==t)=>{const i=h(e);let s=new Map(Object.entries(i??{}));const o={dispose:[],get:[],set:[],reset:[]},r=()=>{s=new Map(Object.entries(h(e)??{})),o.reset.forEach((e=>e()))},n=e=>(o.get.forEach((t=>t(e))),s.get(e)),a=(e,i)=>{const r=s.get(e);t(i,r,e)&&(s.set(e,i),o.set.forEach((t=>t(e,i,r))))},l="undefined"==typeof Proxy?{}:new Proxy(i,{get:(e,t)=>n(t),ownKeys:e=>Array.from(s.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>s.has(t),set:(e,t,i)=>(a(t,i),!0)}),p=(e,t)=>(o[e].push(t),()=>{c(o[e],t)});return{state:l,get:n,set:a,on:p,onChange:(t,i)=>{const s=p("set",((e,s)=>{e===t&&i(s)})),o=p("reset",(()=>i(h(e)[t])));return()=>{s(),o()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(p("set",t.set)),t.get&&e.push(p("get",t.get)),t.reset&&e.push(p("reset",t.reset)),t.dispose&&e.push(p("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{o.dispose.forEach((e=>e())),r()},reset:r,forceUpdate:e=>{const t=s.get(e);o.set.forEach((i=>i(e,t,t)))}}})(e,t);return i.use((()=>{if("function"!=typeof s.d)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const i=(0,s.d)();i&&((e,t,i)=>{const s=e.get(t);s?s.includes(i)||s.push(i):e.set(t,[i])})(e,t,i)},set:t=>{const i=e.get(t);i&&e.set(t,i.filter(s.f)),r(e)},reset:()=>{e.forEach((e=>e.forEach(s.f))),r(e)}}})()),i}}}]);