/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-5bc47d.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-5bc47d"],{298:(e,t,i)=>{function s(e,t,i){t.labelFormatFunction=t=>l(e,t,i,"short-date"),t.inputFormatFunction=t=>l(e,t,i,"short-date"),t.inputParseFunction=e=>function(e,t){if(!e)return e;let i;if(t&&"system"!==t)if("unknown"===t)i=e;else{const s=new Date;i=e+(new Date(s.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(s.toLocaleString("en-US",{timeZone:t})).getTime())}else{i=e+6e4*(new Date).getTimezoneOffset()}return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(i).toISOString()),i}(Date.parse(e),i)}function a(e,t){let i;if(t&&"system"!==t)if("unknown"===t)i=new Date(e).toISOString();else{const s=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:t});i=new Date(new Date(a).getTime()-6e4*s).toISOString()}else{const t=(new Date).getTimezoneOffset();i=new Date(e-6e4*t).toISOString()}return i}function n(e,t,i){let s;if(t&&"system"!==t)if("unknown"===t)s=new Date(e).toISOString();else{const i=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:t});s=new Date(new Date(a).getTime()-6e4*i).toISOString()}else{const t=(new Date).getTimezoneOffset();s=new Date(e-6e4*t).toISOString()}return s=i?s.substring(11,19):s.substring(11,16),s}function o(e,t){let i,s=new Date(e);if(s=new Date(s.getTime()-6e4*s.getTimezoneOffset()),t&&"system"!==t)if("unknown"===t)i=s.getTime();else{const e=new Date(s.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(s.toLocaleString("en-US",{timeZone:t})).getTime();i=s.getTime()+e}else{const e=(new Date).getTimezoneOffset();i=s.getTime()+6e4*e}return i}function l(e,t,i,s){const{modules:a}=e;let n;return n="unknown"===i?a.intl.formatDate(t,{...a.intl.convertDateFormatToIntlOptions(s||"short-date-short-time"),timeZone:"utc",timeZoneName:"shortOffset"}):a.intl.formatDate(t,{...a.intl.convertDateFormatToIntlOptions(s||"short-date-short-time"),timeZone:i}),n}i.d(t,{a:()=>s,b:()=>n,d:()=>o,u:()=>a})},29628:(e,t,i)=>{i.r(t),i.d(t,{arcgis_smart_mapping_age:()=>y,arcgis_smart_mapping_background_symbol:()=>v,arcgis_smart_mapping_classify:()=>z,arcgis_smart_mapping_default_symbol:()=>x,arcgis_smart_mapping_divided_by:()=>M,arcgis_smart_mapping_info_popover:()=>k,arcgis_smart_mapping_method_button:()=>w,arcgis_smart_mapping_panels_size:()=>I,arcgis_smart_mapping_regenerate_style:()=>N,arcgis_smart_mapping_rotation:()=>C,arcgis_smart_mapping_size_range_slider:()=>V,arcgis_smart_mapping_size_slider:()=>T,arcgis_smart_mapping_symbol_pair_button:()=>B,arcgis_smart_mapping_symbol_pair_popover:()=>F,arcgis_smart_mapping_theme_button:()=>R,arcgis_smart_mapping_tile:()=>P,arcgis_smart_mapping_transparency:()=>D});var s=i(11254),a=i(39020),n=(i(56612),i(76744)),o=i(298),l=i(39715),r=i(35365),d=i(73959),c=i(53127),h=i(14528),p=i(72513),m=i(68474),u=i(1664),g=i(44735),f=i(10465),S=i(17840);i(69811);async function b(e,t){const{layer:i,useFeatureReduction:s,mapView:a,modules:n}=e,o=i;if(!(t=t||{}).fieldInfos&&!t.fieldInfos?.length)throw new Error;const l=t.fieldInfos[0];return await n.OpacityVariableCreator.createVisualVariable({layer:o,field:l.field,view:a,valueExpression:l.expression,valueExpressionTitle:l.expressionTitle,normalizationField:t.normalizationField,forBinning:"binning"===o.featureReduction?.type&&s})}const y=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingAgeChange=(0,s.c)(this,"arcgisSmartMappingAgeChange",7),this.arcgisSmartMappingAgeError=(0,s.c)(this,"arcgisSmartMappingAgeError",7),this.manager=(0,h.u)(this),this.smartMappingState=(0,r.u)(),this.rendererSubtype=void 0}componentWillLoad(){const{fields:e}=this.smartMappingState,t=(0,n.g)(this.smartMappingState),i="color"===this.rendererSubtype?(0,n.d)(t,"color"):(0,n.d)(t,"size"),s=e.filter((e=>e.simpleFieldType===n.w.DATE&&e.layerField.name===i.field));this.restDateFields=e.filter((e=>e.simpleFieldType===n.w.DATE&&e!==s[0])),this.flowItemNode=(0,a.f)(this.el,"calcite-flow-item")}render(){return(0,s.h)(s.H,{key:"77fe3b33bdf7c4c72c883e7fc1b786b742a4c21e"},this.renderFrom(),this.renderTo(),this.renderUnits())}renderFrom(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e),a="color"===this.rendererSubtype?(0,n.d)(i,"color"):(0,n.d)(i,"size"),{field:o,startTime:l}=a;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,t.age.from),(0,s.h)("div",{class:"from-field"},o===l?this.rendererStaticField():this.rendererAgeField()))}renderTo(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e),a="color"===this.rendererSubtype?(0,n.d)(i,"color"):(0,n.d)(i,"size"),{field:o,endTime:l}=a;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,(0,s.h)("div",{class:"to-flip-wrapper"},(0,s.h)("div",{class:"to-label"},t.age.to),(0,s.h)("arcgis-smart-mapping-action",{hideOutline:!0,text:t.age.flip,icon:"arrowUpDown",onClick:()=>this.handleFlip()}))),(0,s.h)("div",{class:"to-field"},o===l?this.rendererStaticField():this.rendererAgeField()))}rendererStaticField(){const{smartMappingState:e}=this,t=(0,n.g)(e),i="color"===this.rendererSubtype?(0,n.d)(t,"color"):(0,n.d)(t,"size"),a=(0,n.y)(e,i.field);return(0,s.h)("div",{class:"field-select-fixed"},a?.label)}rendererAgeField(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e),a="color"===this.rendererSubtype?(0,n.d)(i,"color"):(0,n.d)(i,"size"),{field:o,startTime:l,endTime:r}=a,d=l===o?r:l,c="string"==typeof d,h=this.restDateFields?.[0]?.layerField.alias||this.restDateFields?.[0]?.layerField.name;let p;return c&&(p={field:d,simpleFieldType:n.w.DATE}),(0,s.h)("div",null,this.restDateFields?.length?(0,s.h)("calcite-radio-button-group",{class:"variable-field-radio",name:"variableType",onCalciteRadioButtonGroupChange:e=>this.handleTypeChange(e.target.selectedItem.value)},(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{key:c?`age-variable-radio-field-${Math.random()}`:void 0,checked:c,value:"field"}),t.age.field),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{key:c?void 0:`age-variable-radio-date-${Math.random()}`,checked:!c,value:"date"}),t.age.customDate)):null,c?this.restDateFields?.length&&this.restDateFields?.length>1?(0,s.h)("arcgis-smart-mapping-attribute-input",{fieldList:this.restDateFields,selectedField:p,mode:"simple",hideLabel:!0,popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingAttributeInputChange:e=>{if(e.detail){const t=e.detail.field;this.createRendererUpdateCall(o===l?{endTime:t}:{startTime:t})}},ref:e=>{e&&(this.rendererAgeFieldNode=e)}}):(0,s.h)("div",{class:"field-select-fixed"},h):this.rendererAgeFieldDate())}renderUnits(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e),a=("color"===this.rendererSubtype?(0,n.d)(i,"color"):(0,n.d)(i,"size")).units;return(0,s.h)("calcite-label",{class:"units-label"},t.age.units,(0,s.h)("calcite-select",{class:"units-select",width:"full",label:t.age.units,onCalciteSelectChange:e=>this.handleUnitChange(e),value:a,ref:e=>this.unitsNode=e},(0,s.h)("calcite-option",{value:"seconds",label:t.age.seconds,selected:"seconds"===a}),(0,s.h)("calcite-option",{value:"minutes",label:t.age.minutes,selected:"minutes"===a}),(0,s.h)("calcite-option",{value:"hours",label:t.age.hours,selected:"hours"===a}),(0,s.h)("calcite-option",{value:"days",label:t.age.days,selected:"days"===a}),(0,s.h)("calcite-option",{value:"months",label:t.age.months,selected:"months"===a}),(0,s.h)("calcite-option",{value:"years",label:t.age.years,selected:"years"===a})))}rendererAgeFieldDate(){const{smartMappingState:e}=this,{mapView:t}=e,i=(0,n.g)(e),a="color"===this.rendererSubtype?(0,n.d)(i,"color"):(0,n.d)(i,"size"),{field:l,startTime:r,endTime:d}=a,h=a.units,p=r===l?d:r,m="string"==typeof p,u=m?void 0:(0,o.u)(p,t.timeZone),g=["seconds","minutes","hours"].includes(h),f=!m&&g?(0,o.b)(p,t.timeZone,"seconds"===h):void 0;return(0,s.h)(s.F,null,(0,s.h)("calcite-input-date-picker",{value:u,overlayPositioning:"fixed",class:"variable-date-date",ref:e=>{e&&(this.datePickerNode=e)},onCalciteInputDatePickerChange:()=>this.handleDateChange()}),g?(0,s.h)("calcite-input-time-picker",{key:`${h}-${p}`,step:"seconds"===h?1:60,value:f,overlayPositioning:"fixed",class:"variable-date-time",ref:e=>{e&&(this.timePickerNode=e)},onCalciteInputTimePickerChange:(0,c.d)((()=>{this.timePickerNode&&(this.timePickerNode.open=!1),this.handleTimeChange()}),750)}):null)}createRendererUpdateCall(e){const{smartMappingState:t}=this,i=(0,n.k)(t);let a;a="color-age"===i?l.c:"size-age"===i?d.j:"color-age-size"===i?d.f:"color-size-age"===i?d.e:d.b,(0,l.r)(a(t,e,this.rendererSubtype),this.flowItemNode).then((e=>{(0,n.t)(t,e.renderer),(0,s.f)(this.el),this.arcgisSmartMappingAgeChange.emit()}),(e=>{this.rendererAgeFieldNode&&(0,s.f)(this.rendererAgeFieldNode);const{mapView:i}=this.smartMappingState,a=(0,n.g)(t),l="color"===this.rendererSubtype?(0,n.d)(a,"color"):(0,n.d)(a,"size"),{field:r,startTime:d,endTime:c}=l,h=l.units,p=d===r?c:d,m="string"==typeof p,u=["seconds","minutes","hours"].includes(h),g=m?void 0:(0,o.u)(p,i.timeZone),f=!m&&u?(0,o.b)(p,i.timeZone,"seconds"===h):void 0;this.datePickerNode&&g&&(this.datePickerNode.value=g),this.timePickerNode&&f&&(this.timePickerNode.value=f),this.unitsNode&&(this.unitsNode.value=h),(0,s.f)(this.el),this.arcgisSmartMappingAgeError.emit(e)}))}handleUnitChange(e){const t={units:e.target.selectedOption.value};this.createRendererUpdateCall(t)}handleTypeChange(e){const{smartMappingState:t}=this,i=(0,n.g)(t),s="color"===this.rendererSubtype?(0,n.d)(i,"color"):(0,n.d)(i,"size"),{field:a,startTime:o}=s,l="field"===e?this.restDateFields?.[0]?.layerField.name:(new Date).getTime();this.createRendererUpdateCall(a===o?{endTime:l}:{startTime:l})}handleDateChange(){const{smartMappingState:e}=this,{mapView:t}=e,i=(0,n.g)(e),s="color"===this.rendererSubtype?(0,n.d)(i,"color"):(0,n.d)(i,"size"),a=this.datePickerNode?.value;if(!a)return;const l=this.timePickerNode?.value||"00:00:00",r=(0,o.d)(`${a}T${l}`,t.timeZone),{field:d,startTime:c}=s,h={};d===c?h.endTime=r:h.startTime=r,this.createRendererUpdateCall(h)}handleTimeChange(){const{smartMappingState:e}=this,{mapView:t}=e,i=(0,n.g)(e),s="color"===this.rendererSubtype?(0,n.d)(i,"color"):(0,n.d)(i,"size"),{field:a,startTime:l}=s,r=this.timePickerNode?.value,d=this.datePickerNode?.value,c=(0,o.d)(`${d}T${r}`,t.timeZone),h={};a===l?h.endTime=c:h.startTime=c,this.createRendererUpdateCall(h)}handleFlip(){const{smartMappingState:e}=this,t=(0,n.g)(e),i="color"===this.rendererSubtype?(0,n.d)(t,"color"):(0,n.d)(t,"size"),{startTime:s,endTime:a}=i,o={startTime:a,endTime:s};this.createRendererUpdateCall(o),this.createRendererUpdateCall(o)}get el(){return(0,s.a)(this)}};y.style=".field-select-fixed{background-color:#f6f6f6;padding:6px 6px;justify-content:space-between;align-items:center;color:#333333;margin:0;transition:box-shadow 250ms ease-in-out;box-shadow:0 0 0 1px #e0e0e0;height:auto;line-height:1.25;overflow-wrap:anywhere}.variable-date-date{width:100%}.variable-date-time{width:100%;margin-top:5px}.variable-field-radio{display:flex;justify-content:space-between}.to-flip-wrapper{display:flex;justify-content:space-between}.to-label{display:flex;align-items:center;margin-top:10px}.units-label{margin-top:6px}.to-field{margin-top:-10px}.from-field{margin-top:-8px;margin-bottom:6px}.units-select{margin-bottom:10px}";const v=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingBackgroundSymbolChange=(0,s.c)(this,"arcgisSmartMappingBackgroundSymbolChange",7),this.manager=(0,h.u)(this),this.lastSettings={},this.smartMappingState=(0,r.u)()}componentWillLoad(){this.popoverReferenceElement=(0,a.f)(this.el,"calcite-flow-item")||(0,a.f)(this.el,"calcite-panel")}render(){const{smartMappingState:e}=this,{strings:t}=e;if(!(0,n.e)(e))return(0,s.h)(s.F,null);const i=(0,n.g)(e),a="dot-density"===(0,n.k)(e)?i.backgroundColor||i.outline:i.backgroundFillSymbol;return(0,s.h)("calcite-block-section",{text:t.backgroundSymbol.showBackgroundSymbol,open:!!a,"toggle-display":"switch",onCalciteBlockSectionToggle:e=>this.handleBackgroundSymbolToggle(e)},this.renderBackgroundSymbolContent())}renderBackgroundSymbolContent(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e),o="dot-density"===(0,n.k)(e),l=(0,n.d)(i,"reference-size");let r;return o?(i.outline||i.backgroundColor)&&(r=(0,n.f)(e),r.outline=i.outline,(0,n.j)(e,r,i.backgroundColor)):l?(r=(0,n.f)(e),(0,n.j)(e,r,i.backgroundFillSymbol?.color)):r=i.backgroundFillSymbol,r?(this.popoverReferenceElement=this.popoverReferenceElement||(0,a.f)(this.el,"calcite-flow-item")||(0,a.f)(this.el,"calcite-panel"),(0,s.h)("div",{class:"background-symbol-content"},(0,s.h)("arcgis-smart-mapping-symbol-button",{type:o?"dot-density-background":"background",label:t.backgroundSymbol.backgroundStyle,symbol:r,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.arcgisSmartMappingBackgroundSymbolChange.emit()},popoverReferenceElement:this.popoverReferenceElement}))):(0,s.h)(s.F,null)}handleBackgroundSymbolToggle(e){const{smartMappingState:t}=this,{modules:i}=t,a=e.currentTarget,o=(0,n.g)(t);if("dot-density"===(0,n.k)(t))a.open?(this.lastSettings.backgroundColor||this.lastSettings.outline?(o.backgroundColor=this.lastSettings.backgroundColor,o.outline=this.lastSettings.outline):(o.backgroundColor=new i.EsriColor({r:64,g:64,b:64,a:1}),o.outline=new i.SimpleLineSymbol),this.lastSettings.outlineVisVar&&(o.visualVariables=o.visualVariables||[],o.visualVariables.push(this.lastSettings.outlineVisVar)),this.lastSettings.backgroundColor=void 0,this.lastSettings.outline=void 0,this.lastSettings.outlineVisVar=void 0):(this.lastSettings.backgroundColor=o.backgroundColor,this.lastSettings.outline=o.outline,this.lastSettings.outlineVisVar=(0,n.b)(o,"size","outline"),o.backgroundColor=new i.EsriColor({r:0,g:0,b:0,a:0}),o.outline=void 0,o.visualVariables=(0,n.a)(o,"size","outline"),(0,n.J)());else if(a.open){if(this.lastSettings.backgroundFillSymbol)o.backgroundFillSymbol=this.lastSettings.backgroundFillSymbol;else{const e=(0,n.f)(t);e.color=null,o.backgroundFillSymbol=e}this.lastSettings.backgroundFillSymbol=void 0}else this.lastSettings.backgroundFillSymbol=o.backgroundFillSymbol,o.backgroundFillSymbol=void 0,(0,n.J)();(0,n.t)(t),(0,s.f)(this.el)}get el(){return(0,s.a)(this)}};v.style=".background-symbol-content{padding-top:6px;border-bottom:1px solid #e0e0e0}";const z=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingClassifyChange=(0,s.c)(this,"arcgisSmartMappingClassifyChange",7),this.arcgisSmartMappingClassifyError=(0,s.c)(this,"arcgisSmartMappingClassifyError",7),this.manager=(0,h.u)(this),this.inputNodes=[],this.labelNodes=[],this.symbolNodes=[],this.disconnected=!1,this.smartMappingState=(0,r.u)()}componentWillLoad(){this.flowItemNode=(0,a.f)(this.el,"calcite-flow-item")}disconnectedCallback(){this.disconnected=!0,clearTimeout(this.classesChangeHandle)}render(){const{smartMappingState:e}=this,{strings:t,layer:i,mapImageSublayer:a,supportsArcade:o}=e,l=(0,n.g)(e),r=(0,n.b)(l,"color"),d=(0,n.b)(l,"size"),c=r||d,h=(0,n.z)(e),p=(0,n.aD)(e)??(0,n.aD)(e,"above-and-below"),m=r&&["high-to-low","above-and-below","above","below"].includes(h)&&p&&!p.colorsForClassBreaks?.length;return a&&!o||"subtype-sublayer"===i.type?(0,s.h)("calcite-block-section",{class:"classify-block-section",text:t.classify.classifyData,open:!c,toggleDisplay:"button"},!c&&this.renderContents()):(0,s.h)(s.F,null,(0,s.h)("calcite-label",{class:"classify-block-section classify-heading "+(m?"disable-classify":""),layout:"inline-space-between",onMouseOver:()=>{m&&(0,n.ab)(this.blockLabelNode,t.classify.cannotClassify,!0,"left-start")},onMouseOut:()=>(0,n.a9)(),onFocus:()=>{m&&(0,n.ab)(this.blockLabelNode,t.classify.cannotClassify,!0,"left-start")},onFocusout:()=>(0,n.a9)(),ref:e=>this.blockLabelNode=e},t.classify.classifyData,(0,s.h)("calcite-switch",{disabled:m,scale:"s",checked:!c,onCalciteSwitchChange:e=>{e.stopImmediatePropagation(),this.handleClassifyToggle()},ref:e=>this.classifySwitchNode=e})),!m&&!c&&this.renderContents())}renderContents(){return(0,s.h)("div",{class:"block-section-padding"},this.renderMethod(),this.renderClasses(),this.renderStdDev(),this.renderRoundClasses(),this.renderValues())}renderMethod(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.k)(e);return(0,s.h)("arcgis-smart-mapping-method-button",{key:t.authoringInfo?.classificationMethod??void 0,showStdDev:!0,onArcgisSmartMappingMethodButtonBeforeOpen:()=>(0,n.J)(),onArcgisSmartMappingMethodButtonChange:t=>{const a=t.target;this.precisionValue=void 0;const o=(0,n.g)(e);if("manual"===t.detail){const t=o.authoringInfo;"standard-deviation"===t.classificationMethod&&o.classBreakInfos.forEach(((e,t)=>{const i=t>0?"> ":"";e.label=`${i} ${e.minValue.toLocaleString()} - ${e.maxValue.toLocaleString()}`})),t.classificationMethod="manual",(0,n.t)(e),(0,s.f)(this.el),setTimeout((()=>{this.methodButtonNode?.setFocus()}),300)}else{const o="color"===i?l.a:d.n;(0,l.r)(o(e,{classificationMethod:t.detail}),this.flowItemNode).then((t=>{(0,n.t)(e,t.renderer),(0,s.f)(this.el),this.arcgisSmartMappingClassifyChange.emit(),setTimeout((()=>{this.methodButtonNode?.setFocus()}),300)}),(e=>{(0,s.f)(a),this.arcgisSmartMappingClassifyError.emit(e)}))}},ref:e=>{e&&(this.methodButtonNode=e)}})}renderClasses(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e),a=i.classBreakInfos.length;return"standard-deviation"===i.authoringInfo.classificationMethod?(0,s.h)(s.F,null):(0,s.h)("calcite-label",null,t.classify.classifyClasses,(0,s.h)("calcite-input-number",{value:`${a}`,min:1,max:10,step:1,onCalciteInputNumberInput:(0,c.d)((()=>{if(!this.disconnected&&(clearTimeout(this.classesChangeHandle),this.classesNode)){const e=Number.parseInt(this.classesNode.value);if(e===a)return;!e||e<this.classesNode.min||e>this.classesNode.max?this.classesChangeHandle=setTimeout((()=>this.handleClassesChange()),3e3):this.handleClassesChange()}}),300),ref:e=>{e&&(this.classesNode=e)}}))}renderStdDev(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e).authoringInfo,a=i.standardDeviationInterval||1;return"standard-deviation"!==i.classificationMethod?(0,s.h)(s.F,null):(0,s.h)("calcite-label",null,t.classify.classifyStdDevIntervals,(0,s.h)("calcite-select",{width:"full",role:"button",label:t.classify.classifyStdDevIntervals,onCalciteSelectChange:e=>this.handleStdDevChange(e),value:`${a}`,ref:e=>this.stdDevSelectNode=e},(0,s.h)("calcite-option",{value:"0.5",label:"0.5",selected:.5===a}),(0,s.h)("calcite-option",{value:"1",label:"1",selected:1===a})))}renderRoundClasses(){const{smartMappingState:e}=this,{modules:t,strings:i}=e;if("standard-deviation"===(0,n.g)(e).authoringInfo.classificationMethod)return(0,s.h)(s.F,null);const a=(0,p.a)(e),o=(0,s.h)("calcite-option",{value:"select",label:i.classify.selectAnOption});this.precisionValue||(this.precisionValue=a.toString().split(".")[1]?.length??a.toFixed(20).toString().split(".")[1]?.length);const l=(0,p.b)(e,this.precisionValue).map((e=>(0,s.h)("calcite-option",{value:`${e}`,label:e.toLocaleString(t.intl.getLocale(),{maximumSignificantDigits:15}),disabled:a>=e,selected:a===e})));return(0,s.h)("calcite-label",null,i.classify.classifyRoundClasses,(0,s.h)("calcite-select",{width:"full",label:i.classify.classifyRoundClasses,onCalciteSelectChange:e=>this.handleRoundClassesChange(e)},[o,...l]))}renderValues(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e);return this.labelNodes=[],this.inputNodes=[],(0,s.h)("calcite-list",{label:t.classify.classes},i.classBreakInfos.map(((e,t)=>this.renderValue(e,t))).reverse())}renderValue(e,t){return(0,s.h)("calcite-list-item",null,(0,s.h)("div",{class:"symbol-container",slot:"actions-start"},this.renderSymbolNode(e,t)),this.renderTextNode(e,t))}renderSymbolNode(e,t){const{smartMappingState:i}=this,{strings:a}=i,o=(0,n.g)(i).classBreakInfos[t].symbol.clone(),l={"symbol-is-white":(0,n.T)(i,o),symbol:!0};return(0,s.h)("div",{class:l,tabindex:"0","aria-label":a.classify.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true",ref:e=>{e&&this.symbolNodes.unshift(e)},onClick:()=>{this.popoverNode?(this.symbolNodes[this.selectedPopoverIdx].classList.remove("selected"),this.selectedPopoverIdx===t?((0,n.J)(),this.popoverNode=void 0,this.selectedPopoverIdx=void 0):(this.selectedPopoverIdx=t,this.handleValueSymbolClick(t))):(this.selectedPopoverIdx=t,this.handleValueSymbolClick(t))},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(t))}},(0,s.h)("div",{ref:e=>{e&&this.afterCreateValueSymbol(e,t)}}))}renderTextNode(e,t){const{strings:i}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("div",{key:e.label??void 0,class:"label",slot:"content",tabindex:"0",ref:e=>{e&&this.labelNodes.unshift(e)},"aria-label":i.classify.accessibility.editLabelFor.replace("${value}",e.label),onClick:e=>this.handleLabelEdit(t,e),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleLabelEdit(t,e)}},e.label),(0,s.h)("calcite-input",{slot:"content",class:"hidden",scale:"s",ref:e=>{e&&this.inputNodes.unshift(e)},value:e.label??void 0,onCalciteInputChange:e=>{this.inputNodes[t].classList.add("hidden"),this.labelNodes[t].classList.remove("hidden"),this.handleValueTextChange(t,e)},onFocusout:e=>{this.inputNodes[t].classList.add("hidden"),this.labelNodes[t].classList.remove("hidden"),this.handleValueTextChange(t,e)},onKeyDown:i=>{if(i.stopPropagation(),"Escape"===i.key||"Enter"===i.key){this.inputNodes[t].classList.add("hidden");const s=i.currentTarget;s.value=e.label||"",s.disabled=!0,this.handleValueTextChange(t,i),this.labelNodes[t].classList.remove("hidden"),s.disabled=!1,setTimeout((()=>this.labelNodes[t].focus()),300)}}}))}afterCreateValueSymbol(e,t){const{smartMappingState:i}=this,{modules:s}=i,a=(0,n.g)(i).classBreakInfos[t].symbol.clone();for(;e?.childNodes?.length;)e.removeChild(e.childNodes[0]);const{symbolUtils:o}=s;a&&o.renderPreviewHTML(a,{size:(0,n.U)(a),symbolConfig:"cim"===a.type&&"CIMPolygonSymbol"===a.data.symbol.type?{isSquareFill:!0}:void 0}).then((t=>{!t||!e||1===e.childElementCount&&e.firstElementChild?.isEqualNode(t)||(e.innerHTML="",e.appendChild(t))}))}handleClassifyToggle(){const{smartMappingState:e}=this,t=(0,n.k)(e),i=this.classifySwitchNode.checked?"color"===t?l.a:d.n:"color"===t?l.b:d.c;(0,l.r)(i(e,{}),this.flowItemNode).then((t=>{(0,n.t)(e,t.renderer),(0,s.f)(this.el),this.arcgisSmartMappingClassifyChange.emit({closePopovers:!0,toggle:!0})}),(e=>{this.classifySwitchNode.checked=!this.classifySwitchNode.checked,this.arcgisSmartMappingClassifyError.emit(e)}))}handleClassesChange(){const{smartMappingState:e}=this,t=(0,n.k)(e),i=Math.min(Math.max(Number.parseInt(this.classesNode.value),1),10)||5;`${i}`!==this.classesNode.value&&(this.classesNode.value=`${i}`);const s="color"===t?l.a:d.n,a=(0,n.g)(e).authoringInfo.classificationMethod;(0,l.r)(s(e,{numClasses:i}),this.flowItemNode).then((t=>{"manual"===a&&(t.renderer.authoringInfo.classificationMethod="manual"),(0,n.t)(e,t.renderer),this.arcgisSmartMappingClassifyChange.emit({classesChange:!0}),this.classesNode.value=`${t.renderer.classBreakInfos.length}`}),(t=>{const i=(0,n.g)(e);this.classesNode.value=`${i.classBreakInfos.length}`,this.arcgisSmartMappingClassifyError.emit(t)}))}handleStdDevChange(e){const{smartMappingState:t}=this,i=e.currentTarget,a="color"===(0,n.k)(t)?l.a:d.n;(0,l.r)(a(t,{standardDeviationInterval:Number.parseFloat(i.value)}),this.flowItemNode).then((e=>{(0,n.t)(t,e.renderer),(0,s.f)(this.el),this.arcgisSmartMappingClassifyChange.emit()}),(e=>{const i=(0,n.g)(t).authoringInfo.standardDeviationInterval||1;this.stdDevSelectNode.value=`${i}`,(0,s.f)(this.el),this.arcgisSmartMappingClassifyError.emit(e)}))}handleRoundClassesChange(e){const{smartMappingState:t}=this,i=(0,n.g)(t).authoringInfo,s=e.currentTarget;"select"!==s.value&&((0,p.u)(t,Number.parseFloat(s.value)),i.classificationMethod="manual",(0,n.t)(t),this.arcgisSmartMappingClassifyChange.emit({closePopovers:!0}))}handleLabelEdit(e,t){const i=this.inputNodes[e];i.classList.remove("hidden"),i.setFocus(),t.target.classList.add("hidden")}handleValueSymbolClick(e){const{smartMappingState:t}=this;(0,n.J)();const{strings:i}=this.smartMappingState,a=(0,m.b)(t,{referenceElement:this.flowItemNode,heading:i.styler.symbolStyle});a.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,m.r)(a),setTimeout((()=>{this.symbolNodes[e].focus(),this.popoverNode=void 0,this.symbolNodes[e].classList.remove("selected")}),300)})),a.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,m.r)(a),setTimeout((()=>{this.popoverNode=void 0,this.symbolNodes[e].classList.remove("selected")}),300)})),this.smartMappingState.classedSymbolSelectedIdx=e,(0,m.i)(t,{popoverNode:a,onChange:()=>{(0,n.t)(t),(0,s.f)(this.el),this.arcgisSmartMappingClassifyChange.emit({symbolChange:!0})}}),this.popoverNode=a,this.symbolNodes[e].classList.add("selected")}handleValueTextChange(e,t){const{smartMappingState:i}=this,a=t.currentTarget,o=(0,n.g)(i);if(o.classBreakInfos[e].label=a.value,this.labelNodes[e].textContent=a.value,this.inputNodes[e].value=a.value,""===a.value){const t=o.classBreakInfos[e],i=e>0?"> ":"";t.label=`${i} ${t.minValue.toLocaleString()} - ${t.maxValue.toLocaleString()}`,this.labelNodes[e].textContent=t.label,this.inputNodes[e].value=t.label}(0,n.t)(i),(0,s.f)(this.el)}get el(){return(0,s.a)(this)}};z.style=".classify-heading{padding-top:16px}.classify-block-section{border-top:1px solid #e0e0e0;overflow-wrap:anywhere}.block-section-padding{padding-top:6px}.disable-classify{opacity:var(--calcite-opacity-disabled)}.symbol{margin-left:2px;margin-right:2px}.symbol-is-white{background-color:#f0f0f0}.hidden{display:none}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.label,.symbol-container{padding-top:5px;padding-bottom:5px}.selected{outline:1px solid var(--calcite-color-brand)}.method-button-content{padding-top:8px}";const x=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingDefaultSymbolChange=(0,s.c)(this,"arcgisSmartMappingDefaultSymbolChange",7),this.arcgisSmartMappingDefaultSymbolBeforeToggle=(0,s.c)(this,"arcgisSmartMappingDefaultSymbolBeforeToggle",7),this.manager=(0,h.u)(this),this.lastSettings={},this.smartMappingState=(0,r.u)()}async done(){this.lastSettings={},this.blockSectionNode&&(this.blockSectionNode.open=!1,this.blockSectionNode.classList.remove("open"))}componentWillLoad(){this.flowItemNode=(0,a.f)(this.el,"calcite-flow-item")}disconnectedCallback(){clearTimeout(this.labelChangeHandle)}render(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e),a=(0,n.k)(e);let o=t.defaultSymbol.showDefaultSymbol;if("color"===a){(0,n.b)(i,"color")||(o=t.defaultSymbol.showDefaultSymbolClassed)}else if("size"===a){(0,n.b)(i,"size")||(o=t.defaultSymbol.showDefaultSymbolClassed)}const l=i.defaultSymbol;return(0,s.h)("calcite-block-section",{key:"bb31f763821844155ab94f9fd261288938d0a318",text:o,open:!!l,"toggle-display":"switch",onCalciteBlockSectionToggle:e=>{this.arcgisSmartMappingDefaultSymbolBeforeToggle.emit(),this.handleDefaultSymbolToggle(e)},ref:e=>this.blockSectionNode=e},this.renderDefaultSymbolContent())}renderDefaultSymbolContent(){const{smartMappingState:e}=this,t=(0,n.g)(e);let i;return i=t.defaultSymbol?t.defaultSymbol:this.lastSettings.defaultSymbol?this.lastSettings.defaultSymbol:(0,n.f)(e),i?(0,s.h)("div",{class:"symbol-button-content block-section-padding"},(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:i,type:"default",popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{this.lastSettings.defaultSymbol=t.defaultSymbol,(0,s.f)(this.el)}}),this.renderLabel()):(0,s.h)(s.F,null)}renderLabel(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e).defaultLabel||t.defaultSymbol.other;return(0,s.h)("calcite-label",null,t.defaultSymbol.label,(0,s.h)("calcite-input",{type:"text",value:i,onCalciteInputChange:()=>{clearTimeout(this.labelChangeHandle),this.defaultLabelNode.value?this.handleLabelChange():this.labelChangeHandle=setTimeout((()=>this.handleLabelChange()),3e3)},onFocusout:e=>{e.preventDefault(),e.stopPropagation(),this.handleLabelChange()},onKeyUp:()=>{clearTimeout(this.labelChangeHandle),this.defaultLabelNode.value?this.handleLabelChange():this.labelChangeHandle=setTimeout((()=>this.handleLabelChange()),3e3)},ref:e=>this.defaultLabelNode=e}))}handleDefaultSymbolToggle(e){const{smartMappingState:t}=this,{strings:i}=t,s=(0,n.g)(t);if(e.currentTarget.open)if(this.blockSectionNode.classList.add("open"),this.lastSettings.defaultSymbol)s.defaultSymbol=this.lastSettings.defaultSymbol,s.defaultLabel=this.lastSettings.defaultLabel||i.defaultSymbol.other;else{const e=(0,n.f)(t);s.defaultSymbol=e,s.defaultLabel=s.defaultLabel||i.defaultSymbol.other,this.lastSettings.defaultSymbol=s.defaultSymbol,this.lastSettings.defaultLabel=s.defaultLabel}else this.blockSectionNode.classList.remove("open"),this.lastSettings.defaultSymbol=s.defaultSymbol,this.lastSettings.defaultLabel=s.defaultLabel,s.defaultSymbol=void 0,s.defaultLabel=void 0;(0,n.t)(t),this.arcgisSmartMappingDefaultSymbolChange.emit()}handleLabelChange(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e);this.defaultLabelNode.value?i.defaultLabel=this.defaultLabelNode.value:(i.defaultLabel=t.defaultSymbol.other,this.defaultLabelNode.value=t.defaultSymbol.other),(0,n.t)(e)}get el(){return(0,s.a)(this)}};x.style=".open{border-bottom:1px solid #e0e0e0}.block-section-padding{padding-top:6px}";const M=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingDividedByChange=(0,s.c)(this,"arcgisSmartMappingDividedByChange",7),this.arcgisSmartMappingDividedByError=(0,s.c)(this,"arcgisSmartMappingDividedByError",7),this.manager=(0,h.u)(this),this.smartMappingState=(0,r.u)(),this.rendererSubtype=void 0,this.normalizationField=void 0,this.fieldPos=void 0}componentWillLoad(){this.flowItemNode=(0,a.f)(this.el,"calcite-flow-item")}render(){const{smartMappingState:e}=this,{fields:t,strings:i}=e,a=(0,n.g)(e),o=(0,n.k)(e),l=a.authoringInfo,r=(0,n.b)(a,this.rendererSubtype),d=(0,n.d)(a,"reference-size"),c=(0,n.d)(a,"spike"),h="relationship"===o||"relationship"===this.rendererSubtype,p=h?0===this.fieldPos?l.field1.field:l.field2.field:r?r.field:a.field,m=h?0===this.fieldPos?l.field1.normalizationField:l.field2.normalizationField:r?r.normalizationField:d?d.normalizationField:c?c.normalizationField:a.normalizationField;return(0,s.h)("arcgis-smart-mapping-attribute-input",{key:"c70405e64143ab0630b3291fb0189232a197d985",fieldList:t.filter((e=>e.layerField.name!==p&&e.simpleFieldType===n.w.NUMBER)),popoverReferenceElement:this.flowItemNode,label:i.transparency.dividedBy,mode:"remove",selectedField:m?{field:m,simpleFieldType:n.w.NUMBER}:void 0,onArcgisSmartMappingAttributeInputChange:e=>{if(e.detail){const t=e.detail;this.normalize(t.field)}else this.normalize(e.detail)}})}normalize(e){const{smartMappingState:t}=this,i=(0,n.g)(t),a=(0,n.k)(t),o=i.authoringInfo,r="univariate-color-size"===o?.type,c="class-breaks-color"===o?.type,h="class-breaks-size"===o?.type,p="relationship"===a||"relationship"===this.rendererSubtype,m=(0,n.d)(i,"reference-size"),g=(0,n.d)(i,"spike");let f;if(c?f=l.a:h?f=d.n:r?f=u.e:"color"===this.rendererSubtype?(f=l.b,["color-age","color-age-size"].includes(a)&&(f=l.c)):"size"===this.rendererSubtype?(f=d.c,["size-age","color-size-age","type-size-age"].includes(a)&&(f=d.j)):p&&(f=u.a),!f)return;const S={};p?0===this.fieldPos?S.normalizationField1=e:S.normalizationField2=e:S.normalizationField=e,(0,l.r)(f(t,S),this.flowItemNode).then((e=>{if(r||c||h||p){if("relationship-size"===a){e.renderer.backgroundFillSymbol=i.backgroundFillSymbol;const t=(0,n.b)(i,"size"),s=(0,n.d)(i,"size");e.renderer.visualVariables=e.renderer.visualVariables||[],e.renderer.visualVariables.push(t),e.renderer.authoringInfo=e.renderer.authoringInfo||{},e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(s)}(0,n.t)(t,e.renderer)}else if("color"===this.rendererSubtype)["color-size","color-age-size","color-size-age"].includes(a)?(this.switchOutVisualVariable(e),(0,n.t)(t)):(0,n.t)(t,e.renderer);else if("size"===this.rendererSubtype)if(["color-size","color-age-size","color-size-age","type-size","type-size-age","relationship-size"].includes(a))m?(0,d.q)(t).then((e=>(0,n.t)(t,e)),(e=>this.arcgisSmartMappingDividedByError.emit(e))):g?(0,d.r)(t).then((e=>(0,n.t)(t,e)),(e=>this.arcgisSmartMappingDividedByError.emit(e))):(this.switchOutVisualVariable(e),(0,n.t)(t));else if(m){const s=(0,n.d)(e.renderer,"reference-size");i.authoringInfo.visualVariables=(0,n.c)(i,"reference-size")||[],i.authoringInfo.visualVariables.push(s),(0,d.q)(t).then((e=>(0,n.t)(t,e)),(e=>this.arcgisSmartMappingDividedByError.emit(e)))}else if(g){const s=(0,n.d)(e.renderer,"spike");i.authoringInfo.visualVariables=(0,n.c)(i,"spike")||[],i.authoringInfo.visualVariables.push(s),(0,d.r)(t).then((e=>(0,n.t)(t,e)),(e=>this.arcgisSmartMappingDividedByError.emit(e)))}else(0,n.t)(t,e.renderer);else(0,n.t)(t);(0,s.f)(this.el),this.arcgisSmartMappingDividedByChange.emit()}),(e=>this.arcgisSmartMappingDividedByError.emit(e)))}switchOutVisualVariable(e){const{smartMappingState:t}=this,i=(0,n.g)(t);i.visualVariables=(0,n.a)(i,this.rendererSubtype)||[];const s=(0,n.b)(e.renderer,this.rendererSubtype);i.visualVariables.push(s),i.authoringInfo.visualVariables=(0,n.c)(i,this.rendererSubtype)||[];const a=(0,n.d)(e.renderer,this.rendererSubtype);a&&i.authoringInfo.visualVariables.push(a),(0,n.aE)(t,i)}get el(){return(0,s.a)(this)}},k=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingInfoPopoverClose=(0,s.c)(this,"arcgisSmartMappingInfoPopoverClose",7),this.arcgisSmartMappingInfoPopoverDisconnected=(0,s.c)(this,"arcgisSmartMappingInfoPopoverDisconnected",7),this.manager=(0,h.u)(this),this.onOpen=()=>{requestAnimationFrame((async()=>await(this.panelNode?.setFocus())))},this.props=void 0,this.referenceElement=void 0,this.open=!1,this.smartMappingState=void 0}async reposition(){await(this.popoverNode?.reposition())}async setFocus(){await(this.panelNode?.setFocus())}async setOpen(e){this.popoverNode&&(this.popoverNode.open=e,e&&(await(this.panelNode?.setFocus()),await this.popoverNode.reposition()))}disconnectedCallback(){this.arcgisSmartMappingInfoPopoverDisconnected.emit()}render(){const{props:e,referenceElement:t,open:i}=this,{title:a,moreInfo:n,helpId:o}=e,{config:l,strings:r}=this.smartMappingState,{helpBase:d,helpMap:c}=l,h=r.tile.info.title.replace("${title}",a);return(0,s.h)(s.H,{key:"eef9dc407b4fafcdedbf6669294829f71bfe2167",class:"js-app-flyout arcgis-smart-mapping-popover"},(0,s.h)("calcite-popover",{key:"df7d303ca13ce451a4c666b5aff42feac025b2cb",open:i,placement:"auto",offsetSkidding:5,label:"",overlayPositioning:"fixed",referenceElement:t,onCalcitePopoverOpen:this.onOpen,ref:e=>this.popoverNode=e},(0,s.h)("calcite-panel",{key:"27deaa13b5b819374d26860ad816328311eb5001",class:"info-panel",heading:h,closable:!0,ref:e=>this.panelNode=e,onCalcitePanelClose:()=>{this.arcgisSmartMappingInfoPopoverClose.emit(),setTimeout((()=>t.parentElement.focus()),300)}},(0,s.h)("div",{key:"0ae686eac552b0dbed500157967e5ca33387135b",class:"info"},(0,s.h)("div",{key:"b04af0b2784e302ee730dc4843c6d10a824c27f4"},n),o&&c?(0,s.h)("div",{class:"info-help"},(0,s.h)("calcite-button",{appearance:"solid",label:r.tile.info.learnMore,class:"info-help-button",slot:"footer",onClick:()=>window.open(`${d}${c[o]}`,"_blank")},r.tile.info.learnMore)):null))))}get el(){return(0,s.a)(this)}};k.style=".info{padding:10px;background-color:white}.info-panel{max-width:320px}.info-help{padding-top:10px;justify-content:flex-end;display:flex}.info-help-button{display:flex;flex-flow:row-reverse}";const w=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingMethodButtonChange=(0,s.c)(this,"arcgisSmartMappingMethodButtonChange",7),this.arcgisSmartMappingMethodButtonBeforeOpen=(0,s.c)(this,"arcgisSmartMappingMethodButtonBeforeOpen",7),this.manager=(0,h.u)(this),this.methodInfos=[],this.smartMappingState=(0,r.u)(),this.open=!1,this.showStdDev=!1,this.showDefinedInterval=!1}async setFocus(){this.buttonNode?.focus()}componentWillLoad(){this.populateMethodInfo(),this.setSelection()}componentWillUpdate(){const{smartMappingState:e}=this,t=(0,n.g)(e).authoringInfo.classificationMethod;this.selectedMethodInfo&&this.selectedMethodInfo.value!==t&&this.setSelection()}render(){const{strings:e}=this.smartMappingState;return(0,s.h)(s.H,{key:"912c75765c2a0968b9f87d75557a5f71bf361595"},(0,s.h)("calcite-label",{key:"82b6359327307271f576ec52ff564d5cb099103c"},e.methodButton.method,(0,s.h)("div",{key:"20a0dfcbf1ae96cd6fe4cefb40c9ed47b2ca20e2",class:"method-button",role:"button",tabindex:"0","aria-haspopup":"true","aria-label":e.methodButton.selectMethod,ref:e=>{e&&(this.buttonNode=e)},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.openMethodDropdown())},onClick:()=>this.openMethodDropdown()},(0,s.h)("div",{key:"85b826ab665ad80b141c4460b6e50077f77eb34c",class:"method-content"},(0,s.h)("div",{key:"5c35cde9315ce1f6398677571ebbb8f80f0bdeec",class:"method-button-text"},(0,s.h)("div",{key:"105be579882c8e60682cceb5dadea652b84fac4f",class:"method-button-title"},this.selectedMethodInfo.title),(0,s.h)("div",{key:"9fdd5f2af98071b843dfa87db3ae41e3d59537eb",class:"method-button-msg"},this.selectedMethodInfo.msg)),(0,s.h)("div",{key:"ff8690ab477409fe9494e28569cd42e92c9672e5"},(0,s.h)("calcite-icon",{key:"d86a8b7e788085b74418b4b7ee844bd977dddbed",scale:"s",icon:"chevron-down"}))))))}setSelection(){const{smartMappingState:e}=this,t=(0,n.g)(e).authoringInfo.classificationMethod;this.selectedMethodInfo=this.methodInfos.find((e=>e.value===t)),this.methodInfos.forEach((e=>{e.selected=e.value===this.selectedMethodInfo.value}))}populateMethodInfo(){const{strings:e}=this.smartMappingState;this.methodInfos.push({value:"natural-breaks",title:e.methodButton.naturalBreaks,msg:e.methodButton.naturalBreaksMsg,iconPath:void 0,selected:!1},{value:"equal-interval",title:e.methodButton.equalInterval,msg:e.methodButton.equalIntervalMsg,iconPath:void 0,selected:!1}),this.showStdDev&&this.methodInfos.push({value:"standard-deviation",title:e.methodButton.standardDeviation,msg:e.methodButton.standardDeviationMsg,iconPath:void 0,selected:!1}),this.methodInfos.push({value:"quantile",title:e.methodButton.quantile,msg:e.methodButton.quantileMsg,iconPath:void 0,selected:!1}),this.showDefinedInterval&&this.methodInfos.push({value:"defined-interval",title:e.methodButton.definedInterval,msg:e.methodButton.definedIntervalMsg,iconPath:void 0,selected:!1}),this.methodInfos.push({value:"manual",title:e.methodButton.manualBreaks,msg:e.methodButton.manualBreaksMsg,iconPath:void 0,selected:!1})}closeDropdown(){this.open=!1,this.dropdownNode&&(this.dropdownNode.parentNode?.removeChild(this.dropdownNode),this.dropdownNode=void 0,this.buttonNode.classList.remove("active"))}openMethodDropdown(){const{smartMappingState:e}=this;if(this.open)this.open=!1;else{this.arcgisSmartMappingMethodButtonBeforeOpen.emit();const t=document.createElement("arcgis-smart-mapping-dropdown");t.smartMappingState=e,t.buttonNode=this.buttonNode,t.infos=this.methodInfos,this.dropdownNode=t,t.addEventListener("arcgisSmartMappingDropdownClose",(e=>{this.closeDropdown(),"Escape"===e.detail&&this.setFocus()})),t.addEventListener("arcgisSmartMappingDropdownChange",(e=>this.setMethod(e.detail))),t.addEventListener("arcgisSmartMappingDropdownDisconnected",(()=>this.closeDropdown())),this.buttonNode.classList.add("active"),document.body.appendChild(t),this.open=!0}}setMethod(e){const{smartMappingState:t}=this,i=(0,n.g)(t).authoringInfo.classificationMethod,s=e.value;if(s===i)return this.closeDropdown(),void setTimeout((()=>{this.setFocus()}),300);for(let e=0;e<this.methodInfos.length;e++)this.methodInfos[e].selected=this.methodInfos[e].value===s;this.selectedMethodInfo=e,this.arcgisSmartMappingMethodButtonChange.emit(this.selectedMethodInfo.value),this.closeDropdown(),setTimeout((()=>{this.setFocus()}),300)}get el(){return(0,s.a)(this)}};w.style=".method-button{display:flex;padding:6px;justify-content:space-between;align-items:center;border-radius:0;cursor:pointer;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);border-color:var(--calcite-color-foreground-3);border-width:2px;border-style:solid;box-shadow:transparent 0px 0px 0px 1px inset}.method-button:active{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}.method-button:focus{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}.method-button.active{outline:1px solid var(--calcite-ui-focus-color, var(--calcite-color-brand))}.method-content{justify-content:space-between;display:flex;align-items:center;width:100%}.method-button-text{display:inline-block;padding:0 10px}.method-button-title{font-weight:bold}.method-button-msg{font-size:80%;line-height:16px}";const I=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsSizeClose",7),this.arcgisSmartMappingPanelsSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsSizeBackClick",7),this.arcgisSmartMappingPanelsSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsSizeError",7),this.arcgisSmartMappingAuthRefSizeVisVarChange=(0,s.c)(this,"arcgisSmartMappingAuthRefSizeVisVarChange",7),this.arcgisSmartMappingPanelsSizeRegenerateRenderer=(0,s.c)(this,"arcgisSmartMappingPanelsSizeRegenerateRenderer",7),this.manager=(0,h.u)(this),this.smartMappingState=(0,r.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsSizeClose.emit("save")},this.handleCancel=()=>{const{originalRenderer:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,n.v)(i,e,t),this.arcgisSmartMappingPanelsSizeClose.emit("cancel")},this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState,i=(0,n.g)(this.smartMappingState);this.originalRenderer=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,u.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")));const e=(0,n.g)(this.smartMappingState);(0,n.d)(e,"reference-size")&&(this.referenceSizeScaleHandle=this.getReferenceSizeScaleHandle())}disconnectedCallback(){this.scaleHandle?.remove(),this.referenceSizeScaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return(0,s.h)(s.H,{key:"7f4d723dff2a35d40d14a5259debd3ec5a1eb364",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"e70ef9ee5f212768d92204839aecabefa88adbd3",heading:i.panels.styleOptions,description:t?void 0:e.title,class:"flow-item",closable:(0,n.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsSizeBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,s.h)(s.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,s.h)(s.F,null)}renderVisualization(){const{visualizationOpen:e,hideTransparency:t,hideRotation:i,smartMappingState:a}=this,{strings:o}=a,l=(0,n.k)(a),r=(0,n.g)(a),d=["size-age","color-size-age","type-size-age"].includes(l),c=["chart-size","predominance-size"].includes(l),h=(0,n.b)(r,"size"),p=(0,n.d)(r,"reference-size"),m=(0,n.d)(r,"spike"),u=h?h.field?(0,n.y)(a,h.field)?.label:h.valueExpressionTitle||o.expression:p?(0,n.y)(a,p.field).label:m?(0,n.y)(a,m.field).label:r.field?(0,n.y)(a,r.field)?.label:r.valueExpressionTitle||o.expression,g=(0,n.y)(a,h?.field||r.field),f=g?.simpleFieldType===n.w.DATE,S="chart-size"===l;return(0,s.h)("calcite-block",{class:"size-block",key:"size-visualization",heading:d?o.panels.size.sizeAgeStyle:f?o.panels.size.sizeStyleDate:S?o.panels.size.sizeStyleChart:o.panels.size.sizeStyle,collapsible:!t||!i,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},(0,s.h)("div",null,d||c?null:(0,s.h)("calcite-label",{class:"attribute-name"},u),this.renderAge(),this.renderTheme(),this.renderDividedBy(),this.renderReferenceSizeButton(),this.renderSpikeSymbolButton(),this.renderSymbol(),this.renderSizeSlider(),this.renderRegenerateStyle(),this.renderSizeRange(),this.renderBackgroundStyle(),this.renderDefaultSymbol(),this.renderShowInLegend(),this.renderClassify()))}renderAge(){const{smartMappingState:e}=this,t=(0,n.k)(e);return["size-age","color-size-age"].includes(t)?(0,s.h)("arcgis-smart-mapping-age",{rendererSubtype:"size",onArcgisSmartMappingAgeChange:()=>{this.sliderNode.updateStatistics()},onArcgisSmartMappingAgeError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail)}):(0,s.h)(s.F,null)}renderTheme(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.b)(t,"size"),a=(0,n.d)(t,"reference-size"),o=(0,n.d)(t,"spike");if(!i&&!a&&!o)return(0,s.h)(s.F,null);const r=(0,n.k)(e);return["chart-size","predominance-size"].includes(r)?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:"size",onArcgisSmartMappingThemeButtonBeforeOpen:()=>(0,n.J)(),onArcgisSmartMappingThemeButtonChange:e=>{const{smartMappingState:t}=this,{layer:r,mapView:c}=t,h=(0,n.k)(t),p=(0,n.S)(a),m="reference-size"===e.detail,u=!p&&m||p&&!m,g=(0,n.S)(o),f="spike"===e.detail,S=!g&&f||g&&!f;let b=d.c;["size-age","color-size-age"].includes(h)?b=d.j:(u||S)&&(b=d.c);const y={theme:e.detail,discardMinMax:!0};if(m&&(y.referenceSizeOptions={symbolStyle:"circle"}),f){const e="color-size"===h?"triangle-solid-fill-open-outline":"triangle-gradient-fill-open";y.spikeOptions={symbolStyle:e}}u&&(y.layer=r,y.mapView=c,y.fieldInfos=[{field:i?i.field:a?a.field:o.field}],y.noReuse=!0),S&&(y.layer=r,y.mapView=c,y.field=i?i.field:o?o.field:a.field,y.noReuse=!0),(0,l.r)(b(t,y),this.flowItemNode).then((async e=>{if(u||S)if(["type-size","relationship-size"].includes(h)){const{modules:i}=this.smartMappingState,s=(0,n.g)(t);s.visualVariables=e.renderer.visualVariables,s.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables,s.uniqueValueInfos.forEach((s=>{const a=(0,n.h)(t,s?.symbol)||new i.EsriColor("gray"),o=e.renderer.classBreakInfos[0].symbol.clone();"cim"===o.type?i.cimSymbolUtils.applyCIMSymbolColor(o,a,{layersToColor:"fill-and-outline"}):(0,n.j)(t,o,a),s.symbol=o})),s.defaultSymbol=void 0,s.defaultLabel=void 0,s.backgroundFillSymbol=void 0,(0,n.t)(t,s)}else if("color-size"===h){const{modules:i,useFeatureReduction:s}=this.smartMappingState,a=(0,n.g)(t),o=(0,n.b)(a,"color"),l=(0,n.d)(a,"color"),{renderer:d}=await i.ColorCreator.createContinuousRenderer({layer:r,view:c,field:o.field,valueExpression:o.valueExpression??void 0,valueExpressionTitle:o.valueExpressionTitle??void 0,normalizationField:o.normalizationField??void 0,theme:l?.theme,colorScheme:(0,n.aD)(t),forBinning:"binning"===r.featureReduction?.type&&s});if(e.renderer.visualVariables.push(o),d.authoringInfo?.visualVariables?.length){const t=(0,n.d)(d,"color");e.renderer.authoringInfo.visualVariables.push(t)}e.renderer.field=o.field,e.renderer.valueExpression=o.valueExpression,e.renderer.valueExpressionTitle=o.valueExpressionTitle,e.renderer.normalizationField=o.normalizationField,(0,n.t)(t,e.renderer)}else(0,n.t)(t,e.renderer);else{const i=(0,n.g)(t);i.visualVariables=(0,n.a)(i,"size")||[],i.visualVariables.push((0,n.b)(e.renderer,"size")),i.authoringInfo.visualVariables=(0,n.c)(i,"size")||[],i.authoringInfo.visualVariables.push((0,n.d)(e.renderer,"size")),(0,n.t)(t)}(0,s.f)(this.el),this.themeButtonNode&&(0,s.f)(this.themeButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode),this.backgroundSymbolNode&&(0,s.f)(this.backgroundSymbolNode),!p&&m&&this.defaultSymbolNode.done()}),(e=>{(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingPanelsSizeError.emit(e)}))}})}renderDividedBy(){const{smartMappingState:e}=this,{fields:t}=e,i=(0,n.g)(e),a=(0,n.k)(e);if(["size-age","color-size-age"].includes(a))return(0,s.h)(s.F,null);if((0,n.N)(e,t).number<2)return(0,s.h)(s.F,null);const o=(0,n.b)(i,"size");if(o){const t=(0,n.y)(e,o.field),i={field:o.field,expression:o.valueExpression,expressionTitle:o.valueExpressionTitle,simpleFieldType:t?t.simpleFieldType:n.w.NUMBER};if(i.expression||i.simpleFieldType!==n.w.NUMBER)return(0,s.h)(s.F,null)}else if(i.valueExpression)return(0,s.h)(s.F,null);return(0,s.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"size",normalizationField:(o?o.normalizationField:i.normalizationField)??void 0,onArcgisSmartMappingDividedByChange:()=>{(0,s.f)(this.el),(0,s.f)(this.sliderNode),this.sliderNode.updateStatistics(),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode),this.classifyNode&&(0,s.f)(this.classifyNode)},onArcgisSmartMappingDividedByError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail)})}renderReferenceSizeButton(){const{smartMappingState:e}=this,t=(0,n.g)(e);return(0,n.d)(t,"reference-size")?(0,s.h)("arcgis-smart-mapping-symbol-pair-button",{symbolType:"reference-size",onArcgisSmartMappingSymbolPairButtonBeforeOpen:()=>(0,n.J)(),onArcgisSmartMappingSymbolPairButtonChange:()=>{(0,s.f)(this.el),(0,s.f)(this.referenceSizeSymbolPairButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode)},onArcgisSmartMappingSymbolPairButtonError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail),ref:e=>{e&&(this.referenceSizeSymbolPairButtonNode=e)}}):(0,s.h)(s.F,null)}renderSpikeSymbolButton(){const{smartMappingState:e}=this,t=(0,n.g)(e);return(0,n.d)(t,"spike")?(0,s.h)("arcgis-smart-mapping-symbol-pair-button",{symbolType:"spike",onArcgisSmartMappingSymbolPairButtonBeforeOpen:()=>(0,n.J)(),onArcgisSmartMappingSymbolPairButtonChange:()=>{(0,s.f)(this.el),(0,s.f)(this.spikeSymbolPairButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode)},onArcgisSmartMappingSymbolPairButtonError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail),ref:e=>{e&&(this.spikeSymbolPairButtonNode=e)}}):(0,s.h)(s.F,null)}renderSymbol(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.k)(e),a=(0,n.d)(t,"reference-size"),o=(0,n.d)(t,"spike");if("pie-chart"===t.type||["type-size","color-size","relationship-size"].includes(i)&&(a||o))return(0,s.h)(s.F,null);const l=this.getSymbol();return(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:l,type:"size",isReferenceSize:(0,n.S)(a),ref:e=>{e&&(this.symbolButtonNode=e)},onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode),this.classifyNode&&(0,s.f)(this.classifyNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderSizeSlider(){return(0,s.h)("arcgis-smart-mapping-size-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingSizeSliderChange:()=>{(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode),this.classifyNode&&(0,s.f)(this.classifyNode)},onArcgisSmartMappingSizeSliderError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail)})}renderRegenerateStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return t?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-regenerate-style",{rendererSubtype:"size",onArcgisRendererRegenerate:()=>{(0,s.f)(this.el),this.sliderNode&&((0,s.f)(this.sliderNode),this.sliderNode.updateStatistics()),this.classifyNode&&(0,s.f)(this.classifyNode),this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode),this.arcgisSmartMappingPanelsSizeRegenerateRenderer.emit()}})}renderSizeRange(){return(0,s.h)("arcgis-smart-mapping-size-range-slider",{onArcgisSmartMappingSizeRangeSliderError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail),ref:e=>{e&&(this.sizeRangeNode=e)}})}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e,i=(0,n.k)(e);return t&&["predominance-size","type-size","relationship-size"].includes(i)?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-background-symbol",{ref:e=>{e&&(this.backgroundSymbolNode=e)}})}renderDefaultSymbol(){const{smartMappingState:e}=this,t=(0,n.k)(e);return["chart","chart-size"].includes(t)?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-default-symbol",{ref:e=>{e&&(this.defaultSymbolNode=e)},onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,n.J)(),onArcgisSmartMappingDefaultSymbolChange:()=>{this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode)}})}renderShowInLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e),a=(0,n.b)(i,"size");if(!a)return(0,s.h)(s.F,null);const o=a.legendOptions,l=!o||!1!==o.showLegend;return(0,s.h)("calcite-label",{layout:"inline-space-between",class:"legend-toggle-padding"},t.panels.size.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:l,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderClassify(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.k)(e),a=this.getFieldInfo().simpleFieldType===n.w.DATE,o=["size-age","color-size-age","type-size-age"].includes(i),l=(0,n.d)(t,"reference-size"),r=(0,n.d)(t,"spike");return"size"!==i||a||o||l||r?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-classify",{ref:e=>this.classifyNode=e,onArcgisSmartMappingClassifyChange:e=>{const t=e.detail;(t?.closePopovers||t?.classesChange)&&(0,n.J)(),(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode),(t?.toggle||t?.classesChange||!t?.symbolChange&&!t?.closePopovers)&&(this.sizeRangeNode&&(0,s.f)(this.sizeRangeNode),this.sliderNode.updateStatistics()),this.classifyNode&&(0,s.f)(this.classifyNode),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode),this.defaultSymbolNode&&(0,s.f)(this.defaultSymbolNode),this.rotationNode&&(0,s.f)(this.rotationNode)},onArcgisSmartMappingClassifyError:e=>this.arcgisSmartMappingPanelsSizeError.emit(e.detail)})}renderTransparency(){const{hideTransparency:e,smartMappingState:t}=this;if(e)return(0,s.h)(s.F,null);const i=(0,n.g)(t),a=(0,n.b)(i,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!a,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsSizeError.emit(e)})}renderRotation(){const{hideRotation:e,smartMappingState:t}=this;if(e)return(0,s.h)(s.F,null);const i=(0,n.g)(t);if((0,n.d)(i,"spike"))return(0,s.h)(s.F,null);const a=(0,n.b)(i,"opacity"),o=(0,n.b)(i,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!a&&!!o,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsSizeError.emit(e)})}getSymbol(){const{smartMappingState:e}=this,{modules:t}=e,i=((0,n.g)(e).type,(0,n.g)(e)),s="class-breaks"===(0,n.g)(e).type?i.classBreakInfos:i.uniqueValueInfos,a=(0,n.k)(e);let o;return["color-size","color-age-size","color-size-age","type-size","type-size-age","predominance-size","relationship-size"].includes(a)?(o=s.length?s[0].symbol.clone():(0,n.f)(e,a),(0,n.j)(e,o,new t.EsriColor({r:149,g:149,b:149,a:1}))):o=s.length?s[s.length-1].symbol.clone():(0,n.f)(e,a),o}handleIncludeInLegendToggle(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.b)(t,"size"),s=i.legendOptions;s&&!1===s.showLegend?s.title?s.showLegend=!0:i.legendOptions=void 0:(i.legendOptions=s||{},i.legendOptions.showLegend=!1),(0,n.t)(e)}getFieldInfo(){const{smartMappingState:e}=this,t=(0,n.k)(e),i=(0,n.r)(e);return["color-size","color-age-size","color-size-age","type-size","type-size-age"].includes(t)&&i.length>1?i[1]:"relationship-size"===t?i[2]:i[0]}getReferenceSizeScaleHandle(){const{smartMappingState:e}=this,{mapView:t}=e;let i=t.scale;return t.watch("scale",(0,c.d)((t=>{const s=(0,n.g)(e),a=(0,n.d)(s,"reference-size"),o=i/t;i=t,a?.referenceSizeScale&&(a.referenceSizeScale=t,a.sizeStops.forEach((e=>e.size*=o)),this.arcgisSmartMappingAuthRefSizeVisVarChange.emit(o))}),300))}get el(){return(0,s.a)(this)}};I.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.size-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const N=class{constructor(e){(0,s.r)(this,e),this.arcgisRendererRegenerate=(0,s.c)(this,"arcgisRendererRegenerate",7),this.manager=(0,h.u)(this),this.smartMappingState=(0,r.u)(),this.rendererSubtype=void 0}render(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("div",{key:"eef5fcd92296bfd96f506e95324a174b1e6d29ce",class:"wrapper"},(0,s.h)("calcite-label",{key:"9882be5bf099aea4c2e562ce7577850b7c22164f",class:"label",layout:"inline"},t.regenerate.generateStyleRange,(0,s.h)("arcgis-smart-mapping-action",{key:"120e8d7e586c2da08c86da1e752c45056c4aef14",hideOutline:!0,text:t.regenerate.regenerateTooltip,icon:"information"})),(0,s.h)("div",{key:"0b2855c0ca97ba5c86b5f2d971861b2021a10b90",class:"regenerate-container"},(0,s.h)("calcite-combobox",{key:"2022a56ebc77389fc99a9756d4b139dedaa961f4",class:"combobox",label:t.regenerate.styleRange,clearDisabled:!0,placeholder:t.regenerate.styleRange,selectionMode:"single-persist",ref:e=>this.comboboxNode=e},(0,s.h)("calcite-combobox-item",{key:"2978e22ec30528e9597186c46fe9a3bd46774c49",selected:!0,value:"whole-layer",heading:t.regenerate.wholeLayer}),(0,s.h)("calcite-combobox-item",{key:"9f98390df75e6a8a4f6eec63e9c0a5e6dbfbcd29",value:"current-extent",heading:t.regenerate.currentExtent})),(0,s.h)("calcite-button",{key:"c6007542f47a80859c0463397aa69465509029be",class:"button",iconStart:"refresh",kind:"neutral",appearance:"outline",onClick:()=>{this.regenerateButtonNode.disabled=!0,this.regenerateRenderer()},ref:e=>this.regenerateButtonNode=e})))}async regenerateRenderer(){const{smartMappingState:e,rendererSubtype:t}=this,{modules:i,layer:s,mapView:a,useFeatureReduction:o}=e,l=(0,n.g)(e).clone();let r=!1;"manual"===l.authoringInfo?.classificationMethod&&(r=!0,l.authoringInfo.classificationMethod="natural-breaks");const d=!o&&"current-extent"===this.comboboxNode.value,c=t?"color"===t?["color-variable"]:"size"===t?["size-variable"]:"relationship"===t?["class-breaks"]:[]:["color-variable","size-variable","class-breaks"];try{const t=await i.rendererUtils.regenerateRenderer({layer:s,view:a,renderer:l,...d&&{filter:{geometry:a.extent,spatialRelationship:"intersects"}},forBinning:o,includedParts:c});r&&(t.authoringInfo.classificationMethod="manual"),(0,n.t)(e,t),this.arcgisRendererRegenerate.emit()}catch(e){console.error("Error regenerating renderer:",e)}this.regenerateButtonNode.disabled=!1}get el(){return(0,s.a)(this)}};N.style=".wrapper {\n  margin-bottom: var(--calcite-spacing-sm);\n}\n\n.label {\n  --calcite-label-margin-bottom: var(--calcite-spacing-xxs);\n}\n\n.regenerate-container {\n  width: 100%;\n  display: flex;\n}\n\n.combobox {\n  width: calc(100% - 32px - var(--calcite-spacing-xs));\n}\n\n.button {\n  margin-left: var(--calcite-spacing-xs);\n}\n\n:dir(rtl) {\n  .button {\n    margin-left: 0;\n    margin-right: var(--calcite-spacing-xs);\n  }\n}\n";const C=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingRotationError=(0,s.c)(this,"arcgisSmartMappingRotationError",7),this.manager=(0,h.u)(this),this.smartMappingState=(0,r.u)(),this.open=!1,this.isLoading=!1}componentWillLoad(){const e=(0,n.b)((0,n.g)(this.smartMappingState),"rotation");this.isBlockOpen=this.open||!!e,this.flowItemNode=(0,a.f)(this.el,"calcite-flow-item")}render(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:i,strings:a,supportsArcade:o}=e,l="geo-rss"===t.type;return i&&!o||(0,n.H)(e)||(0,n.e)(e)&&"size"!==(0,n.k)(e)||!(0,n.aN)(e)||l?(0,s.h)(s.F,null):(0,s.h)(s.H,null,(0,s.h)("calcite-block",{class:"rotation-block",heading:a.rotation.rotationByAttribute,collapsible:!0,open:this.isBlockOpen,loading:this.isLoading,ref:e=>this.blockNode=e,onCalciteBlockOpen:()=>{this.isBlockOpen||(this.isBlockOpen=!0,(0,n.aQ)(this.blockNode))},onCalciteBlockClose:()=>this.isBlockOpen=!1},(0,s.h)("div",null,this.renderRotationToggle())))}renderLoading(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"block-content-loading"},(0,s.h)("calcite-loader",{label:e.loading}))}renderRotationToggle(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.b)((0,n.g)(e),"rotation");return(0,s.h)("calcite-block-section",{text:t.rotation.rotationLabel,class:"toggle-button",toggleDisplay:"switch",open:!!i,onCalciteBlockSectionToggle:()=>this.handleToggle()},(0,s.h)("div",{class:"block-section-padding"},this.isLoading?this.renderLoading():i?this.renderRotationContent():this.renderLoading()))}renderRotationContent(){return(0,s.h)("div",null,this.renderRotationAttribute(),this.renderRotationType())}renderRotationAttribute(){const{smartMappingState:e}=this,{fields:t,strings:i}=e,a=(0,n.b)((0,n.g)(e),"rotation"),o={field:a.field,expression:a.valueExpression,expressionTitle:a.valueExpressionTitle,simpleFieldType:n.w.NUMBER};return(0,s.h)("arcgis-smart-mapping-attribute-input",{fieldList:t.filter((e=>e.simpleFieldType===n.w.NUMBER)),selectedField:o,label:i.rotation.field,mode:"expression",popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingAttributeInputChange:e=>{if(e.detail){const t=e.detail;this.setRotationVisualVariable(t)}},onArcgisSmartMappingAttributeInputError:e=>this.arcgisSmartMappingRotationError.emit(e.detail)})}renderRotationType(){const{smartMappingState:e}=this,{strings:t}=e;let i=!1;t.rotation.rotateZeroDegrees.startsWith("\xb0")&&(i=!0);const a=(0,n.g)(e),o=(0,n.b)(a,"rotation");return(0,s.h)("div",{class:"rotation-type block-content-padding"},(0,s.h)("calcite-radio-button-group",{class:"rotation-type-selection",name:"rotationType",onCalciteRadioButtonGroupChange:e=>this.handleTypeChange(e.target.selectedItem.value)},(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{checked:"geographic"===o.rotationType,value:"geographic"}),t.rotation.geographic),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{checked:"arithmetic"===o.rotationType,value:"arithmetic"}),t.rotation.arithmetic)),(0,s.h)("div",{class:"rotation-type-display","aria-hidden":"true"},"arithmetic"===o.rotationType?i?this.renderRotationSVG_Ari_leading():this.renderRotationSVG_Ari():i?this.renderRotationSVG_Geo_leading():this.renderRotationSVG_Geo(),(0,s.h)("div",{class:"rotation-type-symbol",ref:e=>{e&&this.createSymbol(e)}})))}renderRotationSVG_Geo(){return(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 80 80"},(0,s.h)("defs",null,(0,s.h)("style",null,".cls-1,.cls-4","{fill:none;}",".cls-2","{fill:#f3f3f3;}",".cls-3","{fill:#ccc;}",".cls-4","{stroke:#353535;stroke-miterlimit:10;}",".cls-5","{fill:#353535;}",".cls-6","{fill:#595959;}")),(0,s.h)("rect",{class:"cls-1",width:"80",height:"80"}),(0,s.h)("circle",{class:"cls-2",cx:"30.5",cy:"46.5",r:"30.5"}),(0,s.h)("rect",{class:"cls-3",x:"30",y:"16",width:"1",height:"6"}),(0,s.h)("rect",{class:"cls-3",x:"30",y:"71",width:"1",height:"6"}),(0,s.h)("rect",{class:"cls-3",x:"57.5",y:"43.5",width:"1",height:"6",transform:"translate(11.5 104.5) rotate(-90)"}),(0,s.h)("rect",{class:"cls-3",x:"2.5",y:"43.5",width:"1",height:"6",transform:"translate(-43.5 49.5) rotate(-90)"}),(0,s.h)("path",{class:"cls-4",d:"M35.8,16.46A30.51,30.51,0,0,1,60.39,40.4"}),(0,s.h)("polygon",{class:"cls-5",points:"57.06 38.77 57.46 38.2 60.31 40.15 62.05 37.16 62.65 37.51 60.53 41.15 57.06 38.77"}),(0,s.h)("path",{class:"cls-6",d:"M29.12,4.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19,7.77,7.77,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19A2.34,2.34,0,0,1,28,4.56,1.85,1.85,0,0,1,29.12,4.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,27.52,8a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,2,2,0,0,0,.49.74,1.15,1.15,0,0,0,.78.28,1.12,1.12,0,0,0,.77-.28,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,30.72,8a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.08,1.08,0,0,0,29.12,4.85Z"}),(0,s.h)("path",{class:"cls-6",d:"M35.52,5.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0A1.38,1.38,0,0,1,33,6.86a1.21,1.21,0,0,1-.31-.48,1.51,1.51,0,0,1,0-1.18A1.21,1.21,0,0,1,33,4.72a1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.21,1.21,0,0,1,.31.48A1.45,1.45,0,0,1,35.52,5.79Zm-.49,0a1.09,1.09,0,0,0-.07-.4,1.16,1.16,0,0,0-.22-.31.87.87,0,0,0-.32-.22,1,1,0,0,0-.4-.08,1,1,0,0,0-.39.08.87.87,0,0,0-.32.22,1.16,1.16,0,0,0-.22.31,1.18,1.18,0,0,0,0,.8,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22A1,1,0,0,0,34,6.8a1,1,0,0,0,.4-.08.87.87,0,0,0,.32-.22A1,1,0,0,0,35,6.19,1.09,1.09,0,0,0,35,5.79Z"}),(0,s.h)("path",{class:"cls-6",d:"M66.94,46.41l0,0a1.33,1.33,0,0,1-.46.19,2.2,2.2,0,0,1-.56.07,2.18,2.18,0,0,1-.85-.16,2.12,2.12,0,0,1-.68-.45,1.9,1.9,0,0,1-.46-.68,2.38,2.38,0,0,1-.16-.89,2.27,2.27,0,0,1,.17-.91,1.9,1.9,0,0,1,.48-.7,2.45,2.45,0,0,1,.73-.46,2.7,2.7,0,0,1,1.83,0,2.33,2.33,0,0,1,.73.46,1.9,1.9,0,0,1,.48.7,2.27,2.27,0,0,1,.18.91,2.61,2.61,0,0,1-.2,1,6.24,6.24,0,0,1-.44.9L65.77,49.5h-.83Zm.69-1.94a1.69,1.69,0,0,0-.12-.64,1.62,1.62,0,0,0-.32-.52,1.92,1.92,0,0,0-.5-.34,1.79,1.79,0,0,0-1.29,0,1.77,1.77,0,0,0-.5.34,1.82,1.82,0,0,0-.32.52,1.77,1.77,0,0,0,0,1.28,1.49,1.49,0,0,0,.31.51,1.45,1.45,0,0,0,.5.33,1.75,1.75,0,0,0,.65.12A1.73,1.73,0,0,0,66.7,46a1.45,1.45,0,0,0,.5-.33,1.69,1.69,0,0,0,.32-.51A1.91,1.91,0,0,0,67.63,44.47Z"}),(0,s.h)("path",{class:"cls-6",d:"M71.82,42.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86A4.16,4.16,0,0,1,74,44.61a8.46,8.46,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,8.46,8.46,0,0,1,0-2.72A4.16,4.16,0,0,1,70,43.42a2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,71.82,42.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,4.31,4.31,0,0,0-.26,1A10.3,10.3,0,0,0,70.22,46a10.11,10.11,0,0,0,.07,1.08,4,4,0,0,0,.26,1,2,2,0,0,0,.49.74,1.21,1.21,0,0,0,1.55,0,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,73.42,46a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,71.82,42.85Z"}),(0,s.h)("path",{class:"cls-6",d:"M78.21,43.79a1.44,1.44,0,0,1-.11.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.52,1.52,0,0,1-.48-.31,1.47,1.47,0,0,1-.31-.48,1.64,1.64,0,0,1,0-1.18,1.47,1.47,0,0,1,.31-.48,1.52,1.52,0,0,1,.48-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.21,1.21,0,0,1,.31.48A1.44,1.44,0,0,1,78.21,43.79Zm-.48,0a.92.92,0,0,0-.08-.4,1,1,0,0,0-.21-.31.87.87,0,0,0-.32-.22,1.06,1.06,0,0,0-.4-.08,1,1,0,0,0-.39.08.87.87,0,0,0-.32.22,1.16,1.16,0,0,0-.22.31,1,1,0,0,0,0,.8,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.39.08,1.06,1.06,0,0,0,.4-.08.87.87,0,0,0,.32-.22.85.85,0,0,0,.21-.31A.92.92,0,0,0,77.73,43.79Z"}))}renderRotationSVG_Ari(){return(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 80 80"},(0,s.h)("defs",null,(0,s.h)("style",null,".cls-1,.cls-4","{fill:none;}",".cls-2","{fill:#f3f3f3;}",".cls-3","{fill:#ccc;}",".cls-4","{stroke:#353535;stroke-miterlimit:10;}",".cls-5","{fill:#353535;}",".cls-6","{fill:#595959;}")),(0,s.h)("rect",{class:"cls-1",width:"80",height:"80"}),(0,s.h)("circle",{class:"cls-2",cx:"30.5",cy:"46.5",r:"30.5"}),(0,s.h)("rect",{class:"cls-3",x:"30",y:"16",width:"1",height:"6"}),(0,s.h)("rect",{class:"cls-3",x:"30",y:"71",width:"1",height:"6"}),(0,s.h)("rect",{class:"cls-3",x:"57.5",y:"43.5",width:"1",height:"6",transform:"translate(11.5 104.5) rotate(-90)"}),(0,s.h)("rect",{class:"cls-3",x:"2.5",y:"43.5",width:"1",height:"6",transform:"translate(-43.5 49.5) rotate(-90)"}),(0,s.h)("path",{class:"cls-4",d:"M36.54,16.6a30.55,30.55,0,0,1,24,24.55"}),(0,s.h)("polygon",{class:"cls-5",points:"38.19 19.92 38.76 19.52 36.8 16.69 39.77 14.94 39.42 14.33 35.8 16.46 38.19 19.92"}),(0,s.h)("path",{class:"cls-6",d:"M27.14,8.41l0,0a1.35,1.35,0,0,1-.45.19,2.28,2.28,0,0,1-.57.07,2.18,2.18,0,0,1-.85-.16A2.12,2.12,0,0,1,24.57,8a1.94,1.94,0,0,1-.46-.69A2.3,2.3,0,0,1,24,6.47a2.27,2.27,0,0,1,.17-.91,1.9,1.9,0,0,1,.48-.7,2.32,2.32,0,0,1,1.65-.62,2.51,2.51,0,0,1,.92.16,2.59,2.59,0,0,1,.73.46,2.18,2.18,0,0,1,.48.7,2.46,2.46,0,0,1,.17.91,2.61,2.61,0,0,1-.2,1,6.24,6.24,0,0,1-.44.9L26,11.5h-.83Zm.69-1.94a1.69,1.69,0,0,0-.12-.64,1.62,1.62,0,0,0-.32-.52,1.56,1.56,0,0,0-.5-.33A1.67,1.67,0,0,0,25.6,5a1.67,1.67,0,0,0-.5.33,1.82,1.82,0,0,0-.32.52,1.69,1.69,0,0,0-.11.64,1.61,1.61,0,0,0,.11.63,1.35,1.35,0,0,0,.81.85,1.76,1.76,0,0,0,.66.12A1.71,1.71,0,0,0,26.9,8a1.45,1.45,0,0,0,.5-.33,1.62,1.62,0,0,0,.32-.52A1.81,1.81,0,0,0,27.83,6.47Z"}),(0,s.h)("path",{class:"cls-6",d:"M32,4.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19A7.72,7.72,0,0,1,34.33,8a7.72,7.72,0,0,1-.11,1.36,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19,2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,32,4.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,30.42,8a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,1.92,1.92,0,0,0,.49.73,1.18,1.18,0,0,0,1.55,0,1.92,1.92,0,0,0,.49-.73,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,33.62,8a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,32,4.85Z"}),(0,s.h)("path",{class:"cls-6",d:"M38.42,5.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.52,1.52,0,0,1-.48-.31,1.47,1.47,0,0,1-.31-.48,1.63,1.63,0,0,1-.11-.59,1.73,1.73,0,0,1,.11-.6,1.38,1.38,0,0,1,.79-.78,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.25,1.25,0,0,1,.31.47A1.53,1.53,0,0,1,38.42,5.79Zm-.49,0a.85.85,0,0,0-.08-.39.89.89,0,0,0-.21-.32.87.87,0,0,0-.32-.22,1.06,1.06,0,0,0-.4-.08,1,1,0,0,0-.39.08.87.87,0,0,0-.32.22A1.07,1.07,0,0,0,36,5.4a1,1,0,0,0-.07.39,1.09,1.09,0,0,0,.07.4,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.39.08,1.06,1.06,0,0,0,.4-.08.87.87,0,0,0,.32-.22.85.85,0,0,0,.21-.31A.92.92,0,0,0,37.93,5.79Z"}),(0,s.h)("path",{class:"cls-6",d:"M67,42.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19,8.46,8.46,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19,2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,67,42.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,65.42,46a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,2,2,0,0,0,.49.74,1.21,1.21,0,0,0,1.55,0,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,68.62,46a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,67,42.85Z"}),(0,s.h)("path",{class:"cls-6",d:"M73.42,43.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.52,1.52,0,0,1-.48-.31,1.47,1.47,0,0,1-.31-.48,1.63,1.63,0,0,1-.11-.59,1.73,1.73,0,0,1,.11-.6,1.38,1.38,0,0,1,.79-.78,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.25,1.25,0,0,1,.31.47A1.53,1.53,0,0,1,73.42,43.79Zm-.49,0a.85.85,0,0,0-.08-.39.89.89,0,0,0-.21-.32.87.87,0,0,0-.32-.22,1.06,1.06,0,0,0-.4-.08,1,1,0,0,0-.39.08.87.87,0,0,0-.32.22,1.07,1.07,0,0,0-.22.32,1,1,0,0,0-.07.39,1.09,1.09,0,0,0,.07.4,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.39.08,1.06,1.06,0,0,0,.4-.08.87.87,0,0,0,.32-.22.85.85,0,0,0,.21-.31A.92.92,0,0,0,72.93,43.79Z"}))}renderRotationSVG_Geo_leading(){return(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 80 80"},(0,s.h)("defs",null,(0,s.h)("style",null,".cls-1,.cls-4","{fill:none;}",".cls-2","{fill:#f3f3f3;}",".cls-3","{fill:#ccc;}",".cls-4","{stroke:#353535;stroke-miterlimit:10;}",".cls-5","{fill:#353535;}",".cls-6","{fill:#595959;}")),(0,s.h)("rect",{class:"cls-1",width:"80",height:"80"}),(0,s.h)("circle",{class:"cls-2",cx:"30.5",cy:"46.5",r:"30.5"}),(0,s.h)("rect",{class:"cls-3",x:"30",y:"16",width:"1",height:"6"}),(0,s.h)("rect",{class:"cls-3",x:"30",y:"71",width:"1",height:"6"}),(0,s.h)("rect",{class:"cls-3",x:"57.5",y:"43.5",width:"1",height:"6",transform:"translate(11.5 104.5) rotate(-90)"}),(0,s.h)("rect",{class:"cls-3",x:"2.5",y:"43.5",width:"1",height:"6",transform:"translate(-43.5 49.5) rotate(-90)"}),(0,s.h)("path",{class:"cls-4",d:"M35.8,16.46A30.51,30.51,0,0,1,60.39,40.4"}),(0,s.h)("polygon",{class:"cls-5",points:"57.06 38.77 57.46 38.2 60.31 40.15 62.05 37.16 62.65 37.51 60.53 41.15 57.06 38.77"}),(0,s.h)("path",{class:"cls-6",d:"M28.72,5.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.38,1.38,0,0,1-.47-.31,1.21,1.21,0,0,1-.31-.48,1.51,1.51,0,0,1,0-1.18,1.21,1.21,0,0,1,.31-.48,1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.21,1.21,0,0,1,.31.48A1.45,1.45,0,0,1,28.72,5.79Zm-.49,0a1.09,1.09,0,0,0-.07-.4,1.16,1.16,0,0,0-.22-.31.87.87,0,0,0-.32-.22,1,1,0,0,0-.39-.08,1,1,0,0,0-.4.08.87.87,0,0,0-.32.22,1.16,1.16,0,0,0-.22.31,1.18,1.18,0,0,0,0,.8,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.4.08,1,1,0,0,0,.39-.08.87.87,0,0,0,.32-.22,1,1,0,0,0,.22-.31A1.09,1.09,0,0,0,28.23,5.79Z"}),(0,s.h)("path",{class:"cls-6",d:"M32.12,4.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19,7.77,7.77,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19A2.34,2.34,0,0,1,31,4.56,1.85,1.85,0,0,1,32.12,4.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,30.52,8a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,2,2,0,0,0,.49.74,1.15,1.15,0,0,0,.78.28,1.12,1.12,0,0,0,.77-.28,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,33.72,8a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.08,1.08,0,0,0,32.12,4.85Z"}),(0,s.h)("path",{class:"cls-6",d:"M66.62,43.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.38,1.38,0,0,1-.47-.31,1.21,1.21,0,0,1-.31-.48,1.51,1.51,0,0,1,0-1.18,1.21,1.21,0,0,1,.31-.48,1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.21,1.21,0,0,1,.31.48A1.45,1.45,0,0,1,66.62,43.79Zm-.49,0a1.09,1.09,0,0,0-.07-.4,1.16,1.16,0,0,0-.22-.31.87.87,0,0,0-.32-.22,1,1,0,0,0-.39-.08,1,1,0,0,0-.4.08.87.87,0,0,0-.32.22,1.16,1.16,0,0,0-.22.31,1.18,1.18,0,0,0,0,.8,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.4.08,1,1,0,0,0,.39-.08.87.87,0,0,0,.32-.22,1,1,0,0,0,.22-.31A1.09,1.09,0,0,0,66.13,43.79Z"}),(0,s.h)("path",{class:"cls-6",d:"M70.94,46.41l0,0a1.33,1.33,0,0,1-.46.19,2.2,2.2,0,0,1-.56.07,2.18,2.18,0,0,1-.85-.16,2.12,2.12,0,0,1-.68-.45,1.9,1.9,0,0,1-.46-.68,2.38,2.38,0,0,1-.16-.89,2.27,2.27,0,0,1,.17-.91,1.9,1.9,0,0,1,.48-.7,2.45,2.45,0,0,1,.73-.46,2.7,2.7,0,0,1,1.83,0,2.33,2.33,0,0,1,.73.46,1.9,1.9,0,0,1,.48.7,2.27,2.27,0,0,1,.18.91,2.61,2.61,0,0,1-.2,1,6.24,6.24,0,0,1-.44.9L69.77,49.5h-.83Zm.69-1.94a1.69,1.69,0,0,0-.12-.64,1.62,1.62,0,0,0-.32-.52,1.92,1.92,0,0,0-.5-.34,1.79,1.79,0,0,0-1.29,0,1.77,1.77,0,0,0-.5.34,1.82,1.82,0,0,0-.32.52,1.77,1.77,0,0,0,0,1.28,1.49,1.49,0,0,0,.31.51,1.45,1.45,0,0,0,.5.33,1.75,1.75,0,0,0,.65.12A1.73,1.73,0,0,0,70.7,46a1.45,1.45,0,0,0,.5-.33,1.69,1.69,0,0,0,.32-.51A1.91,1.91,0,0,0,71.63,44.47Z"}),(0,s.h)("path",{class:"cls-6",d:"M75.82,42.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86A4.16,4.16,0,0,1,78,44.61a8.46,8.46,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,8.46,8.46,0,0,1,0-2.72A4.16,4.16,0,0,1,74,43.42a2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,75.82,42.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,4.31,4.31,0,0,0-.26,1A10.3,10.3,0,0,0,74.22,46a10.11,10.11,0,0,0,.07,1.08,4,4,0,0,0,.26,1,2,2,0,0,0,.49.74,1.21,1.21,0,0,0,1.55,0,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,77.42,46a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,75.82,42.85Z"}))}renderRotationSVG_Ari_leading(){return(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 80 80"},(0,s.h)("defs",null,(0,s.h)("style",null,".cls-1,.cls-4","{fill:none;}",".cls-2","{fill:#f3f3f3;}",".cls-3","{fill:#ccc;}",".cls-4","{stroke:#353535;stroke-miterlimit:10;}",".cls-5","{fill:#353535;}",".cls-6","{fill:#595959;}")),(0,s.h)("rect",{class:"cls-1",width:"80",height:"80"}),(0,s.h)("circle",{class:"cls-2",cx:"30.5",cy:"46.5",r:"30.5"}),(0,s.h)("rect",{class:"cls-3",x:"30",y:"16",width:"1",height:"6"}),(0,s.h)("rect",{class:"cls-3",x:"30",y:"71",width:"1",height:"6"}),(0,s.h)("rect",{class:"cls-3",x:"57.5",y:"43.5",width:"1",height:"6",transform:"translate(11.5 104.5) rotate(-90)"}),(0,s.h)("rect",{class:"cls-3",x:"2.5",y:"43.5",width:"1",height:"6",transform:"translate(-43.5 49.5) rotate(-90)"}),(0,s.h)("path",{class:"cls-4",d:"M36.54,16.6a30.55,30.55,0,0,1,24,24.55"}),(0,s.h)("polygon",{class:"cls-5",points:"38.19 19.92 38.76 19.52 36.8 16.69 39.77 14.94 39.42 14.33 35.8 16.46 38.19 19.92"}),(0,s.h)("path",{class:"cls-6",d:"M24.82,5.79a1.63,1.63,0,0,1-.11.59,1.47,1.47,0,0,1-.31.48,1.52,1.52,0,0,1-.48.31,1.66,1.66,0,0,1-1.19,0,1.38,1.38,0,0,1-.47-.31A1.21,1.21,0,0,1,22,6.38a1.45,1.45,0,0,1-.12-.59,1.53,1.53,0,0,1,.12-.6,1.25,1.25,0,0,1,.31-.47,1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.79.78A1.73,1.73,0,0,1,24.82,5.79Zm-.49,0a1,1,0,0,0-.07-.39A1.07,1.07,0,0,0,24,5.08a.87.87,0,0,0-.32-.22,1,1,0,0,0-.39-.08,1.06,1.06,0,0,0-.4.08.87.87,0,0,0-.32.22.89.89,0,0,0-.21.32.85.85,0,0,0-.08.39.92.92,0,0,0,.08.4.85.85,0,0,0,.21.31.87.87,0,0,0,.32.22,1.06,1.06,0,0,0,.4.08,1,1,0,0,0,.39-.08A.87.87,0,0,0,24,6.5a1,1,0,0,0,.22-.31A1.09,1.09,0,0,0,24.33,5.79Z"}),(0,s.h)("path",{class:"cls-6",d:"M29.14,8.41l0,0a1.35,1.35,0,0,1-.45.19,2.28,2.28,0,0,1-.57.07,2.18,2.18,0,0,1-.85-.16A2.12,2.12,0,0,1,26.57,8a1.94,1.94,0,0,1-.46-.69A2.3,2.3,0,0,1,26,6.47a2.27,2.27,0,0,1,.17-.91,1.9,1.9,0,0,1,.48-.7,2.32,2.32,0,0,1,1.65-.62,2.51,2.51,0,0,1,.92.16,2.59,2.59,0,0,1,.73.46,2.18,2.18,0,0,1,.48.7,2.46,2.46,0,0,1,.17.91,2.61,2.61,0,0,1-.2,1,6.24,6.24,0,0,1-.44.9L28,11.5h-.83Zm.69-1.94a1.69,1.69,0,0,0-.12-.64,1.62,1.62,0,0,0-.32-.52,1.56,1.56,0,0,0-.5-.33A1.67,1.67,0,0,0,27.6,5a1.67,1.67,0,0,0-.5.33,1.82,1.82,0,0,0-.32.52,1.69,1.69,0,0,0-.11.64,1.61,1.61,0,0,0,.11.63,1.35,1.35,0,0,0,.81.85,1.76,1.76,0,0,0,.66.12A1.71,1.71,0,0,0,28.9,8a1.45,1.45,0,0,0,.5-.33,1.62,1.62,0,0,0,.32-.52A1.81,1.81,0,0,0,29.83,6.47Z"}),(0,s.h)("path",{class:"cls-6",d:"M34,4.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19A7.72,7.72,0,0,1,36.33,8a7.72,7.72,0,0,1-.11,1.36,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19,2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,34,4.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,32.42,8a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,1.92,1.92,0,0,0,.49.73,1.18,1.18,0,0,0,1.55,0,1.92,1.92,0,0,0,.49-.73,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,35.62,8a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,34,4.85Z"}),(0,s.h)("path",{class:"cls-6",d:"M67.62,43.79a1.45,1.45,0,0,1-.12.59,1.21,1.21,0,0,1-.31.48,1.38,1.38,0,0,1-.47.31,1.66,1.66,0,0,1-1.19,0,1.38,1.38,0,0,1-.47-.31,1.21,1.21,0,0,1-.31-.48,1.45,1.45,0,0,1-.12-.59,1.53,1.53,0,0,1,.12-.6,1.25,1.25,0,0,1,.31-.47,1.38,1.38,0,0,1,.47-.31,1.66,1.66,0,0,1,1.19,0,1.38,1.38,0,0,1,.47.31,1.25,1.25,0,0,1,.31.47A1.53,1.53,0,0,1,67.62,43.79Zm-.49,0a1,1,0,0,0-.07-.39,1.07,1.07,0,0,0-.22-.32.87.87,0,0,0-.32-.22,1,1,0,0,0-.39-.08,1,1,0,0,0-.4.08.87.87,0,0,0-.32.22,1.07,1.07,0,0,0-.22.32,1,1,0,0,0-.07.39,1.09,1.09,0,0,0,.07.4,1,1,0,0,0,.22.31.87.87,0,0,0,.32.22,1,1,0,0,0,.4.08,1,1,0,0,0,.39-.08.87.87,0,0,0,.32-.22,1,1,0,0,0,.22-.31A1.09,1.09,0,0,0,67.13,43.79Z"}),(0,s.h)("path",{class:"cls-6",d:"M71,42.24a1.84,1.84,0,0,1,1.1.32,2.34,2.34,0,0,1,.72.86,4.16,4.16,0,0,1,.38,1.19,8.46,8.46,0,0,1,0,2.72,4.26,4.26,0,0,1-.38,1.19,2.27,2.27,0,0,1-.72.84,2.07,2.07,0,0,1-2.21,0,2.27,2.27,0,0,1-.72-.84,4.26,4.26,0,0,1-.38-1.19,9.3,9.3,0,0,1,0-2.72,4.16,4.16,0,0,1,.38-1.19,2.34,2.34,0,0,1,.72-.86A1.85,1.85,0,0,1,71,42.24Zm0,.61a1.11,1.11,0,0,0-.78.29,2,2,0,0,0-.49.74,3.86,3.86,0,0,0-.25,1A8.23,8.23,0,0,0,69.42,46a8.09,8.09,0,0,0,.08,1.08,3.59,3.59,0,0,0,.25,1,2,2,0,0,0,.49.74,1.21,1.21,0,0,0,1.55,0,2,2,0,0,0,.49-.74,4,4,0,0,0,.26-1A8.09,8.09,0,0,0,72.62,46a8.23,8.23,0,0,0-.08-1.09,4.31,4.31,0,0,0-.26-1,2,2,0,0,0-.49-.74A1.1,1.1,0,0,0,71,42.85Z"}))}createSymbol(e){const{smartMappingState:t}=this;if(!e)return;const{modules:i}=t,s=(0,n.g)(t);let a=s.symbol||s.classBreakInfos?.length&&s.classBreakInfos[0].symbol||s.uniqueValueInfos?.length&&s.uniqueValueInfos[0].symbol||(0,n.f)(t);for(a=a.clone(),(0,n.j)(t,a,new i.EsriColor({r:170,g:170,b:170,a:1}));e.childNodes?.length;)e.removeChild(e.childNodes[0]);a&&i.symbolUtils.renderPreviewHTML(a,{size:20}).then((t=>e.appendChild(t)))}handleToggle(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,n.g)(e);(0,n.J)();const a=(0,n.b)(i,"rotation");if(a)this.lastSettings={rotationVisVar:a},i.visualVariables=(0,n.a)(i,"rotation")||[],(0,n.t)(e);else if(this.lastSettings?.rotationVisVar)i.visualVariables=(0,n.a)(i,"rotation")||[],i.visualVariables.push(this.lastSettings.rotationVisVar),(0,n.t)(e),(0,n.aQ)(this.blockNode);else{const s=(0,n.aR)(e),a=s?s.layerField.name:"",o=new t.RotationVariable({field:a,rotationType:"geographic"});i.visualVariables=(0,n.a)(i,"rotation")||[],i.visualVariables.push(o),(0,n.t)(e),(0,n.aQ)(this.blockNode)}(0,s.f)(this.el)}handleTypeChange(e){const{smartMappingState:t}=this,i=(0,n.g)(t),a=(0,n.b)(i,"rotation");e!==a.rotationType&&(a.rotationType=e,(0,n.t)(t),(0,s.f)(this.el))}setRotationVisualVariable(e){this.isLoading=!0;const{smartMappingState:t}=this,{modules:i}=t,s=(0,n.g)(t),a=(0,n.b)(s,"rotation").rotationType;try{let o;o=e.expression?new i.RotationVariable({valueExpression:e.expression,valueExpressionTitle:e.expressionTitle,rotationType:a}):new i.RotationVariable({field:e.field,rotationType:a}),s.visualVariables=(0,n.a)(s,"rotation")||[],s.visualVariables.push(o),(0,n.t)(t),(0,n.aQ)(this.blockNode),this.isLoading=!1}catch(e){console.log(e)}}get el(){return(0,s.a)(this)}};C.style=".toggle-button {\n  margin-top: 2px;\n}\n\n.block-section-padding {\n  padding-top: 6px;\n}\n\n.block-content-padding {\n  margin: 6px 0;\n}\n\n.block-content-loading {\n  height: 150px;\n}\n\n.rotation-block {\n  overflow: hidden;\n}\n\n.rotation-type {\n  margin-top: 5px;\n}\n.rotation-type-selection {\n  margin-top: 15px;\n}\n.rotation-type-display {\n  margin: 10px 20px 0 20px;\n  position: relative;\n  svg {\n    height: 120px;\n  }\n}\n.rotation-type-symbol {\n  position: absolute;\n  top: 56px;\n  left: 33px;\n}\n\n:dir(rtl) {\n  .rotation-type-symbol {\n    left: auto;\n    right: 61px;\n  }\n}\n";const V=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSizeRangeSliderError=(0,s.c)(this,"arcgisSmartMappingSizeRangeSliderError",7),this.manager=(0,h.u)(this),this.smartMappingState=(0,r.u)()}arcgisSmartMappingAuthRefSizeVisVarChangeHandler({detail:e}){const t=this.rangeSliderNode.values,i=Math.min(...t)*e,s=Math.max(...t)*e;this.rangeSliderNode.values=[i,s],this.minRangeNode.value=`${Math.round(this.rangeSliderNode.values[0])}`,this.maxRangeNode.value=`${Math.round(this.rangeSliderNode.values[1])}`}componentDidLoad(){(0,g.i)(this.el.shadowRoot,this.smartMappingState.modules.esriConfig),this.flowItemNode=(0,a.f)(this.el,"calcite-flow-item")}disconnectedCallback(){clearTimeout(this.minWatchHandle),clearTimeout(this.maxWatchHandle),this.scaleWatchHandle?.remove()}render(){const{smartMappingState:e}=this,{mapImageSublayer:t,modules:i,strings:a}=e,o=(0,n.g)(e),l=o.authoringInfo,r=(0,n.b)(o,"size"),d=(0,n.d)(o,"reference-size"),c=(0,n.d)(o,"spike"),h="above-and-below"===l?.univariateTheme,p=!!r&&!(0,n.S)(r.minSize),u=!!r&&"number"==typeof r.minSize,g=!p&&!u;let[f,S]=(0,m.j)(e);if([f,S]=[Math.round(f/.75),Math.round(S/.75)],f>S&&([f,S]=[S,f]),this.rangeSliderNode){if(f!==this.rangeSliderNode.values[0]||S!==this.rangeSliderNode.values[1]||!(0,n.S)(this.rangeSliderNode.values[1])){const e={min:Math.max(1,Math.min(1,f-10)),max:Math.min(S+10,d||c?Number.POSITIVE_INFINITY:100),values:f===S?[f]:[f,S]};this.minRangeNode.value=`${f}`,this.maxRangeNode.value=`${S}`,this.rangeSliderNode.set(e)}}else{const e={min:Math.max(1,Math.min(1,f-10)),max:Math.min(S+10,d||c?Number.POSITIVE_INFINITY:100),values:f===S?[f]:[f,S],visibleElements:{labels:!0},precision:0,labelInputsEnabled:!0,labelFormatFunction:e=>e.toFixed(0)};this.rangeSliderNode=new i.Slider(e)}return(0,s.h)(s.H,{key:"f797dc37eec357c09eb5d86728340390c6d1b19f"},(0,s.h)("div",{key:"4319f1e43677283e646ee4a5ae984bf401ffe728",class:"size-range-block"},(0,s.h)("calcite-label",{key:"3c03264a8c3d0ccb7209063e4addafda0d09ed72"},a.sizeRangeSlider.sizeRange),(0,s.h)("div",{key:"3d2a0693ed3f0cb11fb12e9e1c7b1088563fdcd9",class:"range-slider range-slider-bottom-label",ref:e=>{e&&this.afterSizeRangeCreate(e)}}),(0,s.h)("div",{key:"1eeea5cbe015bd91873a653bd3876515669846ce",dir:"ltr",class:"size-range"},(0,s.h)("div",{key:"b1bd0dce168583487147ce19b1be4983123e1002",class:"size-range-item"},(0,s.h)("calcite-input-number",{key:"a3046b63f92a4a15482fb49cdf4ddbafc260794f",value:`${f}`,min:1,max:d||c?void 0:100,step:1,scale:"s",suffixText:a.sizeRangeSlider.px,ref:e=>{e&&(this.minRangeNode=e)},onCalciteInputNumberInput:()=>{clearTimeout(this.minWatchHandle);const e=this.rangeSliderNode.values,t=Number.parseInt(this.minRangeNode.value);if(this.minRangeNode.value&&t>=this.minRangeNode.min&&(!e[1]||t<e[1])){const i=Math.min(t,100);this.minRangeNode.value=`${i}`,e[1]||(this.maxRangeNode.value=`${i}`);const s=e[1]?[.75*i,.75*e[1]]:[.75*i];this.rangeSliderNode.values=e[1]?[Number.parseInt(this.minRangeNode.value),e[1]]:[Number.parseInt(this.minRangeNode.value)],this.handleSizeRangeValuesChange(s)}else this.minWatchHandle=setTimeout((()=>{const t=this.rangeSliderNode.values;this.minRangeNode.value=`${t[0]}`,e[1]||(this.maxRangeNode.value=`${t[0]}`);const i=t[1]?[.75*t[0],.75*t[1]]:[.75*t[0]];this.handleSizeRangeValuesChange(i)}),3e3)},label:a.sizeRangeSlider.min})),(0,s.h)("div",{key:"4acf96a0c342e02ba2422326e7d0c7f9ec96477b",class:"size-range-item"},(0,s.h)("calcite-input-number",{key:"de203e73be609d47652885afb936a51b566f8a01",value:`${S}`,min:1,max:d||c?void 0:100,step:1,scale:"s",suffixText:a.sizeRangeSlider.px,ref:e=>{e&&(this.maxRangeNode=e)},onCalciteInputNumberInput:()=>{clearTimeout(this.maxWatchHandle);const e=this.rangeSliderNode.values,t=Number.parseInt(this.maxRangeNode.value);if(this.maxRangeNode.value&&(!e[1]||t>e[0])&&(t<101||d||c)){const i=d||c?t:Math.min(t,100);this.maxRangeNode.value=`${i}`,e[1]||(this.minRangeNode.value=`${i}`);const s=e[1]?[.75*e[0],.75*i]:[.75*i];this.rangeSliderNode.values=e[1]?[e[0],Number.parseInt(this.maxRangeNode.value)]:[Number.parseInt(this.maxRangeNode.value)],this.handleSizeRangeValuesChange(s)}else this.maxWatchHandle=setTimeout((()=>{const e=this.rangeSliderNode.values;this.maxRangeNode.value=`${e[1]??e[0]}`,e[1]||(this.minRangeNode.value=`${e[0]}`);const t=e[1]?[.75*e[0],.75*e[1]]:[.75*e[0]];this.handleSizeRangeValuesChange(t)}),3e3)},label:a.sizeRangeSlider.min}))),r&&!h&&!t&&(0,s.h)("calcite-label",{key:"f0fd1a0da04ca3f46df061bb838370c1e5aebb97",scale:"s",layout:"inline",class:"size-range-bottom-border"},(0,s.h)("calcite-checkbox",{key:"f095b8a91e3f41ff852e6515758949cc474dca5b",scale:"s",checked:g,onCalciteCheckboxChange:e=>{this.handleSizeRangeChange(e.target.checked?"automatic":"fixed")},ref:e=>this.adjustSizeNode=e}),a.sizeRangeSlider.adjustSizeAutomatically),d&&this.renderRegenerate()))}renderRegenerate(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"top-bottom-margin-small"},(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",onClick:()=>{this.handleSizeRangeChange("automatic")},label:e.sizeRangeSlider.regenerate},e.sizeRangeSlider.regenerate))}async handleSizeRangeValuesChange(e){const{smartMappingState:t}=this,i=(0,n.g)(t),s=(0,n.b)(i,"size"),a=i.classBreakInfos,o=(0,n.d)(i,"reference-size"),l=(0,n.d)(i,"spike");if(o){o.sizeStops[0].size=e[0],o.sizeStops[1].size=e[1];const i=await(0,d.q)(t);return void(0,n.t)(t,i)}if(l){l.sizeStops[0].size=e[0],l.sizeStops[1].size=e[1];const i=await(0,d.r)(t);return void(0,n.t)(t,i)}const r=s?s.minSize/.75:a[0].symbol.size/.75,c=s?s.maxSize/.75:a[a.length-1].symbol.size/.75,h=e[0]/.75,p=e[1]?e[1]/.75:e[0]/.75;r===h&&c===p||((0,m.k)(t,e),e.length>1&&(this.maxRangeNode.min=h+this.maxRangeNode.step,this.minRangeNode.max=p-this.minRangeNode.step),(0,n.t)(t))}afterSizeRangeCreate(e){if(this.rangeSliderNode.container)e.append(this.rangeSliderNode.container);else{const t=document.createElement("div");e.append(t),this.rangeSliderNode.container=t,this.createRangeSliderChangeEvents()}}createRangeSliderChangeEvents(){const{smartMappingState:e}=this,{mapView:t}=e;this.rangeSliderNode&&(this.rangeSliderNode.on("thumb-change",(e=>{const t=this.rangeSliderNode.values;0===e.index?t[1]&&t[0]>=t[1]&&(t[0]=e.oldValue):1===e.index&&t[1]<=t[0]&&(t[1]=e.oldValue),this.minRangeNode.value=`${Math.round(t[0])}`,this.maxRangeNode.value=`${Math.round(t[1]??t[0])}`;const i=t[1]?[.75*t[0],.75*t[1]]:[.75*t[0]];this.handleSizeRangeValuesChange(i)})),this.rangeSliderNode.on("thumb-drag",(t=>{const i=(0,n.g)(e),s=(0,n.d)(i,"reference-size"),a=(0,n.d)(i,"spike");if((s||a)&&["start","drag"].includes(t.state))return;const o=this.rangeSliderNode.values;if(0===t.index){if(o[1]&&o[0]>=o[1])return void(o[0]-=1)}else if(1===t.index&&o[1]<=o[0])return void(o[1]+=1);this.minRangeNode.value=`${Math.round(o[0])}`,this.maxRangeNode.value=`${Math.round(o[1]??o[0])}`;const l=o[1]?[.75*o[0],.75*o[1]]:[.75*o[0]];this.handleSizeRangeValuesChange(l)})),this.rangeSliderNode.on("segment-drag",(()=>{const e=this.rangeSliderNode.values;this.minRangeNode.value=`${Math.round(e[0])}`,this.maxRangeNode.value=`${Math.round(e[1]??e[0])}`;const t=e[1]?[.75*e[0],.75*e[1]]:[.75*e[0]];this.handleSizeRangeValuesChange(t)})),this.scaleWatchHandle=t.watch("scale",(()=>{const t=(0,n.g)(e);if((0,n.b)(t,"size")){let[t,i]=(0,m.j)(e);[t,i]=[Math.round(t/.75),Math.round(i/.75)],t>i&&([t,i]=[i,t]),this.rangeSliderNode?.set({values:t===i?[t]:[t,i],min:Math.max(1,Math.min(1,t-10)),max:Math.min(i+10,100)}),this.minRangeNode.value=`${Math.round(this.rangeSliderNode.values[0])}`,this.maxRangeNode.value=Math.round(this.rangeSliderNode.values[1]??this.rangeSliderNode.values[0]).toString()}})))}async handleSizeRangeChange(e){const{smartMappingState:t}=this,i=(0,n.g)(t),a=(0,n.b)(i,"size"),o=(0,n.d)(i,"reference-size"),r=(0,n.d)(i,"spike");if("fixed"===e){if(!a.minSize.stops)return;[a.minSize,a.maxSize]=(0,m.j)(t),(0,n.t)(t),(0,s.f)(this.el)}else{const e=(0,n.k)(t);let i=d.c;"predominance-size"===e?i=u.d:"chart-size"===e?i=u.b:["size-age","color-size-age","type-size-age"].includes(e)&&(i=d.j),(0,l.r)(i(t,{sizeOptimizationEnabled:!0}),this.flowItemNode).then((async e=>{if(o){const i=(0,n.d)(e.renderer,"reference-size");o.sizeStops.forEach(((e,t)=>e.size=i.sizeStops[t].size));const s=await(0,d.q)(t,{sizeOptimizationEnabled:!0,sizeStops:o.sizeStops});(0,n.t)(t,s)}else if(r){const i=(0,n.d)(e.renderer,"spike");r.sizeStops.forEach(((e,t)=>e.size=i.sizeStops[t].size));const s=await(0,d.r)(t,{sizeOptimizationEnabled:!0,sizeStops:r.sizeStops});(0,n.t)(t,s)}else(0,n.t)(t,e.renderer);(0,s.f)(this.el)}),(e=>{this.adjustSizeNode&&(this.adjustSizeNode.checked=!1),this.arcgisSmartMappingSizeRangeSliderError.emit(e)}))}}get el(){return(0,s.a)(this)}};V.style=".size-range-block{border-bottom:1px solid #e0e0e0}.range-slider{height:40px;background-color:transparent;position:relative;width:95%;margin:15px auto 0 auto}.size-range{display:flex;justify-content:space-between;margin-bottom:15px}.size-range-item{width:48%;display:flex;flex-flow:column;justify-content:space-between}.esri-slider__label{text-decoration:underline}.esri-slider__label:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.top-bottom-margin-small{margin:10px 0}";const T=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSizeSliderChange=(0,s.c)(this,"arcgisSmartMappingSizeSliderChange",7),this.arcgisSmartMappingSizeSliderError=(0,s.c)(this,"arcgisSmartMappingSizeSliderError",7),this.manager=(0,h.u)(this),this.currentStopValues=[],this.currentBreakValues=[],this.zigzagClick=!1,this.styleSheetStatus="not-loaded",this.smartMappingState=(0,r.u)(),this.histogramStatus=n.s.MISSING,this.statisticsStatus=n.s.MISSING,this.sliderZoomed=!1}arcgisSmartMappingAuthRefSizeVisVarChangeHandler(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.d)(t,"reference-size");i?.referenceSizeScale&&(this.currentStopValues=[i.sizeStops[0].value,i.sizeStops[1].value],this.sizeSlider?.stops.forEach(((e,t)=>e.size=i.sizeStops[t].size)))}async updateStatistics(){this.statisticsStatus=n.s.MISSING,this.statistics=void 0,this.histogramStatus=n.s.MISSING,this.histogram=void 0,this.sizeSlider?.destroy(),this.sizeSlider=void 0,this.sliderZoomed=!1,this.getStatistics()}componentWillLoad(){this.getStatistics()}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{config:e}=this.smartMappingState;return(0,s.h)(s.H,{key:"9929f624e93b2e50075f387a6a07fef8492685b6"},(0,s.h)("link",{key:"3ef6441094cca5bc470804ecd87f8232364a3548",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,s.f)(this.el)},onError:()=>{this.styleSheetStatus="failed",(0,s.f)(this.el)}}),"loaded"===this.styleSheetStatus?this.renderSizeSlider():"not-loaded"===this.styleSheetStatus?this.renderSizeSliderLoading():null)}renderSizeSlider(){const{statisticsStatus:e,histogramStatus:t,sliderZoomed:i,smartMappingState:a}=this,{strings:o}=a,l=(0,n.g)(a),r=(0,n.b)(l,"size"),d=(0,n.d)(l,"reference-size"),c=(0,n.d)(l,"spike");if(e===n.s.FAILED||e===n.s.MISSING||r?.stops&&1===r.stops.length||!r&&!d&&!c&&1===l.classBreakInfos.length)return this.sizeSlider&&(this.sizeSlider.destroy(),this.sizeSlider=void 0),(0,s.h)(s.F,null);if(e===n.s.IN_PROGRESS||t===n.s.IN_PROGRESS&&!this.sizeSlider)return this.renderSizeSliderLoading();{const e=this.prepareSizeSlider();let t=!1;if((r||d||c)&&!i){const e=(0,n.d)(l,"size"),i=(0,n.aK)(this.getZoomStops(),e?e?.minSliderValue:d?d?.minSliderValue:c?.minSliderValue,e?e?.maxSliderValue:d?d?.maxSliderValue:c?.maxSliderValue);(i?.minMaxSame||!(0,n.S)(i?.min)&&!(0,n.S)(i?.max))&&(t=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}return r?this.currentStopValues=[r.minDataValue,r.maxDataValue]:d?this.currentStopValues=[d.sizeStops[0].value,d.sizeStops[1].value]:c?this.currentStopValues=[c.sizeStops[0].value,c.sizeStops[1].value]:this.currentBreakValues=l.classBreakInfos.map((e=>({min:e.minValue,max:e.maxValue}))),(e||this.sizeSlider)&&this.sizeSlider.min!==this.sizeSlider.max?(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-label",null,o.panels.size.dataRange),(0,s.h)("div",{class:"slider-box-buttons-front"},!d&&!c&&this.renderInvertButton(),(r||d||c)&&(0,s.h)(s.F,null,(0,s.h)("div",null,"\xa0"),this.renderZoomButton(t))),(0,s.h)("div",{ref:e=>{e&&this.afterSizeSliderCreate(e)}})):this.sizeSlider&&this.sizeSlider.min===this.sizeSlider.max?(0,s.h)(s.F,null):this.renderSizeSliderLoading()}}renderSizeSliderLoading(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}renderInvertButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("arcgis-smart-mapping-action",{text:e.panels.size.invertSlider,icon:"arrowUpDown",onClick:()=>this.handleInvertSlider()})}renderZoomButton(e){const{strings:t}=this.smartMappingState,{sliderZoomed:i}=this;return(0,s.h)("arcgis-smart-mapping-action",{text:t.panels.size.zoomSlider,icon:i?"magnifyingGlassMinus":"magnifyingGlassPlus",disabled:e,onClick:()=>this.handleZoomSlider(),ref:e=>this.zoomButtonNode=e})}prepareSizeSlider(){const{statistics:e,histogram:t,histogramStatus:i,sliderZoomed:s,smartMappingState:a}=this,{mapView:l,modules:r}=a,c=(0,n.g)(a),h=(0,n.k)(a),m=["size-age","color-size-age","type-size-age"].includes(h),u="class-breaks"===c.type?c.classBreakInfos:c.uniqueValueInfos,g=this.getFieldInfo().simpleFieldType===n.w.DATE,f=(0,n.b)(c,"size"),S=(0,n.d)(c,"size"),b=(0,n.d)(c,"size"),y=(0,n.d)(c,"spike"),v=["color-size","color-age-size","color-size-age","type-size","type-size-age","predominance-size","chart-size","relationship-size"].includes(h)?null:(0,n.h)(a,u[u.length-1].symbol);let z,x;if(S?(z=S.minSliderValue,x=S.maxSliderValue):b?(z=b.minSliderValue,x=b.maxSliderValue):y?(z=y.minSliderValue,x=y.maxSliderValue):(z=u[0].minValue,x=u[u.length-1].maxValue),({min:z,max:x}=(0,n.aH)({min:z,max:x})),i===n.s.IN_PROGRESS)return!1;if(!this.sizeSlider||f&&this.sizeSlider.breaks||!f&&!b&&!y&&this.sizeSlider.stops){this.sizeSlider?.destroy();const i={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:z??e.min,max:x??e.max,style:v?{trackFillColor:v||null}:null};if(f||b||y)g&&!m&&(i.hasTimeData=!0,(0,o.a)(a,i,l.timeZone)),i.stops=(0,d.s)(a),i.precision=(0,p.g)(i.stops),this.sizeSlider=new r.SizeSlider(i),this.sizeSlider&&this.sizeSlider.min===this.sizeSlider.max&&this.sizeSlider.set(i);else{const e=(0,n.g)(a);i.histogramConfig.min=e.classBreakInfos[0].minValue,i.histogramConfig.max=e.classBreakInfos[e.classBreakInfos.length-1].maxValue,this.sliderZoomed=!1,i.breaks=(0,d.t)(a),i.precision=(0,p.g)(i.breaks),this.sizeSlider=new r.ClassedSizeSlider(i),this.sizeSlider&&this.sizeSlider.min===this.sizeSlider.max&&this.sizeSlider.set(i)}this.createSizeSliderChangeEvents()}else{const i=this.sizeSlider;if("dragging"===i.slider?.state)return!0;const r={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:z??e.min,max:x??e.max,style:v?{trackFillColor:v||null}:null};f||b||y?(r.stops=(0,d.s)(a),r.precision=(0,p.g)(r.stops),r.hasTimeData=g&&!m,g&&!m&&(0,o.a)(a,r,l.timeZone),s?this.zigzagClick||(r.zoomOptions=(0,n.aK)(this.getZoomStops(),S?S?.minSliderValue:b?b?.minSliderValue:y?.minSliderValue,S?S?.maxSliderValue:b?b?.maxSliderValue:y?.maxSliderValue)):r.zoomOptions=null):(r.breaks=(0,d.t)(a),r.precision=(0,p.g)(r.breaks)),this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(r.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.sizeSlider.slider.min=r.zoomOptions.min,r.zoomOptions.min=null):(this.sizeSlider.slider.max=r.zoomOptions.max,r.zoomOptions.max=null)),this.adjustedZoomOptions=void 0,this.zoomAdjustment=void 0,this.sizeSlider.set(r),this.zigzagClick=!1}return(0,n.S)(this.sizeSlider)}handleInvertSlider(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.b)(t,"size");if(i)[i.minSize,i.maxSize]=[i.maxSize,i.minSize];else{const i=t.classBreakInfos.map((t=>(0,n.af)(e,t.symbol)));i.reverse(),t.classBreakInfos.forEach(((t,s)=>{const a=t.symbol;(0,n.ag)(e,a,i[s])}))}(0,n.t)(e),this.arcgisSmartMappingSizeSliderChange.emit()}handleZoomSlider(e){const{smartMappingState:t}=this;if(this.histogramStatus===n.s.IN_PROGRESS)return;const{statistics:i}=this,s=(0,n.g)(t);this.sliderZoomed=(0,n.S)(e)?!!e:!this.sliderZoomed;const a=(0,n.b)(s,"size"),o=(0,n.d)(s,"reference-size"),l=(0,n.d)(s,"spike");a||o||l||(this.sliderZoomed=!1);const r=this.getFieldInfo(),d=this.getNormalizationField(),c=(0,n.d)(s,"size"),h=this.sliderZoomed?(0,n.aK)(this.getZoomStops(),c?c.minSliderValue:o?o.minSliderValue:l?l.minSliderValue:i.min,c?c.maxSliderValue:o?o.maxSliderValue:l?l.maxSliderValue:i.max):null,p=c?c.minSliderValue===c.maxSliderValue:o?o?.minSliderValue===o?.maxSliderValue:l?.minSliderValue===l?.maxSliderValue;this.getHistogram(r,d,i,(h?.min||(p?i.min:c?.minSliderValue??o?.minSliderValue??l?.minSliderValue??i.min))??void 0,(h?.max||(p?i.max:c?.maxSliderValue??o?.maxSliderValue??l?.minSliderValue??i.max))??void 0)}afterSizeSliderCreate(e){if(this.sizeSlider.container)e.append(this.sizeSlider.container);else{const t=document.createElement("div");t.classList.add("slider-container"),e.append(t),this.sizeSlider.container=t}}getStatistics(){const{smartMappingState:e}=this,{layer:t,useFeatureReduction:i,mapView:s,modules:a}=e,o=t,l=(0,n.g)(e);let r,d;const c=(0,n.d)(l,"reference-size")||{},h=(0,n.d)(l,"spike")||{},p=this.getFieldInfo(),m=this.getNormalizationField(),u=(0,n.d)(l,"size")||{};r=u.minSliderValue??c.minSliderValue??h.minSliderValue??l.classBreakInfos?.[0]?.minValue,d=u.maxSliderValue??c.maxSliderValue??h.maxSliderValue??l.classBreakInfos?.[l.classBreakInfos.length-1]?.maxValue;const g=l.authoringInfo;if("equal-interval"===g?.classificationMethod){const e=l.classBreakInfos;r=e[0].minValue,d=e[e.length-1].maxValue}this.statisticsStatus=n.s.IN_PROGRESS,this.statistics||a.summaryStatistics({layer:o,view:s,field:p.field??void 0,valueExpression:p.expression??void 0,normalizationField:m,forBinning:"featureReduction"in o&&"binning"===o.featureReduction?.type&&i,outStatisticTypes:{exclude:["median"]}}).then((e=>{if(0===e.count){const[t,i]=this.getDefaultDataRange(p),s=u.minSliderValue||t,a=u.maxSliderValue||i;e.min=s,e.max=a,e.avg=(a+s)/2,(0,n.S)(u.minSliderValue)||(u.minSliderValue=s,u.maxSliderValue=a)}else if(!(0,n.S)(e.avg)||!(0,n.S)(e.min)||!(0,n.S)(e.max))return void(this.statisticsStatus=n.s.FAILED);e=(0,n.aH)(e),({min:r,max:d}=(0,n.aH)({min:r,max:d})),r=r??e.min,d=d??e.max,this.statistics=e,this.statisticsStatus=n.s.SUCCESS,this.getHistogram(p,m,e,r,d)}),(e=>{console.log(e),this.statisticsStatus=n.s.FAILED}))}getHistogram(e,t,i,s,a){const{smartMappingState:o}=this,{layer:l,useFeatureReduction:r,mapView:d,modules:c}=o,h=l;if(!(i=i||this.statistics)||0===i.count)return;this.histogramStatus=n.s.IN_PROGRESS;const p=(0,n.g)(o),m=(0,n.d)(p,"reference-size");m&&void 0!==s&&m.sizeStops[0].value<s&&(s=m.sizeStops[0].value),m&&void 0!==a&&m.sizeStops[1].value>a&&(a=m.sizeStops[1].value),c.histogram({layer:h,view:d,field:e.field??void 0,valueExpression:e.expression??void 0,numBins:50,minValue:(0,n.S)(s)?s:i.min??void 0,maxValue:(0,n.S)(a)?a:i.max??void 0,normalizationField:t,forBinning:"featureReduction"in h&&"binning"===h.featureReduction?.type&&r}).then((e=>{this.histogram=e,this.histogramStatus=n.s.SUCCESS}),(()=>{this.histogramStatus=n.s.FAILED}))}onMinMaxChange(e,t,i){const{statistics:s,smartMappingState:a}=this,o=(0,n.g)(a),l=(0,n.b)(o,"size"),r=(0,n.d)(o,"reference-size"),d=(0,n.d)(o,"spike"),c=(0,n.d)(o,"size")||{};if(!l&&!r&&!d){const i=o.classBreakInfos[0],s=o.classBreakInfos[o.classBreakInfos.length-1];i.minValue=e,i.label=(0,n.aI)(i,this.sizeSlider.precision),s.maxValue=t,s.label=(0,n.aI)(s,this.sizeSlider.precision)}c&&("min"===i?c.minSliderValue=e:c.maxSliderValue=t),r&&("min"===i?r.minSliderValue=e:r.maxSliderValue=t),d&&("min"===i?d.minSliderValue=e:d.maxSliderValue=t);const h=l||r||d?(0,n.aK)(this.getZoomStops(),c?c.minSliderValue:r?r?.minSliderValue:d?.minSliderValue,c?c.maxSliderValue:r?r?.maxSliderValue:d?.maxSliderValue):null;this.zoomButtonNode&&(this.sliderZoomed?this.zoomButtonNode.disabled=!1:!h||h.minMaxSame||!(0,n.S)(h.min)&&!(0,n.S)(h.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1),this.sliderZoomed&&(this.adjustedZoomOptions=this.sizeSlider.zoomOptions,"min"===i?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=t,this.zoomAdjustment="max"));const p=this.getFieldInfo(),m=this.getNormalizationField();this.getHistogram(p,m,s,e,t);(e===c?.minSliderValue&&t===c?.maxSliderValue||e===r?.minSliderValue&&t===r?.maxSliderValue||e===d?.minSliderValue&&t===d?.maxSliderValue)&&(this.sliderZoomed=!1),o.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingSizeSliderChange.emit()}createSizeSliderChangeEvents(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.k)(e),a=(0,n.b)(t,"size"),o=(0,n.d)(t,"reference-size"),l=(0,n.d)(t,"spike"),r=["size-age","color-size-age","type-size-age"].includes(i),d=this.getFieldInfo().simpleFieldType===n.w.DATE;this.sizeSlider&&(this.sizeSlider.watch("zoomOptions",((e,t)=>{this.sliderZoomed&&(t?.min&&!e?.min||t?.max&&!e?.max)&&(this.zigzagClick=!0,this.handleZigzagClick(e))})),this.sizeSlider.on("min-change",(e=>{a||o||l?e.value>this.currentStopValues[0]?(this.sizeSlider.stops.forEach(((e,t)=>{e.value=this.currentStopValues[t]})),this.onMinMaxChange(this.currentStopValues[0],this.sizeSlider.slider.max,"min")):this.onMinMaxChange(e.value,this.sizeSlider.slider.max,"min"):e.value>this.currentBreakValues[0].max?this.onMinMaxChange(this.currentBreakValues[0].max,this.sizeSlider.slider.max,"min"):this.onMinMaxChange(e.value,this.sizeSlider.slider.max,"min")})),this.sizeSlider.on("max-change",(e=>{a||o||l?e.value<this.currentStopValues[this.currentStopValues.length-1]?(this.sizeSlider.stops.forEach(((e,t)=>{e.value=this.currentStopValues[t]})),this.onMinMaxChange(this.sizeSlider.slider.min,this.currentStopValues[this.currentStopValues.length-1],"max")):this.onMinMaxChange(this.sizeSlider.slider.min,e.value,"max"):e.value<this.currentBreakValues[this.currentBreakValues.length-1].min?this.onMinMaxChange(this.sizeSlider.slider.min,this.currentBreakValues[this.currentBreakValues.length-1].min,"max"):this.onMinMaxChange(this.sizeSlider.slider.min,e.value,"max")})),this.sizeSlider.on("thumb-change",(e=>{if(a||o||l){const t=this.sizeSlider.stops;if(d&&!r&&0===e.value)return void(0,s.f)(this.el);this.updateRendererStops(t)}else this.updateRendererBreaks(this.sizeSlider.breaks)})),this.sizeSlider.on("thumb-drag",(t=>{const i=(0,n.g)(e),s=(0,n.d)(i,"reference-size");if(!s&&!l||!["start","drag"].includes(t.state))if(a||s||l){const e=this.sizeSlider.stops;this.updateRendererStops(e)}else this.updateRendererBreaks(this.sizeSlider.breaks)})),this.sizeSlider.on("segment-drag",(()=>{if((0,n.b)(t,"size")||o||l){const e=this.sizeSlider.stops;this.updateRendererStops(e)}})))}updateRendererStops(e){const{smartMappingState:t}=this,i=(0,n.g)(t),s=(0,n.b)(i,"size"),a=(0,n.d)(i,"size"),o=(0,n.d)(i,"reference-size"),l=(0,n.d)(i,"spike");s?.stops||o?.sizeStops||l?.sizeStops?(5===e.length&&(e[0].label=`< ${e[0].value}`,e[1].label=`${e[1].value}`,e[2].label=`${e[2].value}`,e[3].label=`${e[3].value}`,e[4].label=`> ${e[4].value}`),s?s.stops=e:o?o?.sizeStops.forEach(((t,i)=>t.value=e[i].value)):l&&l?.sizeStops.forEach(((t,i)=>t.value=e[i].value))):s&&(s.minDataValue=e[0].value,s.maxDataValue=e[1].value),this.currentStopValues=e.map((e=>e.value));const r=(0,n.aK)(this.getZoomStops(),a?a.minSliderValue:o?o?.minSliderValue:l?.minSliderValue,a?a.maxSliderValue:o?o?.maxSliderValue:l?.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!r||r.minMaxSame||!(0,n.S)(r.min)&&!(0,n.S)(r.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,o?(0,d.q)(t).then((e=>(0,n.t)(t,e)),(e=>this.arcgisSmartMappingSizeSliderError.emit(e))):l?(0,d.r)(t).then((e=>(0,n.t)(t,e)),(e=>this.arcgisSmartMappingSizeSliderError.emit(e))):(0,n.t)(t)}updateRendererBreaks(e){const{smartMappingState:t}=this,i=(0,n.g)(t);i.authoringInfo.classificationMethod="manual",i.classBreakInfos.forEach(((t,i)=>{if(t.minValue!==e[i].min||t.maxValue!==e[i].max){t.minValue=e[i].min,t.maxValue=e[i].max;const s=i>0?"> ":"";t.label=`${s} ${(0,n.aI)(t,this.sizeSlider.precision)}`,this.currentBreakValues[i].min=e[i].min,this.currentBreakValues[i].max=e[i].max}})),(0,n.t)(t),this.arcgisSmartMappingSizeSliderChange.emit()}getDefaultDataRange(e){if(e.simpleFieldType===n.w.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.k)(e),s=(0,n.b)(t,"size"),a=(0,n.r)(e),o=["color-size","color-age-size","color-size-age","type-size","type-size-age"].includes(i)&&a.length>1?a[1]:"relationship-size"===i?a[2]:a[0];return o.field||(o.expression=s?.valueExpression??t.valueExpression??null,o.expressionTitle=s?.valueExpressionTitle??t.valueExpressionTitle??null),o}handleZigzagClick(e){const{statistics:t,smartMappingState:i}=this,s=(0,n.g)(i),a=(0,n.d)(s,"size")||{},o=(0,n.d)(s,"reference-size")||{},l=(0,n.d)(s,"spike")||{},r=this.getFieldInfo(),d=this.getNormalizationField(),c=a?a.minSliderValue===a.maxSliderValue:o?o.minSliderValue===o.maxSliderValue:l.minSliderValue===l.maxSliderValue;this.getHistogram(r,d,t,e?.min??(c?t.min:a?.minSliderValue??o?.minSliderValue??l?.minSliderValue??t.min),e?.max??(c?t.max:a?.maxSliderValue??o?.maxSliderValue??l?.maxSliderValue??t.max)),e||(this.sliderZoomed=!1)}getNormalizationField(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.b)(t,"size"),s=(0,n.d)(t,"reference-size"),a=(0,n.d)(t,"spike");return i?i.normalizationField:s?s.normalizationField:a?a.normalizationField:t.normalizationField}getZoomStops(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.b)(t,"size"),s=(0,n.d)(t,"reference-size"),a=(0,n.d)(t,"spike");return i?[{value:i.minDataValue},{value:i.maxDataValue}]:s?[{value:s.sizeStops[0].value},{value:s.sizeStops[1].value}]:[{value:a.sizeStops[0].value},{value:a.sizeStops[1].value}]}get el(){return(0,s.a)(this)}};T.style=".slider-box {\n  height: 320px;\n\n  .esri-size-slider,\n  .esri-classed-size-slider {\n    min-width: 200px;\n  }\n\n  .esri-size-slider .esri-slider .esri-slider__content,\n  .esri-classed-size-slider .esri-slider .esri-slider__content {\n    height: 175px;\n  }\n\n  .esri-size-slider__histogram-container,\n  .esri-classed-size-slider__histogram-container {\n    width: 85px;\n  }\n\n  .esri-size-slider .esri-slider .esri-slider__label,\n  .esri-size-slider .esri-slider .esri-slider__min,\n  .esri-size-slider .esri-slider .esri-slider__max,\n  .esri-classed-size-slider .esri-slider .esri-slider__label,\n  .esri-classed-size-slider .esri-slider .esri-slider__min,\n  .esri-classed-size-slider .esri-slider .esri-slider__max {\n    text-decoration: underline;\n  }\n  .esri-size-slider .esri-slider .esri-slider__label:hover,\n  .esri-size-slider .esri-slider .esri-slider__min:hover,\n  .esri-size-slider .esri-slider .esri-slider__max:hover,\n  .esri-classed-size-slider .esri-slider .esri-slider__label:hover,\n  .esri-classed-size-slider .esri-slider .esri-slider__min:hover,\n  .esri-classed-size-slider .esri-slider .esri-slider__max:hover {\n    border: 1px solid #bbb;\n    background-color: #f3f3f3;\n    text-decoration: none;\n    z-index: 1;\n  }\n}\n\n.slider-box-buttons-front {\n  display: flex;\n}\n\n.slider-container {\n  overflow: hidden;\n}\n";const B=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSymbolPairButtonChange=(0,s.c)(this,"arcgisSmartMappingSymbolPairButtonChange",7),this.arcgisSmartMappingSymbolPairButtonBeforeOpen=(0,s.c)(this,"arcgisSmartMappingSymbolPairButtonBeforeOpen",7),this.arcgisSmartMappingSymbolPairButtonError=(0,s.c)(this,"arcgisSmartMappingSymbolPairButtonError",7),this.manager=(0,h.u)(this),this.smartMappingState=(0,r.u)(),this.symbolType=void 0}arcgisSmartMappingClosePopoversHandler(){this.symbolPairPopoverNode&&(this.symbolPairPopoverNode.parentNode?.removeChild(this.symbolPairPopoverNode),this.symbolPairPopoverNode=void 0)}componentWillLoad(){const{smartMappingState:e,symbolType:t}=this,{strings:i}=e;this.flowItemNode=(0,a.f)(this.el,"calcite-flow-item");const s=(0,n.k)(e);this.allSymbolPairs="above-and-below"===t?[["single",i.symbolPairButton.singleSymbol],["circle",i.symbolPairButton.circles],["square",i.symbolPairButton.squares],["caret",i.symbolPairButton.chevrons],["circle-caret",i.symbolPairButton.circlesChevrons],["arrow",i.symbolPairButton.arrows],["circle-arrow",i.symbolPairButton.circleArrows],["plus-minus",i.symbolPairButton.plusMinus],["circle-plus-minus",i.symbolPairButton.circlePlusMinus],["happy-sad",i.symbolPairButton.faces],["triangle",i.symbolPairButton.triangles],["thumb",i.symbolPairButton.thumbs]]:"reference-size"===t?[["circle",i.symbolPairButton.circles],["square",i.symbolPairButton.squares],["diamond",i.symbolPairButton.diamonds],["hexagon-pointy",i.symbolPairButton.hexagonsPointy],["hexagon-flat",i.symbolPairButton.hexagonsFlat]]:[["triangle-solid-fill-open",i.symbolPairButton.solidFill],["triangle-solid-fill-open-outline",i.symbolPairButton.solidFillOpenOutline],["triangle-solid-fill-closed-outline",i.symbolPairButton.solidFillClosedOutline],["triangle-open-outline",i.symbolPairButton.openOutline],["triangle-closed-outline",i.symbolPairButton.closedOutline]],"spike"===t&&"color-size"!==s&&this.allSymbolPairs.unshift(["triangle-gradient-fill-open",i.symbolPairButton.gradientFill],["triangle-gradient-fill-open-outline",i.symbolPairButton.gradientFillOpenOutline])}render(){const{smartMappingState:e,symbolType:t}=this,{strings:i}=e,a=(0,n.g)(e),o=a.authoringInfo,l=(0,n.d)(a,"reference-size"),r=(0,n.d)(a,"spike"),d="above-and-below"===t?o.univariateSymbolStyle:"reference-size"===t?l?.referenceSizeSymbolStyle:r?.spikeSymbolStyle;let c=i.symbolPairButton.singleSymbol;return this.allSymbolPairs.forEach((e=>{d===e[0]&&(c=e[1])})),"custom"===d&&(c=i.symbolPairButton.custom),(0,s.h)("calcite-label",{key:"59010d6eeb11e438cc5d9dcfdd2e2622b66d3ce3"},"above-and-below"===t?i.symbolPairButton.symbolPair:"reference-size"===t?i.symbolPairButton.referenceSizeShape:i.symbolPairButton.spikeShape,(0,s.h)("calcite-button",{key:"c0e8ecb6043ede31e7a536f7046cd5619db02b45",ref:e=>this.symbolPairButtonNode=e,alignment:"icon-end-space-between",iconEnd:"chevron-down",appearance:"outline-fill",width:"full",role:"button",kind:"neutral","aria-haspopup":"true",label:i.symbolPairButton.symbolPair,onClick:()=>this.toggleSymbolPairPopover()},c))}toggleSymbolPairPopover(){if(this.symbolPairPopoverNode)return void this.closeSymbolPairPopover();const{smartMappingState:e,symbolType:t}=this;this.arcgisSmartMappingSymbolPairButtonBeforeOpen.emit();const i=document.createElement("arcgis-smart-mapping-symbol-pair-popover");i.smartMappingState=e,this.symbolPairPopoverNode=i,i.popoverProps={refElement:this.flowItemNode,placement:"leading",offsetDistance:0,popoverWidth:1.05*this.flowItemNode.getBoundingClientRect().width,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!1},i.symbolPairs=this.allSymbolPairs,i.addEventListener("arcgisSmartMappingSymbolPairPopoverClose",(()=>this.closeSymbolPairPopover())),i.addEventListener("arcgisSmartMappingSymbolPairPopoverChange",(i=>{this.closeSymbolPairPopover();const{layer:a,mapView:o}=this.smartMappingState,r=i.detail,c=(0,n.g)(e),h=(0,n.d)(c,"reference-size"),p=(0,n.d)(c,"spike"),m="above-and-below"===t?{symbolStyle:r}:"reference-size"===t?{layer:a,view:o,fieldInfos:[{field:h?.field}],theme:"reference-size",referenceSizeOptions:{symbolStyle:r},normalizationField:h?.normalizationField}:{layer:a,view:o,fieldInfos:[{field:p?.field}],theme:"spike",spikeOptions:{symbolStyle:r},normalizationField:p?.normalizationField},g="above-and-below"===t?u.e:d.c;(0,l.r)(g(e,m),this.flowItemNode).then((async t=>{if(h){const t=await(0,d.q)(e,{referenceSizeOptions:{symbolStyle:r}});t&&(0,n.t)(e,t)}else if(p){const t=await(0,d.r)(e,{spikeOptions:{symbolStyle:r}});t&&(0,n.t)(e,t)}else(0,n.t)(e,t.renderer);(0,s.f)(this.el),this.arcgisSmartMappingSymbolPairButtonChange.emit()}),(e=>this.arcgisSmartMappingSymbolPairButtonError.emit(e)))})),i.addEventListener("arcgisSmartMappingSymbolPairPopoverDisconnected",(()=>this.closeSymbolPairPopover())),(0,n.P)(this.flowItemNode,!0),document.body.appendChild(i)}closeSymbolPairPopover(){this.symbolPairPopoverNode?.parentNode?.removeChild(this.symbolPairPopoverNode),this.symbolPairPopoverNode=void 0,(0,n.P)(this.flowItemNode,!1),setTimeout((()=>{this.symbolPairButtonNode?.setFocus()}),300)}get el(){return(0,s.a)(this)}};B.style=".symbol-pair-name{display:flex;padding:6px;justify-content:space-between;align-items:center;border-radius:0;cursor:pointer;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);outline-color:var(--calcite-color-foreground-3);outline-width:1px;outline-style:solid;box-shadow:transparent 0px 0px 0px 1px inset}.symbol-pair-name:hover{outline-width:2px}.symbol-pair-name:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}";const F=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSymbolPairPopoverClose=(0,s.c)(this,"arcgisSmartMappingSymbolPairPopoverClose",7),this.arcgisSmartMappingSymbolPairPopoverChange=(0,s.c)(this,"arcgisSmartMappingSymbolPairPopoverChange",7),this.arcgisSmartMappingSymbolPairPopoverDisconnected=(0,s.c)(this,"arcgisSmartMappingSymbolPairPopoverDisconnected",7),this.manager=(0,h.u)(this),this.resizeObserver=new ResizeObserver((e=>{const t=e.pop();this.width=1.05*t.contentRect.width})),this.popoverProps=void 0,this.symbolPairs=void 0,this.smartMappingState=void 0,this.width=void 0}async setFocus(){await(this.calcitePopoverNode?.setFocus())}componentDidLoad(){requestAnimationFrame((async()=>await(this.calcitePopoverNode?.setFocus()))),this.resizeObserver.observe(this.popoverProps.refElement)}disconnectedCallback(){this.arcgisSmartMappingSymbolPairPopoverDisconnected.emit(),this.resizeObserver.unobserve(this.popoverProps.refElement)}render(){const{smartMappingState:e}=this,{isRTL:t,strings:i}=e,a=(0,n.g)(e),o=(0,n.d)(a,"reference-size"),l=(0,n.d)(a,"spike"),r=this.popoverProps,d=r.refElement.getBoundingClientRect().height-105-50,c=o?i.symbolPairButton.referenceSizeShape:l?i.symbolPairButton.spikeShape:i.symbolPairButton.symbolPair;return(0,s.h)(s.H,{key:"9cee002a2f03611c94bfc36628e68d1cab91a599",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"50fb19be6c47f06716a71991769c18c0f34e525f",class:"js-app-flyout symbol-pair-popover",ref:e=>this.calcitePopoverNode=e,dir:t?"rtl":"ltr",placement:"leading-start",open:!0,heading:c,closable:!0,pointerDisabled:!0,referenceElement:r.refElement,offsetDistance:r.offsetDistance||10-(r.popoverWidth||this.width),offsetSkidding:105,overlayPositioning:r.overlayPositioning,triggerDisabled:!0,label:c,onCalcitePopoverClose:()=>this.arcgisSmartMappingSymbolPairPopoverClose.emit()},(0,s.h)("div",{key:"eb98f98a7666f0d98597be211a1dab122ceb6784",class:"content",style:{width:`${this.width??r.popoverWidth}px`,maxHeight:.9*d+"px"}},(0,s.h)("calcite-list",{key:"625e32e535fd69da321f67c68b172bc9275f7c51",label:c,selectionMode:"single-persist"},this.renderItems()))))}renderItems(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=t.authoringInfo,s=(0,n.d)(t,"reference-size"),a=(0,n.d)(t,"spike"),o=s?s.referenceSizeSymbolStyle:a?a.spikeSymbolStyle:i.univariateSymbolStyle||"single",l=[];return this.symbolPairs.forEach((e=>l.push(this.renderItem(e[0],e[1],o===e[0])))),l}renderItem(e,t,i){const{smartMappingState:a}=this,o=(0,n.g)(a),l=o.authoringInfo,r=(0,n.d)(o,"reference-size"),d=(0,n.d)(o,"spike"),c=`${e.charAt(0).toUpperCase()}${e.slice(1)}.svg`,h=r?`ReferenceSize_${c}`:d?`Spike_${c}`:c;return(0,s.h)("calcite-list-item",{label:t,selected:i,onClick:()=>{(r?r.referenceSizeSymbolStyle:l.univariateSymbolStyle||"single")!==e&&this.arcgisSmartMappingSymbolPairPopoverChange.emit(e)},onKeyDown:t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopPropagation(),this.arcgisSmartMappingSymbolPairPopoverChange.emit(e))}},"single"!==e?(0,s.h)("calcite-action",{scale:"s",slot:"actions-end",text:"symbol-pair-symbols"},(0,s.h)("div",{style:{width:"32px",height:"32px",backgroundImage:`url(${(0,s.g)("./assets/smart-mapping-symbol-pair-images/")}${h})`}})):null)}get el(){return(0,s.a)(this)}};var E;F.style=".symbol-pair-popover{--calcite-popover-z-index:100;}.content{overflow-y:auto}",function(e){e.highToLow="HighToLow.svg",e.aboveAndBelow="AboveAndBelow.svg",e.above="Above.svg",e.below="Below.svg",e.centeredOn="CenteredOn.svg",e.extremes="Extremes.svg",e.referenceSize="ReferenceSize.svg",e.spike="Spike.svg"}(E||(E={}));const R=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingThemeButtonChange=(0,s.c)(this,"arcgisSmartMappingThemeButtonChange",7),this.arcgisSmartMappingThemeButtonBeforeOpen=(0,s.c)(this,"arcgisSmartMappingThemeButtonBeforeOpen",7),this.manager=(0,h.u)(this),this.open=!1,this.themeInfos=[],this.smartMappingState=(0,r.u)(),this.rendererSubtype=void 0,this.buttonVersion="default"}async setFocus(){"minimal"===this.buttonVersion?await this.buttonNode.setFocus():this.buttonNode?.focus()}componentWillLoad(){this.populateThemeInfo(),this.setSelection()}componentWillUpdate(){const e=(0,n.z)(this.smartMappingState,this.rendererSubtype);this.selectedThemeInfo?.value!==e&&this.setSelection()}disconnectedCallback(){(0,n.J)()}render(){return(0,s.h)(s.H,{key:"d7a0f349a6995be230b972177a331b354fc0357f"},"minimal"===this.buttonVersion?this.renderMinimalButton():this.renderDefaultButton())}renderDefaultButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-label",null,e.themeButton.theme,(0,s.h)("div",{class:"theme-button",role:"button",tabindex:"0","aria-haspopup":"true","aria-label":e.themeButton.selectTheme,ref:e=>this.buttonNode=e,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.openThemeDropdown())},onClick:()=>this.openThemeDropdown()},(0,s.h)("div",{class:"theme-content"},(0,s.h)("div",{class:"theme-button-icon",style:{backgroundImage:`url(${(0,s.g)("./assets/smart-mapping-dropdown-images/")}${this.selectedThemeInfo.iconPath})`}}),(0,s.h)("div",{class:"theme-sub-content"},(0,s.h)("div",{class:"theme-button-text"},(0,s.h)("div",{class:"theme-button-title"},this.selectedThemeInfo.title),(0,s.h)("div",{class:"theme-button-msg"},this.selectedThemeInfo.msg)),(0,s.h)("div",null,(0,s.h)("calcite-icon",{scale:"s",icon:"chevron-down"}))))))}renderMinimalButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-label",{onClick:e=>e.stopImmediatePropagation()},e.themeButton.theme,(0,s.h)("calcite-button",{class:"calcite-theme-button",alignment:"icon-end-space-between",iconEnd:"chevron-down",appearance:"outline-fill",width:"full",role:"button",kind:"neutral","aria-haspopup":"true",label:e.themeButton.selectTheme,ref:e=>this.buttonNode=e,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.openThemeDropdown())},onClick:()=>this.openThemeDropdown()},this.selectedThemeInfo.title))}setSelection(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=t.authoringInfo,s=(0,n.d)((0,n.g)(e),"color"),a=(0,n.d)((0,n.g)(e),"size"),o=(0,n.d)(t,"reference-size"),l=(0,n.d)(t,"spike"),r=o&&"size"===this.rendererSubtype?"reference-size":l&&"size"===this.rendererSubtype?"spike":i?.univariateTheme||("size"===this.rendererSubtype?a?.theme:s?.theme);this.selectedThemeInfo=r?this.themeInfos.find((e=>e.value===r)):this.themeInfos.find((e=>"high-to-low"===e.value)),this.themeInfos.forEach((e=>{e.selected=e.value===this.selectedThemeInfo.value}))}closeDropdown(){this.open=!1,this.dropdownNode&&(this.dropdownNode.parentNode?.removeChild(this.dropdownNode),this.dropdownNode=void 0,this.buttonNode.classList.remove("active"))}openThemeDropdown(){const{smartMappingState:e}=this;if(this.open)this.closeDropdown();else{this.arcgisSmartMappingThemeButtonBeforeOpen.emit();const t=document.createElement("arcgis-smart-mapping-dropdown");t.smartMappingState=e,t.buttonNode=this.buttonNode,t.infos=this.themeInfos,this.dropdownNode=t,t.addEventListener("arcgisSmartMappingDropdownClose",(e=>{this.closeDropdown(),"Escape"===e.detail&&this.setFocus()})),t.addEventListener("arcgisSmartMappingDropdownChange",(e=>this.setTheme(e.detail))),t.addEventListener("arcgisSmartMappingDropdownDisconnected",(()=>this.closeDropdown())),this.buttonNode.classList.add("active"),document.body.appendChild(t),this.open=!0}}setTheme(e){const{smartMappingState:t}=this,i=(0,n.z)(t,this.rendererSubtype),s=e.value;if(s===i)return this.closeDropdown(),void setTimeout((()=>{this.setFocus()}),300);for(let e=0;e<this.themeInfos.length;e++)this.themeInfos[e].selected=this.themeInfos[e].value===s;this.selectedThemeInfo=e,this.arcgisSmartMappingThemeButtonChange.emit(s),this.closeDropdown(),setTimeout((()=>{this.setFocus()}),300)}populateThemeInfo(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:i,strings:s}=e,a=i&&t.version>=11,o=(0,n.k)(e),l=["color-age","size-age"].includes(o)||"size"!==this.rendererSubtype&&["color-age-size"].includes(o)||"size"===this.rendererSubtype&&["color-size-age","type-size-age"].includes(o),r=(0,n.g)(e),d=r.authoringInfo,c="univariate-color-size"===d?.type,h="color-size"===o&&c?(0,n.b)((0,n.g)(e),"size"):(0,n.b)((0,n.g)(e),this.rendererSubtype),p=(0,n.d)(r,"reference-size"),m=(0,n.d)(r,"spike"),u=h?h.field:p?p.field:m?m.field:r.field,g=(0,n.y)(e,u),f=g?.simpleFieldType===n.w.DATE&&!l,S="color-size"===o&&c?"ColorAndSize_":"color"===this.rendererSubtype?"Color_":"Size_";this.themeInfos.push({value:"high-to-low",title:f?s.themeButton.newToOld:s.themeButton.highToLow,msg:f?s.themeButton[this.rendererSubtype].newToOldMsg:s.themeButton[this.rendererSubtype].highToLowMsg,iconPath:`${S}${E.highToLow}`,selected:!1}),"color"!==o&&("color-size"!==o||"size"===this.rendererSubtype||i&&!a)||this.themeInfos.push({value:"above-and-below",title:f?s.themeButton.beforeAndAfter:s.themeButton.aboveAndBelow,msg:f?s.themeButton[this.rendererSubtype].beforeAndAfterMsg:s.themeButton[this.rendererSubtype].aboveAndBelowMsg,iconPath:`${S}${E.aboveAndBelow}`,selected:!1}),this.themeInfos.push({value:"above",title:f?s.themeButton.after:s.themeButton.above,msg:f?s.themeButton[this.rendererSubtype].afterMsg:s.themeButton[this.rendererSubtype].aboveMsg,iconPath:`${S}${E.above}`,selected:!1}),this.themeInfos.push({value:"below",title:f?s.themeButton.before:s.themeButton.below,msg:f?s.themeButton[this.rendererSubtype].beforeMsg:s.themeButton[this.rendererSubtype].belowMsg,iconPath:`${S}${E.below}`,selected:!1}),"color"===o&&(this.themeInfos.push({value:"centered-on",title:s.themeButton.centered,msg:s.themeButton[this.rendererSubtype].centeredMsg,iconPath:`${S}${E.centeredOn}`,selected:!1}),this.themeInfos.push({value:"extremes",title:s.themeButton.extremes,msg:s.themeButton[this.rendererSubtype].extremesMsg,iconPath:`${S}${E.extremes}`,selected:!1})),!i&&"size"===this.rendererSubtype&&(0,n.S)(g)&&(0,n.e)(e)&&!f&&this.themeInfos.push({value:"reference-size",title:s.themeButton.referenceSize,msg:s.themeButton.size.referenceSizeMsg,iconPath:`${S}${E.referenceSize}`,selected:!1}),i||"size"!==this.rendererSubtype||!(0,n.S)(g)||!(0,n.G)(e)&&!(0,n.e)(e)||f||this.themeInfos.push({value:"spike",title:s.themeButton.spike,msg:s.themeButton.size.spikeMsg,iconPath:`${S}${E.spike}`,selected:!1})}get el(){return(0,s.a)(this)}};R.style=".theme-button{display:flex;padding:6px;justify-content:space-between;align-items:center;border-radius:0;cursor:pointer;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);border-color:var(--calcite-color-foreground-3);border-width:1px;border-style:solid;box-shadow:transparent 0px 0px 0px 1px inset}.theme-button:hover{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}.theme-button:active{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3)}.theme-button:focus{box-shadow:inset 0 0 0 2px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}.theme-button.active,.calcite-theme-button.active{outline:1px solid var(--calcite-ui-focus-color, var(--calcite-color-brand))}.theme-content{display:flex;align-items:center;width:100%}.theme-sub-content{display:flex;justify-content:space-between;align-items:center;width:100%}.theme-button-icon{min-width:16px;background-repeat:no-repeat;height:48px;padding:0;display:inline-block}.theme-button-text{display:inline-block;padding:0 10px}.theme-button-title{font-weight:bold}.theme-button-msg{font-size:80%;line-height:16px}";const P=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingTileSelect=(0,s.c)(this,"arcgisSmartMappingTileSelect",7),this.arcgisSmartMappingTileOptions=(0,s.c)(this,"arcgisSmartMappingTileOptions",7),this.arcgisSmartMappingTileThemeChange=(0,s.c)(this,"arcgisSmartMappingTileThemeChange",7),this.arcgisSmartMappingTileError=(0,s.c)(this,"arcgisSmartMappingTileError",7),this.manager=(0,h.u)(this),this.documentClickHandler=void 0,this.panelScrollHandler=void 0,this.smartMappingState=(0,r.u)(),this.keyupEventHandler=e=>{const{selected:t}=this;" "!==e.key&&"Enter"!==e.key||(e.stopPropagation(),this.removeInfoPopover(),t?this.arcgisSmartMappingTileOptions.emit():this.arcgisSmartMappingTileSelect.emit(),e.preventDefault())},this.keydownEventHandler=e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())},this.clickEventHandler=e=>{const{selected:t}=this;"CALCITE-CHECKBOX"!==e?.target?.nodeName&&"ARCGIS-SMART-MAPPING-THEME-BUTTON"!==e?.target?.nodeName&&(e.stopPropagation(),this.removeInfoPopover(),t?this.arcgisSmartMappingTileOptions.emit():this.arcgisSmartMappingTileSelect.emit(),e.preventDefault())},this.checkboxChangeHandler=e=>{const{selected:t}=this;e.preventDefault();const i=e.target;i.checked?(this.removeInfoPopover(),t?this.arcgisSmartMappingTileOptions.emit():this.arcgisSmartMappingTileSelect.emit()):i.checked=!0},this.tileType="default",this.type=void 0,this.rasterPresetRendererName=void 0,this.selected=!1,this.fields=void 0}async setFocus(){requestAnimationFrame((()=>this.tileNode?.focus()))}componentWillLoad(){this.tileInfo=function(e,t,i,s){const{selectedFields:a,strings:o}=e;let l=(0,n.i)(e)?"raster":(0,n.I)(e);"multipoint"===l&&(l="point");let r=a.length;(0,n.S)(r)||(r=1);const d=(0,n.i)(e)?(0,n.n)(e):(0,n.k)(e);let c=!1,h=!1;switch(a.length&&(c=a[0].simpleFieldType===n.w.DATE||"date-only"===(0,n.y)(e,a[0].field)?.layerField?.type,h=c,a.length>1&&(h=a[1].simpleFieldType===n.w.DATE)),t){case"simple":default:return{title:o.tile.simpleStyle,moreInfo:o.tile.tooltips.location,helpId:"120003675",imageFile:`${l}/Simple.png`};case"color":return{title:c?o.tile.colorStyleDate:o.tile.colorStyle,subText:["gallery","assist"].includes(i)?"":a[0].expressionTitle||a[0].featureReductionExpressionTitle||(0,n.y)(e,a[0].field).label,moreInfo:c?o.tile.tooltips.colorDate:o.tile.tooltips.color,helpId:c?"120003262":"120003251",imageFile:c?`${l}/Color_Time.png`:`${l}/Color.png`};case"size":return{title:"chart-size"!==d||["gallery","assist"].includes(i)?1===r&&c||2===r&&h?o.tile.sizeStyleDate:o.tile.sizeStyle:o.tile.sizeStyleChart,subText:["gallery","assist"].includes(i)?"":"chart-size"===d||"predominance-size"===d?o.sumOfCategories:"relationship-size"===d?a[2].expressionTitle||a[2].featureReductionExpressionTitle||(0,n.y)(e,a[2].field)?.label:a[1].expressionTitle||a[1].featureReductionExpressionTitle||(0,n.y)(e,a[1].field)?.label,moreInfo:"predominance-size"===d?o.tile.tooltips.sizeForPredominance:1===r&&c||2===r&&h?o.tile.tooltips.sizeDate:o.tile.tooltips.size,helpId:1===r&&c||2===r&&h?"120003263":"120003252",imageFile:"chart-size"!==d||["gallery","assist"].includes(i)?1===r&&c||2===r&&h?`${l}/Size_Time.png`:`${l}/Size.png`:`${l}/ChartSizeSize.jpg`};case"type":return{title:c?o.tile.typeStyleDate:o.tile.typeStyle,subText:!["gallery","assist"].includes(i)&&null!=d&&["type-size","type-size-age"].includes(d)?a[0].expressionTitle||a[0].featureReductionExpressionTitle||(0,n.y)(e,a[0].field).label:"",moreInfo:c?o.tile.tooltips.typeDate:o.tile.tooltips.type,helpId:c?"120003266":"120003260",imageFile:`${l}/Type.png`};case"color-age":return{title:o.tile.colorAgeStyle,subText:["gallery","assist"].includes(i)?"":a[0].expressionTitle||a[0].featureReductionExpressionTitle||(0,n.y)(e,a[0].field).label,moreInfo:o.tile.tooltips.colorAge,helpId:"120003264",imageFile:`${l}/Color_Age.png`};case"size-age":return{title:o.tile.sizeAgeStyle,subText:["gallery","assist"].includes(i)?"":a[1].expressionTitle||a[1].featureReductionExpressionTitle||(0,n.y)(e,a[1].field)?.label,moreInfo:o.tile.tooltips.sizeAge,helpId:"120003265",imageFile:`${l}/Size_Age.png`};case"color-size":return{title:o.tile.colorSizeStyle,moreInfo:c?h?o.tile.tooltips.colorDate_SizeDate:o.tile.tooltips.colorDate_Size:h?o.tile.tooltips.color_SizeDate:o.tile.tooltips.color_Size,helpId:"120003254",imageFile:c||h?`${l}/ColorSize_Time.png`:`${l}/ColorSize.png`};case"color-age-size":return{title:o.tile.colorAgeSizeStyle,moreInfo:o.tile.tooltips.colorAge_Size,helpId:"120003267",imageFile:`${l}/ColorSize_Age.png`};case"color-size-age":return{title:o.tile.colorSizeAgeStyle,moreInfo:o.tile.tooltips.color_SizeAge,helpId:"120003267",imageFile:`${l}/ColorSize_Age.png`};case"type-size":return{title:o.tile.typeSizeStyle,moreInfo:c?o.tile.tooltips.typeDate_Size:h?o.tile.tooltips.type_SizeDate:o.tile.tooltips.type_Size,helpId:"120003261",imageFile:h?`${l}/TypeSize_Time.png`:`${l}/TypeSize.png`};case"type-size-age":return{title:o.tile.typeSizeAgeStyle,moreInfo:o.tile.tooltips.type_SizeAge,helpId:"120003268",imageFile:`${l}/TypeSize_Age.png`};case"dot-density":return{title:o.tile.dotDensityStyle,moreInfo:o.tile.tooltips.dotDensity,helpId:"120003253",imageFile:`${l}/DotDensity.png`};case"heatmap":return{title:o.tile.heatmapStyle,moreInfo:o.tile.tooltips.heatMap,helpId:"120003250",imageFile:`${l}/HeatMap.png`};case"relationship":return{title:o.tile.relationshipStyle,subText:["gallery","assist"].includes(i)||"relationship-size"!==d?"":[(0,n.y)(e,a[0].field).label,(0,n.y)(e,a[1].field).label],moreInfo:o.tile.tooltips.relationship,helpId:"120003258",imageFile:`${l}/Relationship.png`};case"relationship-size":return{title:o.tile.relationshipSizeStyle,moreInfo:o.tile.tooltips.relationshipSize,helpId:"120003259",imageFile:`${l}/RelationshipSize.png`};case"predominance":return{title:o.tile.predominanceStyle,moreInfo:o.tile.tooltips.predominance,helpId:"120003256",imageFile:`${l}/Predominance.png`};case"predominance-size":return{title:o.tile.predominanceSizeStyle,moreInfo:o.tile.tooltips.predominanceSize,helpId:"120003257",imageFile:`${l}/PredominanceSize.png`};case"chart":return{title:"chart-size"!==d||["gallery","assist"].includes(i)?o.tile.chartStyle:o.tile.chartStyleColor,moreInfo:o.tile.tooltips.chart,helpId:"120003729",imageFile:`${l}/Chart.jpg`};case"chart-size":return{title:o.tile.chartSizeStyle,moreInfo:o.tile.tooltips.chartSize,helpId:"120003730",imageFile:`${l}/ChartSize.jpg`};case"compare":return{title:o.tile.compareStyle,moreInfo:o.tile.tooltips.compare,helpId:"120003255",imageFile:`${l}/Ratio.png`};case"raster-stretch":return{title:s??o.tile.symbologyStretchStyle,subText:s?o.panels.gallery.customStyle:void 0,moreInfo:o.tile.tooltips.stretch,helpId:"120003269",imageFile:`${l}/stretch.png`};case"raster-rgb":return{title:s??o.tile.symbologyRGBStyle,subText:s?o.panels.gallery.customStyle:void 0,moreInfo:o.tile.tooltips.rgb,helpId:"120003270",imageFile:`${l}/rgb.png`};case"raster-unique-value":return{title:s??o.tile.symbologyUniqueValuesStyle,subText:s?o.panels.gallery.customStyle:void 0,moreInfo:o.tile.tooltips.uniqueValues,helpId:"120003271",imageFile:`${l}/uniqueValues.png`};case"raster-shaded-relief":return{title:s??o.tile.symbologyShadedReliefStyle,subText:s?o.panels.gallery.customStyle:void 0,moreInfo:o.tile.tooltips.shadedRelief,helpId:"120003273",imageFile:`${l}/shadedRelief.png`};case"raster-vector-field":return{title:s??o.tile.symbologyVectorFieldStyle,subText:s?o.panels.gallery.customStyle:void 0,moreInfo:o.tile.tooltips.vectorField,helpId:"120003275",imageFile:`${l}/vectorField.png`};case"raster-colormap":return{title:s??o.tile.symbologyColormapStyle,subText:s?o.panels.gallery.customStyle:void 0,moreInfo:o.tile.tooltips.colormap,helpId:"120003274",imageFile:`${l}/colormap.png`};case"raster-class-breaks":return{title:s??o.tile.symbologyClassBreaksStyle,subText:s?o.panels.gallery.customStyle:void 0,moreInfo:o.tile.tooltips.classify,helpId:"120003272",imageFile:`${l}/classBreaks.png`};case"raster-flow":return{title:s??o.tile.rasterFlowStyle,subText:s?o.panels.gallery.customStyle:void 0,moreInfo:o.tile.tooltips.flow,helpId:"120003676",imageFile:`${l}/flow.png`}}}(this.smartMappingState,this.type,this.tileType,this.rasterPresetRendererName)}componentDidLoad(){this.flowItemNode=(0,a.f)(this.el,"calcite-flow-item")}disconnectedCallback(){this.removeInfoPopover()}render(){const{selected:e,tileInfo:t,tileType:i,smartMappingState:a}=this,{title:n,imageFile:o}=t,{strings:l}=a,r="rtl"===(0,f.b)(this.el),d={tile:!0,"tile-selected":e},c={"tile-image":"assist"!==i,"tile-image-selected":("gallery"===i||"raster-gallery"===i)&&e,rtl:r},h={"tile-check":!0,rtl:r};return(0,s.h)(s.H,{key:"0d44d6fc32da477fd47197378fcbf1c158ad18bf","aria-label":`${n} ${e?"assist"===i?l.tile.customize:l.tile.styleOptions:l.tile.selectStyle}`,"aria-selected":e,role:"button",tabindex:"0"},(0,s.h)("div",{key:"d8e95dec77a02be0061054509c1ec335173dd7c2",class:d,tabindex:"0",ref:e=>{e&&(this.tileNode=e,this.addTileListeners(e))}},(0,s.h)("div",{key:"5d4434d2968d5682e59505dfd9519996b335ec31",class:c,style:{backgroundImage:`url(${(0,s.g)("./assets/smart-mapping-thumbnails/")}${o})`},"aria-hidden":"true"}),["gallery","raster-gallery","assist"].includes(i)&&(0,s.h)("div",{key:"4433763092f3e2f22cf1ac2888d9fc2cdead9771",class:h,"aria-label":"","aria-hidden":"true"},(0,s.h)("calcite-checkbox",{key:"f8f4725ea1c2fd3dbe7378ad3dbbbbc880fccce0",name:"style-tile-check-name",checked:e,tabindex:"-1",onCalciteCheckboxChange:this.checkboxChangeHandler})),this.renderTileLink()))}renderTheme(){const{smartMappingState:e}=this,{layer:t}=e,{tileType:i,type:a}=this;if("imagery"===t.type||"imagery-tile"===t.type)return(0,s.h)(s.F,null);if("assist"===i)return(0,s.h)(s.F,null);const o=(0,n.k)(e);if("chart-size"===o)return(0,s.h)(s.F,null);if(!["color","size","color-age","size-age","color-size"].includes(a))return(0,s.h)(s.F,null);if(!["color","size","color-age","size-age","color-size","color-age-size","color-size-age","type-size","type-size-age","relationship-size"].includes(o))return(0,s.h)(s.F,null);if("gallery"===i&&["type-size","relationship-size","color-age-size","color-size-age","type-size-age"].includes(o))return(0,s.h)(s.F,null);const l=(0,n.g)(e),r=l.authoringInfo,d="univariate-color-size"===r?.type,c=(0,n.d)(l,"reference-size"),h=(0,n.d)(l,"spike");if("gallery"===i&&"color-size"===o&&!d)return(0,s.h)(s.F,null);const p=(0,n.b)(l,"color");if("gallery"===i&&"color"===o&&!p)return(0,s.h)(s.F,null);const m=(0,n.b)(l,"size");if("gallery"===i&&"size"===o&&!m&&!c&&!h)return(0,s.h)(s.F,null);const u="color-age"===a?"color":"size-age"===a?"size":"color-size"===a?"colorSize":a;return(0,s.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:u,buttonVersion:"minimal",onArcgisSmartMappingThemeButtonBeforeOpen:()=>(0,n.J)(),onArcgisSmartMappingThemeButtonChange:e=>this.changeTheme(e)})}changeTheme(e){const{smartMappingState:t}=this,{layer:i,mapView:a}=t,{type:o}=this,r=(0,n.g)(t),c=(0,n.k)(t),h=(0,n.b)(r,"size"),p=(0,n.d)((0,n.g)(t),"reference-size"),m=(0,n.d)(r,"spike"),g=r.authoringInfo,f="univariate-color-size"===g?.type;if("color"!==o&&"color-age"!==o||!["color","color-age","color-size","color-age-size","color-size-age"].includes(c))if("size"!==o&&"size-age"!==o||!["size","size-age","color-size","color-age-size","color-size-age","type-size","type-size-age","relationship-size"].includes(c))"color-size"===o&&f&&(0,l.r)((0,u.e)(t,{theme:e.detail}),this.flowItemNode).then((e=>{(0,n.t)(t,e.renderer),(0,s.f)(this.el),(0,s.f)(this.themeButtonNode)}),(e=>{(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingTileError.emit(e)}));else{const o=p,r="reference-size"===e.detail,u=!o&&r||o&&!r,g=m,f="spike"===e.detail,S=!g&&f||g&&!f;let b=d.c;["size-age","color-size-age","type-size-age"].includes(c)?b=d.j:u&&(b=d.c);const y={theme:e.detail};if(r&&(y.referenceSizeOptions={symbolStyle:"circle"}),f){const e="color-size"===c?"triangle-solid-fill-open-outline":"triangle-gradient-fill-open";y.spikeOptions={symbolStyle:e}}u&&(y.layer=i,y.mapView=a,y.fieldInfos=[{field:h?h.field:p?p.field:m.field}],y.noReuse=!0),S&&(y.layer=i,y.mapView=a,y.field=h?h.field:m?m.field:p.field,y.noReuse=!0),(0,l.r)(b(t,y),this.flowItemNode).then((async o=>{if(u||S)if(["type-size","relationship-size"].includes(c)){const{smartMappingState:e}=this,{modules:t}=e,i=(0,n.g)(e);i.visualVariables=o.renderer.visualVariables,i.authoringInfo.visualVariables=o.renderer.authoringInfo.visualVariables,i.uniqueValueInfos.forEach((i=>{const s=(0,n.h)(e,i?.symbol)||new t.EsriColor("gray"),a=o.renderer.classBreakInfos[0].symbol.clone();"cim"===a.type?t.cimSymbolUtils.applyCIMSymbolColor(a,s,{layersToColor:"fill-and-outline"}):(0,n.j)(e,a,s),i.symbol=a})),i.defaultSymbol=void 0,i.defaultLabel=void 0,i.backgroundFillSymbol=void 0,(0,n.t)(e,i)}else if("color-size"===c){const{smartMappingState:e}=this,{modules:t,useFeatureReduction:s}=e,l=(0,n.g)(e),r=(0,n.b)(l,"color"),d=(0,n.d)(l,"color"),{renderer:c}=await t.ColorCreator.createContinuousRenderer({layer:i,view:a,field:r.field,valueExpression:r.valueExpression??void 0,valueExpressionTitle:r.valueExpressionTitle??void 0,normalizationField:r.normalizationField??void 0,theme:d?.theme,colorScheme:(0,n.aD)(e),forBinning:"binning"===i.featureReduction?.type&&s});if(o.renderer.visualVariables.push(r),c.authoringInfo?.visualVariables?.length){const e=(0,n.d)(c,"color");o.renderer.authoringInfo.visualVariables.push(e)}o.renderer.field=r.field,o.renderer.valueExpression=r.valueExpression,o.renderer.valueExpressionTitle=r.valueExpressionTitle,o.renderer.normalizationField=r.normalizationField,(0,n.t)(e,o.renderer)}else(0,n.t)(t,o.renderer);else if(["size","size-age"].includes(c))(0,n.t)(t,o.renderer);else{const e=(0,n.g)(t);e.visualVariables=(0,n.a)(e,"size")||[],e.visualVariables.push((0,n.b)(o.renderer,"size")),e.authoringInfo.visualVariables=(0,n.c)(e,"size")||[],e.authoringInfo.visualVariables.push((0,n.d)(o.renderer,"size")),(0,n.t)(t)}(0,s.f)(this.el),(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingTileThemeChange.emit(e.detail)}),(async e=>{(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingTileError.emit(e)}))}else{let i=l.b;["color-age","color-age-size"].includes(c)&&(i=l.c),(0,l.r)(i(t,{theme:e.detail}),this.flowItemNode).then((e=>{if(["color-size","color-age-size","color-size-age"].includes(c)){const i=(0,n.g)(t);i.visualVariables=(0,n.a)(i,"color")||[],i.visualVariables.push((0,n.b)(e.renderer,"color")),i.authoringInfo.visualVariables=(0,n.c)(i,"color")||[],i.authoringInfo.visualVariables.push((0,n.d)(e.renderer,"color")),(0,n.t)(t)}else(0,n.t)(t,e.renderer);(0,s.f)(this.el),(0,s.f)(this.themeButtonNode)}),(e=>{(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingTileError.emit(e)}))}}renderTileLink(){const{selected:e,tileInfo:t,tileType:i,fields:a,smartMappingState:n,rasterPresetRendererName:o}=this,{title:l,subText:r}=t,{strings:d}=n;return(0,s.h)("div",{class:"style-link","aria-label":l},(0,s.h)("div",{class:"style-link-title "+("gallery"===i||"raster-gallery"===i&&!o?"info":"")},(0,s.h)("div",{"aria-hidden":"true"},l),("gallery"===i||"raster-gallery"===i&&!o)&&(0,s.h)("calcite-button",{class:"style-link-info",scale:"s",iconStart:"information",appearance:"transparent",kind:"neutral",onClick:e=>this.handleInfoClick(e),label:d.tile.moreInfo,ref:e=>{e&&(this.infoIconNode=e,e.addEventListener("keyup",(e=>{e.stopPropagation(),(" "===e.key||!this.infoPopoverNode&&"Enter"===e.key)&&this.handleInfoClick(e)})),e.addEventListener("keydown",(e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())})))}}),"gallery"!==i&&r&&(0,s.h)("div",{class:"style-link-sub-text"},"string"==typeof r?r:r.map((e=>(0,s.h)("div",null,e)))),"assist"===i&&!!a?.length&&(0,s.h)("div",{class:"style-link-sub-text"},`${d.tile.fields} ${a.toString().replace(",",", ")}`)),"assist"!==i&&(e||"gallery"!==i)&&this.renderTheme(),(e||!["gallery","raster-gallery","assist"].includes(i))&&this.renderStyleOptions())}renderStyleOptions(){const{tileType:e,smartMappingState:t}=this,{strings:i}=t;return(0,s.h)("calcite-button",{appearance:"outline-fill",width:"full",scale:"s",kind:"assist"===e?"neutral":"brand",label:"assist"===e?i.tile.customize:i.tile.styleOptions},"assist"===e?i.tile.customize:i.tile.styleOptions)}handleInfoClick(e){e.stopPropagation();const{tileInfo:t,flowItemNode:i,smartMappingState:s}=this,{title:a,moreInfo:n,helpId:o}=t,{config:l,strings:r}=s;this.removeInfoPopover(),this.infoPopoverNode=document.createElement("arcgis-smart-mapping-info-popover"),this.infoPopoverNode.smartMappingState=s,this.infoPopoverNode.props={title:a,moreInfo:n,helpId:o,config:l,flowItemNode:i,strings:r},this.infoPopoverNode.referenceElement=this.infoIconNode,this.infoPopoverNode.addEventListener("arcgisSmartMappingInfoPopoverClose",(e=>{e.stopPropagation(),this.removeInfoPopover(),setTimeout((()=>{this.infoIconNode.setFocus()}),200)})),this.infoPopoverNode.addEventListener("arcgisSmartMappingInfoPopoverDisconnected",(e=>{e.stopPropagation(),this.removeInfoPopover()})),document.body.appendChild(this.infoPopoverNode),this.infoPopoverNode.setOpen(!0),setTimeout((()=>{this.infoPopoverNode.setFocus()}),100),setTimeout((()=>{this.documentClickHandler=e=>{(0,d.p)(e.target)||(this.removeInfoPopover(),setTimeout((()=>{this.infoIconNode.setFocus()}),200))},document.addEventListener("click",this.documentClickHandler),this.panelScrollHandler=()=>{this.removeInfoPopover()},i?.addEventListener("calciteFlowItemScroll",this.panelScrollHandler)}),100)}removeInfoPopover(){const{flowItemNode:e}=this;document.body.querySelectorAll(".arcgis-smart-mapping-popover").forEach((e=>document.body.removeChild(e))),this.infoPopoverNode=void 0,this.documentClickHandler&&(document.removeEventListener("click",this.documentClickHandler),this.documentClickHandler=void 0),this.panelScrollHandler&&(e?.removeEventListener("calciteFlowItemScroll",this.panelScrollHandler),this.panelScrollHandler=void 0)}addTileListeners(e){e.addEventListener("keyup",this.keyupEventHandler),e.addEventListener("keydown",this.keydownEventHandler),e.addEventListener("click",this.clickEventHandler)}get el(){return(0,s.a)(this)}};P.style=".tile {\n  background-color: white;\n  position: relative;\n  margin: 6px;\n  cursor: pointer;\n  box-shadow:\n    0 1px 10px 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px #e0e0e0;\n  transition: box-shadow 125ms ease-in-out;\n}\n\n.tile:hover {\n  z-index: 5;\n  box-shadow:\n    0 1px 0 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px #e0e0e0;\n}\n\n.tile:focus {\n  outline: 2px solid var(--calcite-color-brand);\n}\n\n.tile-selected {\n  box-shadow:\n    0 1px 10px 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px var(--calcite-color-brand);\n}\n\n.tile-selected:focus {\n  box-shadow:\n    0 1px 10px 2px rgba(0, 0, 0, 0.05),\n    0 0 0 2px var(--calcite-color-brand);\n}\n\n.tile-selected:hover {\n  z-index: 5;\n  box-shadow:\n    0 1px 0 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px var(--calcite-color-brand);\n}\n\n.tile-check {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n}\n.tile-check.rtl {\n  right: auto;\n  left: 10px;\n}\n.style-link {\n  padding: 9px 9px;\n}\n\n.style-link-title {\n  font-weight: bold;\n  padding-bottom: 5px;\n}\n.style-link-title.info {\n  display: flex;\n}\n.style-link-sub-text {\n  font-size: 80%;\n  padding: 0 0 6px 0;\n  font-weight: normal;\n}\n.style-link-options {\n  color: #0079c1;\n  display: flex;\n  flex-direction: row nowrap;\n  svg {\n    fill: #0079c1;\n  }\n}\n.tile-image {\n  height: 100px;\n  width: 100%;\n  background-size: cover;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.tile-image-selected {\n  height: 68px;\n}\n.tile-image.rtl {\n  transform: scaleX(-1);\n}\n.style-sub-text {\n  font-size: 80%;\n  padding: 0 0 6px 0;\n}\n.style-link-info {\n  height: 18px;\n  margin-top: -2px;\n  margin-inline-start: 5px;\n}\n";const D=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSymbolTransparencyError=(0,s.c)(this,"arcgisSmartMappingSymbolTransparencyError",7),this.manager=(0,h.u)(this),this.isBlockOpen=!1,this.lastSettings={},this.currentStopValues=[],this.zigzagClick=!1,this.zoomExecuting=!1,this.percentLabelFlip=!1,this.styleSheetStatus="not-loaded",this.smartMappingState=(0,r.u)(),this.open=!1,this.histogramStatus=n.s.MISSING,this.statisticsStatus=n.s.MISSING,this.sliderZoomed=!1,this.isLoading=!1}async setFocus(){await(this.blockNode?.setFocus())}async updateStatistics(){this.statisticsStatus=n.s.MISSING,this.statistics=void 0,this.histogramStatus=n.s.MISSING,this.histogram=void 0,this.transparencySlider?.destroy(),this.transparencySlider=void 0,this.sliderZoomed=!1,this.getStatistics()}componentWillLoad(){const e=(0,n.g)(this.smartMappingState),t=(0,n.b)(e,"opacity");this.isBlockOpen=this.open||!!t,this.getStatistics(),this.percentLabelFlip=(0,n.a1)(this.smartMappingState,this.el)}componentDidLoad(){this.flowItemNode=(0,a.f)(this.el,"calcite-flow-item")}render(){const{smartMappingState:e}=this,{config:t,strings:i,mapImageSublayer:a,supportsArcade:o,layer:l}=e,{isBlockOpen:r,isLoading:d}=this,c=(0,n.k)(e);if(a&&!o||"geo-rss"===l.type||"subtype-sublayer"===l.type||!(0,n.aN)(e))return(0,s.h)(s.F,null);const h=["predominance","predominance-size"].includes(c);return(0,s.h)(s.H,null,(0,s.h)("link",{rel:"stylesheet",href:`${t.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,s.f)(this.el)},onError:()=>{this.styleSheetStatus="failed",(0,s.f)(this.el)}}),(0,s.h)("calcite-block",{heading:h?i.transparency.transparencyByPredominance:i.transparency.transparencyByAttribute,collapsible:!0,open:r,loading:d,class:"transparency-block",ref:e=>this.blockNode=e,onCalciteBlockOpen:()=>{this.isBlockOpen||(this.isBlockOpen=!0,(0,n.aQ)(this.blockNode))},onCalciteBlockClose:()=>this.isBlockOpen=!1},this.renderTransparencyToggle()))}renderTransparencyToggle(){const{styleSheetStatus:e,smartMappingState:t}=this,{strings:i}=t,a=(0,n.g)(t),o=(0,n.k)(t),l=(0,n.b)(a,"opacity"),r=["predominance","predominance-size"].includes(o);return(0,s.h)("calcite-block-section",{text:r?i.transparency.transparencyLabelPredominance:i.transparency.transparencyLabel,"toggle-display":"switch",open:!!l,onCalciteBlockSectionToggle:e=>this.handleToggle(e),ref:e=>this.blockSectionNode=e},(0,s.h)("div",{class:"block-section-padding"},l&&"loaded"===e?this.renderContent():l&&"not-loaded"===e||!l&&"loaded"===e?this.renderLoading():null))}renderLoading(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"block-content-loading"},(0,s.h)("calcite-loader",{label:e.loading}))}renderContent(){return(0,s.h)(s.F,null,this.renderAttributes(),this.renderSlider(),this.renderRange(),this.renderLegend())}renderAttributes(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.k)(e);if(["predominance","predominance-size"].includes(i))return(0,s.h)(s.F,null);const a=(0,n.b)(t,"opacity"),o=(0,n.y)(e,a.field),l=a.normalizationField?(0,n.y)(e,a.normalizationField):void 0,r={field:a.field,expression:a.valueExpression,expressionTitle:a.valueExpressionTitle,simpleFieldType:o?o.simpleFieldType:n.w.NUMBER};return(0,s.h)(s.F,null,this.renderAttributeMain(r),this.renderAttributeDividedBy(l))}renderAttributeMain(e){const{fields:t,layer:i,useFeatureReduction:a,strings:o}=this.smartMappingState,l=!("featureReduction"in i&&"binning"===i.featureReduction?.type&&a);return(0,s.h)("arcgis-smart-mapping-attribute-input",{fieldList:t.filter((e=>[n.w.DATE,n.w.NUMBER].includes(e.simpleFieldType))),popoverReferenceElement:this.flowItemNode,selectedField:e,label:o.transparency.field,mode:l?"expression":"simple",onArcgisSmartMappingAttributeInputChange:async e=>{const t=e.detail;await this.getOpacityVisualVariable(t),this.dividedByAttributeInputNode?.clear()},onArcgisSmartMappingAttributeInputError:e=>this.arcgisSmartMappingSymbolTransparencyError.emit(e.detail)})}renderAttributeDividedBy(e){const{smartMappingState:t}=this,{fields:i,strings:a}=t,o=(0,n.g)(t),l=(0,n.b)(o,"opacity"),r=(0,n.y)(t,l.field),d=(l.field,l.valueExpression),c=(l.valueExpressionTitle,r?r.simpleFieldType:n.w.NUMBER);if(d||c!==n.w.NUMBER)return(0,s.h)(s.F,null);return(0,n.N)(t,i).number<2?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-attribute-input",{fieldList:i.filter((e=>e.layerField.name!==l.field&&e.simpleFieldType===n.w.NUMBER)),popoverReferenceElement:this.flowItemNode,label:a.transparency.dividedBy,selectedField:e?{field:e.layerField.name,simpleFieldType:e.simpleFieldType}:void 0,mode:"remove",ref:e=>{e&&(this.dividedByAttributeInputNode=e)},onArcgisSmartMappingAttributeInputChange:async e=>{if(e.detail){const t=e.detail;await this.getOpacityVisualVariable({field:l.field,simpleFieldType:n.w.NUMBER},t.field)}else{const e=(0,n.g)(t),i=(0,n.b)(e,"opacity");await this.getOpacityVisualVariable({field:i.field,simpleFieldType:n.w.NUMBER},void 0)}}})}renderSlider(){const{statisticsStatus:e,histogramStatus:t,sliderZoomed:i,smartMappingState:a}=this;if(e===n.s.FAILED||e===n.s.MISSING)return this.transparencySlider?.destroy(),this.transparencySlider=void 0,(0,s.h)(s.F,null);if(e===n.s.IN_PROGRESS||t===n.s.IN_PROGRESS&&(!this.transparencySlider||this.zoomExecuting))return this.renderTransparencySliderLoading();{const e=this.prepareTransparencySlider();let t=!1;const o=(0,n.g)(a),l=(0,n.b)(o,"opacity");if(!i){const e=(0,n.d)((0,n.g)(a),"opacity"),i=(0,n.aK)(l.stops,e?.minSliderValue,e?.maxSliderValue);(i?.minMaxSame||!(0,S.i)(i?.min)&&!(0,S.i)(i?.max))&&(t=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}return this.currentStopValues=l.stops.map((e=>e.value)),(e||this.transparencySlider)&&this.transparencySlider&&this.transparencySlider.min!==this.transparencySlider.max?(0,s.h)("div",{class:"slider-box"},(0,s.h)("div",{class:"slider-box-buttons-front"},this.renderZoomButton(t),(0,s.h)("div",null,"\xa0"),this.renderResetButton()),(0,s.h)("div",{ref:e=>{e&&this.afterTransparencySliderCreate(e)}})):this.transparencySlider&&this.transparencySlider.min===this.transparencySlider.max?(0,s.h)(s.F,null):this.renderTransparencySliderLoading()}}renderTransparencySliderLoading(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}renderZoomButton(e){const{strings:t}=this.smartMappingState,{sliderZoomed:i}=this;return(0,s.h)("arcgis-smart-mapping-action",{text:t.transparency.zoomSlider,icon:i?"magnifyingGlassMinus":"magnifyingGlassPlus",disabled:e,onClick:()=>this.handleZoomSlider(),ref:e=>this.zoomButtonNode=e})}renderResetButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("arcgis-smart-mapping-action",{text:e.transparency.resetSlider,icon:"undo",onClick:()=>{this.handleResetSlider()}})}renderRange(){const{percentLabelFlip:e,smartMappingState:t}=this,{strings:i}=t,a=(0,n.g)(t),o=(0,n.b)(a,"opacity").stops,l=Math.round(100-100*o[1].opacity),r=Math.round(100-100*o[0].opacity);return this.highInputNode&&(this.highInputNode.value=`${l}`),this.lowInputNode&&(this.lowInputNode.value=`${r}`),(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,i.transparency.transparencyRange),(0,s.h)("div",{class:"transparency-range"},(0,s.h)("div",{class:"transparency-range-item"},(0,s.h)("calcite-label",{scale:"s"},i.transparency.transparencyHighValues,(0,s.h)("calcite-input-number",{prefixText:e?"%":void 0,suffixText:e?void 0:"%",value:""+(100-Math.round(100*o[1].opacity)),min:0,max:100,step:1,scale:"s",numberButtonType:"vertical",ref:e=>this.highInputNode=e,onCalciteInputNumberInput:e=>this.handleRangeChange(e,"high"),label:i.transparency.transparencyHighValues}))),(0,s.h)("div",{class:"transparency-range-item"},(0,s.h)("calcite-label",{scale:"s"},i.transparency.transparencyLowValues,(0,s.h)("calcite-input-number",{prefixText:e?"%":void 0,suffixText:e?void 0:"%",value:""+(100-Math.round(100*o[0].opacity)),min:0,max:100,step:1,scale:"s",numberButtonType:"vertical",ref:e=>this.lowInputNode=e,onCalciteInputNumberInput:e=>this.handleRangeChange(e,"low"),label:i.transparency.transparencyLowValues})))))}renderLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,n.g)(e);let a=!0;const o=(0,n.b)(i,"opacity").legendOptions;return o&&!1===o.showLegend&&(a=!1),(0,s.h)("calcite-label",{class:"include-legend",layout:"inline-space-between"},t.transparency.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:a,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle(),ref:e=>this.includeInLegendNode=e}))}prepareTransparencySlider(){const{statistics:e,histogram:t,histogramStatus:i,sliderZoomed:s,smartMappingState:a}=this,{mapView:l,modules:r}=a,d=(0,n.g)(a),c=(0,n.b)(d,"opacity"),h=(0,n.d)(d,"opacity"),m=(0,n.y)(a,c.field),u={field:c.field,expression:c.valueExpression,expressionTitle:c.valueExpressionTitle,simpleFieldType:m?.simpleFieldType||n.w.NUMBER},g=(0,n.aL)(u);if(i===n.s.IN_PROGRESS)return!1;let f=h?.minSliderValue,b=h?.maxSliderValue;if(({min:f,max:b}=(0,n.aH)({min:f,max:b})),this.transparencySlider){const i=this.transparencySlider;if("dragging"===i.slider?.state)return!0;const d={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:f??e.min,max:b??e.max,stops:r.esriLang.clone(c.stops),hasTimeData:g};g&&(0,o.a)(a,d,l.timeZone),s?this.zigzagClick||(d.zoomOptions=(0,n.aK)(c.stops,h?.minSliderValue,h?.maxSliderValue)):d.zoomOptions=null,this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(d.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.transparencySlider.slider.min=d.zoomOptions.min,d.zoomOptions.min=null):(this.transparencySlider.slider.max=d.zoomOptions.max,d.zoomOptions.max=null)),this.adjustedZoomOptions=void 0,this.zoomAdjustment=void 0,this.transparencySlider.set(d),this.zigzagClick=!1,this.zoomExecuting=!1}else{const i={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},style:{trackFillColor:new r.EsriColor([84,84,84])},min:f??e.min,max:b??e.max,stops:r.esriLang.clone(c.stops),precision:(0,p.g)(c.stops)};g&&(i.hasTimeData=!0,(0,o.a)(a,i,l.timeZone)),this.transparencySlider=new r.OpacitySlider(i),this.transparencySlider&&this.transparencySlider.min===this.transparencySlider.max&&this.transparencySlider.set(i),this.createTransparencySliderChangeEvents()}return(0,S.i)(this.transparencySlider)}createTransparencySliderChangeEvents(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.b)(t,"opacity"),a=(0,n.y)(e,i.field),o={field:i.field,expression:i.valueExpression,expressionTitle:i.valueExpressionTitle,simpleFieldType:a?a.simpleFieldType:n.w.NUMBER},l=(0,n.aL)(o);this.transparencySlider&&(this.transparencySlider.watch("zoomOptions",((e,t)=>{this.sliderZoomed&&(t?.min&&!e?.min||t?.max&&!e?.max)&&(this.zigzagClick=!0,this.handleZigzagClick(e))})),this.transparencySlider.on("min-change",(e=>{e.value>this.currentStopValues[0]?(this.transparencySlider.stops.forEach(((e,t)=>{e.value=this.currentStopValues[t]})),this.onMinMaxChange(this.currentStopValues[0],this.transparencySlider.slider.max,"min")):this.onMinMaxChange(e.value,this.transparencySlider.slider.max,"min")})),this.transparencySlider.on("max-change",(e=>{e.value<this.currentStopValues[this.currentStopValues.length-1]?(this.transparencySlider.stops.forEach(((e,t)=>{e.value=this.currentStopValues[t]})),this.onMinMaxChange(this.transparencySlider.slider.min,this.currentStopValues[this.currentStopValues.length-1],"max")):this.onMinMaxChange(this.transparencySlider.slider.min,e.value,"max")})),this.transparencySlider.on("thumb-change",(e=>{if(l&&0===e.value)return void(0,s.f)(this.el);const t=this.transparencySlider.stops;this.updateRendererStops(t)})),this.transparencySlider.on("thumb-drag",(()=>{const e=this.transparencySlider.stops;this.updateRendererStops(e)})))}afterTransparencySliderCreate(e){if(this.transparencySlider.container)e.append(this.transparencySlider.container);else{const t=document.createElement("div");t.classList.add("slider-container"),e.append(t),this.transparencySlider.container=t}}handleToggle(e){const{smartMappingState:t}=this,{modules:i}=t,a=(0,n.g)(t);(0,n.J)();const o=(0,n.b)(a,"opacity"),l=e.target;if(!(l.open&&o||!l.open&&!o))if(o){const e=(0,n.d)(a,"opacity");this.lastSettings.opacityVisVar=o,this.lastSettings.authOpacityVisVar=e,a.visualVariables=(0,n.a)(a,"opacity")||[],a.authoringInfo.visualVariables=(0,n.c)(a,"opacity")||[],this.sliderZoomed=!1,(0,n.t)(t)}else if(this.lastSettings.opacityVisVar)a.visualVariables=(0,n.a)(a,"opacity")||[],a.visualVariables.push(this.lastSettings.opacityVisVar),a.authoringInfo=a.authoringInfo||new i.AuthoringInfo({}),this.lastSettings.authOpacityVisVar&&(a.authoringInfo.visualVariables=(0,n.c)(a,"opacity")||[],a.authoringInfo.visualVariables.push(this.lastSettings.authOpacityVisVar)),(0,s.f)(this.el),(0,n.t)(t),(0,n.aQ)(this.blockNode);else{const e=(0,n.aR)(t),i=e?e.layerField.name:"";this.getOpacityVisualVariable({field:i,simpleFieldType:n.w.NUMBER})}}async handleResetSlider(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,n.g)(e),s=(0,n.k)(e),a=(0,n.b)(i,"opacity"),o={field:a.field,expression:a.valueExpression,expressionTitle:a.valueExpressionTitle,simpleFieldType:n.w.NUMBER},l=a.normalizationField;if(["predominance","predominance-size"].includes(s))try{this.statisticsStatus=n.s.IN_PROGRESS,this.histogramStatus=n.s.MISSING,await(0,u.d)(e,{includeOpacityVariable:!0}).then((t=>{const s=(0,n.b)(t.renderer,"opacity"),a=(0,n.d)(t.renderer,"opacity");i.visualVariables=(0,n.a)(i,"opacity")||[],i.visualVariables.push(s),i.authoringInfo.visualVariables=(0,n.c)(i,"opacity")||[],i.authoringInfo.visualVariables.push(a),this.includeInLegendNode.checked=!s.legendOptions||!!s.legendOptions.showLegend,(0,n.t)(e),this.updateStatistics(),(0,n.aQ)(this.blockNode)}))}catch(e){this.statisticsStatus=n.s.FAILED,console.log(e)}else this.statisticsStatus=n.s.IN_PROGRESS,this.histogramStatus=n.s.IN_PROGRESS,await b(e,{fieldInfos:[o],normalizationField:l}).then((i=>{const s=(0,n.g)(e);if(i.statistics&&(0,S.i)(i.statistics.min)&&(0,S.i)(i.statistics.max)&&i.statistics.min<=i.statistics.max)i.statistics=(0,n.aH)(i.statistics),this.statistics=i.statistics,this.statisticsStatus=n.s.SUCCESS,this.getHistogram(o,l??void 0,i.statistics,i.statistics.min,i.statistics.max);else if(0===i.statistics?.count){const[e,t]=(0,n.aS)(o);this.statistics={min:e,max:t,avg:(t-e)/2,count:0},this.statisticsStatus=n.s.SUCCESS}else this.statisticsStatus=n.s.FAILED;s.visualVariables=(0,n.a)(s,"opacity")||[],s.visualVariables.push(i.visualVariable),s.authoringInfo=s.authoringInfo||new t.AuthoringInfo({}),s.authoringInfo.visualVariables=(0,n.c)(s,"opacity")||[],s.authoringInfo.visualVariables.push(i.authoringInfo.visualVariables[0]),(0,n.t)(e),this.updateStatistics(),(0,n.aQ)(this.blockNode)})).catch((e=>console.log(e)))}handleZoomSlider(e){if(this.histogramStatus===n.s.IN_PROGRESS)return;this.zoomExecuting=!0;const{smartMappingState:t}=this,i=(0,n.g)(t);this.sliderZoomed=(0,S.i)(e)?!!e:!this.sliderZoomed;const{sliderZoomed:s,statistics:a}=this,o=(0,n.b)(i,"opacity"),l=(0,n.d)(i,"opacity"),r=s?(0,n.aK)(o.stops,l?.minSliderValue??a.min,l?.maxSliderValue??a.max):null,d=(0,n.y)(t,o.field),c=l?.minSliderValue===l?.maxSliderValue;this.getHistogram({field:o.field,expression:o.valueExpression,expressionTitle:o.valueExpressionTitle,simpleFieldType:d?d.simpleFieldType:n.w.NUMBER},o.normalizationField??void 0,a,r?r.min:c?a.min:l?.minSliderValue??a.min,r?r.max:c?a.max:l?.maxSliderValue??a.max)}handleRangeChange(e,t){const{smartMappingState:i}=this,a=e.target;let o=a.value?Number.parseInt(a.value):0;const l=(0,n.g)(i);o<0?o=0:o>100&&(o=100);const r=(0,n.b)(l,"opacity").stops,d=Math.round(100*(1-o/100))/100;"high"===t?r[1].opacity=d:r[0].opacity=d,(0,n.t)(i),(0,s.f)(this.el)}handleIncludeInLegendToggle(){const{smartMappingState:e}=this,t=(0,n.g)(e),i=(0,n.b)(t,"opacity"),s=i.legendOptions;s&&!1===s.showLegend?s?.title?s.showLegend=!0:i.legendOptions=void 0:(i.legendOptions=s||{},i.legendOptions.showLegend=!1),(0,n.t)(e)}updateRendererStops(e){const{smartMappingState:t}=this,i=(0,n.g)(t),s=(0,n.b)(i,"opacity"),a=(0,n.d)(i,"opacity");s.stops=e,this.transparencySlider.stops=e,this.currentStopValues=s.stops.map((e=>e.value));const o=(0,n.aK)(s?.stops,a?.minSliderValue,a?.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!o||o.minMaxSame||!(0,S.i)(o.min)&&!(0,S.i)(o.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,(0,n.t)(t)}async getOpacityVisualVariable(e,t){const{smartMappingState:i}=this,{modules:s}=i,a=(0,n.g)(i),o=(0,n.k)(i);if(this.statistics=void 0,this.histogram=void 0,this.histogramStatus=n.s.MISSING,this.sliderZoomed=!1,this.statisticsStatus=n.s.IN_PROGRESS,["predominance","predominance-size"].includes(o))try{const e=await(0,u.d)(i,{includeOpacityVariable:!0});(0,n.t)(i,e.renderer),this.getStatistics(),(0,n.aQ)(this.blockNode)}catch(e){console.log(e)}else try{const o=await b(i,{fieldInfos:[e],normalizationField:t});if(o.statistics&&(0,S.i)(o.statistics.min)&&(0,S.i)(o.statistics.max)&&o.statistics.min<=o.statistics.max)o.statistics=(0,n.aH)(o.statistics),this.statistics=o.statistics,this.statisticsStatus=n.s.SUCCESS,this.getHistogram(e,t,o.statistics,o.statistics.min,o.statistics.max);else if(0===o.statistics?.count){const[t,i]=(0,n.aS)(e);this.statistics={min:t,max:i,avg:(i-t)/2,count:0},this.statisticsStatus=n.s.SUCCESS}else this.statisticsStatus=n.s.FAILED;a.visualVariables=(0,n.a)(a,"opacity")||[],a.visualVariables.push(o.visualVariable),a.authoringInfo=a.authoringInfo||new s.AuthoringInfo({}),a.authoringInfo.visualVariables=(0,n.c)(a,"opacity")||[],a.authoringInfo.visualVariables.push(o.authoringInfo.visualVariables[0]),(0,n.t)(i),(0,n.aQ)(this.blockNode)}catch(e){this.statisticsStatus=n.s.FAILED,this.blockSectionNode.open=!1,console.log(e)}}getStatistics(){const{smartMappingState:e}=this,{layer:t,useFeatureReduction:i,mapView:s,modules:a}=e,o=t,l=(0,n.g)(e),r=(0,n.b)(l,"opacity");if(!r)return;const d=(0,n.y)(e,r.field),c={field:r.field,expression:r.valueExpression,expressionTitle:r.valueExpressionTitle,simpleFieldType:d?d.simpleFieldType:n.w.NUMBER},h=r.normalizationField??void 0,p=(0,n.d)(l,"opacity");let m=p?.minSliderValue,u=p?.maxSliderValue;this.statisticsStatus=n.s.IN_PROGRESS,!this.statistics&&o&&setTimeout((()=>{a.summaryStatistics({layer:o,view:s,field:c.field??void 0,valueExpression:c.expression??void 0,normalizationField:h,forBinning:"featureReduction"in o&&"binning"===o.featureReduction?.type&&i,outStatisticTypes:{exclude:["median"]}}).then((e=>{if(0===e.count){const[t,i]=(0,n.aS)(c),s=p?.minSliderValue||t,a=p?.maxSliderValue||i;e={min:s,max:a,avg:(a+s)/2,count:0}}else if(!(0,S.i)(e.avg)||!(0,S.i)(e.min)||!(0,S.i)(e.max))return void(this.statisticsStatus=n.s.FAILED);e=(0,n.aH)(e),({min:m,max:u}=(0,n.aH)({min:m,max:u})),m=m??e.min,u=u??e.max,this.statistics=e,this.statisticsStatus=n.s.SUCCESS,this.getHistogram(c,h,e,m,u,!0)}),(e=>{console.log("error-summaryStatistics",e),this.statisticsStatus=n.s.FAILED}))}),300)}getHistogram(e,t,i,s,a,o){const{layer:l,useFeatureReduction:r,mapView:d,modules:c}=this.smartMappingState,h=l;(i=i||this.statistics)&&0!==i.count&&(this.histogramStatus=n.s.IN_PROGRESS,setTimeout((()=>{c.histogram({layer:h,view:d,field:e.field??void 0,valueExpression:e.expression??void 0,numBins:50,minValue:(0,S.i)(s)?s:i.min??void 0,maxValue:(0,S.i)(a)?a:i.max??void 0,normalizationField:t??void 0,forBinning:"featureReduction"in h&&"binning"===h.featureReduction?.type&&r}).then((e=>{this.histogram=e,this.histogramStatus=n.s.SUCCESS}),(e=>{console.log("error-histogram",e),this.histogramStatus=n.s.FAILED}))}),o?0:300))}onMinMaxChange(e,t,i){const{statistics:s,smartMappingState:a}=this,o=(0,n.g)(a),l=(0,n.b)(o,"opacity"),r=(0,n.d)(o,"opacity")||{};"min"===i?r.minSliderValue=e:r.maxSliderValue=t;const d=(0,n.aK)(l?.stops,r.minSliderValue,r.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!d||d.minMaxSame||!(0,S.i)(d.min)&&!(0,S.i)(d.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,this.sliderZoomed&&(this.adjustedZoomOptions=this.transparencySlider.zoomOptions,"min"===i?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=t,this.zoomAdjustment="max"));const c=(0,n.y)(a,l.field),h={field:l.field,expression:l.valueExpression,expressionTitle:l.valueExpressionTitle,simpleFieldType:c?c.simpleFieldType:n.w.NUMBER},p=l.normalizationField;this.getHistogram(h,p,s,e,t),e===r.minSliderValue&&t===r.maxSliderValue&&(this.sliderZoomed=!1)}handleZigzagClick(e){const{statistics:t,smartMappingState:i}=this,s=(0,n.g)(i),a=(0,n.b)(s,"opacity"),o=(0,n.d)(s,"opacity"),l=(0,n.y)(i,a.field),r=a?.normalizationField,d={field:a.field,expression:a.valueExpression,expressionTitle:a.valueExpressionTitle,simpleFieldType:l?l.simpleFieldType:n.w.NUMBER},c=o?.minSliderValue===o?.maxSliderValue;this.getHistogram(d,r,t,e?.min??(c?t.min:o?.minSliderValue??t.min),e?.max??(c?t.max:o?.maxSliderValue??t.max)),e||(this.sliderZoomed=!1)}get el(){return(0,s.a)(this)}};D.style=".block-content-loading {\n  height: 150px;\n}\n\n.transparency-block {\n  overflow: hidden;\n}\n\n.block-section-padding {\n  padding-top: 6px;\n}\n\n.transparency-range {\n  display: flex;\n  justify-content: space-between;\n}\n.transparency-range-item {\n  width: 49%;\n  display: flex;\n  flex-flow: column;\n  justify-content: space-between;\n}\n.include-legend {\n  margin: 10px 0 0 0;\n}\n\n.slider-box {\n  height: 300px;\n\n  .esri-opacity-slider__histogram-container {\n    width: 85px;\n  }\n  .esri-opacity-slider .esri-slider .esri-slider__content {\n    height: 175px;\n  }\n  .esri-opacity-slider {\n    min-width: 200px;\n  }\n  .esri-opacity-slider .esri-slider .esri-slider__label,\n  .esri-opacity-slider .esri-slider .esri-slider__min,\n  .esri-opacity-slider .esri-slider .esri-slider__max {\n    text-decoration: underline;\n  }\n  .esri-opacity-slider .esri-slider .esri-slider__label:hover,\n  .esri-opacity-slider .esri-slider .esri-slider__min:hover,\n  .esri-opacity-slider .esri-slider .esri-slider__max:hover {\n    border: 1px solid #bbb;\n    background-color: #f3f3f3;\n    text-decoration: none;\n    z-index: 1;\n  }\n}\n.slider-box-buttons-front {\n  display: flex;\n}\n\n.slider-container {\n  overflow: hidden;\n}\n"},44735:(e,t,i)=>{function s(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}i.d(t,{i:()=>s})},72513:(e,t,i)=>{i.d(t,{a:()=>l,b:()=>o,g:()=>h,u:()=>n});var s=i(17840),a=i(76744);function n(e,t){const{modules:i}=e,n=(0,a.g)(e),o=i.esriLang.clone(n.classBreakInfos);n.classBreakInfos=[],o.forEach(((i,a)=>{i=function(e,t,i,a,n){const{modules:o}=e;if((0,s.i)(i))if(0===i);else if(i<1){const e=Math.round(1/i);t.minValue="first"===n?Math.floor(t.minValue/i)/e:Math.round(t.minValue/i)/e,t.maxValue="last"===n?Math.ceil(t.maxValue/i)/e:Math.round(t.maxValue/i)/e,t.label=`${a>0?"> ":""}${t.minValue.toLocaleString(o.intl.getLocale(),{maximumSignificantDigits:15})} - ${t.maxValue.toLocaleString(o.intl.getLocale(),{maximumSignificantDigits:15})}`}else t.minValue="first"===n?Math.floor(t.minValue/i)*i:Math.round(t.minValue/i)*i,t.maxValue="last"===n?Math.ceil(t.maxValue/i)*i:Math.round(t.maxValue/i)*i,t.label=`${a>0?"> ":""}${t.minValue.toLocaleString()} - ${t.maxValue.toLocaleString()}`;return t}(e,i,t,a,0===a?"first":a===o.length-1?"last":void 0),n.addClassBreakInfo({minValue:i.minValue,maxValue:i.maxValue,symbol:i.symbol,label:i.label})}))}function o(e,t){const i=(0,a.g)(e).classBreakInfos;let s=t,n=Number.POSITIVE_INFINITY;i.forEach((e=>{s||(s=Math.max(r(e.minValue),r(e.maxValue))),n=Math.min(n,e.maxValue-e.minValue)}));const o=[];return n>1e7?(o.push(1e7),o.push(1e6),o.push(1e5),o.push(1e4),o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01)):n>1e6?(o.push(1e6),o.push(1e5),o.push(1e4),o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01)):n>1e5?(o.push(1e5),o.push(1e4),o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01)):n>1e4?(o.push(1e4),o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01)):n>1e3?(o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001)):n>100?(o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5)):n>10?(o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6)):n>1?(s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6)):n>.1?(s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6)):n>.01?(s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6)):n>.001?(s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6),s>7&&o.push(1e-7)):n>1e-4?(s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6),s>7&&o.push(1e-7),s>8&&o.push(1e-8)):n>1e-5&&(s>5&&o.push(1e-5),s>6&&o.push(1e-6),s>7&&o.push(1e-7),s>8&&o.push(1e-8),s>9&&o.push(1e-9)),o}function l(e){const t=(0,a.g)(e);let i=1e10;return t.classBreakInfos.forEach((e=>{i=Math.min(i,d(e.minValue)),i=Math.min(i,d(e.maxValue))})),i}function r(e){let t=1;for(;Math.round(e*t)/t!==e;)t*=10;return Math.log(t)/Math.LN10}function d(e){let t=1e-8;for(;c(Math.round(e/t)*t)===e;)t*=10;return t/10}function c(e){return Number.parseFloat(e.toPrecision(12))}function h(e){let t=0;e.forEach((e=>{(0,s.i)(e.value)?t=Math.max(r(c(e.value)),t):((0,s.i)(e.minValue)&&(t=Math.max(r(c(e.minValue)),t)),(0,s.i)(e.maxValue)&&(t=Math.max(r(c(e.maxValue)),t)),(0,s.i)(e.min)&&(t=Math.max(r(c(e.min)),t)),(0,s.i)(e.max)&&(t=Math.max(r(c(e.max)),t)))})),t=Math.min(t,3);const i=e[0],a=e[e.length-1],n=Math.min(i.minValue??i.min??i.value,a.minValue??a.min??a.value),o=Math.max(i.maxValue??i.max??i.value,a.maxValue??a.max??a.value)-n;return o/e.length<2e-7?t=8:o/e.length<2e-6?t=7:o/e.length<2e-5?t=6:o/e.length<2e-4?t=5:o/e.length<.002?t=4:o/e.length<.02?t=3:o/e.length<.2?t=Math.max(t,2):o/e.length<2&&(t=Math.max(t,1)),Math.round(t)}}}]);