/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2d14a1.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2d14a1"],{59992:(e,t,i)=>{i.d(t,{a:()=>k,b:()=>d,c:()=>l,d:()=>I,e:()=>T,f:()=>f,g:()=>x,h:()=>y,i:()=>m});var o=i(59317),a=i(87744);function n(e,t,i,o,a){return new Promise(((n,s)=>{const r=new XMLHttpRequest;r.open(e,t,!1),o&&r.setRequestHeader("Authorization",o),a&&r.setRequestHeader("Content-type",a),i?r.send(i):r.send();const l=JSON.parse(r.responseText);r.status>=400&&s(JSON.parse(r.responseText)),n(l)}))}function s(e,t){return new Promise(((i,o)=>{t=t.replace(/[[]/,"[").replace(/[]]/,"]");const a=new RegExp(`[?&#]${t}=([^&#]*)`).exec(e);null==a?o("InvalidToken"):i(a[1])}))}function r(e,t){return new Promise(((i,o)=>{const a=`${window.location.protocol}//${window.location.hostname}`,n=`https://${t}/home/cloudDriveOauth-callback.html${`?cloudUrl=${e}&currentSourceUrl=${a}&portalHostName=${t}`}`,s=document.createElement("iframe");s.src=n,s.className="hide",document.body.appendChild(s);const r=window.addEventListener?"addEventListener":"attachEvent";(0,window[r])("attachEvent"===r?"onmessage":"message",(e=>{e.origin===`https://${t}`&&("popupBlocked"!==e.data&&"windowClosed"!==e.data||o(e.data),i(e.data))}),!1)}))}const l={csv:"file-csv",excel:"file-excel",zip:"file-zip",geojson:"file-code",sheet:"file-report",cad:"file-cad",gpx:"file-gpx",png:"file-image",jpg:"file-image",jpeg:"file-image",tiff:"file-image",gif:"file-image",pdf:"file-pdf",docx:"file-word"},d={csv:"CSV",excel:"Excel",zip:"Zip File",geojson:"GeoJSON",googlesheets:"Google Sheets",cad:"CAD",gpx:"GPX",png:"Image",jpg:"Image",jpeg:"Image",tiff:"Image",gif:"Image",pdf:"PDF",docx:"Microsoft Word",pptx:"Microsoft PowerPoint"},c={csv:".csv",excel:".xls",zip:".zip",geojson:".geojson",googlesheets:""};function p(e){const t=e.split("."),i=t[t.length-1].toLowerCase();return{xls:"excel",xlsx:"excel",csv:"csv",zip:"zip",geojson:"geojson",json:"geojson"}[i]||i}function h(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function m(e,t){return`https://content.dropboxapi.com/2/files/download?httpHeaders={"Authorization":"Bearer&#32;${t}","Dropbox-API-Arg":"{\\"path\\":\\"${e}\\"}"}`}class u{constructor(){this.nextStart=0}async connect(){const{config:e,portal:t}=o.c,i=`dropbox${Math.floor(Date.now()/1e3)}`,n=document.documentElement.lang||"en-US",l=function(){const e=new Uint8Array(128),t=crypto.getRandomValues(e);return h(btoa(t)).substring(0,128)}(),d=await async function(e){const t=(new TextEncoder).encode(e),i=await crypto.subtle.digest("SHA-256",t);return h(btoa(String.fromCharCode(...new Uint8Array(i))))}(l),c=`https://${t.portalHostname}/home/cloudDriveOauth-callback2.html`,p=`https://www.dropbox.com/oauth2/authorize?${(0,a.b)({redirect_uri:c,response_type:"code",code_challenge:d,code_challenge_method:"S256",client_id:e.dropboxClientId,locale:n,state:i})}`;return new Promise((async(e,n)=>{try{const d=await r(p,t.portalHostname),h=(0,a.k)(d,"code"),m=await async function(e,t,i){const{config:a}=o.c,n=new URLSearchParams({grant_type:"authorization_code",code:e,client_id:`${a.dropboxClientId}`,redirect_uri:i,code_verifier:t}).toString();return(await fetch(`https://api.dropboxapi.com/oauth2/token?${n}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}})).json()}(h,l,c),u=await s(d,"state");i!==u&&n("invalidState"),this.token=m.access_token,e(m.access_token)}catch(e){n(e)}}))}search(e={}){const{token:t}=this;return new Promise((async i=>{const{searchText:o,dropdownFilter:a,next:s}=e,r=`Bearer ${t}`,l=o?` ${o}`:"",d=s?this.nextStart:0;let h=c[a];"excel"===a&&(h="xls");const m=`{"path":"","query":"${l} ${h}","mode": "filename","max_results":10,"start":${d}}`,u=await n("POST","https://api.dropboxapi.com/2/files/search",m,r,"application/json");this.nextStart=u.start;i({files:u.matches.filter((e=>{var t;return"file"===(null===(t=e.metadata)||void 0===t?void 0:t[".tag"])})).map((({metadata:{id:e,name:i,size:o}})=>({id:e,name:i,mimeType:p(i),downloadUrl:`https://content.dropboxapi.com/2/files/download?httpHeaders={"Authorization":"Bearer&#32;${t}","Dropbox-API-Arg":"{\\"path\\":\\"${e}\\"}"}`,size:o}))),next:!!u.more})}))}}function g(e){return e.indexOf("spreadsheetml.sheet")>-1||e.indexOf("ms-excel")>-1?"excel":e.indexOf("application/zip")>-1?"zip":e.indexOf("application/octet-stream")>-1||e.indexOf("application/json")>-1?"geojson":e.indexOf("google-apps.spreadsheet")>-1?"googlesheets":e.indexOf("text/csv")>-1?"csv":"zip"}const v={csv:'(mimeType="text/csv")',excel:'(mimeType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"ormimeType="application/vnd.ms-excel")',zip:'(mimeType="application/x-zip-compressed"ormimeType="application/zip")',geojson:'(name contains "json" or name contains "geojson")and(mimeType="application/octet-stream"ormimeType="application/json")',googlesheets:'(mimeType="application/vnd.google-apps.spreadsheet")'};function f(e,t,i){const o=`https://www.googleapis.com/drive/v3/files/${e}`,a=`&httpHeaders={"Authorization":"Bearer&#32;${i}"}`,n=`${o}/export?mimeType=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet${a}`,s=`${o}?alt=media${a}`;return t.indexOf("google-apps")>-1||t.indexOf("googlesheets")>-1?n:s}class w{async connect(){return new Promise((async(e,t)=>{const{config:i,portal:a}=o.c,n=a.portalHostname,l=document.documentElement.lang||"en-US",d=`google${Math.floor(Date.now()/1e3)}`,c=`https://accounts.google.com/o/oauth2/v2/auth?scope=https://www.googleapis.com/auth/drive.readonly&redirect_uri=${`https://${n}/home/cloudDriveOauth-callback2.html`}&response_type=token&client_id=${i.googleClientId}&hl=${l}&state=${d}`;try{const i=await r(c,n);d!==await s(i,"state")&&t("invalidState"),this.token=await s(i,"access_token"),e(this.token)}catch(e){t(e)}}))}async search(e={}){return new Promise((async t=>{const{searchText:i,next:o,dropdownFilter:a}=e,s=`${`https://www.googleapis.com/drive/v3/files?access_token=${this.token}&pageSize=10&fields=incompleteSearch,nextPageToken,files(id,kind,mimeType,name)`}&q=${i?`name contains '${i}' and trashed = false and`:"trashed = false and"}${v[a]}${o?`&pageToken=${this.nextToken}`:""}`,r=await n("GET",s,null,null,"application/json");this.nextToken=r.nextPageToken;t({files:r.files.map((({id:e,name:t,mimeType:i})=>({id:e,name:t,mimeType:g(i),downloadUrl:f(e,i,this.token)}))),next:!!r.nextPageToken})}))}}function y(e,t){return`https://graph.microsoft.com/v1.0/me/drive/items/${e}/content?httpHeaders={"Authorization":"Bearer&#32;${t}"}`}class b{async connect(){return new Promise((async(e,t)=>{const{config:i,portal:a}=o.c,n=a.portalHostname,l=document.documentElement.lang||"en-US",d=`onedrive${Math.floor(Date.now()/1e3)}`,c=`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?scope=files.read&redirect_uri=${`https://${n}/home/cloudDriveOauth-callback2.html`}&response_type=token&client_id=${i.oneDriveClientId}&locale=${l}&state=${d}`;try{const i=await r(c,n);d!==await s(i,"state")&&t("invalidState"),this.token=await s(i,"access_token"),e(this.token)}catch(e){t(e)}}))}search(e={}){return new Promise((async t=>{const{searchText:i,dropdownFilter:o,next:a}=e,s=`Bearer ${this.token}`,r=`https://graph.microsoft.com/v1.0/me/drive/root/search(q='${i||""} ${c[o]||""}')?select=name,id,file,size&top=10`,l=a?this.nextLink:r,d=await n("GET",l,null,s,"application/json");this.nextLink=d["@odata.nextLink"];t({files:d.value.map((({size:e,id:t,name:i})=>({size:e,id:t,name:i,mimeType:p(i),downloadUrl:`https://graph.microsoft.com/v1.0/me/drive/items/${t}/content?httpHeaders={"Authorization":"Bearer ${this.token}"}`}))),next:!!d["@odata.nextLink"]})}))}}function x(e){return new{dropbox:u,"google drive":w,onedrive:b}[e]}function k(e){return{dropbox:"dropBoxConnect","google drive":"googleConnect",onedrive:"oneDriveConnect"}[e]}function T(e){return new{dropBoxConnect:u,googleConnect:w,oneDriveConnect:b}[e]}function I(e){return{dropBoxConnect:"dropbox",googleConnect:"google drive",oneDriveConnect:"onedrive"}[e]}},73897:(e,t,i)=>{i.r(t),i.d(t,{arcgis_new_item_pages_append_select:()=>u});var o=i(87849),a=i(50020),n=i(59317),s=i(4429),r=i(32710),l=i(90470),d=i(60743),c=i(3826),p=i(95878),h=i(44069),m=i(59992);i(50637),i(931),i(93814),i(87744),i(50822),i(37762),i(83929),i(76246),i(63054),i(15912),i(24869),i(72257),i(86562),i(15332),i(75294),i(38295),i(51102),i(56175),i(43555),i(26854),i(31544),i(11163),i(8214),i(66111);const u=class{constructor(e){(0,o.r)(this,e),this.newItemUpdatePage=(0,o.c)(this,"newItemUpdatePage",7),this.newItemToggleNavigationEnabled=(0,o.c)(this,"newItemToggleNavigationEnabled",7),this.workflowComplete=(0,o.c)(this,"workflowComplete",7),this.isCloudItem=!1,this.isUrlItem=!1,this.insertOnly=!1,this.options={add:{icon:"add-features",updateType:"add",hidden:!1,disabled:!1},update:{icon:"update-features",updateType:"update",hidden:!1,disabled:!1},upsert:{icon:"add-and-update-features",updateType:"upsert",hidden:!1,disabled:!1},overwrite:{icon:"overwrite-features",updateType:"overwrite",hidden:!1,disabled:!1}},this.syncAppendOptions=()=>{if(!c.a.appendOptions&&this.item){const e=this.item;c.a.appendOptions={serviceInfo:e.serviceInfo,adminServiceInfo:e.adminServiceInfo,cloudProviderInfo:e.cloudProviderInfo,sourceData:e.sourceData,layers:e.layers,isSDS:e.isSDS,itemData:e.itemData,publishParameters:e.publishParameters}}},this.selected="add",this.error=void 0,this.loading=!1,this.loaderType="indeterminate",this.loaderMessage=void 0}handleNext(){let e;const{item:t,selected:i,layer:o,layerId:a,appendLayerEntry:n}=this;c.a.addAppendSelectOption=i;const{layers:s,cloudProviderInfo:r}=c.a.appendOptions;if(!n&&"overwrite"!==i&&s.length>1)e="appendSelectLayer";else{if(r&&"overwrite"===i){if(c.a.newItemMode="file",r){const{id:e,mimeType:i,zipItemType:o,cloudProvider:a}=r;return this.assignCloudItemStore(r),void this.handleOverwriteURL(t,e,i,o,a)}return void this.handleOverwriteURL(t)}if(n){let e=null!=o?o:s[a];e||(e=s[0]),c.a.sourceDataLayer=e}else c.a.sourceDataLayer=s[0];e="appendUpload"}this.newItemUpdatePage.emit(e)}determineHeader(e){const{i18n:t}=this,{insertOnly:i,isSharedMemberViewing:o}=e;switch(!0){case i:this.header=t.insertOnlyEnabled;break;case o:this.header=t.overwriteDisabledForSharedGroupView;break;default:this.header=t.chooseUpdate}}createOptions(){const{item:e}=this,{user:t}=n.c,{serviceInfo:i,sourceData:o,cloudProviderInfo:a,isSDS:s,adminServiceInfo:r}=c.a.appendOptions,l=n.c.portal.isPortal,d=e.owner!==t.username&&e.itemControl.includes("update"),p=!1===i.sourceSchemaChangesAllowed,h=(!o||o.inRecycleBin)&&!a,m="GeoPackage"===(null==o?void 0:o.type)&&l,u="Service Definition"===(null==o?void 0:o.type)&&l;(-1!==(n.c.portal.isPortal&&!s?i.capabilities:r.capabilities).indexOf("ChangeTracking")||i.syncEnabled)&&(this.insertOnly=!0,this.options.overwrite.disabled=!0,this.options.update.disabled=!0,this.options.upsert.disabled=!0),(this.appendLayerEntry||h||m||u||p||d)&&(this.options.overwrite.disabled=!0),this.determineHeader({insertOnly:this.insertOnly,isSharedMemberViewing:d})}createOverwriteNextText(){switch(!0){case this.isCloudItem:return"signInAndOverwrite";case this.isUrlItem:return"overwriteAndComplete";default:return"next"}}async componentWillLoad(){var e,t,i,o,a,n,s,r;this.selected=c.a.addAppendSelectOption||"add",this.i18n=p.u.i18n.appendSelect,this.item=c.a.existingItem,this.appendLayerEntry=void 0!==c.a.layerId,this.layerId=c.a.layerId,this.layer=c.a.sublayer,this.syncAppendOptions(),this.item&&(c.a.id=null,c.a.dateFieldsTimeReference=null!==(a=null!==(t=null===(e=c.a.appendOptions.publishParameters)||void 0===e?void 0:e.dateFieldsTimeReference)&&void 0!==t?t:null===(o=null===(i=c.a.appendOptions.publishParameters)||void 0===i?void 0:i.layers)||void 0===o?void 0:o[0].dateFieldsTimeReference)&&void 0!==a?a:null===(n=c.a.appendOptions.layers)||void 0===n?void 0:n[0].dateFieldsTimeReference,this.isUrlItem=!!(null===(s=c.a.appendOptions.cloudProviderInfo)||void 0===s?void 0:s.url),this.isCloudItem=!!(null===(r=c.a.appendOptions.cloudProviderInfo)||void 0===r?void 0:r.cloudProvider),this.createOptions())}assignCloudItemStore(e){const{cloudProvider:t,id:i,mimeType:o,cloudDriveFileName:a,cloudFileType:n,zipItemType:s}=e;c.a.cloudProvider=(0,m.d)(t),c.a.cloudProviderResource={cloudProvider:t,id:i,mimeType:o,cloudDriveFileName:a,cloudFileType:n,zipItemType:s}}async setUpCloud(e){const t=(0,m.e)(e),{result:i,error:o}=await(0,l.g)(t);return o?(this.handleError(),null):i}async handleOverwriteURL(e,t,i,o,u){var g,v,f,w,y,b,x;let k,T,I;this.loading=!0,this.loaderMessage=p.u.i18n.append.appendLoadingMessages.overwriting;const O=c.a.appendOptions.cloudProviderInfo;if(c.a.fileName=e.title,c.a.title=e.title,O.cloudProvider){T="zip"===i?o:h.b[i],I=[c.a.type];const e=await this.setUpCloud(u);switch(await(0,s.t)(200),u){case"googleConnect":k=(0,m.f)(t,i,e);break;case"dropBoxConnect":k=(0,m.i)(t,e);break;case"oneDriveConnect":k=(0,m.h)(t,e)}}else{"geojson"===O.mimeType?c.a.geoJSONResource={fileName:O.fileName,url:O.url,mimeType:O.mimeType}:c.a.csvResource={fileName:O.fileName,url:O.url,mimeType:O.mimeType};const e=null!==(g=c.a.csvResource)&&void 0!==g?g:c.a.geoJSONResource;T=h.b[e.mimeType],k=e.url,I=[T]}c.a.dataUrl=k,c.a.type=T,c.a.typeKeywords=I,c.a.overwrite=!0;try{this.newItemToggleNavigationEnabled.emit(!1),await(0,r.F)();const{appendOptions:t}=c.a,i=await(0,l.c)(e,n.c.portal,n.c.user,t,c.a.id),o=await(0,d.p)({itemId:null!==(f=null===(v=t.sourceData)||void 0===v?void 0:v.id)&&void 0!==f?f:e.id,portal:n.c.portal,user:n.c.user,title:(null==e?void 0:e.title)||"",itemOwnerUrl:(0,a.g)(await(0,a.f)(this.item.owner,n.c.portal),n.c.portal)},i);await(0,l.d)(i.publishParameters,e,null===(y=null===(w=o.result)||void 0===w?void 0:w.services)||void 0===y?void 0:y[0].serviceItemId),await this.checkStatus({itemId:e.id,jobId:null===(x=null===(b=o.result)||void 0===b?void 0:b.services)||void 0===x?void 0:x[0].jobId},null==o?void 0:o.result)}catch(e){this.handleError()}}async checkStatus(e,t){var i;this.loaderMessage=p.u.i18n.append.appendLoadingMessages.overwriting,this.newItemToggleNavigationEnabled.emit(!0);const o=await(0,r.g)(e.itemId,{jobId:e.jobId}),a=null==o?void 0:o.status,n=Object.assign({id:null===(i=null==t?void 0:t.services)||void 0===i?void 0:i[0].serviceItemId,item:Object.assign({},c.a),overwriteStatus:a,appendType:c.a.addAppendSelectOption},t);return"completed"===(null==o?void 0:o.status.toLowerCase())?(n.overwriteStatus=null==o?void 0:o.status,this.workflowComplete.emit(n),null):("failed"===(null==o?void 0:o.status.toLowerCase())&&this.handleError(),o)}handleError(){p.u.nextText="next",this.newItemToggleNavigationEnabled.emit(!0),this.loading=!1,this.error={title:p.u.i18n.error,description:p.u.i18n.appendUpload.errors.errorWhileUpload}}render(){const{i18n:e,options:t,error:i,loaderType:a,loading:s,loaderMessage:r,header:l}=this,d=`${n.c.config.helpBase}${n.c.config.helpMap[120005034]}`;return(0,o.h)(o.H,{key:"6c3ba3780b52c38d8ae5a820f153a5b6b3ae2ea5",class:{"overflow-hidden":s}},(0,o.h)("arcgis-new-item-loader",{key:"7c897ca5bb58f6503ba71071bc7d5511837ef843",type:a,active:s,text:r}),(0,o.h)("div",{key:"810a8ebdfe8d5d35cd2009a8bc6b55a629eb6762",class:"header"},l),(0,o.h)("div",{key:"7cc1810ffb581f7dbda225a9181ea47d80de1681",class:"w-full"},(0,o.h)("div",{key:"b119afe02c08aa1bf3fc9230049fdb5d67733045",class:"w-full"},(0,o.h)("calcite-tile-group",{key:"a8d06173bced3bd50b6b2b8c3409729b31db5600",label:l,selectionMode:"single-persist",selectionAppearance:"icon",layout:"vertical"},Object.keys(t).map((i=>{const{disabled:a,icon:n}=t[i];return(0,o.h)("calcite-tile",{key:i,selected:this.selected===i,heading:e.updateOptions[i].title,"data-value":i,disabled:a,onCalciteTileSelect:e=>{this.selected=e.target.dataset.value,p.u.nextText="overwrite"===this.selected?this.createOverwriteNextText():"next"}},(0,o.h)("calcite-icon",{icon:n,slot:"content-top"}))}))))),this.options.overwrite.disabled&&!this.insertOnly&&(0,o.h)("calcite-notice",{key:"141149ed3ff0aa91a0e83de16a9a1ef972c2be41",class:"disabled-options-notice",open:!0,icon:"exclamation-mark-triangle",kind:"warning"},(0,o.h)("calcite-link",{key:"1e12ca697dc87207f16ad27f1660b4d72ac24941",slot:"link",title:e.whyDisabled,href:d,target:"blank"},e.whyDisabledLink)),(0,o.h)("arcgis-new-item-alert",{key:"75aeca47bf4b8cca0d61f3402f15762af6b7eb7f",heading:null==i?void 0:i.title,description:null==i?void 0:i.description,active:!!i,onAlertDismiss:()=>this.error=null}))}get el(){return(0,o.a)(this)}};u.style=".header{margin-bottom:1rem;font-size:1rem;font-weight:500}calcite-tile-group{inline-size:100%}calcite-tile{max-inline-size:100%;min-inline-size:100%}.disabled-options-notice{margin-top:0.75rem}"}}]);