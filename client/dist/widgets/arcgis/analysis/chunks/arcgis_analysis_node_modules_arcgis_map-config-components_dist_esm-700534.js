/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-700534.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-700534"],{3175:(e,t,i)=>{i.d(t,{a:()=>l,g:()=>s});var a=i(20173);function l(e){const{customBaseUrl:t,portalHostname:i,urlKey:a}=e,{protocol:l}=window.location;return`${l}//${a?`${a}.${t}`:i}`}function s(e){return(0,a.a)(e.restUrl)}},4137:(e,t,i)=>{i.r(t),i.d(t,{arcgis_table:()=>u});var a=i(11254),l=i(69811),s=i(17840),n=i(53127),o=i(84661),r=i(44735),c=i(38698),d=i(14528),h=i(84260);i(56612),i(10465);const u=class{constructor(e){(0,a.r)(this,e),this.arcgisChange=(0,a.c)(this,"arcgisChange",7),this.arcgisTableUpdated=(0,a.c)(this,"arcgisTableUpdated",7),this.arcgisScaleChange=(0,a.c)(this,"arcgisScaleChange",7),this.arcgisTableScaleChange=(0,a.c)(this,"arcgisTableScaleChange",7),this.arcgisClose=(0,a.c)(this,"arcgisClose",7),this.arcgisTableDismissedChange=(0,a.c)(this,"arcgisTableDismissedChange",7),this.arcgisEditRecordClick=(0,a.c)(this,"arcgisEditRecordClick",7),this.arcgisTableEditRecordClick=(0,a.c)(this,"arcgisTableEditRecordClick",7),this.arcgisCreateRecordClick=(0,a.c)(this,"arcgisCreateRecordClick",7),this.arcgisTableCreateRecordClick=(0,a.c)(this,"arcgisTableCreateRecordClick",7),this.arcgisInCellEdit=(0,a.c)(this,"arcgisInCellEdit",7),this.arcgisTableInCellEdit=(0,a.c)(this,"arcgisTableInCellEdit",7),this.manager=(0,d.u)(this),this.strings=(0,h.u)({blocking:!0}),this.isWithinTabsManager=!1,this.hasRelatedTileLayer=!1,this.recordsCount=0,this.selectedOnlyMode=!1,this.selectedCount=0,this.keepTableSelection=!1,this.relatedAttributeTableTemplateHandles=[],this.editMessagePopoverClickHandler=e=>{this.editMessagePopoverNode?(0,c.i)(e.target,"arcgis-table-editing-popover")||(document.body.removeChild(this.editMessagePopoverNode),this.editMessagePopoverNode=void 0,document.removeEventListener("click",this.editMessagePopoverClickHandler)):document.removeEventListener("click",this.editMessagePopoverClickHandler)},this.fieldVisibilityPopoverClickHandler=e=>{this.fieldVisibilityPopoverNode?(0,c.i)(e.target,"arcgis-table-field-selection")||(document.body.removeChild(this.fieldVisibilityPopoverNode),this.fieldVisibilityPopoverNode=void 0,document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler)):document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler)},this.columnInfoClickHandler=e=>{this.columnInfoPopoverNode?(0,c.i)(e.target,"arcgis-table-column-info")||(document.body.removeChild(this.columnInfoPopoverNode),this.columnInfoPopoverNode=void 0,document.removeEventListener("click",this.columnInfoClickHandler)):document.removeEventListener("click",this.columnInfoClickHandler)},this.view=void 0,this.layer=void 0,this.config=void 0,this.useSelectionManager=!1,this.scale=c.S.MEDIUM,this.dismissible=!1,this.initialViewpoint=void 0,this.allowAddEditRecord=!1,this.allowFieldCalculate=!1,this.initiallySelectedObjectIds=void 0,this.reRender=!1,this.isBarExpanded=!1,this.lockRaster=!1,this.selectedFeatureIds=[]}async setFocus(){this.focus()}async refresh(e){const t=e?.addedObjectIds?.length?e.addedObjectIds:e?.updatedObjectIds;t?(this.selectedFeatureIds=t,this.selectedCount=t.length,this.updateHighlightsAndSelection()):e?.selectedObjectIds?.length&&(this.selectedFeatureIds=e.selectedObjectIds,this.selectedCount=1,this.selectedOnlyMode=!0,this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.addMany(e.selectedObjectIds),this.activeTable.objectIds.removeAll(),this.activeTable.objectIds.addMany(e.selectedObjectIds)),await(this.table?.refresh())}async conditionalRefresh(e){const{table:t}=this;if(t.viewModel.relationshipColumns.some((t=>t.layer.id===e.id)))await t.refresh();else for(const i of t.relatedTables){if(i.layer.id===e.id){await t.refresh();break}if(i.viewModel.relationshipColumns.some((t=>t.layer.id===e.id))){await t.refresh();break}}}async containsLayer(e){const{table:t}=this,i="subtype-sublayer"===e.type?e.parent.id:e.id;if(("subtype-sublayer"===t.layer.type?t.layer.parent.id:t.layer.id)===i)return!0;for(const e of t.relatedTables){if(("subtype-sublayer"===e.layer.type?e.layer.parent.id:e.layer.id)===i)return!0}if(!t.relatedTable&&t.relationshipInfos.length){if(t.relationshipInfos.map((e=>"subtype-sublayer"===e.relatedLayer.type?e.relatedLayer.parent.id:e.relatedLayer.id)).includes(i))return!0}return!1}async highlightRootFeature(e,t){this.selectedFeatureIds=e&&(0,s.i)(t)?[t]:[],this.updateHighlightsAndSelection()}async enableEdits(e){e?(this.activeTable.editingEnabled=this.supportsEditing(this.activeTable.layer),this.fabNode&&(this.fabNode.disabled=!1)):(this.activeTable.editingEnabled=!1,this.fabNode&&(this.fabNode.disabled=!0))}async disableTableEditorHooks(e){if(!this.activeTable?.layer)return;this.allowAddEditRecord=!e;const t=this.supportsEditing(this.activeTable.layer);e?(this.activeTable.actionColumnConfig=void 0,this.fabNode&&(this.fabNode.hidden=!0)):(this.activeTable.actionColumnConfig=this.allowAddEditRecord&&t?this.getActionColumnConfig(this.activeTable.layer,this.activeTable.relatedTable?"related-table":"parent-table"):void 0,this.fabNode&&(this.fabNode.hidden=!1))}async getSelectedObjectIds(){return await Promise.resolve(this.activeTable.highlightIds)}async componentWillLoad(){await this.loadAllModules();const{view:e,layer:t}=this;"imagery"===t.type?(this.imagerySelection=!0,this.props={view:e,layer:t}):this.props={view:e,layer:t};const i=e.popup?.viewModel?.active;if(i){const t=e.popup?.selectedFeature;if(this.layerContainsCurrentlySelectedFeature(t)){const t=e.popup.selectedFeature.getObjectId();(0,s.i)(this.initiallySelectedObjectIds?.length)&&!this.initiallySelectedObjectIds.includes(t)?this.initiallySelectedObjectIds.push(t):this.initiallySelectedObjectIds||(this.initiallySelectedObjectIds=[t])}}if(this.canUseSelectionManager()){const e=this.getSelectionManager().getSelection(t);e?.length?this.initiallySelectedObjectIds?.forEach((i=>{e.includes(i)||this.getSelectionManager().appendToSelection(t,i)})):this.initiallySelectedObjectIds?.length&&this.getSelectionManager().setSelection(t,this.initiallySelectedObjectIds);const i=this.getSelectionManager().getSelection(t);i?.length&&(this.selectedFeatureIds=i,this.selectedCount=i.length,this.selectedOnlyMode=!0)}else this.initiallySelectedObjectIds?.length&&(this.selectedFeatureIds=this.initiallySelectedObjectIds,this.selectedCount=this.initiallySelectedObjectIds.length,this.selectedOnlyMode=!0);if(this.isWithinTabsManager=(0,c.i)(this.el,"arcgis-map-config-tabs-manager"),("feature"===t.type||"oriented-imagery"===t.type)&&t.portalItem?.id){const e=await(0,o.g)(t.portalItem.id,t.portalItem.portal,{relationshipType:"Service2Service"});this.hasRelatedTileLayer=e?.data?.relatedItems.some((e=>e.type&&["WMTS","Map Service","Vector Tile Service"].includes(e.type)))}}async componentDidLoad(){const{modules:e,allowAddEditRecord:t}=this;(0,r.i)(this.el.shadowRoot,e.esriConfig),requestAnimationFrame((()=>this.focus()));const i=await this.getFieldTemplates();this.activeTable.tableTemplate=i;const{table:l}=this;this.relatedTablesHandle=l.relatedTables.on("change",(async({added:i})=>{i.length&&i.forEach((e=>{const i=e.layer,a=this.supportsEditing(i);e.visibleElements={header:!1,menu:!1,columnDescriptions:!1},e.actionColumnConfig=t&&a?this.getActionColumnConfig(i,"related-table"):void 0,e.attachmentsEnabled=(0,c.e)(i)})),this.activeTable=l.relatedTable??l;const s=this.supportsEditing(this.activeTable.layer);s&&this.activeTable.layer.on?this.activeTable.layer.on("edits",(0,n.d)((()=>{this.activeTable.layer&&(this.arcgisTableInCellEdit.emit({layer:this.activeTable.layer}),this.arcgisInCellEdit.emit({layer:this.activeTable.layer}))}),300)):s&&"subtype-sublayer"===this.activeTable.layer.type&&this.activeTable.layer.parent.on&&this.activeTable.layer.parent.on("edits",(0,n.d)((()=>{this.activeTable.layer&&(this.arcgisTableInCellEdit.emit({layer:this.activeTable.layer}),this.arcgisInCellEdit.emit({layer:this.activeTable.layer}))}),300)),l.relatedTable&&(this.showSelectedNode.disabled=!0);const o=await this.getFieldTemplates();this.activeTable.tableTemplate=o,setTimeout((()=>this.updateTable(this.activeTable.tableTemplate)),300),this.selectedFeatureIds=[],this.activeTable.highlightIds.forEach((e=>this.selectedFeatureIds.push(e))),this.activeTable.highlightIds.on("change",(e=>{const{selectedFeatureIds:t}=this;e.removed.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)})),e.added.forEach((e=>{t.includes(e)||t.push(e)})),this.selectedCount=new Set(t).size,this.lockRasters(),this.reRender=!this.reRender})),this.createFeatureHandle=e.reactiveUtils.watch((()=>this.activeTable.viewModel.store.canAddRelatedFeature),(()=>(0,a.f)(this.el))),(0,a.f)(this.el),this.columnMenuHandle?.remove(),this.columnMenuHandle=this.getMenuHandle(),this.attachmentsViewOptionsHandle?.remove(),this.attachmentsViewOptionsHandle=this.getAttachmentsViewOptionsHandle(),this.columnSortOrderHandle?.remove(),this.columnSortOrderHandle=this.getColumnSortOrderHandle(),this.columnReorderHandle?.remove(),this.columnReorderHandle=this.getColumnReorderHandle(),this.relatedAttributeTableTemplateHandles.forEach((e=>e?.remove())),this.table.relatedTables.forEach((e=>{const t=this.getRelatedAttributeTableTemplateHandle(e);t&&this.relatedAttributeTableTemplateHandles.push(t)}))})),this.showAllTablesHandle=e.reactiveUtils.watch((()=>this.table.allRelatedTablesVisible),(e=>this.fieldVisibilityActionNode.disabled=e))}disconnectedCallback(){const{layer:e}=this;this.canUseSelectionManager()&&this.getSelectionManager().setSelection(e,[]),this.closePopovers();const{table:t}=this;t?.destroy(),this.removeAllHandles()}render(){const{props:e,isWithinTabsManager:t}=this,{layer:i}=e;return i?(0,a.h)(a.H,null,(0,a.h)("div",{class:"content"},this.renderActionBar(),(0,a.h)("calcite-panel",{heading:t?void 0:i.title,ref:e=>{const{layer:t}=this.props;this.panelNode=e,this.layerTitleHandle=t.watch("title",(()=>this.reRender=!this.reRender))},onKeyDown:e=>{this.dismissible&&"Escape"===e.key&&!e.defaultPrevented&&(this.handleCloseClick(),e.preventDefault())}},this.renderHeaderActions(),this.renderTable(),this.renderCreateRecordFab()))):(0,a.h)(a.F,null)}renderActionBar(){const{selectedFeatureIds:e,imagerySelection:t,strings:i,isWithinTabsManager:l}=this,s=this.isKnowledgeGraphSubTable();return(0,a.h)("div",{class:l?"":"non-tabs-manager-action-bar-wrapper"},(0,a.h)("calcite-action-bar",{class:"action-bar",onCalciteActionBarToggle:e=>this.isBarExpanded=e.target.expanded},(0,a.h)("calcite-action-group",{overlayPositioning:"fixed",menuPlacement:"trailing-start"},!(this.activeTable?.layer??this.layer).isTable&&!s&&(0,a.h)("calcite-action",{icon:"zoom-to-object",text:i.zoomToSelection,disabled:!e?.length,onClick:()=>this.handleZoomToClick(),ref:e=>{this.zoomNode=e,this.afterCreateAction(this.zoomNode,i.zoomToSelection)}}),(0,a.h)("calcite-action",{icon:"home",text:i.home,disabled:!this.initialViewpoint,onClick:()=>this.handleHomeClick(),ref:e=>{this.homeNode=e,this.afterCreateAction(this.homeNode,i.home)}}),(0,a.h)("calcite-tooltip",{slot:"menu-tooltip",overlayPositioning:"fixed"},(0,a.h)("div",{class:"tooltip"},i.more))),!t&&this.renderTableActions(),t&&this.renderImageryTableActions(),(0,a.h)("calcite-tooltip",{slot:"expand-tooltip",overlayPositioning:"fixed"},(0,a.h)("div",{class:"tooltip"},i.expand))))}renderTableActions(){const{selectedFeatureIds:e,selectedOnlyMode:t,strings:i}=this,l=t||this.activeTable?.objectIds?.length;return(0,a.h)("calcite-action-group",{overlayPositioning:"fixed",menuPlacement:"trailing-start"},(0,a.h)("calcite-action",{icon:"erase",text:i.clearSelection,disabled:!e?.length,onClick:()=>this.handleClearClick(),ref:e=>{this.eraseNode=e,this.afterCreateAction(this.eraseNode,i.clearSelection)}}),(0,a.h)("calcite-action",{icon:"selected-items-filter",text:i.showSelected,disabled:this.table?.relatedTable||!e?.length,onClick:()=>this.handleShowSelectedClick(),ref:e=>{this.showSelectedNode=e,this.afterCreateAction(this.showSelectedNode,i.showSelected)}}),(0,a.h)("calcite-action",{icon:"list",text:i.showAll,disabled:!l,onClick:()=>this.handleShowAllClick(),ref:e=>{this.showAllNode=e,this.afterCreateAction(this.showAllNode,i.showAll)}}),(0,a.h)("calcite-action",{icon:"refresh",text:i.refresh,onClick:()=>this.handleRefreshClick(),ref:e=>{this.refreshNode=e,this.afterCreateAction(this.refreshNode,i.refresh)}}),(0,a.h)("calcite-tooltip",{slot:"menu-tooltip",overlayPositioning:"fixed"},(0,a.h)("div",{class:"tooltip"},i.more)))}renderImageryTableActions(){const{selectedFeatureIds:e,lockRaster:t,strings:i}=this;return(0,a.h)("calcite-action-group",{overlayPositioning:"fixed",menuPlacement:"trailing-start"},(0,a.h)("calcite-action",{icon:"erase",text:i.clearSelection,disabled:!e?.length,onClick:()=>this.handleClearClick(),ref:e=>{this.eraseNode=e,this.afterCreateAction(this.eraseNode,i.clearSelection)}}),(0,a.h)("calcite-action",{icon:"select-visible",text:i.selectVisible,onClick:()=>this.handleSelectVisibleClick(),ref:e=>{this.selectVisibleImageryNode=e,this.afterCreateAction(this.selectVisibleImageryNode,i.selectVisible)}}),(0,a.h)("calcite-action",{icon:t?"unlock":"lock",text:t?i.displayAll:i.displaySelected,onClick:()=>{t?this.handleDisplayAllClick():this.handleDisplaySelectedClick()},ref:e=>{this.displayImageNode=e,this.afterCreateAction(this.displayImageNode,t?i.displayAll:i.displaySelected)}}),(0,a.h)("calcite-tooltip",{slot:"menu-tooltip",overlayPositioning:"fixed"},(0,a.h)("div",{class:"tooltip"},i.more)))}renderHeaderActions(){const{layer:e,strings:t}=this,i="type"in e&&this.supportsEditing(e)&&!e.editingEnabled;return(0,a.h)("div",{slot:"header-actions-end",class:"menu-actions"},i&&(0,a.h)("calcite-action",{text:t.layerEditing,scale:"s",onClick:()=>this.handleEditMessageActionClick(),ref:e=>this.editMessageActionNode=e},(0,a.h)("calcite-icon",{scale:"s",icon:"exclamation-mark-circle"})),(0,a.h)("calcite-action",{text:t.fieldVisibility,scale:"s",onClick:()=>this.handleFieldVisibilityClick(),ref:e=>this.fieldVisibilityActionNode=e,onMouseOver:()=>(0,c.a)(this.fieldVisibilityActionNode,t.fieldVisibility),onMouseOut:()=>(0,c.r)(),onFocus:()=>(0,c.a)(this.fieldVisibilityActionNode,t.fieldVisibility),onFocusout:()=>(0,c.r)()},(0,a.h)("calcite-icon",{scale:"s",icon:"gear"})),this.renderExpandCollapseButton(),this.renderCloseButton())}renderExpandCollapseButton(){const{strings:e,scale:t,isWithinTabsManager:i}=this;return i?(0,a.h)(a.F,null):t===c.S.SMALL?(0,a.h)("calcite-action",{key:"expand-table",text:e.expand,scale:"s",onClick:()=>this.handleExpandClick()},(0,a.h)("calcite-icon",{icon:"chevrons-up"})):(0,a.h)("calcite-action",{key:"expand",text:e.shrink,scale:"s",onClick:()=>this.handleExpandClick()},(0,a.h)("calcite-icon",{icon:"chevrons-down"}))}renderCloseButton(){const{strings:e,isWithinTabsManager:t,dismissible:i}=this;return t||!i?(0,a.h)(a.F,null):(0,a.h)("calcite-action",{text:e.close,icon:"x",onClick:()=>this.handleCloseClick(),ref:e=>this.closeButtonNode=e})}renderTable(){return(0,a.h)("div",{class:"table"},(0,a.h)("div",{ref:e=>this.afterCreateTableNode(e)}))}renderCreateRecordFab(){const{strings:e,allowAddEditRecord:t}=this,i=this.table?.relatedTable?this.table?.relatedTable.layer:this.layer;if(!t)return(0,a.h)(a.F,null);if(!this.supportsEditing(i))return(0,a.h)(a.F,null);if(!this.supportsAdd(i))return(0,a.h)(a.F,null);if(i.portalItem&&(0,o.l)(i.portalItem))return(0,a.h)(a.F,null);if(this.table?.relatedTable&&!this.table.relatedTable.viewModel.store.canAddRelatedFeature)return(0,a.h)(a.F,null);const l=(0,c.g)(i);return i.isTable||l.length?(0,a.h)("calcite-fab",{scale:"s",class:"table-fab",kind:"neutral",appearance:"outline-fill","text-enabled":!0,text:i.isTable?e.createRecord:e.createFeature,onClick:()=>{this.fabNode&&(this.fabNode.disabled=!0),this.activeTable.highlightIds.removeAll(),this.handleCreateRecordClick()},ref:e=>this.fabNode=e}):(0,a.h)(a.F,null)}async loadAllModules(){const[e,t,i,a,s,n,o,r,c,d,h,u]=await Promise.all([(0,l.aq)(),(0,l.ar)(),(0,l.as)(),(0,l.a)(),(0,l.l)(),(0,l.at)(),(0,l.F)(),(0,l.au)(),(0,l.av)(),(0,l.q)(),(0,l.z)(),(0,l.j)()]);this.modules={FeatureTable:e,TableTemplate:t,attributeTableTemplateUtils:i,popupUtils:a,reactiveUtils:s,FieldInfoFormat:n,Query:o,imageService:r,MosaicRule:c,Graphic:d,intl:h,esriConfig:u}}afterCreateTableNode(e){const{modules:t,props:i,useSelectionManager:a}=this;let{selectedFeatureIds:l}=this;const{layer:s,view:o}=i,{table:r}=this;if(r)return;const{allowAddEditRecord:d}=this,h=this.supportsEditing(s);this.table=new t.FeatureTable({selectionSource:a?"view":"table",objectIds:l,highlightIds:l,layer:s,view:o,relatedRecordsEnabled:!0,editingEnabled:h,attachmentsEnabled:(0,c.e)(s),multiSortEnabled:!1,visibleElements:{header:!1,menu:!1,columnDescriptions:!1},actionColumnConfig:d&&h?this.getActionColumnConfig(s,"parent-table"):void 0,container:e}),this.activeTable=this.table,h&&this.table.layer.on?this.table.layer.on("edits",(0,n.d)((()=>{this.table.layer&&(this.arcgisTableInCellEdit.emit({layer:this.table.layer}),this.arcgisInCellEdit.emit({layer:this.table.layer}))}),300)):h&&"subtype-sublayer"===this.table.layer.type&&this.table.layer.parent.on&&this.table.layer.parent.on("edits",(0,n.d)((()=>{this.table.layer&&(this.arcgisTableInCellEdit.emit({layer:this.table.layer}),this.arcgisInCellEdit.emit({layer:this.table.layer}))}),300)),this.tableSizeHandle=t.reactiveUtils.watch((()=>this.table.viewModel.size),(e=>{this.recordsCount=e,this.updateDisplayCount()})),this.columnMenuHandle?.remove(),this.columnMenuHandle=this.getMenuHandle(),this.attachmentsViewOptionsHandle?.remove(),this.attachmentsViewOptionsHandle=this.getAttachmentsViewOptionsHandle(),this.columnSortOrderHandle?.remove(),this.columnSortOrderHandle=this.getColumnSortOrderHandle(),this.columnReorderHandle?.remove(),this.columnReorderHandle=this.getColumnReorderHandle(),this.attributeTableTemplateHandle?.remove(),this.attributeTableTemplateHandle=this.getAttributeTableTemplateHandle(),this.activeTable.highlightIds.on("change",(e=>{const{selectedFeatureIds:t}=this;e.removed.forEach((e=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)})),e.added.forEach((e=>{t.includes(e)||t.push(e)})),this.selectedCount=new Set(t).size,this.updateDisplayCount(),this.lockRasters(),this.reRender=!this.reRender})),this.popupActiveHandle=t.reactiveUtils.watch((()=>o.popup?.viewModel?.active),(()=>{const e=o.popup?.selectedFeature;if(this.layerContainsCurrentlySelectedFeature(e)){this.activeTable.highlightIds.removeAll(),l=[];const e=o.popup.selectedFeature.getObjectId();this.activeTable.highlightIds.push(e),l.push(e),this.selectedOnlyMode&&!this.activeTable.objectIds.includes(e)&&(this.activeTable.objectIds.push(e),this.reRender=!this.reRender)}else!e||o.popup.visible||this.keepTableSelection||(this.activeTable.highlightIds.removeAll(),this.selectedOnlyMode&&this.handleShowAllClick());this.keepTableSelection=!1}))}getActionColumnConfig(e,t){const{strings:i}=this;if(this.supportsUpdateDelete(e)&&(!e.portalItem||!(0,o.l)(e.portalItem)))return{icon:"pencil",label:e.isTable?i.editRecord:i.editFeature,callback:({feature:i})=>{this.keepTableSelection=!0,this.activeTable.columns.forEach((e=>e.closeMenu())),this.selectedFeatureIds=[i.getObjectId()],this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.add(i.getObjectId()),this.activeTable.editingEnabled=!1,"related-table"===t&&(i.layer=e,i.sourceLayer=e),this.arcgisTableEditRecordClick.emit({parentTable:this.table,feature:i,layer:e}),this.arcgisEditRecordClick.emit({parentTable:this.table,feature:i,layer:e})},disabled:()=>(0,s.i)(this.activeTable)&&!this.activeTable.editingEnabled}}async getFieldTemplates(e){const{modules:t,activeTable:i,strings:a}=this,l=e??i?.layer??this.layer,s=e=>{const t=[{label:a.information,icon:"information",clickFunction:()=>this.handleShowColumnInfo(e.name)}],i=!["blob","global-id","oid","raster"].includes(e.type),s=l.sourceJSON?.geometryProperties,n=s?.shapeLengthFieldName,o=s?.shapeAreaFieldName,r=[n,o].includes(e.name),c=window.customElements?.get("arcgis-field-calculate"),d=c&&e.editable&&i&&!r&&e.name!==this.activeTable.layer.objectIdField,h=("feature"===l.type||"oriented-imagery"===l.type)&&l.sourceJSON.supportsCalculate&&l.portalItem?.typeKeywords?.indexOf("Hosted Service")>-1&&"admin"===l.portalItem.itemControl&&!this.hasRelatedTileLayer;return this.allowFieldCalculate&&this.config&&h&&d&&t.push({label:a.calculateField,icon:"calculator",clickFunction:()=>{const t=l.portalItem.portal,i=t.sourceJSON?.isReadOnly;if(i){const e=t.isPortal;this.displayReadOnlyErrorDialog(e)}else this.handleCalculateField(e.name)}}),t.push({label:a.hideField,icon:"view-hide",clickFunction:()=>this.handleHideClick(e.name)}),{items:t}};let n;if(c.s.includes(l.type)){n=l.attributeTableTemplate?await t.attributeTableTemplateUtils.createTableTemplateFromAttributeTableTemplate({layer:l,template:l.attributeTableTemplate,includeHiddenFields:!0,excludedFieldTypesOverride:["geometry","blob","raster","xml"]}):await t.attributeTableTemplateUtils.createDefaultTableTemplateFromLayer({layer:l,excludedFieldTypesOverride:["geometry","blob","raster","xml"]}),l?.attributeTableTemplate||(l.attributeTableTemplate=await t.attributeTableTemplateUtils.createDefaultAttributeTableTemplateFromLayer({layer:l,excludedFieldTypesOverride:["geometry","blob","raster","xml"]}));const e=l.fields.filter((e=>!e.visible)).map((e=>e.name));n.columnTemplates=n.columnTemplates.filter((t=>!("field"===t.type&&(e.includes(t.fieldName)||!l.fields.find((e=>e.name===t.fieldName)))))),n.columnTemplates.forEach((e=>{if("field"===e.type){const t=e.fieldName,i=l.fields.find((e=>e.name===t)),a=l.popupTemplate?.fieldInfos?.find((e=>e.fieldName===t));e.label=a?.label||i.alias||i.name,e.menuConfig=s(i),e.format=a?.format??this.getDefaultFormat(i)}}))}else{n=new t.TableTemplate({columnTemplates:[]});const e=t.popupUtils.createFieldInfos({fields:l.fields,objectIdField:l.objectIdField}),i=new Map(e.map((e=>[e.fieldName,e]))),a=l.popupTemplate?.fieldInfos?new Map(l.popupTemplate.fieldInfos.map((e=>[e.fieldName,e]))):void 0,o=[];if(l.fields.forEach((e=>{if("geometry"===e.type||!e.visible)return;const t=i.get(e.name),l=a?.get(e.name),n={fieldName:e.name,label:l?.label||e.alias||e.name,type:"field",visible:!!t&&t.visible,format:l?.format||this.getDefaultFormat(e),menuConfig:s(e)};o.push(n)})),(0,c.e)(l)){const e={type:"attachment",visible:!0};o.push(e)}n.columnTemplates=o}return l.popupTemplate?.fieldInfos&&(this.popupTemplateWatchHandle?.remove(),this.popupTemplateWatchHandle=t.reactiveUtils.watch((()=>l.popupTemplate),(async()=>{let e=!1,i=!1;const{popupTemplate:a}=l;if(n.columnTemplates.forEach((t=>{a.fieldInfos.forEach((a=>{if(t.fieldName===a.fieldName&&(JSON.stringify(t.format)!==JSON.stringify(a.format)&&(i=!0,t.format=a.format),t.label!==a.label)){e=!0,t.label=a.label;const i=this.activeTable.columns.find((e=>e.fieldName===a.fieldName));i&&(i.label=a.label)}}))})),c.s.includes(l.type)){const e=await this.getFieldTemplates();this.activeTable.tableTemplate=e}else e?this.updateTable(new t.TableTemplate({columnTemplates:n.columnTemplates})):i&&await(this.table?.refresh())}))),n}getDefaultFormat(e){const{modules:t}=this;return["integer","small-integer","big-integer"].includes(e.type)?new t.FieldInfoFormat({digitSeparator:!1,places:0}):["single","double","long"].includes(e.type)?new t.FieldInfoFormat({digitSeparator:!1,places:2}):["date","time-only","timestamp-offset"].includes(e.type)?new t.FieldInfoFormat({dateFormat:"short-date-short-time"}):"date-only"===e.type?new t.FieldInfoFormat({dateFormat:"short-date"}):void 0}layerContainsCurrentlySelectedFeature(e){const{view:t}=this,i=this.activeTable?.layer??this.layer;return!!e&&(!!t.popup?.visible&&(e.layer?.id===i.id||"sublayer"===i.type&&e.sourceLayer?.layer?.id===i.layer?.id))}supportsEditing(e){const t=["feature","oriented-imagery","subtype-sublayer"].includes(e.type),i=e.effectiveEditingEnabled;return t&&i}supportsAdd(e){return e.effectiveCapabilities.operations.supportsAdd}supportsUpdateDelete(e){const t=e.effectiveCapabilities.operations.supportsUpdate,i=e.effectiveCapabilities.operations.supportsDelete;return t||i}updateDisplayCount(){const{modules:e,strings:t,panelNode:i,recordsCount:a,selectedCount:l}=this;if(!i)return;const n=e.intl.convertNumberFormatToIntlOptions({digitSeparator:!0}),o=e.intl.formatNumber(a,n);if((0,s.i)(l))if(0===l)i.description=0===a?t.zeroRecordsZeroSel:1===a?t.oneRecordZeroSel:t.numRecordsZeroSel.replace("${count}",o);else if(1===l)i.description=0===a?t.zeroRecordsOneSel:1===a?t.oneRecordOneSel:t.numRecordsOneSel.replace("${count}",o);else{const s=e.intl.formatNumber(l,n);i.description=0===a?t.zeroRecordsNumSel.replace("${countSel}",s):1===a?t.oneRecordNumSel.replace("${countSel}",s):t.numRecordsNumSel.replace("${count}",o).replace("${countSel}",s)}else i.description=0===a?t.zeroRecords:1===a?t.oneRecord:t.numRecords.replace("${count}",o)}isKnowledgeGraphSubTable(){const e=this.activeTable?.layer??this.layer;if("knowledge-graph-sublayer"===e.type){return(e.parentCompositeLayer.tables?.toArray()??[]).map((e=>e.id)).includes(e.id)}return!1}afterCreateAction(e,t){e&&(e.onfocus=()=>{const{isBarExpanded:i}=this;i||e.textEnabled||(0,c.a)(e,t)},e.onmouseover=e.onfocus,e.onmouseout=()=>(0,c.r)(),e.removeEventListener("focusout",(()=>(0,c.r)())),e.addEventListener("focusout",(()=>(0,c.r)())))}handleZoomToClick(){const{modules:e,view:t,selectedFeatureIds:i}=this,a=this.activeTable?.layer??this.layer;if("imagery"===a.type){const l=new e.Query;l.outSpatialReference=t.spatialReference,l.objectIds=[...i],l.returnGeometry=!0,a.queryRasters(l).then((e=>{t.goTo(e.features)}))}else{const e=a,l=e.createQuery();l.outSpatialReference=t.spatialReference,l.objectIds=[...i],l.returnGeometry=!0,e.queryFeatures(l).then((e=>{t.goTo(e.features)}))}}handleHomeClick(){const{view:e,initialViewpoint:t}=this;e.goTo(t)}handleClearClick(){const{activeTable:e}=this;e.highlightIds.removeAll(),this.clearFilter()}handleShowSelectedClick(){this.selectedOnlyMode=!0,this.activeTable.objectIds.removeAll(),this.activeTable.objectIds.addMany(this.activeTable.highlightIds),this.reRender=!this.reRender}handleShowAllClick(){this.selectedOnlyMode=!1,this.activeTable.objectIds.removeAll(),this.reRender=!this.reRender}handleRefreshClick(){const{table:e}=this;e.refresh(),this.reRender=!this.reRender}async handleSelectVisibleClick(){const{layer:e,view:t,table:i}=this;i.highlightIds.removeAll();const a=t?.extent,s=await async function(e,t,i){const[a,s,n]=await Promise.all([(0,l.t)(),(0,l.r)(),(0,l.ap)()]),o=new a({spatialReference:e.spatialReference});o.addRing([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]);const r=new s({x:(e.xmax-e.xmin)/t.width,y:(e.ymax-e.ymin)/t.height,spatialReference:e.spatialReference}),c=new n;c.geometry=o,c.returnGeometry=!0,c.pixelSize=r;const d=i.mosaicRule.clone();return i.definitionExpression&&(d.where=i.definitionExpression),c.mosaicRule=d,c}(a,t,e);this.selectFeaturesFromIdentify(s)}handleDisplayAllClick(){const{modules:e}=this;this.lockRaster=!1;const t=this.layer,{sourceJSON:i}=t,a=i.allowedMosaicMethods.split(",").map((e=>e.trim().toLowerCase()));a.unshift(i.defaultMosaicMethod.toLowerCase());const l=a.find((e=>"lockraster"!==e&&"viewpoint"!==e&&("byattribute"!==e||!!i.sortField)))??"none";t.mosaicRule=e.MosaicRule.fromJSON({...i,defaultMosaicMethod:l}),t.visible=!0}handleDisplaySelectedClick(){this.lockRaster=!0,this.lockRasters()}handleEditMessageActionClick(){const{strings:e}=this;this.editMessagePopoverNode||(document.removeEventListener("click",this.editMessagePopoverClickHandler),this.editMessagePopoverNode=document.createElement("arcgis-table-editing-popover"),this.editMessagePopoverNode.referenceElement=this.editMessageActionNode,this.editMessagePopoverNode.strings=e,this.editMessagePopoverNode.addEventListener("arcgisClose",(e=>{e.stopPropagation(),this.removeEditingPopover(),setTimeout((()=>this.editMessageActionNode?.setFocus()),200)})),document.body.appendChild(this.editMessagePopoverNode),setTimeout((()=>{this.editMessagePopoverNode?.setFocus(),document.addEventListener("click",this.editMessagePopoverClickHandler)}),100))}handleFieldVisibilityClick(){if(this.fieldVisibilityPopoverNode)return;document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler);const e=this.activeTable.layer,{props:t,strings:i,fieldSortOrder:a,activeTable:l}=this,s=document.createElement("arcgis-table-field-selection");s.props={layer:e,view:t.view},s.strings=i,s.columnTemplates=l.tableTemplate.columnTemplates;const n=this.activeTable.columns.filter((e=>"field"in e))??[],o=Array.from(n.map((e=>e.fieldName)));s.fieldColumnOrder=o,s.sortBy=a??"default",s.attachmentsEnabled=!!(0,c.e)(e)&&l.attachmentsEnabled,s.relationshipsEnabled=l.relatedRecordsEnabled,s.popoverReferenceElement=this.fieldVisibilityActionNode,s.addEventListener("arcgisFieldColumnTemplatesVisibilityChange",(e=>{e.stopPropagation();e.detail.forEach((e=>this.activeTable.toggleColumnVisibility(e))),this.updateTable(this.activeTable.tableTemplate)})),s.addEventListener("arcgisAttachmentColumnTemplateVisibilityChange",(e=>{e.stopPropagation();this.activeTable.columns.find((e=>"onShowAttachments"in e)).hidden=!e.detail;const t=this.activeTable.tableTemplate?.columnTemplates.find((e=>"attachment"===e.type));t.visible=e.detail,this.updateTable(this.activeTable.tableTemplate)})),s.addEventListener("arcgisRelationshipsColumnTemplateVisibilityChange",(e=>{e.stopPropagation();this.activeTable.columns.filter((e=>"relationshipId"in e)).forEach((t=>t.hidden=!e.detail));const t=this.activeTable.tableTemplate?.columnTemplates.filter((e=>"relationship"===e.type));t?.forEach((t=>t.visible=e.detail)),this.updateTable(this.activeTable.tableTemplate)})),s.addEventListener("arcgisSortByChange",(e=>{e.stopPropagation(),this.fieldSortOrder=e.detail})),s.addEventListener("arcgisClose",(()=>{this.closePopovers(),setTimeout((()=>this.fieldVisibilityActionNode.setFocus()),200)})),document.body.appendChild(s),this.fieldVisibilityPopoverNode=s,setTimeout((()=>document.addEventListener("click",this.fieldVisibilityPopoverClickHandler)),200)}handleExpandClick(){const{scale:e}=this,t=e===c.S.SMALL?c.S.MEDIUM:c.S.SMALL;this.arcgisTableScaleChange.emit(t),this.arcgisScaleChange.emit(t),this.scale=t,this.closePopovers()}handleCloseClick(){this.arcgisTableDismissedChange.emit(),this.arcgisClose.emit()}handleCreateRecordClick(){const{table:e}=this;if(e.relatedTable){const t=e.relatedTable;t.editingEnabled=!1;const i=t.tableParent;if(t.relationshipConfig){const{objectId:e}=t.relationshipConfig,a=i.viewModel.store.getItemByObjectId(e);if(a?.feature){const{relatedLayer:e,relationshipId:i}=t.relationshipConfig,l=e.relationships?.find((e=>e.id===i)),s=a.feature,n=t.layer.relationships?.find((e=>e.id===i)),o=s.getAttribute(l.keyField);this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:t,relationshipKeyField:n.keyField,relationshipKeyFieldValue:o}),this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:t,relationshipKeyField:n.keyField,relationshipKeyFieldValue:o})}else t.editingEnabled=!1,this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:t}),this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:t})}else t.editingEnabled=!1,this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:t}),this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:t})}else this.table.editingEnabled=!1,this.arcgisTableCreateRecordClick.emit({parentTable:this.table,targetTable:this.table}),this.arcgisCreateRecordClick.emit({parentTable:this.table,targetTable:this.table})}handleShowColumnInfo(e){this.columnInfoPopoverNode&&this.columnInfoPopoverNode.parentNode?.removeChild(this.columnInfoPopoverNode),document.removeEventListener("click",this.columnInfoClickHandler);const{props:t,strings:i}=this,a=this.activeTable.layer,l=document.createElement("arcgis-table-column-info");l.props={view:t.view,layer:a},l.strings=i,l.fieldName=e,l.popoverReferenceElement=this.fieldVisibilityActionNode,l.addEventListener("arcgisClose",(()=>{this.closePopovers(),setTimeout((()=>this.focus()),100)})),l.addEventListener("arcgisSetupComplete",(()=>this.syncMenuHandles())),document.body.appendChild(l),this.columnInfoPopoverNode=l,setTimeout((()=>document.addEventListener("click",this.columnInfoClickHandler)),200)}displayReadOnlyErrorDialog(e){const{strings:t}=this;if(this.readOnlyDialogNode)return;this.readOnlyDialogNode=document.createElement("calcite-dialog"),this.readOnlyDialogNode.open=!0,this.readOnlyDialogNode.modal=!0,this.readOnlyDialogNode.outsideCloseDisabled=!0,this.readOnlyDialogNode.escapeDisabled=!0,this.readOnlyDialogNode.heading=t.error;const i=document.createElement("div");i.innerHTML=e?t.readOnlyErrorMessageEnterprise:t.readOnlyErrorMessage;const a=document.createElement("calcite-button");if(a.slot="footer-end",a.innerHTML=t.ok,a.addEventListener("click",(()=>{this.readOnlyDialogNode?.parentElement?.removeChild(this.readOnlyDialogNode),this.readOnlyDialogNode=void 0})),this.readOnlyDialogNode.appendChild(i),!e){const e=document.createElement("div"),i=document.createElement("calcite-link");i.target="_blank",i.href="https://status.arcgis.com",i.innerHTML=t.healthDashboard,e.appendChild(i),this.readOnlyDialogNode.appendChild(e)}this.readOnlyDialogNode.appendChild(a),this.readOnlyDialogNode.addEventListener("calciteDialogClose",(()=>{this.readOnlyDialogNode?.parentElement?.removeChild(this.readOnlyDialogNode),this.readOnlyDialogNode=void 0})),document.body.appendChild(this.readOnlyDialogNode)}handleCalculateField(e){const t=window.customElements?.get("arcgis-field-calculate");if(!t)return;const i=document.createElement("arcgis-field-calculate");i.fieldName=e,i.layer=this.activeTable.layer,i.config=this.config,i.addEventListener("arcgisFieldCalculateClose",(()=>{document.body.removeChild(i),this.activeTable.refresh(),this.arcgisTableInCellEdit.emit({layer:this.activeTable.layer}),this.arcgisInCellEdit.emit({layer:this.activeTable.layer})})),document.body.appendChild(i)}handleHideClick(e){this.activeTable.hideColumn(e),this.activeTable.tableTemplate?.columnTemplates.forEach((t=>{t.fieldName===e&&(t.visible=!1)})),this.updateTable(this.activeTable.tableTemplate)}async lockRasters(){const{modules:e,selectedFeatureIds:t,layer:i,imagerySelection:a}=this;if(this.lockRaster)if(a&&t.length){const a=t.map((e=>"string"==typeof e?Number.parseInt(e):e)),l=new e.MosaicRule;l.method="lock-raster",l.lockRasterIds=a;const s=i.definitionExpression;s&&(l.where=s),i.mosaicRule=l,i.visible=!0}else i.visible=!1}async selectFeaturesFromIdentify(e){const{modules:t,layer:i}=this,a=[];if("imagery"===i.type&&i.visible){const l=await t.imageService.identify(i.url,e);if(l?.catalogItems?.features&&l.catalogItemVisibilities)for(let e=0;e<l.catalogItems.features.length;e++)l.catalogItemVisibilities[e]>0&&a.push(l.catalogItems.features[e]);const s=a.map((e=>new t.Graphic({attributes:e.attributes,geometry:e.geometry,sourceLayer:this.activeTable.layer,layer:this.activeTable.layer})));s.length?s.forEach((e=>this.activeTable.highlightIds.add(e.getObjectId()))):this.activeTable.highlightIds.removeAll()}}updateTable(e){this.activeTable.tableTemplate=e,this.isStandardView()&&this.syncAttributeTableTemplate()}updateHighlightsAndSelection(){if(this.activeTable.highlightIds.removeAll(),this.activeTable.highlightIds.addMany(this.selectedFeatureIds),this.activeTable.objectIds.length){const e=this.selectedFeatureIds.filter((e=>!this.activeTable.objectIds.includes(e)));this.activeTable.objectIds.addMany(e)}}getMenuHandle(){const{modules:e}=this;return e.reactiveUtils.watch((()=>this.activeTable?.state),(e=>{"loaded"===e&&(this.syncMenuHandles(),this.activeTable.columns.on("change",(()=>this.syncMenuHandles())))}))}syncMenuHandles(){this.activeTable.columns?.forEach((e=>{e?.menu&&(e?.menu?.addEventListener("calciteDropdownOpen",(()=>{this.fabNode&&(this.fabNode.hidden=!0)})),e?.menu?.addEventListener("calciteDropdownClose",(()=>{this.fabNode&&(this.fabNode.hidden=!1)})))}))}getColumnSortOrderHandle(){const{modules:e}=this;return e.reactiveUtils.watch((()=>this.activeTable.activeSortOrders),(async()=>{"loaded"===this.activeTable.state&&this.isStandardView()&&this.syncAttributeTableTemplate()}))}getColumnReorderHandle(){const{activeTable:e}=this;return e.on("column-reorder",(()=>{this.fieldVisibilityPopoverNode?.parentElement?.removeChild(this.fieldVisibilityPopoverNode),this.fieldVisibilityPopoverNode=void 0,document.body.removeEventListener("click",this.fieldVisibilityPopoverClickHandler),this.isStandardView()&&this.syncAttributeTableTemplate()}))}getAttachmentsViewOptionsHandle(){const{modules:e}=this;return e.reactiveUtils.watch((()=>this.activeTable.attachmentsViewOptions.objectId),(e=>{this.fabNode&&(e&&!this.fabNode.classList.contains("hidden-fab")?this.fabNode.classList.add("hidden-fab"):!e&&this.fabNode.classList.contains("hidden-fab")&&this.fabNode.classList.remove("hidden-fab"))}))}getAttributeTableTemplateHandle(){const{layer:e,modules:t}=this;if(!c.s.includes(e.type))return;return t.reactiveUtils.watch((()=>e.attributeTableTemplate),(async(e,t)=>{if(!t)return;const i=await this.getFieldTemplates(this.layer);this.table.tableTemplate=i,await this.table.refresh()}))}getRelatedAttributeTableTemplateHandle(e){const{modules:t}=this;if(!c.s.includes(e.layer.type))return;return t.reactiveUtils.watch((()=>e.layer?.attributeTableTemplate),(async(t,i)=>{if(t&&i){const t=await this.getFieldTemplates(e.layer);e.tableTemplate=t,await this.table.refresh()}}))}async syncAttributeTableTemplate(){const e=this.activeTable.layer;if(c.s.includes(e.type)){if(e.attributeTableTemplate){const{modules:t}=this,i=e.attributeTableTemplate.clone();t.attributeTableTemplateUtils.syncAttributeTableTemplate(this.activeTable,i),JSON.stringify(i)!==JSON.stringify(e.attributeTableTemplate)&&(e.attributeTableTemplate=i)}if(e.attributeTableTemplate?.orderByFields?.length>1){const t=e.attributeTableTemplate.clone(),i=this.table.activeSortOrders[0];t.orderByFields=[{field:i.fieldName,order:i.direction}],e.attributeTableTemplate=t,this.syncColumnDirectionsWithOrderByFields()}this.arcgisTableUpdated.emit(),this.arcgisChange.emit()}}isStandardView(){return!this.table.relatedTable&&!this.activeTable.attachmentsViewOptions.objectId}syncColumnDirectionsWithOrderByFields(){const e=this.activeTable.activeSortOrders[0]?.fieldName;this.activeTable.columns.forEach((t=>{"fieldName"in t&&t.fieldName!==e&&(t.direction=void 0)})),this.activeTable.tableTemplate?.columnTemplates.forEach((t=>{"fieldName"in t&&t.fieldName!==e&&(t.direction=void 0)}))}focus(){const{isWithinTabsManager:e}=this;e?this.fieldVisibilityActionNode?.setFocus():this.closeButtonNode?.setFocus()}clearFilter(){this.selectedOnlyMode=!1,this.selectedCount=0,this.selectedFeatureIds=[],this.activeTable.objectIds.removeAll()}closePopovers(){document.removeEventListener("click",this.fieldVisibilityPopoverClickHandler),document.removeEventListener("click",this.columnInfoClickHandler),document.removeEventListener("click",this.editMessagePopoverClickHandler),this.fieldVisibilityPopoverNode&&(document.body.removeChild(this.fieldVisibilityPopoverNode),this.fieldVisibilityPopoverNode=void 0),this.columnInfoPopoverNode&&(document.body.removeChild(this.columnInfoPopoverNode),this.columnInfoPopoverNode=void 0),this.removeEditingPopover()}removeEditingPopover(){this.editMessagePopoverNode?.parentElement?.removeChild(this.editMessagePopoverNode),this.editMessagePopoverNode=void 0}removeAllHandles(){this.layerTitleHandle?.remove(),this.tableSizeHandle?.remove(),this.popupActiveHandle?.remove(),this.popupTemplateWatchHandle?.remove(),this.createFeatureHandle?.remove(),this.columnMenuHandle?.remove(),this.attachmentsViewOptionsHandle?.remove(),this.columnSortOrderHandle?.remove(),this.columnReorderHandle?.remove(),this.attributeTableTemplateHandle?.remove(),this.relatedAttributeTableTemplateHandles.forEach((e=>e?.remove())),this.showAllTablesHandle?.remove(),this.relatedTablesHandle?.remove()}getSelectionManager(){const{view:e}=this;return e.selectionManager}canUseSelectionManager(){const{layer:e,useSelectionManager:t}=this;if(!t)return!1;return-1!==this.getSelectionManager().sources.indexOf(e)}static get assetsDirs(){return["assets"]}get el(){return(0,a.a)(this)}};u.style=":host {\n  width: 100%;\n}\n\n.table {\n  height: 100%;\n}\n\n.content {\n  height: 100%;\n  display: flex;\n}\n\n.non-tabs-manager-action-bar-wrapper {\n  padding: 2px 0px;\n  background-color: var(--calcite-color-foreground-1);\n}\n\n.action-bar {\n  height: 100%;\n  border-width: 0 1px 0 0;\n  border-style: solid;\n  border-color: var(--calcite-color-border-2);\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.tooltip {\n  white-space: nowrap;\n}\n\n.menu-actions {\n  display: inline-flex;\n  justify-self: stretch;\n}\n\n.table-fab {\n  position: absolute;\n  bottom: 24px;\n  left: auto;\n  right: 76px;\n  --calcite-opacity-disabled: 0.8;\n}\n\n.hidden-fab {\n  visibility: hidden;\n}\n\n:dir(rtl) {\n  .action-bar {\n    border-width: 0 0 0 1px;\n  }\n  .table-fab {\n    left: 76px;\n    right: auto;\n  }\n}\n\n.esri-grid .esri-column__header-content calcite-dropdown calcite-dropdown-group {\n  max-width: 300px;\n  overflow-x: auto;\n}\n"},10465:(e,t,i)=>{i.d(t,{D:()=>a,a:()=>h,b:()=>r,c:()=>o,g:()=>y,s:()=>T});class a{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}const l=(e,t,i)=>(0,n(t).subscribe)((t=>{const a=t.some((t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target)));a&&i()})),s={},n=e=>{const t=e.join(","),i=s[t];if(void 0!==i)return i;const a=new Set,l=new MutationObserver((e=>a.forEach((t=>t(e)))));globalThis.document&&l.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const n={subscribe:e=>(a.add(e),()=>{a.delete(e),0===a.size&&(l.disconnect(),s[t]=void 0)})};return s[t]=n,n},o=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const a=i.getRootNode?.();if(a===globalThis.document)return null;i=a.host}return null},r=e=>c(e,"dir","ltr"),c=(e,t,i)=>{const a=o(e,`[${t}]`);return a?.getAttribute(t)??i},d=e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},h=()=>[d(2),d(1),d(1),d(1),d(3)].join("-"),u="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),p=new Set(u),m="en",b={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},g={},f=async(e,t)=>{const i=`${t}${e}.json`;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===m?{}:await f(m,t)},y=e=>{const t=c(e,"lang",globalThis.navigator?.language||m);return{lang:t,t9nLocale:v(t)}},v=e=>{const[t,i]=e.split("-"),a=t.toLowerCase();let l=a;return i&&(l=`${a}-${i.toUpperCase()}`),l=b[l]??l,p.has(l)?l:i?v(a):m},T=(e,t,i,a)=>{let s;const n=()=>C(e,t(),a).then((e=>{s?.lang===e.lang&&s.t9nLocale===e.t9nLocale&&s.t9nStrings===e.t9nStrings||i(e),s=e})).catch(console.error);return queueMicrotask(n),l(e,["lang"],n)},C=async(e,t,i=e.localName.split("-").slice(1).join("-"))=>{const{lang:a,t9nLocale:l}=y(e),s=`${t}/${i}/t9n`,n=null===i?{}:await(async(e,t,i="")=>{const a=`${t}/${i}`,l=`${a}${e}.json`;return g[l]??(g[l]=f(e,a)),await g[l]})(l,s,"messages.");return{lang:a,t9nLocale:l,t9nStrings:n}}},20173:(e,t,i)=>{i.d(t,{a:()=>a});const a=e=>e&&!e.endsWith("/")?`${e}/`:e},38698:(e,t,i)=>{var a;i.d(t,{S:()=>a,a:()=>o,e:()=>d,g:()=>c,i:()=>n,r:()=>r,s:()=>s}),function(e){e.SMALL="s",e.MEDIUM="m",e.LARGE="l"}(a||(a={}));const l=["feature","oriented-imagery","map-image","subtype-sublayer"],s=["feature","scene","geojson","csv","subtype-sublayer","oriented-imagery","catalog-footprint"];function n(e,t){for(;e;){if(e.nodeName===t.toUpperCase())return!0;e=e.parentElement}return!1}function o(e,t){const i=document.createElement("calcite-tooltip");i.className="table-tooltip",i.referenceElement=e,i.placement="trailing-start",i.open=!0;const a=document.createElement("div");a.className="tooltip",a.innerHTML=t,i.append(a),document.body.append(i)}function r(){document.querySelectorAll(".table-tooltip").forEach((e=>e.parentNode?.removeChild(e)))}function c(e){return[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap((e=>e.templates)):[]]}function d(e){return(l.includes(e.type)||"sublayer"===e.type&&l.includes(e.layer.type))&&function(e){if(!e?.capabilities)return!1;const{capabilities:{data:{supportsAttachment:t},operations:{supportsQueryAttachments:i}}}=e;return t&&i}(e)}},44735:(e,t,i)=>{function a(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}i.d(t,{i:()=>a})},53127:(e,t,i)=>{i.d(t,{a:()=>l,d:()=>a,t:()=>s});const a=(e,t)=>{let i,a="idle";const l=async(...l)=>await new Promise((s=>{switch(a){case"flushed":a="idle",i?(clearTimeout(i),s(e(...l))):s(null);break;case"invoked":clearTimeout(i),a="idle",s(e(...l));break;case"cancelled":clearTimeout(i),a="idle",s(null);break;default:i&&clearTimeout(i),a="pending",i=setTimeout((()=>{a="idle",s(e(...l))}),t)}}));return l.flush=async function(...e){return a="flushed",await l(...e)},l.invoke=async function(...e){return a="invoked",await l(...e)},l.cancel=async function(...e){return a="cancelled",await l(...e)},l.getStatus=function(){return a},l},l=(e,t)=>{let i;return async(...a)=>await new Promise((l=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,l(e(...a))}),t))}))};function s(e){return new Promise((t=>setTimeout(t,e)))}},84260:(e,t,i)=>{i.d(t,{u:()=>n});var a=i(11254),l=i(10465),s=i(14528);function n({propertyName:e="strings",name:t}){let i=(0,s.r)();const n=(0,l.g)(i.el),r=new l.D,c={_lang:n.lang,_t9nLocale:n.t9nLocale};i.manager.onLoad((()=>r.promise));const d=new WeakRef(i);function h(){const e=d.deref();return e||p?.(),e}i=void 0;const u=o((()=>h()?.el)),p=(0,l.s)(u,(()=>(0,a.g)("./assets")),(({t9nLocale:t,t9nStrings:i,lang:a})=>{const l=h();if(!l)return;l[e]={...i,_lang:a,_t9nLocale:t},r.resolve()}),t);return c}const o=e=>new Proxy({},{get(t,i){const a=e();if(!a)return;const l=Reflect.get(a,i,a);return"function"==typeof l?l.bind(a):l}})},84661:(e,t,i)=>{i.d(t,{a:()=>c,b:()=>u,c:()=>p,d:()=>b,e:()=>o,f:()=>h,g:()=>m,i:()=>r,l:()=>d,u:()=>s});var a=i(69811),l=i(3175);function s(e,t){return n(e,t)||function(e,t){const i=e.owner,a="admin"===e.itemControl,l=["esri_livingatlas","esri_demographics","esri_boundaries"];if(e.portal?.isPortal&&!n(e,t)&&a&&i?.includes("esri_")&&!l.includes(i))return!1;return a}(e,t)}function n(e,t){return e.owner===t.username}function o(e){return e.typeKeywords?.includes("Spatiotemporal")}function r(e){return e.typeKeywords?.includes("View Service")}function c(e){return e.typeKeywords?.includes("Hosted Service")}function d(e){return e.typeKeywords?.includes("Multi Services View")}function h(e){return e?.hasViews&&!e.sourceSchemaChangesAllowed}async function u(e){const t=e?.portalItem;if(!t)return await Promise.resolve(null);const i=t.portal,s=await(0,a.p)();if(i?.user){const e=`${(0,l.g)(i)}community/users/${i.user.username}`;return await s(e,{query:{f:"json",token:t.portal.credential?.token},responseType:"json"}).then((e=>{const t=e.data?.groups??[];return Promise.resolve(t)}),(()=>Promise.reject(new Error("Failed to fetch user groups"))))}return await Promise.resolve(null)}async function p(e){const t=e?.portalItem;if(!t)return await Promise.resolve(null);const i=t.portal,s=await(0,a.p)(),n=`${(0,l.g)(i)}content/items/${t.id}/groups`;return await s(n,{query:{f:"json",token:t.portal.credential?.token},responseType:"json"}).then((e=>{const t=[...e.data?.admin??[],...e.data?.member??[],...e.data?.other??[]];return Promise.resolve(t)}),(()=>Promise.reject(new Error("Failed to fetch item groups"))))}async function m(e,t,{relationshipType:i,direction:s}){const n=`${(0,l.g)(t)}content/items/${e}/relatedItems`,o=await(0,a.p)();return await o(n,{query:{f:"json",relationshipType:i,direction:s},responseType:"json"})}function b(e,t){return e?.some((e=>t?.some((t=>e.id===t.id&&e.capabilities.includes("updateitemcontrol")))))}}}]);