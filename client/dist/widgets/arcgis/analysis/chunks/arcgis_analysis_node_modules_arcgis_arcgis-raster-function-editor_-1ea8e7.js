"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-1ea8e7"],{62293:(e,t,i)=>{i.r(t),i.d(t,{rfx_args_editor:()=>k,rfx_cte_attribute_table:()=>u.R,rfx_dte_band_matrix:()=>A,rfx_dte_cell_size_input:()=>w,rfx_dte_color_ramp_selector:()=>L,rfx_dte_extent:()=>D,rfx_dte_feature_select:()=>_,rfx_dte_geometry:()=>F,rfx_dte_json_file_uploader:()=>P,rfx_dte_local_raster_inputs:()=>B,rfx_dte_multiple_input:()=>W,rfx_dte_property_set:()=>$,rfx_dte_raster_array_editor:()=>K,rfx_dte_raster_info:()=>Z,rfx_dte_rft_browser:()=>ie,rfx_dte_spatial_reference_picker:()=>re,rfx_dte_statistics_grid:()=>ne,rfx_dtex_aggregation_definition_editor:()=>Ee,rfx_dtex_arg_slider:()=>we,rfx_dtex_band_index_picker:()=>Se,rfx_dtex_band_name_picker:()=>Te,rfx_dtex_linear_unit:()=>Re,rfx_dtex_multidimensional_definition_editor:()=>Ze,rfx_dtex_raster_dimension_select:()=>et,rfx_dtex_raster_variables_list:()=>st,rfx_dtex_switchable:()=>ot,rfx_help_popover:()=>ft,rfx_item_browser:()=>bt,rfx_node_interaction_toolbar:()=>xt,rfx_save_modal:()=>Et,rfx_select_layer_panel:()=>At,rfx_share_modal:()=>wt,rfx_spatial_reference_popover:()=>St,rfx_template_editor:()=>Rt,rfx_textarea_input:()=>_t,rfx_tree:()=>Ot});var a=i(83628),r=i(19956),s=i(24360),n=i(48001),l=i(5839),o=i(33797),c=i(74579),h=i(42335),d=i(92991),u=(i(588),i(5294),i(55448),i(2924),i(11840),i(52373),i(33752),i(440),i(66744),i(15320)),f=i(95069),p=(i(71802),i(44345),i(32513),i(36596),i(38124)),m=(i(13661),i(18423),i(21255),i(35431),i(23795),i(17902),i(56451),i(23054)),g=i(74670),b=i(93442),v=i(15026),x=i(71144),y=i(38306);const C="rfx-args-editor",E={unsupportedComponentMessage:`${C}__unsupported-component-message`,unsupportedComponentContainer:`${C}__unsupported-component-container`},k=class{constructor(e){(0,a.r)(this,e),this.rfxArgHelpClick=(0,a.c)(this,"rfxArgHelpClick"),this.rfxUnsupportedFunctionFound=(0,a.c)(this,"rfxUnsupportedFunctionFound"),this.rfxBrowseClick=(0,a.c)(this,"rfxBrowseClick"),this.direction="ltr",this.rasterFunctions=null,this.enumLabels=null,this.categoryReference=null,this.isFunctionChain=!1,this.hasHiddenFunctions=!1,this.hasUnsupportedFunctions=!1,this.hasDeprecatedFunctions=!1,this.hasPublicDeprecatedFunctions=!1,this.isTemplateValid=!0,this.templateErrors=new Set,this._inputWidgets=[],this.visibleArgumentNames=[],this.nodesTraversedList=new Set,this.rfxSectionMapper=new Map,this.pseudoArgs=new Set,this.showChildrenRFTs=!0,this.showAllArguments=!1,this.showVariableNames=!0,this.mode=h.M.ANALYSIS,this.showUnsupportedFunction=!1,this.handleHelpActionClick=e=>{const{helpTextID:t,heading:i,referenceElement:a}=e;return async()=>{const e=await(0,c.b)(t);this.rfxArgHelpClick.emit({referenceElement:a,helpSrcdoc:e,heading:i})}}}onRfxTemplateChange(){this.nodesTraversedList=new Set}async componentWillLoad(){({strings:this.strings,dir:this.direction,locale:this.locale}=await(0,l.c)(this.hostElement,(0,a.a)(".")));const{locale:e}=(0,l.g)(this.hostElement);this.rasterFunctions=await(0,n.G)(e),this.enumLabels=await(0,s.g)(e),this.categoryReference=await(0,s.e)(e),this.argDataTypes=s.d,this.domainTypes=s.b}componentDidRender(){if(void 0!==this.rfxTemplate){this._rfxTemplate=(0,n.m)(this.rfxTemplate);const{honorIsPublic:e,hasAlias:t,aliasUpdatedRFT:i}=(0,n.B)(this.rfxTemplate);this._honorIsPublic=e,!0===t&&(this._rfxTemplate=i),this.hasDeprecatedFunctions=!1}void 0!==this.argsContainterNode&&void 0!==this._rfxTemplate&&this.populateUI()}async getUpdatedRFTWithValues(){const e=this._getUpdatedRFTWithValues(this._rfxTemplate),t=(0,n.m)(e,["input","uxBlocks","overrideWidget","displayName","helpTextID",...this.pseudoArgs]);return Promise.resolve(t)}async checkTemplateValidity(){const e=await(0,u.l)(this._rfxTemplate),t={valid:this.isTemplateValid&&e};return this.templateErrors.size>0?t.errorStrings=[...this.templateErrors]:t.errorKeys=["default"],Promise.resolve(t)}populateUI(){if(this.argsContainterNode.innerHTML="",this.visibleArgumentNames=[],this.isFunctionChain=(0,n.A)(this._rfxTemplate),this.buildRFxTemplateUI(this._rfxTemplate),!0===this.hasPublicDeprecatedFunctions&&this.rfxUnsupportedFunctionFound.emit({hasDeprecatedFunction:!0}),!0===this.hasUnsupportedFunctions&&this.rfxUnsupportedFunctionFound.emit(),!(0,d.i)(this.rfxTemplate.customFunction)){const e=document.createElement("div"),t=Array.from(this.argsContainterNode.children);t.sort(((e,t)=>parseInt(e.getAttribute("placement"))-parseInt(t.getAttribute("placement")))),t.forEach((t=>e.appendChild(t)));const i=(0,p.m)({content:e,unsupportedWarningComponent:void 0,title:void 0,isFunctionChain:this.isFunctionChain});this.argsContainterNode.innerHTML="",this.argsContainterNode.appendChild(i)}}buildRFxTemplateUI(e){const t=e[d.A];if(e[d.F]&&e.name&&!(0,d.i)(t)&&!1===this.nodesTraversedList.has(e._object_id)&&(this.buildRFxUI(e),(0,d.i)(e._object_id)||this.nodesTraversedList.add(e._object_id)),!1===this.showChildrenRFTs||(0,d.i)(t)||!0===this.hasUnsupportedFunctions)return;if((0,d.a)(t))return void this.buildArgRFTUI(t);const i=(0,d.k)(e);for(const e in t){if(e===d.T)continue;const a=t[e],r=(0,d.l)(a);i&&"RasterCollection"!==e&&!r&&!1===this._honorIsPublic||(0,d.a)(a)&&this.buildArgRFTUI(a)}}isUnsupportedFunction(e){return!0!==this.showUnsupportedFunction&&this.hasPublicArguments(e)}hasPublicArguments(e){return Object.keys(e.arguments).some((t=>{const i=e.arguments[t];return i.type!==d.R&&!0!==i.isDataset&&this._isShown(i)}))}buildRFxUI(e){const t=e[d.A];let i=[];const a=[],r=[],s=[],l=(0,n.q)({schema:this.rasterFunctions,rfxTemplate:e});if(l?.category===d.D){if(this.hasDeprecatedFunctions=!0,this.hasPublicArguments(e))return void(this.hasPublicDeprecatedFunctions=!0)}else l?.hidden&&(this.hasHiddenFunctions=!0);if(l?.hidden&&this.isUnsupportedFunction(e))return void(this.hasUnsupportedFunctions=!0);const o=l?.rasterFunctionArguments,c=l?.editorArgumentOverride?.active?l.editorArgumentOverride.overrides:null;(0,d.i)(e.customFunction)||(t.customFunction=e.customFunction);const h=document.createElement("div");h.setAttribute("id",(0,d.u)("rfx-container-"));const u=document.createElement("div");let f;!0===this.isFunctionChain?this.argsContainterNode.prepend(u):this.argsContainterNode.appendChild(u);const m={functionSchema:l,functionSchemaArgs:o,schemaEditorOverrides:c,rfxArgs:t,container:h,stateTriggerArgs:r,valueTriggerArgs:s,overriddenArgNames:i,unsupportedOverrideArgs:a},g=e=>{e&&(i=[...i,...e.overriddenArgNames],a?.push(...e.unsupportedOverrideArgs))},b=e=>{Object.keys(e).forEach((e=>{const i=(0,n.b)(e,t);i&&(0,d.a)(i)&&!i.uxBlocks&&(f=this.buildRFxArgUI({...m,rfxArg:i,rfxArgName:e}),g(f))}))};if((0,d.i)(t)||((0,d.a)(t)?(f=this.buildRFxArgUI({rfxArg:t,...m}),g(f)):((0,d.i)(o)||b.bind(this)(o),b.bind(this)(t)),r.forEach((e=>{const i=e.rfxArg,a=i&&i.value;this._handleEditorStateTriggers(t,a,e.schemaArgDef)})),s.forEach((e=>{const i=e.rfxArg,a=i&&i.value;this._handleEditorValueTriggers(t,a,e.schemaArgDef)}))),!0===this.hasDeprecatedFunctions?((0,d.i)(this.deprecatedFunctionNotice)||(this.deprecatedFunctionNotice.remove(),this.deprecatedFunctionNotice=null),this.deprecatedFunctionNotice=this.createDeprecatedFunctionWarningComponent(),u.appendChild(this.deprecatedFunctionNotice)):(0,d.i)(this.deprecatedFunctionNotice)||(this.deprecatedFunctionNotice.remove(),this.deprecatedFunctionNotice=null),this.hasHiddenFunctions?((0,d.i)(this.unsupportedFunctionNotice)||(this.unsupportedFunctionNotice.remove(),this.unsupportedFunctionNotice=null),this.unsupportedFunctionNotice=this.createUnsupportedFunctionWarningComponent(),u.appendChild(this.unsupportedFunctionNotice)):(0,d.i)(this.unsupportedFunctionNotice)||(this.unsupportedFunctionNotice.remove(),this.unsupportedFunctionNotice=null),h.childNodes&&h.childNodes.length&&this.showChildrenRFTs&&(0,d.i)(t.customFunction)){let t=null;a?.length>0&&(this.isTemplateValid=!1,t=this.createUnsupportedWarningComponent(a));const i=(0,p.m)({content:h,unsupportedWarningComponent:t,title:e.function?.name,isFunctionChain:this.isFunctionChain});u.appendChild(i)}else(0,d.i)(t.customFunction)||u.setAttribute("placement",t.customFunction?.placement),u.appendChild(h)}createInputWidget(e,t,i,a){let r;e||(r=void 0);const n=i?.dataType,l=e.value??i?.defaultValue,o=i?.domain,c=i?.dataTypeAttributes;return e.isDataset||n===s.d.raster?(r=document.createElement("rfx-dte-raster-input"),r.inputLayers=this.imageryLayers,r.rfxVariable=e,r.allowScalar=i?.allowScalar,r.value=l,r.mode=this.mode,r.portal=this.portal):r=o?this.getDomainBasedWidget({domain:o,argDetails:{rfxArg:e,argSchema:i,rfxArgs:a},value:l}):this.getDataTypeBasedWidget({dataType:n,dataTypeAttributes:c,argDetails:{rfxArg:e,argSchema:i,rfxArgs:a}}),r&&(r.addEventListener("rfxArgumentChange",(t=>{this.onArgumentValueChange({rfxArg:e,argSchema:i,rfxArgs:a},t?.detail.value)})),r.rfxBrowseLayerClick=this.handleBrowseLayerClick.bind(this),t.appendChild(r),e.input=r,this._inputWidgets.push(r),this.attachRFxArgHelpClick(r)),r}buildArgRFTUI(e){if(!e)return;let t=(0,n.p)(e);if(t)this.buildRFxTemplateUI(t);else if((0,n.r)(e)){const i=e.value.elements??(Array.isArray(e.value)?e.value:[e.value]);Array.from(i).forEach((e=>{t=(0,n.p)(e),t&&this.buildRFxTemplateUI(t)}))}}buildRFxArgUI(e){let t,i="",a=(e=e||{}).overriddenArgNames,r=[];const s=e.rfxArg,l=e.rfxArgName,o=e.functionSchemaArgs,c=e.schemaEditorOverrides,u=e.rfxArgs,f=e.stateTriggerArgs,m=e.valueTriggerArgs;let g=e.container;if(s){if(o&&(i=(0,n.n)(o,l),t=o[i],t&&(t.key=i)),this._isShown(s,t)&&t?.categoryRefId){let e=this.rfxSectionMapper.get(`${g?.id}-${t.categoryRefId}`);if((0,d.i)(e?.label)){const i=this.categoryReference?.[t.categoryRefId],a=i.visible,r=i.title;e=(0,p.n)({open:a,label:r}),this.rfxSectionMapper.set(`${g?.id}-${t.categoryRefId}`,e),g.appendChild(e)}g=e}return Array.isArray(c)&&c.forEach((e=>{const t=e.argumentNames;if(Array.isArray(t)&&t.indexOf(i)>=0&&this._isOverrideWidgetShown(e.argumentNames,u)){const s=t.some((e=>{const t=(0,n.b)(e,u);if(this.isAVisibleArgumentName(t.name))return!0}));Array.isArray(a)&&a.indexOf(i)<0&&!1===s&&(e?.widget?.path?(a=a.concat(e.argumentNames),this._buildOverrideWidgetLayout(e,u,g,o)):r=r.concat(e.argumentNames))}})),Array.isArray(a)&&a.indexOf(i)<0&&("rfxtemplate"===t?.dataType||this.mode===h.M.EDITOR||s?.type!==d.R)&&this._isShown(s,t)&&this.buildRFxArgLayout(s,g,t,u),t&&t.editorStateTrigger&&t.editorStateTrigger.active&&f.push({rfxArg:s,schemaArgDef:t}),t&&t.editorValueTrigger&&t.editorValueTrigger.active&&m.push({rfxArg:s,schemaArgDef:t}),{overriddenArgNames:a,unsupportedOverrideArgs:r}}}_isOverrideWidgetShown(e,t){return e.every((e=>{const i=(0,n.b)(e,t);return this._isShown(i)}))}_buildOverrideWidgetLayout(e,t,i,a){if(!e)return;const r={},s={},l={};let o,c,h="";e.triggerAttributes&&(h=e.triggerAttributes),e?.argumentNames?.forEach((e=>{o=(0,n.b)(e,t),c=a[e],(0,d.i)(o)&&c.isPseudoArg&&(o=c,t[e]=o),(0,d.i)(c)||(c.key=e),o&&(o.displayName=this.getArgDisplayName(o.name,c),o.helpTextID=c?.helpTextID,((0,d.i)(o.value)||Array.isArray(o.value)&&0===o.value.length)&&c.defaultValue&&(o.value=c.defaultValue),s[e]=o)}),this),e?.triggerArguments?.forEach((e=>{o=(0,n.b)(e,t),c=a[e],(0,d.i)(c)||(c.key=e),o&&(o.displayName=this.getArgDisplayName(o.name,c),o.helpTextID=c?.helpTextID,l[e]=o)}),this),Object.keys(a).forEach((e=>{a[e].dataType===this.argDataTypes.raster&&(o=(0,n.b)(e,t),o&&(r[e]=o))}),this);const u=document.createElement("div");u.setAttribute("display","block"),i.appendChild(u),this._createOverrideWidget(e.widget.path,{rasterFunctionEnums:this.enumLabels,rasterFunctions:this.rasterFunctions,rasterArgs:r,rfxArgs:t,inputArgs:s,triggerArgs:l,triggerAttributes:h,overrideWidgetPath:e.widget.path,helpTextIDs:e.helpTextIDs,inputLayers:this.imageryLayers,featureLayers:this.featureLayers,getRFT:this._getUpdatedRFTWithValues.bind(this),allowScalar:!1,isShownFx:this._isShown,argSchema:c,browseProperties:{map:this.mapView},portal:this.portal,mode:this.mode,onHelpActionClick:e=>this.handleHelpActionClick(e),onRfxBrowseLayerClick:this.handleBrowseLayerClick.bind(this)},u)}attachRFxArgHelpClick(e){e.addEventListener("rfxArgHelpClick",(e=>{const{referenceElement:t,helpSrcdoc:i,heading:a}=e.detail;this.rfxArgHelpClick.emit({referenceElement:t,helpSrcdoc:i,heading:a})}))}_createOverrideWidget(e,t,i){const a=t?.rfxArgs,r=Object.keys(t?.inputArgs||{})[0],s=(0,n.b)(r,a),l=(0,n.i)(a),o=t?.rasterFunctions?.[l],c=o?.rasterFunctionArguments?.[r],h=document.createElement(e);h.widgetArgs=t,this.attachRFxArgHelpClick(h),h.addEventListener("rfxArgumentChange",(e=>{this.onArgumentValueChange({rfxArg:s,argSchema:c,rfxArgs:a},e?.detail.value)})),i.appendChild(h);const d=t&&t.inputArgs;this._inputWidgets.push(h),d&&Object.keys(d).forEach((e=>{const t=d[e];t&&(t.uxBlocks=[i],t.overrideWidget=h)}))}_isShown(e,t){return!(!e||t?.hidden)&&(!(0,d.j)(e)&&!(0,d.h)(e)&&(!!this.showAllArguments||(!this._honorIsPublic||!(!e.isPublic&&!this._hasVisibleElements(e)))))}_hasVisibleElements(e){if(!e)return!1;if((0,d.c)(e))return!1;const t=e.value?.elements??e.value;return!!Array.isArray(t)&&t.some((e=>this._isShown(e)))}buildRFxArgLayout(e,t,i,a){const r=i?.dataType===this.argDataTypes.boolean,s=(0,n.s)(i),l=Boolean(i?.domain),o=document.createElement("div");if(o.setAttribute("type","layout"),s||!this.isAVisibleArgumentName(e.name)){if(r&&(t.appendChild(o),e.uxBlocks=[o]),!s)return r&&!l?this.buildBooleanLayout(o,e,i,a):this.buildStdTwoRowLayout(t,e,i,a);this.buildRFxWidgetLayout(o,e,i,a)&&(t.appendChild(o),e.uxBlocks=[o])}}isAVisibleArgumentName(e){return!!this.visibleArgumentNames.includes(e)||(this.visibleArgumentNames.push(e),!1)}buildRFxWidgetLayout(e,t,i,a){const r=document.createElement("div"),s=this.createInputWidget(t,r,i,a);return s&&e.appendChild(r),s}buildBooleanLayout(e,t,i,a){const r=document.createElement("calcite-label");r.alignment="start",r.scale=o.U.Scale,r.layout="inline-space-between";const s=document.createElement("div"),n=this.getArgDisplayName(t.name,i),l=(0,p.o)({label:n,hideHelp:(0,d.i)(i?.helpTextID),onHelpActionClick:this.handleHelpActionClick({heading:n,referenceElement:r,helpTextID:i?.helpTextID})});r.appendChild(s),r.appendChild(l),e.appendChild(r),this.createInputWidget(t,s,i,a)}buildStdTwoRowLayout(e,t,i,a){const r=document.createElement("div"),s=document.createElement("calcite-label");s.alignment="start",s.scale=o.U.Scale,s.layout="default";const n=this.getArgDisplayName(t.name,i),l=(0,p.o)({label:n,hideHelp:(0,d.i)(i?.helpTextID),onHelpActionClick:this.handleHelpActionClick({heading:n,referenceElement:s,helpTextID:i?.helpTextID})});s.appendChild(l),s.appendChild(r),e.appendChild(s),t.uxBlocks=[s],this.createInputWidget(t,r,i,a)}_getActiveStateTriggers(e,t,i){const a=(0,n.i)(e),r=[];return Object.keys(e).forEach((s=>{const l=this.rasterFunctions[a],o=l&&l.rasterFunctionArguments&&l.rasterFunctionArguments[s];let c=this.getArgumentValue(e[s],o);"boolean"==typeof c||isNaN(c)||(c=Number(c)),o&&"raster"===o.dataType&&i?.key===s&&t&&"change"===t.type&&(c=t&&t.detail.widget.value);if(!(o?.editorStateTrigger?.active&&e))return;Array.isArray(o.editorStateTrigger.triggers)&&o.editorStateTrigger.triggers.forEach((t=>{let i,l,o,h,d,u,f;const p=t.autoRevert||!1,m=t.checkValuePresent?!!c:Array.isArray(t.values)&&t.values.indexOf(c)>=0;(m||p)&&Object.keys(e).forEach((c=>{if(c===s)return;const g=this.rasterFunctions?.[a],b=g?.rasterFunctionArguments?.[c],v=b&&b.categoryRefId;i=e[c],h=i?.uxBlocks,h&&Array.isArray(h)&&(l=(0,n.t)(t.active,c),o=(0,n.t)(t.inactive,c),d=l&&m||o&&!m&&p,u=o&&m||l&&!m&&p,d&&(f=h&&h[0]&&"div"===h[0].tagName?"table-row":"block",r.push({state:"active",rfxArgName:c,display:f,category:v})),u&&(f="none",r.push({state:"inactive",rfxArgName:c,display:f,category:v})))}),this)}),this)}),this),r}_handleEditorStateTriggers(e,t,i){if(!(i&&i.editorStateTrigger&&i.editorStateTrigger.active&&e))return;let a=this._getActiveStateTriggers(e,t,i);let r,s,n,l;a=a.filter(((e,t,i)=>{if(i.some(((i,a)=>a>t&&i.rfxArgName===e.rfxArgName&&i.state===e.state)))return!1;return!i.some(((i,a)=>a!==t&&i.rfxArgName===e.rfxArgName&&i.state!==e.state))||"active"!==e.state}),this),a.forEach((function(t){r=t.rfxArgName,s=e[r],n=s.uxBlocks,l=s.input;const a="active"===t.state,o=l&&l.onChange,c=r&&r.toLowerCase(),h=i&&i.key&&i.key.toLowerCase();a&&o&&c!==h&&l.onChange(l.value),n.forEach((e=>{e&&t.display&&e?.className?.indexOf("calcite-component")<0&&(e.style.display=t.display,e.setAttribute("display",t.display))}))}),this)}_handleEditorValueTriggers(e,t,i){if(i&&i.editorValueTrigger&&i.editorValueTrigger.active&&e){if(!Array.isArray(i.editorValueTrigger.triggers))return;i.editorValueTrigger.triggers.forEach((i=>{let a,r,s;Array.isArray(i.values)&&i.values.indexOf(t)>=0&&Object.keys(e).forEach((t=>{a=e[t],r=a.input,r&&(s=this._getTriggerArgValue(i.changedArgs,t),null!=s&&(r.value=s))}))}),this)}}getArgDisplayName(e,t){if(!t||!t.displayName)return e;if(this.showVariableNames){const i=t?.key;return null==e||""===e||e.toLowerCase()===i?.toLowerCase()||!1===this._honorIsPublic?t.displayName:e}return t.displayName}getArgumentValue(e,t){if(!e)return;let i,a,r,s=[];const n=e.input,l=t&&t.dataType;if(!n)return e.value;const o=[h.A.RFX_DTE_COLOR_RAMP_SELECTOR],c=[h.A.RFX_DTEX_RASTER_VARIABLES_LIST,h.A.RFX_CTE_RANGED_VALUE_EDITOR,h.A.RFX_CTE_GAMMA_EDITOR,h.A.RFX_CTE_FACTOR_FUNCTION_EDITOR,h.A.RFX_CTE_NEIGHBORHOOD_VALUES,h.A.RFX_CTE_SYNCHRONIZE_OUTPUT_UNIT_PICKER,h.A.RFX_DTE_EXTENT,h.A.RFX_CTE_DIMENSIONLESS_EDITOR,h.A.RFX_DTE_MULTIPLE_INPUT],p=e=>e.some((e=>n.tagName===e));if(p(o))return(0,u.b)(n.value);if(n.tagName===h.A.RFX_DTE_COMMON_CHECKBOX)return t&&t.reverseDisplayValue?!n.checked:n.checked;if(i=n.value,p(c))return i;switch(l&&l.indexOf("array")>=0&&i&&"string"==typeof i&&(i=i.trim(),s=i.indexOf(",")>=0?i.split(","):i.split(" ")),l&&l===this.argDataTypes.boolean&&"string"==typeof i&&(i="true"===n.value),l){case this.argDataTypes.raster:return e.isDataset?i:{value:i,type:"Scalar"};case this.argDataTypes.longArray:if(s)return s.forEach((function(e,t){s[t]=parseInt(e,10)})),s;break;case this.argDataTypes.doubleArray:const t="string"==typeof i?s:i?.length>0?i:s;if(t.length>0)return t.map((e=>parseFloat(e)));break;case this.argDataTypes.stringArray:case this.argDataTypes.rasterArray:return s.length>0?(s.forEach((function(e,t){s[t]=e.trim()})),s):i;case this.argDataTypes.double:case this.argDataTypes.long:return(0,f.p)(i);case this.argDataTypes.cellSize:return i;case void 0:return"string"==typeof i&&(i=i?.trim()),a=(0,d.d)(i),r=(0,d.e)(i),a?parseFloat(i):r?"true"===i:i;default:return i}}_getTriggerArgValue(e,t){if(!Array.isArray(e))return;let i;return e.some((e=>{for(const a in e)if(e.hasOwnProperty(a)&&a.toLowerCase()===t.toLowerCase())return i=e[a],!0;return!1})),i}getDomainBasedWidget({domain:e,argDetails:t,value:i}){if(!e||!t)return;const{rfxArgs:a}=t,r=e?.type,l=(0,n.w)(e.enum);let o;switch(r){case this.domainTypes.list:o=document.createElement("rfx-dtex-common-select"),o.mode=this.mode,o.options=l,o.value=i?.toString();break;case this.domainTypes.range:o=document.createElement("rfx-dtex-arg-slider"),o.direction=this.direction,o.max=e.max,o.min=e.min,o.value=i;break;case this.domainTypes.fields:o=document.createElement("rfx-dtex-field-select"),o.mode=this.mode,o.layerArg=(0,n.b)(e.argumentName,a),o.otherOptions=e.otherOptions,o.value=i;break;case this.domainTypes.numList:o=document.createElement("rfx-dtex-common-select"),o.mode=this.mode;const{start:t,inc:c,count:h}=e;o.options=e?Array.from({length:h},((e,i)=>({key:`${t+i*c}`,label:`${t+i*c}`}))):[],o.otherOptions=e.otherOptions,o.value=i?.toString();break;case s.b.bandIndex:o=document.createElement("rfx-dtex-band-index-picker"),o.layerArg=(0,n.b)(e.argumentName,a),o.otherOptions={...e.otherOptions,mode:this.mode},o.value=i;break;case s.b.bandName:o=document.createElement("rfx-dtex-band-name-picker"),o.layerArg=(0,n.b)(e.argumentName,a),o.otherOptions={...e.otherOptions,mode:this.mode},o.value=i;break;case s.b.switchable:const u=(0,n.x)(e.attributes,a);o=document.createElement("rfx-dtex-switchable"),o.switchAttributes=u,o.value=i,o.otherOptions={mode:this.mode,defaultValue:i};break;case s.b.linearUnit:o=document.createElement("rfx-dtex-linear-unit"),o.unitOptions=l,o.value=i,o.otherOptions={mode:this.mode};break;case s.b.rasterDimensions:{const t=(0,n.b)(e.argumentName,a);o=document.createElement("rfx-dtex-raster-dimension-select"),o.layerArg=t,o.otherOptions={...e.otherOptions,mode:this.mode},o.value=i;break}case s.b.rasterVariables:{const t=(0,n.b)(e.argumentName,a);o=document.createElement("rfx-dtex-raster-variables-list"),o.layerArg=t,o.otherOptions=e.otherOptions,o.value=i;break}case s.b.mdimdef:{const t=(0,n.b)(e.argumentName,a);o=document.createElement("rfx-dtex-multidimensional-definition-editor"),o.layerArg=t,o.otherOptions={...e.otherOptions,helpTextIDs:e.helpTextIDs,onHelpActionClick:e=>this.handleHelpActionClick(e),inputLayers:this.imageryLayers,mode:this.mode},o.domainAttributes=e.attributes,o.value=i;break}case s.b.aggregationdef:const f=(0,n.b)(e.argumentName,a);let p,m=f;const g=!0===f.function?.customFunction;"RasterFunctionTemplate"===f?.type&&"MultidimensionalFilterFunction"===f.function?.type&&(m=f.arguments.Raster,p=f.arguments.Filter);let b=!1;"RasterCollectionFunctionArguments"===a[d.T]&&(b=!0),o=document.createElement("rfx-dtex-aggregation-definition-editor"),o.layerArg=m,o.filterArg=p,o.otherOptions={...e.otherOptions,helpTextIDs:e.helpTextIDs,onHelpActionClick:e=>this.handleHelpActionClick(e),inputLayers:this.imageryLayers,mode:this.mode,isPRCFunction:b,isCustomFunction:g},o.domainAttributes=e.attributes,o.value=i;break;default:o=this.createUnsupportedWidget(`domain type ${r.toUpperCase()}`)}return o}getDataTypeAttributeBasedWidget({dataType:e,dataTypeAttributes:t,value:i,rfxArgs:a}){const r=document.createElement("rfx-dte-band-matrix");return r.dataTypeAttributes=t,r.value=i,r.nBandsArg=(0,n.b)(t.nBands,a),r.dataType=e,r}getDataTypeBasedWidget({dataType:e,argDetails:t,dataTypeAttributes:i}){const{argSchema:a,rfxArg:s,rfxArgs:l}=t;let c,h=s.value;const u=null==h?a&&a.defaultValue:h;if(i&&"bandmatrix"===i.type)return this.getDataTypeAttributeBasedWidget({dataType:e,dataTypeAttributes:i,value:h,rfxArgs:l});switch(e){case this.argDataTypes.raster:s.isDataset||(c=document.createElement("rfx-dte-number-input"),c.value=h);break;case this.argDataTypes.string:c=document.createElement("calcite-input-text"),c.scale=o.U.Scale,c.dir=this.direction,c.value=h?.toString();break;case this.argDataTypes.double:case this.argDataTypes.long:c=document.createElement("rfx-dte-number-input"),c.value=u,c.numberType=a?.numberType,c.min=a?.minValue,c.max=a?.maxValue,c.excludeMinValue=a?.excludeMinValue,c.excludeMaxValue=a?.excludeMaxValue;break;case this.argDataTypes.boolean:c=document.createElement("calcite-checkbox"),c.addEventListener("calciteCheckboxChange",(e=>{const t=e.target.checked;this.onArgumentValueChange({rfxArg:s,argSchema:a,rfxArgs:l},t)})),c.dir=this.direction,c.checked=a&&a.reverseDisplayValue?!h:h;break;case this.argDataTypes.stringArray:h&&h.length&&(h=h.join(" ")),c=document.createElement("calcite-input-text"),c.dir=this.direction,c.scale=o.U.Scale,c.value=h?.toString();break;case this.argDataTypes.doubleArray:c=document.createElement("rfx-dte-multiple-input"),c.value=h,c.validationOptions={numberType:r.N.FLOAT,min:a?.minValue};break;case this.argDataTypes.longArray:c=document.createElement("rfx-dte-multiple-input"),c.value=h,c.validationOptions={numberType:r.N.INTEGER,min:a.minValue};break;case this.argDataTypes.featureClass:c=document.createElement("rfx-dte-feature-select"),c.inputLayers=this.featureLayers,c.value=h,c.mode=this.mode;break;case this.argDataTypes.geometry:c=document.createElement("rfx-dte-geometry"),c.inputLayers=this.featureLayers,c.value=h,c.mode=this.mode,c.otherOptions={...a?.otherOptions,onHelpActionClick:e=>this.handleHelpActionClick(e)};break;case this.argDataTypes.rasterArray:const t=a?.elementInfos;let i;if(t&&(i=(0,n.y)(a,l)),i){const e=this.getRasterElementsForLocalFunction(h,i);if(h&&e.every((e=>(0,d.i)(e))))break;c=document.createElement("rfx-dte-local-raster-inputs"),c.inputLayers=this.imageryLayers,c.value=h,c.allowScalar=a.allowScalar,c.schemaElementInfos=i,c.mode=this.mode,c.rfxArgs=l,c.rasterElements=e}else c=document.createElement("rfx-dte-raster-array-editor"),c.inputLayers=this.imageryLayers,c.getRFT=this.getRFT.bind(this),c.allowScalar=a.allowScalar,c.value=h,c.otherOptions={mode:this.mode};break;case this.argDataTypes.cellSize:c=document.createElement("rfx-dte-cell-size-input"),c.value=h,c.excludeMinValue=a?.excludeMinValue;break;case this.argDataTypes.rasterStatisticsArray:case this.argDataTypes.arrayOfRasterStatistics:c=document.createElement("rfx-dte-statistics-grid"),c.layerArg=(0,n.b)("Raster",l),c.value=h;break;case this.argDataTypes.colorRamp:c=document.createElement("rfx-dte-color-ramp-selector"),c.value=h;break;case this.argDataTypes.file:c=document.createElement("rfx-dte-json-file-uploader"),c.value=h,c.fileExtSupported=a.fileExtSupported;break;case void 0:c=document.createElement("calcite-input-text"),c.scale=o.U.Scale,c.dir=this.direction;try{c.value="string"==typeof h?h:JSON.stringify(h)}catch(e){c.value=h}break;case this.argDataTypes.extent:c=document.createElement("rfx-dte-extent"),c.value=h;break;case this.argDataTypes.spatialReference:c=document.createElement("rfx-dte-spatial-reference-picker");const f=["Vertical Coordinate Systems"];c.hideCategories=f,c.value=h;break;case this.argDataTypes.rasterInfo:c=document.createElement("rfx-dte-raster-info"),c.inputLayers=this.imageryLayers,c.getRFT=this.getRFT.bind(this),c.allowScalar=a.allowScalar,c.value=h,c.otherOptions={mode:this.mode};break;case this.argDataTypes.rfxtemplate:c=document.createElement("rfx-dte-rft-browser"),c.scale=o.U.Scale,c.value=h,c.mode=this.mode,c.portal=this.portal,c.rfxVariable=s;break;case this.argDataTypes.table:c=document.createElement("rfx-cte-attribute-table"),c.widgetArgs={rfxArgs:l,inputArgs:l,inputLayers:this.imageryLayers,portal:this.portal,mode:this.mode,helpTextIDs:{attributetable_raster:"attributetable_raster",attributetable_tabletype:"attributetable_tabletype",attributetable_browsetablefrom:"attributetable_browsetablefrom"},onHelpActionClick:e=>this.handleHelpActionClick(e),onRfxBrowseLayerClick:this.handleBrowseLayerClick.bind(this)};break;case this.argDataTypes.propertySet:c=document.createElement("rfx-dte-property-set"),c.value=h;break;default:c=this.createUnsupportedWidget(`data type ${e.toUpperCase()}`)}return c&&(c.dir=this.direction),c}getRFT(e){return e=this._getUpdatedRFTWithValues(e),(0,n.m)(e,["input","uxBlocks"])}getRasterElementsForLocalFunction(e,t){if(!e)return;const i=e.elements?.length?e.elements:e;return t.map(((e,t)=>{const a=i[t];if((0,d.i)(a))return;const r=this._isShown(a);if((0,d.c)(a)||!r)return;const s=r&&this._honorIsPublic;a.name=(this.isFunctionChain||s)&&"editor"!==this.mode?a.name:e.displayName??a.name;return this.isAVisibleArgumentName(a.name)?void 0:a}))}_getUpdatedRFTWithValues(e){const t=e[d.A],i=(0,n.q)({schema:this.rasterFunctions,rfxTemplate:e});if((0,d.i)(t))return e;if((0,d.a)(t))return e[d.A]=this._getUpdatedRFxArg(t,"Raster",i),e;if(Object.keys(t).forEach((e=>{if(e===d.T)return;const a=t[e];a&&(t[e]=this._getUpdatedRFxArg(a,e,i))})),"ColormapFunctionArguments"===t[d.T]){const e=t?.ColorSchemeType?.value;0===e?t.ColorRamp.value=void 0:t.ColormapName.value=void 0}if("TableFunctionArguments"===t[d.T]){const e=t.AttributeTableAsRecordSet;if(!(0,d.i)(e)){const{fields:i,features:a,type:r}=e,s={name:"AttributeTable",value:{fields:i,features:a,type:r},isDataset:!1,isPublic:!1,type:d.b};t.AttributeTable=s}}return e}_getUpdatedRFxArg(e,t,i){if(!e||!(0,d.a)(e))return e;let a=(0,n.p)(e);const r=i?.rasterFunctionArguments,s=(0,n.b)(t,r);if((0,d.i)(s)||(s.key=t),!0===s?.isPseudoArg&&this.pseudoArgs.add(t),a)return e.type===d.b?(e.value=this._getUpdatedRFTWithValues(a),e):this._getUpdatedRFTWithValues(a);if((0,n.v)(e)){const t=e.value?.elements?e.value.elements:e.value;return t.forEach(((e,i)=>{e&&((0,d.c)(e)||(a=(0,n.p)(e),a?t[i]=this._getUpdatedRFTWithValues(a):e.type===d.b?e.value=this.getArgumentValue(e,s):t[i]=this.getArgumentValue(e,s)))}),this),e}return s&&s.dataType===this.argDataTypes.rfxtemplate?e=this.getArgumentValue(e,s)??e:e.type===d.b?(e.value=this.getArgumentValue(e,s),e):(0,d.g)(e)||(0,d.j)(e)?e:void 0}onArgumentValueChange(e,t){const{rfxArg:i,argSchema:a,rfxArgs:r}=e,s=i&&i.input,n=r.Rasters?.value?.elements;if((0,d.i)(n))r.Raster?.input?.value?.type&&"Scalar"===r.Raster2?.input?.value?.type&&(r.Raster2.input.value=void 0);else{const e=e=>"Scalar"===e?.value?.type;n.every(e)&&(n[0].value=void 0)}s?.tagName===h.A.RFX_DTEX_COMMON_SELECT&&a&&a.dataType===this.argDataTypes.long&&(t=parseInt(t,10)),s?.tagName===h.A.RFX_DTE_JSON_FILE_UPLOADER&&this.handleFileInputChange(i,r,t),s?.tagName===h.A.RFX_DTE_RFT_BROWSER&&this.handleRFxTemplateInputChange(a,r,t),this._handleEditorStateTriggers(r,t,a),this._handleEditorValueTriggers(r,t,a)}handleFileInputChange(e,t,i){if((0,d.i)(i))return;let a;try{a=JSON.parse(i)}catch(e){console.error(e)}(0,d.i)(a)||("ClassifyFunctionArguments"===t.type&&"ClassifierDefinitionFile"===e.name&&(t.ClassifierDefinition=a),"PredictUsingRegressionFunctionArguments"===t.type&&"RegressionDefinitionFile"===e.name&&(t.RegressionDefinition=a))}handleRFxTemplateInputChange(e,t,i){const{key:a}=e;(0,d.i)(i)||(0,d.i)(a)||"RasterFunctionTemplate"===i?.type&&(t[a]=i)}handleBrowseLayerClick(e){const{isFeatureSelectElement:t,filter:i,allowedGeometries:a,layerFilterType:r}=e;e.isFeatureSelectElement=!0===t,e.filter=(0,d.i)(i)?e.isFeatureSelectElement?'(type:"Feature Service")':'(type:"Image Service")':i,e.allowedGeometries=(0,d.i)(a)?e.isFeatureSelectElement?["point","polygon","polyline","multipoint"]:void 0:a,e.layerFilterType=(0,d.i)(r)?e.isFeatureSelectElement?"feature":"imagery":r,this.rfxBrowseClick.emit(e)}createUnsupportedWidget(e){this.isTemplateValid=!1,this.templateErrors.add(this.strings.uiIncomplete);const t=document.createElement("div");t.className=E.unsupportedComponentContainer;const i=document.createElement("calcite-input-text");i.dir=this.direction,i.scale=o.U.Scale,i.placeholder=this.strings.unsupportedDataType;const a=document.createElement("calcite-input-message");return a.innerHTML=this.strings.currentlyUnsupported.replace("${missingType}",e),a.icon="exclamationMarkTriangle",a.status=h.U.INVALID,a.className=E.unsupportedComponentMessage,t.appendChild(i),t.appendChild(a),t}createUnsupportedWarningComponent(e){const t=document.createElement("calcite-notice");t.open=!0,t.closable=!0,t.kind="warning",t.scale=o.U.Scale;const i=document.createElement("div");i.slot="title",i.innerHTML=this.strings.overrideWidgetMissing,t.appendChild(i);const a=document.createElement("div");a.slot="message",e=Array.from(new Set(e));const r=`${this.strings.unsupportedOverrideWarning} ${e.join(", ")}`;return a.innerHTML=r,t.appendChild(a),t}createDeprecatedFunctionWarningComponent(){const e=(0,p.a)("calcite-notice","",{kind:"warning",open:!0,scale:o.U.Scale,closable:!0}),t=this.portal?.isPortal,i=this.portal?.sourceJSON?.helpBase||n.a.learnMoreDocBaseURL,a=(0,l.f)(i,this.locale);let r;if(!0===t){const e=n.a.learnMoreDocDeprecatedEnterpriseHelpID,{restUrl:t}=this.portal;r=`${a}${(0,c.a)(e)}`,r=(0,l.a)(r,t)}else r=(0,c.f)(a,n.a.learnMoreDocDeprecatedHelpID);const s=(0,d.t)(this.strings.deprecatedBannerTextWithLink,{docLink:r}),h=(0,p.a)("div",s,{slot:"message"});return e.appendChild(h),e}createUnsupportedFunctionWarningComponent(){const e=(0,p.a)("calcite-notice","",{kind:"warning",open:!0,scale:o.U.Scale,closable:!0}),t=this.portal?.isPortal,i=this.portal?.sourceJSON?.helpBase||n.a.learnMoreDocBaseURL,a=(0,l.f)(i,this.locale);let r;if(!0===t){const e=n.a.learnMoreDocDefaultEnterpriseHelpID,{restUrl:t}=this.portal;r=`${a}${(0,c.a)(e)}`,r=(0,l.a)(r,t)}else r=(0,c.f)(a,n.a.learnMoreDocDefaultHelpID);const s=(0,d.t)("This raster function template contains one or more unsupported raster function(s). <calcite-link target='_blank' href='${ docLink }'>Learn more</calcite-link> on what raster functions are supported.",{docLink:r}),h=(0,p.a)("div",s,{slot:"message"});return e.appendChild(h),e}render(){return(0,a.h)("div",{key:"1e62717ce5d9710170f32d48f6f5344c6605a914",class:{"esri-rfx-args-editor":this.mode===h.M.EDITOR}},(0,a.h)("div",{key:"6688e50b4f2b606bd333761dfb2001a2188900dd",id:"_argsContainterNode",ref:e=>{this.argsContainterNode=e}}))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}static get watchers(){return{rfxTemplate:["onRfxTemplateChange"]}}};k.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-args-editor__unsupported-component-message{--calcite-ui-text-1:red}.esri-rfx-args-editor{min-height:30vh}";const A=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.updateValue=e=>{let t=[];const{detail:{gridOptions:i}}=e;i.forEach(((e,a)=>{!1!==this.dataTypeAttributes.isExtensible&&a===i.length-1||Object.keys(this.gridSchema).forEach((i=>{t.push(e[i])}))})),this.dataType===s.d.stringArray&&(t=t.map((e=>null===e?"":e.toString()))),this.value=t,this.rfxArgumentChange.emit({value:this.value})}}onValueChange(){this.getGridOptions()}async checkValidity({required:e}){let t=!0;return e&&(t=await this.validateBandMatrixValues()),t}async componentWillLoad(){this.getGridSchema(),await this.processLayerArg(),this.getGridOptions()}async processLayerArg(){if((0,d.i)(this.nBandsArg))return;const e=this.nBandsArg?.input;await this.updateValuesBasedOnRaster(),e.addEventListener("rfxArgumentChange",(async()=>{await this.updateValuesBasedOnRaster()}))}async updateValuesBasedOnRaster(){const e=this.nBandsArg.input,t="function"==typeof e.getSelectedLayer?await e.getSelectedLayer():void 0;if((0,d.i)(t))return;const i=await t.generateRasterInfo(t.rasterFunction),a=i?.bandCount*Object.keys(this.gridSchema).length,r=this.value?.length??0,s=void 0!==this.dataTypeAttributes.defaultValue?this.dataTypeAttributes.defaultValue:0;let n;n=(0,d.i)(this.value)?new Array(a).fill(s):a>r?[...this.value,...new Array(a-r).fill(s)]:this.value.slice(0,a),this.value=[...n]}getGridOptions(){const e=this.dataTypeAttributes.cols,t=[];if(!(0,d.i)(this.value)){const i=[...this.value];for(;i.length>0;){const a={id:i.length/e};i.splice(0,e).forEach((function(e,t){a[`bandMatrix${t}`]=e})),t.push(a)}}!1!==this.dataTypeAttributes.isExtensible&&t.push({id:0}),this.gridOptions=t}getUIType(){return this.dataType===s.d.doubleArray?h.G.number:h.G.textInput}async validateBandMatrixValues(){let e=!0;return e=await this.gridElement.checkValidity(),e}getGridSchema(){this.gridSchema={},this.dataTypeAttributes?.displayNames.forEach(((e,t)=>{const i=`bandMatrix${t}`;this.gridSchema[i]={label:e,uiType:this.getUIType(),validationRule:this.dataTypeAttributes.columnRule}}))}render(){return(0,a.h)("rfx-grid",{key:"cc39863cb4d48c66d5e4cb6f743c11edd6c30dec",hasHeader:!0,canAdd:this.dataTypeAttributes.isExtensible,canRemove:this.dataTypeAttributes.hasIdColumn,hasIdColumn:this.dataTypeAttributes.hasIdColumn,gridLayout:this.gridSchema,gridOptions:this.gridOptions,hasBorder:!0,onRfxGridOptionChange:this.updateValue,ref:e=>this.gridElement=e})}static get watchers(){return{value:["onValueChange"]}}},w=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.value={x:0,y:0},this.onCellSizeChange=e=>{isNaN(e)||(this.value={x:e,y:e},this.rfxArgumentChange.emit({value:this.value}))},this.handleInputChange=e=>{if(e.stopPropagation(),null===e.target)return;const t=(e?.target).value,i=(0,f.p)(t);this.onCellSizeChange(i)}}componentWillLoad(){this.setInitialValues()}async checkValidity({required:e}){if(e&&(0,d.i)(this.value))return Promise.resolve(!1);const t=await(this.cellSizeInputElement?.checkValidity());return Promise.resolve(t)}setInitialValues(){const{x:e,y:t}=this.value,i=e??t??0;this.cellSizeInput=i}render(){return(0,a.h)("div",{key:"651b248ec408860b87244a24dfc7ed61f9e5431a"},(0,a.h)("rfx-dte-number-input",{key:"cdfac72cd7262b6666b6f815586faeba8241bc5d",value:this.cellSizeInput,onRfxNumberInputChange:this.handleInputChange,min:0,excludeMinValue:this.excludeMinValue??!0,ref:e=>this.cellSizeInputElement=e}))}get hostElement(){return(0,a.g)(this)}},S="rfx-dte-color-ramp-selector",T=`${S}__container-div`,I=`${S}__overflow-div`,L=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.createArcgisSymbolStyler=e=>{this.symbolStylerElement=e;const t=this.value?(0,u.c)(this.value):void 0;if(e.edit?.(new m.default,(0,u.a)({},{defaultColors:t})),void 0!==this.symbolStylerElement){document.body.appendChild(this.symbolStylerElement);const e=document.querySelector("arcgis-map-config-symbol-styler"),t=["shadowRoot","children[0]","children[0]","children[0]","children[0]","children[0]","children[0]","shadowRoot","children[0]","shadowRoot"];(0,g.n)(e,t,(e=>{const t=document.createElement("style");t.innerHTML="calcite-panel { max-height: 450px !important; }",e.appendChild(t)}));const i=["shadowRoot","children[0]","children[0]","shadowRoot","children[0]","children[0]","shadowRoot","children[0]","children[0]","children[1]"];(0,g.n)(e,i,(e=>{const t=document.createElement("style");t.innerHTML="div { overflow: hidden !important; }",e.appendChild(t)}))}},this.handleArcgisFillChange=({detail:e})=>{const t=(0,u.d)(e.color);this.value=t,this.rfxArgumentChange.emit({value:this.value})}}componentWillLoad(){(0,d.i)(this.value)&&(this.value=(0,u.f)(),this.rfxArgumentChange.emit({value:this.value}))}render(){return(0,a.h)("div",{key:"11a1f34ee19af298165b0448fd7c857f70cbe1b8",class:`${I}`},(0,a.h)("div",{key:"ac6ca2d3ad06a47fbf256670b289b5d450365d41",class:`${T}`},(0,a.h)("arcgis-map-config-symbol-styler",{key:"2e4bde99513b317be21ab3a82d343a3961b856bb",mode:"minimal",ref:this.createArcgisSymbolStyler,onArcgisFillChange:this.handleArcgisFillChange,stringOverrides:{fillColor:""},popoverProps:{refElement:this.symbolStylerElement,placement:"leading",offsetDistance:10}})))}get hostElement(){return(0,a.g)(this)}};L.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-color-ramp-selector__container-div{padding:0px;width:-webkit-fill-available;margin:-16px -10px}.rfx-dte-color-ramp-selector__overflow-div{overflow:hidden}";const R="rfx-dte-extent",V={base:`${R}`,extentTop:`${R}__top`,extentBottom:`${R}__bottom`,extentLeft:`${R}__left`,extentright:`${R}__right`},D=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.handleInputChange=e=>{if(e.stopPropagation(),(0,d.i)(e.target))return;const t={xmin:(0,f.p)(this.leftInput.value),ymin:(0,f.p)(this.bottomInput.value),xmax:(0,f.p)(this.rightInput.value),ymax:(0,f.p)(this.topInput.value)};this.value=t}}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)(".")))}render(){return(0,a.h)("div",{key:"9ee44722892cb7b42807930f94e9e4ff0a3cc41d",class:V.base},(0,a.h)("div",{key:"04685f82fffa6113450894f8d72401701418ce1a",class:V.extentTop},(0,a.h)("label",{key:"fd7ebbac495568b57d380753068ee717492bafdd"},this.strings.rasterExtentTop),(0,a.h)("calcite-input",{key:"b12e43acfc81f84a1a28a5f87da85eb135f077c1",numberButtonType:"none",type:"number",ref:e=>this.topInput=e,value:(0,f.s)((0,f.f)(this.value?.ymax,3)),scale:o.U.Scale,groupSeparator:!0,onCalciteInputChange:this.handleInputChange})),(0,a.h)("div",{key:"8dabf6a0f3d942495bbc62a479316f2fa905fcdb",class:V.extentright},(0,a.h)("label",{key:"190b3faa564df19aa11aeb4c839d2b132f2a158f"},this.strings.rasterExtentRight),(0,a.h)("calcite-input",{key:"093ba0b7435cfbebb507cc724316177493a9ac7f",numberButtonType:"none",type:"number",ref:e=>this.rightInput=e,value:(0,f.s)((0,f.f)(this.value?.xmax,3)),scale:o.U.Scale,groupSeparator:!0,onCalciteInputChange:this.handleInputChange})),(0,a.h)("div",{key:"7ec69f94890e0431350130c91efa7f76768bbaab",class:V.extentBottom},(0,a.h)("label",{key:"24b12ed3283d8dea781600923aaa057cc3fe6c1b"},this.strings.rasterExtentBottom),(0,a.h)("calcite-input",{key:"6868caf868b0ae3094e3e1e15bcf19f098c918f4",numberButtonType:"none",type:"number",ref:e=>this.bottomInput=e,value:(0,f.s)((0,f.f)(this.value?.ymin,3)),scale:o.U.Scale,groupSeparator:!0,onCalciteInputChange:this.handleInputChange})),(0,a.h)("div",{key:"21eb6fbc0462a5ff176781943dad5e1c086f0ab8",class:V.extentLeft},(0,a.h)("label",{key:"a29be639825ba7e2ba6661d7704c4223a03bde91"},this.strings.rasterExtentLeft),(0,a.h)("calcite-input",{key:"054b302a898ddff500bce4a0f9153dff56729f9a",numberButtonType:"none",type:"number",ref:e=>this.leftInput=e,value:(0,f.s)((0,f.f)(this.value?.xmin,3)),scale:o.U.Scale,groupSeparator:!0,onCalciteInputChange:this.handleInputChange})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};D.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-extent{width:100%;height:14em;display:block;position:relative}.rfx-dte-extent .rfx-dte-extent__bottom,.rfx-dte-extent .rfx-dte-extent__right,.rfx-dte-extent .rfx-dte-extent__left,.rfx-dte-extent .rfx-dte-extent__top{position:absolute;display:block;width:8em;text-align:center}.rfx-dte-extent__top{top:0;left:0;right:0;margin:auto}.rfx-dte-extent__left{top:45%;left:0;margin-top:-1em}.rfx-dte-extent__right{top:45%;right:0;margin-top:-1em}.rfx-dte-extent__bottom{bottom:0;left:0;right:0;margin:auto}";const _=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.loaded=!1,this.maxItems=5}async connectedCallback(){!1===this.loaded&&await this.load()}async componentWillLoad(){({strings:this.strings}=await(0,l.c)(this.hostElement,(0,a.a)(".")))}async getSelectedLayer(){return!1===this.loaded&&await this.load(),(0,d.i)(this.value)?Promise.resolve(void 0):this._getSelectedLayer(this.value.url)}async updateBrowsedLayer(e){return e.forEach((e=>{0===this.inputLayers.filter((t=>t.url===e.url||`${t.url}/${t.layerId}`===e.url)).length&&this.inputLayers.push(e),this.value={name:e.title,url:(0,b.d)(e)},this.rfxArgumentChange.emit({value:this.value})})),Promise.resolve(void 0)}async checkValidity({required:e}){let t=!0;return e&&(0,d.i)(this.value)&&(this.errorCode="required",t=!1),Promise.resolve(t)}async load(){(0,d.i)(this.value)||await this.processValueLayer(),this.loaded=!0}isLayerAddedToMap(e){return this.inputLayers.some((t=>t.url===e||`${t.url}/${t.layerId}`===e))}async processValueLayer(){const e=this.value?.url;if((0,d.i)(e))return;if(!this.isLayerAddedToMap(e)){const e=await(0,b.j)(this.value),t=`${e?.url}/${e?.layerId}`;void 0===e||this.isLayerAddedToMap(t)||(this.inputLayers=[...this.inputLayers,e])}const t=await this._getSelectedLayer(e),i=(0,b.d)(t);(0,d.i)(t)||(0,d.i)(i)||(this.value={name:t.title,url:i},this.rfxArgumentChange.emit({value:this.value}))}async _handleComboBoxChange(e){const t=e.target.value;if(this.errorCode=void 0,(0,d.i)(t))this.value=void 0;else{if("browse"===t)return this.value=void 0,void this.rfxBrowseLayerClick({referenceElement:this.hostElement,isFeatureSelectElement:!0});{const e=await this._getSelectedLayer(t);this.value={name:e.title,url:(0,b.d)(e)}}}this.rfxArgumentChange.emit({value:this.value})}async _getSelectedLayer(e){e=(0,b.b)(e);const t=this.inputLayers.find((t=>t.url===e||`${t.url}/${t.layerId}`===e));return await(t?.load()),t}render(){const e=(0,d.i)(this.value)?this.value:(0,b.b)(this.value?.url);let t=[];return this.inputLayers&&Array.isArray(this.inputLayers)&&(t=this.inputLayers.map(((t,i)=>{if(!(0,d.i)(t?.url)){const r=`${t.url}/${t.layerId}`;return(0,a.h)("calcite-combobox-item",{key:`feature-layer-item-${i}`,value:r,textLabel:t.title,selected:r.indexOf(e)>-1,icon:"feature-layer",scale:o.U.Scale})}}))),(0,a.h)("div",{class:"esriRFxFeatureSelect"},(0,a.h)("calcite-combobox",{label:"rfx-dte-feature-select-combobox",placeholder:this.placeholderText??this.strings.selectFeature,selectionMode:"single",scale:o.U.Scale,value:e,onCalciteComboboxChange:e=>this._handleComboBoxChange(e),clearDisabled:!0,overlayPositioning:this.mode===h.M.EDITOR?o.a.fixed:o.a.absolute,maxItems:this.mode===h.M.EDITOR?this.maxItems:0},(0,a.h)(a.F,null,(0,a.h)("calcite-combobox-item",{class:"browse-layer",key:"layer-item-browse",value:"browse",textLabel:this.strings.browseLayer,scale:o.U.Scale,icon:"search",filterDisabled:!0}),...t)),(0,a.h)("calcite-input-message",{class:"layer-validation-msg",status:"invalid",scale:o.U.Scale,hidden:!0===(0,d.i)(this.errorCode),icon:"exclamationMarkTriangle"},this.strings.errorCodes[this.errorCode]))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};_.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.browse-layer{--calcite-color-text-1:var(--calcite-color-text-link);--calcite-color-text-3:var(--calcite-color-text-link)}.layer-validation-msg{margin-top:0.5rem}";const O="useInputFeatureGeometryHelpClickHandler",F=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.helpActionClickEventHandlers=new Map,this.handleGeometryFeatureChange=async()=>{const e=await(this.geometryFeatureArg?.getSelectedLayer?.());if((0,d.i)(e))return this.value=void 0,void this.rfxArgumentChange.emit({value:this.value});const t=(0,b.l)(e);this.featureLayerExtent=t;const i=await(0,b.n)(e);let a={};switch(e.geometryType){case"polygon":a={geometries:i?.map((e=>({rings:e.toJSON().rings}))),spatialReference:i?.[0]?.toJSON().spatialReference};break;case"point":a={geometries:i?.map((e=>{const t=e.toJSON();return{x:t.x,y:t.y}})),spatialReference:i?.[0]?.toJSON().spatialReference};break;default:a=t}this.inputFeatureGeometryExtent=a,this.value=this.useInputFeatureGeometryArgValue?a:t,this.rfxArgumentChange.emit({value:this.value})},this.handleUseInputFeatureGeometryCheckboxChange=e=>{const t=e.target;this.useInputFeatureGeometryArgValue=t.checked,this.value=this.useInputFeatureGeometryArgValue?this.inputFeatureGeometryExtent:this.featureLayerExtent,this.rfxArgumentChange.emit({value:this.value})},this.setUseInputFeatureGeometryArgValue=()=>{(0,d.i)(this.value)||!this.value.hasOwnProperty("geometries")&&!this.value.hasOwnProperty("rings")?this.useInputFeatureGeometryArgValue=!1:this.useInputFeatureGeometryArgValue=!0},this.getFeatureSelectPlaceholderText=()=>(0,d.i)(this.value)?void 0:"<Has-Geometry>"}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.setupInitialState()}componentDidLoad(){this.attachHelpClickEventHandlers()}attachHelpClickEventHandlers(){const e=this.otherOptions?.onHelpActionClick({heading:this.strings.useInputFeatureGeometryName,referenceElement:this.useInputFeatureGeometryArgElement,helpTextID:this.otherOptions?.helpTextIDs?.useinputfeaturegeometry});this.helpActionClickEventHandlers.set(O,e)}setupInitialState(){this.setUseInputFeatureGeometryArgValue()}render(){return(0,a.h)("div",{key:"50efb35c6bfe87e739f28577e5876381ee047b63"},(0,a.h)("rfx-dte-feature-select",{key:"155a703c6a0ce241a1029d5907526a6d04bde301",mode:this.mode,ref:e=>this.geometryFeatureArg=e,inputLayers:this.inputLayers,placeholderText:this.getFeatureSelectPlaceholderText(),onRfxArgumentChange:this.handleGeometryFeatureChange,rfxBrowseLayerClick:this.rfxBrowseLayerClick}),(0,a.h)("calcite-label",{key:"433b880addd6ea751457e9d5764b4ea814b03251",alignment:"start",scale:o.U.Scale,layout:"inline-space-between",ref:e=>this.useInputFeatureGeometryArgElement=e},(0,a.h)("calcite-checkbox",{key:"26429cd9bef2eed10fc7bfbb82a02b984deaf2f9",checked:this.useInputFeatureGeometryArgValue,onCalciteCheckboxChange:this.handleUseInputFeatureGeometryCheckboxChange}),(0,a.h)("rfx-label",{key:"f2a43114216be494485b3dbb82c18b2aa66b98b9",label:this.strings.useInputFeatureGeometryName,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(O)()})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};F.style="";const N="rfx-dte-json-file-uploader",U={button:`${N}__button`,inputFile:`${N}__input-file`,inputText:`${N}__input-text`,unsupportedTypeMessage:`${N}__unsupported-type-message`},P=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.fileInputAccept="",this.showError=!1,this.value="",this.fileExtSupported=[],this.initFileInputAcceptProp=()=>{this.fileExtSupported?.length>0&&(this.fileInputAccept="."+this.fileExtSupported.join(", ."))},this.isFileExtSupported=e=>this.fileExtSupported.some((function(t){return e.indexOf(`.${t.toLowerCase()}`)>0})),this.onFileInputChange=e=>{if(null==e)return;const t=e.name;if(this.isFileExtSupported(t?.toLowerCase())){this.value=t;const i=new FileReader;i.readAsText(e),this.showError=!1,i.onload=()=>{const e=i.result;(0,d.i)(e)||this.rfxArgumentChange.emit({value:e})},i.onerror=()=>{console.error(i.error)}}else this.value="",this.showError=!0,this.rfxArgumentChange.emit({value:void 0})},this.handleFileInputChange=e=>{e.stopPropagation();const t=e.target;if(this.files=t?.files,(0,d.i)(this.files)||this.files?.length<1)return;const i=this.files[0];this.onFileInputChange(i)},this.handleButtonClick=()=>{this.fileInputElement?.click()}}async componentWillLoad(){({strings:this.strings}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.initFileInputAcceptProp()}render(){const e=this.showError?h.U.INVALID:h.U.IDLE,t=this.showError?this.strings.unsupportedDataType:"";return(0,a.h)("div",{key:"0f490398854565ec3d967f857fc51b9b50b30b12"},(0,a.h)("calcite-input-text",{key:"e396641efabdaa9ba5fb70a2b189683f1f3fd660",alignment:"start",class:U.inputText,dir:this.direction,scale:o.U.Scale,status:"idle",value:this.value}),(0,a.h)("input",{key:"d522b9003418bc2bd972c222d7a1fe09fbda32ec",accept:this.fileInputAccept,class:U.inputFile,multiple:!1,onChange:this.handleFileInputChange,ref:e=>this.fileInputElement=e,type:"file",hidden:!0}),(0,a.h)("calcite-button",{key:"3f73181e43b3246b0635c19d48460acffd4026ba",appearance:"solid",class:U.button,kind:"neutral",scale:o.U.Scale,onClick:this.handleButtonClick},this.strings.browseDefinitionFile),(0,a.h)("calcite-input-message",{key:"206ccde6145210c8ae0a4df5a0471095c8730884",class:U.unsupportedTypeMessage,hidden:!this.showError,icon:"exclamationMarkTriangle",iconFlipRtl:"rtl"===this.direction,scale:o.U.Scale,status:e},t))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};P.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-json-file-uploader__button{margin:var(--rfx-quarter-spacing)}.rfx-dte-json-file-uploader__unsupported-type-message{--calcite-ui-text-1:red}";const B=class{constructor(e){(0,a.r)(this,e),this.rfxArgHelpClick=(0,a.c)(this,"rfxArgHelpClick"),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.rasterElements=[],this.rasterInputElements=[],this.onRasterChange=(e,t)=>{const i=this.rasterElements[t];i.value=e,void 0!==i&&(this.value.elements?.length>0?this.value.elements[t]=i:this.value[t]=i),this.rfxArgumentChange.emit({value:this.value})}}async checkValidity({required:e}){const t=[];if(e)for(const i of this.rasterInputElements)if(i){const a=await i.checkValidity({required:e});t.push(a)}return Promise.resolve(t.every((e=>!0===e)))}async componentWillLoad(){await this.updateRasterElementsValue()}async updateRasterElementsValue(){if(!(0,d.i)(this.rasterElements))for(const e of this.rasterElements){const t=e?.value;(0,d.i)(t?.url)||(e.value=await(0,b.w)(t,this.inputLayers))}}renderRasterInputs(){return this.rasterInputElements=[],this.schemaElementInfos.map(((e,t)=>{const i=this.rasterElements[t];if((0,d.i)(i))return;const r=0==t?"Raster":`InRaster${t+1}`;return(0,a.h)("calcite-label",{id:`calcite-label-${t}`,alignment:"start",scale:o.U.Scale,layout:"default"},(0,a.h)("rfx-label",{label:i.name,onRfxLabelHelpActionClick:async()=>{const e=await(0,c.c)(r,this.rfxArgs);this.rfxArgHelpClick.emit({referenceElement:this.hostElement.shadowRoot.getElementById(`calcite-label-${t}`),helpSrcdoc:e,heading:i.name})}}),(0,a.h)("rfx-dte-raster-input",{allowScalar:e.allowScalar,inputLayers:this.inputLayers,value:i&&i.type===d.b?i.value:i,rfxVariable:i,onRfxArgumentChange:e=>{const i=e.target.value;this.onRasterChange(i,t)},ref:e=>{this.rasterInputElements[t]=e},rfxBrowseLayerClick:this.rfxBrowseLayerClick,mode:this.mode,portal:d.s.portal}))}))}render(){return(0,a.h)("div",{key:"0227344ce9b42bef6aea8d77dd65f1f03290d6f0"},0!==this.schemaElementInfos.length&&this.renderRasterInputs())}get hostElement(){return(0,a.g)(this)}},H="chip-container",M="custom-input-label",G="input-element",W=class{constructor(e){(0,a.r)(this,e),this.rfxMultipleInputChange=(0,a.c)(this,"rfxMultipleInputChange"),this.scale=o.U.Scale,this.buildChip=e=>(0,a.h)("calcite-chip",{closable:!0,scale:o.U.Scale,value:e,key:e,label:(0,f.a)(e),onCalciteChipClose:this.handleChipClose},(0,f.a)(e)),this.handleNewChip=async()=>{const e=this.inputElement?.value;if(null!=e){if(await(this.inputElement?.checkValidity())){void 0!==this.inputElement&&(this.inputElement.value=void 0);const t=new Set([...this.value??[],e]);this.value=Array.from(t),this.rfxMultipleInputChange.emit(this.value)}}},this.handleChipClose=async e=>{const t=e?.target,i=Number.parseFloat(t?.value),a=t?.previousElementSibling,r=this.value.filter((e=>e!==i));this.value=r,this.rfxMultipleInputChange.emit(this.value),await(a?.setFocus())}}async componentWillLoad(){({strings:this.strings}=await(0,l.c)(this.hostElement,(0,a.a)(".")))}async checkValidity({required:e}){if(e&&0===this.value?.length)return Promise.resolve(!1);const t=await(this.inputElement?.checkValidity());return Promise.resolve(t)}render(){return(0,a.h)(a.H,{key:"0902509908bcae5bd62a271428c82e5fbfdaecd3"},(0,a.h)("div",{key:"9d30f3899111bc3d755f9bc33acdf0a660fa24f6",class:M},(0,a.h)("rfx-dte-number-input",{key:"3891853577b4ce59909f7552446f31d0d3dd6427",class:G,numberButtonType:"none",max:this.validationOptions?.max,min:this.validationOptions?.min,numberType:this.validationOptions?.numberType,required:this.required,placeholder:this.placeholderText??this.strings.defaultPlaceholder,ref:e=>this.inputElement=e,onRfxNumberInputValueChange:this.handleNewChip,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleNewChip()}}),(0,a.h)("calcite-button",{key:"bcd20a7906aa84536ae39cd39a930549fa2b8d84",scale:this.scale,slot:"action",onClick:this.handleNewChip,"icon-start":"plus"},this.strings.add)),(0,a.h)("div",{key:"6a0289f15a2139f922e60d6eb7d387bca5ebbae4",class:H},this.value?.map((e=>this.buildChip(e.toString())))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};W.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}:host{--calcite-color-border-input:var(--analysis-ui-border-input)}.chip-container{display:flex;flex-wrap:wrap;gap:0.25rem;padding:var(--rfx-quarter-spacing)}.custom-input-label{display:flex;justify-content:flex-start;align-items:flex-start}.input-element{width:85%}";const $=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.gridSchema={gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,canAdd:!0,hasIdColumn:!0,canRemove:!0,isStacked:!1},this.gridStore=[],this.updateGridValue=e=>{const{detail:{gridOptions:t}}=e;(0,d.i)(t)||(this.gridStore=t)}}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.setupInitialState()}componentWillRender(){this.initGrid(),this.setWidgetValue()}setupInitialState(){this.gridStore=this.createDataObjects()}createDataObjects(){const e=[];return void 0!==this.value?Object.keys(this.value).forEach(((t,i)=>{"type"!==t&&"_object_id"!==t&&e.push({id:i+1,Name:t,Value:this.value[t]})})):e.push({id:1,Name:"",Value:""}),e.length<1&&e.push({id:1,Name:"",Value:""}),e}initGrid(){const e={Name:{uiType:h.G.textInput,label:this.strings.name},Value:{uiType:h.G.textInput,label:this.strings.value}},t=this.gridStore;this.gridSchema={...this.gridSchema,gridLayout:e,gridOptions:t}}setWidgetValue(){const e={};this.gridStore.forEach((t=>{Boolean(t.Name)&&(e[t.Name]=t.Value)})),this.value={...e,type:"PropertySet"}}render(){return(0,a.h)("calcite-label",{key:"ecb4f401b60ccbbe318da090af4c199c4408cced",alignment:"start",scale:o.U.Scale,layout:"default"},(0,a.h)("rfx-grid",{key:"5e23dd8cfbea1b9482d6f1f7cd5761e91d7bf27f",hasHeader:this.gridSchema.hasHeader,canAdd:this.gridSchema.canAdd,hasIdColumn:this.gridSchema.hasIdColumn,gridLayout:this.gridSchema.gridLayout,gridOptions:this.gridSchema.gridOptions,hasBorder:this.gridSchema.hasBorder,canRemove:this.gridSchema.canRemove,isStacked:this.gridSchema.isStacked,onRfxGridOptionChange:this.updateGridValue}))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};$.style="";const q="rfx-dte-raster-array-editor",j=`${q}__value-list`,z=`${q}__list-text-size`,K=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.rasterElements=[],this.valueListOptions=[],this.layerListLoading=!1,this.onRasterChange=e=>{e.stopPropagation();const t=e.target.value;(0,d.i)(t)||(this.addToValueList(t),this.updateValue())},this.onArrayOrderChange=e=>{const{newIndex:t,oldIndex:i}=e.detail;if(void 0!==t&&void 0!==i){const e=[...this.valueListOptions],[a]=e.splice(i,1);e.splice(t,0,a),this.valueListOptions=e}},this.onArrayValueRemove=e=>{const t=e.target.parentElement.value;this.valueListOptions=this.valueListOptions?.filter((e=>e.id!==t)),this.updateValue()}}async checkValidity({required:e}){let t=!0;return e&&0===this.valueListOptions.length&&(t=await(this.rasterSelectElement?.checkValidity({required:e}))),t}async componentWillLoad(){({strings:this.strings}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.readRasterElements()}readRasterElements(){if(!this.value)return;if((0,d.i)(this.value.elements)&&!Array.isArray(this.value))return;const e=this.value.elements||this.value;this.rasterElements=e,e.forEach((async(e,t)=>{if("Scalar"===e?.type){const i={...e};e.type=h.J.RASTER_FUNCTION_VARIABLE,e.value=i,e.isDataset=!0,e.name=`inRaster${t+1}>`}const i=e?.type===h.J.RASTER_FUNCTION_VARIABLE?e.value:e,a=e.type;if(a===h.J.RASTER_FUNCTION_TEMPLATE)return this.valueListOptions.push(this.getRFTValueListData(e,t));if(i?.type===h.J.RASTER_FUNCTION_TEMPLATE)return this.valueListOptions.push(this.getRFTValueListData(i,t));if(a===h.J.RASTER_FUNCTION_VARIABLE||void 0!==e.url){const i=await this.getRFVValueListData(e,t);void 0!==i&&(this.valueListOptions=[...this.valueListOptions,i],this.updateValue())}}))}getRFTValueListData(e,t){if(!(0,d.i)(e))return{label:`<${e.function.name}.${this.strings.outputRaster}>`,id:t,value:e,isTemplate:!0,element:e}}async getRFVValueListData(e,t){let i,a=e?.value;if("Scalar"===e?.type){const i={...e};e.type=h.J.RASTER_FUNCTION_VARIABLE,e.value=i,e.isDataset=!0,e.name=`InRaster${t+1}`}if(!a)return{label:String(`<${e.type} ${e.name}>`),id:t,value:a,isTemplate:!1};if(a&&a.type&&"scalar"===a.type.toLowerCase())return{label:String(a.value),id:t,value:a,isTemplate:!1,element:e};{const e=(0,b.h)(a,this.inputLayers);if((0,d.i)(e)){this.layerListLoading=!0;const e=await(0,b.i)(a);return this.layerListLoading=!1,a=(0,b.f)(e),this.inputLayers.push(e),{label:a.name||a.value,id:t,value:a,isTemplate:!1}}if(i=this.inputLayers.find((t=>e===t.id)),i)return a=(0,b.f)(i),{label:i.name??a.name,id:t,value:a,isTemplate:!1}}}isNotValueListElement(e){return(0,d.i)(this.valueListOptions.find((t=>t.label===e.label)))}setObjectId(e){e.forEach((e=>{const t=this.rasterElements.find((t=>(t?.value?.name??t?.name)===(e?.value?.name??e?.name)));t&&void 0!==t._object_id&&(e._object_id=t._object_id)}))}updateValue(){const e=this.valueListOptions,t=[];(0,d.i)(e)?this.value={elements:t,type:"ArgumentArray"}:(e.forEach((e=>{const i=void 0!==e.element?this.rasterElements.find((t=>t===e.element||t.value===e.element)):void 0;if(e.isTemplate){const a=this.getRFT?this.getRFT(e.value):e.value;i.value?(i.value=a,t.push(i)):t.push(a)}else if(i)i.value=e.value,"Scalar"===i?.value?.type&&t.push(i);else{const i=`Raster${e.id}`;t.push({type:h.J.RASTER_FUNCTION_VARIABLE,isDataset:!0,name:(0,d.i)(this.rasterElements)?i:this.rasterElements[e.id]?.name??i,value:e.value})}})),this.rasterElements.forEach((function(e){(0,d.i)(e._object_ref_id)||t.push(e)})),this.setObjectId(t),this.value={elements:t,type:"ArgumentArray"},this.rfxArgumentChange.emit({value:this.value}))}adjustValueListItemIds(){this.valueListOptions.forEach(((e,t)=>{e.id=t+1}))}addToValueList(e){const t={id:this.valueListOptions.length+1,value:e,label:e.name||e.value,isTemplate:!1};this.isNotValueListElement(t)&&(this.valueListOptions=[...this.valueListOptions,t])}renderRasterArray(){return this.valueListOptions.map((e=>(0,a.h)("calcite-list-item",{key:`list-${e.id}`,label:e.label,value:e.id,disabled:e.isTemplate},(0,a.h)("calcite-action",{slot:"actions-end",text:"",appearance:"transparent",icon:"x",onClick:e=>{this.onArrayValueRemove(e)}}))))}render(){return(0,a.h)("div",{key:"fd71471dd21fe22858b09e8a42837c78481fa9d1"},(0,a.h)("rfx-dte-raster-input",{key:"ec4bfc047746e290b68cc0435a4a1c67a2ba5e47",mode:this.otherOptions?.mode,inputLayers:this.inputLayers,allowScalar:this.allowScalar,onRfxArgumentChange:this.onRasterChange,layerLoading:this.layerListLoading,rfxBrowseLayerClick:e=>{this.rfxBrowseLayerClick({referenceElement:e.referenceElement,selectionMode:"multi"})},portal:d.s.portal,ref:e=>this.rasterSelectElement=e}),this.valueListOptions.length>0&&(0,a.h)("calcite-list",{key:"3c0fcbfa0049692f7ec5cdbc704764af4b27a69a",class:`${j} ${z}`,label:"",dragEnabled:!0,onCalciteListOrderChange:this.onArrayOrderChange},this.renderRasterArray()))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};K.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-raster-array-editor__value-list{border:1px solid var(--rfx-ui-border-input);margin-top:var(--rfx-half-spacing)}.rfx-dte-raster-array-editor__list-text-size{--calcite-font-size--1:var(--calcite-font-size--2)}";const Y={columns:"rasterInfoColumns",rows:"rasterInfoRows",bandCount:"rasterInfoBandCount",pixelSizeX:"rasterInfoPixelSizeX",pixelSizeY:"rasterInfoPixelSizeY",pixelType:"rasterInfoPixelType"},J={top:"rasterExtentTop",bottom:"rasterExtentBottom",left:"rasterExtentLeft",right:"rasterExtentRight"},X={wkid:"spatialReferenceWkid",latestWkid:"spatialReferenceLatestWkid",wkt:"spatialReferenceWkt",vcsWkid:"spatialReferenceVcsWkid",latestVcsWkid:"spatialReferenceLatestVcsWkid"},Q={grid:"rfx-dte-raster-info__grid"},Z=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.categoryReference={rasterInfo:"rfxArgCat_RasterInfo",spatialReference:"rfxArgCat_SpatialReference",extent:"rfxArgCat_Extent",statistics:"rfxArgCat_Statistics"},this.uiElements={rasterInfoSectionLabel:void 0,spatialReferenceSectionLabel:void 0,extentSectionLabel:void 0,statisticsSectionLabel:void 0,rasterInfoSectionVisible:void 0,spatialReferenceSectionVisible:void 0,extentSectionVisible:void 0,statisticsSectionVisible:void 0},this.gridSchema={gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,canAdd:!1,hasIdColumn:!1,canRemove:!1,isStacked:!1},this.rasterDetails={rasterInfoProperties:void 0,rasterExtentProperties:void 0,rasterStatisticsProperties:void 0,rasterSpatialReferenceProperties:void 0},this.allowScalar=!0,this.onRasterChange=async()=>{const e=await this.layerArg.getSelectedLayer();(0,d.i)(e),await this.setRasterDetails(e)}}async connectedCallback(){const e=await(0,s.e)();this.categoryReferenceStore=e}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.setupInitialState()}setupInitialState(){this.uiElements.rasterInfoSectionLabel=this.categoryReferenceStore[this.categoryReference.rasterInfo]?.title,this.uiElements.rasterInfoSectionVisible=this.categoryReferenceStore[this.categoryReference.rasterInfo]?.visible,this.uiElements.spatialReferenceSectionLabel=this.categoryReferenceStore[this.categoryReference.spatialReference]?.title,this.uiElements.spatialReferenceSectionVisible=this.categoryReferenceStore[this.categoryReference.spatialReference]?.visible,this.uiElements.extentSectionLabel=this.categoryReferenceStore[this.categoryReference.extent]?.title,this.uiElements.extentSectionVisible=this.categoryReferenceStore[this.categoryReference.extent]?.visible,this.uiElements.statisticsSectionLabel=this.categoryReferenceStore[this.categoryReference.statistics]?.title,this.uiElements.statisticsSectionVisible=this.categoryReferenceStore[this.categoryReference.statistics]?.visible;if(Boolean(this.value)){const e=this.value,t={columns:(0,f.f)((e.extent.xmax-e.extent.xmin)/e.pixelSizeX,6),rows:(0,f.f)((e.extent.ymax-e.extent.ymin)/e.pixelSizeY,6),pixelSizeX:(0,f.f)(e.pixelSizeX,6),pixelSizeY:(0,f.f)(e.pixelSizeY,6),bandCount:e.bandCount,pixelType:e.pixelType},i={top:(0,f.f)(e.extent.ymax,6),bottom:(0,f.f)(e.extent.ymin,6),left:(0,f.f)(e.extent.xmin,6),right:(0,f.f)(e.extent.xmax,6)},a=e.statistics,r=e.extent.spatialReference;this.rasterDetails={rasterInfoProperties:t,rasterExtentProperties:i,rasterStatisticsProperties:a,rasterSpatialReferenceProperties:r}}}setWidgetValue(e,t){let i;try{i={extent:{xmin:t.extent.xmin,ymin:t.extent.ymin,xmax:t.extent.xmax,ymax:t.extent.ymax,spatialReference:{wkid:t.spatialReference.wkid,latestWkid:t.spatialReference.latestWkid,wkt:t.spatialReference.wkt}},blockWidth:t.blockWidth||256,blockHeight:t.blockHeight||256,bandCount:t.bandCount,pixelType:t.pixelType.toUpperCase(),pixelSizeX:t.pixelSize.x,pixelSizeY:t.pixelSize.y,format:t.format||"Image Service",compressionType:t.compressionType||"",compressionQuality:t.compressionQuality||0,statistics:t.statistics,type:"RasterInfo"}}catch(e){}this.value=i,this.rfxArgumentChange.emit({value:this.value})}async setRasterDetails(e){const t=await e.generateRasterInfo(e.rasterFunction);try{const e={columns:(0,f.f)((t.extent.xmax-t.extent.xmin)/t.pixelSize.x,6),rows:(0,f.f)((t.extent.ymax-t.extent.ymin)/t.pixelSize.y,6),pixelSizeX:(0,f.f)(t.pixelSize.x,6),pixelSizeY:(0,f.f)(t.pixelSize.y,6),bandCount:t.bandCount,pixelType:t.pixelType},i={top:(0,f.f)(t.extent.ymax,6),bottom:(0,f.f)(t.extent.ymin,6),left:(0,f.f)(t.extent.xmin,6),right:(0,f.f)(t.extent.xmax,6)},a=t.statistics,r=t.spatialReference?.toJSON();this.rasterDetails={rasterInfoProperties:e,rasterExtentProperties:i,rasterStatisticsProperties:a,rasterSpatialReferenceProperties:r}}catch(e){this.rasterDetails={rasterInfoProperties:void 0,rasterExtentProperties:void 0,rasterStatisticsProperties:void 0,rasterSpatialReferenceProperties:void 0}}this.setWidgetValue(e,t)}getRasterInfoGridSchema(e){return{gridLayout:{Property:{uiType:h.G.text,label:this.strings.rasterInfoProperty},Value:{uiType:h.G.text,label:this.strings.rasterInfoValue}},gridOptions:e?Object.keys(e).map(((t,i)=>({id:i+1,Property:this.strings[Y[t]],Value:e[t]}))):[{id:1,Property:"",Value:""}]}}getRasterExtentGridSchema(e){return{gridLayout:{Property:{uiType:h.G.text,label:this.strings.rasterInfoProperty},Value:{uiType:h.G.text,label:this.strings.rasterInfoValue}},gridOptions:e?Object.keys(e)?.map(((t,i)=>({id:i+1,Property:this.strings[J[t]],Value:e[t]}))):[{id:1,Property:"",Value:""}]}}getRasterSpatialReferenceGridSchema(e){const t={Property:{uiType:h.G.text,label:this.strings.rasterInfoProperty},Value:{uiType:h.G.text,label:this.strings.rasterInfoValue}};let i=e?Object.keys(e).map(((t,i)=>{const a=this.strings[X[t]],r=e?.[t];if(a)return{id:i+1,Property:a,Value:r}})).filter((e=>e&&e.Property&&e.Value)):[{id:1,Property:"",Value:""}];e?.wkt&&(i=[{id:1,Property:this.strings[X.wkt],Value:e.wkt}]);return{gridLayout:t,gridOptions:i}}getRasterStatisticsGridSchema(e){return{gridLayout:{BandName:{uiType:h.G.text,label:this.strings.bandName},Minimum:{uiType:h.G.text,label:this.strings.minimum},Maximum:{uiType:h.G.text,label:this.strings.maximum},Mean:{uiType:h.G.text,label:this.strings.mean},StdDeviation:{uiType:h.G.text,label:this.strings.stdDeviation}},gridOptions:e.map(((e,t)=>({id:t+1,BandName:`Band_${t+1}`,Minimum:(0,f.f)(e.min,3),Maximum:(0,f.f)(e.max,3),Mean:(0,f.f)(e.avg||e.mean,3),StdDeviation:(0,f.f)(e.stddev)})))}}renderRasterInfoGrid(e){const t=this.getRasterInfoGridSchema(e);return(0,a.h)("rfx-section",{label:this.uiElements.rasterInfoSectionLabel,open:this.uiElements.rasterInfoSectionVisible},(0,a.h)("calcite-label",null,(0,a.h)("rfx-grid",{hasHeader:this.gridSchema.hasHeader,canAdd:this.gridSchema.canAdd,hasIdColumn:this.gridSchema.hasIdColumn,gridLayout:t.gridLayout,gridOptions:t.gridOptions,hasBorder:this.gridSchema.hasBorder,onRfxGridOptionChange:()=>{},isStacked:this.gridSchema.isStacked,canRemove:this.gridSchema.canRemove})))}renderRasterExtentGrid(e){const t=this.getRasterExtentGridSchema(e);return(0,a.h)("rfx-section",{label:this.uiElements.extentSectionLabel,open:this.uiElements.extentSectionVisible},(0,a.h)("calcite-label",null,(0,a.h)("rfx-grid",{hasHeader:this.gridSchema.hasHeader,canAdd:this.gridSchema.canAdd,hasIdColumn:this.gridSchema.hasIdColumn,gridLayout:t.gridLayout,gridOptions:t.gridOptions,hasBorder:this.gridSchema.hasBorder,onRfxGridOptionChange:()=>{},isStacked:this.gridSchema.isStacked,canRemove:this.gridSchema.canRemove})))}renderRasterSpatialReferenceGrid(e){const t=this.getRasterSpatialReferenceGridSchema(e);return(0,a.h)("rfx-section",{label:this.uiElements.spatialReferenceSectionLabel,open:this.uiElements.spatialReferenceSectionVisible},(0,a.h)("calcite-label",null,(0,a.h)("rfx-grid",{class:Q.grid,hasHeader:this.gridSchema.hasHeader,canAdd:this.gridSchema.canAdd,hasIdColumn:this.gridSchema.hasIdColumn,gridLayout:t.gridLayout,gridOptions:t.gridOptions,hasBorder:this.gridSchema.hasBorder,onRfxGridOptionChange:()=>{},isStacked:this.gridSchema.isStacked,canRemove:this.gridSchema.canRemove})))}renderRasterStatisticsGrid(e){const t=e?.length>0,i=t?this.getRasterStatisticsGridSchema(e):void 0;return(0,a.h)("rfx-section",{label:this.uiElements.statisticsSectionLabel,open:this.uiElements.statisticsSectionVisible},t?(0,a.h)("calcite-label",null,(0,a.h)("rfx-grid",{class:Q.grid,hasHeader:this.gridSchema.hasHeader,canAdd:this.gridSchema.canAdd,hasIdColumn:this.gridSchema.hasIdColumn,gridLayout:i.gridLayout,gridOptions:i.gridOptions,hasBorder:this.gridSchema.hasBorder,onRfxGridOptionChange:()=>{},isStacked:this.gridSchema.isStacked,canRemove:this.gridSchema.canRemove})):(0,a.h)("h3",null,this.strings.rasterStatisticsNotCalculated))}render(){const e=Boolean(this.value);return(0,a.h)(a.F,{key:"08a556447335880b109dcbecdb1228641157c37c"},(0,a.h)("calcite-label",{key:"6a90d3e533a87b376f613c6a54824f94068453eb",alignment:"start",scale:o.U.Scale,layout:"default"},(0,a.h)("rfx-dte-raster-input",{key:"09b5e82f46964671098b23e49b075f0d47e8efd7",mode:this.otherOptions?.mode,ref:e=>this.layerArg=e,allowScalar:this.allowScalar,inputLayers:this.inputLayers,value:void 0,onRfxArgumentChange:e=>{e.stopPropagation(),this.onRasterChange()},portal:d.s.portal,rfxBrowseLayerClick:this.rfxBrowseLayerClick})),e?(0,a.h)(a.F,null,this.renderRasterInfoGrid(this.rasterDetails.rasterInfoProperties),this.renderRasterExtentGrid(this.rasterDetails.rasterExtentProperties),this.renderRasterSpatialReferenceGrid(this.rasterDetails.rasterSpatialReferenceProperties),this.renderRasterStatisticsGrid(this.rasterDetails.rasterStatisticsProperties)):null)}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};Z.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-raster-info__grid{overflow-x:auto}";const ee="rfx-dte-rft-browser",te={rftLoadFailed:`${ee}__rft-load-failed`,button:`${ee}__button`,inputText:`${ee}__input-text`},ie=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.rfxArgHelpClick=(0,a.c)(this,"rfxArgHelpClick"),this.helpActionClickEventHandlers=new Map,this.isLoading=!1,this.rftLoadFailed=!1,this.closeItemBrowser=()=>{void 0!==this.itemBrowserElement&&(this.itemBrowserElement.removeEventListener("rfxItemBrowserClose",this.closeItemBrowser),this.itemBrowserElement.remove(),this.itemBrowserElement=void 0)},this.handleBrowseTemplateClick=()=>{const{portal:e}=this;this.itemBrowserElement=(0,p.b)({modalStrings:{header:this.strings.browseRFT},portal:e,user:e.user,cardMessageOverrides:{preview:this.strings.previewDetails},filter:'(type: "Raster function template")',onClose:this.closeItemBrowser,onSelection:this.handleItemBrowserSelection}),document.body.appendChild(this.itemBrowserElement)},this.handleItemBrowserSelection=async e=>{if(null!==e.detail){const t=e.detail.id,i=await this.loadRFTPortalItem(t);if((0,d.i)(i))return;i.name=this.rfxVariable?.name??i.name,i.description=i.function?.description??i.description,this.argRFT=i,this.value=i,this.rfxArgumentChange.emit({value:this.value})}}}onRFxVariableChange(e){this.argRFT=(0,n.p)(e)}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.rfxVariable?.type===d.R&&(this.argRFT=(0,n.p)(this.rfxVariable))}async loadRFTPortalItem(e){let t;try{if(this.rftLoadFailed=!1,this.isLoading=!0,(0,d.i)(e))throw Error("Invalid portal item id.");if(t=await(0,v.g)(e,this.portal),(0,d.i)(t?.arguments)||(0,d.i)(t?.function))throw t=void 0,Error("Invalid RFT.")}catch(e){console.error("Unable to load selected RFT portal item."),this.rftLoadFailed=!0}finally{this.isLoading=!1}return t}getFormattedValueFromVariable(){if(!(0,d.i)(this.argRFT)){const e=this.argRFT.function?.name;return`<${e}.${this.strings.outputRaster}>`}return`<${this.strings.rfxVariable}: ${this.rfxVariable.name}>`}render(){return(0,a.h)("div",{key:"ca107538ea55293e49a10f79dc2d379b1b470e95"},(0,a.h)("calcite-input-text",{key:"53ca08571385732055fe58dce2c97aaf9bf1a4dd",alignment:"start",class:te.inputText,dir:this.direction,disabled:!0,scale:o.U.Scale,status:"idle",value:this.getFormattedValueFromVariable()}),(0,a.h)("calcite-input-message",{key:"ee4be806fea688692cf7d4574047f70e39e701ea",class:te.rftLoadFailed,status:"invalid",scale:o.U.Scale,hidden:!1===this.rftLoadFailed,icon:"exclamationMarkTriangle"},this.strings.readingFailed),(0,a.h)("calcite-button",{key:"d16bb4b3ddbadb06af165d58fcf8dd90b7d2fb87",appearance:"solid",class:te.button,kind:"neutral",loading:!0===this.isLoading,scale:o.U.Scale,onClick:this.handleBrowseTemplateClick},this.strings.browseRFT))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}static get watchers(){return{rfxVariable:["onRFxVariableChange"]}}};ie.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-rft-browser__rft-load-failed{margin:var(--rfx-quarter-spacing);color:var(--calcite-color-status-danger)}.rfx-dte-rft-browser__button{margin:var(--rfx-quarter-spacing)}";const ae="select-button",re=class{constructor(e){(0,a.r)(this,e),this.spatialReferenceInputChange=(0,a.c)(this,"spatialReferenceInputChange"),this.required=!1,this.createPopover=e=>{this.spatialReferencePopover&&(this.spatialReferencePopover.remove(),this.spatialReferencePopover=void 0),this.spatialReferencePopover=document.createElement("calcite-popover");const t={autoClose:!0,dir:this.dir,focusTrapDisabled:!1,heading:this.strings.browseCoordinateSystems,closable:!0,open:!0,referenceElement:e.target};Object.assign(this.spatialReferencePopover,t),this.spatialReferencePopover.addEventListener("calcitePopoverClose",this.handleSpatialReferenceClose);const i=document.createElement("rfx-spatial-reference-popover");i.hideCategories=this.hideCategories,i.value=this.value,i.addEventListener("spatialReferenceValueChange",this.handleSpatialReferenceChange),i.addEventListener("spatialReferencePopoverDismissed",this.handleSpatialReferenceClose),this.spatialReferencePopover.append(i),document.body.append(this.spatialReferencePopover),setTimeout((()=>requestAnimationFrame((()=>{this.spatialReferencePopover.open=!0,this.spatialReferencePopover?.setFocus()}))),1)},this.validate=()=>(this.required&&void 0===this.value?this.errorMessage=(0,d.t)(this.strings.isRequired,{label:"Spatial reference"}):this.errorMessage=void 0,void 0===this.errorMessage),this.handleSpatialReferenceChange=e=>{this.value={latestWkid:e.detail.latestWkid,wkid:e.detail.latestWkid},this.spatialReferenceInputChange.emit(this.value)},this.handleSpatialReferenceClose=()=>{this.spatialReferencePopover?.remove(),this.spatialReferencePopover=void 0,this.validate()}}onValueChange(){var e,t;void 0!==this.value&&((e=this.value).wkid??(e.wkid=this.value.latestWkid),(t=this.value).latestWkid??(t.latestWkid=this.value.wkid)),this.validate()}async componentWillLoad(){var e,t;({strings:this.strings,dir:this.dir}=await(0,l.c)(this.hostElement,(0,a.a)("."))),void 0!==this.value&&((e=this.value).wkid??(e.wkid=this.value.latestWkid),(t=this.value).latestWkid??(t.latestWkid=this.value.wkid))}disconnectedCallback(){this.spatialReferencePopover?.remove()}async checkValidity(){this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}render(){const e=(0,d.i)(this.value)?this.strings.browseCoordinateSystems:(0,u.j)(this.value?.latestWkid)??this.strings.browseCoordinateSystems;return(0,a.h)(a.H,{key:"04de0356a57151137949c1651c5672430fcb1b61"},(0,a.h)("calcite-button",{key:"bc60a97ed451ed7fe0f19b1517f926c627ef43ab",width:"full",appearance:"outline",kind:"neutral","icon-end":"chevron-down",alignment:"icon-end-space-between",onClick:this.createPopover,class:ae,scale:o.U.Scale},e),(0,a.h)("calcite-input-message",{key:"6d3406d5c2d625ccb0f46463dbef7d1e799ef6a2",status:"invalid",scale:o.U.Scale,hidden:void 0===this.errorMessage,icon:"exclamationMarkTriangle"},this.errorMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}static get watchers(){return{value:["onValueChange"]}}};re.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}:host{display:flex;flex-direction:column;width:var(--rfx-component-default-width)}.select-button{margin-bottom:var(--rfx-half-spacing)}";const se={base:"rfx-dte-statistics-grid"},ne=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.displayNames=["min","max","mean","stdDev"],this.ncolumns=4,this.updateValue=e=>{const t=[],{detail:{gridOptions:i}}=e;i.forEach(((e,a)=>{a!==i.length-1&&Object.keys(this.gridSchema).forEach((i=>{t.push(e[i])}))})),this.value=this.createComplexValue(t),this.rfxArgumentChange.emit({value:this.value})}}onValueChange(){this.getGridOptions()}async componentWillLoad(){({strings:this.strings}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.displayNames=this.displayNames.map((e=>this.strings[e])),this.getGridSchema(),await this.processLayerArg(),this.getGridOptions()}async processLayerArg(){if((0,d.i)(this.layerArg))return;const e=this.layerArg?.input;(0,d.i)(this.value)&&await this.updateValuesBasedOnRasterStats(),e?.addEventListener("rfxArgumentChange",(async()=>{await this.updateValuesBasedOnRasterStats()}))}async updateValuesBasedOnRasterStats(){const e=this.layerArg.input,t=e&&"function"==typeof e.getSelectedLayer?await e.getSelectedLayer():void 0;if((0,d.i)(t))return;const i=(await t.generateRasterInfo(t.rasterFunction)).statistics;this.value=i.map((e=>[e.min,e.max,e.avg.toFixed(3),e.stddev.toFixed(3)]))}getProcessedValue(){return(0,d.i)(this.value?.elements)||(this.value=this.value.elements.map((e=>[e.min,e.max,e.mean,e.standardDeviation]))),Array.isArray(this.value)?this.value.join(",").split(",").map(Number):this.value}getGridOptions(){const e=this.ncolumns,t=[];if(!(0,d.i)(this.value)){const i=this.getProcessedValue();for(;i.length>0;){const a={id:i.length/e};i.splice(0,e).forEach((function(e,t){a[`statistics${t}`]=e})),t.push(a)}}t.push({id:0}),this.gridOptions=t}createComplexValue(e){let t;return 0===e.length&&(this.value=[]),t=(0,d.i)(this.value?.elements)?[]:{elements:[]},t.elements?t.elements=e:t=e,t}getGridSchema(){this.gridSchema={},this.displayNames.forEach(((e,t)=>{const i=`statistics${t}`;this.gridSchema[i]={label:e,uiType:h.G.number}}))}render(){return(0,a.h)("rfx-grid",{key:"c7b3a20a21a0f2ea37a0178e77b68dfeacaa0acb",class:se.base,hasHeader:!0,canAdd:!0,canRemove:!0,hasIdColumn:!0,gridLayout:this.gridSchema,gridOptions:this.gridOptions,hasBorder:!0,onRfxGridOptionChange:this.updateValue})}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}static get watchers(){return{value:["onValueChange"]}}};ne.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-statistics-grid{overflow-x:auto}";const le={ALL:"ALL",INTERVAL_VALUE:"INTERVAL_VALUE",INTERVAL_RANGES:"INTERVAL_RANGES",INTERVAL_KEYWORD:"INTERVAL_KEYWORD"},oe={ALL:"ALL",INTERVAL_VALUE:"INTERVAL_VALUE",INTERVAL_RANGES:"INTERVAL_RANGES"},ce={ALL:"ALL",INTERVAL_KEYWORD:"INTERVAL_KEYWORD",INTERVAL_VALUE:"INTERVAL_VALUE",INTERVAL_RANGES:"INTERVAL_RANGES"},he={ALL:"aggDefTypeAll",INTERVAL_KEYWORD:"aggDefTypeIntervalKeyword",INTERVAL_VALUE:"aggDefTypeIntervalValue",INTERVAL_RANGES:"aggDefTypeIntervalRanges"},de="HOURLY",ue={HOURLY:"esriTimeIntervalKeywordHourly",DAILY:"esriTimeIntervalKeywordDaily",WEEKLY:"esriTimeIntervalKeywordWeekly",DEKADLY:"esriTimeIntervalKeywordDekadly",PENTADLY:"esriTimeIntervalKeywordPentadly",MONTHLY:"esriTimeIntervalKeywordMonthly",QUARTERLY:"esriTimeIntervalKeywordQuarterly",YEARLY:"esriTimeIntervalKeywordYearly",RECURRING_DAILY:"esriTimeIntervalKeywordRecurringDaily",RECURRING_WEEKLY:"esriTimeIntervalKeywordRecurringWeekly",RECURRING_MONTHLY:"esriTimeIntervalKeywordRecurringMonthly",RECURRING_QUARTERLY:"esriTimeIntervalKeywordRecurringQuarterly"},fe="HOURS",pe={HOURS:"esriTimeUnitsHours",DAYS:"esriTimeUnitsDays",WEEKS:"esriTimeUnitsWeeks",MONTHS:"esriTimeUnitsMonths",YEARS:"esriTimeUnitsYears"},me="rfx-dtex-aggregation-definition-editor",ge={grid:`${me}__grid`,minValueColumn:`${me}__minValue-column`,maxValueColumn:`${me}__maxValue-column`,textInputColumn:`${me}__textInput-column`},be="aggregationDefinitionTypeHelpClickHandler",ve="intervalRangesGridArgHelpClickHandler",xe="valueIntervalHelpClickHandler",ye="unitArgHelpClickHandler",Ce="esriTimeIntervalKeywordHelpClickHandler",Ee=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.uiElements={aggregationDefinitionLabel:void 0,aggregationDefinitionContainer:void 0,intervalRangesGridLabel:void 0,intervalRangesGridContainer:void 0,esriTimeIntervalKeywordContainer:void 0,valueIntervalLabel:void 0,valueIntervalContainer:void 0,dimensionUnitLabel:void 0,dimensionUnitContainer:void 0},this.helpActionClickEventHandlers=new Map,this.selectedDimension=void 0,this.multidimensionalData={multidimensionalInfo:void 0,multidimensionalInfoVariables:void 0},this.timeInfoData=void 0,this.gridLayoutState=void 0,this.dimensionUnitsOptions=[],this.esriTimeIntervalKeywordOptions=[],this.defaults={intervalValue:3,intervalKeyword:de,intervalUnits:fe},this.loaded=!1,this.useTextInputForIntervalRanges=!1,this.selectedLayer=void 0,this.filterArgValue=void 0,this.aggregationDefinitionOptions=[],this.gridSchema={gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,canAdd:!0,canRemove:!0,hasIdColumn:!1},this.handleLayerInputchange=async()=>{!1!==this.loaded&&(this.selectedDimension=void 0,this.value=void 0,this.gridLayoutState=void 0,await this.setLayerData())},this.onRasterdimensionSelectChange=({detail:{value:e}})=>{this.selectedDimension=e},this.onDimensionDefinitionChange=({detail:{value:e}})=>{this.value=void 0,this.gridLayoutState=void 0,this.aggregationDefinition=e},this.updateByRangeGridValue=e=>{const{detail:{gridOptions:t}}=e;if((0,d.i)(t))return;const i=t.reduce(((e,t)=>{const i=Object.keys(t),a=this.useTextInputForIntervalRanges?i.map((e=>t[e])):i.map((e=>t[e].value));if(a.shift(),a.length!==i.length-1)return e;const[r,s]=a;return e.minValues.push(r),e.maxValues.push(s),e}),{minValues:[],maxValues:[]}),a=t.reduce(((e,t)=>{const i=Object.keys(t),a=this.useTextInputForIntervalRanges?Object.values(t)?.slice(1)?.filter(Boolean):i.map((e=>t[e].value)).filter(Boolean);if(a.length!==i.length-1||(0,d.i)(a))return e;const[r,s]=a;return e.minValues.push(r),e.maxValues.push(s),e}),{minValues:[],maxValues:[]});this.gridLayoutState=i,this.value=a}}connectedCallback(){this.layerArg?.input?.addEventListener("rfxArgumentChange",this.handleLayerInputchange),this.filterArg?.input?.addEventListener("rfxArgumentChange",(({detail:{value:e}})=>{this.filterArgValue=e}))}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.uiElements.aggregationDefinitionLabel=this.strings.aggregationType,this.uiElements.intervalRangesGridLabel=this.strings.ranges,this.uiElements.valueIntervalLabel=this.strings.valueInterval,this.uiElements.dimensionUnitLabel=this.strings.dimensionUnit,await this.setInitialState()}componentWillRender(){this.setWidgetState(),this.setWidgetValue()}componentDidLoad(){this.attachHelpClickEventHandlers()}disconnectedCallback(){}async setLayerData(){const e=await(this.layerArg?.input?.getSelectedLayer());if((0,d.i)(e))return;if(this.selectedLayer=e,this.otherOptions?.isPRCFunction&&!this.otherOptions?.isCustomFunction&&e.loaded&&!1===e.sourceJSON?.hasMultidimensions)return void(this.useTextInputForIntervalRanges=!0);this.useTextInputForIntervalRanges=!1;const t=await(0,x.g)(e),i=(0,x.a)(e,t);this.multidimensionalData={multidimensionalInfo:(0,d.E)(t),multidimensionalInfoVariables:(0,d.E)(i)};const a=e.timeInfo?.toJSON(),r=e.timeInfo?.interval?.toJSON();this.timeInfoData={...a,interval:r}}async setInitialState(){this.value="string"==typeof this.value?JSON.parse(this.value):this.value,await this.setLayerData(),this.aggregationDefinitionOptions=Object.keys(le).map((e=>({key:e,label:this.strings[he[e]]}))),this.dimensionUnitsOptions=Object.keys(pe).map((e=>({key:e,label:this.strings[pe[e]]}))),this.esriTimeIntervalKeywordOptions=Object.keys(ue).map((e=>({key:e,label:this.strings[ue[e]]}))),this.gridLayoutState={minValues:this.value?.minValues?[...this.value.minValues,void 0]:void 0,maxValues:this.value?.maxValues?[...this.value.maxValues,void 0]:void 0},this.aggregationDefinition=this.value?.definitionType??this.aggregationDefinitionOptions?.[0]?.key,this.selectedDimension=this.value?.dimension,this.loaded=!0}setWidgetValue(){const e={definitionType:this.aggregationDefinition,dimension:this.selectedDimension};switch(e.definitionType){case le.INTERVAL_VALUE:e.intervalValue=this.value?.intervalValue||this.defaults.intervalValue,e.intervalUnits=this.value?.intervalUnits||this.defaults.intervalUnits;break;case le.INTERVAL_KEYWORD:e.intervalKeyword=this.value?.intervalKeyword||this.defaults.intervalKeyword;break;case le.INTERVAL_RANGES:e.minValues=this.value?.minValues,e.maxValues=this.value?.maxValues}this.value=(0,d.E)(e),this.rfxArgumentChange.emit({value:this.value})}attachHelpClickEventHandlers(){const e=this.otherOptions.onHelpActionClick({heading:this.uiElements.aggregationDefinitionLabel,referenceElement:this.uiElements.aggregationDefinitionContainer,helpTextID:this.otherOptions.helpTextIDs?.type});this.helpActionClickEventHandlers.set(be,e)}createIntervalRangesDataObject(e,t,i,a){const r=[];if(this.useTextInputForIntervalRanges){const e=a?.minValues,t=a?.maxValues,i=Math.max(e?.length??0,t?.length??0);for(let a=0;a<i;a++)r.push({id:a,MinValue:e[a],MaxValue:t[a]});return r.length<1&&r.push({id:0,MinValue:void 0,MaxValue:void 0}),r}try{let e,s=[],n=[];if(this.filterArgValue?.variables&&(e=this.filterArgValue?.variables),!t)throw new Error("Layer does not have MultidimensionalInfo variables");const l=a?.minValues||["UNUSED_PARAM"],o=a?.maxValues,c=(0,d.E)(t);l.forEach(((t,a)=>{const h=(0,x.b)(c,e,i,this.filterArgValue);s=(0,d.E)(h.startValueOptions),n=(0,d.E)(h.endValueOptions);const u=l?.[a],f=o?.[a];r.push((0,d.E)({id:a,MinValue:{options:s,value:u},MaxValue:{options:n,value:f}}))}))}catch(e){r.push({id:0,MinValue:{options:[],value:void 0},MaxValue:{options:[],value:void 0}})}return r}setWidgetState(){const e=this.useTextInputForIntervalRanges?h.G.textInput:h.G.select,t=this.useTextInputForIntervalRanges?ge.textInputColumn:ge.minValueColumn,i=this.useTextInputForIntervalRanges?ge.textInputColumn:ge.maxValueColumn,a={MinValue:{label:this.strings.minValue,uiType:e,style:t},MaxValue:{label:this.strings.maxValue,uiType:e,style:i}},r="StdTime"===this.selectedDimension,s=r||this.useTextInputForIntervalRanges?ce:oe;let n,l;switch(this.aggregationDefinitionOptions=Object.keys(s).map((e=>({key:e,label:this.strings[he[e]]}))),this.aggregationDefinition){case le.INTERVAL_RANGES:n=a,l=this.createIntervalRangesDataObject(this.multidimensionalData.multidimensionalInfo,this.multidimensionalData.multidimensionalInfoVariables,this.selectedDimension,this.gridLayoutState);break;case le.INTERVAL_KEYWORD:r||this.useTextInputForIntervalRanges||(this.aggregationDefinition=le.ALL);default:return}this.gridSchema={...this.gridSchema,gridLayout:n,gridOptions:l}}renderByRangesGrid(){return(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.intervalRangesGridContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.intervalRangesGridLabel,referenceElement:this.uiElements.intervalRangesGridContainer,helpTextID:this.otherOptions.helpTextIDs?.ranges});this.helpActionClickEventHandlers.set(ve,t)}},(0,a.h)("rfx-label",{label:this.uiElements.intervalRangesGridLabel,hideHelp:!0,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(ve)()}),(0,a.h)("rfx-grid",{class:ge.grid,hasHeader:this.gridSchema.hasHeader,canAdd:this.gridSchema.canAdd,hasIdColumn:this.gridSchema.hasIdColumn,gridLayout:this.gridSchema.gridLayout,gridOptions:this.gridSchema.gridOptions,hasBorder:this.gridSchema.hasBorder,canRemove:this.gridSchema.canRemove,onRfxGridOptionChange:this.updateByRangeGridValue}))}renderIntervalKeywordForm(){return(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.esriTimeIntervalKeywordContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.dimensionUnitLabel,referenceElement:this.uiElements.esriTimeIntervalKeywordContainer,helpTextID:this.otherOptions.helpTextIDs?.keywordinterval});this.helpActionClickEventHandlers.set(Ce,t)}},(0,a.h)("rfx-label",{label:this.uiElements.dimensionUnitLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(Ce)()}),(0,a.h)("rfx-dtex-common-select",{mode:this.otherOptions?.mode,options:this.esriTimeIntervalKeywordOptions,value:this.value?.intervalKeyword,onRfxArgumentChange:({detail:{value:e}})=>{this.value.intervalKeyword=e}}))}renderIntervalValueForm(){const e="StdTime"===this.selectedDimension,t="esriFieldTypeDate"===this.selectedLayer?.sourceJSON?.fields?.find((e=>e.name===this.selectedDimension))?.type,i=e||this.otherOptions?.isPRCFunction&&t;return(0,a.h)("div",null,(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.valueIntervalContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.valueIntervalLabel,referenceElement:this.uiElements.valueIntervalContainer,helpTextID:this.otherOptions.helpTextIDs?.valueinterval});this.helpActionClickEventHandlers.set(xe,t)}},(0,a.h)("rfx-label",{label:this.uiElements.valueIntervalLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(xe)()}),(0,a.h)("calcite-input-number",{value:String(this.value?.intervalValue),onCalciteInputNumberChange:e=>this.value.intervalValue=Number.parseInt(e.target.value,10),scale:o.U.Scale})),!0===i?(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.dimensionUnitContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.dimensionUnitLabel,referenceElement:this.uiElements.dimensionUnitContainer,helpTextID:this.otherOptions.helpTextIDs?.unit});this.helpActionClickEventHandlers.set(ye,t)}},(0,a.h)("rfx-label",{label:this.uiElements.dimensionUnitLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(ye)()}),(0,a.h)("rfx-dtex-common-select",{mode:this.otherOptions?.mode,options:this.dimensionUnitsOptions,value:this.value?.intervalUnits,onRfxArgumentChange:({detail:{value:e}})=>{this.value.intervalUnits=e}})):null)}renderAggregationDefinitionEditorLayout(e){switch(e){case le.INTERVAL_VALUE:return this.renderIntervalValueForm();case le.INTERVAL_RANGES:return this.renderByRangesGrid();case le.INTERVAL_KEYWORD:return this.renderIntervalKeywordForm();default:return null}}render(){const e=this.renderAggregationDefinitionEditorLayout(this.aggregationDefinition);return(0,a.h)("div",{key:"7ce4f5337fbafb7ec91d0fb02d7ceadd4d7a7b26"},(0,a.h)("rfx-dtex-raster-dimension-select",{key:"2c9ed844e8d9420d29e4fe8d54c4c2fde946fd9a",layerArg:this.layerArg,value:this.selectedDimension,onRfxArgumentChange:this.onRasterdimensionSelectChange,allowedVariables:this.filterArgValue?.variables,otherOptions:{isPRCFunction:this.otherOptions.isPRCFunction,isCustomFunction:this.otherOptions.isCustomFunction,mode:this.otherOptions.mode}}),(0,a.h)("calcite-label",{key:"66b5b6dee74ccd88d392ae3f5beac5b78e28425b",alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.aggregationDefinitionContainer=e}},(0,a.h)("rfx-label",{key:"a59d4061065126662a1f4afc3d1c5d77d3c56ba8",label:this.uiElements.aggregationDefinitionLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(be)()}),(0,a.h)("rfx-dtex-common-select",{key:"bc31ea146548005ce00c641d9d9ff4983f24394a",mode:this.otherOptions?.mode,options:this.aggregationDefinitionOptions,value:this.aggregationDefinition,onRfxArgumentChange:this.onDimensionDefinitionChange})),e)}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};Ee.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dtex-aggregation-definition-editor__grid table{width:100%;table-layout:fixed}.rfx-dtex-aggregation-definition-editor__grid table thead tr th:last-child{width:6%}.rfx-dtex-aggregation-definition-editor__grid table tbody tr td:last-child{width:6%}.rfx-dtex-aggregation-definition-editor__minValue-column{width:47%}.rfx-dtex-aggregation-definition-editor__maxValue-column{width:47%}.rfx-dtex-aggregation-definition-editor__textInput-column{width:auto}";const ke="rfx-dtex-arg-slider",Ae={container:`${ke}__container`,slider:`${ke}__slider`,input:`${ke}__input`},we=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.min=0,this.max=100,this.value=0,this.step=1,this._handleSliderChange=e=>{const t=e.target;this.value=t.value,this.rfxArgumentChange.emit({value:this.value})},this.handleInputChange=e=>{if(e.stopPropagation(),null!==e.target){const t=(e?.target).value,i=(0,f.p)(t);if(i>this.max||i<this.min)return;this.value=i,this.rfxArgumentChange.emit({value:this.value})}}}render(){const e=(this.max-this.min)/10;return(0,a.h)("host",{key:"c3af51effb3bc4e8b235145993fd637d3a3fb120",class:Ae.container},(0,a.h)("calcite-slider",{key:"389d30bc1a8fd6df36de943d9b8fa481e6c79ca9",mirrored:"rtl"===this.direction,ref:e=>{e.classList.add(`${Ae.slider}`)},max:this.max,min:this.min,ticks:e,value:this.value,step:this.step,onCalciteSliderChange:this._handleSliderChange}),(0,a.h)("rfx-dte-number-input",{key:"2924147ea776fbea5fcdb6ee63f285e817d2a30c",ref:e=>{e.classList.add(`${Ae.input}`)},required:!0,numberButtonType:"none",value:this.value,min:this.min,max:this.max,onRfxNumberInputChange:this.handleInputChange}))}};we.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dtex-arg-slider__container{display:flex;justify-content:flex-start;-moz-column-gap:var(--rfx-quarter-spacing);column-gap:var(--rfx-quarter-spacing)}.rfx-dtex-arg-slider__slider{width:100%;width:-moz-available;width:-webkit-fill-available;}.rfx-dtex-arg-slider__input{width:40%}";const Se=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.options=[],this.bandIndexs=[],this.allowCustomValues=!1,this.getBandIndexs=e=>{const t=e.bandCount||0;return Array.from({length:t},((e,t)=>this.formatValue(t)))},this.parseFormatterValue=e=>Number(e)-1,this.formatValue=e=>`${e+1}`,this.handleBandIndexSelectChange=e=>{e.stopPropagation();const t=e.target;this.value=this.parseFormatterValue(t.value),this.rfxArgumentChange.emit({value:this.value})}}connectedCallback(){this.layerArg?.input?.addEventListener("rfxArgumentChange",this.setBandIndexOptions.bind(this))}componentWillLoad(){this.setBandIndexOptions()}render(){return(0,a.h)("div",{key:"633face6a2c9247119bac788eae7b524ba0bf344"},(0,a.h)("rfx-dtex-common-select",{key:"1adb593e71bfb0ca22b1c71137252d66bca060a5",mode:this.otherOptions?.mode,options:this.bandIndexs,value:this.formatValue(this.value),allowCustomValues:this.allowCustomValues,onRfxArgumentChange:this.handleBandIndexSelectChange}))}async setBandIndexOptions(){let e=[];try{const t=await(this.layerArg?.input?.getSelectedLayer());if(!t)throw new Error("No layer selected");const i=await t.generateRasterInfo(t.rasterFunction);if(void 0===i)throw new Error("Layer does not have rasterInfo");e=this.getBandIndexs(i),this.allowCustomValues=!1}catch(t){e=!0!==(0,d.i)(this.value)?[this.formatValue(this.value)]:["1"],this.allowCustomValues=!0}finally{this.bandIndexs=e.map((e=>({label:e,key:e})))}}},Te=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.options=[],this.bandNames=[],this.allowCustomValues=!1,this.getBandNames=e=>{const t=e?.keyProperties?.BandProperties,i=e.bandCount||0;return t&&t.length===i?t.map(((e,t)=>e.BandName||`Band_${t+1}`)):Array.from({length:i},((e,t)=>`Band_${t+1}`))},this.handleBandNameSelectChange=e=>{e.stopPropagation();const t=e.target;this.value=t.value,this.rfxArgumentChange.emit({value:this.value})}}connectedCallback(){this.layerArg?.input?.addEventListener("rfxArgumentChange",this.setBandNameOptions.bind(this))}componentWillLoad(){this.setBandNameOptions()}render(){return(0,a.h)("div",{key:"30d23f08e0cc83a062c5dc366d51acb232425818"},(0,a.h)("rfx-dtex-common-select",{key:"e9cd53e44b15580b9d7305c305852ba868bb3b49",mode:this.otherOptions?.mode,options:this.bandNames,value:this.value,allowCustomValues:this.allowCustomValues,onRfxArgumentChange:this.handleBandNameSelectChange}))}async setBandNameOptions(){let e=[];try{const t=await(this.layerArg?.input?.getSelectedLayer());if(!t)throw new Error("No layer selected");const i=await t.generateRasterInfo(t.rasterFunction);if(!i)throw new Error("Layer does not have rasterInfo");e=this.getBandNames(i),this.allowCustomValues=!1}catch(t){e=["Band_1"],this.allowCustomValues=!0}finally{this.bandNames=e.map((e=>({label:e,key:e})))}}},Ie="rfx-dtex-linear-unit",Le={containerDiv:`${Ie}__container-div`,unitDiv:`${Ie}__unit-div`,valueDiv:`${Ie}__value-div`},Re=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.unitOptions=[],this.handleUnitSelectChange=e=>{e.stopPropagation();const t=e.target;this.unitObject.unit=t.value,this.emitValueChangeEvent()},this.handleUnitValueChange=e=>{e.stopPropagation();const t=e.target;this.unitObject.value=t.value,this.emitValueChangeEvent()}}componentWillLoad(){if(void 0!==this.value){const[e,t]=this.value.split(" ");this.unitObject={unit:t,value:e}}else this.unitObject={unit:this.unitOptions[0].key.toString(),value:void 0}}async checkValidity(){return await this.unitValueElement.checkValidity()}emitValueChangeEvent(){this.value=this.unitObject.value+" "+this.unitObject.unit,this.rfxArgumentChange.emit({value:this.value})}render(){const e=this.unitObject?.value;return(0,a.h)("div",{key:"c0144c0c5918d6a53043c1d3bc1d5dd28bc51ede",class:Le.containerDiv},(0,a.h)("div",{key:"92e753113948c14e8fa983deb7c1111790adb05a",class:Le.valueDiv},(0,a.h)("rfx-dte-number-input",{key:"77f4328cdc55691aabd1b84f48d504da2f1e73a9",value:(0,d.i)(e)?void 0:Number.parseInt(e,10),onRfxNumberInputChange:this.handleUnitValueChange,min:0,ref:e=>{this.unitValueElement=e}})),(0,a.h)("div",{key:"7117fd3a5724d498df466ca30147d59bbd2f0b27",class:Le.unitDiv},(0,a.h)("rfx-dtex-common-select",{key:"6685b7e7c31257ec4ab10712d132e933a79bd016",mode:this.otherOptions?.mode,options:this.unitOptions,onRfxArgumentChange:this.handleUnitSelectChange,value:this.unitObject?.unit})))}};Re.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dtex-linear-unit__container-div{display:flex;justify-content:space-between}.rfx-dtex-linear-unit__unit-div{width:55%}.rfx-dtex-linear-unit__value-div{width:40%}";const Ve="ALL",De="BY_VALUES",_e="BY_RANGES",Oe="BY_ITERATION",Fe="BY_INTERVAL",Ne="BY_TARGET_RASTER",Ue=[De,Fe,Ne],Pe=[Ve,De,_e,Oe],Be={ALL:"mdimDefTypeAll",BY_VALUES:"mdimDefTypeByValues",BY_RANGES:"mdimDefTypeByRanges",BY_ITERATION:"mdimDefTypeByIteration",BY_INTERVAL:"mdimDefTypeByInterval",BY_TARGET_RASTER:"mdimDefTypeByTargetRaster"},He="HOURS",Me={HOURS:"esriTimeUnitsHours",DAYS:"esriTimeUnitsDays",WEEKS:"esriTimeUnitsWeeks",MONTHS:"esriTimeUnitsMonths",YEARS:"esriTimeUnitsYears"},Ge="rfx-dtex-multidimensional-definition-editor",We={grid:`${Ge}__grid`,dimensionColumn:`${Ge}__dimension-column`,valuesColumn:`${Ge}__values-column`,minValueColumn:`${Ge}__minValue-column`,maxValueColumn:`${Ge}__maxValue-column`},$e="dimensionDefinitionArgHelpClickHandler",qe="byValuesGridArgHelpClickHandler",je="byRangesGridArgHelpClickHandler",ze="dimensionArgHelpClickHandler",Ke="startOfArgHelpClickHandler",Ye="endOfArgHelpClickHandler",Je="stepArgHelpClickHandler",Xe="unitArgHelpClickHandler",Qe="targetRasterArgHelpClickHandler",Ze=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.loaded=!1,this.uiElements={dimensionDefinitionLabel:void 0,dimensionDefinitionContainer:void 0,byValuesGridLabel:void 0,byValuesGridContainer:void 0,byRangesGridLabel:void 0,byRangesGridContainer:void 0,dimensionLabel:void 0,dimensionContainer:void 0,startOfLabel:void 0,startOfContainer:void 0,endOfLabel:void 0,endOfContainer:void 0,stepLabel:void 0,stepContainer:void 0,dimensionUnitLabel:void 0,dimensionUnitContainer:void 0,byTargetRasterLabel:void 0,byTargetRasterContainer:void 0},this.helpActionClickEventHandlers=new Map,this.selectedVariables=void 0,this.multidimensionalData={multidimensionalInfo:void 0,multidimensionalInfoVariables:void 0},this.timeInfoData=void 0,this.gridLayoutState=void 0,this.dimensionUnitsOptions=[],this.defaults={stepValue:3,units:He},this.dimensionDefinitionOptions=[],this.gridSchema={gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,canAdd:!0,canRemove:!0,hasIdColumn:!1},this.hanldeLayerInputchange=async()=>{!1!==this.loaded&&(this.selectedVariables=[],this.value=void 0,this.gridLayoutState=void 0,await this.setLayerData())},this.onRasterVariablesListChange=e=>{e.stopPropagation();const{detail:{value:t}}=e;this.selectedVariables=t.filter(Boolean)},this.onDimensionDefinitionChange=e=>{e.stopPropagation();const{detail:{value:t}}=e;this.value=void 0,this.gridLayoutState=void 0,this.dimensionDefinition=t},this.updateByValueGridValue=e=>{const{detail:{gridOptions:t}}=e;if((0,d.i)(t))return;const i=t.reduce(((e,t)=>{const i=Object.keys(t),a=i.map((e=>t[e].value));if(a.shift(),a.length!==i.length-1)return e;const[r,s]=a;return e.dimensions.push(r),e.values.push(s),e}),{dimensions:[],values:[]}),a=t.reduce(((e,t)=>{const i=Object.keys(t).filter((e=>"uid"!==e)),a=i.map((e=>t[e].value)).filter(Boolean);if(a.length!==i.length-1)return e;const[r,s]=a;return e.dimensions.push(r),e.values.push(s),e}),{dimensions:[],values:[]});this.gridLayoutState=i,this.value=a},this.updateByRangeGridValue=e=>{const{detail:{gridOptions:t}}=e;if((0,d.i)(t))return;const i=t.reduce(((e,t)=>{const i=Object.keys(t),a=i.map((e=>t[e].value));if(a.shift(),a.length!==i.length-1)return e;const[r,s,n]=a;return e.dimensions.push(r),e.minValues.push(s),e.maxValues.push(n),e}),{dimensions:[],minValues:[],maxValues:[]}),a=t.reduce(((e,t)=>{const i=Object.keys(t),a=i.map((e=>t[e].value)).filter(Boolean);if(a.length!==i.length-1)return e;const[r,s,n]=a;return e.dimensions.push(r),e.minValues.push(s),e.maxValues.push(n),e}),{dimensions:[],minValues:[],maxValues:[]});this.gridLayoutState=i,this.value=a}}connectedCallback(){this.layerArg?.input?.addEventListener("rfxArgumentChange",this.hanldeLayerInputchange)}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)(".")));const e=this.isInterpolateByDimFunction;this.uiElements.dimensionDefinitionLabel=this.strings.dimensionDefinition,this.uiElements.byValuesGridLabel=this.strings.values,this.uiElements.byRangesGridLabel=this.strings.ranges,this.uiElements.dimensionLabel=this.strings.dimension,this.uiElements.startOfLabel=e?this.strings.intervalStart:this.strings.startOfFirstIteration,this.uiElements.endOfLabel=e?this.strings.intervalEnd:this.strings.endOfFirstIteration,this.uiElements.stepLabel=this.strings.step,this.uiElements.dimensionUnitLabel=this.strings.dimensionUnit,this.uiElements.byTargetRasterLabel=this.strings.targetRaster,(0,x.f)(this.strings),await this.setInitialState()}componentWillRender(){this.initGrid(),this.setWidgetValue()}componentDidLoad(){this.attachHelpClickEventHandlers()}disconnectedCallback(){}get isInterpolateByDimFunction(){return"interpolateByDim"===this.domainAttributes}async setLayerData(){const e=await(this.layerArg?.input?.getSelectedLayer());if((0,d.i)(e))return;const t=await(0,x.g)(e),i=(0,x.a)(e,t);this.multidimensionalData={multidimensionalInfo:(0,d.E)(t),multidimensionalInfoVariables:(0,d.E)(i)};const a=e.timeInfo?.toJSON(),r=e.timeInfo?.interval?.toJSON();this.timeInfoData={...a,interval:r}}async setInitialState(){this.value="string"==typeof this.value?JSON.parse(this.value):this.value,await this.setLayerData(),this.dimensionDefinitionOptions=(this.isInterpolateByDimFunction?Ue:Pe).map((e=>({key:e,label:this.strings[Be[e]]}))),this.dimensionUnitsOptions=Object.keys(Me).map((e=>({key:e,label:this.strings[Me[e]]}))),this.gridLayoutState={dimensions:this.value?.dimensions?[...this.value.dimensions,void 0]:void 0,values:this.value?.values?[...this.value.values,void 0]:void 0,minValues:this.value?.minValues?[...this.value.minValues,void 0]:void 0,maxValues:this.value?.maxValues?[...this.value.maxValues,void 0]:void 0},this.dimensionDefinition=this.value?.definitionType??this.dimensionDefinitionOptions?.[0]?.key,this.selectedVariables=this.value?.variables??[],this.loaded=!0}setWidgetValue(){const e={definitionType:this.dimensionDefinition,variables:this.selectedVariables};switch(e.definitionType){case De:e.dimensions=this.value?.dimensions,e.values=this.value?.values;break;case _e:e.dimensions=this.value?.dimensions,e.minValues=this.value?.minValues,e.maxValues=this.value?.maxValues;break;case Oe:case Fe:e.dimension=this.value?.dimension,e.startValue=this.value?.startValue,e.endValue=this.value?.endValue,e.stepValue=this.value?.stepValue||this.defaults.stepValue,e.units=this.value?.units||this.defaults.units;break;case Ne:e.target=this.value?.target}JSON.stringify(e)!==JSON.stringify(this.value)&&(this.value=(0,d.E)(e),this.rfxArgumentChange.emit({value:this.value}))}attachHelpClickEventHandlers(){const e=this.otherOptions.onHelpActionClick({heading:this.uiElements.dimensionDefinitionLabel,referenceElement:this.uiElements.dimensionDefinitionContainer,helpTextID:this.otherOptions.helpTextIDs?.dimensiondefinition});this.helpActionClickEventHandlers.set($e,e)}createByValuesDataObject(e,t,i,a){const r=[];try{let e=[],s=[];if(!t)throw new Error("Layer does not have MultidimensionalInfo variables");const n=(0,x.d)(t,i).map((e=>({key:e,label:e})));if(Boolean(a)&&a.dimensions?.length>0)e=a.dimensions,s=a.values;else{const t=n?.[0]?.key;e=[t]}e.forEach(((e,a)=>{let l=e;(0,x.i)(n,e)||(l=n[0]?.key);const o=(0,x.e)(t,i,l),c=(0,d.E)(n),h=s?.[a];r.push((0,d.E)({id:a,Dimension:{options:c,value:e},Value:{options:o,value:h}}))}))}catch(e){r.push({id:0,Dimension:{options:[],value:void 0},Value:{options:[],value:void 0}})}return r}createByRangesDataObject(e,t,i,a){const r=[];try{let e=[],s=[];if(!t)throw new Error("Layer does not have MultidimensionalInfo variables");const n=Boolean(a),l=(0,x.d)(t,i).map((e=>({key:e,label:e})));let o,c,h;if(n&&a.dimensions?.length>0)o=a.dimensions,c=a.minValues,h=a.maxValues;else{const e=l?.[0]?.key;o=[e]}o.forEach((function(a,n){let o=a;(0,x.i)(l,a)||(o=l[0].key);const u=(0,x.b)(t,i,o,void 0);e=(0,d.E)(u.startValueOptions),s=(0,d.E)(u.endValueOptions);const f=(0,d.E)(l),p=c?.[n],m=h?.[n];r.push((0,d.E)({id:n,Dimension:{options:f,value:a},MinValue:{options:e,value:p},MaxValue:{options:s,value:m}}))}),this)}catch(e){r.push({id:0,Dimension:{options:[],value:void 0},MinValue:{options:[],value:void 0},MaxValue:{options:[],value:void 0}})}return r}createByIterationDataObject(e,t,i,a,r){let s;try{if(!t)throw new Error("Layer does not have MultidimensionalInfo variables");const e=(0,x.d)(t,a).map((e=>({key:e,label:e}))),n=r?.startValue,l=r?.endValue,o=r?.dimension||e[0]?.key,c=r?.stepValue||i?.interval?.value,h=r?.units||i?.interval?.unit?.toUpperCase(),u=(0,x.b)(t,a,o,void 0),f=(0,d.E)(u.startValueOptions);s={dimensionOptions:e,selectedDimension:o,startValue:f,selectedStartOfFirstIteration:n,endValue:(0,d.E)(u.endValueOptions),selectedEndOfFirstIteration:l,stepValue:c,units:h}}catch(e){s={dimensionOptions:[],selectedDimension:void 0,startValue:[],selectedStartOfFirstIteration:void 0,endValue:[],selectedEndOfFirstIteration:void 0,stepValue:3,units:"HOURS"}}finally{this.value.dimension=s.selectedDimension}return s}initGrid(){const e=this.isInterpolateByDimFunction,t={Dimension:{label:this.strings.dimension,uiType:h.G.select,style:We.dimensionColumn},Value:{label:this.strings.value,uiType:h.G.select,allowCustomValues:e,style:We.valuesColumn}},i={Dimension:{label:this.strings.dimension,uiType:h.G.select,style:We.dimensionColumn},MinValue:{label:this.strings.minValue,uiType:h.G.select,style:We.minValueColumn},MaxValue:{label:this.strings.maxValue,uiType:h.G.select,style:We.maxValueColumn}};let a,r;switch(this.dimensionDefinition){case De:a=t,r=this.createByValuesDataObject(this.multidimensionalData?.multidimensionalInfo,this.multidimensionalData?.multidimensionalInfoVariables,this.selectedVariables,this.gridLayoutState);break;case _e:a=i,r=this.createByRangesDataObject(this.multidimensionalData?.multidimensionalInfo,this.multidimensionalData?.multidimensionalInfoVariables,this.selectedVariables,this.gridLayoutState)}this.gridSchema={...this.gridSchema,gridLayout:a,gridOptions:r}}renderByValuesGrid(){return(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.byValuesGridContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.byValuesGridLabel,referenceElement:this.uiElements.byValuesGridContainer,helpTextID:this.otherOptions.helpTextIDs?.values});this.helpActionClickEventHandlers.set(qe,t)}},(0,a.h)("rfx-label",{label:this.uiElements.byValuesGridLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(qe)()}),(0,a.h)("rfx-grid",{class:We.grid,hasHeader:this.gridSchema.hasHeader,canAdd:this.gridSchema.canAdd,hasIdColumn:this.gridSchema.hasIdColumn,gridLayout:this.gridSchema.gridLayout,gridOptions:this.gridSchema.gridOptions,hasBorder:this.gridSchema.hasBorder,canRemove:this.gridSchema.canRemove,onRfxGridOptionChange:this.updateByValueGridValue}))}renderByRangesGrid(){return(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.byRangesGridContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.byRangesGridLabel,referenceElement:this.uiElements.byRangesGridContainer,helpTextID:this.otherOptions.helpTextIDs?.ranges});this.helpActionClickEventHandlers.set(je,t)}},(0,a.h)("rfx-label",{label:this.uiElements.byRangesGridLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(je)()}),(0,a.h)("rfx-grid",{class:We.grid,hasHeader:this.gridSchema.hasHeader,canAdd:this.gridSchema.canAdd,hasIdColumn:this.gridSchema.hasIdColumn,gridLayout:this.gridSchema.gridLayout,gridOptions:this.gridSchema.gridOptions,hasBorder:this.gridSchema.hasBorder,canRemove:this.gridSchema.canRemove,onRfxGridOptionChange:this.updateByRangeGridValue}))}renderbyTargetRasterForm(){return(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.byTargetRasterContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.byTargetRasterLabel,referenceElement:this.uiElements.byTargetRasterContainer,helpTextID:this.otherOptions.helpTextIDs?.targetraster});this.helpActionClickEventHandlers.set(Qe,t)}},(0,a.h)("rfx-label",{label:this.uiElements.byTargetRasterLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(Qe)()}),(0,a.h)("rfx-dte-raster-input",{mode:this.otherOptions.mode,inputLayers:this.otherOptions.inputLayers,onRfxArgumentChange:e=>{e.stopPropagation();const t=e.target.value;(0,d.i)(t)||(this.value={...this.value,target:t.url})},portal:d.s.portal,rfxBrowseLayerClick:this.rfxBrowseLayerClick}))}renderByIterationForm(){const{dimensionOptions:e,selectedDimension:t,startValue:i,selectedStartOfFirstIteration:r,endValue:s,selectedEndOfFirstIteration:n,stepValue:l,units:c}=this.createByIterationDataObject(this.multidimensionalData?.multidimensionalInfo,this.multidimensionalData?.multidimensionalInfoVariables,this.timeInfoData,this.selectedVariables,this.value),h="StdTime"===t,d=this.isInterpolateByDimFunction;return(0,a.h)("div",null,(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.dimensionContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.dimensionLabel,referenceElement:this.uiElements.dimensionContainer,helpTextID:this.otherOptions.helpTextIDs?.dimension});this.helpActionClickEventHandlers.set(ze,t)}},(0,a.h)("rfx-label",{label:this.uiElements.dimensionLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(ze)()}),(0,a.h)("rfx-dtex-common-select",{options:e,value:t,onRfxArgumentChange:e=>{e.stopPropagation();const{detail:{value:t}}=e;this.value={...this.value,dimension:t}}})),(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.startOfContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.startOfLabel,referenceElement:this.uiElements.startOfContainer,helpTextID:this.otherOptions.helpTextIDs?.startof});this.helpActionClickEventHandlers.set(Ke,t)}},(0,a.h)("rfx-label",{label:this.uiElements.startOfLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(Ke)()}),(0,a.h)("rfx-dtex-common-select",{mode:this.otherOptions?.mode,options:i,value:r,onRfxArgumentChange:e=>{e.stopPropagation();const{detail:{value:t}}=e;this.value={...this.value,startValue:t}},allowCustomValues:d})),(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.endOfContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.endOfLabel,referenceElement:this.uiElements.endOfContainer,helpTextID:this.otherOptions.helpTextIDs?.endof});this.helpActionClickEventHandlers.set(Ye,t)}},(0,a.h)("rfx-label",{label:this.uiElements.endOfLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(Ye)()}),(0,a.h)("rfx-dtex-common-select",{mode:this.otherOptions?.mode,options:s,value:n,onRfxArgumentChange:e=>{e.stopPropagation();const{detail:{value:t}}=e;this.value={...this.value,endValue:t}},allowCustomValues:d})),(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.stepContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.stepLabel,referenceElement:this.uiElements.stepContainer,helpTextID:this.otherOptions.helpTextIDs?.step});this.helpActionClickEventHandlers.set(Je,t)}},(0,a.h)("rfx-label",{label:this.uiElements.stepLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(Je)()}),(0,a.h)("calcite-input-number",{value:String(l),onCalciteInputNumberChange:e=>{this.value={...this.value,stepValue:Number.parseInt(e.target.value,10)}},scale:o.U.Scale})),h?(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.dimensionUnitContainer=e;const t=this.otherOptions.onHelpActionClick({heading:this.uiElements.dimensionUnitLabel,referenceElement:this.uiElements.dimensionUnitContainer,helpTextID:this.otherOptions.helpTextIDs?.unit});this.helpActionClickEventHandlers.set(Xe,t)}},(0,a.h)("rfx-label",{label:this.uiElements.dimensionUnitLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(Xe)()}),(0,a.h)("rfx-dtex-common-select",{options:this.dimensionUnitsOptions,value:c,onRfxArgumentChange:e=>{e.stopPropagation();const{detail:{value:t}}=e;this.value={...this.value,units:t}}})):null)}renderDimensionDefinitionEditorLayout(e){switch(e){case De:return this.renderByValuesGrid();case _e:return this.renderByRangesGrid();case Oe:case Fe:return this.renderByIterationForm();case Ne:return this.renderbyTargetRasterForm();default:return null}}render(){const e=this.renderDimensionDefinitionEditorLayout(this.dimensionDefinition);return(0,a.h)("div",{key:"7f6d99c848299be443f533a5dbd1272a117dd21e"},(0,a.h)("rfx-dtex-raster-variables-list",{key:"a134f558d9ba5dcd130a8fa4791252492bc97000",layerArg:this.layerArg,value:this.selectedVariables,onRfxArgumentChange:this.onRasterVariablesListChange}),(0,a.h)("calcite-label",{key:"28316770006f09acd7b4cc2570afea30d9a16ac5",alignment:"start",scale:o.U.Scale,layout:"default",ref:e=>{this.uiElements.dimensionDefinitionContainer=e}},(0,a.h)("rfx-label",{key:"70d78c905d0a379161a2e57d100e58a22731b400",label:this.uiElements.dimensionDefinitionLabel,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get($e)()}),(0,a.h)("rfx-dtex-common-select",{key:"ca8a66d7cfe9979533919764ca5ecb29563d3050",options:this.dimensionDefinitionOptions,value:this.dimensionDefinition,onRfxArgumentChange:this.onDimensionDefinitionChange})),e)}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};Ze.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dtex-multidimensional-definition-editor__grid table{width:100%;table-layout:fixed}.rfx-dtex-multidimensional-definition-editor__grid table thead tr th:last-child{width:7%}.rfx-dtex-multidimensional-definition-editor__grid table tbody tr td{text-align:start}.rfx-dtex-multidimensional-definition-editor__grid table tbody tr td:last-child{width:7%;text-align:center}.rfx-dtex-multidimensional-definition-editor__dimension-column{width:30%}.rfx-dtex-multidimensional-definition-editor__values-column{width:63%}.rfx-dtex-multidimensional-definition-editor__minValue-column{width:30%}.rfx-dtex-multidimensional-definition-editor__maxValue-column{width:30%}";const et=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.allowedVariables=[],this.dimensionData=[],this.loaded=!1,this.handleRasterDimensionSelectChange=e=>{const t=e.target;this.value=t.value,this.rfxArgumentChange.emit({value:this.value})}}async setDimensionOptions(){try{const e=await(this.layerArg?.input?.getSelectedLayer());if(!e)throw new Error("No layer selected");if(this.otherOptions?.isPRCFunction&&!this.otherOptions?.isCustomFunction&&e.loaded&&!1===e.sourceJSON?.hasMultidimensions)return void this.populateFieldsForDimension(e);if(!e.sourceJSON?.hasMultidimensions)throw new Error("Layer does not have MultidimensionalInfo");const t=await(0,x.g)(e),i=(0,x.a)(e,t).filter((e=>!(this.allowedVariables?.length>0)||Boolean(this.allowedVariables.indexOf(e.name)>=0))).flatMap((e=>e.dimensions.map((e=>e.name)))),a=Array.from(new Set(i));this.dimensionData=a.map((e=>({label:e,key:e})))}catch(e){this.dimensionData=[]}finally{(0,d.i)(this.otherOptions?.defaultOptions)||(this.dimensionData=this.otherOptions.defaultOptions?.concat(this.dimensionData));if(this.dimensionData.some((e=>e.key===this.value))||(this.value=this.dimensionData?.[0]?.key),this.loaded=!0,this.rfxArgumentChange.emit({value:this.value}),!(0,d.i)(this.value))return}}connectedCallback(){this.layerArg?.input?.addEventListener("rfxArgumentChange",(()=>{this.setDimensionOptions()}))}async componentWillLoad(){!0!==this.loaded&&await this.setDimensionOptions()}render(){return(0,a.h)("div",{key:"de783a1c2d41371caa193cc5ebe74117779dfb61"},(0,a.h)("rfx-dtex-common-select",{key:"08da76c1d2d6330baacde5eb6f56ca1fb016ba49",mode:this.otherOptions?.mode,options:this.dimensionData,value:this.value,onRfxArgumentChange:this.handleRasterDimensionSelectChange}))}populateFieldsForDimension(e){(0,d.i)(e?.sourceJSON?.fields)||(this.dimensionData=this.getFieldOptions(e))}getFieldOptions(e){const t=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].concat(["esriFieldTypeDate"]),i=e?.sourceJSON?.fields?.filter((e=>t.indexOf(e?.type)>-1))?.map((e=>({key:e?.name,label:e?.name})))?.sort(((e,t)=>e.key<t.key?-1:e.key>t.key?1:0));return i}static get watchers(){return{layerArg:["setDimensionOptions"],allowedVariables:["setDimensionOptions"]}}},tt="multi-select-container",it="field-multi-select-btn-spaced",at="field-list-item",rt="arcgis-field-popover",st=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.variablesListData=[],this.fetchingRasterVariablesListData=!0,this.getRasterVariableListData=(e,t)=>{const i=(0,x.a)(e,t);if((0,d.i)(i))throw new Error("Layer does not have MultidimensionalInfo.Variables");return i.map((e=>{const t=e.dimensions.map((e=>`${e.name}=${e.values.length}`)).join(",");return{label:`${e.name} [${t}] (${e.description||""})`,value:e.name}}))},this.setupPopover=()=>{const e={isMultiSelect:!0,showSort:!0,showDescription:!1,heading:this.strings.selectVariables,filterPlaceholderText:this.strings.variables,showSelectionAll:!0};this.rasterVariablesPickListElement=document.createElement("arcgis-field-pick-list"),this.rasterVariablesPickListElement.className=rt,this.rasterVariablesPickListElement.showDescription=e.showDescription,this.rasterVariablesPickListElement.dir=this.direction,this.rasterVariablesPickListElement.showSort=e.showSort,this.rasterVariablesPickListElement.heading=e.heading,this.rasterVariablesPickListElement.filterPlaceholderText=e.filterPlaceholderText,this.rasterVariablesPickListElement.showFieldInfo=!1,this.rasterVariablesPickListElement.fields=this.variablesListData.map((e=>({alias:e.label,name:e.value,type:"string"}))),void 0!==this.value?this.rasterVariablesPickListElement.selectedFields=this.value:this.rasterVariablesPickListElement.selectedFields=[],this.rasterVariablesPickListElement.multiple=e.isMultiSelect,this.rasterVariablesPickListElement.showSelectionAll=e.showSelectionAll,this.rasterVariablesPickListElement.addEventListener("arcgisFieldPickListDismissed",this.arcgisFieldPickListDismissed),this.rasterVariablesPickListElement.popoverProps={refElement:this.rasterVariableSelectElement,popoverWidth:300}},this.arcgisFieldPickListDismissed=e=>{if(null!==e.detail){const t=e.detail.selectedFields;if(t.length<1)return;this.value=t,this.rfxArgumentChange.emit({value:this.value})}this.closeFieldPickList()},this.onListItemRemoved=e=>{const t=e.target,{value:i}=t;if(this.value instanceof Array){const e=this.value.filter((e=>e!==i));if(e.length<1)return;this.value=e}this.rfxArgumentChange.emit({value:this.value})},this.addPopover=()=>{if(void 0!==this.rasterVariablesPickListElement){document.body.appendChild(this.rasterVariablesPickListElement);const e=document.querySelector("arcgis-field-pick-list"),t=["shadowRoot"];(0,g.n)(e,t,(e=>{const t=document.createElement("style");t.innerHTML="calcite-popover { --calcite-popover-z-index: 700 !important; }",e.appendChild(t)}))}},this.closePopover=()=>{this.rasterVariablesPickListElement?.remove(),this.rasterVariablesPickListElement=void 0},this.openFieldPickList=()=>{this.closeFieldPickList(),this.setupPopover(),this.addPopover()},this.closeFieldPickList=()=>{void 0!==this.rasterVariablesPickListElement&&this.closePopover()},this.onSelectClick=()=>{this.openFieldPickList()}}async setRasterVariablesListData(){this.fetchingRasterVariablesListData=!0;try{const e=await(this.layerArg?.input?.getSelectedLayer());if(!e)throw new Error("No layer selected");if(!e.sourceJSON?.hasMultidimensions)throw new Error("Layer does not have MultidimensionalInfo");const t=await(0,x.g)(e);this.variablesListData=this.getRasterVariableListData(e,t)}catch(e){this.variablesListData=[]}finally{(!Array.isArray(this.value)||this.value.length<1)&&(this.value=[this.variablesListData?.[0]?.value]),this.fetchingRasterVariablesListData=!1,this.rfxArgumentChange.emit({value:this.value})}}connectedCallback(){this.layerArg?.input?.addEventListener("rfxArgumentChange",(()=>{this.variablesListData=[],this.value=[],this.setRasterVariablesListData()}))}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.setRasterVariablesListData()}disconnectedCallback(){this.rasterVariablesPickListElement?.remove()}render(){const e=this.value?.length>0?it:void 0;return(0,a.h)("div",{key:"8a0441f8486841ce20b8ce1c5614d00297665936",class:tt,ref:e=>{this.rasterVariableSelectElement=e}},(0,a.h)("calcite-list",{key:"c5a1867d9e8ba91811b146e2135b92acfba7fb08",selectionMode:"none",loading:this.fetchingRasterVariablesListData,label:"rfx-raster-variables-list"},void 0!==this.variablesListData&&this.variablesListData.length>0&&(0,a.h)("calcite-list",{key:"95e5787576b07b976535d5a4a35131c991ae9b35",label:"",class:"list-text-size"},this.variablesListData.filter((e=>this.value?.includes(e.value))).map((e=>(0,a.h)("calcite-list-item",{class:at,key:e.value,label:e.label,value:e.value,closable:this.value?.length>1,onCalciteListItemClose:this.onListItemRemoved}))))),(0,a.h)("calcite-button",{key:"08e582ac6d485b20eb47375f974bdcbdfe5e3efb",iconStart:"plus",appearance:"outline",kind:"neutral",width:"full",onClick:this.onSelectClick,class:e,id:"multi-select-field-btn",scale:o.U.Scale},this.strings.variables))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};st.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}:host{display:flex;width:100%}.field-multi-select-btn-spaced{margin-top:var(--rfx-half-spacing)}.field-list-item{min-height:48px}.multi-select-container{display:flex;flex-direction:column;gap:var(--rfx-quarter-spacing);width:100%;margin-bottom:var(--rfx-half-spacing)}.list-text-size{--calcite-font-size--1:var(--calcite-font-size--2)}";const nt="rfx-dtex-switchable",lt={switchOptionsDiv:`${nt}__switch-options`,switchControlsDiv:`${nt}__switch-controls`},ot=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.switchableOptions=[],this.defaultEnumValue="default",this.isLoading=!0,this.inputElements=[],this.onFieldOptionLoaded=()=>{!0===this.isLoading&&(this.currentType=this.getCurrentType())},this.handleSwitchSelectChange=e=>{e.stopPropagation();const t=e.target;this.currentType=(0,d.i)(t.value)?this.currentType:t.value,this.isLoading=!1},this.handleSwitchValueChange=e=>{e.stopPropagation();const t=e.target;this.value=t.value?.toString(),this.rfxArgumentChange.emit({value:this.value})}}async componentWillLoad(){({strings:this.strings}=await(0,l.c)(this.hostElement,(0,a.a)("."))),(0,d.i)(this.switchAttributes)||this.populateSwitchableOptions()}componentDidUpdate(){this.value=this.getCurrentValue()}async checkValidity(){let e=!0;for(const t of this.inputElements)if(t&&t.checkValidity){const i=await t.checkValidity();e=e&&i}return e}populateSwitchableOptions(){this.switchableOptions=this.switchAttributes.map((e=>{switch(e.type){case n.S.Number:return{key:n.S.Number,label:this.strings.number,icon:"number"};case n.S.Field:return{key:n.S.Field,label:this.strings.field,icon:"brackets-curly"};case n.S.List:return{key:n.S.List,label:this.strings.string,icon:"string"};case n.S.Unit:return{key:n.S.Unit,label:this.strings.value,icon:"measure"}}}))}getCurrentType(){const e=this.value;return void 0!==e&&this.switchFieldElement?.options?.filter((t=>t.key===e)).length>0?n.S.Field:this.switchableOptions.find((e=>e.key!==n.S.Field)).key}getCurrentValue(){switch(this.currentType){case n.S.Field:return this.switchFieldElement.value?.toString();case n.S.List:return this.switchListElement.value;case n.S.Number:return this.switchNumberElement.value?.toString();case n.S.Unit:return this.switchLinearUnitElement.value}}getCurrentAttribute(){return this.currentType=this.currentType??(void 0===this.value?this.switchAttributes[0].type:this.getTypeBasedOnValue()),this.switchAttributes.filter((e=>e.type===this.currentType))[0]}getTypeBasedOnValue(){const e=this.value;let t;return this.switchAttributes.some((i=>{switch(i.type){case n.S.List:if(i.enum?.filter((t=>t.key===e)).length>0)return t=n.S.List,!0;break;case n.S.Unit:if(i.enum?.filter((t=>e.includes(t.key.toString()))).length>0)return t=n.S.Unit,!0;break;case n.S.Number:if((0,d.d)(parseInt(e)))return t=n.S.Number,!0;break;default:t=n.S.Field}})),t}renderOptionChips(){return this.switchableOptions.map((e=>(0,a.h)("calcite-chip",{key:e.key,scale:o.U.Scale,appearance:"outline",kind:this.currentType===e.key?"brand":"neutral",value:e.key,onClick:this.handleSwitchSelectChange,closed:!1,closable:!1,label:e.label},e.label)))}getValueForNumberInput(e){if((0,d.i)(this.value))return;const t=Number.parseFloat(this.otherOptions?.defaultValue);return this.value=(0,f.s)(this.value,t),""!==this.value?"double"===e.dataType?Number.parseFloat(this.value):Number.parseInt(this.value,10):void 0}isLinearUnitValue(e){return void 0!==e&&2===e?.split(" ").length}render(){const e=this.getCurrentAttribute(),t=this.otherOptions?.defaultValue;return this.inputElements=[],(0,a.h)("div",{key:"0e736156beb3c5a0a414a52f4b343e04312ea2a4"},(0,a.h)("div",{key:"33715412894baac6e88a5c06c38325616238ff4c",class:lt.switchOptionsDiv},this.renderOptionChips()),(0,a.h)("div",{key:"f35d4530466eacf722a71f1efb534f3a884dd240",class:lt.switchControlsDiv},this.currentType===n.S.Number&&(0,a.h)("rfx-dte-number-input",{key:"e702c6a20ef4efed9b67488dbf856f1a83fdf7b7",value:this.getValueForNumberInput(e),onRfxNumberInputChange:this.handleSwitchValueChange,min:e.min,max:e.max,excludeMaxValue:e.excludeMaxValue,excludeMinValue:e.excludeMinValue,numberType:"double"===e.dataType?"float":"integer",ref:e=>{this.switchNumberElement=e,this.inputElements.push(e)}}),this.currentType===n.S.Field&&(0,a.h)("rfx-dtex-field-select",{key:"1e02394746ec2b58b6b7e9f0d39373d2cf260fee",mode:this.otherOptions?.mode,layerArg:e.layerArgument,fieldType:e.type,value:this.value,showDefaultFields:!1,ref:e=>{this.switchFieldElement=e,this.inputElements.push(e)},onRfxArgumentChange:this.handleSwitchValueChange,onRfxFieldOptionsLoaded:this.onFieldOptionLoaded}),this.currentType===n.S.List&&(0,a.h)("rfx-dtex-common-select",{key:"bd319117deb07e5105f20593b0dbf96a49664941",mode:this.otherOptions?.mode,options:e.enum||[{key:this.defaultEnumValue,label:""}],onRfxArgumentChange:this.handleSwitchValueChange,value:this.value??(e.enum[0].key.toString()||this.defaultEnumValue),ref:e=>{this.switchListElement=e,this.inputElements.push(e)}}),this.currentType===n.S.Unit&&(0,a.h)("rfx-dtex-linear-unit",{key:"e7f0bab5e2c06e6986ac270e97f72c121d697ee4",unitOptions:e.enum,value:this.isLinearUnitValue(this.value)?this.value:this.isLinearUnitValue(t)?t:void 0,ref:e=>{this.switchLinearUnitElement=e,this.inputElements.push(e)},onRfxArgumentChange:this.handleSwitchValueChange,otherOptions:{mode:this.otherOptions?.mode}})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};ot.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dtex-switchable__switch-options{display:flex;justify-content:flex-start;-moz-column-gap:var(--rfx-quarter-spacing);column-gap:var(--rfx-quarter-spacing)}.rfx-dtex-switchable__switch-controls{padding-top:var(--rfx-quarter-spacing);width:var(--rfx-component-default-width)}";const ct="help-iframe-s",ht="help-iframe-m",dt="learn-more",ut="heading",ft=class{constructor(e){(0,a.r)(this,e),this.rfxHelpPopoverClose=(0,a.c)(this,"rfxHelpPopoverClose"),this.rfxHelpPopoverSelectionChange=(0,a.c)(this,"rfxHelpPopoverSelectionChange"),this.placement="auto",this.offsetDistance=20,this.offsetSkidding=0}async portalChange(e){void 0!==e&&e.isPortal&&void 0===this.portalHelpMap&&(this.portalHelpMap=await(0,d.L)(e))}async componentWillLoad(){({strings:this.strings,dir:this.dir,locale:this.locale}=await(0,l.c)(this.hostElement,(0,a.a)(".")))}componentDidLoad(){try{setTimeout((()=>requestAnimationFrame((()=>this.popoverElement?.setFocus()))),1),setTimeout((()=>{this.popoverElement?.reposition?.()}),o.U.PopoverTimer)}catch(e){}}async reposition(){await(this.popoverElement?.reposition?.())}getContentStyleClass(e){let t=ct;return(-1!==e.indexOf("Category")||-1!==e.indexOf("Tool")||-1!==e.indexOf("toolDescription"))&&(t=ht),t}getLearnMoreUrl(){let e;return void 0!==this.learnMoreUrl&&(e=this.learnMoreUrl),e}renderIframeUsingSrcDoc(){return(0,a.h)("iframe",{class:this.getContentStyleClass(this.helpId),id:this.helpId,title:this.heading??this.helpId,srcdoc:this.helpSrcdoc})}render(){const e=void 0!==this.helpSrcdoc?this.renderIframeUsingSrcDoc():null,t=this.getLearnMoreUrl();return(0,a.h)(a.H,{key:"a9e551740bddb14e75ca2383d0604882f384a01d",dir:this.dir},(0,a.h)("calcite-popover",{key:"716d569ea9b0826493cdfa6969554c01c67ac934",overlayPositioning:"fixed",autoClose:!0,ref:e=>this.popoverElement=e,referenceElement:this.referenceElement??"analysis-tool",placement:this.placement,open:this.open,closable:!0,heading:this.heading??this.helpId,class:`${ut}`,headingLevel:4,triggerDisabled:!1,label:this.heading??this.helpId??"",offsetDistance:this.offsetDistance,offsetSkidding:this.offsetSkidding,onCalcitePopoverClose:()=>this.rfxHelpPopoverClose.emit()},e,void 0!==t&&(0,a.h)("calcite-link",{key:"ccef426160ab62e55d8ed2d17cd63ff0971836e2",rel:"help",target:"_blank",href:t,class:dt},this.strings.learnMoreLabel)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}static get watchers(){return{portal:["portalChange"]}}};ft.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}:host{display:flex;background-color:var(--calcite-color-foreground-1)}.help-iframe-s{padding:var(--rfx-quarter-spacing);height:var(--help-popover-content-height-s, 120);border:0px}.help-iframe-m{padding:var(--rfx-quarter-spacing);height:var(--help-popover-content-height-m, 140);border:0px}.learn-more{margin:var(--rfx-full-spacing)}.heading{max-width:23rem}";const pt="modal-variables",mt="alert",gt="error-message-ul",bt=class{constructor(e){(0,a.r)(this,e),this.rfxItemBrowserSelection=(0,a.c)(this,"rfxItemBrowserSelection"),this.rfxItemBrowserClose=(0,a.c)(this,"rfxItemBrowserClose"),this.webToolTaskMap={},this.layersFailedToLoad=[],this.items=[],this.selectedItems=[],this.browsedLayerCreating=!1,this.invalidBrowsedLayers=[],this.layerLoadingFailed=!1,this.tasksLoading=!1,this.displayMode="modal",this.filter="",this.hideFilters=!0,this.selectionMode="single-sublayer",this.bucketOptions=["my","favorites","group","org","all","living atlas"],this.showWebToolSelect=!1,this.getAllowedItemTypes=()=>["layers","layers-weblayers-features","layers-weblayers-imagery","layers-weblayers-tiledimagelayers","layers-weblayers-tables"],this.formatSublayerUrl=e=>`${`${"item"in e?e.item.url:e.url}`}/${`${"sublayer"in e?e.sublayer?.id??0:""}`}`,this.getItemDetailsUrl=e=>{let t="";if(!(0,d.i)(e)){const{id:i}=e;t=`${(0,d.H)(this.portal)}/home/item.html?id=${i}`}return t},this.close=()=>{void 0!==this.containerRef&&(this.containerRef.open=!1)},this.formatErrorMessageTitle=()=>{let e="";return!0===this.layerLoadingFailed&&(e=this.strings.layerLoadFailure),0!==this.invalidBrowsedLayers.length&&(e=this.strings.layerLoadFailure),e},this.formatErrorMessage=()=>{let e=null;return(!0===this.layerLoadingFailed||this.invalidBrowsedLayers.length>0)&&(e=(0,a.h)("ul",{class:gt},this.layersFailedToLoad.map((e=>(0,a.h)("li",null,e))),this.invalidBrowsedLayers.map((e=>(0,a.h)("li",null,e))))),e},this.onSelectButtonClick=async e=>{const t=this.rfxItemBrowserSelection;switch(this.layersFailedToLoad=[],this.selectionMode){case"single":t.emit(this.selectedItems[0]),this.close();break;case"multiple":default:t.emit(this.selectedItems),this.close();break;case"single-sublayer":case"multiple-sublayer":const i=e.target;i.loading=!0,this.browsedLayerCreating=!0;const a=[];try{await Promise.all(this.selectedItems.map((async e=>{const t="item"in e?e.item.title:e.title,i=await(0,b.v)({url:this.formatSublayerUrl(e),itemName:e.title});void 0===i?this.layersFailedToLoad.push(t):(0,b.p)(i,this.user?.orgId)?a.push(i):this.invalidBrowsedLayers.push(t)}))),this.layerLoadingFailed=0===a.length||this.layersFailedToLoad.length>0}catch{this.layerLoadingFailed=!0}this.browsedLayerCreating=!1,i.loading=!1,0===this.invalidBrowsedLayers.length&&!1===this.layerLoadingFailed&&(t.emit(a),this.close())}},this.onClose=()=>{this.rfxItemBrowserClose.emit()},this.onItemBrowserUpdate=e=>{this.items=e.detail.results,this.totalItems=e.detail.total},this.onItemBrowserSelect=e=>{this.selectedItems=e.detail},this.onItemBrowserLoading=()=>{this.items=[],this.totalItems=void 0},this.onItemBrowserPreview=async e=>{const t=e.detail;if(!0===this.showWebToolSelect){this.tasksLoading=!0;const e=await this.fetchTasks(t);this.webToolTaskMap[t.id]=e}this.currentPreviewItem=t,!0===this.tasksLoading&&(this.tasksLoading=!1)},this.fetchTasks=async e=>(await(0,d.r)(`${e.url}?f=json`,{responseType:"json",authMode:"no-prompt"})).data.tasks}async componentWillLoad(){({strings:this.strings}=await(0,l.c)(this.hostElement,(0,a.a)(".")))}renderModal(){return(0,a.h)("calcite-dialog",{modal:!0,open:!0,escapeDisabled:!0,outsideCloseDisabled:!0,heading:this.header??this.strings.header,class:pt,onCalciteDialogClose:this.onClose,ref:e=>this.containerRef=e},this.renderItemBrowser(),(0!==this.invalidBrowsedLayers.length||!0===this.layerLoadingFailed)&&(0,a.h)("calcite-alert",{open:!0,class:mt,slot:"alerts",kind:"danger",label:this.formatErrorMessageTitle(),onCalciteAlertClose:()=>{this.invalidBrowsedLayers=[],this.layersFailedToLoad=[],this.layerLoadingFailed=!1}},(0,a.h)("div",{slot:"title"},this.formatErrorMessageTitle()),(0,a.h)("div",{slot:"message"},this.formatErrorMessage())),(0,a.h)("calcite-button",{slot:"footer-start",appearance:"solid",kind:"neutral",onClick:this.onClose},this.strings.cancel),(0,a.h)("calcite-button",{slot:"footer-end",appearance:"solid",disabled:!0===this.browsedLayerCreating||0===this.selectedItems?.length,onClick:e=>{this.onSelectButtonClick(e)}},this.strings.confirm))}renderItemBrowser(){const e="single-sublayer"===this.selectionMode||"multiple-sublayer"===this.selectionMode||"none"===this.selectionMode?"top":"action";return(0,a.h)("arcgis-item-browser",{api:4,filter:this.filter,num:20,config:{baseUrl:`${(0,d.H)(this.portal)}/home/`},portal:this.portal,user:this.user,selection:this.selectionMode??"single",onArcgisItemBrowserLoading:this.onItemBrowserLoading,onArcgisItemBrowserUpdate:this.onItemBrowserUpdate,onArcgisItemBrowserSelect:this.onItemBrowserSelect,onArcgisItemBrowserPreview:this.onItemBrowserPreview},(0,a.h)("arcgis-item-browser-top-bar",{slot:"top-bar","filter-toggle":!0},(0,a.h)("arcgis-item-browser-bucket-select",{slot:"bucket",options:this.bucketOptions}),(0,a.h)("arcgis-item-browser-search",{slot:"search",term:""})),(0,a.h)("arcgis-item-browser-sort",{slot:"sort",field:"modified"}),!1===this.hideFilters&&(0,a.h)("arcgis-item-browser-filters",{slot:"filters"},(0,a.h)("arcgis-item-browser-filter-folder",null),(0,a.h)("arcgis-item-browser-filter-categories",null),(0,a.h)("arcgis-item-browser-filter-date",{property:"modified"}),(0,a.h)("arcgis-item-browser-filter-date",{property:"created"}),(0,a.h)("arcgis-item-browser-filter-item-type",{allowedItemTypes:this.getAllowedItemTypes()}),(0,a.h)("arcgis-item-browser-filter-tags",null),(0,a.h)("arcgis-item-browser-filter-sharing",null),(0,a.h)("arcgis-item-browser-filter-content-status",null),(0,a.h)("arcgis-item-browser-filter-collaborations",null)),(0,a.h)("arcgis-item-browser-content",{slot:"content"},this.items.map((t=>(0,a.h)("arcgis-item-browser-card",{key:t.id,item:t,portal:this.portal,preview:e,user:this.user,name:"item-browser",messageOverrides:this.cardMessageOverrides,showThumbnail:!1})))),(0,a.h)("div",{slot:"preview-footer"},(0,a.h)("calcite-button",{href:this.getItemDetailsUrl(this.currentPreviewItem),target:"_blank",appearance:"outline",kind:"neutral",width:"full"},this.strings.viewDetails)),(0,a.h)("arcgis-item-browser-pagination",{slot:"pagination",start:1,num:20,total:this.totalItems}))}filterUnsupportedLayers(e){return e.filter((e=>!(0,b.p)(e,this.user?.orgId))).map((e=>e.title))}render(){return this.renderModal()}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};bt.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}:host{--rfx-dialog-content-padding:0 !important}.modal-content{height:min(700px, 75vh)}.modal-alert{pointer-events:none;position:absolute;left:0px;bottom:0px;width:100%;display:block;z-index:50;transform:translate(0px, -0.5rem);height:calc(100% - 4rem)}.modal-variables{--calcite-dialog-size-y:min(900px, calc(80vh + 100px));--calcite-dialog-size-x:1080px;--calcite-dialog-content-space:0px}.alert{position:static}.error-message-ul{-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0}";const vt="tooltip",xt=class{constructor(e){(0,a.r)(this,e),this.showDuplicateAction=!0,this.showDeleteAction=!0,this.enableTextOnPropertiesAction=!1,this.showPropertiesAction=!0,this.showRenameAction=!0}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.setupInitialState()}setupInitialState(){!0===d.s.isViewerUserType&&(this.showDuplicateAction=!1,this.showDeleteAction=!1,this.enableTextOnPropertiesAction=!0)}render(){return(0,a.h)("calcite-action-pad",{key:"b11e4f8bc73b9d6346292ca8441ce91efd854c03","expand-disabled":!0,layout:"horizontal",scale:"s",dir:this.direction,overlayPositioning:"fixed"},this.showPropertiesAction&&(0,a.h)(a.F,{key:"de5ee9d414d95f5acf9f5147cafa3ed8dcf03f43"},(0,a.h)("calcite-action",{key:"8edb2a6b88a2ab48713010ca127590725b7b3d4a",id:"properties",scale:o.C.s,text:this.strings.properties,textEnabled:this.enableTextOnPropertiesAction,icon:"properties",onClick:this.handleNodeEditProperties}),!this.enableTextOnPropertiesAction&&(0,a.h)("calcite-tooltip",{key:"9e65194a254c165acbe0862b933794f209b05cd8",referenceElement:"properties",placement:"top",closeOnClick:!0,overlayPositioning:"fixed"},(0,a.h)("div",{key:"d7a2036624b6c65e6ce0669f7bdb1a9aedf7c3d6",class:vt},this.strings.properties))),this.showRenameAction&&(0,a.h)(a.F,{key:"f2533f5b383e98dd756ce0ab1b02e9ef44e4e122"},(0,a.h)("calcite-action",{key:"faef640c481a9a6c26b2b5b8ba140b29afd7250d",id:"rename",scale:o.C.s,text:this.strings.rename,icon:"pencil",onClick:this.handleNodeRename}),(0,a.h)("calcite-tooltip",{key:"f7a6059711538ae9ac530ef793b24eaae35a5105",referenceElement:"rename",placement:"top",closeOnClick:!0,overlayPositioning:"fixed"},(0,a.h)("div",{key:"253e3bb2d1e4c5fc4de834da783257a5deb31ee6",class:vt},this.strings.rename))),this.showDuplicateAction&&(0,a.h)(a.F,{key:"772d4b5ef8852bc7aa1c3cd75134b8ea5d56822e"},(0,a.h)("calcite-action",{key:"81dfa665adb2796448710e176170ce2ad65271c9",id:"duplicate",scale:o.C.s,text:this.strings.duplicate,icon:"duplicate",onClick:this.handleNodeDuplicate}),(0,a.h)("calcite-tooltip",{key:"fdfdaad238ed302b3a53baf96e1de2bec52f9ccc",referenceElement:"duplicate",placement:"top",closeOnClick:!0,overlayPositioning:"fixed"},(0,a.h)("div",{key:"eed4b521e714e2e364dd36cf5579f4b08f525520",class:vt},this.strings.duplicate))),this.showDeleteAction&&(0,a.h)(a.F,{key:"4751d7a614f67215f64e909173cc1ff704b42249"},(0,a.h)("calcite-action",{key:"ff1a60c982d75b7a04566a1e62e9eba79e3bd7cb",id:"delete",scale:o.C.s,text:this.strings.delete,icon:"trash",onClick:this.handleNodeDelete}),(0,a.h)("calcite-tooltip",{key:"82baca55dddf5aaf814724e8ff37f789d2630fd4",referenceElement:"delete",placement:"top",closeOnClick:!0,overlayPositioning:"fixed"},(0,a.h)("div",{key:"4177c50c2ca6518716cf72ed862c92275768dec2",class:vt},this.strings.delete))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};xt.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.tooltip{white-space:nowrap}";const yt="rfx-save-modal",Ct={host:`${yt}-host`,summary:`${yt}-summary`},Et=class{constructor(e){(0,a.r)(this,e),this.cancelClick=(0,a.c)(this,"cancelClick"),this.saveClick=(0,a.c)(this,"saveClick"),this.itemCreating=!1,this.onCancel=()=>{this.cancelClick.emit()},this.onSave=async()=>{await this.validate()&&(this.itemCreating=!0,this.saveClick.emit({itemProperties:this.itemProps}))}}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,l.c)(this.hostElement,(0,a.a)("."))),await this.initItemProps()}async initItemProps(){const{portalItem:e,portal:t}=this,i=this.itemProps?.title??e?.title,a=this.itemProps?.snippet??e?.snippet;if(void 0!==e){const r=await this.getUniqueItemTitle(i,e.ownerFolder,e.type),s=t.user.username===e.owner?t.user:(0,v.c)({username:e.owner,portal:t});this.itemProps={title:r,type:e.type??y.I.RASTER_FUNCTION_TEMPLATE},this.itemProps.ownerFolder=this.findFolder(e.ownerFolder,s),this.itemProps.categories=e.isOrgItem?e.categories:void 0,this.itemProps.tags=e.tags,this.itemProps.snippet=a}else{const e=`${i}.rft`;this.itemProps={title:i,type:y.I.RASTER_FUNCTION_TEMPLATE,snippet:a,fileName:e}}const r=(0,d.H)(t),s="/"===t.restUrl.substr(-t.restUrl.length)?t.restUrl:t.restUrl+"/";this.itemProps.baseUrl=r,this.itemProps.restBaseUrl=s}findFolder(e,t){if(!e)return null;const i=t.folders?.find((t=>t.id===e));if(null==i)return null;return{...i,created:i.created,username:t.username}}getUniqueItemTitle(e,t,i){const{user:a}=this.portal,r={query:"owner:"+a.username+" orgid:"+this.portal.id+" ownerfolder:"+(t||"root")+' type:"'+i+'" title:"'+e+'"',num:100};return this.portal.queryItems(r).then((t=>t&&t.total>0?`${e}_${t.total+1}`:e))}renderHeader(){return(0,a.h)("div",{slot:"header",id:"modal-title"},this.strings.createItem)}renderContent(){return(0,a.h)("div",{slot:"content",class:"modal-content"},this.renderItemProperties())}getType(){return this.portalItem?.type||"Raster Function Template"}onItemPropChange(e){const{prop:t,value:i}=e;this.itemProps[t]=i||""}async validate(){if(!await this.folderInput.saveActiveFolder())return!1;const e=await this.titleInput.validateTitle();return!e||(e.focusMainInput(),!1)}renderItemProperties(){const{itemProps:e,portal:t,portalItem:i}=this,r=this.getType(),{title:s,tags:n,categories:l,snippet:o,ownerFolder:c,baseUrl:h,restBaseUrl:d}=e||{},{user:u}=t;return(0,a.h)("arcgis-item-properties",{scale:"m",portal:t,config:{baseUrl:`${h}"/home"`,restBaseUrl:d},user:u,api:4,type:r||"Feature Service"},(0,a.h)("arcgis-title-input",{scale:"m","item-title":s,currentFolder:void 0!==i?.id?c:null,onArcgisTitleInputChange:e=>this.onItemPropChange({prop:"title",value:e.detail}),ref:e=>{this.titleInput=e}}),(0,a.h)("arcgis-folder-picker",{scale:"m",folder:void 0!==i?.id?c:null,ref:e=>this.folderInput=e,onArcgisFolderPickerChange:e=>this.onItemPropChange({prop:"ownerFolder",value:e.detail})}),(0,a.h)("arcgis-categories-picker",{scale:"m",categories:l,onArcgisCategoriesPickerChange:e=>this.onItemPropChange({prop:"categories",value:e.detail})}),(0,a.h)("arcgis-tags-picker",{scale:"m",activeTags:n,onArcgisTagsPickerChange:e=>this.onItemPropChange({prop:"tags",value:e.detail})}),(0,a.h)("arcgis-summary-input",{scale:"m",summary:o,class:Ct.summary,onArcgisSummaryInputChange:e=>this.onItemPropChange({prop:"snippet",value:e.detail})}))}render(){return(0,a.h)("rfx-modal",{key:"7437de258c5b69762a7988f8e782075d03659099",class:Ct.host,labels:{primary:this.strings.save},onRfxModalSecondaryClick:this.onCancel,onRfxModalPrimaryClick:this.onSave,onRfxModalClose:this.onCancel,modal:!0},this.renderHeader(),this.renderContent())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};Et.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-save-modal-host{--calcite-modal-width:var(--rfx-modal-width-small)}.rfx-save-modal-summary textarea{resize:vertical !important}";const kt="rfx--rtl",At=class{constructor(e){(0,a.r)(this,e),this.rfxlayerSelectBrowseLayerClick=(0,a.c)(this,"rfxlayerSelectBrowseLayerClick")}async getRasterValue(){return Promise.resolve(this.value)}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.setupInitialState()}setupInitialState(){}render(){return(0,a.h)(a.H,{key:"44235330488484b5884f43d659717784c11d8528",class:{[kt]:"rtl"===this.direction}},(0,a.h)("calcite-label",{key:"d332ce667a8a12cbf5630ade22dea3f7314b8f1c",alignment:"start",scale:o.U.Scale,layout:"default"},(0,a.h)("rfx-label",{key:"d976a95102f492962fda5233da62367850e95ba9",label:this.strings.selectRaster,hideHelp:!0}),(0,a.h)("rfx-dte-raster-input",{key:"7e0ffb10aadc1bdae0bf4bf5a1de003f7317eff0",inputLayers:this.inputLayers,value:this.value,onRfxArgumentChange:e=>{e.stopPropagation(),this.value=e.target.value},rfxBrowseLayerClick:e=>{this.rfxlayerSelectBrowseLayerClick.emit(e)},mode:h.M.EDITOR,portal:d.s.portal})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};At.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}:host{padding:0.5rem}";const wt=class{constructor(e){(0,a.r)(this,e),this.rfxShareSuccessful=(0,a.c)(this,"rfxShareSuccessful")}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,l.c)(this.hostElement,(0,a.a)(".")))}getConfig(){return{baseUrl:`${(0,d.H)(this.portal)}/home/`,restBaseUrl:"/"===this.portal.restUrl.substr(-this.portal.restUrl.length)?this.portal.restUrl:this.portal.restUrl+"/"}}destroy(){void 0!==this.modal&&(this.modal.remove(),this.modal=null)}async refreshAccessProperty(e){const t=e.clone();await t.reload(),e.access=t.access,e.sourceJSON&&(e.sourceJSON.access=e.access)}async onClose(e){const{detail:t}=e,{newShareLevel:i,cancelAtStep:a}=t||{},r=this.modal;r?.isActive&&(r.isActive=!1),await this.refreshAccessProperty(this.portalItem),i&&!a&&this.rfxShareSuccessful.emit(),setTimeout((()=>this.destroy()),250)}render(){const e=[this.portalItem];return(0,a.h)("arcgis-item-share",{key:"6b5dba47b5f817c8c5b3bbe444695da394e445e0",ref:e=>this.modal=e,api:4,items:e,portal:this.portal,user:this.portal.user,config:this.getConfig(),onWorkflowCancel:e=>this.onClose(e),onWorkflowComplete:e=>this.onClose(e)})}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};wt.style="";const St=class{constructor(e){(0,a.r)(this,e),this.spatialReferenceValueChange=(0,a.c)(this,"spatialReferenceValueChange"),this.spatialReferencePopoverDismissed=(0,a.c)(this,"spatialReferencePopoverDismissed"),this.defaultWkid=4326,this.searchText="",this.performantFilterSpatialReferences=(0,d.W)((e=>{this.updateSearchResults(e)}),250,{leading:!1,trailing:!0})}async getSRDescription(){return void 0!==this.value?.latestWkid?Promise.resolve((0,u.j)(this.value?.latestWkid)):Promise.resolve(void 0)}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.value=this.value??{latestWkid:this.defaultWkid};const e=this.filterSrCategories(u.s);this.visibleSrCategories=this.translateSrCategories(e)}translateSrCategories(e){const t={};return this.recursiveTranslate(e,t),t}recursiveTranslate(e,t){Object.keys(e).forEach((i=>{const a=this.getTranslatedKey(i);"object"==typeof e[i]?(t[a]={},this.recursiveTranslate(e[i],t[a])):t[a]=e[i]}))}getTranslatedKey(e){return e in this.strings?this.strings[e]:e}filterSrCategories(e){const t={};return Object.keys(e).forEach((i=>{void 0!==this.hideCategories&&!1!==this.hideCategories?.includes(i)||("object"==typeof e[i]?t[i]=this.filterSrCategories(e[i]):t[i]=e[i])})),t}setSpatialRef(e){this.value={latestWkid:Number(e)},this.spatialReferenceValueChange.emit(this.value)}inputKeyDown(e){"Enter"===e.key&&this.selectFirstChild(!0)}selectFirstChild(e){const t=this.treeElement,i=t?.shadowRoot?.querySelector("calcite-tree-item:not([has-children]):not([data-key='placeholder'])")||void 0;void 0!==t&&void 0!==i&&(i.selected=!0,this.setSpatialRef(i.dataset.key??""),e&&i.focus())}updateSearchResults(e){this.searchResults=(0,u.k)(e)}searchSpatialReferences(e){null!==e.target&&(this.searchText=e.target.value??"",this.searchText.length>1?this.performantFilterSpatialReferences(this.searchText):this.searchResults=void 0)}render(){return(0,a.h)(a.H,{key:"16920509b8c6a176dd3a6acbdaab426d6ddf8a30",dir:this.dir},(0,a.h)("calcite-panel",{key:"3e52fbd7be090408fe797deeb921e4db63834f15",closable:!1,closed:!1,onCalcitePanelClose:()=>this.spatialReferencePopoverDismissed.emit(this.value)},(0,a.h)("calcite-input",{key:"0c0f6f41cbcc44c5368510b1a4d8ba134f64d276",onCalciteInputInput:e=>this.searchSpatialReferences(e),onKeyDown:e=>this.inputKeyDown(e),placeholder:this.strings.searchPlaceholder,scale:o.U.Scale,type:"search",icon:!0}),this.searchText.length>1&&(0,d.i)(this.searchResults)&&(0,a.h)("calcite-label",{key:"5d269ff783c0c15c12a2fee7c65777ccf7195984",alignment:"center"},this.strings.noResults),(0,a.h)("rfx-tree",{key:"tree",ref:e=>this.treeElement=e,data:void 0!==this.searchResults&&this.searchText.length>0?this.searchResults:this.visibleSrCategories,value:this.value&&`${this.value?.latestWkid}`,onRfxTreeValueChange:()=>{this.setSpatialRef(this.treeElement.value)}}),(0,a.h)("calcite-button",{key:"84acb68e8b1c945e2043bda43b94cc70956e9a10",appearance:"solid",scale:o.U.Scale,width:"full",slot:"footer-actions",onClick:()=>this.spatialReferencePopoverDismissed.emit(this.value)},this.strings.done)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};St.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}:host{overflow-y:hidden;display:flex;flex-direction:column;--calcite-ui-border-input:var(--analysis-ui-border-input);height:var(--rfx-popover-content-height);min-width:20rem;max-width:27rem}rfx-tree{flex:1}";const Tt="rfx-template-editor",It={host:`${Tt}-host`,thumbnail:`${Tt}-thumbnail`,tabBody:`${Tt}__tab-body`,summary:`${Tt}-summary`},Lt={MatchVariable:{name:"MatchVariable",value:!0,isDataset:!1,isPublic:!1,type:"RasterFunctionVariable"},UnionDimension:{name:"UnionDimension",value:!1,isDataset:!1,isPublic:!1,type:"RasterFunctionVariable"},type:"PropertySet"},Rt=class{constructor(e){(0,a.r)(this,e),this.panelOk=(0,a.c)(this,"panelOk"),this.panelClose=(0,a.c)(this,"panelClose"),this.defaults={name:void 0,description:void 0,thumbnail:void 0,functionType:0,definitionQuery:"",properties:Lt,itemGroupDetails:"",itemTagDetails:""},this.fileExtSupported=[".png",".jpg",".jpeg",".gif"],this.uploadWidth=380,this.uploadHeight=180,this.showMultidimensionalProperties=!0,this.isItemGroupActive=!1,this.handleFileInputChange=e=>{e.stopPropagation();const t=e.target,i=t?.files;if((0,d.i)(i)||i?.length<1)return;const a=i[0];this.onFileInputChange(a)},this.isFileExtSupported=e=>this.fileExtSupported.some((function(t){return e.indexOf(`${t.toLowerCase()}`)>0})),this.onFileInputChange=e=>{if(null==e)return;const t=e.name;this.isFileExtSupported(t?.toLowerCase())||(this.thumbnailElement.src="",this.thumbnailElement.alt=this.strings.wrongImageType);const i=new FileReader;i.readAsDataURL(e),i.onload=e=>{const t=e.target.result;(0,d.i)(t)||this.setThumbnailURL(t)},i.onerror=()=>{console.error(i.error),this.thumbnailElement.src="",this.thumbnailElement.alt=this.strings.loadError}},this.handleButtonClick=()=>{this.fileInputElement?.click()}}connectedCallback(){}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)("."))),this.defaults.name=this.strings.defaultToolName,this.defaults.description=this.strings.defaultToolDescription,this.isItemGroupActive=this.value?.functionType===r.F.ItemGroup,this.setupInitialState()}setupInitialState(){const e=this.value?.properties??this.defaults.properties;this.value={name:this.value?.name??this.defaults.name,thumbnail:this.value?.thumbnail||this.portalItem?.thumbnailUrl||this.defaults?.thumbnail,functionType:this.value?.functionType??this.defaults.functionType,definitionQuery:this.value?.definitionQuery??this.defaults.definitionQuery,description:this.value?.description||this.portalItem?.snippet||this.defaults.description,itemGroupDetails:this.value?.itemGroupDetails??this.defaults.itemGroupDetails,itemTagDetails:this.value?.itemTagDetails??this.defaults.itemTagDetails},!0===this.showMultidimensionalProperties&&(this.value.properties=(0,d.G)(e))}renderthumbnailEditor(){return(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default"},(0,a.h)("rfx-label",{label:this.strings.thumbnail,hideHelp:!0}),(0,a.h)("calcite-card",{"thumbnail-position":"block-start"},(0,a.h)("img",{alt:"thumbnail",slot:"thumbnail",src:this.value.thumbnail??"data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22380%22%20height%3D%22180%22%20viewBox%3D%220%200%20380%20180%22%3E%20%3Crect%20fill%3D%22%23ddd%22%20width%3D%22380%22%20height%3D%22180%22%2F%3E%20%3Ctext%20fill%3D%22rgba%280%2C0%2C0%2C0.5%29%22%20font-family%3D%22sans-serif%22%20font-size%3D%2236%22%20dy%3D%2212.6%22%20font-weight%3D%22bold%22%20x%3D%2250%25%22%20y%3D%2250%25%22%20text-anchor%3D%22middle%22%3E380%C3%97180%3C%2Ftext%3E%20%3C%2Fsvg%3E",class:It.thumbnail,ref:e=>this.thumbnailElement=e}),(0,a.h)("input",{accept:this.fileExtSupported.join(","),multiple:!1,onChange:this.handleFileInputChange,ref:e=>this.fileInputElement=e,type:"file",hidden:!0}),(0,a.h)("calcite-fab",{appearance:"outline-fill",icon:"upload-to",label:this.strings.upload,text:this.strings.chooseImage,textEnabled:!0,scale:"m",slot:"footer-start",onClick:this.handleButtonClick})))}setThumbnailURL(e,t){const i=document.createElement("img");i.onload=()=>{const e=document.createElement("canvas"),a=e.getContext("2d");e.width=this.uploadWidth,e.height=this.uploadHeight,a.drawImage(i,0,0,this.uploadWidth,this.uploadHeight);const r=e.toDataURL("image/png");(0,d.i)(r)||(this.thumbnailElement.src=r,t||(this.value.thumbnail=r))},i.onerror=()=>{console.error("couldn't load the image"),this.thumbnailElement.src="",this.thumbnailElement.alt=this.strings.loadError},i.src=e}renderNameEditor(){return(0,a.h)("calcite-label",{alignment:"start",scale:"s",layout:"default"},(0,a.h)("rfx-label",{label:this.strings.title,hideHelp:!0}),(0,a.h)("calcite-input-text",{scale:o.U.Scale,placeholder:this.strings.nameEditorPlaceholder,value:this.value?.name,onCalciteInputTextChange:e=>{if(e.stopPropagation(),null===e.target)return;const t=(e?.target).value;(0,d.i)(t)||(this.value.name=t)}}))}renderSummaryEditor(){return(0,a.h)("calcite-label",{alignment:"start",scale:o.U.Scale,layout:"default"},(0,a.h)("rfx-label",{label:this.strings.summary,hideHelp:!0}),(0,a.h)("rfx-textarea-input",{scale:o.U.Scale,value:this.value?.description??this.strings.summaryEditorPlaceholder,class:It.summary,onRfxTextareaInputValueChange:e=>{e.stopPropagation();const t=e.detail;this.value.description=t}}))}renderFunctionTypeEditor(){return(0,a.h)("calcite-label",{alignment:"start",scale:"s",layout:"default"},(0,a.h)("rfx-label",{label:this.strings.type,hideHelp:!0}),(0,a.h)("rfx-dtex-common-select",{value:this.value?.functionType?.toString(),options:[{key:"0",label:this.strings.mosaic},{key:"1",label:this.strings.item},{key:"2",label:this.strings.itemGroup}],onRfxArgumentChange:e=>{e.stopPropagation();const t=e.target,i=Number.parseInt(t.value,10);this.value.functionType=i,this.isItemGroupActive=this.value.functionType===r.F.ItemGroup}}))}renderItemGroupProperties(){return(0,a.h)(a.F,null,(0,a.h)("calcite-label",{alignment:"start",scale:"s",layout:"default"},(0,a.h)("rfx-label",{label:this.strings.groupFieldName,hideHelp:!0}),(0,a.h)("calcite-input-text",{scale:o.U.Scale,placeholder:this.strings.definitionQueryPlaceholder,value:this.value?.itemGroupDetails,onCalciteInputTextChange:e=>{if(e.stopPropagation(),null===e.target)return;const t=(e?.target).value;this.value.itemGroupDetails=t}})),(0,a.h)("calcite-label",{alignment:"start",scale:"s",layout:"default"},(0,a.h)("rfx-label",{label:this.strings.tagFieldName,hideHelp:!0}),(0,a.h)("calcite-input-text",{scale:o.U.Scale,placeholder:this.strings.definitionQueryPlaceholder,value:this.value?.itemTagDetails,onCalciteInputTextChange:e=>{if(e.stopPropagation(),null===e.target)return;const t=(e?.target).value;this.value.itemTagDetails=t}})))}renderDefinitionQueryEditor(){return(0,a.h)("calcite-label",{alignment:"start",scale:"s",layout:"default"},(0,a.h)("rfx-label",{label:this.strings.definitionQuery,hideHelp:!0}),(0,a.h)("calcite-input-text",{scale:o.U.Scale,placeholder:this.strings.definitionQueryPlaceholder,value:this.value?.definitionQuery,onCalciteInputTextChange:e=>{if(e.stopPropagation(),null===e.target)return;const t=(e?.target).value;this.value.definitionQuery=t}}))}renderMultidimensionalRulesEditor(){return(0,a.h)("rfx-section",{label:this.strings.multidimensionalRules,open:!0},(0,a.h)("calcite-label",{layout:"inline"},(0,a.h)("calcite-switch",{checked:this.value.properties.MatchVariable.value,onCalciteSwitchChange:e=>{e.stopPropagation();const t=e.target.checked;this.value.properties.MatchVariable.value=t}}),(0,a.h)("rfx-label",{label:this.strings.matchVariables,hideHelp:!0})),(0,a.h)("calcite-label",{layout:"inline"},(0,a.h)("calcite-switch",{checked:this.value.properties.UnionDimension.value,onCalciteSwitchChange:e=>{e.stopPropagation();const t=e.target.checked;this.value.properties.UnionDimension.value=t}}),(0,a.h)("rfx-label",{label:this.strings.unionDimension,hideHelp:!0})))}render(){return(0,a.h)("calcite-tabs",{key:"a67bff80b1328bcaa7f15b76b1718210aed618ff",layout:"inline",scale:o.C.m,class:It.host},(0,a.h)("calcite-tab-nav",{key:"66b8514e8357d2874f35f2178d90ea5b03cfe80a",slot:"title-group"},(0,a.h)("calcite-tab-title",{key:"686daa8dd38c958955385e4a814380e9bd084e35",selected:!0},this.strings.general),(0,a.h)("calcite-tab-title",{key:"435cfd3cbe0be4924a8dd6dc5558e27ff684293b"},this.strings.settings)),(0,a.h)("calcite-tab",{key:"2a574e531d17740fcfa8345705fc155b2508183f",selected:!0,class:It.tabBody},this.renderthumbnailEditor(),this.renderNameEditor(),this.renderSummaryEditor()),(0,a.h)("calcite-tab",{key:"95aa95fdce4fec02eb043e9f6b5d8d80b07b1c7f"},this.renderFunctionTypeEditor(),this.isItemGroupActive?this.renderItemGroupProperties():null,this.renderDefinitionQueryEditor(),this.renderMultidimensionalRulesEditor()))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};Rt.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-template-editor-host{--calcite-modal-width:var(--rfx-modal-width-small)}.rfx-template-editor-thumbnail{width:380px}.rfx-template-editor-content{height:50vh}.rfx-template-editor__tab-body{overflow:hidden}.rfx-template-editor-summary textarea{resize:vertical !important}";const Vt="rfx-textarea-input",Dt={input:`${Vt}__calcite-input`,count:`${Vt}-count`},_t=class{constructor(e){(0,a.r)(this,e),this.rfxTextareaInputValueChange=(0,a.c)(this,"rfxTextareaInputValueChange"),this.rfxTextareaInputValueChangeHandler=e=>{e.stopPropagation(),this.value=e.target.value,this.rfxTextareaInputValueChange.emit(this.value)},this.applyStyleToInput=e=>{(0,g.n)(e,["shadowRoot"],(e=>{const t=document.createElement("style");t.innerHTML="textarea { resize: vertical !important; min-height: 80px !important; }",e.appendChild(t)}))}}async componentWillLoad(){({strings:this.strings,dir:this.direction,locale:this.locale}=await(0,l.c)(this.el,(0,a.a)(".")))}render(){const{strings:e,value:t,scale:i}=this;return(0,a.h)("calcite-label",{key:"100eae0fe7c94b8cb0874d2880f57dbc765633f5",scale:i},(0,a.h)("calcite-input",{key:"0c14409affda47a02c70d8569356d851626be172",scale:i,type:"textarea",id:"textarea-input",placeholder:e.addSummary,class:Dt.input,value:t,maxLength:2048,onCalciteInputInput:this.rfxTextareaInputValueChangeHandler,ref:this.applyStyleToInput}),(0,a.h)("span",{key:"6d3d4a0d18408769b3e163d57213105561f41264",class:Dt.count},e.charactersLeft.replace("${num}",""+(2048-t.length))))}static get assetsDirs(){return["t9n"]}get el(){return(0,a.g)(this)}};_t.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-textarea-input__calcite-input textarea{resize:vertical !important}.rfx-textarea-input-count{font-size:var(--calcite-font-size--2);color:var(--calcite-color-text-2);opacity:75%}";const Ot=class{constructor(e){(0,a.r)(this,e),this.rfxTreeValueChange=(0,a.c)(this,"rfxTreeValueChange"),this.data={},this.renderedTree=[],this.treeItemsOpen=new Set,this.handleMutations=e=>{e.forEach((e=>{if("attributes"===e.type&&"expanded"===e.attributeName){const t=e.target;if("key"in t.dataset&&void 0!==t.dataset.key){this.treeItemsOpen.has(t.dataset.key)!==t.expanded&&this.toggleTreeItem(t.dataset.key)}}}))},this.toggleTreeItem=e=>{this.treeItemsOpen.has(e)?this.treeItemsOpen.delete(e):this.treeItemsOpen.add(e),this.buildJSXTree()}}onDataChange(){this.setupComponent()}componentWillLoad(){this.setupComponent()}componentDidLoad(){this.setupObserver()}disconnectedCallback(){this.observer?.disconnect()}setupComponent(){this.treeItemsOpen.clear(),this.buildJSXTree()}setupObserver(){this.observer=new MutationObserver(this.handleMutations);const e=this.hostElement.shadowRoot??this.hostElement;this.observer.observe(e,{attributes:!0,subtree:!0,attributeFilter:["expanded"]})}buildJSXTree(){const e=t=>{const i=[];for(const a in t){const r=t[a];let s;"object"==typeof r&&(s=this.treeItemsOpen.has(a)?e(r):[this.createTreeItem("placeholder","placeholder")]);const n="object"==typeof r?a:r;i.push(this.createTreeItem(a,n,s))}return i};this.renderedTree=e(this.data)}createTreeItem(e,t,i){return(0,a.h)("calcite-tree-item",{key:`${e}-item`,"data-key":e,selected:this.value===e,"aria-selected":this.value===e,expanded:this.treeItemsOpen.has(e),"aria-expanded":this.treeItemsOpen.has(e)},t,void 0!==i&&(0,a.h)("calcite-tree",{key:`${e}-child-tree`,slot:"children"},i))}handleTreeSelect(e){const t=e.target,i=t?.selectedItems[0]?.dataset.key;if(void 0!==i)if(!0===i.includes("placeholder")){const e=t?.selectedItems[0].parentElement?.dataset.key;void 0!==e&&this.treeItemsOpen.add(e),this.buildJSXTree()}else this.value=i,this.rfxTreeValueChange.emit()}render(){return(0,a.h)(a.H,{key:"42f386d69bac8823779613dd00c559889ec17e24"},(0,a.h)("div",{key:"cf5f9c4801e793be756c0ee5b45b0981d7ff0468"},(0,a.h)("calcite-tree",{key:"base-tree",scale:o.U.Scale,onCalciteTreeSelect:e=>this.handleTreeSelect(e)},this.renderedTree)))}get hostElement(){return(0,a.g)(this)}static get watchers(){return{data:["onDataChange"]}}};Ot.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}:host{overflow-y:auto;overflow-x:hidden;scroll-behavior:smooth;height:100%;width:100%}"}}]);