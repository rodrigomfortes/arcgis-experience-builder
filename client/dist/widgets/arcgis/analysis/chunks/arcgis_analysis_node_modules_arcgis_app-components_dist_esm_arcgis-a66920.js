/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-a66920.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-a66920"],{35536:(e,t,i)=>{i.d(t,{a:()=>l});var a=i(50637),n=i(52763),s=i(32710);async function l(e){var t,i,l;const r=(0,n.g)(e),d=`${null===(t=e.existingItem)||void 0===t?void 0:t.url}/${e.sourceDataLayer.id}/append`;try{const t=await(0,a.r)(d,r,{},"post"),{status:i,recordCount:n}=await(0,s.g)(e.id,{},null==t?void 0:t.statusUrl);return{result:{status:i,recordCount:n}}}catch(e){let t="unhandledError";const a={error:e},n=(null===(i=a.error.description)||void 0===i?void 0:i.toLowerCase())||(null===(l=a.error.message)||void 0===l?void 0:l.toLowerCase());switch(!0){case n.includes("the create unique index statement terminated because a duplicate key was found for the object name"):t="invalidUniqueIdentifier";break;case n.includes("does not allow nulls"):t="cannotAddNullData";break;case n.includes("the value violates the maxlength limit of this column"):t="exceededMaxFieldLength";break;case n.includes("input string was not in a correct format"):t="invalidFieldType"}return console.error(e),{error:{code:t,message:JSON.stringify(e)}}}}},38092:(e,t,i)=>{i.r(t),i.d(t,{arcgis_new_item_pages_append_match_fields:()=>c});var a=i(87849),n=i(3826),s=i(95878),l=i(52763),r=i(43555),d=i(35536),o=i(59317);i(37762),i(8214),i(56175),i(50822),i(93814),i(87744),i(66111),i(83929),i(50637),i(931),i(15912),i(50020),i(72257),i(86562),i(15332),i(32710),i(76246),i(63054),i(24869),i(75294),i(38295),i(51102);const c=class{constructor(e){(0,a.r)(this,e),this.newItemUpdatePage=(0,a.c)(this,"newItemUpdatePage",7),this.newItemPrevPage=(0,a.c)(this,"newItemPrevPage",7),this.workflowComplete=(0,a.c)(this,"workflowComplete",7),this.newItemToggleNavigationEnabled=(0,a.c)(this,"newItemToggleNavigationEnabled",7),this.newItemDisableCloseButtons=(0,a.c)(this,"newItemDisableCloseButtons",7),this.validatedFields=[],this.ITEMS_PER_PAGE=15,this.fields=void 0,this.i18n=void 0,this.fieldMatches=[],this.error=void 0,this.loading=!1,this.loaderType="indeterminate",this.loaderMessage=void 0,this.currentStart=1,this.filteredFields=[],this.searchTerm=""}handleNext(){const e=this.validateMatchings();e?this.error=e:(n.a.fieldMappings=this.fieldMatches,"add"!==this.appendSelection?this.newItemUpdatePage.emit("appendSelectUpdate"):this.handleAppend())}validateMatchings(){if(!this.fieldMatches.every((e=>e.source===this.noneString))){const e=this.fieldMatches.filter((e=>!e.disabled&&!e.nullable&&e.source===this.noneString)),t=e.every((e=>e.defaultValue&&!e.isUniqueIndex));return e.length<=0||"update"===this.appendSelection||t&&"add"===this.appendSelection?null:{title:this.i18n.errors.nonNullableErrorTitle,description:this.i18n.errors.nonNullableErrorDescription}}return{title:this.errorLabel,description:this.i18n.errors.noMatchedFields}}disableModalButtons(e){this.newItemToggleNavigationEnabled.emit(!e),this.newItemDisableCloseButtons.emit(e)}async handleAppend(){var e,t,i;const{sourceDataLayer:a,existingItem:c,timezone:p,analyzeResults:h,type:u,fieldMappings:m,dataLayer:g,id:y,uidPair:f,addAppendSelectOption:F,attachmentsEnabled:b,insertAttachmentsEnabled:v,featureAttachmentOption:T}=n.a;this.disableModalButtons(!0),this.loading=!0,this.loaderMessage=s.u.i18n.append.appendLoadingMessages.appendCloseNotice;const w=await(0,d.a)({portal:null===o.c||void 0===o.c?void 0:o.c.portal,sourceDataLayer:a,existingItem:c,timezone:p,analyzeResults:h,type:u,fieldMappings:m,dataLayer:g,id:y,uidPair:f,addAppendSelectOption:F,attachmentsEnabled:b,insertAttachmentsEnabled:v,featureAttachmentOption:T});if(await(0,r.d)(n.a.id,{permanentDelete:!0}),"completed"!==(null===(t=null===(e=null==w?void 0:w.result)||void 0===e?void 0:e.status)||void 0===t?void 0:t.toLowerCase()))this.disableModalButtons(!1),this.loading=!1,this.newItemToggleNavigationEnabled.emit(!0),this.error=(0,l.h)(null!==(i=null==w?void 0:w.error)&&void 0!==i?i:{code:"unhandledError"},{appendErrorMessages:s.u.i18n.append.appendErrorMessages});else{const e=Object.assign({appendType:n.a.addAppendSelectOption,insertAttachmentsEnabled:n.a.insertAttachmentsEnabled},w);this.workflowComplete.emit(e)}}async handlePrev(e){var t;this.loading||"add"!==this.appendSelection||(null===(t=n.a.analyzeResults.publishParameters.layers)||void 0===t?void 0:t.length)>1||(e.preventDefault(),this.newItemPrevPage.emit())}handleFieldChange(e){const t=Object.assign({},e.detail);this.validateFieldMappings(this.validatedFields,t)}sortFields(){this.fieldMatches=this.fieldMatches.sort((function(e,t){const i=e.name.toLowerCase(),a=t.name.toLowerCase();return i<a?-1:i>a?1:0}))}validateFieldMappings(e,t){if(t.initialMatch=t.source,t.source!==this.noneString){const i=e.filter((e=>e.source===t.source));if((null==i?void 0:i.length)>0){const t=i[0].idx;e[t].initialMatch=this.noneString,e[t].source=this.noneString}}if(e[t.idx]=t,this.validatedFields=e,this.fieldMatches=[...this.validatedFields],this.sortFields(),this.searchTerm.length>0){const{currentStart:e}=this;this.fetchFields(this.searchTerm),this.currentStart=e}}setNextText(){s.u.nextText="add"===this.appendSelection?"addAndComplete":"next"}componentWillLoad(){const{addAppendSelectOption:e,uidPair:t,sourceDataLayer:i,backupLayerFields:a}=n.a;this.i18n=s.u.i18n.appendMatchFields,this.errorLabel=s.u.i18n.error,this.noneString=`<${s.u.i18n.appendKeyValuePair.noneField}>`,this.appendSelection=e;const l=a,r="csv"===i.type?[i.layerInfo]:i.fields,d="upsert"===this.appendSelection||"update"===this.appendSelection;this.setNextText(),this.selectedKeyPair=t;let o="add"===this.appendSelection?0:1;r.forEach((e=>{"esriFieldTypeOID"===(null==e?void 0:e.type)||"esriFieldTypeGlobalID"===(null==e?void 0:e.type)||!e.editable||d&&e.name===this.selectedKeyPair.name||(this.fieldMatches.push(this.createFieldMapping(e,l,o)),this.validatedFields.push(this.createFieldMapping(e,l,o)),o++)})),"add"!==this.appendSelection&&(this.fieldMatches.unshift(this.selectedKeyPair),this.validatedFields.unshift(this.selectedKeyPair)),this.sortFields()}createFieldMapping(e,t,i){const a=n.a.dataLayer.addressFields?Object.values(n.a.dataLayer.addressFields):null;let s=this.noneString;const r=[{source:this.noneString,name:e.name,type:"None",idx:i}];return t.forEach((t=>{!(0,l.c)(e,t)||"add"!==this.appendSelection&&t.name===this.selectedKeyPair.source||(r.push({source:t.name,name:e.name,type:e.type,idx:i}),e.name.toLowerCase()!==t.name.toLowerCase()||e.type!==t.type&&!(null==a?void 0:a.find((e=>e===t.displayName||e===t.name)))||"add"!==this.appendSelection&&t.name===this.selectedKeyPair.source||(s=t.name))})),{source:s,name:e.name,nullable:e.nullable,type:e.type,idx:i,isUniqueIndex:e.isUniqueIndex,defaultValue:e.defaultValue,initialMatch:s,possibleMatches:r}}fetchFields(e){this.searchTerm=e.toLowerCase();const t=this.fieldMatches.filter((e=>e.name.toLowerCase().includes(this.searchTerm,0)));this.currentStart=1,this.filteredFields=t}render(){const{i18n:e,error:t,ITEMS_PER_PAGE:i,fieldMatches:l,currentStart:r,filteredFields:d,searchTerm:o}=this,{originalFileName:c,existingItem:p}=n.a;if(!p)return;const h={originalField:{header:e.originalField.header,moreInfo:e.originalField.moreInfo.replace("${featureLayerName}",p.title)},uploadedField:{header:e.uploadedField.header,moreInfo:e.uploadedField.moreInfo.replace("${uploadedFileName}",c)}},u=e.description.replace("${uploadedFileName}",c).replace("${featureLayerName}",p.title),m=o.length>0?d:l,g=m.length>0,y=m.length>i,f=null==m?void 0:m.slice(r-1,r+i-1);return(0,a.h)(a.H,{class:{"overflow-hidden":this.loading}},(0,a.h)("arcgis-new-item-loader",{type:this.loaderType,active:this.loading,text:this.loaderMessage}),(0,a.h)("div",{class:"header"}," ",e.header," "),(0,a.h)("div",{class:"description"},u),(0,a.h)("div",{class:"search-bar"},(0,a.h)("calcite-input",{icon:"search",class:"search-match-fields",placeholder:s.u.i18n.layerSearch.search,onCalciteInputInput:e=>{const t=e.target.value;this.fetchFields(t)}})),(0,a.h)("div",{class:"row",role:"row"},Object.keys(h).map((e=>{const{header:t,moreInfo:i}=h[e];return(0,a.h)("span",{class:"header-cell",role:"columnheader","aria-sort":"none"},t,(0,a.h)("arcgis-information",{class:"header-popover",label:i,placement:"top-start",paddedContent:!0},(0,a.h)("p",{class:"popover-content"},i)))}))),g?(0,a.h)("div",{class:"fields-scroll-container",role:"table"},f.map((e=>(0,a.h)("arcgis-new-item-append-match-field",{key:e.source,field:e,role:"row",onFieldChange:this.handleFieldChange.bind(this)})))):(0,a.h)("calcite-input-message",{class:"no-fields",icon:!0,status:"valid"},this.i18n.errors.noFields),y&&(0,a.h)("div",{class:"pagination"},(0,a.h)("calcite-pagination",{scale:"m",class:"pagination-component",totalItems:m.length,pageSize:i,startItem:this.currentStart,onCalcitePaginationChange:e=>{this.currentStart=e.target.startItem}})),(0,a.h)("arcgis-new-item-alert",{heading:null==t?void 0:t.title,description:null==t?void 0:t.description,link:{href:null==t?void 0:t.link,title:null==t?void 0:t.linkText},active:!!t,onAlertDismiss:()=>this.error=null}))}get el(){return(0,a.a)(this)}};c.style=".fields-container{display:flex;height:100%;flex-direction:column;overflow-y:auto;overflow-x:hidden}.field-table{margin-bottom:1.5rem;display:flex;flex-direction:column;overflow:auto}.search-container{display:flex;width:100%}.field-search{margin-right:0.5rem;width:50%}.field-select{width:50%}.field-name-column{margin-right:0.5rem;width:50%}.match-field-name-column{width:50%}.fields-scroll-container{margin-bottom:0.75rem;display:flex;flex-direction:column;padding-bottom:0.75rem;border-bottom:0.125rem solid var(--calcite-color-foreground-3)}.header-row{display:flex;align-content:flex-start;justify-content:center;gap:0.25rem;padding:0.25rem;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1)}.header-cell{display:flex;width:100%;font-size:1rem}.hide{display:none}.not-visible{visibility:hidden;height:0px}.cell{box-sizing:border-box;width:100%}.cell label{margin-top:0.75rem}.row{margin-bottom:0.75rem;display:flex;align-items:center;justify-content:space-between;gap:0.25rem;padding:0.25rem;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1);border-bottom:0.125rem solid var(--calcite-color-foreground-3)}.deselected{opacity:var(--calcite-ui-opacity-disabled)}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.label{--calcite-label-margin-bottom:0}.append-timezone{border-top:0.063rem solid var(--calcite-color-foreground-3)}.from-to-fields{display:flex;flex-direction:row}.description{margin-bottom:1rem;font-size:0.875rem;font-weight:300}.header{margin-bottom:0.5rem;font-size:1rem;font-weight:500;color:var(--calcite-color-text-1)}.no-fields{margin-bottom:1.5rem}.popover-icon{cursor:pointer;color:var(--calcite-color-text-3);margin-inline-start:0.75rem;margin-top:0.125rem}.popover-content{margin:0px;max-width:20rem;font-size:0.75rem;font-weight:400}.header-popover{margin-top:-0.313rem}.search-match-fields{margin-bottom:1rem}.pagination-component{display:flex;justify-content:center}"},52763:(e,t,i)=>{i.d(t,{a:()=>c,c:()=>d,g:()=>o,h:()=>p});var a=i(3826),n=i(8214),s=i(15912),l=i(95878),r=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(i[a[n]]=e[a[n]])}return i};function d(e,t){var i;const a=(null==e?void 0:e.type)||null,n=(null==t?void 0:t.type)||null;return n&&(n===a||(null===(i={esriFieldTypeSmallInteger:["esriFieldTypeSmallInteger"],esriFieldTypeInteger:["esriFieldTypeInteger","esriFieldTypeSmallInteger"],esriFieldTypeSingle:["esriFieldTypeSingle","esriFieldTypeDouble"],esriFieldTypeDouble:["esriFieldTypeDouble","esriFieldTypeSingle","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],esriFieldTypeDate:["esriFieldTypeDate"],esriFieldTypeString:["esriFieldTypeString","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeDate","esriFieldTypeGUID","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset","esriFieldTypeBigInteger"],esriFieldTypeGUID:["esriFieldTypeGUID","esriFieldTypeString"],esriFieldTypeOID:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger"],esriFieldTypeGlobalID:["esriFieldTypeGlobalID","esriFieldTypeGUID","esriFieldTypeString"],esriFieldTypeDateOnly:["esriFieldTypeDateOnly"],esriFieldTypeTimeOnly:["esriFieldTypeTimeOnly"],esriFieldTypeTimestampOffset:["esriFieldTypeTimestampOffset"],esriFieldTypeBigInteger:["esriFieldTypeBigInteger"]}[a])||void 0===i?void 0:i.includes(n)))}function o(e){var t;const{timezone:i,analyzeResults:d,type:o,fieldMappings:c,dataLayer:p,id:h,portal:u,uidPair:m,addAppendSelectOption:g,sourceDataLayer:y,attachmentsEnabled:f,insertAttachmentsEnabled:F,featureAttachmentOption:b}=e;let v,T;const{publishParameters:w}=d,I=r(d,["publishParameters"]),x="upsert"===g||"update"===g,S=function(e){const t=e.filter((e=>e.source!==`<${l.u.i18n.appendKeyValuePair.noneField}>`)),i=t.map((({source:e,name:t})=>({source:e,name:t})));return i}(c),O=function(e){const t=e.map((e=>e.name));return t}(S),M={dateFieldsTimeReference:Object.assign(Object.assign({},(null==u?void 0:u.isPortal)?{timezone:i||"UTC"}:{ianaTimeZone:i||"GMT"}),{respectsDaylightSaving:!0})},D={sourceTableName:p.name,fieldMappings:(null==S?void 0:S.length)?JSON.stringify(S):null,upsert:x,skipInserts:"update"===g,skipUpdates:!1,useGlobalIds:x&&"esriFieldTypeGlobalID"===(null==m?void 0:m.type),updateGeometry:!x||"attributeAndGeometry"===a.a.addAppendSelectUpdateTypeOption,appendFields:O.length?JSON.stringify(O):null,appendItemId:h,appendUploadFormat:s.a[a.a.type].appendUploadFormat,rollbackOnFailure:!0};"Table"===y.type&&(w.locationType="none");const A=r(w,["layers"]);if("CSV"===o)w.layerInfo.dateFieldsTimeReference=M.dateFieldsTimeReference,T=Object.assign(Object.assign(Object.assign({},M),w),I);else if("Microsoft Excel"===o){const e=function(e,t){const i=Object.assign({},e);i.locationType=(null==t?void 0:t.locationType)||e.locationType,"address"===i.locationType?(i.addressFields=t.addressFields,i.sourceCountry=t.sourceCountry):"coordinates"===i.locationType&&(i.coordinateFieldType=t.coordinateFieldType,"LatitudeAndLongitude"===i.coordinateFieldType?(i.latitudeFieldName=t.latitudeFieldName,i.longitudeFieldName=t.longitudeFieldName):i.coordinateFieldName=t.coordinateFieldName);return i}((0,n.a)({},!0),A);e.dateFieldsTimeReference=M.dateFieldsTimeReference,A.name=p.name,T=Object.assign(Object.assign(Object.assign(Object.assign({},M),{layers:[e]}),A),I)}else T=Object.assign(Object.assign(Object.assign({},M),w),I);return v=Object.assign(Object.assign(Object.assign({},D),{appendSourceInfo:JSON.stringify(T)}),f&&function({insertAttachmentsEnabled:e}){return e?{skipAttachmentInserts:!1,skipAttachmentUpdates:!0,skipAttachmentDeletes:!0}:{skipAttachmentInserts:!0,skipAttachmentUpdates:!0,skipAttachmentDeletes:!0}}({appendType:g,insertAttachmentsEnabled:F,featureAttachmentOption:b})),"add"===g?v.upsertMatchingField=y.objectIdField||(null===(t=y.uniqueField)||void 0===t?void 0:t.name):x&&(null==m?void 0:m.isUniqueIndex)&&(v.upsertMatchingField=null==m?void 0:m.name),v}function c(e,t,i){return"File Geodatabase"===e&&i.hasAttachments&&t.hasAttachments}function p(e,t){const i=t.appendErrorMessages;let a=l.u.i18n.error,n=i.appendError;switch(e.code){case"invalidUniqueIdentifier":a=i.invalidUniqueIdentifier.title,n=i.invalidUniqueIdentifier.description;break;case"cannotAddNullData":a=i.cannotAddNullData.title,n=i.cannotAddNullData.description;break;case"exceededMaxFieldLength":a=i.exceededMaxFieldLength.title,n=i.exceededMaxFieldLength.description;break;case"invalidFieldType":a=i.invalidFieldType.title,n=i.invalidFieldType.description}return{title:a,description:n}}}}]);