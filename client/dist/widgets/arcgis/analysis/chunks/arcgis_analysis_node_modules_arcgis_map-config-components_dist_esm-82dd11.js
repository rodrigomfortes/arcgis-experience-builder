/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-82dd11.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-82dd11"],{44735:(e,t,i)=>{function s(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}i.d(t,{i:()=>s})},52618:(e,t,i)=>{i.r(t),i.d(t,{arcgis_filter_condition:()=>k,arcgis_filter_unique_list:()=>$});var s=i(11254),a=i(17840),n=i(10465),l=i(53127),r=i(40387),o=i(33443),u=i(69811),d=i(44735),c=i(14528),h=(i(56612),i(84260));const p="field-selection",m="delete-action",g="filter-condition",v="operator-dropdown",f="input-plus-unique",y="input-plus-unique-date",I="input",C="label",S="blank-button",b="select-unique-button",T="between-values-input",N="select-values",F="list",V="unique-values-content-list-msg",E="in-the-last",O="in-the-last-count",x="in-the-last-unit",q="date-picker",D="histogram-content",L="small-loader",w="time-zone",U="time-zone-icon",k=class{constructor(e){(0,s.r)(this,e),this.arcgisFilterConditionChanged=(0,s.c)(this,"arcgisFilterConditionChanged",7),this.arcgisFilterConditionDeleted=(0,s.c)(this,"arcgisFilterConditionDeleted",7),this.disablePanel=(0,s.c)(this,"disablePanel",7),this.arcgisValuesReturned=(0,s.c)(this,"arcgisValuesReturned",7),this.manager=(0,c.u)(this),this.histogramSlider=void 0,this.isEditorField=!1,this.afterCreateSliderDiv=e=>{const{fieldName:t,props:i,histogramSlider:s}=this,{modules:a}=i;e&&setTimeout((()=>{if(!s)return;const n=document.createElement("div");if(e.appendChild(n),s.container){const e=(0,r.g)(t,i);if(!e)return;const{bins:l,average:o,min:u,max:d,values:c,precision:h,rangeType:p}=s,m={container:n,bins:l,average:o,min:u,max:d,values:c,precision:h,rangeType:p};[r.s.DATE,r.s.DATE_ONLY,r.s.TIME_ONLY].includes(e.simpleFieldType)&&(m.hasTimeData=!0,this.addDateFormatFunctions(m,e)),s.destroy(),this.histogramSlider=new a.HistogramRangeSlider(m),this.createSliderChangeEvents(e)}else s.container=n}),1)},this.onFieldSelect=()=>{this.hasFocus=!0,this.openFieldPickList()},this.onOperatorSelect=e=>{const{props:t,fieldName:i,operator:s,value:a,value2:n}=this,l=e.target.selectedOption.value,o=(0,r.g)(i,t),u=(0,r.c)(t,s),d=(0,r.c)(t,l),c=u||d,h=u&&d,p=(0,r.i)(t,s),m=(0,r.i)(t,l),g=p&&m,v={value:a,value2:n,operator:s};this.value=(c&&!h?void 0:o.statistics&&!(0,r.a)(a)?o.statistics.avg:a)??void 0,this.value2=(m?n??((0,r.z)(o)&&o.statistics?.max?Math.round(o.statistics?.max):o.statistics?.max):c||!g?void 0:n)??void 0,this.operator=l;const f=this.checkDefaultValues(o),y={value:this.value??f.value,value2:this.value2??(m?f.value2:null),operator:this.operator,unit:this.unit||f.unit};this.value=v.value,this.value2=v.value2,this.operator=v.operator,this.emitChangeEvent(y)},this.onValueChangeMaybe=e=>{const{props:t,operator:i,value2:s}=this,a=this.getNewValue(e);(0,r.a)(a)&&(0,r.i)(t,i)&&a>=s||this.onValueChange(e,a)},this.onValueChange=(e,t)=>{t=t??this.getNewValue(e);const{props:i,fieldName:s,operator:a,value:n,value2:l}=this,{layer:u,view:d}=i,c=(0,r.g)(s,i),h=e;if(t=e?this.getNewValue(e):t,!(0,r.a)(t)){const e=(0,r.r)(i,c,a);if(t=e.value,h)if(c.simpleFieldType===r.s.DATE){const e=(0,o.f)(t,d?.timeZone,"preferredTimeZone"in u?u.preferredTimeZone??void 0:void 0);if("CALCITE-INPUT-DATE-PICKER"===h.tagName)h.value=e;else{const t=(0,o.e)(e);t&&(h.value=t)}}else c.simpleFieldType===r.s.DATE_ONLY?h.value=new Date(t).toISOString():c.simpleFieldType===r.s.TIME_ONLY?h.value=(0,o.a)(t):h.value=(0,r.a)(t)?`${t}`:""}if(n!==t){if((0,r.a)(t)&&(0,r.i)(i,a)&&t>=l&&h)if(c.simpleFieldType===r.s.DATE)if(t=l-1e3,"CALCITE-INPUT-TIME-PICKER"===h.tagName){const e=(0,o.f)(t,d?.timeZone,"preferredTimeZone"in u?u.preferredTimeZone??void 0:void 0),i=(0,o.e)(e);i&&requestAnimationFrame((()=>h.value=i))}else h.value=(0,o.f)(t,d?.timeZone,"preferredTimeZone"in u?u.preferredTimeZone??void 0:void 0);else if(c.simpleFieldType===r.s.DATE_ONLY){const e=new Date(l-864e5);h.value=new Date(e).toISOString(),t=new Date(e).getTime()}else c.simpleFieldType===r.s.TIME_ONLY?(t=l-1e3,requestAnimationFrame((()=>h.value=(0,o.a)(t)))):(t=l-1,h.value=`${t}`);("CALCITE-INPUT-DATE-PICKER"===h?.tagName||"CALCITE-INPUT-TIME-PICKER"===h?.tagName||"CALCITE-INPUT"===h?.tagName&&"number"===h?.type||"CALCITE-INPUT-NUMBER"===h?.tagName)&&this.adjustHistogramMinMax(t),this.changeValues(t,l)}},this.onValue2ChangeMaybe=e=>{const{props:t,operator:i,value:s}=this,a=this.getNewValue(e);(0,r.a)(a)&&(0,r.i)(t,i)&&a<=s||this.onValue2Change(e,a)},this.onValue2Change=(e,t)=>{const{value:i,props:s,fieldName:a,operator:n}=this,{layer:l,view:u}=s,d=(0,r.g)(a,s),c=e;if(t=t??this.getNewValue(e)??void 0,!(0,r.a)(t)){const e=(0,r.r)(s,d,n);if(t=e.value2,d.simpleFieldType===r.s.DATE){const e=(0,o.f)(t,u?.timeZone,"preferredTimeZone"in l?l.preferredTimeZone??void 0:void 0);if("CALCITE-INPUT-DATE-PICKER"===c.tagName)c.value=e;else{const t=(0,o.e)(e);t&&(c.value=t)}}else d.simpleFieldType===r.s.DATE_ONLY?c.value=new Date(t).toISOString():d.simpleFieldType===r.s.TIME_ONLY?c.value=(0,o.a)(t):c.value=(0,r.a)(t)?`${t}`:""}if((0,r.a)(t)&&t<=i)if(d.simpleFieldType===r.s.DATE)if(t=i+1e3,"CALCITE-INPUT-TIME-PICKER"===c.tagName){const e=(0,o.f)(t,u?.timeZone,"preferredTimeZone"in l?l.preferredTimeZone??void 0:void 0),i=(0,o.e)(e);i&&requestAnimationFrame((()=>c.value=i))}else c.value=(0,o.f)(t,u?.timeZone,"preferredTimeZone"in l?l.preferredTimeZone??void 0:void 0);else if(d.simpleFieldType===r.s.DATE_ONLY){const e=new Date(i+864e5);c.value=new Date(e).toISOString(),t=new Date(e).getTime()}else d.simpleFieldType===r.s.TIME_ONLY?(t=i+1e3,requestAnimationFrame((()=>c.value=(0,o.a)(t)))):(t=i+1,c.value=`${t}`);("CALCITE-INPUT-DATE-PICKER"===c.tagName||"CALCITE-INPUT-TIME-PICKER"===c?.tagName||"CALCITE-INPUT"===c.tagName&&"number"===c.type||"CALCITE-INPUT-NUMBER"===c?.tagName)&&this.adjustHistogramMinMax(t),this.changeValues(i,t)},this.debouncedOnValueChangeMaybe=(0,l.d)((e=>this.onValueChangeMaybe(e)),500),this.debouncedOnValueChange=(0,l.d)((e=>this.onValueChange(e)),500),this.debouncedOnValue2ChangeMaybe=(0,l.d)((e=>this.onValue2ChangeMaybe(e)),500),this.onUnitSelect=e=>{const t=e.target;this.emitChangeEvent({unit:t.selectedOption.value})},this.onSelectUniqueValue=e=>{e.stopPropagation(),this.onSelectUnique(!1)},this.onSelectUniqueValues=()=>{const{props:e,fieldName:t,operator:i}=this,s=(0,r.g)(t,e),a=(0,r.A)(s),n=(0,r.b)(e,i),l=a&&!n;this.onSelectUnique(!l)},this.onDocumentClick=e=>{e.target.closest(`#arcgis-filter-unique-popover_${this.uid}`)||this.removeUniquePopover()},this.onRemoveSelectedValue=e=>{const{values:t,props:i}=this,{modules:a}=i,n=t.indexOf(e);t.splice(n,1),this.emitChangeEvent({values:t.length?a.esriLang.clone(t):null}),(0,s.f)(this.el)},this.afterCreateList=e=>{e&&this.scrollExprIntoView(e)},this.onHistogramBlockToggle=e=>{e.currentTarget.open?this.onHistogramOpen():this.onHistogramClose()},this.fieldPickListChanges=e=>{e.stopPropagation();const t=e.detail?.selectedFields?.[0];this.removeFieldsPickList(),t&&this.afterFieldSelect(t)},this.props=void 0,this.uid=void 0,this.fieldName=void 0,this.operator=void 0,this.uniqueValuesSortBy=void 0,this.value=void 0,this.value2=void 0,this.values=void 0,this.unit=void 0,this.histogramClosed=void 0,this.hasFocus=!1,this.invalidValue=void 0,this.showDelete=!1}arcgisValuesReturnedHandler(e){const t=e.detail;this.fieldName===t&&(this.checkDefaultValues((0,r.g)(t,this.props)),(0,s.f)(this.el))}arcgisFilterUniqueListChangedHandler(e){const{detail:t}=e;if(t.uid===this.uid){const e=t.selectedValues;if(t.multiple)this.emitChangeEvent({values:e,uniqueValuesSortBy:t.sortBy});else{this.uniqueValuesSortBy=t.sortBy;let i=e?.length?e[0]:void 0;const{fieldName:s,props:a}=this,n=(0,r.g)(s,a);(0,r.a)(i)&&"string"==typeof i&&n.simpleFieldType===r.s.TIME_ONLY&&(i=(0,o.t)(i)),this.onValueChange(null,i),this.removeUniquePopover(),this.uniqueActionNode?.setFocus()}}}arcgisFilterUniqueListSortByChanged(e){const{detail:t}=e;t.uid===this.uid&&(this.uniqueValuesSortBy=t.sortBy)}arcgisFilterUniqueListDoneHandler(e){const{detail:t}=e;t===this.uid&&(this.removeUniquePopover(),this.uniqueActionNode?.setFocus())}calcitePopoverCloseHandler(){this.uniquePopoverNode&&(this.removeUniquePopover(),this.uniqueActionNode?.setFocus())}closeFilterPopoversHandler(){this.removeFieldsPickList(),this.removeUniquePopover()}async onEdits(){this.onDisplayUniqueValues(this.fieldName)}async componentWillLoad(){const{props:e}=this,{modules:t}=e,i=(0,r.q)({fields:this.props.fields});this.fieldName=this.fieldName||i.layerField.name,this.operator=this.operator||(0,r.y)(this.props,i),this.hasFocus=!!this.hasFocus,t.summaryStatistics=t.summaryStatistics||await(0,u.aP)(),t.histogram=t.histogram||await(0,u.aQ)(),t.uniqueValues=t.uniqueValues||await(0,u.aR)(),t.HistogramRangeSlider=t.HistogramRangeSlider||await(0,u.aS)(),this.onDocumentClickBind=this.onDocumentClick.bind(this)}componentDidLoad(){(0,d.i)(this.el.shadowRoot,this.props.modules.esriConfig),this.setFocus()}disconnectedCallback(){this.removeFieldsPickList(),this.removeUniquePopover()}render(){const{fieldName:e,props:t}=this,{layer:i}=t,a=(0,r.g)(e,t);if(!a?.simpleFieldType)return(0,s.h)(s.H,null,(0,s.h)("div",null));const l="sourceJSON"in i?i.sourceJSON?.editFieldsInfo:void 0;this.isEditorField=e===l?.creatorField||e===l?.editorField;const o=(0,n.b)(this.el);return(0,s.h)(s.H,{dir:o},(0,s.h)("div",{class:g},this.renderFieldSelection(),this.renderOperatorSelection(a),this.renderValueInput(a),this.renderTimeZone(a),this.renderHistogram(a)))}renderFieldSelection(){const{hasFocus:e,fieldName:t,showDelete:i,props:a}=this,{fields:n,strings:l}=a,o=(0,r.g)(t,a);return(0,s.h)("div",{class:p},(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",scale:"m",alignment:"icon-end-space-between",disabled:n.length<=1,iconEnd:"chevron-down",class:`${i?"field-button-trash":""} ${e?"autofocus":""}`,onClick:n.length>1?this.onFieldSelect:void 0,ref:e=>this.fieldNode=e},o?.label||""),i?(0,s.h)("calcite-action",{class:m,label:l.remove,text:"",scale:"s",icon:"trash",onClick:()=>this.arcgisFilterConditionDeleted.emit()}):null)}renderOperatorSelection(e){const{props:t}=this,{operators:i,strings:a}=t;let n=e.simpleFieldType;if(!n)return(0,s.h)(s.F,null);n===r.s.GUID&&(n=r.s.STRING),n===r.s.OID&&(n=r.s.NUMBER),(0,r.A)(e)&&(n=r.s.DOMAIN);let l=i?.get(n);this.isEditorField&&(l=l.filter((e=>!(0,r.d)(t,e.name)&&!(0,r.e)(t,e.name))));const o=l.map((e=>this.renderOperatorOption(e.name)));return(0,s.h)("calcite-select",{width:"full",scale:"m",label:a.accessibility.operator,class:v,onCalciteSelectChange:this.onOperatorSelect},o)}renderOperatorOption(e){const{operator:t}=this;return(0,s.h)("calcite-option",{value:e,label:e,selected:e===t})}renderValueInput(e){const{props:t,operator:i,invalidValue:a}=this,n=a?"invalid":void 0;let l=(0,s.h)(s.F,null);return(0,r.d)(t,i)||(0,r.e)(t,i)||(0,r.f)(t,i)?l=(0,s.h)(s.F,null):(0,r.b)(t,i)?l=this.renderUniqueValues(e):(0,r.c)(t,i)?l=this.renderInTheLast(e):e.simpleFieldType===r.s.STRING||e.simpleFieldType===r.s.GUID||(0,r.A)(e)?l=this.renderValueInputString(e,{status:n}):e.simpleFieldType===r.s.NUMBER?l=this.renderValueInputNumber(e,{status:n}):e.simpleFieldType===r.s.DATE?l=this.renderValueInputDate(e):e.simpleFieldType===r.s.DATE_ONLY?l=this.renderValueInputDateOnly(e):e.simpleFieldType===r.s.TIME_ONLY?l=this.renderValueInputTimeOnly(e):e.simpleFieldType===r.s.OID&&(l=this.renderValueInputOid(e,{status:n})),a?(0,s.h)("calcite-label",null,l,(0,s.h)("calcite-input-message",{icon:!0,status:n},a)):l}renderUniqueButton(e,t,i){const{props:a}=this,{layer:n,strings:l}=a;return e&&"imagery"!==n.type?(0,s.h)("calcite-action",{class:b,disabled:t,loading:!!i,text:l.chooseFromUnique,scale:"s",icon:"chevron-down",onClick:t?void 0:this.onSelectUniqueValue,ref:e=>{e&&(this.uniqueActionNode=e)}}):(0,s.h)(s.F,null)}renderValueInputString(e,t){const{props:i,value:a,operator:n}=this,{strings:l}=i,o=e.uniqueValuesStatus,u=e.uniqueValueInfos,d=[l.operators.stringOperatorIs,l.operators.stringOperatorIsNot].includes(n),c=d&&(o===r.x.FAILED||o===r.x.SUCCESS&&!u?.length),h=(0,r.A)(e),p=h?(0,r.B)(a,e):a,m=o===r.x.MISSING||o===r.x.IN_PROGRESS;return o===r.x.MISSING&&this.onDisplayUniqueValues(e.layerField.name),h?(0,r.a)(p)?(0,s.h)("div",{key:"value-input-string"},(0,s.h)("calcite-button",{key:p,appearance:"outline-fill",kind:"neutral",width:"full",scale:"m",alignment:"icon-end-space-between",iconEnd:m?"spinner":c?void 0:"chevron-down",disabled:c,onClick:c?void 0:this.onSelectUniqueValue,ref:e=>{e&&(this.uniqueActionNode=e)}},p?`${p}`:"")):(0,s.h)("div",{key:"value-input-string",class:f},(0,s.h)("div",{key:"value-input-string-button",class:`${I} ${S} ${o===r.x.SUCCESS?"active":"inactive"}`,tabIndex:-1,onClick:o===r.x.SUCCESS?this.onSelectUniqueValue:void 0}),this.renderUniqueButton(d,c,m)):(0,s.h)("div",{key:"value-input-string",class:f},(0,s.h)("calcite-input",{type:"text",value:p?`${p}`:"",class:I,scale:"m",label:l.accessibility.value,onCalciteInputInput:e=>this.debouncedOnValueChange(e.target),...t}),this.renderUniqueButton(d,c,m))}renderValueInputNumber(e,t){const{props:i,value:a,value2:n,operator:l}=this,{strings:o}=i,u=(0,r.F)(e);if([o.operators.numberOperatorIsBetween,o.operators.numberOperatorIsNotBetween].includes(l))return(0,s.h)("div",null,(0,s.h)("calcite-input",{type:"number",value:(0,r.a)(a)?`${a}`:"",scale:"m",step:u?"any":1,label:o.accessibility.fromValue,onCalciteInputInput:e=>this.waitOnUser(e.target,this.debouncedOnValueChangeMaybe),...t}),(0,s.h)("div",{class:`${T} first`}),(0,s.h)("calcite-input",{type:"number",value:(0,r.a)(n)?`${n}`:"",scale:"m",step:u?"any":1,class:T,label:o.accessibility.toValue,onCalciteInputInput:e=>this.waitOnUser(e.target,this.debouncedOnValue2ChangeMaybe),...t}));{const i=e.uniqueValuesStatus,n=e.uniqueValueInfos,d=[o.operators.numberOperatorIs,o.operators.numberOperatorIsNot,o.operators.numberOperatorIsAtLeast,o.operators.numberOperatorIsAtMost,o.operators.numberOperatorIsGreaterThan,o.operators.numberOperatorIsLessThan].includes(l),c=(0,s.h)("calcite-input",{class:I,type:"number",value:(0,r.a)(a)?`${a}`:"",scale:"m",step:u?"any":1,label:o.accessibility.value,onCalciteInputInput:e=>this.waitOnUser(e.target,this.debouncedOnValueChange),...t});return i===r.x.FAILED||i===r.x.SUCCESS&&!n?.length||!d?(0,s.h)("div",{key:"value-input-number"},c):i===r.x.MISSING||i===r.x.IN_PROGRESS?(i===r.x.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-number",class:f},c,this.renderUniqueButton(d,!0,!0))):(0,s.h)("div",{key:"value-input-number",class:f},c,this.renderUniqueButton(d,!e.uniqueValueInfos?.length))}}renderValueInputDate(e){const{props:t,value:i,value2:a,operator:n}=this,{layer:l,view:u,strings:d}=t,c="number"==typeof i?(0,o.f)(i,u?.timeZone,"preferredTimeZone"in l?l.preferredTimeZone??void 0:void 0):i,h=(0,o.e)(c);if([d.operators.dateOperatorIsBetween,d.operators.dateOperatorIsNotBetween].includes(n)){const e="number"==typeof a?(0,o.f)(a,u?.timeZone,"preferredTimeZone"in l?l.preferredTimeZone??void 0:void 0):a,t=(0,o.e)(e);return(0,s.h)("div",null,(0,s.h)("calcite-label",{class:C},d.startDate),(0,s.h)("calcite-input-date-picker",{class:`${q} first`,scale:"m",value:c,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValueChange(e.target),ref:e=>{e&&(this.dateNode=e)}}),(0,s.h)("calcite-input-time-picker",{class:`${q} ${I}}`,scale:"m",value:h,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValueChange(e.target),ref:e=>this.timeNode=e}),(0,s.h)("calcite-label",{class:C},d.endDate),(0,s.h)("calcite-input-date-picker",{class:`${q} first`,scale:"m",value:e,"data-value":"second",overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValue2Change(e.target),ref:e=>{e&&(this.dateNode2=e)}}),(0,s.h)("calcite-input-time-picker",{class:`${q} ${I}`,scale:"m",value:t,"data-value":"second",step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValue2Change(e.target),ref:e=>this.timeNode2=e}))}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,a=[d.operators.dateOperatorIsOn,d.operators.dateOperatorIsNotOn,d.operators.dateOperatorIsAfter,d.operators.dateOperatorIsBefore,d.operators.dateOperatorIsAfterOrEqual,d.operators.dateOperatorIsBeforeOrEqual].includes(n),l=(0,s.h)("div",{class:y},(0,s.h)("calcite-input-date-picker",{class:`${q} ${I} first`,scale:"m",value:c,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValueChange(e.target),ref:e=>{e&&(this.dateNode=e)}}),(0,s.h)("calcite-input-time-picker",{class:`${q} ${I}`,scale:"m",value:h,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValueChange(e.target),ref:e=>this.timeNode=e}));return t===r.x.FAILED||t===r.x.SUCCESS&&!i?.length||!a?(0,s.h)("div",{key:"value-input-date"},l):t===r.x.MISSING||t===r.x.IN_PROGRESS?(t===r.x.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-date",class:f},l,this.renderUniqueButton(a,!0,!0))):(0,s.h)("div",{key:"value-input-date",class:f},l,this.renderUniqueButton(a,!e.uniqueValueInfos?.length))}}renderValueInputDateOnly(e){const{props:t,value:i,value2:a,operator:n}=this,{strings:l}=t,o="number"==typeof i?new Date(i).toISOString():i;if([l.operators.dateOperatorIsBetween,l.operators.dateOperatorIsNotBetween].includes(n)){const e="number"==typeof a?new Date(a).toISOString():a;return(0,s.h)("div",null,(0,s.h)("calcite-input-date-picker",{class:`${q} first`,scale:"m",value:o,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValueChange(e.target)}),(0,s.h)("calcite-input-date-picker",{class:q,scale:"m",value:e,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValue2Change(e.target)}))}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,a=[l.operators.dateOperatorIsOn,l.operators.dateOperatorIsNotOn,l.operators.dateOperatorIsAfter,l.operators.dateOperatorIsBefore,l.operators.dateOperatorIsAfterOrEqual,l.operators.dateOperatorIsBeforeOrEqual].includes(n),u=(0,s.h)("calcite-input-date-picker",{class:`${q} ${I}`,scale:"m",value:o,overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>this.onValueChange(e.target)});return t===r.x.FAILED||t===r.x.SUCCESS&&!i?.length||!a?(0,s.h)("div",{key:"value-input-date"},u):t===r.x.MISSING||t===r.x.IN_PROGRESS?(t===r.x.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-date",class:f},u,this.renderUniqueButton(a,!0,!0))):(0,s.h)("div",{key:"value-input-date",class:f},u,this.renderUniqueButton(a,!e.uniqueValueInfos?.length))}}renderValueInputTimeOnly(e){const{props:t,value:i,value2:a,operator:n}=this,{strings:l}=t,u="number"==typeof i?(0,o.a)(i):i;if([l.operators.dateOperatorIsBetween,l.operators.dateOperatorIsNotBetween].includes(n)){const e="number"==typeof a?(0,o.a)(a):a;return(0,s.h)("div",null,(0,s.h)("calcite-input-time-picker",{class:`${q} first`,scale:"m",value:u,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValueChange(e.target)}),(0,s.h)("calcite-input-time-picker",{class:q,scale:"m",value:e,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValue2Change(e.target)}))}{const t=e.uniqueValuesStatus,i=e.uniqueValueInfos,a=[l.operators.dateOperatorIsOn,l.operators.dateOperatorIsNotOn,l.operators.dateOperatorIsAfter,l.operators.dateOperatorIsBefore,l.operators.dateOperatorIsAfterOrEqual,l.operators.dateOperatorIsBeforeOrEqual].includes(n),o=(0,s.h)("calcite-input-time-picker",{class:`${q} ${I}`,scale:"m",value:u,step:1,overlayPositioning:"fixed",onCalciteInputTimePickerChange:e=>this.onValueChange(e.target)});return t===r.x.FAILED||t===r.x.SUCCESS&&!i?.length||!a?(0,s.h)("div",{key:"value-input-time"},o):t===r.x.MISSING||t===r.x.IN_PROGRESS?(t===r.x.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-time",class:f},o,this.renderUniqueButton(a,!0,!0))):(0,s.h)("div",{key:"value-input-time",class:f},o,this.renderUniqueButton(a,!e.uniqueValueInfos?.length))}}renderValueInputOid(e,t){const{props:i,value:a,value2:n,operator:l}=this,{strings:o}=i;if(e.simpleFieldType===r.s.OID)if((0,r.a)(a)&&(0,r.a)(n)){const e=Math.round(a),t=Math.round(n);e===a&&t===n||this.changeValues(e,t)}else if((0,r.a)(a)){const e=Math.round(a);e!==a&&this.changeValues(e,n)}else if((0,r.a)(n)){const e=Math.round(n);e!==n&&this.changeValues(a,e)}if([o.operators.numberOperatorIsBetween,o.operators.numberOperatorIsNotBetween].includes(l))return(0,s.h)("div",null,(0,s.h)("calcite-input",{type:"number",value:(0,r.a)(a)?`${a}`:"",scale:"m",min:0,step:1,label:o.accessibility.fromValue,onCalciteInputInput:e=>this.waitOnUser(e.target,this.debouncedOnValueChangeMaybe),...t}),(0,s.h)("div",{class:`${T} first`}),(0,s.h)("calcite-input",{type:"number",value:(0,r.a)(n)?`${n}`:"",scale:"m",min:0,step:1,class:T,label:o.accessibility.toValue,onCalciteInputInput:e=>this.waitOnUser(e.target,this.debouncedOnValue2ChangeMaybe),...t}));{const i=e.uniqueValuesStatus,n=e.uniqueValueInfos,u=[o.operators.numberOperatorIs,o.operators.numberOperatorIsNot,o.operators.numberOperatorIsAtLeast,o.operators.numberOperatorIsAtMost,o.operators.numberOperatorIsGreaterThan,o.operators.numberOperatorIsLessThan].includes(l),d=(0,s.h)("calcite-input",{class:I,type:"number",value:(0,r.a)(a)?`${a}`:"",scale:"m",min:0,step:1,label:o.accessibility.value,onCalciteInputInput:e=>this.waitOnUser(e.target,this.debouncedOnValueChange),...t});return i===r.x.FAILED||i===r.x.SUCCESS&&!n?.length||!u?(0,s.h)("div",{key:"value-input-oid"},d):i===r.x.MISSING||i===r.x.IN_PROGRESS?(i===r.x.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-oid",class:f},d,this.renderUniqueButton(u,!0,!0))):(0,s.h)("div",{key:"value-input-oid",class:f},d,this.renderUniqueButton(u,!e.uniqueValueInfos?.length))}}renderUniqueValues(e){const{props:t,values:i,fieldName:a}=this,{strings:n}=t,l=e.uniqueValuesStatus,o=e.uniqueValueInfos;if(l===r.x.MISSING||l===r.x.IN_PROGRESS)return l===r.x.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",null,(0,s.h)("calcite-loader",{class:L,inline:!0,label:""}));if(l===r.x.FAILED)return(0,s.h)("div",{class:V},(0,s.h)("calcite-button",{appearance:"transparent",width:"full",scale:"m",alignment:"center",class:N,disabled:!0,label:n.selectValues},n.selectValues),n.errors.errorUniqueValues);{const t=(0,s.h)("div",{class:V},!i?.length&&o?.length?n.selectOneValue:"");let l;o?.length||(l=(0,s.h)("div",{class:V},n.errors.noUniqueValues));const r=i?.map((t=>this.renderSelectedUniqueValue(t,e)));return(0,s.h)("div",null,t,(0,s.h)("calcite-button",{appearance:"transparent",width:"full",scale:"m",alignment:"center",class:N,disabled:!o?.length,onClick:o?.length?this.onSelectUniqueValues:void 0,ref:e=>this.uniqueSelectNode=e,label:n.selectValues},n.selectValues),l,i?.length?(0,s.h)("calcite-list",{key:`unique-values-list-${a}`,class:F,ref:this.afterCreateList,label:n.values},r):null)}}renderSelectedUniqueValue(e,t){const{props:i}=this,{view:a,strings:n,modules:l}=i,u=a?.timeZone||"system",d=(0,r.A)(t)?(0,r.B)(e,t):(0,r.k)(t)?(0,o.g)(e,u,l.intl):(0,r.m)(t)?(0,o.b)(e,l.intl):(0,r.n)(t)?(0,o.c)(e,l.intl):(0,r.j)(t)?l.intl.formatNumber(e):e;return(0,s.h)("calcite-list-item",{label:`${d}`,value:`${e}`},(0,s.h)("calcite-action",{slot:"actions-end",text:n.remove,icon:"x",onClick:this.onRemoveSelectedValue.bind(this,e)}))}renderInTheLast(e){const{props:t,value:i,unit:a}=this,{strings:n}=t,l=(0,r.m)(e);return(0,s.h)("div",{class:E},(0,s.h)("calcite-input-number",{inputMode:"decimal",min:1,integer:!0,value:(0,r.a)(i)?`${i}`:"",class:O,label:n.accessibility.value,onCalciteInputNumberInput:e=>this.onValueChange(e.target)}),(0,s.h)("calcite-select",{width:"full",scale:"m",label:n.accessibility.units,class:x,onCalciteSelectChange:this.onUnitSelect},!l&&this.renderInTheLastOption(r.C.MINUTE,a===r.C.MINUTE),!l&&this.renderInTheLastOption(r.C.HOUR,a===r.C.HOUR),this.renderInTheLastOption(r.C.DAY,a===r.C.DAY),this.renderInTheLastOption(r.C.WEEK,a===r.C.WEEK),this.renderInTheLastOption(r.C.MONTH,a===r.C.MONTH),this.renderInTheLastOption(r.C.YEAR,a===r.C.YEAR)))}renderInTheLastOption(e,t){const{props:i}=this,{strings:a}=i;return(0,s.h)("calcite-option",{value:e,label:a.units[e],selected:t})}renderTimeZone(e){const{props:t}=this,{view:i,strings:a}=t;if(e.simpleFieldType!==r.s.DATE)return(0,s.h)(s.F,null);const n=i&&"system"!==i.timeZone?"unknown"===i.timeZone?a.timeZoneUnknown:void 0:a.timeZoneSystem;return(0,s.h)("calcite-label",{class:w,scale:"s",layout:"inline",alignment:"start"},(0,s.h)("calcite-icon",{icon:"time-zone",scale:"s",class:U}),n||(0,s.h)("calcite-input-time-zone",{mode:"region","read-only":!0,value:i?.timeZone,tabindex:"-1"}))}renderHistogram(e){const{props:t,histogramClosed:i,operator:a,fieldName:n}=this,{layer:l,strings:o}=t;return"imagery"===l.type?(0,s.h)(s.F,null):e?.simpleFieldType?e.statisticsStatus===r.x.FAILED?(0,s.h)(s.F,null):(0,r.D)(n,a,t)?((void 0===i||!i&&e.histogramStatus===r.x.MISSING)&&this.onHistogramOpen(),(0,s.h)("calcite-block-section",{open:!0!==i,text:e.histogramStatus===r.x.FAILED?o.valueRange:o.histogram,onCalciteBlockSectionToggle:this.onHistogramBlockToggle},this.renderHistogramContent(e))):(0,s.h)(s.F,null):(0,s.h)(s.F,null)}renderHistogramContent(e){const{histogramClosed:t}=this,i=e.layerField.name;if(!0===t)return(0,s.h)(s.F,null);if(e.statistics&&e.histogramStatus!==r.x.IN_PROGRESS){return this.prepareSlider(e)?(0,s.h)("div",{key:`histogram-content-${i}-${e.statistics}`,class:`${D} ${e.histogram?"":"slim"}`,ref:this.afterCreateSliderDiv,dir:(0,n.b)(this.el)}):(0,s.h)(s.F,null)}return(0,s.h)("div",{key:`histogram-content-${i}-${e.statistics}`,class:`${D} ${e.histogram?"":"slim"}`},(0,s.h)("calcite-loader",{class:L,inline:!0,label:""}))}setFocus(){setTimeout((()=>{const e=this.el.querySelector(".autofocus");e?.setFocus()}),500)}onSelectUnique(e){const{props:t,value:i,values:n,fieldName:l,uid:o,uniqueValuesSortBy:u}=this,{strings:d,modules:c}=t;if(this.uniquePopoverNode)return void this.closeFilterPopoversHandler();this.closeFilterPopoversHandler();const h=(0,r.g)(l,t);if(!h)return;const p=this.fieldNode?.getBoundingClientRect().width,m=p?p+2:204,g=(0,a.q)(this.el,"calcite-panel")||(0,a.q)(this.el,"calcite-flow-item"),v=g?.clientHeight,f=v?Math.max(Math.min(v/3,400),200):400,y=document.createElement("calcite-popover");y.id=`arcgis-filter-unique-popover_${o}`,y.placement="bottom-end",y.offsetDistance=0,y.offsetSkidding=0,y.pointerDisabled=!0,y.overlayPositioning="fixed",y.triggerDisabled=!0,y.referenceElement=e?this.uniqueSelectNode:this.uniqueActionNode;const I=document.createElement("arcgis-filter-unique-list");I.uid=o,I.props=t,I.uniqueValues=c.esriLang.clone(h.uniqueValueInfos),I.selectedValues=e?n:i?[i]:[],I.fieldDomains=h.fieldDomains,I.layerFieldType=h.layerField.type,I.multiple=e,I.sortBy=u,I.partialUniqueValues=h.partialUniqueValues,I.maxHeight=f,I.strings=d,I.style=`width: ${m}px`,y.appendChild(I),document.body.appendChild(y),(0,s.f)(I),I.setFocus(),y.reposition(),this.uniquePopoverNode=y,setTimeout((()=>{y.open=!0,document.addEventListener("click",this.onDocumentClickBind)}),50)}scrollExprIntoView(e){setTimeout((()=>{e&&(e=(0,a.q)(e,".filter-expression"),e?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}),100)}removeUniquePopover(){document.removeEventListener("click",this.onDocumentClickBind),this.uniquePopoverNode&&(this.uniquePopoverNode.open=!1,this.uniquePopoverNode?.parentElement?.removeChild(this.uniquePopoverNode),this.uniquePopoverNode=void 0)}async onDisplayUniqueValues(e){const{props:t}=this,{layer:i,view:a,mode:n,modules:l}=t,o=(0,r.g)(e,t);if(o&&"imagery"!==i.type&&o.uniqueValuesStatus===r.x.MISSING&&i){o.uniqueValuesStatus=r.x.IN_PROGRESS;try{const s=await l.uniqueValues({layer:i,view:a,field:e,forBinning:"feature-reduction"===n&&["binning","cluster"].includes(i.featureReduction?.type)}),u=(0,r.j)(o),d=s.uniqueValueInfos.filter((e=>!!(0,r.a)(e.value)&&("string"===o.simpleFieldType&&!u||"guid"===o.simpleFieldType?"<Null>"!==e.value&&""!==`${e.value}`.trim():("number"===o.simpleFieldType||o.simpleFieldType,"<Null>"!==e.value&&""!==e.value))));d.sort(((e,t)=>e.count>t.count?-1:e.count<t.count?1:0)),(0,r.A)(o)&&o.fieldDomains.forEach((e=>{d.find((t=>t.value===e.code))||d.push({value:e.code,count:0})}));const c=2e3===s.uniqueValueInfos.length;t.fields=t.fields.map((t=>t.layerField.name===e?{...t,uniqueValueInfos:d,uniqueValuesStatus:r.x.SUCCESS,partialUniqueValues:c}:t)),this.arcgisValuesReturned.emit(o.layerField.name)}catch(i){if(console.error("error-uniqueValues",i),(0,r.A)(o)){const i=[];o.fieldDomains.forEach((e=>{i.find((t=>t.value===e.code))||i.push({value:e.code,count:void 0})})),t.fields=t.fields.map((t=>t.layerField.name===e?{...t,uniqueValueInfos:i,uniqueValuesStatus:r.x.SUCCESS,partialUniqueValues:!1}:t))}else t.fields=t.fields.map((t=>t.layerField.name===e?{...t,uniqueValuesStatus:r.x.FAILED}:t));(0,s.f)(this.el)}}}async onHistogramOpen(){const{props:e,fieldName:t}=this,{layer:i,view:a,mode:n,modules:l}=e,o=(0,r.g)(t,e);if(i&&"imagery"!==i.type&&o){if("subtype-group"===i.type)return e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:r.x.FAILED,histogramStatus:r.x.FAILED}:e)),this.histogramClosed=!0,void(0,s.f)(this.el);if(o.statistics)this.checkDefaultValues(o),this.histogramClosed=!1;else if(!o.statistics){e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:r.x.IN_PROGRESS}:e));try{const u=await l.summaryStatistics({layer:i,view:a,field:t,forBinning:"feature-reduction"===n&&["binning","cluster"].includes(i.featureReduction?.type),outStatisticTypes:{exclude:["median"]}});if(!(0,r.a)(u.avg)||!(0,r.a)(u.min)||!(0,r.a)(u.max))return e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:r.x.FAILED}:e)),void(this.histogramClosed=!0);u.min===u.max&&(u.min>0?(u.min=u.min-.1*u.min,u.max=u.max+.1*u.max):u.min<0?(u.min=u.min+.1*u.min,u.max=u.max-.1*u.max):(u.min=-1,u.max=1)),e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statistics:u,statisticsStatus:r.x.SUCCESS}:e)),this.checkDefaultValues(o);try{const o=await l.histogram({layer:i,view:a,field:t,numBins:30,minValue:u.min,maxValue:u.max,forBinning:"feature-reduction"===n&&["binning","cluster"].includes(i.featureReduction?.type)});e.fields=e.fields.map((e=>e.layerField.name===t?{...e,histogram:o,histogramStatus:r.x.SUCCESS}:e)),(0,s.f)(this.el)}catch(i){console.error("error-histogram",i),e.fields=e.fields.map((e=>e.layerField.name===t?{...e,histogramStatus:r.x.FAILED}:e)),(0,s.f)(this.el)}}catch(i){console.error("error-summaryStatistics",i),e.fields=e.fields.map((e=>e.layerField.name===t?{...e,statisticsStatus:r.x.FAILED,histogramStatus:r.x.FAILED}:e)),this.histogramClosed=!0,(0,s.f)(this.el)}}}}onHistogramClose(){this.histogramClosed=!0}async onMinMaxChange(e,t,i){const{props:a,value:n,value2:l}=this,{layer:o,view:u,mode:d,modules:c}=a,h=(0,r.g)(i,a);if(h&&"imagery"!==o.type){this.value=Math.min(Math.max(n,e),t),(0,r.a)(l)&&(this.value2=Math.min(Math.max(l,e),t)),this.histogramClosed=!1,a.fields=a.fields.map((e=>e.layerField.name===i?{...e,histogramStatus:r.x.IN_PROGRESS}:e));try{const n=await c.histogram({layer:o,view:u,field:h.layerField.name,numBins:30,minValue:e,maxValue:t,forBinning:"feature-reduction"===d&&["binning","cluster"].includes(o.featureReduction?.type)});a.fields=a.fields.map((e=>e.layerField.name===i?{...e,histogram:n,histogramStatus:r.x.SUCCESS}:e)),(0,s.f)(this.el)}catch(e){console.error("error-histogram",e),a.fields=a.fields.map((e=>e.layerField.name===i?{...e,histogramStatus:r.x.FAILED}:e))}}}adjustHistogramMinMax(e){const{histogramSlider:t}=this;t&&(t.min>e&&t.set({min:e}),t.max<e&&t.set({max:e}))}prepareSlider(e){const{histogramSliderFieldName:t,props:i}=this,{modules:s}=i;let{value:a,value2:n,histogramSlider:l}=this;const o=e.statistics;if(e.histogramStatus===r.x.IN_PROGRESS)return!1;(0,r.a)(a)&&"number"!=typeof a&&(a=void 0),(0,r.a)(n)&&"number"!=typeof n&&(n=void 0),this.checkDefaultValues(e);const u=[];if(u.push(a),(0,r.a)(n)&&u.push(n),(0,r.z)(e)){if((0,r.a)(u[0])){const e=Math.round(u[0]);e!==u[0]&&this.changeValues(e,n),u[0]=e}if((0,r.a)(u[1])){const e=Math.round(u[1]);e!==u[1]&&this.changeValues(a,e),u[1]=e}}let d=e.histogram?e.histogram.minValue:o.min,c=e.histogram?e.histogram.maxValue:o.max;if((0,r.a)(u[0])&&(0,r.a)(u[1])?(d=Math.min(d,u[0]),c=Math.max(c,u[1])):(0,r.a)(u[0])&&(d=Math.min(d,u[0]),c=Math.max(c,u[0])),l&&t!==e.layerField.name&&(l.destroy(),l=void 0),l){const t={bins:e.histogram?.bins,average:Math.round(10*o.avg)/10,min:d,max:c,values:void 0===u?.[0]?void 0:u,rangeType:this.getSliderRangeType()};l.set(t)}else{const t={bins:e.histogram?.bins,average:Math.round(10*o.avg)/10,min:d,max:c,values:void 0===u?.[0]?void 0:u,rangeType:this.getSliderRangeType(),precision:(0,r.z)(e)?0:4};[r.s.DATE,r.s.DATE_ONLY,r.s.TIME_ONLY].includes(e.simpleFieldType)&&(t.hasTimeData=!0,this.addDateFormatFunctions(t,e)),this.histogramSliderFieldName=e.layerField.name,this.histogramSlider=new s.HistogramRangeSlider(t),this.createSliderChangeEvents(e)}return!0}createSliderChangeEvents(e){const{histogramSlider:t}=this;t&&(t.on("min-change",(i=>{const s=t;this.onMinMaxChange(i.value,s.max,e.layerField.name)})),t.on("max-change",(i=>{const s=t;this.onMinMaxChange(s.min,i.value,e.layerField.name)})),t.watch("values",(()=>{const i=t;let s=i.values?.[0],a=i.values?.[1];[r.s.DATE,r.s.DATE_ONLY,r.s.TIME_ONLY].includes(e.simpleFieldType)&&(s=Math.round(s)),(0,r.z)(e)&&(a||0===s?(s=Math.floor(s),a=Math.ceil(a)):s=Math.round(s)),this.changeValues(s,a)})),t.on("segment-drag",(()=>{const i=t;let s=i.values[0],a=i.values[1];(0,r.z)(e)&&(a||0===s?(s=Math.floor(s),a=Math.ceil(a)):s=Math.round(s)),this.changeValues(s,a)})))}getSliderRangeType(){const{props:e,operator:t}=this,{strings:i}=e;switch(t){case i.operators.numberOperatorIs:case i.operators.dateOperatorIsOn:return"equal";case i.operators.numberOperatorIsNot:case i.operators.dateOperatorIsNotOn:return"not-equal";case i.operators.numberOperatorIsLessThan:case i.operators.dateOperatorIsBefore:return"less-than";case i.operators.numberOperatorIsGreaterThan:case i.operators.dateOperatorIsAfter:return"greater-than";case i.operators.numberOperatorIsAtMost:case i.operators.dateOperatorIsBeforeOrEqual:return"at-most";case i.operators.numberOperatorIsAtLeast:case i.operators.dateOperatorIsAfterOrEqual:return"at-least";case i.operators.numberOperatorIsBetween:case i.operators.dateOperatorIsBetween:return"between";case i.operators.numberOperatorIsNotBetween:case i.operators.dateOperatorIsNotBetween:return"not-between";default:return""}}getNewValue(e){const{fieldName:t,props:i}=this,{layer:s,view:a}=i,n=e;let l;if("CALCITE-INPUT-DATE-PICKER"===n?.tagName||"CALCITE-INPUT-TIME-PICKER"===n?.tagName){const e=(0,r.g)(t,i),u=n.getAttribute("data-value");if("CALCITE-INPUT-DATE-PICKER"===n?.tagName){if(l=n.value,!l)return;l=e.simpleFieldType===r.s.DATE?(0,o.d)(`${l} ${"second"===u?this.timeNode2?.value:this.timeNode?.value}`,s.fieldsIndex.getTimeZone(t),a?.timeZone,"preferredTimeZone"in s?s.preferredTimeZone??void 0:void 0):(0,o.h)(l)}else{if(l=n.value,!l)return;l=e.simpleFieldType===r.s.DATE?(0,o.d)(`${"second"===u?this.dateNode2?.value:this.dateNode?.value} ${l}`,s.fieldsIndex.getTimeZone(t),a?.timeZone,"preferredTimeZone"in s?s.preferredTimeZone??void 0:void 0):(0,o.t)(l)}}else if("CALCITE-INPUT"===n?.tagName&&"number"===n.type||"CALCITE-INPUT-NUMBER"===n?.tagName){if(l=n.value,!l)return;l=Number.parseFloat(l)}else"CALCITE-INPUT"===n?.tagName&&(l=n.value,l?.length||(l=void 0));return l}addDateFormatFunctions(e,t){const{props:i}=this,{view:s,modules:a}=i,n=s?.timeZone||"system";e.labelFormatFunction=e=>t.simpleFieldType===r.s.DATE?(0,o.g)(e,n,a.intl,"short-date"):t.simpleFieldType===r.s.DATE_ONLY?(0,o.b)(e,a.intl):(0,o.c)(e,a.intl)}changeValues(e,t){const{props:i,fieldName:s}=this,a=(0,r.g)(s,i),n=a.simpleFieldType&&[r.s.NUMBER,r.s.DATE,r.s.OID].includes(a.simpleFieldType)&&Number.isNaN(e)?void 0:e,l=a.simpleFieldType&&[r.s.NUMBER,r.s.DATE,r.s.OID].includes(a.simpleFieldType)&&Number.isNaN(t)?void 0:t;this.value===n&&this.value2===l||this.emitChangeEvent({value:n??void 0,value2:l??void 0})}checkDefaultValues(e){const{props:t,operator:i,value:s,value2:a,histogramSlider:n}=this,l=e.statistics,o=(0,r.r)(t,e,i);if((0,r.c)(t,i)){if(!(0,r.a)(s)){let e,t;if(l){const i=(new Date).getTime(),s=Math.abs(i-l.avg);s>2*r.G.YEAR?(e=Math.round(s/r.G.YEAR),t=r.C.YEAR):s>2*r.G.MONTH?(e=Math.round(s/r.G.MONTH),t=r.C.MONTH):s>2*r.G.WEEK?(e=Math.round(s/r.G.WEEK),t=r.C.WEEK):s>2*r.G.DAY?(e=Math.round(s/r.G.DAY),t=r.C.DAY):s>2*r.G.HOUR?(e=Math.round(s/r.G.HOUR),t=r.C.HOUR):(e=Math.round(s/r.G.MINUTE),t=r.C.MINUTE)}else e=1,t=r.C.YEAR;this.emitChangeEvent({value:e,unit:t})}}else if((0,r.i)(t,i))if((0,r.a)(s))if((0,r.a)(a))a<s&&(n&&n.values[0]===s?this.changeValues(s,s):this.changeValues(a,a));else{const t=l?.max??s+1,i=(0,r.z)(e)?Math.round(t):t;this.changeValues(s,i)}else if((0,r.a)(a)){const i=l?(0,r.E)(l.avg,t,e):a-1;this.changeValues(i,a)}else this.changeValues(o.value,o.value2);else(0,r.a)(s)||this.changeValues(o.value,o.value2);return o}openFieldPickList(){const{props:e,fieldName:t,fieldPickListSortBy:i}=this,{layer:s,view:a,insideDialog:n,mode:l,panelNode:r}=e;this.closeFilterPopoversHandler();const o=r?.getBoundingClientRect().width||240,u=Math.min(Math.round(o),500),d=-1*Math.round(u+(o-u)/2);this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps={placement:"leading",offsetDistance:d,offsetSkidding:0,pointerDisabled:!0,popoverWidth:u,overlayPositioning:"fixed",triggerDisabled:!0,refElement:r,zIndex:n?900:"effects"===l?101:void 0},this.arcgisFieldPickList.fields=this.createPickListFields(),this.arcgisFieldPickList.layer=s,this.arcgisFieldPickList.mapView=a,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!1,this.arcgisFieldPickList.selectedFields=[t],this.arcgisFieldPickList.sortBy=i??"default",this.arcgisFieldPickList.showFieldInfo="feature-reduction"!==l,this.arcgisFieldPickList.addEventListener("arcgisClose",this.fieldPickListChanges),this.arcgisFieldPickList.addEventListener("arcgisSortByChange",(e=>this.fieldPickListSortBy=e.detail)),document.body.appendChild(this.arcgisFieldPickList),this.arcgisFieldPickList.setFocus(),this.disablePanel.emit(!0)}createPickListFields(){const{props:e}=this,{fields:t}=e;return t.map((e=>({name:e.layerField.name,alias:e.label,type:e.simpleFieldType})))}removeFieldsPickList(){this.disablePanel.emit(!1),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=void 0,setTimeout((()=>this.fieldNode?.setFocus()),1))}afterFieldSelect(e){const{props:t,fieldName:i,operator:s,histogramClosed:a}=this,{strings:n}=t,l=(0,r.g)(i,t),o=(0,r.g)(e,t);let u;const d=(0,r.H)(t,l,o,s),c=(0,r.g)(e,t);c.simpleFieldType===r.s.STRING&&c.uniqueValuesStatus===r.x.SUCCESS&&c.uniqueValueInfos?.length&&[n.operators.stringOperatorIs,n.operators.stringOperatorIsNot].includes(d)&&(u=c.uniqueValueInfos[0].value??void 0),this.emitChangeEvent({hasFocus:!0,fieldName:e,operator:d,value:u,value2:void 0,values:void 0,uniqueValuesSortBy:void 0,histogramClosed:o.simpleFieldType&&![r.s.NUMBER,r.s.DATE,r.s.DATE_ONLY,r.s.TIME_ONLY].includes(o.simpleFieldType)||o.statisticsStatus===r.x.FAILED?void 0:!0===a&&l.statisticsStatus!==r.x.FAILED||void 0})}emitChangeEvent(e){const{uid:t,fieldName:i,operator:s,uniqueValuesSortBy:a,value:n,value2:l,values:o,unit:u,histogramClosed:d,hasFocus:c,props:h}=this,p=(0,r.c)(h,s)&&e.unit&&u&&e.unit!==u,m={uid:t,fieldName:e.fieldName||i,operator:e.operator||s,uniqueValuesSortBy:void 0===e.uniqueValuesSortBy?void 0:e.uniqueValuesSortBy||a,value:p?e.value??n:void 0===e.value?void 0:e.value??n,value2:void 0===e.value2?void 0:e.value2??l,values:void 0===e.values?void 0:e.values||o,unit:e.unit||u,histogramClosed:void 0===e.histogramClosed?void 0:e.histogramClosed||d,hasFocus:e.hasFocus||c};this.arcgisFilterConditionChanged.emit(m)}waitOnUser(e,t){this.typingHndl&&(clearTimeout(this.typingHndl),this.typingHndl=void 0);const i=e.value,s=Number.parseFloat(i);i?i.startsWith("-")&&(0===s||Number.isNaN(s))||t(e):this.typingHndl=setTimeout((()=>{this.typingHndl=void 0,t(e)}),2e3)}get el(){return(0,s.a)(this)}};k.style='.field-selection {\n  display: flex;\n  align-items: normal;\n}\n.delete-action {\n  padding: 0 0 0 4px;\n}\n:dir(rtl) {\n  .delete-action {\n    padding: 0 4px 0 0;\n  }\n}\n.operator-dropdown {\n  width: 100%;\n  margin: 5px 0;\n}\n.input-plus-unique {\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n}\n.input-plus-unique-date {\n  width: 100%;\n}\n.input {\n  width: 100%;\n}\n.blank-button {\n  height: 22px;\n  border: var(--calcite-color-border-input) 1px solid;\n}\n.blank-button.active {\n  cursor: pointer;\n}\n.blank-button.inactive:focus {\n  outline: none;\n}\n.select-unique-button {\n  height: 32px;\n  border-top: var(--calcite-color-border-input) 1px solid;\n  border-bottom: var(--calcite-color-border-input) 1px solid;\n  border-right: var(--calcite-color-border-input) 1px solid;\n}\n:dir(rtl) {\n  .select-unique-button {\n    border-right: none;\n    border-left: var(--calcite-color-border-input) 1px solid;\n  }\n}\n.between-values-input.first {\n  margin-bottom: 5px;\n}\n.select-values {\n  margin-bottom: 4px;\n}\n.field-button-trash {\n  /* button with trash action */\n  inline-size: calc(100% - 36px);\n}\n.list {\n  max-height: 200px;\n  overflow-y: auto;\n}\n.unique-values-content-list-msg {\n  font-size: 90%;\n  margin-top: 5px;\n  margin-bottom: 5px;\n}\n.in-the-last {\n  display: flex;\n}\n.in-the-last-count {\n  width: 50%;\n}\n.in-the-last-unit {\n  width: 50%;\n}\n.date-picker {\n  width: 100%;\n}\n.date-picker.first {\n  margin-bottom: 5px;\n}\n.label {\n  margin-top: 10px;\n}\n.time-zone {\n  margin-top: 5px;\n}\n.time-zone-icon {\n  opacity: 60%;\n}\n.histogram-content {\n  height: 120px;\n  overflow: hidden;\n  margin: var(--calcite-spacing-xs) calc(-1 * var(--calcite-spacing-xl)) calc(-1 * var(--calcite-spacing-md-plus))\n    calc(-1 * var(--calcite-spacing-xl));\n  padding: 0 var(--calcite-spacing-xl) var(--calcite-spacing-md-plus) var(--calcite-spacing-xl);\n}\n.histogram-content.slim {\n  height: 40px;\n}\n.small-loader {\n  margin-left: calc((100% - 16px) / 2);\n  margin-top: 10px;\n}\nhtml[dir="rtl"] .small-loader {\n  margin-left: auto;\n  margin-right: 8px;\n}\ncalcite-input-time-zone[read-only] {\n  --calcite-color-border-input: transparent;\n  --calcite-color-background: transparent;\n  --calcite-font-weight-medium: normal;\n  pointer-events: none;\n\n  margin-left: -10px;\n}\n:dir(rtl) {\n  calcite-input-time-zone[read-only] {\n    margin-left: auto;\n    margin-right: -10px;\n  }\n}\n';const P="container",A="popover-unique-list",M="unique-values-content-list-msg",B="count",R="unique-values-done",$=class{constructor(e){(0,s.r)(this,e),this.arcgisDone=(0,s.c)(this,"arcgisDone",7),this.arcgisFilterUniqueListDone=(0,s.c)(this,"arcgisFilterUniqueListDone",7),this.arcgisChanged=(0,s.c)(this,"arcgisChanged",7),this.arcgisFilterUniqueListChanged=(0,s.c)(this,"arcgisFilterUniqueListChanged",7),this.arcgisSortByChanged=(0,s.c)(this,"arcgisSortByChanged",7),this.arcgisFilterUniqueListSortByChanged=(0,s.c)(this,"arcgisFilterUniqueListSortByChanged",7),this.manager=(0,c.u)(this),this.strings=(0,h.u)({blocking:!0,name:"filter"}),this.onSortMenuSelect=e=>{const t=e.currentTarget,i=t.selectedItems?.[0].getAttribute("data-value");this.sortBy=i||void 0,this.arcgisFilterUniqueListSortByChanged.emit({uid:this.uid,sortBy:i||void 0}),this.arcgisSortByChanged.emit({uid:this.uid,sortBy:i||void 0})},this.done=()=>{this.arcgisFilterUniqueListDone.emit(this.uid),this.arcgisDone.emit(this.uid)},this.uid=void 0,this.props=void 0,this.uniqueValues=void 0,this.selectedValues=void 0,this.fieldDomains=void 0,this.layerFieldType=void 0,this.sortBy=void 0,this.multiple=!1,this.partialUniqueValues=!1,this.maxHeight=void 0,this.initialRender=!0}async setFocus(){this.listNode?.setFocus()}async componentWillLoad(){const{props:e}=this,{modules:t}=e;t||(e.strings=this.strings,e.modules={intl:await(0,u.z)()})}componentDidLoad(){setTimeout((()=>this.initialRender=!1),300)}render(){const{uid:e,uniqueValues:t,selectedValues:i,layerFieldType:a,fieldDomains:n,sortBy:l,multiple:r,partialUniqueValues:u,maxHeight:d,initialRender:c,props:h}=this,{strings:p}=h,m=["small-integer","big-integer","integer","single","double","long"].includes(a),g=["date","date-only","time-only"].includes(a);(e=>{const t=n?.length;e.sort(((e,i)=>{if(!t&&m)return("string"==typeof e.value?Number.parseFloat(e.value):e.value)-("string"==typeof i.value?Number.parseFloat(i.value):i.value);{const s=t?this.getDecodedValue(e.value):e.value,a=t?this.getDecodedValue(i.value):i.value;return`${s}`.startsWith("_")?1:`${a}`.startsWith("_")?-1:`${s}`.localeCompare(`${a}`)}}))})(t),l&&"count"!==l?"selected"===l&&((e,t)=>{e.sort(((e,i)=>{const s=t?.indexOf(e.value)??-1,a=t?.indexOf(i.value)??-1;return s===a||s>-1&&a>-1?0:s>a?-1:1}))})(t,i):(e=>{e.sort(((e,t)=>e.count<=t.count?1:-1))})(t);const v=t.map((e=>this.renderUniqueValue(e)));let f;return u&&!c&&(f=(0,s.h)("div",{class:M},p.errors.tooManyUniqueValues)),(0,s.h)(s.H,null,(0,s.h)("div",{class:P},(0,s.h)("calcite-list",{label:p.values,class:A,filterEnabled:t.length>10,selectionMode:r?"multiple":"single","filter-placeholder":p.searchValues,onCalciteListChange:t=>{let i=t.target.selectedItems.map((e=>e.value));n||"date-only"!==a?n||"time-only"!==a?["date","oid","guid","small-integer","big-integer","integer","long"].includes(a)?i=i?.map((e=>Number.parseInt(e))):["single","double"].includes(a)&&(i=i?.map((e=>Number.parseFloat(e)))):i=i?.map((e=>(0,o.t)(e))):i=i?.map((e=>(0,o.h)(e))),this.isSameLists(i,this.selectedValues)||(this.selectedValues=i,this.arcgisFilterUniqueListChanged.emit({uid:e,multiple:r,selectedValues:i,sortBy:l}),this.arcgisChanged.emit({uid:e,multiple:r,selectedValues:i,sortBy:l}))},ref:e=>{this.listNode=e,d&&e?.setAttribute("style",`max-height: ${d||400}px`)}},t.length>10&&!c?this.renderSort(m,g):null,v),f,this.renderDone()))}renderSort(e,t){const{sortBy:i,props:a}=this,{strings:n}=a;return(0,s.h)("calcite-dropdown",{slot:"filter-actions-end",placement:"bottom-end",overlayPositioning:"fixed",widthScale:"s",onCalciteDropdownSelect:this.onSortMenuSelect},(0,s.h)("calcite-action",{slot:"trigger",label:n.sortValues,text:""},(0,s.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("calcite-dropdown-item",{selected:"count"===i||!(0,r.a)(i),"data-value":"count"},n.sortByCount),(0,s.h)("calcite-dropdown-item",{selected:"name"===i,"data-value":"name"},e||t?n.sortAscending:n.sortAlphabetical),(0,s.h)("calcite-dropdown-item",{selected:"selected"===i,"data-value":"selected"},n.sortSelected)))}renderUniqueValue(e){const{selectedValues:t,fieldDomains:i,layerFieldType:a,uniqueValues:n,initialRender:l,props:u}=this,{view:d,modules:c}=u,h=d?.timeZone||"system",p=i?.length?this.getDecodedValue(e.value):a===r.s.DATE?(0,o.g)(e.value,h,c.intl):a===r.s.DATE_ONLY?(0,o.b)(e.value,c.intl):a===r.s.TIME_ONLY?(0,o.c)(e.value,c.intl):"number"==typeof e.value?c.intl.formatNumber(e.value):e.value,m=!!t&&(a===r.s.DATE_ONLY?t.includes((0,o.h)(e.value)):a===r.s.TIME_ONLY?t.includes((0,o.t)(e.value)):t.includes(e.value));return(0,s.h)("calcite-list-item",{key:`list-item_${e.value}`,label:`${p}`,value:`${e.value}`,selected:m},(0,r.a)(e.count)&&(n.length>200&&!l||n.length<=200)?(0,s.h)("div",{class:B,slot:"actions-end"},`${e.count}`):null)}renderDone(){const{multiple:e,props:t}=this,{strings:i}=t;return e?(0,s.h)("div",{class:R},(0,s.h)("calcite-button",{appearance:"outline-fill",width:"full",onClick:this.done,label:i.done},i.done)):null}getDecodedValue(e){const{fieldDomains:t}=this,i=t;if(i){let t="";for(let s=0;s<i.length;s++){const a=i[s];a.code==e&&(t+=(t.length?" | ":"")+a.name)}return t.length||(t=`${e}`),t}return e}isSameLists(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e?.length!==t?.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}get el(){return(0,s.a)(this)}};$.style=":host{width:100%}.container{min-height:30px}.popover-unique-list{width:100%;overflow-y:auto}.unique-values-content-list-msg{font-size:75%;margin:5px}.count{padding:0 6px;font-size:smaller;white-space:nowrap}.unique-values-done{padding:0.5rem}"}}]);