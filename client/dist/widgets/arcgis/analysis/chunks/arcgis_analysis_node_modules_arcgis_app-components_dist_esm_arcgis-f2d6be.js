/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be"],{46456:(e,t,a)=>{a.r(t),a.d(t,{arcgis_categorize_items:()=>d});var i=a(87849),r=a(38295),n=a(90310),o=a(37362),s=a(4429),l=a(64099),c=a(80619);a(50637),a(59317),a(37762),a(931),a(93814),a(87744),a(51102),a(56175),a(50822),a(83929),a(68194),a(15332),a(81034);const d=class{constructor(e){(0,i.r)(this,e),this.arcgisCategorizeItemsCancel=(0,i.c)(this,"arcgisCategorizeItemsCancel",7),this.arcgisCategorizeItemsSubmit=(0,i.c)(this,"arcgisCategorizeItemsSubmit",7),this.closeDialog=()=>{this.arcgisCategorizeItemsCancel.emit()},this.handleCategorySelected=({paths:e,selected:t})=>{const{itemIds:a,itemToCategoriesLookup:i}=this,r=Object.assign({},this.categorySelectionCountMap);if(e.forEach((e=>{r[e]=t?[...a]:[]})),a.forEach((a=>{i[a]||(i[a]=[]);const r=i[a];i[a]=t?[...r,...e]:r.filter((t=>!e.includes(t)))})),t){const t=e.reduce(((e,t)=>{let a="";return t.split("/").filter(Boolean).forEach((i=>{a=`${a}/${i}`,a!==t&&e.push(a)})),e}),[]);t.forEach((e=>{r[e]=[]})),a.forEach((e=>{const a=i[e];i[e]=a.filter((e=>!t.includes(e)))}))}this.categorySelectionCountMap=r},this.handleItemCategoryChange=(e,t)=>{var a;const{itemToCategoriesLookup:i,categorySelectionCountMap:r,rootCategoryPath:n}=this,o=null!==(a=i[e])&&void 0!==a?a:[],l=t.map((e=>e.startsWith(n)?e:`${n}${e}`));(0,s.d)(o,l)||(o.forEach((t=>{const a=r[t];r[t]=(null!=a?a:[]).filter((t=>t!==e))})),l.forEach((t=>{const a=r[t];r[t]=[...null!=a?a:[],e]})),i[e]=[...l],this.categorySelectionCountMap=Object.assign({},r))},this.updateCategory=async()=>{const{itemIds:e,portal:t,itemToCategoriesLookup:a,i18n:i,group:n}=this,o=()=>{this.arcgisCategorizeItemsSubmit.emit(a),this.canSave=!1};if(n)return void o();this.isLoading=!0;const{result:s,error:l}=await(0,r.u)({categories:a,itemIds:e,portal:t,group:n});this.isLoading=!1,!s||l?this.error=i.errorMessage:o()},this.renderItemCard=e=>{const{i18n:t,portal:a,user:r,config:n,itemToCategoriesLookup:o,handleItemCategoryChange:s,categorySchema:l,rootCategoryPath:c}=this,d=o[e.id];return(0,i.h)("arcgis-item-browser-card",{key:e.id,item:e,portal:a,user:r,baseUrl:n.baseUrl,showItemType:!0},d&&d.length>=20&&(0,i.h)("div",{slot:"content-top",class:"status-banner"},(0,i.h)("calcite-icon",{icon:"exclamationMarkTriangle",scale:"s"}),(0,i.h)("span",null,t.limited)),(0,i.h)("div",{slot:"content-end",class:"category-picker-container"},(0,i.h)("arcgis-categories-picker",{portal:a,categories:d,schema:l,rootCategoryPath:c,onArcgisCategoriesPickerChange:({detail:t})=>s(e.id,t),hideLabel:!0})))},this.isActive=void 0,this.items=void 0,this.user=void 0,this.portal=void 0,this.config=void 0,this.group=void 0,this.categorySchema=void 0,this.isLoading=!1,this.categorySelectionCountMap=void 0,this.itemToCategoriesLookup={},this.error=void 0,this.canSave=!1,this.rootCategoryPath=void 0}async componentWillLoad(){const e=await(0,l.g)(this.el);this.i18n=e[0]}async componentDidLoad(){const{portal:e,user:t,group:a}=this;this.isLoading=!0;const i=this.items.map((e=>e.id)),{result:s,error:l}=await(0,n.d)(i,this.portal);this.items=s&&!l?s:this.items,this.updateInternalData(this.items);const{result:c,error:d}=await(0,r.g)({portal:e,user:t,group:a});!d&&c&&(this.categorySchema=c[0].categories,this.rootCategoryPath=(0,o.a)(c)),this.isLoading=!1}async updateInternalData(e){const t=this.group,a=!!t;this.itemIds=e.map((e=>e.id)),this.isLoading=!0;const{result:i,error:r}=await(0,n.d)(this.itemIds,this.portal,t);this.isLoading=!1;const o=i&&!r?i:e;this.itemToCategoriesLookup=o.reduce(((e,t)=>{let i=a?t.groupCategories:t.categories;return(null==i?void 0:i.length)||(i=t.categories),e[t.id]=i,e}),{}),this.categorySelectionCountMap=((e,t)=>{const a={};return e.forEach((({groupCategories:e,categories:i,id:r})=>{let n=t?e:i;(null==n?void 0:n.length)||(n=i),n.forEach((e=>{a[e]||(a[e]=[]),a[e].push(r)}))})),a})(o,a),this.initialItemToCategoriesLookup=structuredClone(this.itemToCategoriesLookup)}handleIsActiveChange(){this.isActive&&this.updateInternalData(this.items)}handleCountMapChange(){const{itemIds:e,itemToCategoriesLookup:t,initialItemToCategoriesLookup:a}=this,i=!!t&&!!a&&e.some((e=>!(0,s.d)(t[e],a[e]))),r=Object.values(t).some((e=>e.length>20));this.canSave=i&&!r}render(){const{items:e,categorySchema:t,categorySelectionCountMap:a,updateCategory:r,isLoading:n,i18n:o,closeDialog:s,isActive:l,renderItemCard:d,handleCategorySelected:u,error:h,canSave:g,rootCategoryPath:m}=this,p=e.length;return(0,i.h)("calcite-dialog",{key:"9e432688c5fc1479c2cb79a7edf683c3b952529e",open:l,onCalciteDialogClose:s,modal:!0,scale:"l",class:"dialog",outsideCloseDisabled:!0,heading:o.modalTitle},n&&(0,i.h)("calcite-scrim",{key:"d3662bfcdf953e91d25e3882f965b3141688aae1",loading:!0},o.loadingText),(0,i.h)("div",{key:"8e202d881c338d7e929009f865ab998e3c0a1d9e",class:"stage"},(0,i.h)("calcite-alert",{key:"8db51b324fe5d6601d723e0799bb3b0c7609b6e4",icon:!0,open:!!h,label:h,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,i.h)("div",{key:"692609e59a51c2cf99ac0c03ccc1bafa55b810ed",slot:"message"},h)),(0,i.h)("arcgis-item-browser",{key:"2196222685bca1f30ca9a3bbc6a71ecc5da9c23f",fetch:async()=>({nextStart:0,num:p,results:e,start:1,total:p}),portal:this.portal,user:this.user,config:this.config,hideContentTop:!0,contentPaddedBottom:!0,hidePreviewFooters:!0,view:"list",selection:"none",num:c.a},(0,i.h)("arcgis-category-tree",{key:"325d23db4d16ad1406d244eb6aae312fec8d7f7c",slot:"filters",rootCategoryPath:m,categorySchema:t,categorySelectionCountMap:null!=a?a:{},total:p,onArcgisCategorizeCategorySelected:({detail:e})=>u(e)}),(0,i.h)("arcgis-item-browser-content",{key:"b583912bec597883a52610c1eb97142fedd76309",slot:"content"},e.map((e=>d(e)))))),(0,i.h)("calcite-button",{key:"f19da80cbbf20023785950277e2d1c24255b2e2d",slot:"footer-end",appearance:"outline","data-id":"cancelButton",onClick:s},o.cancel),(0,i.h)("calcite-button",{key:"e2d63d51a55167ce0508f305b6a46535ab0c5352",slot:"footer-end",appearance:"solid","data-id":"nextButton",onClick:r,disabled:!g},o.save))}get el(){return(0,i.a)(this)}static get watchers(){return{items:["updateInternalData"],isActive:["handleIsActiveChange"],categorySelectionCountMap:["handleCountMapChange"]}}};d.style=".stage{height:100%;overflow:hidden;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));background-color:var(--calcite-color-background)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.dialog{--calcite-dialog-content-space:0;--calcite-dialog-size-x:1080px}.category-picker-container{margin-top:0.5rem}.status-banner{display:flex;align-items:center;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;font-size:0.75rem;border-bottom:1px solid var(--calcite-color-border-2)}.status-banner>calcite-icon{margin-inline-end:0.5rem;color:var(--calcite-color-status-danger)}.status-banner>span{margin-top:2px}"},50822:(e,t,a)=>{a.d(t,{a:()=>o,b:()=>n,c:()=>c,d:()=>d,e:()=>u,f:()=>h,g:()=>g,i:()=>s,u:()=>l});a(93814);var i=a(87744);function r(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function n(e){var t;return r(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function o(e){var t;return r(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function s(e,t){return e.owner===t.username}function l(e,t){return s(e,t)||function(e,t){var a;if(null!=e.isAdmin)return!!e.isAdmin;const i=e.owner,r="admin"===e.itemControl,n=["esri_livingatlas","esri_demographics","esri_boundaries"];if((null===(a=e.portal)||void 0===a?void 0:a.isPortal)&&!s(e,t)&&r&&i.includes("esri_")&&!n.includes(i))return!1;return r}(e,t)}const c=(e,t)=>!!t.orgId&&e.every((e=>e.isOrgItem)),d=(e,t)=>`${(0,i.a)(t)}item.html?id=${e}`,u=(e,t)=>`${(0,i.g)(t)}/content/users/${e}`,h=e=>e.reduce(((e,t)=>(e[t.owner]=e[t.owner]?[...e[t.owner],t.id]:[t.id],e)),{}),g=(e,t)=>`${(0,i.a)(t)}content/items/${e}`},64099:(e,t,a)=>{a.d(t,{a:()=>o,g:()=>c});var i=a(15332),r=a(81034),n=a(87849);function o(e){var t,a,n;const o=null!==(t=(0,i.c)(e,"[lang]"))&&void 0!==t?t:null===(n=null===(a=e.shadowRoot)||void 0===a?void 0:a.ownerDocument)||void 0===n?void 0:n.documentElement,s=((null==o?void 0:o.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return r.l.has(s)?r.l.get(s):r.l.has(s.slice(0,2))?r.l.get(s.slice(0,2)):"en"}const s={};function l(e,t){const a=`${e}${t}`;return s[a]||(s[a]=function(e,t){return new Promise(((a,i)=>{fetch((0,n.d)(`../arcgis-app-assets/i18n/${e}.i18n.${t}.json`)).then((e=>{e.ok?a(e.json()):i()}),(()=>i()))}))}(e,t)),s[a]}async function c(e,t){const a=t||e.tagName.toLowerCase(),n=o(e),s=function(e){var t,a,n;const o=null!==(t=(0,i.c)(e,"[lang]"))&&void 0!==t?t:null===(n=null===(a=e.shadowRoot)||void 0===a?void 0:a.ownerDocument)||void 0===n?void 0:n.documentElement,s=((null==o?void 0:o.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return r.l.has(s)?r.l.get(s):r.l.has(s.slice(0,2))?s:"en"}(e);let c;try{c=await l(a,n)}catch(e){console.warn(`no locale for ${a} (${n}) loading default locale en.`),c=await l(a,"en")}return[c,n,s]}},68194:(e,t,a)=>{a.d(t,{r:()=>n});var i=a(50637),r=a(59317);const n=async(e,t,a={})=>{const{body:n,usePost:o,addTokenManually:s,api:l=(null===r.c||void 0===r.c?void 0:r.c.api),customToken:c}=a,d=new URLSearchParams;n&&Object.entries(n).forEach((([e,t])=>{void 0!==t&&d.append(e,t)}));const u=new URL(e);if(u.searchParams.append("f","json"),c)u.searchParams.append("token",c);else{const e=!1===s?null:await(0,i.b)(t,l);e&&u.searchParams.append("token",e)}const h=await fetch(u.toString(),{body:o?d:void 0,method:o?"POST":"GET"}),g=await h.json(),m=g.error;if(m)throw"string"==typeof m?new Error(m):m;return g}},80379:(e,t,a)=>{a.d(t,{a:()=>n,b:()=>r,i:()=>o});const i=["appExtensionError","forbiddenCredential","disabledSubscription","unauthorized","timeout","itemExists","exceedsFileSize","fileExists","emptyFile","unavailableGeocoder","dataNotAvailable","invalidShapefile","invalidFileGeodatabase","providePath","useSameFileName","invalidExtension","tokenRequired","invalidToken","invalid3DObjectFeatureClass","invalidClassification","serviceNameInvalid","titleInvalid","titleStartsWithNumber","titleRequired","titleInUseService","itemInRecycleBin","summaryInvalid","descriptionInvalid","missingUserOrPortal","dataStoreTitleInvalid","serviceNameExists","folderNameExists","serviceNotExist","unsupportedWFSVersion","invalidWMTS","invalidSpatialRef","emptyFeatureLayer","invalidFeatureLayerUrl","invalidUrl","httpWarning","flowAborted","duplicateFieldNames","failToFetchText","mapServiceError","noTilingSchemeFound","noMatchSpatialRef","invalidDataStorePublishType","noRegisteredServersForDataStore","noContentInDataStore","failToPublishFromDataStore","failToListDataStoreContents","invalidUsernameOrPassword","invalidConnection","invalidCredentials","invalidBigQueryProjectId","invalidSnowflakeServer","invalidSnowflakeRole","invalidSnowflakeWarehouse","invalidSnowflakeSchema","invalidSnowflakeDatabase","invalidAWSBucket","invalidAzureContainer","invalidJSON","invalidKeyFile","unauthorizedCredentials","unknownAGSType","unhandledError","incompatibleGeometries","multiPatchRestriction","invalidUniqueIdentifier","cannotAddNullData","exceededMaxFieldLength","invalidFieldType","failToCreate3DLayer"],r=e=>i.includes(null==e?void 0:e.code),n=e=>e&&e.hasOwnProperty("code")&&e.hasOwnProperty("message")&&e.hasOwnProperty("details")&&(!e.details||Array.isArray(e.details)),o=e=>{const t=e.toLocaleLowerCase();return t.includes("unexpected end of")||t.includes("did not match the expected pattern")}},80619:(e,t,a)=>{a.d(t,{I:()=>i,a:()=>r});const i=["folder","group","contentType"],r=99999},81034:(e,t,a)=>{a.d(t,{C:()=>s,a:()=>l,b:()=>d,f:()=>u,g:()=>o,l:()=>n,s:()=>g});var i=a(931),r=a(15332);const n=new Map([["ar","ar"],["bg","bg"],["bs","bs"],["ca","ca"],["cs","cs"],["da","da"],["de","de"],["el","el"],["en","en"],["es","es"],["et","et"],["fi","fi"],["fr","fr"],["he","he"],["hr","hr"],["hu","hu"],["id","id"],["it","it"],["ja","ja"],["ko","ko"],["lt","lt"],["lv","lv"],["nb","no"],["no","no"],["nl","nl"],["pl","pl"],["pt-br","pt-BR"],["pt-pt","pt-PT"],["ro","ro"],["ru","ru"],["sk","sk"],["sl","sl"],["sr","sr"],["sv","sv"],["th","th"],["tr","tr"],["uk","uk"],["vi","vi"],["zh-cn","zh-CN"],["zh-hk","zh-HK"],["zh-tw","zh-TW"]]);function o(e){return function(e,t,a){const i=(0,r.c)(e,`[${t}]`);return i?i.getAttribute(t):a}(e,"dir","ltr")}const s={rtl:"arcgis--rtl"};async function l(e,t){const{api:a,type:r,places:n}=t||{};if(4===a){const[t]=await(0,i.l)(["esri/intl"]),a=t.convertNumberFormatToIntlOptions({places:n,style:r,digitSeparator:!0});return t.formatNumber(e,Object.assign(Object.assign({},a),{style:r}))}const[o]=await(0,i.l)(["dojo/number"]);return o.format(e,{type:r,places:n,pattern:null==t?void 0:t.pattern})}const c={};function d(e,t){let a=document.documentElement.lang;const i="bs"===a;if(i&&(a="hr"),t){const t=`${a}-full`,i={dateStyle:"full",timeStyle:"long"};return c[t]||(c[t]=new Intl.DateTimeFormat(a,i)),c[t].format(e)}const r={year:"numeric",month:i?"numeric":"short",day:"numeric"};return c[a]||(c[a]=new Intl.DateTimeFormat(a,r)),c[a].format(e)}function u(e,t,a,i){const r=null!=e?e:"en";let n=t.unknown;return(1===a||["id","ja","ko","th","vi","zh-cn","zh-hk","zh-tw"].includes(r))&&(n=t.single),1!==a&&["en","ca","da","de","el","es","et","fi","hi","hu","it","nb","nl","pt-pt","sv","tr"].includes(r)&&(n=t.multiple),g(n,Object.assign(Object.assign({},i),{number:a}))}const h=/\$\{([^}]+)\}/g;function g(e,t,a=h){let i=e;try{i=e.replace(a,((e,a)=>function(e,t){const a=e.split(".").reduce(((e,t)=>e[t]),t);return"string"==typeof a||"number"==typeof a?a:e}(a,t).toString()))}catch(e){console.error(e)}return i}},90310:(e,t,a)=>{a.d(t,{a:()=>w,b:()=>u,c:()=>h,d:()=>g,f:()=>d,g:()=>m,l:()=>b});var i=a(50637),r=a(80379),n=a(50822),o=a(931),s=a(87744),l=a(83929),c=a(68194);const d=async(e,t,a)=>{const{owningSystemUrl:r}=await(0,i.f)((async()=>(0,l.g)(e)),"portalInfo",e.id);return(await Promise.all(t.map((async e=>{try{const{owningSystemUrl:t}=await(0,l.a)(e,a);return{owningSystemUrl:t,url:e}}catch(t){return console.error(t),{owningSystemUrl:null,url:e}}})))).filter((({owningSystemUrl:e})=>e===r)).map((({url:e})=>e))},u=async(e,t)=>{var a;try{return{result:await(0,c.r)(e,t,{addTokenManually:!1})}}catch(e){const t="token required";return(null===(a=null==e?void 0:e.message)||void 0===a?void 0:a.toLowerCase().includes(t))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}};async function h(e,t,a){var r;const{relationshipType:n,direction:o}=a,l=`${(0,s.g)(t)}content/items/${e}/relatedItems`,c=await(0,i.r)(l,{relationshipType:n,direction:o,includeRecycleBin:!0});return(null===(r=null==c?void 0:c.relatedItems)||void 0===r?void 0:r.length)&&(c.relatedItems=c.relatedItems.filter((t=>(null==t?void 0:t.id)!==e))),c}const g=async(e,t,a)=>{const r=!!a,n=(0,s.g)(t),o=r?`${n}/content/groups/${a.id}/search`:`${n}/search`;try{return{result:(await(0,i.r)(o,{filter:`id:(${e.join(" OR ")})`,num:100})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},m=async(e,t,a)=>{try{const r=[],n=[],o=[];await Promise.all(e.map((async e=>{const{result:s,error:c}=await(0,i.f)((()=>u(e,t)),"itemMetadata",`${e}--no-token`);if("tokenRequired"!==(null==c?void 0:c.code))if(p(s))r.push(v(s,e));else try{const t=await(0,l.a)(e,a);o.push(Object.assign(Object.assign({},s),{owningSystemUrl:t.owningSystemUrl}))}catch(c){console.warn(c)}else n.push(e)})));const s=await d(t,n,a),h=(await Promise.all(s.map((async e=>({response:await(0,c.r)(e,t,{addTokenManually:!0}),owningSystemUrl:(await(0,l.a)(e,a)).owningSystemUrl,url:e}))))).reduce(((e,{response:t,url:a,owningSystemUrl:i})=>p(t)?(r.push(v(t,a)),e):[...e,Object.assign(Object.assign({},t),{owningSystemUrl:i})]),[]),g=await Promise.all([...o,...h].map((async({serviceItemId:e,owningSystemUrl:t})=>{if(!e)return null;const{result:a}=await f({itemId:e,owningSystemUrl:t});return{item:a,owningSystemUrl:t}}))),{result:y}=r.length<=0?{result:[]}:await m(r,t,a);return{result:[...g.filter((e=>!!e)),...y]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},p=e=>!!(null==e?void 0:e.sources),v=(e,t)=>{var a;const i=null===(a=Object.values(e.sources)[0])||void 0===a?void 0:a.url;return i?i.includes("..")?(0,s.t)({url:t,path:i}):i:null},y=e=>`${e}/sharing/rest`,f=async({itemId:e,owningSystemUrl:t,requestOptions:a})=>{try{const r=(0,n.g)(e,y(t));return{result:await(0,i.r)(r,{},Object.assign(Object.assign({},a),{addTokenManually:!1}))}}catch(e){return console.error(e),(0,r.a)(e)&&e.message.toLocaleLowerCase().includes("invalid token")?{error:{code:"invalidToken"}}:{error:{code:"unhandledError"}}}},w=async({itemId:e,owningSystemUrl:t,requestOptions:a})=>{try{const r=`${(0,n.g)(e,y(t))}/data`;return{result:await(0,i.r)(r,{},Object.assign(Object.assign({},a),{addTokenManually:!1}))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},b=async(e,t)=>{try{const[a]=await(0,o.l)(["esri/portal/PortalItem"]),i=new a({id:e,portal:t});return await i.load(),{result:i}}catch(e){return console.error("Fail to reload item",e),{error:{code:"unhandledError"}}}}}}]);