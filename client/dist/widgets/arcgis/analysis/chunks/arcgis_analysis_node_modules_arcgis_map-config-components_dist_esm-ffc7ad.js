/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-ffc7ad.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-ffc7ad"],{35365:(e,o,s)=>{s.d(o,{c:()=>r,u:()=>a});var l=s(10465),t=(s(56612),s(76744)),i=s(14528);function r(e){e.selectedFields=[],e.layerFields=void 0,e.fields=void 0,e.hideLayerTitle=!1,e.supportsArcade=!1,e.stringFieldsCount=-1,e.dateFieldsCount=-1,e.numberFieldsCount=-1,e.containsFlow=!0,e.oneFeatureResponseStatus=t.s.MISSING,e.selectedAttribute=void 0,e.selectedAttributeText=void 0,e.selectedTypeValue=void 0,e.selectedValue=void 0,e.lastDefault=void 0,e.lastDefaults=void 0,e.dotColorSelected=void 0,e.backgroundStyleSelected=void 0,e.lastSettings=void 0,e.classedSymbolSelectedIdx=void 0,e.allUniqueValues=void 0,e.useFeatureReduction=void 0,e.symbolStylerConfig={},e.rasterInfo=void 0}function a(){const e=(0,i.r)(),o=e;e.manager.onLoad((()=>{o.smartMappingState=function(e,o){const s=n.get(e);if(s)return s;const t=(0,l.c)(e,o);if(t&&"store"in t)return n.set(e,t.store),t.store;return null}(e.el,"arcgis-smart-mapping").state}))}const n=new WeakMap},68474:(e,o,s)=>{s.d(o,{A:()=>O,B:()=>S,a:()=>ee,b:()=>f,c:()=>Z,d:()=>M,e:()=>D,f:()=>R,g:()=>G,h:()=>T,i:()=>E,j:()=>i,k:()=>r,l:()=>v,m:()=>q,n:()=>P,o:()=>A,p:()=>j,q:()=>F,r:()=>h,s:()=>n,t:()=>H,u:()=>C,v:()=>N,w:()=>I,x:()=>B,y:()=>x,z:()=>L});s(56612);var l=s(76744),t=s(17840);function i(e){const{mapView:o}=e,s=(0,l.g)(e),i=s.authoringInfo,r="class-breaks"===s.type?s.classBreakInfos:s.uniqueValueInfos,a=(0,l.b)(s,"size"),c=(0,l.d)(s,"reference-size"),p=(0,l.d)(s,"spike"),u=!!a&&!(0,t.i)(a.minSize),m=!!a&&"number"==typeof a.minSize,d="above-and-below"===i?.univariateTheme;let y=2,g=20;if(c)c.referenceSizeScale&&n(e),[y,g]=[c.sizeStops[0].size,c.sizeStops[1].size];else if(p)[y,g]=[p.sizeStops[0].size,p.sizeStops[1].size];else if(a)if(d){const e=a.stops;[y,g]=[e[2].size,Math.max(e[0].size,e[4].size)]}else if(u){const e=a.stops;[y,g]=[e[0].size,e[e.length-1].size]}else if(m)[y,g]=[a.minSize,a.maxSize];else{const e=o.scale,s=a.minSize.stops,l=a.maxSize.stops;[y,g]=[s[s.length-1].size,l[l.length-1].size];for(let o=0;o<s.length;o++){const t=s[o],i=l[o];if(e<=t.value){if(o>0){const r=s[o-1],a=l[o-1],n=(e-r.value)/(t.value-r.value);[y,g]=[r.size+(t.size-r.size)*n,a.size+(i.size-a.size)*n]}else[y,g]=[s[0].size,l[0].size];break}}}else if(r){const o=r[0].symbol,s=r[r.length-1].symbol;[y,g]=[(0,l.af)(e,o),(0,l.af)(e,s)],y>g&&([y,g]=[g,y])}return[y,g]}function r(e,o){const{mapView:s,modules:r}=e,a=(0,l.g)(e),n=(0,l.b)(a,"size");let c=o[0],p=(0,t.i)(o[1])?o[1]:c;if(n){const l=a.authoringInfo,u="above-and-below"===l?.univariateTheme,m=!!n&&!(0,t.i)(n.minSize),d=!!n&&"number"==typeof n.minSize,[y,g]=i(e),b=y>g;if(!b&&c>=g?c=g-.75:b&&c>=y&&(c=y-.75),!b&&y>=p?p=y+.75:b&&g>=p&&(p=g+.75),u){const e=n.stops,s=b?o[1]:o[0],l=b?o[0]:o[1],t=Math.max(...e.map((e=>e.value))),i=e[2].value,r=Math.min(...e.map((e=>e.value))),a=Math.abs(t-i),c=Math.abs(r-i),p=a>c?a:c,u=l-s;e.forEach((e=>{const{value:o}=e;e.size=Math.abs(o-i)/p*u+s}))}else if(m){const e=n.stops;n.stops=null,n.minSize=c,n.maxSize=p,n.minDataValue=e[0].value,n.maxDataValue=e[e.length-1].value}else if(d)b?(n.maxSize=c,n.minSize=p):(n.minSize=c,n.maxSize=p);else{const e=s.scale;let o=r.esriLang.clone(n.minSize.stops),l=r.esriLang.clone(n.maxSize.stops);b&&([o,l]=[l,o]);let t=c/o[o.length-1].size,i=p/l[l.length-1].size;for(let s=0;s<o.length;s++){const r=o[s],a=l[s];if(e<=r.value){if(s>0){const n=o[s-1],u=l[s-1],m=(e-n.value)/(r.value-n.value),[d,y]=[n.size+(r.size-n.size)*m,u.size+(a.size-u.size)*m];t=c/d,i=p/y}else t=c/o[0].size,i=p/l[0].size;break}}o.forEach((e=>e.size=Math.round(t*e.size*10)/10)),l.forEach((e=>e.size=Math.round(i*e.size*10)/10)),b&&([o,l]=[l,o]),n.minSize.stops=o,n.maxSize.stops=l}}else{const o=a.classBreakInfos[0].symbol,s=a.classBreakInfos[a.classBreakInfos.length-1].symbol;let t=(0,l.af)(e,o),i=(0,l.af)(e,s),r=!1;t>i&&([t,i]=[i,t],r=!0),t!==i&&c>i&&(c=i-.75),t=c,t!==i&&t>p&&(p=t+.75),i=p;const n=i-t,u=1===a.classBreakInfos.length?1:n/(a.classBreakInfos.length-1);a.classBreakInfos.forEach(((o,s)=>{const a=o.symbol;r?(0,l.ag)(e,a,i-u*s):(0,l.ag)(e,a,t+u*s)}))}}function a(e,o){const s=e.stops,l=s.length-1,t=s[0].value,i=s[l].value;if(o<=t)return s[0].size;if(o>=i)return s[l].size;for(let e=0;e<=l;e++){const l=s[e],t=s[e+1];if(o>=l.value&&o<t.value){const e=t.value-l.value,s=l.size-t.size,i=(o-l.value)/e,r=l.size-s*i;return Math.round(100*r)/100}}return 1}function n(e){const{mapView:o}=e,s=(0,l.g)(e),t=(0,l.d)(s,"reference-size"),i=t.referenceSizeScale/o.scale;t.sizeStops.forEach((e=>e.size*=i)),t.referenceSizeScale=o.scale}let c;const p="polygon",u=["triangle-gradient-fill-open","triangle-solid-fill-open"],m=["triangle-gradient-fill-open","triangle-solid-fill-open","triangle-open-outline","triangle-closed-outline"],d=["triangle-gradient-fill-open","triangle-gradient-fill-open-outline"];function y(e){const{modules:o}=e;return[new o.EsriColor([255,255,255]),new o.EsriColor([178,178,178]),new o.EsriColor([128,128,128]),new o.EsriColor([92,92,92]),new o.EsriColor([77,77,77]),new o.EsriColor([51,51,51]),new o.EsriColor([26,26,26])]}function g(e){const{modules:o}=e;return[new o.EsriColor("#ff4040"),new o.EsriColor("#ff8200"),new o.EsriColor("#faa83f"),new o.EsriColor("#ffd159"),new o.EsriColor("#74b566"),new o.EsriColor("#008977"),new o.EsriColor("#33e3c8"),new o.EsriColor("#43abeb"),new o.EsriColor("#4c64c9"),new o.EsriColor("#9868ed"),new o.EsriColor("#b155e6"),new o.EsriColor("#db5181"),new o.EsriColor("#e03b99"),new o.EsriColor("#2b2b2b"),new o.EsriColor("#bdbdbd"),new o.EsriColor("#ffffff")]}function b(e){return g(e).reverse()}function f(e,o){const{referenceElement:s,heading:l}=o,t=document.createElement("arcgis-smart-mapping-styler-popover");return t.smartMappingState=e,t.referenceElement=s,t.heading=l,document.body.appendChild(t),t.open=!0,t.reposition(),t}function h(e){e?.parentNode&&(e.open=!1,e.parentNode?.removeChild(e))}async function k(e,o){const s=document.createElement("arcgis-map-config-symbol-styler");s.initialSourceId=c,s.config={...e.symbolStylerConfig,hideAnimation:!!e.mapImageSublayer};const l=await o.getPopoverRefElement(),t=l?.getBoundingClientRect();if(t?.bottom){const e=45,o=53,l=20,i=(t?.top??0)+e+o+l+(window.innerHeight-(t?.bottom??0));s.style=`max-height: max(calc(100vh - ${i}px), 200px)`}return s.popoverProps={placement:"bottom-end",offsetDistance:10,offsetSkidding:e.isRTL?3:-3,pointerDisabled:"true",popoverWidth:315,refElement:await o.getPopoverCloseActionElement()},s.addEventListener("arcgisSourceIdChange",(({detail:e})=>c=e)),s}function z(e,o,s){return document.URL.includes("debug=true")&&(console.log("symbol",JSON.stringify(o,null,2)),console.log("props",JSON.stringify({...s,portal:"..."}))),e.edit(o,s)}function w(e,o){const{symbol:s,info:{marker:l,stroke:t,fill:i}}=o.detail;document.URL.includes("debug=true")&&(console.log("onStylerEdit - symbol:",JSON.stringify(s?.toJSON(),null,2)),console.log("onStylerEdit - info.marker:",JSON.stringify(l)),console.log("onStylerEdit - info.stroke:",JSON.stringify(t)),console.log("onStylerEdit - info.fill:",JSON.stringify(i))),e(o)}async function S(e,o){const{layer:s,mapImageSublayer:t,portal:i,modules:r}=e,{onChange:a,popoverNode:n}=o,c=(0,l.g)(e),p="subtype-sublayer"===s.type,u=(0,l.e)(e),m="pie-chart"===(0,l.g)(e).type,d=(0,l.b)(c,"size"),g=(0,l.b)(c,"size","outline");let b=c.backgroundFillSymbol;b||(b=new r.SimpleFillSymbol,b.color=null,(0,l.g)(e).backgroundFillSymbol=b,a());const f=!!b.color,h=(0,l.ah)(b),S=y(e),C=y(e);let v;v=b.outline?{color:b.outline.color?b.outline.color:new r.EsriColor([0,0,0,.5]),size:b.outline.width,style:b.outline.style,autoAdjusted:!!g}:{color:new r.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!g},b.outline||(b.outline=new r.SimpleLineSymbol,(0,l.j)(e,b,new r.EsriColor([0,0,0,0])));const E=await k(e,n),j=z(E,r.esriLang.clone(b),{portal:i,symbolFilter:"simple",sections:{fill:{type:"color",optional:!0,open:!0,suggestedColorsOpen:!0,transparencyOpen:!0,suggestedColors:S},stroke:{type:"color",optional:!0,suggestedColors:C,extraParts:{width:!0,autoStrokeAdjust:!(t||p||u&&m&&!d)&&"editable"}}},fill:{color:b.color?b.color:new r.EsriColor([0,0,0,.5])},stroke:v,fillEnabled:f,strokeEnabled:h});return E.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i}}})=>{(0,l.g)(e).backgroundFillSymbol=s,_(e,s,t?.autoAdjusted,i?.autoAdjusted,E,o)}))),n.addStyler(E),await j,U(e,b,E)}async function C(e,o){const{layer:s,mapImageSublayer:t,portal:i,modules:r}=e,{popoverNode:a}=o,n=(0,l.g)(e),c="subtype-sublayer"===s.type,p=(0,l.b)(n,"size","outline"),u=!!n.backgroundColor,m=!!n.outline?.color,d=y(e),g=y(e);let b;b=n.outline?{color:n.outline.color?n.outline.color:new r.EsriColor([0,0,0,.5]),size:n.outline.width,style:n.outline.style,autoAdjusted:!!p}:{color:new r.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!p};const f=new r.SimpleFillSymbol;f.color=(0,l.g)(e).backgroundColor,f.outline=(0,l.g)(e).outline;const h=await k(e,a),S=z(h,r.esriLang.clone(f),{portal:i,symbolFilter:"simple",sections:{fill:{type:"color",open:!0,optional:!0,suggestedColorsOpen:!0,transparencyOpen:!0,suggestedColors:d},stroke:{type:"color",optional:!0,suggestedColors:g,extraParts:{width:!0,autoStrokeAdjust:!t&&!c&&"editable"}}},fill:{color:n.backgroundColor?n.backgroundColor:new r.EsriColor([0,0,0,.5])},stroke:b,fillEnabled:u,strokeEnabled:m});h.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i}}})=>{(0,l.g)(e).backgroundColor=(0,l.h)(e,s),(0,l.g)(e).outline=s.outline,_(e,s,t?.autoAdjusted,i?.autoAdjusted,h,o)}))),a.addStyler(h),await S;const C=new r.SimpleFillSymbol;return C.color=n.backgroundColor,C.outline=n.outline,U(e,C,h)}async function v(e,o){const{onChange:s,popoverNode:t}=o,{portal:i,modules:r}=e,a=(0,l.G)(e),n=(0,l.H)(e),c=(0,l.e)(e),p=(0,l.g)(e),u=(0,l.k)(e),m=(0,l.b)(p,"size","auto"),d=(0,l.b)(p,"size","outline");let g=p.defaultSymbol;X(g)||(g=(0,l.f)(e,u));const b="picture-marker"!==g.type&&!!g.color,f=(0,l.ah)(g),h="cim"===g.type&&"CIMPointSymbol"===g.data.symbol.type,S=y(e),C=y(e);let v;if(g||(g=c?new r.SimpleFillSymbol:n?new r.SimpleLineSymbol:new r.SimpleMarkerSymbol),"simple-fill"===g.type){const e=g;if(e.outline){const o=e.outline;v={color:o.color?o.color:new r.EsriColor([0,0,0,.5]),size:o.width,style:o.style,autoAdjusted:!!d}}else v={color:new r.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!d}}else if("simple-line"===g.type){const e=g;v={color:e.color?e.color:new r.EsriColor([0,0,0,.5]),size:e.width,style:e.style,marker:e.marker}}else if("simple-marker"===g.type&&g.outline){const e=g.outline;v={color:e.color?e.color:new r.EsriColor([0,0,0,.5]),size:e.width,style:e.style}}else v="cim"===g.type?Q(e,g):{color:new r.EsriColor([255,255,255,.5]),size:1};const E=await k(e,t);let j;j=z(E,r.esriLang.clone(g),n?{portal:i,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color",open:!0,suggestedColorsOpen:!0,suggestedColors:C,extraParts:{width:!m,autoStrokeAdjust:!1}}},stroke:v}:{portal:i,symbolFilter:c&&!(0,l.ai)(e)?"simple":void 0,sections:{marker:h||["simple-marker","picture-marker"].includes(g.type)?{open:!0,parts:{size:!m},symbolsOpen:!0,sizeOpen:!0,markerType:(0,l.ai)(e)?"all":["simple","picture"]}:void 0,fill:{type:"color",open:!0,optional:!0,suggestedColorsOpen:!0,suggestedColors:S},stroke:{type:"color",optional:!0,suggestedColors:C,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(g.type),width:!0,autoStrokeAdjust:!1}}},fill:{color:(0,l.h)(e,g)||new r.EsriColor([128,128,128])},marker:a?{size:(0,l.af)(e,g)}:void 0,stroke:v,fillEnabled:b,strokeEnabled:f}),E.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:o}})=>{(0,l.g)(e).defaultSymbol=o,s()}))),t.addStyler(E),await j}async function E(e,o){const{mapImageSublayer:s,layer:t,mapView:i,classedSymbolSelectedIdx:r,portal:n,modules:c}=e,{onChange:p,popoverNode:u}=o,m="subtype-sublayer"===t.type,d=(0,l.G)(e),y=(0,l.H)(e),f=(0,l.e)(e),h=(0,l.g)(e),S=(0,l.k)(e),C=(0,l.b)(h,"size","auto"),v=(0,l.b)(h,"size","outline");let E=h.classBreakInfos?.length?c.esriLang.clone(h.classBreakInfos[r].symbol):(0,l.f)(e,S);X(E)||(E=(0,l.f)(e,S)),C&&(0,l.ag)(e,E,a(C,i.scale));const j="picture-marker"!==E.type&&!!E.color,A=(0,l.ah)(E),V="cim"===E.type&&"CIMPointSymbol"===E.data.symbol.type,O=g(e),I=b(e);let L;if((d||y)&&C?(0,l.ag)(e,E,a(C,i.scale)):f&&v&&E.outline&&(E.outline.width=a(v,i.scale)),"simple-fill"===E.type){const e=E;L=e.outline?{color:e.outline.color?e.outline.color:new c.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style,autoAdjusted:!!v}:{color:new c.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!v}}else if("simple-marker"===E.type){const e=E;L=e.outline?{color:e.outline.color?e.outline.color:new c.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new c.EsriColor([0,0,0,.5]),size:1}}else if("cim"===E.type)L=Q(e,E);else if("simple-line"===E.type){const e=E;L={size:e.width,style:e.style,marker:e.marker,color:e.color?e.color:new c.EsriColor([0,0,0,.5])}}else L={color:new c.EsriColor([255,255,255,.5]),size:1};const x=await k(e,u);let q;if(q=z(x,c.esriLang.clone(E),y?{portal:n,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color",open:!0,suggestedColorsOpen:!0,suggestedColors:O,extraParts:{style:"cim"!==E.type,arrow:"cim"!==E.type,width:"size"!==S,autoStrokeAdjust:!s&&!m&&"size"!==S&&"editable"},parts:{extra:"size"!==S&&!C||"cim"!==E.type}}},stroke:L}:{portal:n,symbolFilter:f&&!(0,l.ai)(e)?"simple":void 0,sections:{marker:V||["simple-marker","picture-marker"].includes(E.type)?{open:!0,parts:{size:"size"!==S&&(!(!s&&!m)||{autoSizeAdjust:"editable"})},symbolsOpen:!0,sizeOpen:"size"!==S,markerType:(0,l.ai)(e)?"all":["simple","picture"]}:void 0,fill:{type:"color",open:!0,optional:!0,suggestedColorsOpen:!0,transparencyOpen:(0,l.aj)(e,E),suggestedColors:O},stroke:{type:"color",optional:!0,suggestedColors:I,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(E.type),width:!0,autoStrokeAdjust:!(s||m||!f||"cim"===E.type||"size"===S)&&"editable"}}},fill:{color:(0,l.h)(e,E)||K(O[1],.85)},marker:d?{size:(0,l.af)(e,E),autoAdjusted:!!C}:void 0,stroke:L,fillEnabled:j,strokeEnabled:A}),x.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i}}})=>{const a=(0,l.g)(e),n=a.classBreakInfos.slice(),c=n[r],u=(0,l.af)(e,c.symbol);c.symbol=s,a.classBreakInfos=n,"size"===S?((0,l.ag)(e,c.symbol,u),p()):_(e,s,t?.autoAdjusted,i?.autoAdjusted,x,o)}))),u.addStyler(x),await q,"size"!==S)return U(e,h.classBreakInfos?.length?h.classBreakInfos[0].symbol:void 0,x)}async function j(e,o){await V(e,{...o,type:"above"})}async function A(e,o){await V(e,{...o,type:"below"})}async function V(e,o){const{portal:s,modules:t}=e,{onChange:i,popoverNode:r}=o,a=(0,l.g)(e),n=(0,l.b)(a,"color"),c="above"===o.type;let p=a.classBreakInfos?.[c?1:0]?.symbol||(0,l.f)(e,"color-size");X(p)||(p=(0,l.f)(e,"color-size"));const u="picture-marker"!==p.type&&!!p.color,m=(0,l.ah)(p),d=g(e),y="simple-line"===p.type?g(e):b(e);let f;if("simple-marker"===p.type){const e=p;f=e.outline?{color:e.outline.color?e.outline.color:new t.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new t.EsriColor([0,0,0,.5]),size:1}}else if("simple-line"===p.type){const e=p;f={color:e.color,size:e.width,style:e.style,marker:e.marker}}else f="cim"===p.type?Q(e,p):{color:new t.EsriColor([255,255,255,.5]),size:1};const h=await k(e,r),S=z(h,t.esriLang.clone(p),{portal:s,sections:{marker:n&&["simple-marker","cim"].includes(p.type)?{open:!0,parts:{size:!1},symbolsOpen:!0,sizeOpen:!1,markerType:(0,l.ai)(e)?["simple","cim:vector"]:["simple"]}:!n&&["simple-marker","picture-marker","cim"].includes(p.type)?{open:!0,parts:{size:!1},symbolsOpen:!0,sizeOpen:!1}:void 0,fill:n?void 0:{type:"color",open:!0,optional:!0,suggestedColorsOpen:!0,transparencyOpen:(0,l.aj)(e,p),suggestedColors:d},stroke:n?void 0:{type:"color",optional:!0,suggestedColors:y,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(p.type),width:!0,autoStrokeAdjust:!1}}},fill:n?void 0:{color:(0,l.h)(e,p)||K(d[1],.85)},marker:{size:(0,l.af)(e,p)},stroke:f,fillEnabled:u,strokeEnabled:m});h.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:o}})=>{const s=(0,l.g)(e);s.authoringInfo.univariateSymbolStyle="custom";const t=s.classBreakInfos.slice();t[c?1:0].symbol=o,s.classBreakInfos=t,i()}))),r.addStyler(h),await S}async function O(e,o){const{layer:s,mapImageSublayer:t,mapView:i,portal:r,modules:n}=e,{popoverNode:c}=o,p="ogc-feature"===s.type,u="subtype-sublayer"===s.type,m=(0,l.G)(e),d=(0,l.H)(e),y=(0,l.e)(e),f=(0,l.g)(e),h=(0,l.b)(f,"size","auto"),S=(0,l.b)(f,"size","outline");let C=f.symbol;X(C)||(C=(0,l.f)(e));const v="picture-marker"!==C.type&&!!C.color,E=(0,l.ah)(C),j="cim"===C.type&&"CIMPointSymbol"===C.data.symbol.type,A=g(e),V="simple-line"===C.type?g(e):b(e);let O;if("simple-fill"===C.type){const e=C;O=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style,autoAdjusted:!!S}:{color:new n.EsriColor([0,0,0,.5]),size:1,style:"solid"}}else if("simple-marker"===C.type){const e=C;O=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new n.EsriColor([0,0,0,.5]),size:1}}else if("simple-line"===C.type){const e=C;O={color:e.color,size:h?a(h,i.scale):e.width,style:e.style,marker:e.marker,autoAdjusted:!!h}}else"cim"===C.type?(O=Q(e,C),d&&(O.size=h?a(h,i.scale):O.size,O.autoAdjusted=!!h,h&&(0,l.ag)(e,C,O.size))):O={color:new n.EsriColor([255,255,255,.5]),size:1};const I=await k(e,c);let L;return L=z(I,n.esriLang.clone(C),d?{portal:r,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color",optional:"cim"===C.type,open:!0,suggestedColorsOpen:!0,suggestedColors:V,extraParts:{style:"cim"!==C.type,arrow:"cim"!==C.type,width:!0,autoStrokeAdjust:!(p||t||u)&&"editable"}}},stroke:O}:{portal:r,symbolFilter:y&&!(0,l.ai)(e)?"simple":void 0,sections:{marker:j||["simple-marker","picture-marker"].includes(C.type)?{open:!0,symbolsOpen:!0,sizeOpen:!0,parts:{size:{autoSizeAdjust:!(p||t||u)&&"editable"}},markerType:(0,l.ai)(e)?"all":["simple","picture"]}:void 0,fill:{type:"color",optional:!0,open:!0,suggestedColorsOpen:!0,transparencyOpen:(0,l.aj)(e,C),suggestedColors:A},stroke:{type:"color",optional:!0,suggestedColors:V,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(C.type),width:!0,autoStrokeAdjust:!(p||t||u||!y||"cim"===C.type)&&"editable"}}},fill:{color:(0,l.h)(e,C)||K(A[1],.85)},marker:m?{size:h?a(h,i.scale):(0,l.af)(e,C),autoAdjusted:!t&&!u&&!!h}:void 0,stroke:O,fillEnabled:v,strokeEnabled:E}),I.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i}}})=>{(0,l.g)(e).symbol=s,_(e,s,t?.autoAdjusted,i?.autoAdjusted,I,o)}))),c.addStyler(I),await L,U(e,f.symbol,I)}async function I(e,o,s){const{layer:t,portal:i,modules:r}=o,{onChange:a,popoverNode:n}=s,c=t,p="point"===e,u="line"===e;let m=p?c.pointSymbol:u?c.lineSymbol:c.polygonSymbol;X(m)||(m=(0,l.ak)(o,e));const d="picture-marker"!==m.type&&!!m.color,y=(0,l.ah)(m),f=g(o),h="simple-line"===m.type?g(o):b(o);let S;if("simple-fill"===m.type){const e=m;S=e.outline?{color:e.outline.color?e.outline.color:new r.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style,autoAdjusted:!1}:{color:new r.EsriColor([0,0,0,.5]),size:1,style:"solid"}}else if("simple-marker"===m.type){const e=m;S=e.outline?{color:e.outline.color?e.outline.color:new r.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new r.EsriColor([0,0,0,.5]),size:1}}else if("simple-line"===m.type){const e=m;S={color:e.color,size:e.width,style:e.style,marker:e.marker,autoAdjusted:!1}}else S={color:new r.EsriColor([255,255,255,.5]),size:1};const C=await k(o,n);let v;v=z(C,r.esriLang.clone(m),u?{portal:i,sections:{stroke:{type:"color",open:!0,suggestedColorsOpen:!0,suggestedColors:h,extraParts:{width:!0,autoStrokeAdjust:!1}}},stroke:S}:{portal:i,sections:{marker:["simple-marker","picture-marker"].includes(m.type)?{open:!0,symbolsOpen:!0,sizeOpen:!0,markerType:["simple","picture"]}:void 0,fill:{type:"color",optional:!0,open:!0,suggestedColorsOpen:!0,transparencyOpen:(0,l.aj)(o,m),suggestedColors:f},stroke:{type:"color",optional:!0,suggestedColors:h,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(m.type),width:!0,autoStrokeAdjust:!1}}},fill:{color:(0,l.h)(o,m)||K(f[1],.85)},marker:p?{size:(0,l.af)(o,m),autoAdjusted:!1}:void 0,stroke:S,fillEnabled:d,strokeEnabled:y}),C.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:e}})=>{p?c.pointSymbol=e:u?c.lineSymbol=e:c.polygonSymbol=e,a()}))),n.addStyler(C),await v}async function L(e,o){const{portal:s,modules:t}=e,{onChange:i,popoverNode:r}=o,a=(0,l.H)(e),n=(0,l.g)(e),c=(0,l.k)(e),p=(0,l.b)(n,"color"),m=(0,l.d)(n,"reference-size"),d=(0,l.d)(n,"spike");let y;if(["type-size","type-size-age","predominance-size","relationship-size"].includes(c)){const o=(0,l.g)(e);y=o.uniqueValueInfos?.length?o.uniqueValueInfos[0].symbol:(0,l.f)(e,c)}else y=n.classBreakInfos?.length?n.classBreakInfos[0].symbol:(0,l.f)(e,c);X(y)||(y=(0,l.f)(e,c));const f="picture-marker"!==y.type&&!!y.color,h=(0,l.ah)(y),S="cim"===y.type&&"CIMPointSymbol"===y.data.symbol.type,C=g(e),v="simple-line"===y.type?g(e):b(e);let E;if("simple-fill"===y.type){const e=y;E=e.outline?{color:e.outline.color?e.outline.color:new t.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style}:{color:new t.EsriColor([0,0,0,.5]),size:1,style:"solid"}}else if("simple-marker"===y.type){const e=y;E=e.outline?{color:e.outline.color?e.outline.color:new t.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new t.EsriColor([0,0,0,.5]),size:1}}else if("simple-line"===y.type){const e=y;E={color:e.color,size:e.width,style:e.style,marker:e.marker}}else E="cim"===y.type?Q(e,y):{color:new t.EsriColor([255,255,255,.5]),size:1};const j=await k(e,r);let A;m&&(j.mode="minimal"),A=["color-size","color-age-size","color-size-age","type-size","type-size-age","predominance-size","relationship-size"].includes((0,l.k)(e))?z(j,t.esriLang.clone(y),a?{portal:s,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color",open:!0,extraOpen:!0,extraParts:{style:"cim"!==y.type,arrow:"cim"!==y.type,width:!1,autoStrokeAdjust:!1},suggestedColors:v,parts:{suggestedColors:!1,customColor:!1,transparency:!0,extra:"cim"!==y.type}}},stroke:E}:{portal:s,sections:{marker:S||["simple-marker","picture-marker"].includes(y.type)?{open:!0,parts:{size:!1},symbolsOpen:!0,sizeOpen:!1,markerType:(0,l.ai)(e)?["simple","cim:vector"]:["simple"]}:m?{parts:{preview:!1,size:!1,rotation:!1,color:!0,transparency:!0}}:void 0,stroke:{type:"color",open:!0,optional:!0,suggestedColors:v,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(y.type),width:!0,autoStrokeAdjust:!1}}},marker:{size:(0,l.af)(e,y)},stroke:E,strokeEnabled:h}):z(j,t.esriLang.clone(y),a?{portal:s,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color",open:!0,extraParts:{style:"cim"!==y.type,arrow:"cim"!==y.type,width:!1,autoStrokeAdjust:!1},suggestedColorsOpen:!0,suggestedColors:v,parts:{extra:"cim"!==y.type}}},stroke:E}:{portal:s,sections:{marker:S||["simple-marker","picture-marker"].includes(y.type)?{open:!0,parts:{size:!1,preview:!d,rotation:!d,alignment:!d,baseWidth:!!d},symbolsOpen:!0,sizeOpen:!1,markerType:(0,l.ai)(e)?"all":["simple","picture"]}:m?{parts:{preview:!1,size:!1,rotation:!1,color:!0,transparency:!0}}:void 0,fill:{type:"color",open:!0,optional:!0,suggestedColorsOpen:!0,transparencyOpen:(0,l.aj)(e,y),suggestedColors:C},stroke:{type:"color",optional:!0,suggestedColors:v,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(y.type),width:!0,autoStrokeAdjust:!1,hideColor:!!d?.spikeSymbolStyle&&u.includes(d.spikeSymbolStyle),hideTransparency:!!d?.spikeSymbolStyle&&u.includes(d.spikeSymbolStyle)}}},fill:{color:(0,l.h)(e,y)||K(C[1],.85)},marker:{size:(0,l.af)(e,y)},stroke:E,fillEnabled:f,strokeEnabled:h}),j.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:o}})=>{const s=(0,l.g)(e);if(s.classBreakInfos){let i=s.classBreakInfos;if(!i?.length)return;i=i.slice(),i.forEach((i=>{const r=(0,l.af)(e,i.symbol),a=(0,l.h)(e,i.symbol);i.symbol=o.clone(),p?(0,l.j)(e,i.symbol,new t.EsriColor([0,0,0,.5])):s.uniqueValueInfos&&(0,l.j)(e,i.symbol,a),m||d||(0,l.ag)(e,i.symbol,r)})),s.classBreakInfos=i}else{let i=s.uniqueValueGroups;if(!i?.length||!i[0].classes?.length)return;i=i.slice(),i.forEach((s=>{s.classes.forEach((s=>{const i=(0,l.af)(e,s.symbol),r=(0,l.h)(e,s.symbol);s.symbol=o.clone(),p?(0,l.j)(e,s.symbol,new t.EsriColor([0,0,0,.5])):(0,l.j)(e,s.symbol,r),(0,l.ag)(e,s.symbol,i)}))})),s.uniqueValueGroups=i}i()}))),r.addStyler(j),await A}async function x(e,o){const{mapImageSublayer:s,layer:t,mapView:i,portal:r,modules:n}=e,{onChange:c,popoverNode:u}=o,d="subtype-sublayer"===t.type,y=(0,l.G)(e),g=(0,l.H)(e),f=(0,l.e)(e),h=(0,l.g)(e),S=h.authoringInfo,C=(0,l.k)(e),v="univariate-color-size"===S?.type,E="above-and-below"===S?.univariateTheme,j=E&&!S.univariateSymbolStyle,A=(0,l.b)((0,l.g)(e),"color"),V=(0,l.b)(h,"size","auto"),O=(0,l.b)(h,"size","outline"),I=(0,l.d)(h,"reference-size"),L=(0,l.d)(h,"spike"),x=["color-size","color-age-size","color-size-age"].includes(C),q=(0,l.d)((0,l.g)(e),"color");let G,T=A?A.stops.map((e=>e.color)):h.classBreakInfos.map((o=>(0,l.h)(e,o.symbol)?.clone()||new n.EsriColor([0,0,0,0])));T.length>10&&(T=T.slice(0,10)),T.reverse();let B=h.classBreakInfos?.length?h.classBreakInfos[0].symbol:(0,l.f)(e);if(!X(B)||(!E||j)&&!Y(B)){const o=(0,l.af)(e,B)??B.width;B=(0,l.f)(e,C),(0,l.ag)(e,B,o)}const F=!(E&&!A&&"picture-marker"===B.type&&"picture-marker"===h.classBreakInfos[1].symbol?.type),R=(0,l.ah)(B),P="cim"===B.type&&"CIMPointSymbol"===B.data.symbol.type,M=await n.colorUtils.getBackgroundColorTheme(i),N=n.colorSchemes.getSchemes({basemapTheme:M,geometryType:(0,l.I)(e)||p,theme:S?.univariateTheme||q?.theme||"high-to-low"});if(!A){const o=n.colorSchemes.getSchemes({basemap:i.map?.basemap||"topo",geometryType:(0,l.I)(e)||p,theme:"above-and-below"});N.secondarySchemes.push(o.primaryScheme),N.secondarySchemes=N.secondarySchemes.concat(o.secondarySchemes)}const D=A?0:h.classBreakInfos.length;let H=(0,l.ae)(N,D);H=H.filter((e=>e.colors?.length));const W=H.map((e=>({stops:e.colors.reverse(),tags:e.scheme.tags,name:e.scheme.name}))),J=b(e);let $;if((0,l.j)(e,B,T[T.length-1]),(x||y||g)&&V?(0,l.ag)(e,B,a(V,i.scale)):f&&O&&B.outline&&(B.outline.width=a(O,i.scale)),"simple-fill"===B.type){const e=B;$=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style,autoAdjusted:!!O}:{color:new n.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!O}}else if("simple-marker"===B.type){const e=B;$=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new n.EsriColor([0,0,0,.5]),size:1}}else if("cim"===B.type)$=Q(e,B),g&&($.size=V?a(V,i.scale):$.size,$.autoAdjusted=!!V,V&&(0,l.ag)(e,B,$.size));else if("simple-line"===B.type){const e=B;$={color:new n.EsriColor([255,255,255,.5]),size:V?a(V,i.scale):e.width,style:e.style,marker:e.marker,autoAdjusted:!!V}}else $={color:new n.EsriColor([255,255,255,.5]),size:1};const K=await k(e,u);let Z;return I&&(K.mode="minimal"),G=B.clone(),Z=g?z(K,n.esriLang.clone(B),{portal:r,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color-ramp",style:A?"continuous":"discrete",colorRamps:W,open:!0,colorRampsOpen:!0,extraParts:{style:"cim"!==B.type,arrow:"cim"!==B.type,autoStrokeAdjust:!(s||d||x)&&"editable",width:!x},parts:{extra:!x||"cim"!==B.type}}},stroke:{...$,color:T}}):z(K,!E||j?n.esriLang.clone(B):(0,l.f)(e),{portal:r,symbolFilter:f&&!(0,l.ai)(e)?"simple":void 0,sections:{marker:E&&!j||!P&&!["simple-marker","picture-marker"].includes(B.type)?E&&!j?{parts:{preview:!1,rotation:!1,size:!1}}:I?{parts:{preview:!1,size:!1}}:void 0:{open:!0,parts:{size:!x&&(!(!s&&!d)||{autoSizeAdjust:"editable"}),preview:!L,rotation:!L,alignment:!L,baseWidth:!!L},symbolsOpen:!0,sizeOpen:!x,markerType:(0,l.ai)(e)?["simple","cim:vector"]:["simple"]},fill:{type:"color-ramp",style:A?"continuous":"discrete",open:!(0,l.al)(B),colorRampsOpen:!(0,l.al)(B),colorRamps:W},stroke:!E||j?{type:"color",optional:!0,open:!1,suggestedColors:J,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(B.type),width:!0,autoStrokeAdjust:!(s||d||!f||"cim"===B.type||x)&&"editable",hideColor:!!L?.spikeSymbolStyle&&m.includes(L.spikeSymbolStyle),hideTransparency:!!L?.spikeSymbolStyle&&m.includes(L.spikeSymbolStyle)}}:void 0},fill:{color:T},marker:E&&!j||!x&&!y?void 0:{size:V?a(V,i.scale):(0,l.af)(e,B),autoAdjusted:!!V},stroke:$,strokeEnabled:R,fillEnabled:F}),K.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i,fill:r}}})=>{const a=(0,l.g)(e),p=(0,l.b)(a,"color"),u=n.esriLang.clone((r||i).color),m=T[0],d=T.length!==u.length||T.some(((e,o)=>e.r!==u[o].r||e.g!==u[o].g||e.b!==u[o].b))||m.r!==u[0].r||m.g!==u[0].g||m.b!==u[0].b,y=m.a!==u[0].a,g=u[0].a,b=(0,l.ap)(e,s,G);if(d&&!b.any&&(b.any=!0,b.color=!0),v&&E||u.reverse(),!E||j){if(b.any){const o=a.classBreakInfos.slice();o.forEach(((o,t)=>{o.symbol=(0,l.aq)(e,o.symbol,s,d&&!p?u[t%u.length]:y&&!p?(0,l.ar)((0,l.h)(e,o.symbol),g):(0,l.h)(e,o.symbol)||new n.EsriColor([0,0,0,0]),b)})),a.classBreakInfos=o}}else if(!p){u.reverse();const o=a.classBreakInfos.slice();o.forEach(((o,s)=>{(0,l.j)(e,o.symbol,u[s])})),a.classBreakInfos=o}if(p){if(T.length!==u.length&&5===u.length){const e=p.stops.length,o=[];o[0]=p.stops[0],o[1]=p.stops[Math.floor(e/4)],o[2]=p.stops[Math.floor(e/2)],o[3]=p.stops[e-Math.ceil(e/4)],o[4]=p.stops[e-1],p.stops=o}p.stops.forEach(((e,o)=>{e.color=u[o]}));const o=a.classBreakInfos.slice();(0,l.j)(e,o[0].symbol,new n.EsriColor([170,170,170,1])),a.classBreakInfos=o}x?c():_(e,s,t?.autoAdjusted,i?.autoAdjusted,K,o),G=s.clone(),T=p?p.stops.map((e=>e.color)):a.classBreakInfos.map((o=>(0,l.h)(e,o.symbol)||new n.EsriColor([0,0,0,0]))).reverse()}))),u.addStyler(K),await Z,U(e,h.classBreakInfos?.length?h.classBreakInfos[0].symbol:void 0,K,(o=>{f&&B.outline?B.outline.width=o:f||(0,l.ag)(e,B,o),G=B.clone()}))}async function q(e,o){const{mapImageSublayer:s,layer:t,mapView:i,portal:r,modules:n}=e,{onChange:c,popoverNode:u}=o,y="subtype-sublayer"===t.type,g=(0,l.G)(e),f=(0,l.H)(e),h=(0,l.e)(e),S=(0,l.g)(e),C=(0,l.k)(e),v=["type-size","type-size-age"].includes(C),E=(0,l.b)(S,"size","auto"),j=(0,l.b)(S,"size","outline"),A=(0,l.d)(S,"reference-size"),V=(0,l.d)(S,"spike"),O=S.uniqueValueGroups;let I,L=[];const x=O.length?O[O.length-1]:void 0,q=x?.classes?.length&&(0,l.h)(e,x.classes[x.classes.length-1].symbol)?.a||1;O.forEach((o=>L=L.concat(o.classes.map((o=>(0,l.h)(e,o.symbol)||new n.EsriColor([0,0,0,q])))))),L.reverse();let G=0;O.forEach((e=>G+=e.classes.length));const T=n.typeSchemes.getSchemes({basemap:i.map?.basemap,geometryType:(0,l.I)(e)||p,numColors:G});let B=S.uniqueValueGroups?.length&&S.uniqueValueGroups[0].classes.length?n.esriLang.clone(S.uniqueValueGroups[0].classes[0].symbol):(0,l.f)(e,C);if(!Y(B)){const o=(0,l.af)(e,B)??B.width;B=(0,l.f)(e,C),(0,l.ag)(e,B,o)}const F=(0,l.ah)(B),R="cim"===B.type&&"CIMPointSymbol"===B.data.symbol.type,P=(0,l.ae)(T,Math.min(G,10)).map((e=>({stops:e.colors.reverse(),tags:e.scheme.tags,name:e.scheme.name}))),M=b(e);let N;if((0,l.j)(e,B,L[L.length-1]),(v||g||f)&&E?(0,l.ag)(e,B,a(E,i.scale)):h&&j&&B.outline&&(B.outline.width=a(j,i.scale)),"simple-fill"===B.type){const e=B;N=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style,autoAdjusted:!!j}:{color:new n.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!j}}else if("simple-marker"===B.type){const e=B;N=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new n.EsriColor([0,0,0,.5]),size:1}}else if("cim"===B.type)N=Q(e,B),f&&(N.size=E?a(E,i.scale):N.size,N.autoAdjusted=!!E,E&&(0,l.ag)(e,B,N.size));else if("simple-line"===B.type){const e=B;N={color:L[L.length-1],size:E?a(E,i.scale):e.width,style:e.style,marker:e.marker,autoAdjusted:!!E}}else N={color:new n.EsriColor([255,255,255,.5]),size:1};const D=await k(e,u);let H;return A&&(D.mode="minimal"),I=B.clone(),H=z(D,n.esriLang.clone(B),f?{portal:r,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color-ramp",style:"discrete",open:!0,colorRampsOpen:!0,colorRamps:P,extraParts:{style:"cim"!==B.type,arrow:"cim"!==B.type,autoStrokeAdjust:!(s||y||v)&&"editable",width:!v},parts:{extra:!v||"cim"!==B.type}}},stroke:{...N,color:L}}:{portal:r,symbolFilter:h&&!(0,l.ai)(e)?"simple":void 0,sections:{marker:R||["simple-marker","picture-marker"].includes(B.type)?{open:(0,l.al)(B),parts:{size:!v&&(!(!s&&!y)||{autoSizeAdjust:"editable"}),preview:!V,rotation:!V,alignment:!V,baseWidth:!!V},symbolsOpen:!0,sizeOpen:!v,markerType:(0,l.ai)(e)?["simple","cim:vector"]:["simple"]}:A?{parts:{preview:!1,size:!1}}:void 0,fill:{type:"color-ramp",style:"discrete",open:!(0,l.al)(B),colorRampsOpen:!(0,l.al)(B),colorRamps:P,parts:{hideColorRamp:d.includes(V?.spikeSymbolStyle??"")}},stroke:{type:"color",optional:!0,open:!1,suggestedColors:M,parts:{hideColorRamp:d.includes(V?.spikeSymbolStyle??"")},extraParts:{style:!["simple-marker","picture-marker","cim"].includes(B.type),width:!0,autoStrokeAdjust:!(s||y||!h||"cim"===B.type||v)&&"editable",hideColor:!!V?.spikeSymbolStyle&&m.includes(V?.spikeSymbolStyle),hideTransparency:!!V?.spikeSymbolStyle&&m.includes(V.spikeSymbolStyle)}}},fill:{color:L},marker:v||g?{size:E?a(E,i.scale):(0,l.af)(e,B),autoAdjusted:!!E}:void 0,stroke:N,strokeEnabled:F}),D.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i,fill:r}}})=>{const a=n.esriLang.clone((r||i).color),p=L[0],u=L.length!==a.length||L.some(((e,o)=>e.r!==a[o].r||e.g!==a[o].g||e.b!==a[o].b))||p.r!==a[0].r||p.g!==a[0].g||p.b!==a[0].b,m=p.a!==a[0].a,d=a[0].a;a.reverse();const y=(0,l.g)(e),g=(0,l.ap)(e,s,I);if(u&&!g.any&&(g.any=!0,g.color=!0),g.any){const o=y.uniqueValueGroups.slice();let t=0;o.forEach((o=>{o.classes.forEach(((o,i)=>{"picture-marker"===o.symbol.type&&(u||m)&&(o.symbol=n.esriLang.clone(s),(0,l.j)(e,o.symbol,a[(t+i)%a.length])),o.symbol=(0,l.aq)(e,o.symbol,s,u?a[(t+i)%a.length]:m?(0,l.ar)((0,l.h)(e,o.symbol),d):(0,l.h)(e,o.symbol)||new n.EsriColor([0,0,0,0]),g)})),t+=o.classes.length})),y.uniqueValueGroups=o}v?c():_(e,s,t?.autoAdjusted,i?.autoAdjusted,D,o),I=s.clone(),u&&(L=[],y.uniqueValueGroups.forEach((o=>L=L.concat(o.classes.map((o=>(0,l.h)(e,o.symbol)||new n.EsriColor([0,0,0,0])))))),L.reverse(),L.length>10&&(L=L.slice(0,10)))}))),u.addStyler(D),await H,U(e,S.uniqueValueGroups?.length&&S.uniqueValueGroups[0].classes.length?S.uniqueValueGroups[0].classes[0].symbol:void 0,D,(o=>{h&&B.outline?B.outline.width=o:h||(0,l.ag)(e,B,o),I=B.clone()}))}async function G(e,o){const{mapView:s,portal:t,modules:i}=e,{groupIdx:r,onChange:a,popoverNode:n}=o,c=(0,l.g)(e).uniqueValueGroups[r],u=(0,l.h)(e,c.classes[c.classes.length-1].symbol)?.a||1;let m=c.classes.map((o=>(0,l.h)(e,o.symbol)||new i.EsriColor([0,0,0,u])));m.reverse();const d=c.classes.length,y=await i.colorUtils.getBackgroundColorTheme(s),g=i.typeSchemes.getSchemes({basemapTheme:y,geometryType:(0,l.I)(e)||p,numColors:d}),b=i.colorSchemes.getSchemes({basemapTheme:y,geometryType:(0,l.I)(e)||p,theme:"high-to-low"});b.primaryScheme.colors=b.primaryScheme.colorsForClassBreaks[9].colors,b.primaryScheme.colorsForClassBreaks=void 0,b.secondarySchemes=b.secondarySchemes.filter((e=>e.colorsForClassBreaks?.length>=10)),b.secondarySchemes.forEach((e=>{e.colors=e.colorsForClassBreaks[9].colors,e.colorsForClassBreaks=void 0})),g.secondarySchemes.push(b.primaryScheme),g.secondarySchemes=g.secondarySchemes.concat(b.secondarySchemes);const f=(0,l.ae)(g,Math.min(d,10)).map((e=>({stops:e.colors.reverse(),tags:e.scheme.tags,name:e.scheme.name}))),h=await k(e,n),S=z(h,new i.SimpleFillSymbol,{portal:t,sections:{marker:{parts:{preview:!1,rotation:!1,size:!1}},fill:{type:"color-ramp",style:"discrete",open:!0,colorRampsOpen:!0,colorRamps:f,parts:{transparency:!1}}},fill:{color:m}});h.addEventListener("arcgisEdit",w.bind(null,(({detail:{info:{fill:o}}})=>{const s=i.esriLang.clone(o.color).reverse(),t=(0,l.g)(e),n=(0,l.k)(e),c=t.uniqueValueGroups.slice();c[r].classes.forEach(((o,t)=>{"picture-marker"===o.symbol.type&&(o.symbol=(0,l.f)(e,n)),(0,l.j)(e,o.symbol,s[t%s.length])})),t.uniqueValueGroups=c,a(),m=t.uniqueValueGroups[r].classes.map((o=>(0,l.h)(e,o.symbol))),m.reverse(),m.length>10&&(m=m.slice(0,10))}))),n.addStyler(h),await S}async function T(e,o){const{mapImageSublayer:s,layer:t,mapView:i,lastDefault:r,portal:n,modules:c}=e,{onChange:m,popoverNode:d,selectedValue:g}=o,f="subtype-sublayer"===t.type,h=(0,l.i)(e),[S,C]=!h&&g.split("/").map((e=>Number.parseInt(e))),v=(0,l.G)(e),E=(0,l.H)(e),j=(0,l.e)(e),A=(0,l.g)(e),V=(0,l.k)(e),O=["type-size","type-size-age"].includes(V),I=(0,l.b)(A,"size","auto"),L=(0,l.b)(A,"size","outline"),x=(0,l.d)(A,"reference-size"),q=(0,l.d)(A,"spike");let G;G=!h&&-1===S||h&&-1===g?A.defaultSymbol||r.defaultSymbol:h?A.uniqueValueInfos[g].symbol:A.uniqueValueGroups[S].classes[C].symbol,X(G)||(G=h?(0,l.W)(e):(0,l.f)(e,V),(!h&&-1===S||h&&-1===g)&&!A.defaultSymbol&&(r.defaultSymbol=G));const T="picture-marker"!==G.type&&!!G.color,B=(0,l.ah)(G),F="cim"===G.type&&"CIMPointSymbol"===G.data.symbol.type;let R;if(!h&&-1===S||h&&-1===g)R=y(e);else{const o=c.typeSchemes.getSchemes({basemap:i.map?.basemap,geometryType:(0,l.I)(e)||p});R=(0,l.am)(o).slice(0,16)}const P=b(e);let M;if((O||v||E)&&I?(0,l.ag)(e,G,a(I,i.scale)):j&&L&&G.outline&&(G.outline.width=a(L,i.scale)),"simple-fill"===G.type){const e=G;M=e.outline?{color:e.outline.color?e.outline.color:new c.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style,autoAdjusted:!!L}:{color:new c.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!L}}else if("simple-marker"===G.type){const e=G;M=e.outline?{color:e.outline.color?e.outline.color:new c.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new c.EsriColor([0,0,0,.5]),size:1}}else if("cim"===G.type)M=Q(e,G),E&&(M.size=I?a(I,i.scale):M.size,M.autoAdjusted=!!I,I&&(0,l.ag)(e,G,M.size));else if("simple-line"===G.type){const e=G;M={size:I?a(I,i.scale):e.width,style:e.style,marker:e.marker,color:e.color,autoAdjusted:!!I}}else M={color:new c.EsriColor([255,255,255,.5]),size:1};const N=await k(e,d);let D;return x&&(N.mode="minimal"),D=z(N,c.esriLang.clone(G),E?{portal:n,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color",open:!0,suggestedColorsOpen:!0,suggestedColors:R,extraParts:{style:"cim"!==G.type,arrow:"cim"!==G.type,autoStrokeAdjust:!(s||f||O)&&"editable",width:!O},parts:{extra:!O||"cim"!==G.type}}},stroke:M}:h?{portal:n,symbolFilter:"simple",sections:{marker:{parts:{preview:!1,rotation:!1,size:!1}},fill:{type:"color",open:!0,optional:!0,suggestedColorsOpen:!0,suggestedColors:R,parts:{transparency:!1}}},fill:{color:(0,l.h)(e,G)||(-1===g?(0,l.W)(e).color:K(R[g%R.length],.85))},stroke:M,fillEnabled:T}:{portal:n,symbolFilter:j&&!(0,l.ai)(e)?"simple":void 0,sections:{marker:F||["simple-marker","picture-marker"].includes(G.type)?{open:!0,parts:{size:!O&&(!(!s&&!f)||{autoSizeAdjust:"editable"}),preview:!q,rotation:!q,alignment:!q,baseWidth:!!q},symbolsOpen:!0,sizeOpen:!O,markerType:(0,l.ai)(e)?"all":["simple","picture"]}:x?{parts:{preview:!1,size:!1,rotation:!1,color:!0,transparency:!0}}:void 0,fill:{type:"color",open:!0,optional:!0,suggestedColorsOpen:!0,transparencyOpen:(0,l.aj)(e,G),suggestedColors:R},stroke:{type:"color",optional:!0,suggestedColors:P,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(G.type),width:!0,autoStrokeAdjust:!(s||f||!j||"cim"===G.type||O)&&"editable",hideColor:!!q?.spikeSymbolStyle&&u.includes(q.spikeSymbolStyle),hideTransparency:!!q?.spikeSymbolStyle&&u.includes(q.spikeSymbolStyle)}}},fill:{color:(0,l.h)(e,G)||K(R[C%R.length],.85)},marker:O||v?{size:I?a(I,i.scale):(0,l.af)(e,G),autoAdjusted:!!I}:void 0,stroke:M,fillEnabled:T,strokeEnabled:B}),N.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i}}})=>{const r=(0,l.g)(e);if(!h&&-1===S||h&&-1===g)r.defaultSymbol=s;else if(h){const e=r.uniqueValueInfos.slice();e[g].symbol=s,r.uniqueValueInfos=e}else{const e=r.uniqueValueGroups.slice();e[S].classes[C].symbol=s,r.uniqueValueGroups=e}O?m():_(e,s,t?.autoAdjusted,i?.autoAdjusted,N,o)}))),d.addStyler(N),await D,U(e,h?A.uniqueValueInfos?.length?A.uniqueValueInfos[0].symbol:void 0:A.uniqueValueGroups?.length&&A.uniqueValueGroups[0].classes.length?A.uniqueValueGroups[0].classes[0].symbol:void 0,N)}async function B(e,o){const{layer:s,mapImageSublayer:t,mapView:i,portal:r,modules:n}=e,{onChange:c,popoverNode:p}=o,u="subtype-sublayer"===s.type,y=(0,l.G)(e),g=(0,l.H)(e),f=(0,l.e)(e),h=(0,l.g)(e),S=(0,l.k)(e),C="relationship-size"===S,v=(0,l.d)(h,"reference-size"),E=(0,l.d)(h,"spike"),j=(0,l.b)(h,"size","auto"),A=(0,l.b)(h,"size","outline"),V=h.uniqueValueGroups[0].classes,O=V.map((o=>(0,l.h)(e,o.symbol)||new n.EsriColor([0,0,0,0]))),I=n.relationshipSchemes.getSchemes({basemap:i.map?.basemap||"topo",geometryType:(0,l.I)(e)});let L=h.uniqueValueGroups[0].classes?.length?n.esriLang.clone(h.uniqueValueGroups[0].classes[0].symbol):(0,l.f)(e,S);if(!Y(L)){const o=(0,l.af)(e,L)??L.width;L=(0,l.f)(e,S),(0,l.ag)(e,L,o)}const x=(0,l.ah)(L),q="cim"===L.type&&"CIMPointSymbol"===L.data.symbol.type,G=(0,l.ae)(I,Math.sqrt(V.length)).map((({colors:e,scheme:{tags:o,name:s}})=>({stops:n.relationshipSchemes.flatten2DArray(e),tags:o,name:s}))),T=b(e);let B;if("simple-fill"===L.type){const e=L;B=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style,autoAdjusted:!!A}:{color:new n.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!A}}else if("simple-marker"===L.type){const e=L;B=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new n.EsriColor([0,0,0,.5]),size:1}}else if("cim"===L.type)B=Q(e,L),g&&(B.size=j?a(j,i.scale):B.size,B.autoAdjusted=!!j,j&&(0,l.ag)(e,L,B.size));else if("simple-line"===L.type){const e=L;B={color:new n.EsriColor([255,255,255,.5]),size:j?a(j,i.scale):e.width,style:e.style,marker:e.marker,autoAdjusted:!!j}}else B={color:new n.EsriColor([255,255,255,.5]),size:1};const F=await k(e,p);let R;return v&&(F.mode="minimal"),R=z(F,n.esriLang.clone(L),g?{portal:r,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color-ramp",style:"2d",open:!0,colorRampsOpen:!0,colorRamps:G,extraParts:{style:"cim"!==L.type,arrow:"cim"!==L.type,autoStrokeAdjust:!(t||u||C)&&"editable",width:!C},parts:{extra:!C||"cim"!==L.type}}},stroke:{...B,color:O}}:{portal:r,symbolFilter:f&&!(0,l.ai)(e)?"simple":void 0,sections:{marker:q||["simple-marker","picture-marker"].includes(L.type)?{open:(0,l.al)(L),parts:{size:!C&&(!(!t&&!u)||{autoSizeAdjust:"editable"}),preview:!E,rotation:!E,alignment:!E,baseWidth:!!E},symbolsOpen:!0,sizeOpen:!C,markerType:(0,l.ai)(e)?["simple","cim:vector"]:["simple"]}:v?{parts:{preview:!1,size:!1,rotation:!1}}:void 0,fill:{type:"color-ramp",style:"2d",open:!(0,l.al)(L),colorRampsOpen:!(0,l.al)(L),colorRamps:G,parts:{hideColorRamp:d.includes(E?.spikeSymbolStyle??"")}},stroke:{type:"color",optional:!0,open:!1,suggestedColors:T,parts:{hideColorRamp:d.includes(E?.spikeSymbolStyle??"")},extraParts:{style:!["simple-marker","picture-marker","cim"].includes(L.type),width:!0,autoStrokeAdjust:!(t||u||!f||"cim"===L.type||C)&&"editable",hideColor:!!E?.spikeSymbolStyle&&m.includes(E.spikeSymbolStyle),hideTransparency:!!E?.spikeSymbolStyle&&m.includes(E.spikeSymbolStyle)}}},fill:{color:O},marker:C||y?{size:j?a(j,i.scale):(0,l.af)(e,L),autoAdjusted:!!j}:void 0,stroke:B,strokeEnabled:x}),F.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i,fill:r}}})=>{const a=n.esriLang.clone((r||i).color),p=(0,l.g)(e),u=p.uniqueValueGroups[0].classes.slice();u.forEach(((o,t)=>{o.symbol=s.clone(),(0,l.j)(e,o.symbol,a[t%a.length])})),p.uniqueValueGroups[0].classes=u,C?c():_(e,s,t?.autoAdjusted,i?.autoAdjusted,F,o)}))),p.addStyler(F),await R,U(e,h.uniqueValueGroups[0].classes?.length?h.uniqueValueGroups[0].classes[0].symbol:void 0,F)}async function F(e,o){const{layer:s,mapImageSublayer:t,mapView:i,portal:r,modules:n}=e,{onChange:c,popoverNode:p}=o,u="subtype-sublayer"===s.type,m=(0,l.G)(e),d=(0,l.H)(e),y=(0,l.e)(e),g=(0,l.g)(e),f=(0,l.k)(e),h="predominance-size"===f,S=(0,l.b)(g,"size","auto"),C=(0,l.b)(g,"size","outline"),v=g.uniqueValueGroups[0].classes;let E;const j=v.length&&(0,l.h)(e,v[v.length-1].symbol)?.a||1;let A=v.map((o=>(0,l.h)(e,o.symbol)||new n.EsriColor([0,0,0,j])));A.reverse();const V=n.predominanceSchemes.getSchemes({basemap:i.map?.basemap,geometryType:(0,l.I)(e),numColors:v.length});let O=g.uniqueValueGroups[0].classes?.length?n.esriLang.clone(g.uniqueValueGroups[0].classes[0].symbol):(0,l.f)(e,f);if(!Y(O)){const o=(0,l.af)(e,O)??O.width;O=(0,l.f)(e,f),(0,l.ag)(e,O,o)}const I=(0,l.ah)(O),L="cim"===O.type&&"CIMPointSymbol"===O.data.symbol.type,x=(0,l.ae)(V,v.length).map((e=>({stops:e.colors.reverse(),tags:e.scheme.tags,name:e.scheme.name}))),q=b(e);let G;if((0,l.j)(e,O,A[A.length-1]),(h||m||d)&&S?(0,l.ag)(e,O,a(S,i.scale)):y&&C&&O.outline&&(O.outline.width=a(C,i.scale)),"simple-fill"===O.type){const e=O;G=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style,autoAdjusted:!!C}:{color:new n.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!C}}else if("simple-marker"===O.type){const e=O;G=e.outline?{color:e.outline.color?e.outline.color:new n.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new n.EsriColor([0,0,0,.5]),size:1}}else if("cim"===O.type)G=Q(e,O),d&&(G.size=S?a(S,i.scale):G.size,G.autoAdjusted=!!S,S&&(0,l.ag)(e,O,G.size));else if("simple-line"===O.type){const e=O;G={color:new n.EsriColor([255,255,255,.5]),size:S?a(S,i.scale):e.width,style:e.style,marker:e.marker,autoAdjusted:!!S}}else G={color:new n.EsriColor([255,255,255,.5]),size:1};const T=await k(e,p);let B;return E=O.clone(),B=z(T,n.esriLang.clone(O),d?{portal:r,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color-ramp",style:"discrete",open:!0,colorRampsOpen:!0,colorRamps:x,parts:{transparency:!0,extra:!h||"cim"!==O.type},extraParts:{style:"cim"!==O.type,arrow:"cim"!==O.type,autoStrokeAdjust:!(t||u||h)&&"editable",width:!h}}},stroke:{...G,color:A}}:{portal:r,symbolFilter:y&&!(0,l.ai)(e)?"simple":void 0,sections:{marker:L||["simple-marker","picture-marker"].includes(O.type)?{open:(0,l.al)(O),parts:{size:!h&&(!(!t&&!u)||{autoSizeAdjust:"editable"})},symbolsOpen:!0,sizeOpen:!h,markerType:(0,l.ai)(e)?["simple","cim:vector"]:["simple"]}:void 0,fill:{type:"color-ramp",style:"discrete",open:!(0,l.al)(O),colorRampsOpen:!(0,l.al)(O),colorRamps:x},stroke:{type:"color",optional:!0,open:!1,suggestedColors:q,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(O.type),width:!0,autoStrokeAdjust:!(t||u||!y||"cim"===O.type||h)&&"editable"}}},fill:{color:A},marker:h||m?{size:S?a(S,i.scale):(0,l.af)(e,O),autoAdjusted:!!S}:void 0,stroke:G,strokeEnabled:I}),T.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i,fill:r}}})=>{const a=n.esriLang.clone((r||i).color),p=A[0],u=A.length!==a.length||A.some(((e,o)=>e.r!==a[o].r||e.g!==a[o].g||e.b!==a[o].b))||p.r!==a[0].r||p.g!==a[0].g||p.b!==a[0].b,m=p.a!==a[0].a,d=a[0].a;a.reverse();const y=(0,l.g)(e),g=(0,l.ap)(e,s,E);if(u&&!g.any&&(g.any=!0,g.color=!0),g.any){const o=y.uniqueValueGroups[0].classes.slice();o.forEach(((o,t)=>{"picture-marker"===o.symbol.type&&(u||m)&&(o.symbol=n.esriLang.clone(s),(0,l.j)(e,o.symbol,a[t%a.length])),o.symbol=(0,l.aq)(e,o.symbol,s,u?a[t%a.length]:m?(0,l.ar)((0,l.h)(e,o.symbol),d):(0,l.h)(e,o.symbol)||new n.EsriColor([0,0,0,0]),g)})),y.uniqueValueGroups[0].classes=o}h?c():_(e,s,t?.autoAdjusted,i?.autoAdjusted,T,o),E=s.clone(),u&&(A=y.uniqueValueGroups[0].classes.map((o=>(0,l.h)(e,o.symbol)||new n.EsriColor([0,0,0,.5]))),A.reverse())}))),p.addStyler(T),await B,U(e,g.uniqueValueGroups[0].classes?.length?g.uniqueValueGroups[0].classes[0].symbol:void 0,T,(o=>{y&&O.outline?O.outline.width=o:y||(0,l.ag)(e,O,o),E=O.clone()}))}async function R(e,o){const{layer:s,mapImageSublayer:t,mapView:i,selectedValue:r,lastDefault:n,portal:c,modules:p}=e,{onChange:u,popoverNode:m}=o,d="subtype-sublayer"===s.type,g=(0,l.G)(e),f=(0,l.H)(e),h=(0,l.e)(e),S=(0,l.g)(e),C=(0,l.k)(e),v="predominance-size"===C,E=(0,l.b)(S,"size","auto"),j=(0,l.b)(S,"size","outline");let A;A=-1===r?S.defaultSymbol||n.defaultSymbol:S.uniqueValueGroups[0].classes[r].symbol,X(A)||(A=(0,l.f)(e,C),-1!==r||S.defaultSymbol||(n.defaultSymbol=A));const V="picture-marker"!==A.type&&!!A.color,O=(0,l.ah)(A),I="cim"===A.type&&"CIMPointSymbol"===A.data.symbol.type;let L;if(-1===r)L=y(e);else{const o=p.predominanceSchemes.getSchemes({basemap:i.map?.basemap,geometryType:(0,l.I)(e),numColors:10});L=(0,l.am)(o).slice(0,16)}const x=b(e);let q;if((v||g||f)&&E?(0,l.ag)(e,A,a(E,i.scale)):h&&j&&A.outline&&(A.outline.width=a(j,i.scale)),"simple-fill"===A.type){const e=A;q=e.outline?{color:e.outline.color?e.outline.color:new p.EsriColor([0,0,0,.5]),size:e.outline.width,style:e.outline.style,autoAdjusted:!!j}:{color:new p.EsriColor([0,0,0,.5]),size:1,style:"solid",autoAdjusted:!!j}}else if("simple-marker"===A.type){const e=A;q=e.outline?{color:e.outline.color?e.outline.color:new p.EsriColor([0,0,0,.5]),size:e.outline.width}:{color:new p.EsriColor([0,0,0,.5]),size:1}}else if("cim"===A.type)q=Q(e,A);else if("simple-line"===A.type){const e=A;q={size:e.width,style:e.style,marker:e.marker,color:e.color}}else q={color:new p.EsriColor([255,255,255,.5]),size:1};const G=await k(e,m);let T;return T=z(G,p.esriLang.clone(A),f?{portal:c,symbolFilter:(0,l.ai)(e)?void 0:"simple",sections:{stroke:{type:"color",open:!0,suggestedColorsOpen:!0,suggestedColors:L,extraParts:{style:"cim"!==A.type,arrow:"cim"!==A.type,autoStrokeAdjust:!(t||d||v)&&"editable",width:!v},parts:{extra:!v||"cim"!==A.type}}},stroke:q}:{portal:c,symbolFilter:h&&!(0,l.ai)(e)?"simple":void 0,sections:{marker:I||["simple-marker","picture-marker"].includes(A.type)?{open:!0,parts:{size:!v&&(!(!t&&!d)||{autoSizeAdjust:"editable"})},symbolsOpen:!0,sizeOpen:!v,markerType:(0,l.ai)(e)?"all":["simple","picture"]}:void 0,fill:{type:"color",open:!0,optional:!0,suggestedColorsOpen:!0,transparencyOpen:(0,l.aj)(e,A),suggestedColors:L},stroke:{type:"color",optional:!0,suggestedColors:x,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(A.type),width:!0,autoStrokeAdjust:!(t||d||!h||"cim"===A.type||v)&&"editable"}}},fill:{color:(0,l.h)(e,A)||K(L[r],.85)},marker:v||g?{size:E?a(E,i.scale):(0,l.af)(e,A),autoAdjusted:!!E}:void 0,stroke:q,fillEnabled:V,strokeEnabled:O}),G.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:s,info:{marker:t,stroke:i}}})=>{const a=(0,l.g)(e);if(-1===r)a.defaultSymbol=s;else{const e=a.uniqueValueGroups[0].classes.slice();e[r].symbol=s,a.uniqueValueGroups[0].classes=e}v?u():_(e,s,t?.autoAdjusted,i?.autoAdjusted,G,o)}))),m.addStyler(G),await T,U(e,S.uniqueValueGroups[0].classes?.length?S.uniqueValueGroups[0].classes[0].symbol:void 0,G)}async function P(e,o){const{mapView:s,portal:t,strings:i,modules:r}=e,{onChange:a,popoverNode:n}=o,c=(0,l.g)(e),u=c.attributes,m=u.map((e=>e.color)),d=r.pieChartSchemes.getSchemes({basemap:s.map?.basemap,geometryType:(0,l.I)(e)||p,numColors:u.length}),g=y(e),b=(0,l.ae)(d,u.length).map((e=>({stops:e.colors.reverse(),tags:e.scheme.tags,name:e.scheme.name}))),f=(0,l.f)(e);let h;if(f.outline=c.outline,"simple-fill"===f.type)if(f.outline){const e=f.outline;h={color:e.color?e.color:new r.EsriColor([0,0,0,.5]),size:e.width,style:e.style}}else h={color:new r.EsriColor([0,0,0,.5]),size:1,style:"solid"};else if("simple-marker"===f.type&&f.outline){const e=f.outline;h={color:e.color?e.color:new r.EsriColor([0,0,0,.5]),size:e.width,style:e.style}}const S=await k(e,n),C=z(S,f,{portal:t,sections:{marker:{parts:{preview:!1,rotation:!1,size:!1}},fill:{type:"color-ramp",style:"discrete",open:!0,colorRampsOpen:!0,colorRamps:b},stroke:{type:"color",optional:!0,suggestedColors:g,extraParts:{style:!1,width:!0,autoStrokeAdjust:!1}}},fill:{color:m.reverse()},stroke:h});S.stringOverrides={fillColor:i.styler.color,fillTransparency:i.styler.transparency},S.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:o,info:{fill:s}}})=>{const t=r.esriLang.clone(s.color);t.reverse(),(0,l.g)(e).attributes.forEach(((e,o)=>e.color=t[o])),(0,l.g)(e).outline=o.outline.clone(),a()}))),n.addStyler(S),await C}async function M(e,o){const{mapView:s,selectedAttribute:t,lastDefault:i,portal:r,strings:a,modules:n}=e,{onChange:c,popoverNode:u}=o,m=(0,l.g)(e),d=m.attributes;let y;y=-1===t?m.othersCategory?.color||i?.otherColor||new n.EsriColor([170,170,170,1]):-2===t?m.defaultColor||i?.defaultColor||new n.EsriColor([170,170,170,1]):d[t].color;const g=n.pieChartSchemes.getSchemes({basemap:s.map?.basemap,geometryType:(0,l.I)(e)||p,numColors:d.length}),b=(0,l.am)(g).slice(0,16),f=(0,l.f)(e);f.outline=void 0,(0,l.j)(e,f,y);const h=await k(e,u),S=z(h,f,{portal:r,sections:{marker:{parts:{preview:!1,rotation:!1,size:!1}},fill:{type:"color",open:!0,suggestedColorsOpen:!0,suggestedColors:b}},fill:{color:y}});h.stringOverrides={fillColor:a.styler.color,fillTransparency:a.styler.transparency},h.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:o}})=>{-1===t?(0,l.g)(e).othersCategory?(0,l.g)(e).othersCategory.color=(0,l.h)(e,o):(0,l.g)(e).othersCategory={color:(0,l.h)(e,o),label:i?.otherLabel||a.styler.other,threshold:i?.threshold??0}:-2===t?(0,l.g)(e).defaultColor=(0,l.h)(e,o):(0,l.g)(e).attributes[t].color=(0,l.h)(e,o),c()}))),u.addStyler(h),await S}async function N(e,o){const{mapView:s,portal:t,strings:i,modules:r}=e,{onChange:a,popoverNode:n}=o,c=(0,l.g)(e).attributes,p=c.map((e=>e.color)),u=r.dotDensitySchemes.getSchemes({basemap:s.map?.basemap,numColors:c.length}),m=(0,l.ae)(u,c.length).map((e=>({stops:e.colors,tags:e.scheme.tags,name:e.scheme.name}))),d=await k(e,n),y=z(d,(0,l.f)(e),{portal:t,sections:{marker:{parts:{preview:!1,rotation:!1,size:!1}},fill:{type:"color-ramp",style:"discrete",open:!0,colorRampsOpen:!0,colorRamps:m}},fill:{color:p}});d.stringOverrides={fillColor:i.styler.dotColor,fillTransparency:i.styler.dotTransparency},d.addEventListener("arcgisEdit",w.bind(null,(({detail:{info:{fill:o}}})=>{(0,l.g)(e).attributes.forEach(((e,s)=>e.color=o.color[s])),a()}))),n.addStyler(d),await y}async function D(e,o){const{mapView:s,portal:t,strings:i,modules:r}=e,{onChange:a,popoverNode:n,selectedAttribute:c}=o,p=(0,l.g)(e).attributes,u=r.dotDensitySchemes.getSchemes({basemap:s.map?.basemap,numColors:p.length}),m=(0,l.am)(u).slice(0,16),d=await k(e,n),y=z(d,(0,l.f)(e),{portal:t,sections:{marker:{parts:{preview:!1,rotation:!1,size:!1}},fill:{type:"color",open:!0,suggestedColorsOpen:!0,suggestedColors:m}},fill:{color:p[c].color}});d.stringOverrides={fillColor:i.styler.dotColor,fillTransparency:i.styler.dotTransparency},d.addEventListener("arcgisEdit",w.bind(null,(({detail:{symbol:o}})=>{(0,l.g)(e).attributes[c].color=(0,l.h)(e,o),a()}))),n.addStyler(d),await y}async function H(e,o){const{mapView:s,portal:t,strings:i,modules:r}=e,{onChange:a,popoverNode:n}=o,c=(0,l.g)(e).colorStops,p=c.filter(((e,o)=>o>=3)).map((e=>e.color)),u=await r.colorUtils.getBackgroundColorTheme(s),m=r.heatmapSchemes.getSchemes({basemapTheme:u}),d=(0,l.ae)(m,c.length).map((e=>({stops:e.colors.reverse(),tags:e.scheme.tags,name:e.scheme.name}))),y=await k(e,n),g=z(y,(0,l.f)(e),{portal:t,sections:{marker:{parts:{preview:!1,rotation:!1,size:!1}},fill:{type:"color-ramp",style:"continuous",open:!0,colorRampsOpen:!0,colorRamps:d,parts:{transparency:!1}}},fill:{color:p.reverse()}});y.stringOverrides={fillTransparency:i.styler.transparency},y.addEventListener("arcgisEdit",w.bind(null,(({detail:{info:{fill:o}}})=>{const s=r.esriLang.clone(o.color);s.reverse();const t=Math.max(c.length-s.length,0);(0,l.g)(e).colorStops.forEach(((e,o)=>{const l=e.color.a;e.color=o<=t-2||o<=t?r.esriLang.clone(s[0]):r.esriLang.clone(s[o-t]),e.color.a=l})),a()}))),n.addStyler(y),await g}function _(e,o,s,t,i,r){const{modules:n}=e,c=(0,l.G)(e),p=(0,l.H)(e);c?W(e,s,(0,l.af)(e,o),o,i,r):p?W(e,t,(0,l.af)(e,o),o,i,r):function(e,o,s,t,i,r){const{mapView:n}=e,{onChange:c}=r,p=(0,l.g)(e),u=(0,l.b)(p,"size","outline");o&&!u?oe(e).then((o=>{if(o){const s=(0,l.g)(e);s.visualVariables=s.visualVariables||[],s.visualVariables.push(o),$(o,n.scale,t,i)}c()})):!o&&u?(p.visualVariables=p.visualVariables.filter((e=>!("size"===e.type&&"outline"===e.target))),p.visualVariables&&!p.visualVariables.length&&(p.visualVariables=void 0),c()):(o&&function(e,o,s){const{mapView:t}=e,{onChange:i}=s,r=t.scale,n=(0,l.g)(e),c=(0,l.b)(n,"size","outline"),p=c.stops;if(0!==o&&0===p[p.length-2].size)oe(e).then((s=>{if(s){const t=a(s,r);J(s,(0===o?Math.max(.5,o):o)/(0===t?Math.max(.5,t):t));const n=(0,l.a)((0,l.g)(e),"size","outline")||[];n.push(s),(0,l.g)(e).visualVariables=n,i(),setTimeout((()=>{}),2e3)}}));else{const e=a(c,r),s=(0===o?Math.max(.5,o):o)/(0===e?Math.max(.5,e):e);J(c,s),0!==o&&0!==e||(!function(e,o,s){const l=e.stops,t=l.length-1,i=l[0].value,r=l[t].value;if(o<=i){for(let e=0;e<=t;e++)l[e].size=s;return}if(o>=r)return void(l[t].size=s);for(let e=0;e<t;e++){const i=l[e],r=l[e+1];if(o>=i.value&&o<r.value){for(let o=e+1;o<=t;o++)l[o].size=s;break}}}(c,r,o),c.stops.forEach(((e,o)=>{o>0&&e.size===c.stops[o-1].size&&(o===c.stops.length-1?o>1&&(c.stops[o-1].size=(c.stops[o-2].size+e.size)/2):e.size=(c.stops[o+1].size+c.stops[o-1].size)/2)})))}}(e,s,r),c())}(e,t,"cim"===o.type?(0,l.as)(o):(0,l.af)(e,o.outline||new n.SimpleLineSymbol),o,i,r)}function W(e,o,s,t,i,r){const{mapView:n}=e,{onChange:c}=r,p=(0,l.g)(e);s=Math.max(s,.1);const u=(0,l.b)(p,"size","auto");if(o&&!u)(async function(e){const{layer:o,useFeatureReduction:s,mapView:t,modules:i}=e,r=o;return await i.LocationCreator.createRenderer({layer:r,view:t,outlineOptimizationEnabled:!1,sizeOptimizationEnabled:!0,forBinning:"binning"===r.featureReduction?.type&&s}).then((e=>(0,l.b)(e.renderer,"size","auto")))})(e).then((o=>{if(o){const s=(0,l.g)(e);if(s.visualVariables=s.visualVariables||[],s.visualVariables.push(o),(0,l.an)(t)){J(o,(0,l.af)(e,t)/a(o,n.scale))}$(o,n.scale,t,i)}c()}));else if(!o&&u){const e=(0,l.a)(p,"size","auto");p.visualVariables=e?.length?e:void 0,c()}else o&&function(e,o){const{mapView:s}=e,t=s.scale,i=(0,l.g)(e),r=(0,l.b)(i,"size","auto"),n=a(r,t),c=o/n;J(r,c)}(e,s),c()}function J(e,o){e.stops?.forEach((e=>{e.size*=o}))}function U(e,o,s,t){const{mapView:i,modules:r}=e;let a;return r.reactiveUtils.when((()=>i.stationary),(()=>{const r=i.scale;if(a!==r){const i=(0,l.g)(e),n=(0,l.b)(i,"size","simple-fill"===o.type?"outline":"auto");n&&$(n,r,o,s,t),a=r}}))}function $(e,o,s,t,i){const r=a(e,o),n=["simple-line","simple-fill"].includes(s.type)||(0,l.an)(s)?"stroke":"marker";t.setSize(n,r),i?.(r)}function K(e,o){return e&&(e.a=o),e}function Q(e,o){const{modules:s}=e;if((0,l.an)(o))return{color:(0,l.h)(e,o)?.clone()||new s.EsriColor([255,255,255,.5]),size:(0,l.af)(e,o)??1};{const e=(0,l.ao)(o);return{color:e?.color?new s.EsriColor(e?.color):new s.EsriColor([255,255,255,.5]),size:e?.width??1}}}function X(e){return["simple-fill","simple-marker","simple-line","picture-marker","cim"].includes(e?.type)}function Y(e){return["simple-fill","simple-marker","simple-line","cim"].includes(e.type)}async function Z(e,o){const{layer:s,useFeatureReduction:i,mapImageSublayer:r,mapView:a,modules:n}=e,c=s;o=o||{};const p=(0,l.at)(e,(0,l.g)(e));return await n.LocationCreator.createRenderer({layer:c,view:a,outlineOptimizationEnabled:!r&&(!(0,t.i)(o.outlineOptimizationEnabled)||o.outlineOptimizationEnabled),sizeOptimizationEnabled:!r&&(!(0,t.i)(o.sizeOptimizationEnabled)||o.sizeOptimizationEnabled),forBinning:"binning"===c.featureReduction?.type&&i}).then((e=>((0,l.au)(p,e.renderer),e)))}async function ee(e,o){const{layer:s,useFeatureReduction:i,mapImageSublayer:r,mapView:a,modules:n}=e,c=s;o=o||{};const p=(0,l.g)(e),u=(0,l.k)(e),m=(0,l.at)(e,p),d=p.symbol?p.symbol:(0,l.f)(e,u),y={layer:c,view:a,outlineOptimizationEnabled:!r&&((0,t.i)(o.outlineOptimizationEnabled)?o.outlineOptimizationEnabled:!!m.sizeOutlineVisVar),sizeOptimizationEnabled:!r&&((0,t.i)(o.sizeOptimizationEnabled)?o.sizeOptimizationEnabled:!!m.sizeAutoVisVar),forBinning:"binning"===c.featureReduction?.type&&i};return await n.LocationCreator.createRenderer(y).then((e=>((0,l.au)(m,e.renderer),d&&(e.renderer.symbol=d),e)))}async function oe(e){const{layer:o,useFeatureReduction:s,mapView:t,modules:i}=e,r=o;return await i.LocationCreator.createRenderer({layer:r,view:t,outlineOptimizationEnabled:!0,forBinning:"binning"===r.featureReduction?.type&&s}).then((e=>(0,l.b)(e.renderer,"size","outline")))}}}]);