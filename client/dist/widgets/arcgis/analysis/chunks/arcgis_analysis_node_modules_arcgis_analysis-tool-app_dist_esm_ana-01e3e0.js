"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_analysis-tool-app_dist_esm_ana-01e3e0"],{36030:(e,t,s)=>{s.r(t),s.d(t,{analysis_tool_app_container:()=>k,analysis_tool_credit_settings:()=>X,analysis_tool_credits:()=>U,analysis_tool_credits_popover:()=>j,analysis_tool_geoanalytics_settings:()=>Y,analysis_tool_raster_settings:()=>K,analysis_tool_settings:()=>B,analysis_tool_standard_settings:()=>$});var a=s(70562),i=s(79246),o=s(54458),r=s(33763);function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var l,c={exports:{}};var h=n(function(){if(l)return c.exports;function e(e,t,s,a){var i,o=null==(i=a)||"number"==typeof i||"boolean"==typeof i?a:s(a),r=t.get(o);return void 0===r&&(r=e.call(this,a),t.set(o,r)),r}function t(e,t,s){var a=Array.prototype.slice.call(arguments,3),i=s(a),o=t.get(i);return void 0===o&&(o=e.apply(this,a),t.set(i,o)),o}function s(e,t,s,a,i){return s.bind(t,e,a,i)}function a(a,i){return s(a,this,1===a.length?e:t,i.cache.create(),i.serializer)}function i(){return JSON.stringify(arguments)}function o(){this.cache=Object.create(null)}l=1,o.prototype.has=function(e){return e in this.cache},o.prototype.get=function(e){return this.cache[e]},o.prototype.set=function(e,t){this.cache[e]=t};var r={create:function(){return new o}};return c.exports=function(e,t){var s=t&&t.cache?t.cache:r,o=t&&t.serializer?t.serializer:i;return(t&&t.strategy?t.strategy:a)(e,{cache:s,serializer:o})},c.exports.strategies={variadic:function(e,a){return s(e,this,t,a.cache.create(),a.serializer)},monadic:function(t,a){return s(t,this,e,a.cache.create(),a.serializer)}},c.exports}());function d(e){return(0,i.f)(e,4)}function p(e,t,s){return null==e?e:(0,i.g)(e,t,s)}const m="esriExecutionTypeAsynchronous",g="GPString",u="esriGPParameterDirectionInput",y="esriGPParameterDirectionOutput",v="esriGPParameterTypeOptional",b="feature",f="imagery",S="parameterViewModel";var C={map:{OtherHelpLinks:{creditsAnalysis:"analyze/credits-analysis-mv.htm",errorMessages:{noPermissionToAccessTool:"analyze/custom-web-tools-mv.htm#ESRI_SECTION1_A45007CCCFC6446FB2D268803A80F170",specialCharactersInServiceNameError:"analyze/perform-analysis-mv.htm#ESRI_SECTION1_5EACA346CAB14E699818819B44ACBD01",premiumTool:"analyze/analysis-session-mv.htm#ESRI_SECTION1_8E287CDA9CC344EA8FA45689D1F9C5DE",missingRequiredPrivileges:"analyze/licensing-analysis-mv.htm"}}}};var E={map:{OtherHelpLinks:{errorMessages:{noPermissionToAccessTool:"120004851",specialCharactersInServiceNameError:"120004279"}}}};const T="tool-footer",x="header-scene-viewer",P="toolbar",k=class{constructor(e){(0,a.r)(this,e),this.analysisToolAppJobStatusChange=(0,a.c)(this,"analysisToolAppJobStatus"),this.analysisToolAppJobResultDataComplete=(0,a.c)(this,"analysisToolAppJobResultDataComplete"),this.analysisToolAppPanelChange=(0,a.c)(this,"analysisToolAppPanelChange"),this.analysisToolAppJobSubmissionAttempt=(0,a.c)(this,"analysisToolAppJobSubmissionAttempt"),this.analysisToolAppDisconnect=(0,a.c)(this,"analysisToolAppDisconnect"),this.analysisToolAppLoaded=(0,a.c)(this,"analysisToolAppLoaded"),this.locale=o.F.EnglishUSA,this.errorStrings={},this.gpMessages={},this.commonStrings={},this.isWebToolOpening=!1,this.runAnalysisDisabled=!1,this.validationStatus=o.b.Valid,this.toolErrorState={toolAppErrorState:[],parameterErrorState:{}},this.showHeader=!0,this.runAnalysisBtnClick=async()=>{const e=[await this.toolElement.validateTool(),await this.toolSettingsElement.validateSettings()];this.validationStatus=(0,o.h)(e),this.toolErrorState=(0,o.f)(this.toolErrorState,e),this.validationStatus!==o.b.Error?this.executeAnalysis(this.portal.isPortal):this.scrollToTop()},this.handleCalciteNoticeClose=()=>{this.validationStatus=o.b.Valid},this.memoizeHelperFetchPath=async e=>{const t=await fetch((0,a.g)(e));return await t.json()},this.getCurrentToolJSONs=h((async(e,t)=>{let s,r,n,l;if(void 0!==this.webToolServerUrl&&void 0===this.webToolJSON){this.isWebToolOpening=!0;try{s=await(0,i.l)(this.webToolServerUrl,t)}catch(e){this.toolErrorState.toolAppErrorState=[(0,o.g)({errorKey:o.H.CannotReopenWebTool,type:o.b.Error})],s=void 0,this.validationStatus=o.b.Error}this.isWebToolOpening=!1}else{const e=h(this.memoizeHelperFetchPath),i=await(0,o.$)({locale:this.locale,name:t,assetPrefix:(0,a.g)("assets"),analysisEngine:this.analysisEngine,uiMode:o.n.Standalone,memoizedHelper:e});if(s=i.toolJson,r=i.toolT9n,l=i.toolUIJson,void 0!==i.toolHelpFilePath&&(n=(0,a.g)(i.toolHelpFilePath)),void 0!==l&&void 0!==this.travelModeInfo){l.travelModeInfo=this.travelModeInfo;const e=this.travelModeInfo?.travelModes?.filter((e=>e.id===this.travelModeInfo?.defaultTravelModeId))[0];void 0!==l.travelModeInfo&&void 0!==e&&(l.travelModeInfo.defaultTravelMode=e)}}return{toolJson:s??{name:this.toolName,displayName:this.toolName},toolUIJson:l,toolUIStrings:r,toolHelpFilePath:n}})),this.haveWebToolParametersChanged=(e,t)=>{const s=new Map(e.parameters?.filter((e=>"context"!==e.name&&e.direction!==y))?.map((e=>[e.name,e]))),a=Object.keys(t);if(s.size!==a.length)return!0;let i=!1;for(const e of a){const a=s.get(e),o=t[e];if(i=void 0===a||a?.dataType!==o.dataType||a?.parameterType!==o.parameterType,i)break}return i},this.onToolDataChange=e=>{const{toolUIStrings:t}=this.currentToolJSONs??{},s=t?.itemProperties,a=e?.detail,i=a?.toolData??{},r=a?.parameterName??"";void 0===s||(0,o.d)(i)||(i.itemProperties=s);const n=(0,o.o)(this.currentToolJSONs?.toolJson,i),l=(0,o.Q)(n);this.currentJobParams={...l};const c=(0,o.q)({toolData:i,keysToRemove:Object.keys(this.currentJobParams)});(0,o.d)(c)||(this.toolUiParameters=c),this.resetParameterErrorState(r)},this.resetParameterErrorState=e=>{delete this.toolErrorState?.parameterErrorState[e]},this.clearCreditsEstimation=()=>{void 0!==this.creditsElement&&this.creditsElement.clearCreditsEstimation()},this.renderAnalysisTool=()=>{const{toolJson:e,toolUIJson:t,toolUIStrings:s,toolHelpFilePath:r}=this.currentToolJSONs??{},n=r?.replace(e.name,"AnalysisEnvironments").replace("_ra","");return(0,a.h)("div",null,(0,a.h)("analysis-tool",{key:e.name,analysisEngine:this.analysisEngine,closable:!1,usePanel:!1,toolJson:e,toolUIJson:t,toolUIStrings:s,toolHelpFilePath:r,isHelpFileExternalAsset:!0,mapLayers:this.currentMapLayers,mapView:this.mapView,portal:this.portal,portalHelpMap:this.portalHelpMap,serviceUrl:this.webToolServerUrl,skipApplyingDefaults:!(0,o.d)(this.toolDataFromHistory),supportsUpload:"Uploads"===e.serviceInfo?.capabilities,user:this.portal.user??void 0,toolData:this.toolDataFromHistory,toolHelpPopover:this.toolHelpPopover,parameterNotificationState:this.toolErrorState.parameterErrorState,ref:e=>{this.toolElement=e},onAnalysisToolDataChange:this.onToolDataChange,onAnalysisToolHelpPopoverChange:()=>{(0,o.r)(this.toolHelpPopover),this.toolHelpPopover=this.toolElement?.toolHelpPopover},onAnalysisCustomRuleExecuting:e=>this.isWebToolOpening=e.detail}),(0,a.h)("analysis-tool-settings",{portal:this.portal,mapLayers:this.currentMapLayers,toolHelpFilePath:n,environmentSettingsFlags:t?.environmentSettings,hideRasterSettings:this.analysisEngine!==i.A.Raster,hideGeoanalyticsSettings:this.analysisEngine!==i.A.GeoAnalytics,ref:e=>{this.toolSettingsElement=e}}))},this.composeErrorMessage=e=>{const{message:t,key:s,variables:a}=e,i="default"in this.errorStrings?this.errorStrings.default:"",r="request:server"===s?this.errorStrings.jobCurrentParameters:void 0,n=t??this.errorStrings?.[s??""]??this.strings?.[s]??r??i,l={docLink:this.getLearnMoreLink(s??""),...a};return(0,o.t)(n,l)},this.getErrorMessages=()=>this.toolErrorState.toolAppErrorState.filter((e=>e.type===this.validationStatus)).map(this.composeErrorMessage),this.renderNoticeMessage=()=>{const e=this.getErrorMessages(),t=e.length>1,s=e.map((e=>(0,a.h)("li",null,e)));return t?(0,a.h)("ul",{slot:"message"},s):(0,a.h)("div",{slot:"message",innerHTML:e[0]})},this.renderCreditEstimation=()=>(0,o.d)(this.webToolJSON)&&!0!==this.portal.isPortal&&!0!==(0,o._)(this.portal)?(0,a.h)("analysis-tool-credits",{ref:e=>{this.creditsElement=e},toolSettingsElement:this.toolSettingsElement,toolElement:this.toolElement,toolName:this.toolName,analysisEngine:this.analysisEngine??i.A.Standard,toolJson:this.currentToolJSONs?.toolJson,portal:this.portal}):null,this.getCalciteNoticeKind=()=>{let e;switch(this.validationStatus){case o.b.Info:e="info";break;case o.b.Error:e="danger";break;case o.b.Warning:e="warning"}return e},this.onBackClick=()=>{this.analysisToolAppPanelChange.emit(),this.isWebToolOpening=!1},this.renderPanel=()=>{const{toolUIStrings:e,toolHelpFilePath:t,toolJson:s}=this.currentToolJSONs??{};let i,r;return!1===(0,o.d)(this.toolName)&&(i=`${(0,o.J)(this.toolName)}${(0,o.u)(this.analysisEngine)}`,r=e?.toolInfo?.[i]??this.toolName),(0,a.h)("calcite-panel",{loading:this.isWebToolOpening,dir:this.dir,closable:this.panelClosable??!1,onCalcitePanelClose:()=>this.analysisToolAppPanelChange.emit(),ref:e=>{this.panelElement=e}},(0,a.h)("calcite-action",{class:"analysis-panel-back-button",icon:"rtl"===this.dir?"chevron-right":"chevron-left",onClick:this.onBackClick,scale:"s",slot:"header-actions-start",text:this.strings.backLabel,title:this.strings.backLabel}),(0,a.h)("slot",{name:P}),this.showHeader&&(0,a.h)("div",{slot:"header-content",ref:e=>{this.headerElement=e},class:"SceneViewer"===this.clientMode?x:""},r),this.showHeader&&(0,a.h)("calcite-action",{label:"",text:"",icon:"information",slot:"header-actions-end",onClick:()=>{this.toolHelpPopover=(0,o.s)(this.toolHelpPopover,{helpUrl:t,helpId:"toolDescription",heading:r,referenceElement:this.headerElement,isHelpFileExternalAsset:!0,portal:this.portal,portalHelpMap:this.portalHelpMap,helpFileName:s.name,analysisEngine:this.analysisEngine,learnMoreBaseUrl:this.portal?.sourceJSON.helpBase,offsetDistance:55,offsetSkidding:10})}}),this.validationStatus!==o.b.Valid&&(0,a.h)("calcite-notice",{open:!0,closable:this.validationStatus===o.b.Error,kind:this.getCalciteNoticeKind(),icon:this.validationStatus===o.b.Info,scale:"m",width:"auto",onCalciteNoticeClose:this.handleCalciteNoticeClose,class:o.S.noticeMarginGlobal},this.renderNoticeMessage()),this.renderAnalysisTool(),(0,a.h)("div",{slot:"footer",class:T},this.renderCreditEstimation(),(0,a.h)("calcite-button",{appearance:"solid",kind:"brand",width:"half",alignment:"center",scale:"m",disabled:this.runAnalysisDisabled,loading:this.runAnalysisDisabled,slot:"footer-actions",onClick:this.runAnalysisBtnClick},this.strings.runAnalysisLabel),(0,a.h)("calcite-button",{appearance:"outline",kind:"brand",width:"half",alignment:"center",scale:"m",disabled:this.runAnalysisDisabled,slot:"footer-actions",onClick:()=>this.analysisToolAppPanelChange.emit()},this.strings.backLabel)))}}async toolNameChange(e,t){(0,o.d)(e)||(0,i.i)(e,t)||(await this.fetchToolJSONs(),(0,i.s)(this.currentToolJSONs?.toolUIJson,this.analysisEngine,this.readEnvironmentSettings))}async onMapLayersChange(e){this.currentMapLayers=await(0,o.v)(e,this.commonStrings)}async onJobParamsChange(e,t){if(null!=e)try{const s=this.portal?.user??void 0,a=void 0!==this.webToolServerUrl&&void 0!==this.webToolJSON;let r,n={},l=[];if(!(0,i.i)(e,t)&&!1===(0,o.d)(this.toolName)){if(a)r=this.webToolJSON;else{const e=(0,o.V)(this.toolName),t=await this.getCurrentToolJSONs(this.locale,e);r=t?.toolJson}if(void 0!==e&&void 0!==r)try{const{convertedJobParams:t,layers:c,resultingErrorState:h}=await(0,o.w)({jobParams:e,toolJSON:r,uiOnlyParams:this.toolUiParameters??{},availableMapLayers:this.currentMapLayers,toolName:this.toolName});if(n=t,l=c,this.toolErrorState=h,this.toolDataFromHistory={...n,userSettings:{unitSystem:s?.units,hasNAPrivilege:(0,o.W)(s)},...this.toolUiParameters},(0,i.b)(this.toolDataFromHistory?.context),this.currentMapLayers=[...this.currentMapLayers??[],...l],a&&void 0!==r&&void 0!==this.toolUiParameters?.[S]){this.haveWebToolParametersChanged(r,this.toolUiParameters[S])&&(this.validationStatus=o.b.Info,this.toolErrorState.toolAppErrorState=[(0,o.g)({errorKey:o.H.WebToolJSONChanged,type:o.b.Info})])}}catch(e){this.validationStatus=o.b.Warning,this.toolErrorState.toolAppErrorState=[(0,o.g)({errorKey:o.H.CannotReopenTool,type:o.b.Warning})]}}}catch(e){console.error(e)}}onMapViewChange(e){o.a.mapView=e}async portalNameChange(){await this.fetchToolJSONs()}portalHelpMapChange(e){o.a.portalHelpMap=e}async webToolJSONChange(e){if(void 0!==e){this.currentToolJSONs={toolJson:e,toolUIJson:await(0,o.x)(e,`${(0,a.g)("assets")}/t9n/common.t9n.${this.locale}.json`,this.memoizeHelperFetchPath)};const t=e.parameters?.some((e=>"context"===e.name&&"GPString"===e.dataType));if(!1===t){const e={name:"context",dataType:g,displayName:"context",description:"Additional settings such as processing extent and output spatial reference.",direction:u,defaultValue:"",parameterType:v,category:""};this.currentToolJSONs.toolJson.parameters?.push(e)}(0,i.s)(this.currentToolJSONs?.toolUIJson,this.analysisEngine,this.readEnvironmentSettings)}}async componentWillLoad(){const{rtl:e,locale:t}=(0,o.P)(this.hostElement);({strings:this.strings}=await(0,o.G)(this.hostElement,(0,a.g)("."))),this.dir=!0===e?"rtl":"ltr",this.locale=t;const s=`${(0,a.g)("assets")}/t9n/validation/errors.t9n.${t??"en-US"}.json`,i=`${(0,a.g)("assets")}/t9n/gpmessage/gpmessage.t9n.${t??"en-US"}.json`,r=`${(0,a.g)("assets")}/t9n/common.t9n.${t??"en-US"}.json`;try{const e=await fetch(s);this.errorStrings=await e.json()}catch(e){console.error(e)}try{const e=await fetch(i);this.gpMessages=await e.json()}catch(e){console.error(e)}try{const e=await fetch(r);this.commonStrings=await e.json()}catch(e){console.error(e)}void 0!==this.toolName&&void 0===this.webToolJSON&&await this.toolNameChange(this.toolName,void 0),void 0!==this.webToolJSON&&await this.webToolJSONChange(this.webToolJSON),void 0!==this.mapLayers&&await this.onMapLayersChange(this.mapLayers),void 0!==this.jobParams&&await this.onJobParamsChange(this.jobParams,void 0),void 0===this.jobParams&&void 0===this.currentJobParams&&this.onToolDataChange({detail:{toolData:this.toolElement?.toolData,parameterName:void 0}}),this.clearCreditsEstimation(),o.a.mapView=this.mapView,o.a.portal=this.portal,this.portalHelpMapChange(this.portalHelpMap)}componentDidLoad(){setTimeout((()=>requestAnimationFrame((()=>this.panelElement?.setFocus?.()))),1),this.analysisToolAppLoaded.emit()}componentDidRender(){void 0!==this.toolElement&&null!==this.toolElement&&(this.toolElement.environmentSettings=o.a.context,o.a.analysisToolRef=this.toolElement)}disconnectedCallback(){(0,o.r)(this.toolHelpPopover),this.onToolDataChange({detail:{toolData:this.toolElement?.toolData,parameterName:void 0}}),this.analysisToolAppDisconnect.emit({jobParams:(0,o.c)(this.currentJobParams??{},this.toolName,this.toolUiParameters),toolUiParameters:this.toolUiParameters}),o.a.analysisToolRef=void 0,o.a.context={},o.a.settingsSelectedExtentOption=o.E.Default,o.a.settingsSelectedOutSpatialRefOption=o.O.SameAsInput,this.validationStatus=o.b.Valid,this.toolErrorState={toolAppErrorState:[],parameterErrorState:{}}}onAnalysisStudioHistoryOpenTool(){this.clearCreditsEstimation()}onJobStatus(e){this.analysisToolAppJobStatusChange.emit(e.detail),void 0!==e.detail.submissionData&&(this.runAnalysisDisabled=!1)}onJobResultDataComplete(e){this.analysisToolAppJobResultDataComplete.emit(e.detail)}onAnalysisToolCreditsValidationFailure(e){const t=[e.detail];this.validationStatus=(0,o.h)(t),this.toolErrorState=(0,o.f)(this.toolErrorState,t),this.validationStatus===o.b.Error&&this.scrollToTop()}async fetchToolJSONs(){if(!1===(0,o.d)(this.toolName)&&void 0!==this.portal){const e=(0,o.d)(this.webToolServerUrl)?(0,o.V)(this.toolName):this.toolName;if(void 0===this.travelModeInfo&&!0===(0,o.y)(e))try{this.travelModeInfo=await(0,i.h)(this.portal)}catch{}const t=await this.getCurrentToolJSONs(this.locale,e);this.currentToolJSONs={...t}}}generateAnalysisParams(){if(void 0===this.currentJobParams)throw new Error("jobParams are undefined");const e=void 0!==this.webToolServerUrl&&void 0!==this.webToolJSON,t=(0,o.z)(this.currentToolJSONs.toolJson),s=(0,o.c)(this.currentJobParams,this.toolName,this.toolUiParameters);return{jobParamsWithContext:s,jobParamsPayload:(0,o.B)({jobParams:s,toolData:this.toolElement?.toolData??{},toolUIJson:this.currentToolJSONs.toolUIJson?.UIparameters??[],toolName:this.toolName,toolJSON:this.currentToolJSONs?.toolJson,isPortal:this.portal?.isPortal,isWebTool:e}),resultParams:t}}async executeAnalysis(e=!1){if(this.onToolDataChange({detail:{toolData:this.toolElement?.toolData,parameterName:void 0}}),void 0!==this.currentJobParams){this.runAnalysisDisabled=!0,this.analysisToolAppJobSubmissionAttempt.emit(!0);try{const{jobParamsWithContext:t,jobParamsPayload:s,resultParams:a}=this.generateAnalysisParams();let r;r=(0,o.m)(o.a.mapLevelContext.creditUsageSettings)||!1!==this.portal?.isPortal||(0,o._)(this.portal)?!0===o.a.mapLevelContext?.creditUsageSettings?.askConfirmation?o.a.mapLevelContext?.creditUsageSettings?.creditThreshold:void 0:o.D;const n={creditThreshold:r,skipCreditChecks:e};await(0,i.p)({toolName:this.toolName,portal:this.portal,analysisEngine:this.analysisEngine,analysisType:void 0!==this.webToolServerUrl?i.a.WebTool:i.a.Tool,jobParams:(0,i.c)(t),jobParamsPayload:(0,i.c)(s),resultParams:a,containerElement:this.appContainer??this.hostElement,toolUiParameters:this.toolUiParameters??{},gpMessages:a.includes("processInfo")?this.gpMessages:void 0,webToolServerUrl:this.webToolServerUrl,executionType:this.webToolJSON?.executionType??m,webToolJSON:this.webToolJSON,creditCheckOptions:n})}catch(e){this.handleExecutionFailure(e)}}}async handleExecutionFailure(e){const t=e.name;if(t===o.H.CreditThresholdExceededError&&"cause"in e&&void 0!==e.cause&&null!==e.cause&&"object"==typeof e.cause&&"estimatedCredits"in e.cause&&"creditThreshold"in e.cause&&"number"==typeof e.cause.estimatedCredits&&"number"==typeof e.cause.creditThreshold){const{estimatedCredits:t,creditThreshold:s}=e.cause;!0===await this.displayCreditsThresholdModal(t,s)?this.executeAnalysis(!0):(this.runAnalysisDisabled=!1,this.analysisToolAppJobSubmissionAttempt.emit(!1))}else{if(t===o.H.NoPermissionToAccessTool){const t=this.getLearnMoreLink(o.H.NoPermissionToAccessTool);void 0!==t&&(e.message=(0,o.t)(e.message,{docLink:t}))}if(this.runAnalysisDisabled=!1,this.analysisToolAppJobSubmissionAttempt.emit(!1),this.validationStatus=o.b.Error,this.toolErrorState.toolAppErrorState=[(0,o.g)({error:e})],"messages"in e&&Array.isArray(e.messages)){!0===e.messages.some((e=>"error"===e.type&&e.description?.startsWith("Failed to execute")))&&(this.toolErrorState.toolAppErrorState=[(0,o.g)({errorKey:o.H.CreditEstimationExecutionFailure})])}this.scrollToTop()}}async displayCreditsThresholdModal(e,t){const s=(0,o.i)({url:C.map.OtherHelpLinks.creditsAnalysis,basePath:(0,o.A)(this.portal),locale:this.locale,portalUrl:this.portal.restUrl}),a={...this.strings.creditThresholdModal,creditEstimate:(0,o.t)(this.strings.creditThresholdModal.creditEstimate,{cost:(0,o.j)(e)}),creditThreshold:(0,o.t)(this.strings.creditThresholdModal.creditThreshold,{threshold:(0,o.j)(t)})},{modalElement:r,modalResult:n}=(0,i.d)(a,s);return(0,o.k)(document,r),n}scrollToTop(){void 0!==this.panelElement&&setTimeout((()=>{this.panelElement?.scrollContentTo({top:0,behavior:"auto"})}),250)}getLearnMoreLink(e){const t=!0===this.portal?.isPortal?E.map:C.map;let s;if(e in t.OtherHelpLinks.errorMessages){const a=t.OtherHelpLinks.errorMessages[e];s=(0,o.i)({url:!0===this.portal?.isPortal&&void 0!==this.portalHelpMap?this.portalHelpMap?.m[a]:a,basePath:(0,o.A)(this.portal),locale:this.locale,portalUrl:this.portal.restUrl})}return s}render(){return(0,a.h)(a.H,{key:"c1ab540e3cff173afad3c5ceb20c4584dcebe158"},!0===this.usePanel?this.renderPanel():this.renderAnalysisTool())}static get assetsDirs(){return["t9n","assets"]}get hostElement(){return(0,a.a)(this)}static get watchers(){return{analysisEngine:["toolNameChange"],toolName:["toolNameChange"],mapLayers:["onMapLayersChange"],jobParams:["onJobParamsChange"],mapView:["onMapViewChange"],portal:["portalNameChange"],portalHelpMap:["portalHelpMapChange"],webToolJSON:["webToolJSONChange"]}}};k.style=":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}.notice-margin-global{margin:var(--analysis-full-spacing) var(--analysis-three-quarter-spacing)}.analysis-panel-back-button{border-width:0;border-color:var(--calcite-color-border-3);border-style:solid;border-inline-end-width:1px}:host{display:flex;flex:1 1 auto;overflow:hidden}.tool-footer{width:100%}.header-scene-viewer{font-size:var(--calcite-font-size-0);line-height:1.25rem;font-weight:var(--calcite-font-weight-medium)}";const L="credit-block",O="estimate-credit-button",w="estimated-credits",R="credits",A="loader",M="error-message",N="hide",I="info-button",H="analysis--rtl",F="estimateCreditsCurrentParameters",U=class{constructor(e){(0,a.r)(this,e),this.analysisToolCreditsValidationFailure=(0,a.c)(this,"analysisToolCreditsValidationFailure"),this.estimatingCredits=!1,this.creditsEstimated=!1,this.isInformationMessage=!1,this.estimateCredits=async()=>{this.onCreditsPopoverClose();const e=this.toolElement,t=await(e?.validateTool()),s=await(this.toolSettingsElement?.validateSettings());if(!1===t?.valid||!1===s?.valid){const e=Array.from(new Set([...t?.errorKeys,...s?.errorKeys]));e?.forEach(((t,s)=>{t===o.I&&(e[s]=o.C)}));const a={valid:!1,errorKeys:e};return this.analysisToolCreditsValidationFailure.emit(a),void(this.errorMessage=this.strings.creditsEstimationFailed)}if(this.errorMessage=void 0,this.estimatingCredits=!0,this.isInformationMessage=!1,void 0!==this.toolJson){const t=(0,o.o)(this.toolJson,e?.toolData),s=(0,o.Q)(t),a=(0,o.c)(s,this.toolName,e?.toolData),r=(0,o.B)({jobParams:a,toolData:e?.toolData??{},toolUIJson:e?.toolUIJson?.UIparameters??[],toolName:this.toolName});let n={valid:!0,errorKeys:[]};try{await(0,i.j)({toolName:this.toolName,portal:this.portal,jobParams:r,analysisEngine:this.analysisEngine,toolElement:this.hostElement})}catch(e){this.errorMessage=this.strings.creditsEstimationFailed,n={valid:!1,errorKeys:[F]}}this.analysisToolCreditsValidationFailure.emit(n),this.estimatingCredits=!1,this.creditsEstimated=!0}},this.estimateRFxCredits=async()=>{this.onCreditsPopoverClose();const e=this.toolElement,t=await(e?.validateRFx()),s=await(this.toolSettingsElement?.validateSettings()),a=await(this.toolOutputElement?.validateRFxOutput());if(!1===s?.valid||!1===t?.valid||!1===a?.valid){const e=Array.from(new Set([...s?.errorKeys,...t?.errorStrings??[],...t?.errorKeys??[],...a?.errorKeys]));e?.forEach(((t,s)=>{t===o.I&&(e[s]=o.C)}));const i={valid:!1,errorKeys:e};return this.analysisToolCreditsValidationFailure.emit(i),void(this.errorMessage=this.strings.creditsEstimationFailed)}this.errorMessage=void 0,this.estimatingCredits=!0,this.isInformationMessage=!1;const n={rasterFunction:await(e?.getUpdatedRFTWithValues()),outputName:await(this.toolOutputElement?.getOutputParameters())};if(void 0!==n){const e=(0,o.c)(n,this.toolName,void 0);e.rasterFunction=await(0,r.analysisPreProcessing)(e.rasterFunction,e.context);const t={};Object.keys(e).forEach((s=>t[s]=JSON.stringify(e[s])));let s={valid:!0,errorKeys:[]};try{await(0,i.j)({toolName:"GenerateRaster",portal:this.portal,jobParams:t,analysisEngine:this.analysisEngine,toolElement:this.hostElement})}catch(e){this.errorMessage=this.strings.creditsEstimationFailed,s={valid:!1,errorKeys:[F]}}this.analysisToolCreditsValidationFailure.emit(s),this.estimatingCredits=!1,this.creditsEstimated=!0}},this.createCreditsPopover=()=>{void 0===this.creditsPopover&&(this.creditsPopover=document.createElement("analysis-tool-credits-popover"),this.creditsPopover.addEventListener("creditsPopoverClose",this.onCreditsPopoverClose)),this.creditsPopover.referenceElement=this.popoverActionElement,this.creditsPopover.numberOfInputFeatures=this.numberOfInputFeatures,this.creditsPopover.creditsPerFeature=this.creditsPerFeature,this.creditsPopover.estimatedCredits=this.estimatedCredits,this.creditsPopover.creditsRemaining=this.creditsRemaining,!1===document.body.contains(this.creditsPopover)&&(document.body.appendChild(this.creditsPopover),this.creditsPopover.open=!0)},this.onCreditsPopoverClose=()=>{void 0!==this.creditsPopover&&(this.creditsPopover.open=!1,this.creditsPopover.remove())},this.renderErrorMessage=()=>(0,a.h)("calcite-input-message",{status:this.isInformationMessage?o.Z.IDLE:o.Z.INVALID,icon:this.isInformationMessage?"information":"exclamationMarkTriangle",hidden:void 0===this.errorMessage},this.errorMessage)}disconnectedCallback(){this.onCreditsPopoverClose()}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,o.G)(this.hostElement,(0,a.g)(".")))}async clearCreditsEstimation(){return this.numberOfInputFeatures=void 0,this.creditsPerFeature=void 0,this.estimatedCredits=void 0,this.creditsRemaining=void 0,this.errorMessage=void 0,this.estimatingCredits=!1,this.creditsEstimated=!1,this.isInformationMessage=!1,Promise.resolve()}onCreditEstimateComplete(e){if(this.creditsPerFeature=void 0,this.creditsRemaining=void 0,void 0!==e.detail&&e.detail.length>0){const t=e.detail[0].value;this.estimatedCredits=t.maximumCost??t.cost??t.credits;i.k.find((e=>e.toolName===this.toolName&&e.analysisEngine===this.analysisEngine))&&(t.totalRecords=0,this.isInformationMessage=!0,this.errorMessage=this.strings.zeroCreditsMessage),this.numberOfInputFeatures=t.totalRecords}this.estimatingCredits=!1,this.creditsEstimated=!0}renderCreditsEstimated(){return this.creditsEstimated?(0,a.h)("div",null,(0,a.h)("div",{class:w},(0,a.h)("div",null,this.strings.estimatedCredits),(0,a.h)("div",{class:R},void 0===this.errorMessage&&!1===this.estimatingCredits&&(0,a.h)("calcite-button",{class:I,ref:e=>{this.popoverActionElement=e},appearance:"outline","icon-start":"information",round:!0,disabled:this.estimatingCredits,onClick:this.createCreditsPopover},(0,o.j)(this.estimatedCredits)),(0,a.h)("calcite-action",{class:!0===this.estimatingCredits?N:"",onClick:this.analysisType===i.a.RasterFunction?this.estimateRFxCredits:this.estimateCredits,text:"refresh",appearance:"transparent",icon:"refresh"}),(0,a.h)("calcite-loader",{style:{display:!1===this.estimatingCredits?"none":void 0},label:this.strings.loader,class:A,inline:!0}))),(0,a.h)("div",{class:M},void 0!==this.errorMessage?this.renderErrorMessage():null)):null}render(){return(0,a.h)(a.H,{key:"173d4e5535bb4e69763ef1ec12de0fc7ce99273a",class:{[H]:"rtl"===this.dir}},(0,a.h)("div",{key:"f98304920ef08f842700c5d26fe62a51cbbade96",class:L},!this.creditsEstimated&&(0,a.h)("calcite-button",{key:"3f8551dfebf9f50775bd9654f00769994ba9fe29",alignment:"center",round:!0,appearance:"transparent",onClick:this.analysisType===i.a.RasterFunction?this.estimateRFxCredits:this.estimateCredits,loading:this.estimatingCredits,class:O},this.creditsEstimated?this.strings.estimatedCredits:this.strings.estimateCredits),this.renderCreditsEstimated()))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}};U.style=":host{display:flex;width:100%}.credit-block{display:flex;justify-content:center;width:100%;margin:0;background-color:var(--calcite-color-foreground-1)}.estimate-credit-button{padding:12px 0}.estimated-credits{width:100%;display:flex;justify-content:space-between;align-items:center}.credits{display:flex;align-items:center}.loader{padding:var(--analysis-quarter-spacing);margin-left:3.75rem;margin-right:0rem;margin-top:0.75rem}.error-message{padding-bottom:1rem}.hide{display:none}.info-button{margin-left:1rem;margin-right:0rem}:host(.analysis--rtl) .loader{margin-left:0rem;margin-right:3.75rem}:host(.analysis--rtl) .info-button{margin-left:0rem;margin-right:1rem}";const J="analysis-popover",D="js-app-flyout",V="label-container",j=class{constructor(e){(0,a.r)(this,e),this.creditsPopoverClose=(0,a.c)(this,"creditsPopoverClose"),this.onCalcitePopoverClose=()=>{this.creditsPopoverClose.emit()},this.renderPopoverRow=(e,t)=>(0,a.h)("calcite-label",{scale:"s",layout:"inline-space-between"},e,(0,a.h)("calcite-chip",{scale:"s",value:e,label:e},t))}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,o.G)(this.hostElement,(0,a.g)(".")))}componentDidLoad(){setTimeout((()=>requestAnimationFrame((()=>this.popoverElement?.setFocus()))),1),setTimeout((()=>{this.popoverElement?.reposition?.()}),o.K.PopoverTimer)}async reposition(){await(this.popoverElement?.reposition?.())}render(){return(0,a.h)(a.H,{key:"547240723e26987d3712af9503b3877be1e08b2a",class:`${J} ${D}`,dir:this.dir},(0,a.h)("calcite-popover",{key:"178387d5543084ee9f91b32557da590849faca0f",ref:e=>this.popoverElement=e,autoClose:!0,label:this.strings.estimatedCredits,referenceElement:this.referenceElement,closable:!0,focusTrapDisabled:!0,heading:this.strings.estimatedCredits,open:this.open,onCalcitePopoverClose:this.onCalcitePopoverClose},(0,a.h)("div",{key:"93912620166e354b9ed30cd01d2285d920796923",class:V},void 0!==this.numberOfInputFeatures&&this.renderPopoverRow(this.strings.numberOfInputFeatures,(0,o.j)(this.numberOfInputFeatures)),void 0!==this.creditsPerFeature&&this.renderPopoverRow(this.strings.creditsPerFeature,(0,o.j)(this.creditsPerFeature)),void 0!==this.estimatedCredits&&this.renderPopoverRow(this.strings.estimatedCredits,(0,o.j)(this.estimatedCredits)),void 0!==this.creditsRemaining&&this.renderPopoverRow(this.strings.creditsRemaining,(0,o.j)(this.creditsRemaining)))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}};j.style=":host{display:block}.label-container{margin:var(--analysis-half-spacing)}";const G="block-content",z="full-width",q="half-margin-top",B=class{constructor(e){(0,a.r)(this,e),this.analysisSettingsMapLevelSave=(0,a.c)(this,"analysisSettingsMapLevelSave"),this.analysisSettingsMapLevelCancel=(0,a.c)(this,"analysisSettingsMapLevelCancel"),this.openBlockInitially=!1,this.hideGlobalSettings=!1,this.hideRasterSettings=!1,this.hideGeoanalyticsSettings=!1,this.hideCreditSettings=!1,this.handleBlockToggle=e=>{(0,o.r)(this.toolHelpPopover);const t=e.target,s=t.offsetParent,a=t?.offsetTop-42-s?.offsetTop;setTimeout((async()=>{await s.scrollContentTo({top:a,behavior:"smooth"})}),100)},this.resetDefaults=e=>{o.a.settingsSelectedExtentOption=o.E.Default,o.a.settingsSelectedOutSpatialRefOption=o.O.SameAsInput,o.a.context={},o.a.creditUsageSettings={askConfirmation:!0,creditThreshold:o.D},!0===e&&this.rasterSettingsRef?.resetUI()},this.handleCancelClick=()=>{this.resetDefaults(!0),this.analysisSettingsMapLevelCancel.emit()},this.handleSaveClick=async()=>{const{valid:e}=await this.validateSettings();if(!0===e){if(o.a.mapLevelContext.settingsSelectedExtentOption=o.a.settingsSelectedExtentOption,o.a.mapLevelContext.settingsSelectedOutSpatialRefOption=o.a.settingsSelectedOutSpatialRefOption,o.a.mapLevelContext.context={...(0,o.L)(o.a.context)},"layer"===o.a.mapLevelContext.settingsSelectedExtentOption){const e=this.standardSettingsRef?.shadowRoot?.querySelector(".extent"),t=e?.value;o.a.mapLevelContext.extentLayer=(0,o.M)(t)}else delete o.a.mapLevelContext.extentLayer;if("sameAsLayer"===o.a.mapLevelContext.settingsSelectedOutSpatialRefOption){const e=this.standardSettingsRef?.shadowRoot?.querySelector(".spatialReference"),t=e?.value;o.a.mapLevelContext.spatialRefLayer=(0,o.M)(t)}else delete o.a.mapLevelContext.spatialRefLayer;!1===(0,o.d)(o.a.mapLevelContext.context.mask)?(o.a.mapLevelContext.maskLayer=(0,o.M)(o.a.mapLevelContext.context.mask),delete o.a.mapLevelContext.context.mask):delete o.a.mapLevelContext.maskLayer,o.a.mapLevelContext.creditUsageSettings=o.a.creditUsageSettings,o.a.mapLevelContext=d(o.a.mapLevelContext),this.resetDefaults(!1),this.analysisSettingsMapLevelSave.emit(o.a.mapLevelContext)}}}onMapLayersChange(e,t){if(!(0,i.i)(e,t)){const t=(e??[]).filter((e=>!(0,o.N)(e)&&!(0,o.R)(e)));this.mapLayers=t}}onMapViewChange(e){o.a.mapView=e}async validateSettings(){let e=!0,t=!0,s=!0;const a=this.hostElement.shadowRoot?.querySelector("analysis-tool-standard-settings"),i=this.hostElement.shadowRoot?.querySelector("analysis-tool-raster-settings"),r=this.hostElement.shadowRoot?.querySelector("analysis-tool-credit-settings");null!=a&&(e=await a.validateStandardSettings()),null!=i&&(t=await i.validateRasterSettings()),null!=r&&(s=await r.checkValidity());const n=e&&t&&s;return{valid:n,errorKeys:!1===n?[o.I]:[]}}resetSettings(){return this.resetDefaults(!0),this.standardSettingsRef?.resetLayerDefaults(),Promise.resolve()}async componentWillLoad(){let e="";({strings:this.strings,locale:e,dir:this.dir}=await(0,o.G)(this.hostElement,(0,a.g)("."))),void 0!==this.mapLayers&&this.onMapLayersChange(this.mapLayers),void 0!==this.mapView&&(o.a.mapView=this.mapView),void 0!==this.portal&&(o.a.portal=this.portal),this.openBlockInitially=!1===(0,o.d)(o.a.context),this.fetchHelpFile(e)}connectedCallback(){const{readEnvironmentSettings:e,mode:t}=this;if(void 0!==e&&(o.a.mapLevelContext=e),t===i.m.Global){const{settingsSelectedExtentOption:e,settingsSelectedOutSpatialRefOption:t,context:s,creditUsageSettings:a}=o.a.mapLevelContext;void 0!==a&&(o.a.creditUsageSettings=d(a)),void 0!==e&&(o.a.settingsSelectedExtentOption=e),void 0!==t&&(o.a.settingsSelectedOutSpatialRefOption=t),o.a.context=d(s??{})}}disconnectedCallback(){(0,o.r)(this.toolHelpPopover),this.resetDefaults(!1)}renderGlobalBlock(){const{strings:e}=this;return(0,a.h)("calcite-block",{collapsible:!0,open:!0,heading:e.generalSettings},(0,a.h)("div",{class:G},(0,a.h)("analysis-tool-standard-settings",{mapLayers:this.mapLayers,hideGeographicTransformations:!0===this.hideRasterSettings,ref:e=>this.standardSettingsRef=e,onAnalysisToolStandardSettingsHelpClick:e=>{(0,o.T)(),this.toolHelpPopover=(0,o.s)(this.toolHelpPopover,{heading:e.detail.parameterName,helpFileName:"AnalysisEnvironments",helpId:e.detail.key,helpUrl:this.toolHelpFilePath,isHelpFileExternalAsset:!0,learnMoreBaseUrl:this.portal?.sourceJSON.helpBase??void 0,portal:this.portal,portalHelpMap:o.a.portalHelpMap,referenceElement:e.detail.refElement,triggerDisabled:!0})}})))}renderRABlock(){const{strings:e}=this,t=void 0===this.portal||!1===this.portal?.isPortal;return(0,a.h)("calcite-block",{collapsible:!0,open:!0,heading:e.rasterAnalysis},(0,a.h)("div",{class:G},(0,a.h)("analysis-tool-raster-settings",{mapLayers:this.mapLayers,hideRecycleProcessingWorkers:t,hideParallelProcessingFactor:t,hideRetryOnFailures:t,hideProcessorType:t,ref:e=>this.rasterSettingsRef=e,onAnalysisToolRasterSettingsHelpClick:e=>{(0,o.T)(),this.toolHelpPopover=(0,o.s)(this.toolHelpPopover,{heading:e.detail.parameterName,helpFileName:"AnalysisEnvironments",helpId:e.detail.key,helpUrl:this.toolHelpFilePath,isHelpFileExternalAsset:!0,learnMoreBaseUrl:this.portal?.sourceJSON.helpBase??void 0,portal:this.portal,portalHelpMap:o.a.portalHelpMap,referenceElement:e.detail.refElement,triggerDisabled:!0})}})))}renderGABlock(){const{strings:e}=this;return(0,a.h)("calcite-block",{collapsible:!0,open:!0,heading:e.geoanalytics},(0,a.h)("div",{class:G},(0,a.h)("analysis-tool-geoanalytics-settings",null)))}renderCreditBlock(){const{strings:e}=this;return(0,a.h)("calcite-block",{collapsible:!0,open:!0,heading:e.creditUsage},(0,a.h)("div",{class:G},(0,a.h)("analysis-tool-credit-settings",{onAnalysisToolCreditSettingsHelpClick:e=>{(0,o.T)(),this.toolHelpPopover=(0,o.s)(this.toolHelpPopover,{heading:e.detail.parameterName,helpFileName:"AnalysisEnvironments",helpId:e.detail.key,helpUrl:this.toolHelpFilePath,isHelpFileExternalAsset:!0,learnMoreBaseUrl:this.portal?.sourceJSON.helpBase??void 0,portal:this.portal,portalHelpMap:o.a.portalHelpMap,referenceElement:e.detail.refElement,triggerDisabled:!0})}})))}renderToolMode(){const{environmentSettingsFlags:e,hideGlobalSettings:t,hideRasterSettings:s,hideGeoanalyticsSettings:r,openBlockInitially:n,strings:l}=this,{raster:c,standard:h}=e??{},d=void 0===this.portal||!1===this.portal?.isPortal,p=!1===h?.includes(i.e.OutSR),m=this.hideRasterSettings||p||!1===h?.includes(i.e.GeographicTransformations),g=!1===h?.includes(i.e.Extent);return(0,a.h)("calcite-block",{collapsible:!0,heading:l.envSettings,description:l.envSettingsDescription,open:n,onCalciteBlockToggle:this.handleBlockToggle},!1===t&&0!==h?.length?(0,a.h)("analysis-tool-standard-settings",{mapLayers:this.mapLayers,hideOutSR:p,hideGeographicTransformations:m,hideExtent:g,onAnalysisToolStandardSettingsHelpClick:e=>{(0,o.T)(),this.toolHelpPopover=(0,o.s)(this.toolHelpPopover,{heading:e.detail.parameterName,helpFileName:"AnalysisEnvironments",helpId:e.detail.key,helpUrl:this.toolHelpFilePath,isHelpFileExternalAsset:!0,learnMoreBaseUrl:this.portal?.sourceJSON.helpBase??void 0,portal:this.portal,portalHelpMap:o.a.portalHelpMap,referenceElement:e.detail.refElement,triggerDisabled:!0})}}):null,!1===s&&0!==c?.length?(0,a.h)("analysis-tool-raster-settings",{mapLayers:this.mapLayers,hideCellSize:!1===c?.includes(i.e.CellSize),hideMask:!1===c?.includes(i.e.Mask),hideSnapRaster:!1===c?.includes(i.e.SnapRaster),hideResamplingMethod:!1===c?.includes(i.e.ResamplingMethod),hideRecycleProcessingWorkers:!1===c?.includes(i.e.RecycleProcessingWorkers)||d,hideParallelProcessingFactor:!1===c?.includes(i.e.ParallelProcessingFactor)||d,hideRetryOnFailures:!1===c?.includes(i.e.RetryOnFailures)||d,hideProcessorType:!1===c?.includes(i.e.ProcessorType)||d,onAnalysisToolRasterSettingsHelpClick:e=>{(0,o.T)(),this.toolHelpPopover=(0,o.s)(this.toolHelpPopover,{heading:e.detail.parameterName,helpFileName:"AnalysisEnvironments",helpId:e.detail.key,helpUrl:this.toolHelpFilePath,isHelpFileExternalAsset:!0,learnMoreBaseUrl:this.portal?.sourceJSON.helpBase??void 0,portal:this.portal,portalHelpMap:o.a.portalHelpMap,referenceElement:e.detail.refElement,triggerDisabled:!0})},ref:e=>this.rasterSettingsRef=e}):null,0===h?.length&&0===c?.length?(0,a.h)("calcite-notice",{open:!0,scale:"s"},(0,a.h)("div",{slot:"title"},this.strings.noEnvSettings)):null,!1===r?(0,a.h)("analysis-tool-geoanalytics-settings",null):null)}renderGlobalMode(){const{hideCreditSettings:e,hideGlobalSettings:t,hideRasterSettings:s,hideGeoanalyticsSettings:i,strings:o}=this;return(0,a.h)("calcite-panel",{heading:this.mapLevelHeading,onCalcitePanelClose:this.handleCancelClick},(0,a.h)("calcite-action",{class:"analysis-panel-back-button",icon:"rtl"===this.dir?"chevron-right":"chevron-left",onClick:this.handleCancelClick,scale:"s",slot:"header-actions-start",text:this.strings.cancel,title:this.strings.cancel}),(0,a.h)("slot",{name:"info-action",slot:"header-actions-end"}),(0,a.h)("slot",{name:"notice"}),!t&&this.renderGlobalBlock(),!s&&this.renderRABlock(),!i&&this.renderGABlock(),!e&&this.renderCreditBlock(),(0,a.h)("div",{slot:"footer",class:z},(0,a.h)("calcite-button",{appearance:"transparent","icon-start":"undo",label:o.resetDefaults,width:"full",onClick:()=>this.resetDefaults(!0)},o.resetDefaults),(0,a.h)("div",{class:q},(0,a.h)("calcite-button",{appearance:"solid",label:o.save,width:"half",onClick:this.handleSaveClick},o.save),(0,a.h)("calcite-button",{appearance:"outline",label:o.cancel,width:"half",onClick:this.handleCancelClick},o.cancel))))}render(){return(0,a.h)(a.H,{key:"160d9784075ddf9c62fc20d0fa04d74363a696fd"},this.mode===i.m.Global?this.renderGlobalMode():this.renderToolMode())}fetchHelpFile(e){if(void 0===this.toolHelpFilePath){let t=e;switch(e){case o.F.English:case o.F.EnglishUSA:t=""}this.toolHelpFilePath=`${(0,a.g)("assets")}/help/${""!==t?t+"/":""}AnalysisEnvironments.html`}}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}static get watchers(){return{mapLayers:["onMapLayersChange"],mapView:["onMapViewChange"]}}};B.style=":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}.notice-margin-global{margin:var(--analysis-full-spacing) var(--analysis-three-quarter-spacing)}.analysis-panel-back-button{border-width:0;border-color:var(--calcite-color-border-3);border-style:solid;border-inline-end-width:1px}:host{display:flex;flex-direction:column}:host([mode=global]){display:flex;flex:1 1 auto;flex-direction:row;overflow:hidden}:host([hidden]){display:none}.full-width{width:100%}.half-margin-top{margin-top:0.5rem}";const W="display-block",_="list-item",$=class{constructor(e){(0,a.r)(this,e),this.analysisToolStandardSettingsHelpClick=(0,a.c)(this,"analysisToolStandardSettingsHelpClick"),this.mapExtentInputs=[],this.stateContextChanged=!1,this.mapLayers=[],this.hideOutSR=!1,this.hideGeographicTransformations=!1,this.hideCategories=["Vertical Coordinate Systems"],this.hideExtent=!1,this.incomingLayerObjects={},this.setIncomingLayerObjects=async()=>{const e={};o.a.settingsSelectedExtentOption===o.E.Layer&&void 0!==o.a.mapLevelContext.extentLayer&&(e.extentLayer=await(0,o.U)(o.a.mapLevelContext.extentLayer,this.mapLayers)),o.a.settingsSelectedOutSpatialRefOption===o.O.SameAsLayer&&void 0!==o.a.mapLevelContext.spatialRefLayer&&(e.spatialRefLayer=await(0,o.U)(o.a.mapLevelContext.spatialRefLayer,this.mapLayers)),this.incomingLayerObjects=e},this.handleExtentChange=(e,t)=>{p(o.a.context,["extent",e],t);const s=o.a.context.extent;void 0!==o.a.mapView?.spatialReference&&(s.spatialReference=o.a.mapView.spatialReference,o.a.context.extent=(0,o.X)(s)),o.a.context={...o.a.context}},this.handleCalciteListChange=e=>{const{selectedItems:t}=e.currentTarget;o.a.settingsSelectedExtentOption=t[0].value,this.incomingLayerObjects.extentLayer=void 0,this.extentPopover?.remove()},this.setMapExtent=()=>{void 0!==o.a.mapView&&(o.a.context.extent=(0,o.X)(o.a.mapView.extent)),o.a.context={...o.a.context},this.stateContextChanged=!0},this.handleLayerInputClose=e=>{"extent"===e?(delete o.a.context.extent,this.incomingLayerObjects.extentLayer=void 0):"spatialReference"===e&&(delete o.a.context.outSR,this.incomingLayerObjects.spatialRefLayer=void 0),this.incomingLayerObjects={...this.incomingLayerObjects},o.a.context={...o.a.context}},this.handleLayerInputChange=(e,t)=>{const s=e.target?.selectedLayers;if("extent"===t&&void 0!==s?.fullExtent)o.a.context.extent=(0,o.X)(s.fullExtent??void 0);else if(void 0!==s&&"spatialReference"in s){const{wkid:e,latestWkid:t,wkt:a}=s?.spatialReference;(0,o.d)(e)||p(o.a.context,"outSR.wkid",e),(0,o.d)(t)||p(o.a.context,"outSR.latestWkid",t),(0,o.d)(a)||p(o.a.context,"outSR.wkt",a)}o.a.context={...o.a.context}},this.createExtentPopover=e=>{this.extentPopover?.remove(),this.extentPopover=document.createElement("calcite-popover");const t={autoClose:!0,dir:this.dir,focusTrapDisabled:!0,heading:this.strings.processingExtent,closable:!0,open:!0,referenceElement:e.target};Object.assign(this.extentPopover,t),this.extentPopover.addEventListener("calcitePopoverClose",this.extentPopover?.remove);const s=document.createElement("calcite-list");s.label="",s.selectionMode="single",s.addEventListener("calciteListChange",this.handleCalciteListChange);const a=[{label:this.strings.default,description:this.strings.defaultText,value:o.E.Default},{label:this.strings.coordinates,description:this.strings.coordinatesText,value:o.E.Coordinates},{label:this.strings.mapExtent,description:this.strings.mapExtentText,value:o.E.MapExtent},{label:this.strings.layer,description:this.strings.layerText,value:o.E.Layer}].map((e=>{const t=document.createElement("calcite-list-item");return t.setAttribute("style","--calcite-font-size--1: var(--calcite-font-size--2);"),Object.assign(t,e),t.selected=t.value===o.a.settingsSelectedExtentOption,t}));s.append(...a),this.extentPopover.appendChild(s),document.body.appendChild(this.extentPopover),setTimeout((()=>requestAnimationFrame((()=>{this.extentPopover.open=!0,this.extentPopover?.setFocus()}))),1)},this.handleSpatialReferenceChange=e=>{o.a.context.outSR={latestWkid:e.detail.latestWkid}},this.getGeographicTransformationsChoiceList=()=>{const e=this.datumTransformationOptions,t=this.selectedGeographicTransformationOptions;if(!(0,o.d)(t))for(let s=t.length-1;s>=0;--s){const t=this.selectedGeographicTransformationOptions[s];e.splice(e.indexOf(t),1),e.unshift(t)}return e},this.handleGeographicTransformationInputChange=e=>{this.selectedGeographicTransformationOptions=e.target?.value,o.a.context.geographicTransformations=(0,o.d)(this.selectedGeographicTransformationOptions)?void 0:this.selectedGeographicTransformationOptions.join(";")},this.createComboBoxItemElement=(e,t)=>{let s=!1;s=Array.isArray(t)?void 0!==t&&t.includes(e):t===e;const a=document.createElement("calcite-combobox-item");return a.selected=s,a.heading=e,a.value=e,a},this.handleGeographicTransformationInputComboboxBeforeOpen=e=>{const t=e.target,s=t.shadowRoot?.querySelector("calcite-combobox"),a=t.value,i=this.getGeographicTransformationsChoiceList();if(null!==s){const e=s.childElementCount;if(e<i.length){const t=i.slice(e);s.append(...t.map((e=>this.createComboBoxItemElement(e,a))))}}},this.handleGeographicTransformationInputReset=()=>{if(!(0,o.m)(this.geographicTransformationInputElement))return;this.selectedGeographicTransformationOptions=[];const e=this.geographicTransformationInputElement.shadowRoot?.querySelector("calcite-combobox");e.value=[]}}async resetLayerDefaults(){return this.setIncomingLayerObjects(),Promise.resolve()}async validateStandardSettings(){let e=!0,t=!0;switch(o.a.settingsSelectedExtentOption){case o.E.Layer:const t=this.hostElement.shadowRoot?.querySelector(".extent");null!=t&&(e=await t.checkValidity());break;case o.E.Coordinates:const s=this.hostElement.shadowRoot?.querySelectorAll("analysis-number-input"),a=[];if(null!=s){s.forEach((e=>{a.push(e.checkValidity())}));e=!(await Promise.all(a)).some((e=>!1===e))}}switch(o.a.settingsSelectedOutSpatialRefOption){case o.O.SameAsLayer:const e=this.hostElement.shadowRoot?.querySelector(".spatialReference");null!=e&&(t=await e.checkValidity());break;case o.O.BrowseCS:const s=this.hostElement.shadowRoot?.querySelector("analysis-spatial-reference-input");null!=s&&(t=await s.checkValidity())}return Promise.resolve(t&&e)}async componentWillLoad(){this.setIncomingLayerObjects(),({strings:this.strings,dir:this.dir}=await(0,o.G)(this.hostElement,(0,a.g)(".")));const e=Object.values(o.a1);this.datumTransformationOptions=[...new Set(e)]}componentDidRender(){this.stateContextChanged&&(setTimeout((()=>requestAnimationFrame((()=>this.mapExtentInputs?.forEach((e=>e?.checkValidity()))))),1),this.stateContextChanged=!1)}disconnectedCallback(){this.extentPopover?.remove(),this.coordinateSystemPopover?.remove()}renderCoordinateConfig(){const{strings:e}=this,{extent:t}=o.a.context;return(0,a.h)("div",null,(0,a.h)("calcite-button",{class:o.S.controlSpacing,scale:o.Y.Scale,appearance:"outline",kind:"neutral",width:"full",onClick:this.setMapExtent},e.setCoordinates),(0,a.h)("calcite-label",null,e.top,(0,a.h)("analysis-number-input",{ref:e=>{this.mapExtentInputs.push(e)},required:!0,label:"",value:t?.ymax,scale:o.Y.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("ymax",e.target?.value)})),(0,a.h)("calcite-label",null,e.bottom,(0,a.h)("analysis-number-input",{ref:e=>{this.mapExtentInputs.push(e)},required:!0,label:"",value:t?.ymin,scale:o.Y.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("ymin",e.target?.value)})),(0,a.h)("calcite-label",null,e.left,(0,a.h)("analysis-number-input",{ref:e=>{this.mapExtentInputs.push(e)},required:!0,label:"",value:t?.xmin,scale:o.Y.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("xmin",e.target?.value)})),(0,a.h)("calcite-label",null,e.right,(0,a.h)("analysis-number-input",{ref:e=>{this.mapExtentInputs.push(e)},required:!0,label:"",value:t?.xmax,scale:o.Y.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("xmax",e.target?.value)})))}renderLayerInput(e){let t;const s=this.mapLayers;"extent"===e?t=this.incomingLayerObjects?.extentLayer:"spatialReference"===e&&(t=this.incomingLayerObjects?.spatialRefLayer);const i=void 0!==s.find((e=>e.id===t?.id));if(void 0!==t&&!1===i){let e;if(!1===(0,o.d)(t.url)){const s="layerId"in t?t.layerId:0;e=`${t.url}/${s}`}else e=t.title??"";void 0===(0,o.a0)(e,this.mapLayers)&&s.push(t)}return(0,a.h)("analysis-layer-input",{class:e,required:!0,descriptionDisplay:"spatialReference",mapLayers:s,layerFilterType:[f,b],selectedLayers:t,user:o.a.portal?.user??void 0,mapView:o.a.mapView,onAnalysisLayerInputClose:()=>this.handleLayerInputClose(e),onAnalysisLayerInputChange:t=>this.handleLayerInputChange(t,e)})}renderChooseSpatialReference(){const e=o.a.context.outSR?.latestWkid??o.a.context.outSR?.wkid;return(0,a.h)("analysis-spatial-reference-input",{errorMessage:void 0!==o.a.context.outSR?.wkt&&void 0===e?this.strings.unableToRepopulateOutSR:void 0,dir:this.dir,required:!0,onAnalysisSpatialReferenceInputChange:e=>this.handleSpatialReferenceChange(e),value:void 0!==e?{latestWkid:e}:void 0,hideCategories:this.hideCategories})}renderOutSR(){const{strings:e}=this;return(0,a.h)("div",null,(0,a.h)("analysis-label",{label:e.outputCS,onAnalysisLabelHelpActionClick:t=>this.analysisToolStandardSettingsHelpClick.emit({key:i.e.OutSR,parameterName:e.outputCS,refElement:t.target})}),(0,a.h)("calcite-dropdown",{class:`${W} ${o.S.controlSpacing}`,placement:"bottom",scale:o.Y.Scale},(0,a.h)("calcite-button",{class:o.S.analysisBorder,alignment:"space-between",appearance:"transparent",kind:"neutral","icon-end":"chevron-down",scale:o.Y.Scale,slot:"trigger",width:"full"},e[o.a.settingsSelectedOutSpatialRefOption]),(0,a.h)("calcite-dropdown-group",null,(0,a.h)("calcite-dropdown-item",{onClick:()=>{o.a.settingsSelectedOutSpatialRefOption=o.O.SameAsInput,this.incomingLayerObjects.spatialRefLayer=void 0}},e.sameAsInput),(0,a.h)("calcite-dropdown-item",{onClick:()=>{o.a.settingsSelectedOutSpatialRefOption=o.O.BrowseCS,this.incomingLayerObjects.spatialRefLayer=void 0}},e.browseCS),(0,a.h)("calcite-dropdown-item",{onClick:()=>{o.a.settingsSelectedOutSpatialRefOption=o.O.SameAsLayer,this.incomingLayerObjects.spatialRefLayer=void 0}},e.sameAsLayer))),o.a.settingsSelectedOutSpatialRefOption===o.O.SameAsLayer&&this.renderLayerInput("spatialReference"),o.a.settingsSelectedOutSpatialRefOption===o.O.BrowseCS&&this.renderChooseSpatialReference())}renderGeographicTransformation(){const e=o.a.context.geographicTransformations;void 0!==e?this.selectedGeographicTransformationOptions=e.split(";"):(0,o.m)(this.selectedGeographicTransformationOptions)&&this.handleGeographicTransformationInputReset();const t=this.getGeographicTransformationsChoiceList().slice(0,15),{strings:s}=this;return(0,a.h)("analysis-string-input",{allowCustomValues:!1,choiceList:t,label:s.geographicTransformations,placeholderText:s.geographicTransformationsPlaceholderText,required:!1,selectionMode:"multi",value:this.selectedGeographicTransformationOptions,onAnalysisStringInputComboboxBeforeOpen:e=>this.handleGeographicTransformationInputComboboxBeforeOpen(e),onAnalysisStringInputChange:e=>this.handleGeographicTransformationInputChange(e),onAnalysisHelpClick:e=>this.analysisToolStandardSettingsHelpClick.emit({key:i.e.GeographicTransformations,parameterName:s.geographicTransformations,refElement:e.target}),ref:e=>this.geographicTransformationInputElement=e})}renderExtent(){const{strings:e}=this,{settingsSelectedExtentOption:t}=o.a;return(0,a.h)("div",null,(0,a.h)("analysis-label",{label:e.processingExtent,onAnalysisLabelHelpActionClick:t=>this.analysisToolStandardSettingsHelpClick.emit({key:i.e.Extent,parameterName:e.processingExtent,refElement:t.target})}),(0,a.h)("calcite-list",{class:o.S.controlSpacing,label:"",selectionMode:"none"},(0,a.h)("calcite-list-item",{class:o.S.analysisBorder+" "+_,label:e[t],description:e[`${t}Text`],value:t,onClick:e=>this.createExtentPopover(e)},(0,a.h)("calcite-action",{slot:"actions-end",icon:"chevron-down",text:""}))),t===o.E.Coordinates&&this.renderCoordinateConfig(),t===o.E.Layer&&this.renderLayerInput("extent"))}render(){return(0,a.h)(a.H,{key:"560159e085380593744dc31c30ccfbe98b92718e"},!this.hideOutSR&&this.renderOutSR(),!this.hideOutSR&&!this.hideGeographicTransformations&&this.renderGeographicTransformation(),!this.hideExtent&&this.renderExtent())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}};$.style=":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}.notice-margin-global{margin:var(--analysis-full-spacing) var(--analysis-three-quarter-spacing)}.analysis-panel-back-button{border-width:0;border-color:var(--calcite-color-border-3);border-style:solid;border-inline-end-width:1px}:host{display:flex;flex-direction:column}.control-spacing{width:100%}.display-block{display:block}.list-item{--calcite-font-size--1:var(--calcite-font-size--2)}";const K=class{constructor(e){(0,a.r)(this,e),this.analysisToolRasterSettingsHelpClick=(0,a.c)(this,"analysisToolRasterSettingsHelpClick"),this.loadedLayerObjects={},this.browsedLayers=[],this.selectedResamplingMethodOption=o.a2.Nearest,this.recycleProcessingWorkersValue=0,this.parallelProcessingFactorValue="",this.retryOnFailuresValue=0,this.selectedProcessorTypeOption=o.a3.Empty,this.incomingLayerObjects={},this.mapLayers=[],this.hideCellSize=!1,this.hideResamplingMethod=!1,this.hideMask=!1,this.hideSnapRaster=!1,this.hideRecycleProcessingWorkers=!1,this.hideParallelProcessingFactor=!1,this.hideRetryOnFailures=!1,this.hideProcessorType=!1,this.inferUIState=async()=>{const{cellSize:e,snapRaster:t,mask:s,resamplingMethod:a,recycleProcessingWorkers:i,parallelProcessingFactor:r,retryOnFailures:n,processorType:l}=o.a.context;if("object"==typeof e&&(0,o.m)(e)&&"url"in e){this.selectedCellSizeOption=o.a4.Layer;const t=await(0,o.U)({url:this.removeLayerToken(e.url)},this.mapLayers);void 0!==t&&(this.loadedLayerObjects.cellSize=t,void 0!==t&&this.isNotAnExistingLayer(t)&&this.browsedLayers.push(t))}else"number"==typeof e?this.selectedCellSizeOption=o.a4.Value:void 0!==e&&(this.selectedCellSizeOption=e===o.a4.MinOf?o.a4.MinOf:o.a4.MaxOf);if(void 0!==t){const e=await(0,o.U)({url:this.removeLayerToken(t.url)},this.mapLayers);void 0!==e&&(this.loadedLayerObjects.snapRaster=e,void 0!==e&&this.isNotAnExistingLayer(e)&&this.browsedLayers.push(e))}let c;if(void 0!==s){const e={...s};"url"in s&&void 0!==s.url&&(e.url=this.removeLayerToken(e.url)),c=await(0,o.U)(e,this.mapLayers)}else void 0!==this.incomingLayerObjects.maskLayer&&(c=await(0,o.U)(this.incomingLayerObjects.maskLayer,this.mapLayers));void 0!==c&&(this.loadedLayerObjects.mask=c,void 0!==c&&this.browsedLayers.push(c)),void 0!==a&&(this.selectedResamplingMethodOption=a),void 0!==i&&(this.recycleProcessingWorkersValue=i),void 0!==r&&(this.parallelProcessingFactorValue=r),void 0!==n&&(this.retryOnFailuresValue=n),void 0!==l&&(this.selectedProcessorTypeOption=l)},this.isNotAnExistingLayer=e=>{let t=e.url??"";return"layerId"in e&&(t+=`/${e.layerId??0}`),t=this.removeLayerToken(t),void 0===(0,o.a0)(t,this.mapLayers)},this.removeLayerToken=e=>e?.indexOf("?token=")>0?e.slice(0,e.indexOf("?token=")):e,this.renderSnapRasterParameter=()=>{const{strings:e,loadedLayerObjects:t}=this;return(0,a.h)("div",null,(0,a.h)("analysis-label",{label:e.snapRaster,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:i.e.SnapRaster,parameterName:e.snapRaster,refElement:t.target})}),(0,a.h)("analysis-layer-input",{layerFilterType:f,mapLayers:[...this.mapLayers,...this.browsedLayers],selectedLayers:t?.snapRaster,user:this.portalUser,mapView:o.a.mapView,onAnalysisLayerInputChange:e=>this.handleAnalysisLayerInputChange(e,i.e.SnapRaster)}))},this.renderCellSizeParameter=()=>{const{strings:e,loadedLayerObjects:t,selectedCellSizeOption:s}=this;return(0,a.h)("div",null,(0,a.h)("analysis-label",{label:e.cellSize,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:i.e.CellSize,parameterName:e.cellSize,refElement:t.target})}),(0,a.h)("calcite-combobox",{class:o.S.controlSpacing,label:e.cellSize,placeholder:e.selectCellSize,scale:o.Y.Scale,selectionMode:"single",value:s,onCalciteComboboxChange:e=>this.handleCalciteComboboxChange(e)},(0,a.h)("calcite-combobox-item",{heading:e.maxOf,key:o.a4.MaxOf,value:o.a4.MaxOf,selected:s===o.a4.MaxOf}),(0,a.h)("calcite-combobox-item",{heading:e.minOf,key:o.a4.MinOf,value:o.a4.MinOf,selected:s===o.a4.MinOf}),(0,a.h)("calcite-combobox-item",{heading:e.asSpecified,key:o.a4.Value,value:o.a4.Value,selected:s===o.a4.Value}),(0,a.h)("calcite-combobox-item",{heading:e.fromLayer,key:o.a4.Layer,value:o.a4.Layer,selected:s===o.a4.Layer})),s===o.a4.Value&&(0,a.h)("analysis-number-input",{ref:e=>{this.numberInputElement=e},required:!0,value:o.a.context.cellSize,scale:o.Y.Scale,label:"",min:0,excludeMinValue:!0,numberType:"float",onAnalysisNumberInputChange:e=>o.a.context.cellSize=Number(e.target.value)}),s===o.a4.Layer&&(0,a.h)("analysis-layer-input",{ref:e=>{this.layerInputElement=e},required:!0,layerFilterType:f,mapLayers:[...this.mapLayers,...this.browsedLayers],selectedLayers:t?.cellSize,user:this.portalUser,mapView:o.a.mapView,onAnalysisLayerInputChange:e=>this.handleAnalysisLayerInputChange(e,i.e.CellSize)}))},this.renderMaskParameter=()=>{const{strings:e,loadedLayerObjects:t}=this;return(0,a.h)("div",null,(0,a.h)("analysis-label",{label:e.mask,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:i.e.Mask,parameterName:e.mask,refElement:t.target})}),(0,a.h)("analysis-layer-input",{mapLayers:[...this.mapLayers,...this.browsedLayers],selectedLayers:t?.mask,layerFilterType:[f,b],user:this.portalUser,mapView:o.a.mapView,onAnalysisLayerInputChange:e=>this.handleAnalysisLayerInputChange(e,i.e.Mask)}))},this.renderResamplingMethodParameter=()=>{const{strings:e,selectedResamplingMethodOption:t}=this;return(0,a.h)("div",null,(0,a.h)("analysis-label",{label:e.resamplingMethod,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:i.e.ResamplingMethod,parameterName:e.resamplingMethod,refElement:t.target})}),(0,a.h)("calcite-select",{scale:o.Y.Scale,class:o.S.controlSpacing,label:e.resamplingMethod,value:t,onCalciteSelectChange:e=>this.handleResamplingMethodSelectChange(e)},(0,a.h)("calcite-option",{value:o.a2.Nearest,selected:t===o.a2.Nearest},e.nearest),(0,a.h)("calcite-option",{value:o.a2.Bilinear,selected:t===o.a2.Bilinear},e.bilinear),(0,a.h)("calcite-option",{value:o.a2.Cubic,selected:t===o.a2.Cubic},e.cubic)))},this.renderRecycleProcessingWorkersParameter=()=>{const{strings:e,recycleProcessingWorkersValue:t}=this;return(0,a.h)("analysis-number-input",{required:!1,value:t,scale:o.Y.Scale,label:e.recycleProcessingWorkers,min:0,numberType:"integer",onAnalysisNumberInputChange:e=>o.a.context.recycleProcessingWorkers=Number(e.target.value),onAnalysisHelpClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:i.e.RecycleProcessingWorkers,parameterName:e.recycleProcessingWorkers,refElement:t.target})})},this.renderParallelProcessingFactorParameter=()=>{const{strings:e,parallelProcessingFactorValue:t}=this;return(0,a.h)("analysis-string-input",{value:t,label:e.parallelProcessingFactor,required:!1,selectionMode:"single",placeholderText:e.parallelProcessingFactorPlaceholderText,onAnalysisStringInputChange:e=>this.handleParallelProcessingFactorInputChange(e),onAnalysisHelpClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:i.e.ParallelProcessingFactor,parameterName:e.parallelProcessingFactor,refElement:t.target})})},this.renderRetryOnFailuresParameter=()=>{const{strings:e,retryOnFailuresValue:t}=this;return(0,a.h)("analysis-number-input",{required:!1,value:t,scale:o.Y.Scale,label:e.retryOnFailures,min:0,numberType:"integer",onAnalysisNumberInputChange:e=>o.a.context.retryOnFailures=Number(e.target.value),onAnalysisHelpClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:i.e.RetryOnFailures,parameterName:e.retryOnFailures,refElement:t.target})})},this.renderProcessorTypeParameter=()=>{const{strings:e,selectedProcessorTypeOption:t}=this;return(0,a.h)("div",null,(0,a.h)("analysis-label",{label:e.processorType,onAnalysisLabelHelpActionClick:t=>this.analysisToolRasterSettingsHelpClick.emit({key:i.e.ProcessorType,parameterName:e.processorType,refElement:t.target})}),(0,a.h)("calcite-select",{scale:o.Y.Scale,class:o.S.controlSpacing,label:e.processorType,value:t,onCalciteSelectChange:e=>this.handleProcessorTypeSelectChange(e)},(0,a.h)("calcite-option",{value:o.a3.Empty,selected:t===o.a3.Empty},e.automatic),(0,a.h)("calcite-option",{value:o.a3.CPU,selected:t===o.a3.CPU},e.CPU),(0,a.h)("calcite-option",{value:o.a3.GPU,selected:t===o.a3.GPU},e.GPU)))},this.handleCalciteComboboxChange=e=>{this.selectedCellSizeOption=e.target?.value,(0,o.m)(this.selectedCellSizeOption)?this.selectedCellSizeOption!==o.a4.MaxOf&&this.selectedCellSizeOption!==o.a4.MinOf||(o.a.context.cellSize=this.selectedCellSizeOption):o.a.context.cellSize=void 0},this.handleResamplingMethodSelectChange=e=>{this.selectedResamplingMethodOption=e.target?.selectedOption.value,o.a.context.resamplingMethod=this.selectedResamplingMethodOption},this.handleAnalysisLayerInputChange=async(e,t)=>{const s=e.target?.selectedLayers;if(void 0!==s){let e;!0===(0,o.a5)(s)?e=await(0,o.a6)(s,o.a.mapView):!0!==(0,o.a7)(s)&&!0!==(0,o.a8)(s)||(e=(0,o.a9)(s)),o.a.context[t]=e}else delete o.a.context[t]},this.handleParallelProcessingFactorInputChange=e=>{this.parallelProcessingFactorValue=e.target?.value,o.a.context.parallelProcessingFactor=this.parallelProcessingFactorValue},this.handleProcessorTypeSelectChange=e=>{this.selectedProcessorTypeOption=e.target?.selectedOption.value,o.a.context.processorType=this.selectedProcessorTypeOption===o.a3.Empty?void 0:this.selectedProcessorTypeOption}}async validateRasterSettings(){let e=!0;switch(this.selectedCellSizeOption){case o.a4.Layer:const t=this.layerInputElement;null!=t&&(e=await t.checkValidity());break;case o.a4.Value:const s=this.numberInputElement;null!=s&&(e=await s.checkValidity())}return e}resetUI(){this.loadedLayerObjects={},this.selectedCellSizeOption=void 0,this.selectedResamplingMethodOption=o.a2.Nearest,this.recycleProcessingWorkersValue=0,this.parallelProcessingFactorValue="",this.retryOnFailuresValue=0,this.selectedProcessorTypeOption=o.a3.Empty;const e=this.hostElement.shadowRoot?.querySelectorAll("analysis-layer-input");return e?.forEach((e=>e.selectedLayerIds=[])),Promise.resolve()}async componentWillLoad(){({strings:this.strings}=await(0,o.G)(this.hostElement,(0,a.g)(".")));const e={};void 0!==o.a.mapLevelContext.maskLayer&&(e.maskLayer=o.a.mapLevelContext.maskLayer),this.incomingLayerObjects=e,await this.inferUIState()}get portalUser(){return o.a.portal?.user??void 0}render(){const{hideCellSize:e,hideSnapRaster:t,hideMask:s,hideResamplingMethod:i,hideRecycleProcessingWorkers:o,hideParallelProcessingFactor:r,hideRetryOnFailures:n,hideProcessorType:l}=this;return(0,a.h)(a.H,{key:"1b7bd8aeb86ca5b17ec6e85e3b4e59a779aecca4"},!1===t?this.renderSnapRasterParameter():null,!1===e?this.renderCellSizeParameter():null,!1===s?this.renderMaskParameter():null,!1===i?this.renderResamplingMethodParameter():null,!1===o?this.renderRecycleProcessingWorkersParameter():null,!1===r?this.renderParallelProcessingFactorParameter():null,!1===n?this.renderRetryOnFailuresParameter():null,!1===l?this.renderProcessorTypeParameter():null)}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}};K.style=":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}.notice-margin-global{margin:var(--analysis-full-spacing) var(--analysis-three-quarter-spacing)}.analysis-panel-back-button{border-width:0;border-color:var(--calcite-color-border-3);border-style:solid;border-inline-end-width:1px}:host{display:flex;flex-direction:column;--calcite-color-border-input:var(--analysis-ui-border-input)}";const Y=class{constructor(e){(0,a.r)(this,e),this.analysisToolGeoanalyticsSettingsChange=(0,a.c)(this,"analysisToolGeoanalyticsSettingsChange")}async componentWillLoad(){({strings:this.strings}=await(0,o.G)(this.hostElement,(0,a.g)(".")))}render(){const{strings:e}=this;return(0,a.h)(a.H,{key:"25ba4f653a3b4b3f75468e877a01eebb1eb09f4c"},(0,a.h)(o.aa,{key:"f83cc768e10fbcab7dab9efb536832122c2c0e5a",label:e.dataStore}),(0,a.h)("calcite-select",{key:"95f73347f9af9b4761a016829c332e56729c1e55",label:e.dataStore,class:o.S.controlSpacing,scale:o.Y.Scale}))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}};Y.style=":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}.notice-margin-global{margin:var(--analysis-full-spacing) var(--analysis-three-quarter-spacing)}.analysis-panel-back-button{border-width:0;border-color:var(--calcite-color-border-3);border-style:solid;border-inline-end-width:1px}:host{display:flex;flex-direction:column}";s(32513),s(588),s(44345),s(55448),s(18423),s(91813),s(21255),s(54312),s(34031),s(9316),s(13661),s(43786),s(61320),s(64016),s(56451),s(6550),s(2924),s(5258),s(52373),s(33752),s(53976),s(49403),s(77462),s(23054),s(73645),s(12762),s(82567),s(28927),s(35970),s(5933),s(57295),s(72349),s(89962),s(97703),s(71802),s(43284),s(22741);const X=class{constructor(e){(0,a.r)(this,e),this.analysisToolCreditSettingsHelpClick=(0,a.c)(this,"analysisToolCreditSettingsHelpClick"),this.handleBooleanInputChange=e=>{const t=e.target.value;o.a.creditUsageSettings.askConfirmation=t,o.a.creditUsageSettings={...o.a.creditUsageSettings}},this.handleNumberInputChange=e=>{const t=e.target.value;o.a.creditUsageSettings.creditThreshold=t,o.a.creditUsageSettings={...o.a.creditUsageSettings}}}async checkValidity(){let e=!0;return!0===o.a.creditUsageSettings.askConfirmation&&void 0!==this.thresholdInputElement&&(e=await this.thresholdInputElement.checkValidity()),Promise.resolve(e)}async componentWillLoad(){({strings:this.strings}=await(0,o.G)(this.hostElement,(0,a.g)(".")))}render(){return(0,a.h)(a.H,{key:"09d945d0895d59fc9366ad8735974a330a030e6a"},(0,a.h)("analysis-boolean-input",{key:"2d9cf79b80ec9589b21b34594a64dbc6bf12684c",displayStyle:"switch",label:this.strings.askConfirmation,value:o.a.creditUsageSettings.askConfirmation,onAnalysisBooleanInputChange:this.handleBooleanInputChange,onAnalysisHelpClick:e=>this.analysisToolCreditSettingsHelpClick.emit({key:"askConfirmation",parameterName:this.strings.askConfirmation,refElement:e.target})}),(0,a.h)("analysis-number-input",{key:"07eac176fde18ad2a00bab7e96330a35b47c959e",hidden:!o.a.creditUsageSettings.askConfirmation,label:this.strings.creditThreshold,min:0,numberType:"integer",required:o.a.creditUsageSettings.askConfirmation,value:o.a.creditUsageSettings.creditThreshold,ref:e=>this.thresholdInputElement=e,onAnalysisNumberInputChange:this.handleNumberInputChange,onAnalysisHelpClick:e=>this.analysisToolCreditSettingsHelpClick.emit({key:"creditThreshold",parameterName:this.strings.creditThreshold,refElement:e.target})}))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.a)(this)}};X.style=":host{display:block}"}}]);