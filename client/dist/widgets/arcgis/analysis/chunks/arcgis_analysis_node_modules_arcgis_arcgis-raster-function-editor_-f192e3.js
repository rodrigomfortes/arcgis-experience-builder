"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-f192e3"],{9430:(e,t,i)=>{i.d(t,{R:()=>y});var a=i(83628),l=(i(5294),i(13661),i(18423),i(21255),i(35431),i(5839)),s=i(92991),r=i(93442),n=i(33797),c=i(42335),d=(i(23795),i(17902),i(56451),i(95069)),h=(i(588),i(71802),i(44345),i(32513),i(33752),i(36596),i(19956));const o="rfx-cte-weighted-overlay-table-editor",u={colorRed:`${o}__color-red`,grid:`${o}__grid`,layerColumn:`${o}__layer-column`,influenceColumn:`${o}__influence-column`,fieldColumn:`${o}__field-column`,valueColumn:`${o}__value-column`,scaleColumn:`${o}__scale-column`},g="weightedOverlayTableHelpClickHandler",f="remapTableHelpClickHandler",p="scalesHelpClickHandler",m=[{key:"1-3",label:"1-3"},{key:"1-5",label:"1-5"},{key:"1-7",label:"1-7"},{key:"1-9",label:"1-9"},{key:"1-10",label:"1-10"},{key:"1-20",label:"1-20"},{key:"1-25",label:"1-25"},{key:"1-50",label:"1-50"},{key:"1-75",label:"1-75"},{key:"1-100",label:"1-100"}],v={influence:{numberType:h.N.INTEGER,min:0,max:100},layer:{required:!0}},y=class{constructor(e){(0,a.r)(this,e),this.rfxArgumentChange=(0,a.c)(this,"rfxArgumentChange"),this.helpActionClickEventHandlers=new Map,this.scalesOptions=m,this.weightedOverlayGridSchema={canAdd:!0,gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,hasIdColumn:!0},this.remapsGridSchema={canAdd:!0,gridLayout:{},gridOptions:[],hasBorder:!0,hasHeader:!0,hasIdColumn:!0},this.sumOfInfluence=0,this.refreshRemapsGrid=()=>{const e=this.getRemapGridData();(0,s.i)(e)||(this.remapsGridSchema={...this.remapsGridSchema,gridOptions:e})},this.handleGridRowClick=e=>{const{detail:{gridOptions:t,rowIndex:i}}=e;i<0||i>t?.length-1||(this.selectedRowId=i,this.refreshRemapsGrid())},this.updateValue_weightedOverlayTable=async e=>{const{detail:{gridOptions:t,rowIndex:i,columnName:a}}=e,l=this.inputArgs;if((0,s.i)(t)||(0,s.i)(l))return;const r=[],n=[],c=[];let h=0,o=!1,u=!1,g=!1;t.forEach(((e,i)=>{if(i===t.length-1)return;const{layer:a,influence:l,field:o}=e;if((0,s.i)(a)||(0,s.i)(o))return;r.push(a),c.push(o);let u=(0,d.p)(l);((0,s.i)(u)||isNaN(u))&&(u=0===i?100:0),h+=u,n.push(u/100)})),h!==this.sumOfInfluence&&(o=!0,this.updateSumOfInfluenceElement(h)),u="layer"===a,g="field"===a;const f=l.Rasters,p=l.Influences,m=l.Fields,v=l.Remaps;let y;if(g&&m.value?.[i]===c[i]&&(g=!1),(0,s.i)(f.value)?f.value={elements:r,type:"ArgumentArray"}:f.value.elements=r,p.value=n,m.value=c,t.length>this.weightedOverlayGridOptionsLength?y=t[i]:t.length<this.weightedOverlayGridOptionsLength?(this.deleteLayerRemapStr(i),this.selectedRowId=i+1):t.length===this.weightedOverlayGridOptionsLength&&(o||(y=t[i])),v?.value&&(u&&y?.layer||g)){this.selectedRowId=i;const e=t.length-1;await this.initLayerRemapStr(y,i,e)}this.refreshRemapsGrid(),this.weightedOverlayGridOptionsLength=t.length},this.updateValue_remapTable=e=>{const{detail:{gridOptions:t}}=e,i=this.inputArgs;if((0,s.i)(t)||(0,s.i)(i))return;const a=i.Remaps,l=a?.value?.length;if((0,s.i)(l)||l<1||this.selectedRowId<0||this.selectedRowId>l-1)return;let r="";const n=t.length-1;t.forEach((function(e,t){const{value:i,scale:a}=e;if(!(0,s.i)(i)&&!(0,s.i)(a?.value)){let e=i;const l=a.value;"string"==typeof i&&(e=i.indexOf(" ")>-1?"'"+i+"'":i),r+=e+" "+l,t<n-1&&(r+=" ; ")}})),a.value[this.selectedRowId]=r},this.updateValue_scales=async e=>{e.stopPropagation();const t=e.target.value.replace(/\s/g,"").split("-");if(2!==t.length)return;const i=parseInt(t[0],10),a=parseInt(t[1],10);if(isNaN(i)||isNaN(a)||i>a)return;this.evalScales={evalFrom:i,evalTo:a},this.inputArgs.EvalFrom.value=i,this.inputArgs.EvalTo.value=a;const l=this.selectedRowId,s=this.weightedOverlayGridSchema.gridOptions?.[l],r=this.weightedOverlayGridSchema.gridOptions?.length;await this.initLayerRemapStr(s,l,r),this.refreshRemapsGrid()}}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,l.c)(this.hostElement,(0,a.a)(".")));const{inputArgs:e,inputLayers:t}=this.widgetArgs;this.inputArgs=e,this.inputLayers=t,this.initScalesSelectOptions(),await this.initGrids()}componentDidLoad(){this.attachHelpClickEventHandlers()}async checkValidity(){return await this.gridElement.checkValidity()}attachHelpClickEventHandlers(){const e=this.widgetArgs.onHelpActionClick({heading:this.strings.weightedOverlayTable,referenceElement:this.weightedOverlayTableLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_weightedoverlaytable});this.helpActionClickEventHandlers.set(g,e);const t=this.widgetArgs.onHelpActionClick({heading:this.strings.remapTable,referenceElement:this.remapTableLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_remaptable});this.helpActionClickEventHandlers.set(f,t);const i=this.widgetArgs.onHelpActionClick({heading:this.strings.scales,referenceElement:this.scalesLabelElement,helpTextID:this.widgetArgs.helpTextIDs?.weightedoverlay_scales});this.helpActionClickEventHandlers.set(p,i)}async getSelectedLayer(e){const t=(0,r.b)(e),i=this.inputLayers.find((e=>e.url===t));return i&&await i.load(),i}getScaleOptions(){const e=[];for(let t=this.evalScales.evalFrom;t<=this.evalScales.evalTo;t++)e.push({key:t.toString(),label:t.toString()});return e.push({key:"NODATA",label:"NODATA"}),e.push({key:"RESTRICTED",label:"RESTRICTED"}),e}getDefaultGridOption_weightedOverlayTable(){return{id:0,layer:void 0,field:void 0,influence:0}}getDefaultGridOption_remapTable(){return{id:0,value:void 0,scale:{options:this.getScaleOptions(),value:void 0}}}getRemapGridData(){const e=this.inputArgs?.Remaps,t=this.selectedRowId,i=[];if(t<0||t>e?.value?.length-1)return i;if(e?.value?.[t]){e.value[t].split(";").forEach(((e,t)=>{const a=e.trim().match(/(?:[^\s']+|'[^']*')+/g);if((0,s.i)(a)||2!==a.length)return;let l=a[0];const r=a[1];l.indexOf("'")>-1&&(l=l.replace(/[']+/g,"")),i.push({id:t,value:l,scale:{options:this.getScaleOptions(),value:r}})}));const a=i.length;i.push({id:a,value:void 0,scale:{options:this.getScaleOptions(),value:void 0}})}else i.push(this.getDefaultGridOption_remapTable());return i}async readArgValues(){if((0,s.i)(this.inputArgs))return;const e=this.inputArgs,t=[],i=e.Rasters,a=e.Fields,l=e.Influences,n=e.Remaps,c=i?.value?.elements??i?.value??[];let d=[],h=0,o=0;if((0,s.i)(i)||(0,s.i)(a)||(0,s.i)(l)||(0,s.i)(n)||(h=Math.max(c?.length||0,a.value?.length||0,l.value?.length||0,n.value?.length||0),n.value=n.value??[]),0===h||isNaN(h))return t.push(this.getDefaultGridOption_weightedOverlayTable()),d.push(this.getDefaultGridOption_remapTable()),[t,d];for(;o<h;){const e=c?.[o],i=e?.value;(0,s.i)(i?.url)||(e.value=await(0,r.w)(i,this.inputLayers)),t.push({id:o,rasterElement:e,layer:e,field:a?.value?.[o],influence:(l?.value?.[o]&&((100*l.value[o]).toFixed(2)||(o>0?0:100)))??0}),o+=1}if(n?.value?.length>0)t?.length>0&&t[0]?.layer&&t[0]?.field&&(this.selectedRowId=0,d=this.getRemapGridData());else for(let e=0;e<h;e++)n.value.push("");return[t,d]}async initGrids(){const e={layer:{allowScalar:!1,label:this.strings.layer,uiType:c.G.raster,style:u.layerColumn,validationRule:v.layer},influence:{label:this.strings.influence,uiType:c.G.number,style:u.influenceColumn,validationRule:v.influence},field:{label:this.strings.field,uiType:c.G.field,style:u.fieldColumn}},t={value:{label:this.strings.value,uiType:c.G.textInput,style:u.valueColumn},scale:{label:this.strings.scale,uiType:c.G.select,style:u.scaleColumn}},i=await this.readArgValues(),a=i[0],l=i[1];this.weightedOverlayGridOptionsLength=(a?.length??0)+1,this.weightedOverlayGridSchema={...this.weightedOverlayGridSchema,gridLayout:e,gridOptions:a},this.remapsGridSchema={...this.remapsGridSchema,gridLayout:t,gridOptions:l}}initScalesSelectOptions(){if((0,s.i)(this.inputArgs))return;const{EvalFrom:e,EvalTo:t}=this.inputArgs,i=e?.value??1,a=t?.value??9;this.evalScales={evalFrom:i,evalTo:a};const l=`${i}-${a}`;this.scalesOptions.some((e=>e.key===l))||this.scalesOptions.push({key:l,label:l})}updateSumOfInfluenceElement(e){this.sumOfInfluence=e,e>100?this.sumOfInfluenceElement.classList.add(u.colorRed):this.sumOfInfluenceElement.classList.remove(u.colorRed)}async initLayerRemapStr(e,t,i){if((0,s.i)(e)||t<0||i<=0||t>i-1)return;const{layer:a,field:l}=e,{evalFrom:r,evalTo:n}=this.evalScales;if((0,s.i)(a)||(0,s.i)(l))return;let c="";if(!(0,s.i)(a.value?.url)){const e=await this.getSelectedLayer(a.value?.url),t=await(e?.generateRasterInfo(e.rasterFunction));if((0,s.i)(e))return;if(e.sourceJSON?.hasRasterAttributeTable&&l){const i=(0,s.p)(e)?e.serviceRasterInfo.attributeTable:t.attributeTable,a=i?.features;if((0,s.i)(a))return;const d=a.map((e=>e.attributes[l])).filter((function(e,t,i){return i.indexOf(e)===t}));d?.length>1&&!isNaN(d[0])&&d.sort((function(e,t){return e-t}));c=d.map((function(e,t){"string"==typeof e&&(e=e.indexOf(" ")>-1?"'"+e+"'":e);return`${e} ${t+r<=n?t+r:r}`})).join(" ; ")}}const d=t,h=this.inputArgs.Remaps;this.inputArgs.Fields.value.splice(d,1,l),h.value.length===i&&h.value.splice(d,1,c),h.value.length<i&&h.value.splice(d,0,c)}deleteLayerRemapStr(e){this.inputArgs.Remaps.value.splice(e,1)}render(){return(0,a.h)("div",{key:"b8cc75d99de88f4433700f817680216a1ef1bfb0"},(0,a.h)("calcite-label",{key:"7a81f8a66b20fe1132feda7ee2a4cd74d6dbce56",alignment:"start",scale:n.U.Scale,layout:"default",ref:e=>{this.weightedOverlayTableLabelElement=e}},(0,a.h)("rfx-label",{key:"d242b2e9fae3d03bb64e9e1819879b9e984e3204",label:this.strings.weightedOverlayTable,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(g)()}),(0,a.h)("rfx-grid",{key:"a8a3e1a70abce2f95e9e8f34227fe3122d16988b",canAdd:this.weightedOverlayGridSchema.canAdd,class:u.grid,gridLayout:this.weightedOverlayGridSchema.gridLayout,gridOptions:this.weightedOverlayGridSchema.gridOptions,hasBorder:this.weightedOverlayGridSchema.hasBorder,hasHeader:this.weightedOverlayGridSchema.hasHeader,hasIdColumn:this.weightedOverlayGridSchema.hasIdColumn,inputLayers:this.widgetArgs.inputLayers,onRfxGridRowClick:this.handleGridRowClick,onRfxGridOptionChange:this.updateValue_weightedOverlayTable,rfxBrowseLayerClick:this.widgetArgs.onRfxBrowseLayerClick,ref:e=>{this.gridElement=e}})),(0,a.h)("calcite-label",{key:"9179cc94f70afd74633df9a1752a4d060adfcafb",alignment:"start",scale:n.U.Scale,layout:"inline-space-between"},(0,a.h)("span",{key:"0a661e92254bea1962dc7077ced7444e0149faab"},this.strings.sumOfInfluence),(0,a.h)("span",{key:"82a7232c49203b51aa6756f70b9eea4b1ed3b090",ref:e=>{this.sumOfInfluenceElement=e}},this.sumOfInfluence)),(0,a.h)("calcite-label",{key:"fc47d93543ed3976b403408c97bc229d7eb33fd9",alignment:"start",scale:n.U.Scale,layout:"default",ref:e=>{this.remapTableLabelElement=e}},(0,a.h)("rfx-label",{key:"9e68228ae3773851959e55e76e63484c2ee5662c",label:this.strings.remapTable,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(f)()}),(0,a.h)("rfx-grid",{key:"2969def779e3a68b042bf2f0d8bb41f593df2ce9",canAdd:this.remapsGridSchema.canAdd,class:u.grid,gridLayout:this.remapsGridSchema.gridLayout,gridOptions:this.remapsGridSchema.gridOptions,hasBorder:this.remapsGridSchema.hasBorder,hasHeader:this.remapsGridSchema.hasHeader,hasIdColumn:this.remapsGridSchema.hasIdColumn,onRfxGridOptionChange:this.updateValue_remapTable})),(0,a.h)("calcite-label",{key:"2454c305f1e9a324702343e5d667687e2d2c2033",alignment:"start",scale:n.U.Scale,layout:"default",ref:e=>{this.scalesLabelElement=e}},(0,a.h)("rfx-label",{key:"c3cc4228ec7db2e5fcae8629c8eef300623a590c",label:this.strings.scales,onRfxLabelHelpActionClick:()=>this.helpActionClickEventHandlers?.get(p)()}),(0,a.h)("rfx-dtex-common-select",{key:"dbf77b78eb11a9ecc90b565012cb6abe7844ef49",mode:this.widgetArgs.mode,allowCustomValues:!0,options:this.scalesOptions,onRfxArgumentChange:this.updateValue_scales,value:`${this.evalScales.evalFrom}-${this.evalScales.evalTo}`})))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,a.g)(this)}};y.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-cte-weighted-overlay-table-editor__grid table{width:100%;table-layout:fixed}.rfx-cte-weighted-overlay-table-editor__grid table thead tr th:first-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table thead tr th:last-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table tbody tr td:first-child{width:7%}.rfx-cte-weighted-overlay-table-editor__grid table tbody tr td:last-child{width:7%}.rfx-cte-weighted-overlay-table-editor__color-red{color:red}.rfx-cte-weighted-overlay-table-editor__layer-column{width:40%}.rfx-cte-weighted-overlay-table-editor__influence-column{width:16%}.rfx-cte-weighted-overlay-table-editor__field-column{width:30%}.rfx-cte-weighted-overlay-table-editor__scale-column{width:30%}"}}]);