/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-714300.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-714300"],{10465:(e,t,i)=>{i.d(t,{D:()=>n,a:()=>u,b:()=>c,c:()=>o,g:()=>b,s:()=>w});class n{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}const r=(e,t,i)=>(0,a(t).subscribe)((t=>{const n=t.some((t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target)));n&&i()})),s={},a=e=>{const t=e.join(","),i=s[t];if(void 0!==i)return i;const n=new Set,r=new MutationObserver((e=>n.forEach((t=>t(e)))));globalThis.document&&r.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const a={subscribe:e=>(n.add(e),()=>{n.delete(e),0===n.size&&(r.disconnect(),s[t]=void 0)})};return s[t]=a,a},o=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const n=i.getRootNode?.();if(n===globalThis.document)return null;i=n.host}return null},c=e=>l(e,"dir","ltr"),l=(e,t,i)=>{const n=o(e,`[${t}]`);return n?.getAttribute(t)??i},g=e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},u=()=>[g(2),g(1),g(1),g(1),g(3)].join("-"),d="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),f=new Set(d),h="en",p={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},m={},y=async(e,t)=>{const i=`${t}${e}.json`;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===h?{}:await y(h,t)},b=e=>{const t=l(e,"lang",globalThis.navigator?.language||h);return{lang:t,t9nLocale:C(t)}},C=e=>{const[t,i]=e.split("-"),n=t.toLowerCase();let r=n;return i&&(r=`${n}-${i.toUpperCase()}`),r=p[r]??r,f.has(r)?r:i?C(n):h},w=(e,t,i,n)=>{let s;const a=()=>v(e,t(),n).then((e=>{s?.lang===e.lang&&s.t9nLocale===e.t9nLocale&&s.t9nStrings===e.t9nStrings||i(e),s=e})).catch(console.error);return queueMicrotask(a),r(e,["lang"],a)},v=async(e,t,i=e.localName.split("-").slice(1).join("-"))=>{const{lang:n,t9nLocale:r}=b(e),s=`${t}/${i}/t9n`,a=null===i?{}:await(async(e,t,i="")=>{const n=`${t}/${i}`,r=`${n}${e}.json`;return m[r]??(m[r]=y(e,n)),await m[r]})(r,s,"messages.");return{lang:n,t9nLocale:r,t9nStrings:a}}},32416:(e,t,i)=>{function n(e){return e.fields.filter((e=>["small-integer","big-integer","integer","single","double","long","number","string"].includes(e.type)))}function r(e,t){if(t)return e.fields.find((e=>e.name===t))}function s(e,t,i){const n=e.featureReduction;return!!n.fields?.find((e=>e.onStatisticField===t&&e.statisticType===i))}function a(e,t,i,n){const r=t.substring(0,t.lastIndexOf(`_${i}`)),s=e.featureReduction;return!!s.fields?.find((e=>e.name.substring(0,e.name.lastIndexOf(`_${n}`))===r&&e.statisticType===n))}function o(e,t){return!c(r(e,t)).find((i=>!s(e,t,i)))}function c(e){return["string","date","timestamp-offset"].includes(e.type)?["mode"]:["sum","avg","min","max","mode"]}function l(e,t){return e.featureReduction.popupTemplate.fieldInfos.find((e=>e.fieldName===t))}function g(e,t,i){const{FieldInfo:n}=i,r=t.featureReduction,{popupTemplate:s}=r;s.fieldInfos=s.fieldInfos||[];s.fieldInfos.find((t=>t.fieldName===e.name))||s.fieldInfos.push(new n({fieldName:e.name,label:e.alias,isEditable:!1,visible:!0,format:u(e,t)}))}function u(e,t){const i=e.onStatisticField,n=e.onStatisticExpression,s="sum"===e.statisticType,a="count"===e.statisticType,o=r(t,i),c=a||n&&s||o&&["small-integer","big-integer","integer","long","number"].includes(o.type);return o&&["single","double"].includes(o.type)?{digitSeparator:!0,places:1}:c?{digitSeparator:!0}:void 0}i.d(t,{a:()=>g,b:()=>c,c:()=>l,d:()=>r,e:()=>a,g:()=>n,h:()=>s,i:()=>o})},36239:(e,t,i)=>{i.d(t,{A:()=>l,a:()=>c,b:()=>s,c:()=>a,d:()=>n,e:()=>r,f:()=>o,g:()=>g,h:()=>d,i:()=>u});const n=9,r=90,s=37.5,a=9,o=90,c=37.5;var l;function g(e){const t=e.featureReduction;if(t)return"binning"===t.type?"binning":"cluster"===t.type?function(e){const t=e.featureReduction;return!!t.renderer&&"pie-chart"===t.renderer.type&&!t?.renderer?.authoringInfo?.isAutoGenerated}(e)?"pie-chart":"cluster":void 0}function u(e){const t=e.featureReduction;return!t?.renderer||!!t?.renderer?.authoringInfo?.isAutoGenerated}function d(e,t){switch(e){case"sum":return t.fields.sum;case"avg":return t.fields.mean;case"min":return t.fields.min;case"max":return t.fields.max;case"stddev":return t.fields.stdDev;case"mode":return t.fields.mode;case"var":return t.fields.var;case"count":return t.fields.count;default:return""}}!function(e){e.CLUSTERING="clustering",e.CHART_CLUSTERING="chartClustering",e.BINNING="binning"}(l||(l={}))},56612:(e,t,i)=>{var n,r,s,a;i.d(t,{a:()=>a,f:()=>n,l:()=>r,s:()=>s}),function(e){e.expression="expression/",e.raster="Raster.",e.relationship="relationships/"}(n||(n={})),function(e){e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes"}(r||(r={})),function(e){e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms"}(s||(s={})),function(e){e.bigInteger="big-integer",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset"}(a||(a={}))},79999:(e,t,i)=>{i.r(t),i.d(t,{arcgis_aggregation:()=>l});var n=i(11254),r=i(69811),s=i(36239),a=i(32416),o=(i(56612),i(14528)),c=i(84260);i(10465);const l=class{constructor(e){(0,n.r)(this,e),this.arcgisClose=(0,n.c)(this,"arcgisClose",7),this.arcgisAggregationClose=(0,n.c)(this,"arcgisAggregationClose",7),this.arcgisChange=(0,n.c)(this,"arcgisChange",7),this.arcgisAggregationChanged=(0,n.c)(this,"arcgisAggregationChanged",7),this.arcgisError=(0,n.c)(this,"arcgisError",7),this.arcgisAggregationError=(0,n.c)(this,"arcgisAggregationError",7),this.arcgisStyleBtnClick=(0,n.c)(this,"arcgisStyleBtnClick",7),this.arcgisStyleBtnBackClick=(0,n.c)(this,"arcgisStyleBtnBackClick",7),this.arcgisAggregationActive=(0,n.c)(this,"arcgisAggregationActive",7),this.manager=(0,o.u)(this),this.strings=(0,c.u)({blocking:!0}),this.tileNodes={binning:void 0,cluster:void 0,"pie-chart":void 0},this.lastFeatureReduction={binning:void 0,cluster:void 0,"pie-chart":void 0},this.view=void 0,this.layer=void 0,this.portal=void 0,this.config=void 0,this.hideLayerTitle=!1,this.symbolStylerConfig={},this.options=void 0}async setFocus(){this.flowItemNode?.setFocus()}async componentWillLoad(){console.warn("%cmap-config-components","background: #007AC2; color: #fff; border-radius: 4px; padding: 2px 4px;",'[arcgis-aggregation] component in @arcgis/map-config-components is deprecated and will be removed soon. Use "arcgis-map-config-feature-reduction" instead.'),await this.loadAllModules();const{view:e,layer:t}=this;this.props={view:e,layer:t},this.initializeFieldInfos()}componentDidLoad(){this.flowItemNode?.setFocus();const{props:e,modules:t}=this,{layer:i}=e,n=i.featureReduction;if(n&&!n.fields?.length){const e=new t.AggregateField({name:"aggregateCount",onStatisticField:void 0,alias:"aggregateCount",statisticType:"count",visible:!0});i.featureReduction.fields=[e]}n&&this.arcgisAggregationActive.emit(!0)}disconnectedCallback(){this.arcgisAggregationActive.emit(!1)}render(){const{layer:e,options:t}=this;return(0,n.h)(n.H,{key:"2d16c9fc2e784d0e65b420f688a08f34f9edc52d",class:"calcite-match-height"},(0,n.h)("calcite-flow",{key:"c859214a91ba4060361e3168ee8a69f1e4679f34",class:"flow",ref:e=>this.flowNode=e,customItemSelectors:"arcgis-aggregation-clustering, arcgis-aggregation-binning, arcgis-aggregation-fields"},"featureEffect"in e&&e.featureEffect?this.renderFeatureSpecificEffectsMessage():this.renderAggregationOptions(),(t===s.A.CLUSTERING||t===s.A.CHART_CLUSTERING)&&this.renderClusteringOptions(),t===s.A.BINNING&&this.renderBinningOptions()))}renderFeatureSpecificEffectsMessage(){const{layer:e,hideLayerTitle:t,strings:i}=this;return(0,n.h)("calcite-flow-item",{heading:i.aggregation,description:t?void 0:e.title??void 0,class:"panel",closable:!0,onCalciteFlowItemClose:()=>{this.arcgisClose.emit(),this.arcgisAggregationClose.emit()},ref:e=>this.flowItemNode=e},(0,n.h)("calcite-card",{class:"feature-specific-effects-notice"},(0,n.h)("div",{slot:"description"},i.cluster.leNotSupportedMessage)))}renderAggregationOptions(){const{props:e,hideLayerTitle:t,config:i,flowItemNode:r,tileNodes:a,options:o,strings:c}=this,{layer:l}=e,g=l.featureReduction,u={flowItemNode:r,strings:c,config:i},{renderer:d}=l,f=this.isSpike(),h="unique-value"===d.type,p=h&&!!d.field2,m="heatmap"===d.type,y="pie-chart"===d.type,b=!!d.valueExpression,C="class-breaks"===d.type&&"class-breaks-color"===d.authoringInfo?.type,w=h?d.uniqueValueInfos?.length:C?d.classBreakInfos?.length:0,v=!(f||m||y||p||"point"!==l.geometryType&&"multipoint"!==l.geometryType),A=(h||C)&&w<=10&&!p&&!b&&("point"===l.geometryType||"multipoint"===l.geometryType),R=(0,s.g)(l);return(0,n.h)("calcite-flow-item",{heading:c.aggregation,description:t?void 0:l.title??void 0,class:"panel",closable:!0,selected:![s.A.CLUSTERING,s.A.CHART_CLUSTERING,s.A.BINNING].includes(o),onCalciteFlowItemClose:()=>{this.arcgisClose.emit(),this.arcgisAggregationClose.emit()},ref:e=>this.flowItemNode=e},(0,n.h)("div",{class:"toggle"},(0,n.h)("calcite-label",{layout:"inline-space-between"},c.enableAggregation,(0,n.h)("calcite-switch",{scale:"s",checked:!!g,label:c.enableAggregation,onCalciteSwitchChange:e=>this.handleToggleAggregation(e),ref:e=>this.switchNode=e}))),(0,n.h)("div",null,v&&(0,n.h)("arcgis-aggregation-tile",{props:{title:c.clustering,imagePath:(0,n.g)("./assets/aggregation-thumbnails/clustering.jpg"),moreInfo:c.info.clustering,helpId:"120003927",...u},selected:"cluster"===R,ref:e=>a.cluster=e,onArcgisSelect:async()=>{await this.enableAggregation("cluster"),(0,n.f)(this.el)},onArcgisOptionsClick:()=>{this.options=s.A.CLUSTERING,(0,n.f)(this.el)}}),A&&(0,n.h)("arcgis-aggregation-tile",{props:{title:c.chartClustering,imagePath:(0,n.g)("./assets/aggregation-thumbnails/chartClustering.jpg"),moreInfo:c.info.chartClustering,helpId:"120003927",...u},selected:"pie-chart"===R,ref:e=>a["pie-chart"]=e,onArcgisSelect:async()=>{await this.enableAggregation("pie-chart"),(0,n.f)(this.el)},onArcgisOptionsClick:()=>{this.options=s.A.CHART_CLUSTERING,(0,n.f)(this.el)}}),(0,n.h)("arcgis-aggregation-tile",{props:{title:c.binning,imagePath:(0,n.g)("./assets/aggregation-thumbnails/binning.jpg"),moreInfo:c.info.binning,helpId:"120003926",...u},selected:"binning"===R,ref:e=>a.binning=e,onArcgisSelect:async()=>{await this.enableAggregation("binning"),(0,n.f)(this.el)},onArcgisOptionsClick:()=>{this.options=s.A.BINNING,(0,n.f)(this.el)}})))}renderClusteringOptions(){const{props:e,hideLayerTitle:t,portal:i,config:r,flowNode:a,options:o,strings:c}=this,{layer:l,view:g}=e;return(0,n.h)("arcgis-aggregation-clustering",{view:g,layer:l,portal:i,config:r,flowNode:a,selected:o===s.A.CLUSTERING||o===s.A.CHART_CLUSTERING,hideLayerTitle:t,strings:c,onArcgisChange:e=>{e.stopPropagation(),this.arcgisChange.emit(),this.arcgisAggregationChanged.emit()},onArcgisBackClick:()=>this.options=void 0})}renderBinningOptions(){const{props:e,hideLayerTitle:t,portal:i,config:r,flowNode:a,strings:o,symbolStylerConfig:c,options:l}=this,{layer:g,view:u}=e;return(0,n.h)("arcgis-aggregation-binning",{view:u,layer:g,portal:i,config:r,flowNode:a,selected:l===s.A.BINNING,hideLayerTitle:t,symbolStylerConfig:c,strings:o,onArcgisStyleBtnClick:()=>this.arcgisStyleBtnClick.emit(),onArcgisStyleBtnBackClick:()=>this.arcgisStyleBtnBackClick.emit(),onArcgisChange:e=>{e.stopPropagation(),this.arcgisChange.emit(),this.arcgisAggregationChanged.emit()},onArcgisBackClick:()=>this.options=void 0})}async loadAllModules(){const[e,t,i,n,s,a,o,c,l]=await Promise.all([(0,r.i)(),(0,r.a)(),(0,r.b)(),(0,r.c)(),(0,r.d)(),(0,r.e)(),(0,r.f)(),(0,r.g)(),(0,r.h)()]);this.modules={popupClusters:e,popupUtils:t,binLevel:i,clusterLabelCreator:n,binLabelCreator:s,AggregateField:a,FieldInfo:o,pieChartCreator:c,colorCreator:l}}async handleToggleAggregation(e){e.currentTarget.checked?await this.enableAggregation("default"):this.disableAggregation(),(0,n.f)(this.el)}async enableAggregation(e){const{props:t,flowItemNode:i}=this,{layer:r}=t,{renderer:a}=r,o=this.isSpike(),c="unique-value"===a.type&&!!a.field2,l="heatmap"===a.type,g="pie-chart"===a.type;if("default"===e&&this.lastFeatureReductionType&&this.lastFeatureReduction[this.lastFeatureReductionType])r.featureReduction=this.lastFeatureReduction[this.lastFeatureReductionType],r.featureReduction=r.featureReduction.clone(),this.arcgisChange.emit(),this.arcgisAggregationChanged.emit(),this.arcgisAggregationActive.emit(!0);else{"default"===e&&(e=o||l||g||c||"point"!==r.geometryType&&"multipoint"!==r.geometryType?"binning":"cluster");const t=(0,s.g)(r);if(t&&("binning"===r.featureReduction.type&&(r.featureReduction.labelsVisible=!1),this.lastFeatureReduction[t]=r.featureReduction),this.lastFeatureReduction[e])r.featureReduction=this.lastFeatureReduction[e],r.featureReduction=r.featureReduction.clone(),this.arcgisChange.emit(),this.arcgisAggregationChanged.emit(),this.arcgisAggregationActive.emit(!0);else try{i.loading=!0,"binning"===e?await this.createBinning():await this.createCluster(e),i.loading=!1,r.featureReduction=r.featureReduction.clone(),this.arcgisChange.emit(),this.arcgisAggregationChanged.emit(),this.arcgisAggregationActive.emit(!0)}catch(e){i.loading=!1,this.arcgisError.emit({message:"Aggregation style could not be changed.",type:"warning"}),this.arcgisAggregationError.emit({message:"Aggregation style could not be changed.",type:"warning"}),this.arcgisAggregationActive.emit(!1),(0,n.f)(this.el)}}}async createCluster(e){const{props:t,switchNode:i,tileNodes:n,modules:r}=this,{layer:o,view:c}=t,{popupClusters:l,clusterLabelCreator:g,pieChartCreator:u}=r,d=o.featureReduction;try{const t="cluster"===e&&await g.getLabelSchemes({layer:o,renderer:o.renderer,view:c});let i;o.featureReduction={type:"cluster",clusterMinSize:t?.primaryScheme?.clusterMinSize||s.c,clusterMaxSize:s.a,clusterRadius:s.b,labelsVisible:"cluster"===e,labelingInfo:t?.primaryScheme?.labelingInfo},"pie-chart"===e&&(i=await u.createRendererForClustering({layer:o}),o.featureReduction.renderer=i.renderer,o.featureReduction.fields=o.featureReduction.fields.concat(i.fields));const n=await l.getTemplates({layer:o,renderer:o.renderer});if("cluster"===e){const e=n.primaryTemplate.value;o.featureReduction.popupTemplate=e}else{const e=n.secondaryTemplates[0].value;o.featureReduction.popupTemplate=e,i&&i.fields.forEach((e=>(0,a.a)(e,o,r)))}await Promise.resolve()}catch(e){o.featureReduction=d,o.featureReduction?n[(0,s.g)(o)].setFocus():i.setFocus(),await Promise.reject(new Error("Failed to create clusters"))}}async createBinning(){const{props:e,switchNode:t,tileNodes:i,modules:n}=this,{layer:r,view:a}=e,{popupUtils:o,binLevel:c,binLabelCreator:l,AggregateField:g,colorCreator:u}=n,d=r.featureReduction;try{const e=await c({view:a});if(r.featureReduction={type:"binning",fixedBinLevel:e||1},!r.featureReduction.fields?.length){const e=new g({name:"aggregateCount",onStatisticField:void 0,alias:"aggregateCount",statisticType:"count",visible:!0});r.featureReduction.fields=[e]}const t=await u.createContinuousRenderer({layer:r,view:a,field:"aggregateCount",outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,defaultSymbolEnabled:!1,forBinning:!0});r.featureReduction.renderer=t.renderer;const i=await l.getLabelSchemes({layer:r});r.featureReduction.labelingInfo=i?.primaryScheme?.labelingInfo,r.featureReduction.labelsVisible=!1;const n=r.featureReduction.fields.map((e=>e.onStatisticField)),s=o.createPopupTemplateForFeatureReduction({featureReduction:r.featureReduction,fields:r.fields.filter((e=>n.includes(e.name)))});return r.featureReduction.popupTemplate=s,await Promise.resolve()}catch(e){return r.featureReduction=d,r.featureReduction?i[(0,s.g)(r)].setFocus():t.setFocus(),void await Promise.reject(new Error("Failed to create binning"))}}disableAggregation(){const{props:e}=this,{layer:t}=e,i=(0,s.g)(t);"binning"===i?(t.featureReduction.labelsVisible=!1,this.lastFeatureReduction[i]=t.featureReduction):this.lastFeatureReduction[i]=t.featureReduction,this.lastFeatureReductionType=i,t.featureReduction=null,this.arcgisChange.emit(),this.arcgisAggregationChanged.emit(),this.arcgisAggregationActive.emit(!1)}initializeFieldInfos(){const{layer:e,modules:t}=this,i=e.featureReduction;i?.popupTemplate&&!i.popupTemplate.fieldInfos&&i.fields.forEach((i=>(0,a.a)(i,e,t)))}isSpike(){const{layer:e}=this,{renderer:t}=e;return!!t.authoringInfo?.visualVariables?.some((e=>"spike"===e.theme))}static get assetsDirs(){return["assets"]}get el(){return(0,n.a)(this)}};l.style=":host{height:100%}.flow{height:100%}.panel{height:100%}.toggle{background-color:white;padding:15px 10px 5px 10px}.feature-specific-effects-notice{margin:var(--calcite-spacing-lg)}"},84260:(e,t,i)=>{i.d(t,{u:()=>a});var n=i(11254),r=i(10465),s=i(14528);function a({propertyName:e="strings",name:t}){let i=(0,s.r)();const a=(0,r.g)(i.el),c=new r.D,l={_lang:a.lang,_t9nLocale:a.t9nLocale};i.manager.onLoad((()=>c.promise));const g=new WeakRef(i);function u(){const e=g.deref();return e||f?.(),e}i=void 0;const d=o((()=>u()?.el)),f=(0,r.s)(d,(()=>(0,n.g)("./assets")),(({t9nLocale:t,t9nStrings:i,lang:n})=>{const r=u();if(!r)return;r[e]={...i,_lang:n,_t9nLocale:t},c.resolve()}),t);return l}const o=e=>new Proxy({},{get(t,i){const n=e();if(!n)return;const r=Reflect.get(n,i,n);return"function"==typeof r?r.bind(n):r}})}}]);