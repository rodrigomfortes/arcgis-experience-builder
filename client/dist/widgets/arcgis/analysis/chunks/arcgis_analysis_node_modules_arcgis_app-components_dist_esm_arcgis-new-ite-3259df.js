/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-3259df.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-new-ite-3259df"],{23405:(e,r,t)=>{t.r(r),t.d(r,{arcgis_new_item_pages_feature_layer_from_url:()=>h});var n=t(87849),a=t(90310),s=t(59317),i=t(87744),o=t(72257),l=t(32710),c=t(3826),d=t(95878),u=t(99654),m=t(33547);t(50637),t(931),t(93814),t(50822),t(83929),t(68194),t(37762),t(86562),t(15332),t(76246),t(63054),t(15912),t(24869),t(50020),t(75294),t(38295),t(51102),t(56175),t(43555),t(90079),t(31544);const h=class{constructor(e){(0,n.r)(this,e),this.newItemUpdatePage=(0,n.c)(this,"newItemUpdatePage",7),this.getLayerDetailInfo=async()=>{const{url:e}=this,r=s.c.portal,{result:t}=await(0,a.g)([e],r),n=null==t?void 0:t[0];if(!(null==n?void 0:n.item))return null;const{result:i}=await(0,a.a)({itemId:n.item.id,owningSystemUrl:n.owningSystemUrl});return i},this.url=void 0,this.error=void 0,this.loading=void 0}async componentWillLoad(){this.i18n=d.u.i18n.featureLayerFromUrl,this.commonI18n=d.u.i18n.common,this.url=c.a.serviceInfoUrl}async handleNext(){var e,r,t,n,a;const{url:d,getLayerDetailInfo:h}=this;if(!d)return(0,m.f)("Empty URL"),this.inputRef.setFocus(),void(this.error="missingUrl");const{error:g}=(0,u.g)(d);if(g)return(0,m.f)("Invalid URL"),this.inputRef.setFocus(),void(this.error=g.code);this.loading=!0;const y=d.toLowerCase().indexOf("/featureserver"),p=d.substring(0,y)+"/FeatureServer";try{const{result:u}=await(0,l.I)({url:p});(null==u?void 0:u.isSecured)&&(c.a.checkAuth=!0);const{layers:m,serviceInfo:g,tables:y}=await(0,l.v)({serviceUrl:d,restBaseUrl:(0,i.g)(s.c.portal),forceAddToken:!1,isSecure:null==u?void 0:u.isSecured}),w=await h();c.a.layerData=w,c.a.serviceInfo=Object.assign(Object.assign({},g),{layers:m,tables:y});let f=null===(e=g.documentInfo)||void 0===e?void 0:e.title;const v=null!==(r=g.layers)&&void 0!==r?r:[],b=null!==(t=g.tables)&&void 0!==t?t:[];f||(1===v.length&&0===b.length?f=v[0].name:1===b.length&&0===v.length&&(f=b[0].name)),c.a.initialTitle=f,o.i.snippet=null!==(n=g.serviceDescription)&&void 0!==n?n:"",c.a.description=null!==(a=g.description)&&void 0!==a?a:"",c.a.serviceInfoUrl=d,this.loading=!1,this.newItemUpdatePage.emit("featureLayerSummary")}catch(e){(0,m.f)("Service doesn't exist"),this.error="serviceNotExist"}}handleInputChange(e){this.url=e.target.value}render(){const{loading:e,i18n:r,commonI18n:t,error:a,url:i}=this,{title:o,description:l}=r.error[a]||{},{portal:c}=s.c;return(0,n.h)(n.H,{key:"6d166ff65177855b2ecca87f4de895b313dc8e3b"},(0,n.h)("arcgis-new-item-loader",{key:"d4e58f49fa1ba450e2b26c94e9041788d30c19ba",active:e,text:d.u.i18n.urlType.getServiceInfo}),(0,n.h)("calcite-label",{key:"d5dad77428dfc6b6f31ab3a1850c9d4fc552cbf0",class:"label"},(0,n.h)("arcgis-new-item-description",{key:"3b7bc6953821be17fcb286ad802df0ffbd0e3164",header:t.url,content:r.description}),(0,n.h)("calcite-input",{key:"fca2443fc26d85b759c4df799c30e4d90c724325",placeholder:c.isPortal?"https://webadaptorhost.domain.com/webadaptorname/rest/services/service/servicetype":"https://myserver.com/arcgis/rest/services/folder/service/FeatureServer",onCalciteInputInput:e=>this.handleInputChange(e),class:"input",scale:"l",ref:e=>this.inputRef=e,value:i})),(0,n.h)("arcgis-new-item-alert",{key:"3fb5fb98f0a733c1ec01bf09e2a7cbba58a73ddb",heading:o,description:l,active:!!a,onAlertDismiss:()=>this.error=null}))}get el(){return(0,n.a)(this)}};h.style=".input{margin-top:1rem}.label{margin-top:1rem;display:block}"},68194:(e,r,t)=>{t.d(r,{r:()=>s});var n=t(50637),a=t(59317);const s=async(e,r,t={})=>{const{body:s,usePost:i,addTokenManually:o,api:l=(null===a.c||void 0===a.c?void 0:a.c.api),customToken:c}=t,d=new URLSearchParams;s&&Object.entries(s).forEach((([e,r])=>{void 0!==r&&d.append(e,r)}));const u=new URL(e);if(u.searchParams.append("f","json"),c)u.searchParams.append("token",c);else{const e=!1===o?null:await(0,n.b)(r,l);e&&u.searchParams.append("token",e)}const m=await fetch(u.toString(),{body:i?d:void 0,method:i?"POST":"GET"}),h=await m.json(),g=h.error;if(g)throw"string"==typeof g?new Error(g):g;return h}},90310:(e,r,t)=>{t.d(r,{a:()=>v,b:()=>u,c:()=>m,d:()=>h,f:()=>d,g:()=>g,l:()=>b});var n=t(50637),a=t(80379),s=t(50822),i=t(931),o=t(87744),l=t(83929),c=t(68194);const d=async(e,r,t)=>{const{owningSystemUrl:a}=await(0,n.f)((async()=>(0,l.g)(e)),"portalInfo",e.id);return(await Promise.all(r.map((async e=>{try{const{owningSystemUrl:r}=await(0,l.a)(e,t);return{owningSystemUrl:r,url:e}}catch(r){return console.error(r),{owningSystemUrl:null,url:e}}})))).filter((({owningSystemUrl:e})=>e===a)).map((({url:e})=>e))},u=async(e,r)=>{var t;try{return{result:await(0,c.r)(e,r,{addTokenManually:!1})}}catch(e){const r="token required";return(null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase().includes(r))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}};async function m(e,r,t){var a;const{relationshipType:s,direction:i}=t,l=`${(0,o.g)(r)}content/items/${e}/relatedItems`,c=await(0,n.r)(l,{relationshipType:s,direction:i,includeRecycleBin:!0});return(null===(a=null==c?void 0:c.relatedItems)||void 0===a?void 0:a.length)&&(c.relatedItems=c.relatedItems.filter((r=>(null==r?void 0:r.id)!==e))),c}const h=async(e,r,t)=>{const a=!!t,s=(0,o.g)(r),i=a?`${s}/content/groups/${t.id}/search`:`${s}/search`;try{return{result:(await(0,n.r)(i,{filter:`id:(${e.join(" OR ")})`,num:100})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},g=async(e,r,t)=>{try{const a=[],s=[],i=[];await Promise.all(e.map((async e=>{const{result:o,error:c}=await(0,n.f)((()=>u(e,r)),"itemMetadata",`${e}--no-token`);if("tokenRequired"!==(null==c?void 0:c.code))if(y(o))a.push(p(o,e));else try{const r=await(0,l.a)(e,t);i.push(Object.assign(Object.assign({},o),{owningSystemUrl:r.owningSystemUrl}))}catch(c){console.warn(c)}else s.push(e)})));const o=await d(r,s,t),m=(await Promise.all(o.map((async e=>({response:await(0,c.r)(e,r,{addTokenManually:!0}),owningSystemUrl:(await(0,l.a)(e,t)).owningSystemUrl,url:e}))))).reduce(((e,{response:r,url:t,owningSystemUrl:n})=>y(r)?(a.push(p(r,t)),e):[...e,Object.assign(Object.assign({},r),{owningSystemUrl:n})]),[]),h=await Promise.all([...i,...m].map((async({serviceItemId:e,owningSystemUrl:r})=>{if(!e)return null;const{result:t}=await f({itemId:e,owningSystemUrl:r});return{item:t,owningSystemUrl:r}}))),{result:w}=a.length<=0?{result:[]}:await g(a,r,t);return{result:[...h.filter((e=>!!e)),...w]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},y=e=>!!(null==e?void 0:e.sources),p=(e,r)=>{var t;const n=null===(t=Object.values(e.sources)[0])||void 0===t?void 0:t.url;return n?n.includes("..")?(0,o.t)({url:r,path:n}):n:null},w=e=>`${e}/sharing/rest`,f=async({itemId:e,owningSystemUrl:r,requestOptions:t})=>{try{const a=(0,s.g)(e,w(r));return{result:await(0,n.r)(a,{},Object.assign(Object.assign({},t),{addTokenManually:!1}))}}catch(e){return console.error(e),(0,a.a)(e)&&e.message.toLocaleLowerCase().includes("invalid token")?{error:{code:"invalidToken"}}:{error:{code:"unhandledError"}}}},v=async({itemId:e,owningSystemUrl:r,requestOptions:t})=>{try{const a=`${(0,s.g)(e,w(r))}/data`;return{result:await(0,n.r)(a,{},Object.assign(Object.assign({},t),{addTokenManually:!1}))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},b=async(e,r)=>{try{const[t]=await(0,i.l)(["esri/portal/PortalItem"]),n=new t({id:e,portal:r});return await n.load(),{result:n}}catch(e){return console.error("Fail to reload item",e),{error:{code:"unhandledError"}}}}}}]);