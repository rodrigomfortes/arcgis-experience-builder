/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-c9480a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-c9480a"],{2854:(t,e,s)=>{function o(t){return t?.sourceJSON?.id}s.d(e,{g:()=>o})},3175:(t,e,s)=>{s.d(e,{a:()=>n,g:()=>i});var o=s(20173);function n(t){const{customBaseUrl:e,portalHostname:s,urlKey:o}=t,{protocol:n}=window.location;return`${n}//${o?`${o}.${e}`:s}`}function i(t){return(0,o.a)(t.restUrl)}},4573:(t,e,s)=>{function o(t,e,s){window.localStorage.setItem(t,s?JSON.stringify(e):e)}function n(t){window.localStorage.removeItem(t)}function i(t,e){const s=window.localStorage.getItem(t);return s&&e?JSON.parse(s):s}function a(t,e,s){window.sessionStorage.setItem(t,s?JSON.stringify(e):e)}function r(t,e){const s=window.sessionStorage.getItem(t);return s&&e?JSON.parse(s):s}s.d(e,{a:()=>r,b:()=>a,g:()=>i,r:()=>n,s:()=>o})},10465:(t,e,s)=>{s.d(e,{D:()=>o,a:()=>p,b:()=>l,c:()=>r,g:()=>b,s:()=>I});class o{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}const n=(t,e,s)=>(0,a(e).subscribe)((e=>{const o=e.some((e=>((t,e)=>{let s=t;for(;s;){if(s===e)return!0;if(!s.parentNode)return!1;s=s.parentNode instanceof ShadowRoot?s.parentNode.host:s.parentNode}return!1})(t,e.target)));o&&s()})),i={},a=t=>{const e=t.join(","),s=i[e];if(void 0!==s)return s;const o=new Set,n=new MutationObserver((t=>o.forEach((e=>e(t)))));globalThis.document&&n.observe(document.documentElement,{attributes:!0,attributeFilter:t,subtree:!0});const a={subscribe:t=>(o.add(t),()=>{o.delete(t),0===o.size&&(n.disconnect(),i[e]=void 0)})};return i[e]=a,a},r=(t,e)=>{let s=t;for(;s;){const t=s.closest?.(e);if(t)return t;const o=s.getRootNode?.();if(o===globalThis.document)return null;s=o.host}return null},l=t=>c(t,"dir","ltr"),c=(t,e,s)=>{const o=r(t,`[${e}]`);return o?.getAttribute(e)??s},d=t=>{let e="";for(let s=0;s<t;s++)e+=(65536*(1+Math.random())|0).toString(16).substring(1);return e},p=()=>[d(2),d(1),d(1),d(1),d(3)].join("-"),m="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),u=new Set(m),g="en",h={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},w={},f=async(t,e)=>{const s=`${e}${t}.json`;try{const t=await fetch(s);if(t.ok)return await t.json()}catch(t){return console.error(t),{}}return t===g?{}:await f(g,e)},b=t=>{const e=c(t,"lang",globalThis.navigator?.language||g);return{lang:e,t9nLocale:y(e)}},y=t=>{const[e,s]=t.split("-"),o=e.toLowerCase();let n=o;return s&&(n=`${o}-${s.toUpperCase()}`),n=h[n]??n,u.has(n)?n:s?y(o):g},I=(t,e,s,o)=>{let i;const a=()=>v(t,e(),o).then((t=>{i?.lang===t.lang&&i.t9nLocale===t.t9nLocale&&i.t9nStrings===t.t9nStrings||s(t),i=t})).catch(console.error);return queueMicrotask(a),n(t,["lang"],a)},v=async(t,e,s=t.localName.split("-").slice(1).join("-"))=>{const{lang:o,t9nLocale:n}=b(t),i=`${e}/${s}/t9n`,a=null===s?{}:await(async(t,e,s="")=>{const o=`${e}/${s}`,n=`${o}${t}.json`;return w[n]??(w[n]=f(t,o)),await w[n]})(n,i,"messages.");return{lang:o,t9nLocale:n,t9nStrings:a}}},20173:(t,e,s)=>{s.d(e,{a:()=>o});const o=t=>t&&!t.endsWith("/")?`${t}/`:t},44735:(t,e,s)=>{function o(t,e){if(!t||!e)return;let s=e.assetsPath;s.endsWith("/")||(s+="/"),t?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${s}esri/themes/light/main.css" />`)}s.d(e,{i:()=>o})},45860:(t,e,s)=>{s.r(e),s.d(e,{arcgis_map_config_print:()=>h});var o=s(11254),n=s(69811),i=s(17840),a=s(4573),r=s(2854),l=s(14528),c=s(84260),d=s(3175),p=s(44735);s(56612),s(10465);const m=["tiff","gif","jpg","pdf","png"],u="arcgis-app-print-custom-templates-storage-infos",g="arcgis-app-print-export-links-storage-infos",h=class{constructor(t){(0,o.r)(this,t),this.arcgisSaveItem=(0,o.c)(this,"arcgisSaveItem",7),this.arcgisClose=(0,o.c)(this,"arcgisClose",7),this.manager=(0,l.u)(this),this.strings=(0,c.u)({blocking:!0}),this.mapView=void 0,this.portal=void 0,this.templateOptions={legendEnabled:!0},this.showPrintAreaEnabled=!1,this.showHeading=!1,this.closable=!1}async setShowPrintAreaEnabled(t){this.printWidget.showPrintAreaEnabled=t}async updateTemplateOptions(t){this.printWidget.templateOptions=t}async processNewItem(t,e){const{modules:s,portal:o,printWidget:n}=this,i=(0,r.g)(o.user),l=new s.PortalItem({id:t});await l.load();n.exportedLinks.find((t=>t.url===e)).portalItem=l;const c=(0,a.g)(g,!0)||{},d=c[i],p=d?.find((t=>t.url===e));p&&(p.portalItemId=l.id,(0,a.s)(g,c,!0))}async componentWillLoad(){await this.loadAllModules(),this.blockBetaApps=await this.orgBlocksBetaApps()}async componentDidLoad(){const{modules:t}=this;(0,p.i)(this.el.shadowRoot,t.config)}disconnectedCallback(){this.printWidget?.destroy()}render(){const{strings:t,showHeading:e,closable:s}=this;return(0,o.h)(o.H,{key:"f363433ccbee08aa7c75f5608d56a354e04e6a3f"},(0,o.h)("calcite-panel",{key:"c1ed1eb61acfc7d6b775031cfae317654a7e1f3d",heading:e?t.print:void 0,closable:s,onCalcitePanelClose:()=>this.arcgisClose.emit()},(0,o.h)("div",{key:"a3ef514bce3c328c4cb285237637c28f2c9a408d",ref:t=>{this.afterCreateDiv(t)}})))}async loadAllModules(){const[t,e,s,o,i,a,r]=await Promise.all([(0,n.j)(),(0,n.k)(),(0,n.l)(),(0,n.m)(),(0,n.n)(),(0,n.o)(),(0,n.p)()]);this.modules={config:t,Print:e,reactiveUtils:s,PortalItem:o,Collection:i,esriLang:a,request:r}}async afterCreateDiv(t){const e=window.customElements?.get("arcgis-item-browser"),s=window.customElements?.get("arcgis-new-item"),{modules:o,mapView:n,portal:i,templateOptions:l,showPrintAreaEnabled:c,blockBetaApps:d}=this,p=await this.getEligibleExportLinks(),g=(0,r.g)(i.user),h=new o.Print({view:n,portal:i,templateOptions:l,showPrintAreaEnabled:c,container:t,headerVisible:!1,includeOrganizationTemplates:i.isPortal||!d,exportedLinks:p,saveExportHidden:!0,allowedFormatsForSaving:m});this.printWidget=h,g&&s&&(h.saveAsButtonCallback=t=>this.arcgisSaveItem.emit(t));const w=new Set(["GISProfessionalStdUT","GISProfessionalAdvUT"]);e&&i.user&&!d&&(i.isPortal||w.has(i.user.sourceJSON.userLicenseTypeId))&&(h.viewModel.when((()=>this.populateCustomTemplates())),h.browseTemplateButtonOnClick=t=>{const e=t.target;e.disabled=!0;const s=document.createElement("arcgis-map-config-print-browse-templates");s.portal=i,s.strings=this.strings,document.body.appendChild(s),s.addEventListener("arcgisClose",(t=>{if(t.detail?.length){t.detail.forEach((t=>{const e=new o.PortalItem({id:t.id,title:t.title,portal:i});h.viewModel.addPortalTemplate(e)}))}document.body.removeChild(s),e.disabled=!1}))}),o.reactiveUtils.watch((()=>h.viewModel.browseTemplates?.items?.length),(()=>{const t=(0,r.g)(i.user),e=h.viewModel.browseTemplates.items.map((t=>({itemId:t.layoutItem.id,title:t.layoutItem.title}))),s=(0,a.g)(u,!0)||{};e.length?s[t]=e:delete s[t],(0,a.s)(u,s,!0)})),h.on("submit",(async()=>await this.checkPortalItemValidity())),h.on("complete",(async t=>{const e=t.link.url;await this.updateLocalStorageExportLinks({filterByTime:!0,completedExportUrl:e})})),o.reactiveUtils.watch((()=>h.exportedLinks.items?.length),(async(t,e)=>{t<e&&await this.updateLocalStorageExportLinks({filterByTime:!1})}))}populateCustomTemplates(){const{modules:t,portal:e,printWidget:s}=this,o=(0,r.g)(e.user),n=((0,a.g)(u,!0)||{})[o];n?.forEach((async o=>{try{const n=new t.PortalItem({id:o.itemId,title:o.title,portal:e});await n.load(),s.viewModel.addPortalTemplate(n)}catch(t){}}))}async getEligibleExportLinks(){const{modules:t,portal:e}=this,s=(0,r.g)(e.user);if(!s)return new t.Collection;const o=(0,a.g)(g,!0)||{},n=o[s];if(!n?.length)return new t.Collection;const i=n.filter((t=>!this.isTooOld(t)));await Promise.all(i.map((async e=>{if(e.portalItemId)try{const s=new t.PortalItem({id:e.portalItemId});await s.load()}catch{e.portalItem=void 0,e.portalItemId=void 0}}))),i.length?o[s]=i:delete o[s],(0,a.s)(g,o,!0);return await this.getExportLinkCollectionWithPortalItems(i)}async updateLocalStorageExportLinks(t){const{portal:e,printWidget:s}=this,o=(0,r.g)(e.user);if(!o)return;const n=(0,a.g)(g,!0)||{},l=s.exportedLinks.map((e=>{const s=n[o]?.find((t=>t.url===e.url));return s||(e.url===t?.completedExportUrl?{count:e.count,error:e.error,extension:e.extension,name:e.name,portalItem:void 0,portalItemId:void 0,state:e.state,timestamp:(new Date).getTime(),url:e.url}:void 0)})).filter((t=>(0,i.i)(t))),c=t?.filterByTime?l.filter((t=>!this.isTooOld(t))):l;c.length?n[o]=c.filter((t=>"ready"===t.state)):delete n[o];if(!s.exportedLinks.some((t=>"pending"===t.state))){const t=await this.getExportLinkCollectionWithPortalItems(c),e=s.exportedLinks.map((e=>t.find((t=>e.url===t.url))));s.exportedLinks=e.filter((t=>(0,i.i)(t)))}(0,a.s)(g,n,!0)}isTooOld(t){return((new Date).getTime()-t.timestamp)/6e4>10}async getExportLinkCollectionWithPortalItems(t){const{modules:e}=this,s=new e.Collection;if(!t.length)return s;const o=e.esriLang.clone(t);return await Promise.all(o.map((async t=>{let e;if(t.portalItemId)try{const{modules:s}=this;e=new s.PortalItem({id:t.portalItemId}),await e.load()}catch{e=void 0}t.portalItem=e}))),s.addMany(o.map((t=>({count:t.count,error:t.error,extension:t.extension,name:t.name,portalItem:t.portalItem,state:t.state,url:t.url})))),s}async checkPortalItemValidity(){const{modules:t,portal:e,printWidget:s}=this,o=(0,r.g)(e.user),n=(0,a.g)(g,!0)||{},i=n[o];await Promise.all(s.exportedLinks.map((async e=>{if("ready"===e.state&&e.portalItem?.id)try{const s=new t.PortalItem({id:e.portalItem.id});await s.load()}catch{e.portalItem=void 0;const t=i.find((t=>t.url===e.url));t.portalItem=void 0,t.portalItemId=void 0}}))),(0,a.s)(g,n,!0)}async orgBlocksBetaApps(){const{modules:t,portal:e}=this;if(!e.user)return await Promise.resolve(!1);const s=`${(0,d.g)(e)}portals/self/signinSettings`,o=await t.request(s,{query:{f:"json",async:!1},responseType:"json"});return o?.data&&!o.data.blockBetaApps?await Promise.resolve(!1):await Promise.resolve(!0)}static get assetsDirs(){return["assets"]}get el(){return(0,o.a)(this)}};h.style=":host{height:100%;width:100%}.flow{height:100%}"},84260:(t,e,s)=>{s.d(e,{u:()=>a});var o=s(11254),n=s(10465),i=s(14528);function a({propertyName:t="strings",name:e}){let s=(0,i.r)();const a=(0,n.g)(s.el),l=new n.D,c={_lang:a.lang,_t9nLocale:a.t9nLocale};s.manager.onLoad((()=>l.promise));const d=new WeakRef(s);function p(){const t=d.deref();return t||u?.(),t}s=void 0;const m=r((()=>p()?.el)),u=(0,n.s)(m,(()=>(0,o.g)("./assets")),(({t9nLocale:e,t9nStrings:s,lang:o})=>{const n=p();if(!n)return;n[t]={...s,_lang:o,_t9nLocale:e},l.resolve()}),e);return c}const r=t=>new Proxy({},{get(e,s){const o=t();if(!o)return;const n=Reflect.get(o,s,o);return"function"==typeof n?n.bind(o):n}})}}]);