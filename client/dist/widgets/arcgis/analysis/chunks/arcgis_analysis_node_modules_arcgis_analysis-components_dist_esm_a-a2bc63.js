"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_analysis-components_dist_esm_a-a2bc63"],{44851:(e,t,i)=>{i.d(t,{A:()=>u,B:()=>ni,C:()=>mi,D:()=>fi,E:()=>W,V:()=>fe,a:()=>m,b:()=>x,c:()=>L,d:()=>E,e:()=>V,f:()=>P,g:()=>R,h:()=>$,i:()=>Q,j:()=>j,k:()=>ee,l:()=>me,m:()=>ve,n:()=>be,o:()=>we,p:()=>ke,q:()=>Ee,r:()=>Me,s:()=>Fe,t:()=>Pe,u:()=>$e,v:()=>Qe,w:()=>Zt,x:()=>Jt,y:()=>ei,z:()=>ti});var s=i(28445),a=i(34074),l=i(35385),n=i(84121),r=i(60443),o=i(1161),h=i(69402),c=i(52095);const d="control-margin",p="label",u=class{constructor(e){(0,s.r)(this,e),this.analysisBooleanInputChange=(0,s.c)(this,"analysisBooleanInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.displayStyle="checkbox",this.hideHelp=!1,this.readOnly=!1,this.handleCheckChange=()=>{this.value=!this.value,this.analysisBooleanInputChange.emit()}}render(){const e=(0,a.z)(this.validationParams),t=!1===(0,a.d)(e),i=(0,a.D)(this.validationParams?.type);return(0,s.h)(s.H,{key:"ded54b9ce471063dc50ed10bb58ddc5567e9d6fa"},(0,s.h)("calcite-label",{key:"b848bdb4fdef601fe75f9f5fe85da77cf2cfb4b5",class:p,layout:this.labelLayout??"inline"},"switch"===this.displayStyle?(0,s.h)("calcite-switch",{class:d,scale:a.c.Scale,checked:this.value??!1,onCalciteSwitchChange:this.handleCheckChange,disabled:this.readOnly}):(0,s.h)("calcite-checkbox",{class:d,scale:a.c.Scale,checked:this.value??!1,onCalciteCheckboxChange:this.handleCheckChange,disabled:this.readOnly}),!1===(0,a.d)(this.label)&&(0,s.h)("analysis-label",{key:"25e4810962ac67c1df1d04a4b661906f55c55bfe",label:this.label,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp})),!1===this.readOnly&&(0,s.h)("calcite-input-message",{key:"33ae0a3c869b1f6cc193df16d6cc72751b810079",status:i,hidden:!t,scale:a.c.Scale,icon:"exclamationMarkTriangle"},e))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}};u.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{--calcite-label-margin-bottom:0rem}.control-margin{margin-bottom:var(--analysis-quarter-spacing)}.label{width:100%}";const m=class{constructor(e){(0,s.r)(this,e),this.analysisChipGroupSelectionChange=(0,s.c)(this,"analysisChipGroupSelectionChange",7),this.chipRefs=[],this.canSelectAll=!0,this.scale=a.c.Scale,this.selectAllEnabled=!1,this.disabled=!1,this.dismissible=!1,this.selectedChips=[],this.initialChipSelection=[],this.required=!1,this.isValid=!0,this.selectAllHandler=()=>{Array.isArray(this.value)?this.selectedChips.length<this.value.length?(this.selectedChips=this.value,this.canSelectAll=!1):(this.selectedChips=[],this.canSelectAll=!0):(this.selectedChips=1===this.selectedChips.length?[]:[this.value],this.canSelectAll=1!==this.selectedChips.length),this.analysisChipGroupSelectionChange.emit()},this.handleCalciteChipClick=e=>{const t=e.target.value;this.disabled||this.handleChipSelection(t)},this.validateSelection=()=>{this.isValid=this.selectedChips.length>0},this.renderChips=()=>{const e=(0,a.ac)(this.value,this.chipLabel);return(0,s.h)(s.H,null,(0,s.h)("div",null,e.map((([e,t],i)=>(0,s.h)("calcite-chip",{label:t,key:e,scale:this.scale,ref:e=>{null==e||this.value.includes(e.value)||this.chipRefs.push(e)},appearance:"outline",kind:this.selectedChips.includes(e)?"brand":"neutral",icon:Array.isArray(this.iconLabel)?this.iconLabel[i]:this.iconLabel,value:e,onClick:this.handleCalciteChipClick,class:this.disabled?"analysis-chip-disabled":"analysis-chip-button",closed:!1,closable:this.dismissible,messageOverrides:{dismissLabel:this.strings.remove}},t))),this.selectAllEnabled?(0,s.h)("calcite-button",{round:!0,scale:this.scale,kind:"brand",appearance:"transparent",onClick:this.selectAllHandler},this.canSelectAll?this.strings.selectAll:this.strings.deselectAll):null,this.renderErrorMessage()))},this.renderErrorMessage=()=>!0===this.required&&!1===this.isValid?(0,s.h)("calcite-input-message",{status:a.Z.INVALID,scale:a.c.Scale,icon:"exclamationMarkTriangle"},(0,a.t)(this.validationParams?.badInputMessage??this.strings.requiredError,{})):null,this.renderChip=()=>(0,s.h)(s.H,null,(0,s.h)("div",null,(0,s.h)("calcite-chip",{label:this.chipLabel,ref:e=>{0===this.chipRefs.length&&this.chipRefs.push(e)},kind:this.selectedChips.includes(this.value)?"brand":"neutral",appearance:"outline",icon:this.chipLabel,scale:this.scale,value:this.value,onClick:this.handleCalciteChipClick,class:this.disabled?"analysis-chip-disabled":"analysis-chip-button",closable:this.dismissible,messageOverrides:{dismissLabel:this.strings.remove}},this.chipLabel)))}validateValues(e){if(!0===(0,a.ad)(e))throw new a.ae("DuplicateValueError","There are duplicate strings in the values array")}selectedChipsChange(){this.validateSelection(),this.analysisChipGroupSelectionChange.emit(),this.updateSelectAllButton()}async componentWillLoad(){Array.isArray(this.value)&&this.validateValues(this.value),({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)(".")))}componentDidLoad(){void 0!==this.initialChipSelection&&(this.selectedChips=this.initialChipSelection,this.isValid=!0)}handleDismiss(e){const t=e.target;this.value=Array.isArray(this.value)?this.value.filter((e=>e!==t.value)):"",this.chipLabel=Array.isArray(this.chipLabel)?this.chipLabel.filter((e=>e!==t.innerText)):"",this.chipRefs=this.chipRefs.filter((e=>e.value!==t.value))}handleChipSelection(e){if("single"===this.selectionMode)this.selectedChips=this.selectedChips.includes(e)?[]:[e];else{if("multi"!==this.selectionMode)throw new a.ae("RequiredPropertyMissing","The selectionMode property is required and must be either 'single' or 'multi'");this.selectedChips=this.selectedChips.includes(e)?this.selectedChips=this.selectedChips.filter((t=>t!==e)):this.selectedChips=[...this.selectedChips,e]}}updateSelectAllButton(){!0===this.selectAllEnabled&&(Array.isArray(this.value)&&this.selectedChips.length===this.value.length||this.selectedChips[0]===this.value?this.canSelectAll=!1:this.canSelectAll=!0)}async checkValidity(){return this.validateSelection(),Promise.resolve(this.isValid)}render(){return!0===(Array.isArray(this.value)&&Array.isArray(this.chipLabel)&&this.value?.length===this.chipLabel?.length)?this.renderChips():this.renderChip()}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{value:["validateValues"],selectedChips:["selectedChipsChange"]}}};m.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{margin-bottom:var(--analysis-half-spacing)}.analysis-chip-button{margin:var(--analysis-quarter-spacing);border-width:2px}.analysis-chip-button:hover{cursor:pointer}.analysis-chip-disabled{margin:var(--analysis-quarter-spacing);background-color:var(--calcite-color-foreground-2);border:none}";const y="half-margin-bot",g="width-100",v="flex-container",f="primary-button",b="secondary-button",C="list-item--border",x=class{constructor(e){(0,s.r)(this,e),this.analysisDataFileInputChange=(0,s.c)(this,"analysisDataFileInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.hideUpload=!1,this.browseOption="item",this.mapLayers=[],this.hideHelp=!1,this.doCalciteInputChangeOnCommit=!1,this.itemSelected=!1,this.urlSelected=!1,this.fileUploading=!1,this.renderInitial=()=>{const e=!(0,a.d)(this.value)&&"portalItemID"in this.value?{itemId:this.value.portalItemID}:void 0,t=this.accept?.map((e=>`.${e}`)).join(","),i=this.portal?.user??void 0;return(0,s.h)(s.F,null,(0,s.h)("div",{class:v},"item"===this.browseOption?(0,s.h)("analysis-item-input",{class:f,hidden:this.urlSelected||void 0!==this.selectedFile,q:'((typekeywords:"Document" OR type:"Image" OR type:"Layout" OR type:"Desktop Style" OR type:"Project Template" OR type:"Report Template" OR type:"Pro Report" OR type:"Statistical Data Collection" OR type:"360 VR Experience" OR type:"netCDF" OR type:"PDF" OR type:"CSV" OR type:"Administrative Report" OR type:"Raster function template") -type:("Image Service" OR "Explorer Document" OR "Explorer Map" OR "Globe Document" OR "Scene Document"))',label:"",replaceTooltipText:this.strings.replaceData,selectButtonLabel:this.strings.addData,selectedItemIcon:"file",value:e,onAnalysisItemInputChange:this.handleAnalysisItemInputChange,portal:this.portal,user:i}):(0,s.h)("analysis-layer-input",{class:f,hidden:this.urlSelected||void 0!==this.selectedFile,label:"",layerFilterType:"imagery",mapLayers:this.mapLayers,mapView:this.mapView,selectedLayers:this.selectedRasterDataLayer,selectedLayerIcon:"image-layer",user:i,value:this.value,popoverWidth:this.popoverWidth,onAnalysisLayerInputChange:this.handleAnalysisLayerInputChange}),!1===this.hideUpload&&(0,s.h)("calcite-button",{"data-tooltip-id":"upload",class:`${b} ${y}`,hidden:this.itemSelected||this.urlSelected||void 0!==this.selectedFile||void 0!==this.selectedRasterDataLayer,appearance:"outline","icon-start":"upload-to",kind:"neutral",scale:a.c.Scale,label:this.strings.file,onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip,onClick:e=>{this.hiddenFileInput?.click(),e.preventDefault()}}),(0,s.h)("calcite-button",{"data-tooltip-id":"url",class:`${b} ${y}`,hidden:this.itemSelected||this.urlSelected||void 0!==this.selectedFile||void 0!==this.selectedRasterDataLayer,appearance:"outline","icon-start":"link",kind:"neutral",scale:a.c.Scale,label:this.strings.url,onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip,onClick:this.handleUrlClick}),this.urlSelected&&this.renderUrlInput(),void 0!==this.selectedFile&&this.renderFileSelected(),(0,s.h)("input",{accept:t,hidden:!0,type:"file",onInput:this.handleFileInputChange,ref:e=>this.hiddenFileInput=e})),this.renderInputMessage())},this.renderUrlInput=()=>{const e=this.doCalciteInputChangeOnCommit?{onCalciteInputTextChange:this.handleUrlInputChange}:{onCalciteInputTextInput:this.handleUrlInputChange};return(0,s.h)("calcite-input-text",{class:g,value:this.value?.url,scale:a.c.Scale,...e},(0,s.h)("calcite-action",{slot:"action",icon:"x",scale:a.c.Scale,text:this.strings.clear,onClick:this.resetToInitial}))},this.renderFileSelected=()=>{const e=this.selectedFile?.itemName;return(0,s.h)("calcite-list",{class:g,label:"",loading:this.fileUploading},(0,s.h)("calcite-list-item",{"data-tooltip-id":"replace",class:C,label:e,onCalciteListItemSelect:e=>{this.hiddenFileInput?.click(),e.preventDefault()},onMouseOver:this.addTooltip,onMouseOut:this.removeTooltip},(0,s.h)("calcite-icon",{icon:"file",slot:"content-start"}),(0,s.h)("calcite-action",{text:this.strings.clear,slot:"actions-end",label:this.strings.clear,appearance:"transparent",icon:"x",onClick:this.resetToInitial,onMouseOver:this.removeTooltip})))},this.renderInputMessage=()=>void 0!==this.errorMessage&&(0,s.h)("calcite-input-message",{status:a.Z.INVALID,scale:a.c.Scale,icon:"exclamationMarkTriangle"},this.errorMessage),this.handleAnalysisItemInputChange=e=>{const t=e.target.selectedItem;void 0!==t?(this.value={portalItemID:t.id},this.itemSelected=!0,this.validate(),this.analysisDataFileInputChange.emit()):this.resetToInitial()},this.handleAnalysisLayerInputChange=e=>{const{selectedLayers:t,value:i}=e.target;void 0!==t?(this.selectedRasterDataLayer=t,this.value={url:i.url,inputType:"layer"},this.validate(),this.analysisDataFileInputChange.emit()):this.resetToInitial()},this.handleFileInputChange=async()=>{if(0!==this.hiddenFileInput?.files?.length&&(this.selectedFile={itemName:this.hiddenFileInput?.files?.[0].name??""},void 0!==this.abortController&&this.abortController.abort(),void 0!==this.serviceUrl)){this.errorMessage=void 0,this.fileUploading=!0;try{this.abortController=new AbortController;const e=new FormData;e.append("file",this.hiddenFileInput?.files?.[0]),e.append("f","json");const t=this.apiUrls.upload,i=await(0,a.af)(t,{body:e,method:"post",responseType:"json",signal:this.abortController.signal});this.selectedFile=i.data.item,this.value={itemID:i.data.item.itemID,inputType:"file"},this.fileUploading=!1,this.validate(),this.analysisDataFileInputChange.emit()}catch(e){console.error(e),this.errorMessage=this.strings.uploadFailureMsg,this.selectedFile=void 0,this.fileUploading=!1}}},this.handleUrlClick=()=>{this.urlSelected=!0},this.handleUrlInputChange=e=>{const t=e.target.value;this.value={url:t,inputType:"text"},this.validate(),this.analysisDataFileInputChange.emit()},this.resetToInitial=()=>{this.value=void 0,this.selectedFile=void 0,this.selectedRasterDataLayer=void 0,this.urlSelected=!1,this.itemSelected=!1,this.validate(),this.analysisDataFileInputChange.emit()},this.addTooltip=e=>{const t=e.target,i=t?.getAttribute("data-tooltip-id");switch(void 0===this.tooltipElement&&(this.tooltipElement=document.createElement("calcite-tooltip"),this.tooltipElement.placement="bottom"),i){case"upload":this.tooltipElement.innerText=this.strings.uploadData,this.tooltipElement.offsetDistance=14;break;case"url":this.tooltipElement.innerText=this.strings.AddDataFromUrl,this.tooltipElement.offsetDistance=14;break;case"replace":this.tooltipElement.innerText=this.strings.replaceData;break;default:return void(this.tooltipElement=void 0)}this.tooltipElement.referenceElement=t,(0,l.b)(document,this.tooltipElement)},this.removeTooltip=()=>{(0,l.r)(this.tooltipElement)},this.validate=()=>{let e;void 0===this.value||"url"in this.value&&""===this.value.url?e=!0===this.required&&(0,a.d)(this.value)?this.strings.required:void 0:"url"in this.value&&void 0===this.selectedRasterDataLayer&&(e=(0,l.i)(this.value.url)&&(0,l.d)(this.value.url,this.accept)?void 0:e??this.strings.invalidUrl),this.errorMessage=e}}get apiUrls(){return{delete:`${this.serviceUrl}/uploads/deleteItems`,upload:`${this.serviceUrl}/uploads/upload`}}async onValueChange(e){if(!(0,a.d)(e))if("url"in e){const t=(0,a.ag)(e.url);"layer"===e.inputType?this.selectedRasterDataLayer?.url!==t&&(this.selectedRasterDataLayer=await(0,a.ah)({url:t},this.mapLayers),void 0===this.selectedRasterDataLayer&&(this.errorMessage=this.strings.layerNotFound)):this.urlSelected=!0}else if("itemID"in e&&e.itemID!==this.selectedFile?.itemID)try{void 0!==this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const t=await(0,a.af)(`${this.serviceUrl}/uploads/${e.itemID}?f=json`,{signal:this.abortController.signal});this.selectedFile=t.data}catch(e){console.error(e),this.errorMessage=this.strings.fileNotFound}else"portalItemID"in e&&(this.itemSelected=!0)}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.onValueChange(this.value)}componentDidRender(){this.popoverWidth=this.hostElement.offsetWidth}disconnectedCallback(){this.abortController?.abort()}async checkValidity(){return this.validate(),Promise.resolve(void 0===this.errorMessage)}render(){return(0,s.h)(s.H,{key:"ef6fb064d62f6b29a830b699053fc544c1db8a2b"},!1===(0,a.d)(this.label)&&(0,s.h)("analysis-label",{key:"8620f29fc32e02144132e44c7dab94f1eb710bad",label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}),this.renderInitial())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{value:["onValueChange"]}}};x.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{width:100%}.half-margin-bot{margin-bottom:var(--analysis-half-spacing)}.width-100{width:100%}.primary-button{flex-grow:1;--layer-selected-margin-bottom:0}.secondary-button{flex-grow:0;height:1rem}.flex-container{display:flex;gap:0.33rem}.list-item--border{border:1px solid var(--calcite-color-border-input);box-shadow:none;--calcite-font-size--1:var(--calcite-font-size--2)}";const w="controls-container",I="control",L=class{constructor(e){(0,s.r)(this,e),this.analysisDateInputChange=(0,s.c)(this,"analysisDateInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.defaultToNow=!1,this.readOnly=!1,this.isValid=!0,this.hideHelp=!1,this.errorMessage="",this.validateSelection=()=>{void 0!==this.value&&0!==this.dateInputElement.value?.length&&void 0!==this.timeInputElement?.value||!0!==this.required?this.isValid=!0:(this.errorMessage=this.validationParams?.requiredMessage??(0,a.t)(this.strings.requiredError,{label:this.label}),this.isValid=!1)},this.handleDateChange=()=>{if(void 0!==this.dateInputElement?.valueAsDate){const e=this.dateInputElement.valueAsDate,t=!1===(0,a.d)(this.timeInputElement?.value)?this.timeInputElement.value.split(":").map((e=>Number(e))):[0,0];this.value=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),t[0],t[1])}else this.value=void 0;this.analysisDateInputChange.emit()},this.handleTimeChange=()=>{const e=!1===(0,a.d)(this.timeInputElement?.value)?this.timeInputElement.value.split(":").map((e=>Number(e))):void 0;if(void 0!==this.value&&void 0!==e){const t=this.dateInputElement.valueAsDate;this.value=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),e[0],e[1])}this.analysisDateInputChange.emit()}}async checkValidity(){return this.validateSelection(),Promise.resolve(this.isValid)}async componentWillLoad(){if(({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)("."))),!0===this.defaultToNow){const e=6e4*(new Date).getTimezoneOffset();this.value=new Date(Date.now()).setSeconds(0,0)-e,this.analysisDateInputChange.emit()}}render(){let e,t;if(void 0!==this.value&&null!==this.value)try{const i=new Date(this.value);e=i.toISOString(),t=`${i.getUTCHours()}:${i.getUTCMinutes()}`}catch{}return(0,s.h)(s.H,{key:"a67c93334af4fb5a0f4c198c5b085dceb105ade8"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}):null,(0,s.h)("div",{key:"7d4b646cb2d955f7b5d0c34a99d6db49606f50ff",class:w},(0,s.h)("calcite-input-date-picker",{key:"4aeca8696c14af2cd5df2d79a4b4fa1ed1172079",scale:a.c.Scale,class:I,value:e,placement:"bottom",minAsDate:void 0!==this.minDate?new Date(this.minDate):void 0,maxAsDate:void 0!==this.maxDate?new Date(this.maxDate):void 0,onFocusout:this.validateSelection,onCalciteInputDatePickerChange:this.handleDateChange,ref:e=>{this.dateInputElement=e},readOnly:this.readOnly}),(0,s.h)("calcite-input-time-picker",{key:"6215ae0f0a82d6bc5812949c9688a91235288596",placement:"bottom",scale:a.c.Scale,value:t,class:I,onCalciteInputTimePickerChange:this.handleTimeChange,ref:e=>{this.timeInputElement=e},readOnly:this.readOnly})),!1===this.readOnly&&(0,s.h)("calcite-input-message",{key:"34e8eacb745c966f2bf820075a0b07f6eaa34905",status:a.Z.INVALID,scale:a.c.Scale,icon:"exclamationMarkTriangle",hidden:!1!==this.isValid},this.errorMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}};L.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;margin-bottom:var(--analysis-half-spacing);--calcite-color-border-input:var(--analysis-ui-border-input)}.controls-container{display:flex;column-gap:5%}.control{flex:1 1 auto}.text{cursor:default;padding-bottom:var(--analysis-quarter-spacing);margin-block-start:0;margin-block-end:0}";const k="analysis-popover",E=class{constructor(e){(0,s.r)(this,e),this.analysisFieldInputChange=(0,s.c)(this,"analysisFieldInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.pickListFields=[],this.loading=!1,this.fieldPickListOpen=!1,this.required=!1,this.readOnly=!1,this.showFieldInfo=!0,this.usePopupTemplatesInfo=!0,this.useValueLabel=!1,this.storeAsGPValue=!1,this.showSort=!0,this.hideFieldNames=!1,this.useDefaultValue=!1,this.allowGeometryFields=!1,this.hideHelp=!1,this.filterOutGeometryFields=e=>{let t=e;return void 0!==this.mapLayer&&(t=e.filter((e=>!1===[this.mapLayer?.geometryFieldsInfo?.shapeAreaField,this.mapLayer?.geometryFieldsInfo?.shapeLengthField].includes(e.name)))),t},this.getEmptyFieldsMessage=()=>{let e;return this.pickListFields.length>0&&0===this.filteredPickListFields.length?e=this.noFieldsText??this.strings.fieldTypesIncompatible:void 0===this.mapLayer&&void 0===this.analysisDataset?e=this.noLayersText??this.strings.layerNotSelected:this.errorMessage===this.strings.fieldLoadingErrorText&&(e=this.strings.fieldLoadingErrorText),e},this.arcgisFieldPickListDismissed=e=>{if(e.detail){if(!0===this.storeAsGPValue)if(this.isMultiSelect){const t=e.detail.selectedFields;this.value=this.pickListFields.filter((e=>t.includes(e.name))).map((e=>this.convertFieldInstanceToFieldObject(e)))}else{const t=e.detail.selectedFields[0];this.value=this.convertFieldInstanceToFieldObject(this.pickListFields.find((e=>e.name===t)))}else this.value=this.isMultiSelect?e.detail.selectedFields:e.detail.selectedFields[0];this.analysisFieldInputChange.emit()}this.closeFieldPickList()},this.onAnalysisFieldRemoved=e=>{this.isStringArray(this.value)?this.value=this.value.filter((t=>t!==e.detail.value)):this.isGPFieldArray(this.value)?this.value=this.value.filter((t=>t.name!==e.detail.value)):this.value=void 0,this.validate(),this.analysisFieldInputChange.emit()},this.openFieldPickList=()=>{this.fieldPickListOpen=!0},this.closeFieldPickList=()=>{this.fieldPickListOpen=!1,this.validate()},this.validate=()=>{let e;this.required&&(e=!0===(0,a.d)(this.value)?(0,a.t)(this.strings.requiredErrorMessage,{label:this.label??this.strings.requiredErrorLabelDefault}):e),this.errorMessage=e}}onReadOnlyChange(){this.readOnly??(this.readOnly=!1)}syncSelectedFieldsWithPickListFields(){this.syncSelectedFieldsWithValue(),this.analysisFieldInputChange.emit()}isString(e){return"string"==typeof e}isGPField(e){return!Array.isArray(e)&&"object"==typeof e&&"name"in e}isStringArray(e){return Array.isArray(e)&&e.every((e=>"string"==typeof e))}isGPFieldArray(e){return Array.isArray(e)&&e.every(this.isGPField)}syncSelectedFieldsWithValue(){const e=this.value;if((0,a.d)(e))this.selectedFields=void 0;else if(!0===this.storeAsGPValue)if(!0===this.isMultiSelect){const t=new Set(e.map((e=>e.name)));this.selectedFields=this.pickListFields.filter((e=>t.has(e.name)))}else this.selectedFields=this.pickListFields.find((t=>t.name===e.name));else if(!0===this.isMultiSelect){const t=new Set(e);this.selectedFields=this.pickListFields.filter((e=>t.has(e.name)))}else this.selectedFields=this.pickListFields.find((t=>t.name===e))}disableFieldsFromPickList(){this.notAllowedFieldsSet=new Set(this.notAllowedFields),void 0!==this.value&&this.notAllowedFieldsSet.size&&(this.isStringArray(this.value)?this.value.forEach((e=>this.notAllowedFieldsSet.delete(e))):this.isGPFieldArray(this.value)?this.value.forEach((e=>this.notAllowedFieldsSet.delete(e.name))):this.isString(this.value)?this.notAllowedFieldsSet.delete(this.value):this.notAllowedFieldsSet.delete(this.value.name))}async updatePickListFieldsFromLayer(){await this.loadPickListFieldsFromLayer(),this.maybeResetValue()}async updatePickListFieldsFromDataset(){await this.loadPickListFieldsFromDataset(),this.maybeResetValue()}get filteredPickListFields(){const e=new Set(this.fieldTypes),t=!1===this.allowGeometryFields?this.filterOutGeometryFields(this.pickListFields):this.pickListFields;return 0===e.size?t:t.filter((t=>e.has(t.type)&&!this.notAllowedFieldsSet?.has(t.name)))}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.G)(this.hostElement,(0,s.g)("."))),void 0!==this.mapLayer?this.loadPickListFieldsFromLayer().then((()=>{this.disableFieldsFromPickList()})):void 0!==this.analysisDataset&&this.loadPickListFieldsFromDataset().then((()=>{void 0!==this.errorMessage&&""!==this.errorMessage||!0===this.abortController?.signal.aborted||this.maybeResetValue(),this.disableFieldsFromPickList()}))}disconnectedCallback(){this.abortController?.abort()}async checkValidity(){this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}maybeResetValue(){const e=this.filteredPickListFields??[],t=new Set(e.map((e=>e.name)));this.errorMessage=void 0;let i=!0;if(this.isMultiSelect&&Array.isArray(this.value)){let e;e=this.isStringArray(this.value)?this.value.filter((e=>t.has(e))):this.value.filter((e=>t.has(e.name))),0!==e.length&&(this.value=e,this.validate(),this.analysisFieldInputChange.emit(),i=!1)}else i=this.isString(this.value)?!t.has(this.value):!t.has(this.value?.name);!0===i&&!1===this.readOnly&&(this.useDefaultValue&&e.length>0?(!1===this.storeAsGPValue?this.value=this.isMultiSelect?[e[0].name]:e[0].name:this.value=this.isMultiSelect?[e[0]]:e[0],this.validate(),this.analysisFieldInputChange.emit()):void 0!==this.value&&(this.value=void 0,this.validate(),this.analysisFieldInputChange.emit()))}get isMultiSelect(){return"multi"===this.selectionMode}convertFieldInstanceToFieldObject(e){return void 0!==e&&"toJSON"in e&&"function"==typeof e.toJSON?e.toJSON():e}async loadPickListFieldsFromDataset(){if(void 0!==this.abortController&&this.abortController.abort(),void 0!==this.analysisDataset){this.loading=!0;try{this.abortController=new AbortController,this.pickListFields=await this.analysisDataset.getFields({signal:this.abortController.signal})}catch(e){!1===(0,a.ai)(e)&&(this.errorMessage=this.strings.fieldLoadingErrorText)}this.loading=!1}else this.pickListFields=[]}async loadPickListFieldsFromLayer(){if(void 0!==this.mapLayer)try{this.pickListFields=await(0,a.aa)(this.mapLayer,this.usePopupTemplatesInfo)}catch(e){this.errorMessage=this.strings.fieldLoadingErrorText}else this.pickListFields=[]}render(){return(0,s.h)(s.H,{key:"33797d488f742400856f825a160e23940d504cad"},(0,s.h)("analysis-field-select",{key:"ac39089a31106cf290d776538c1e9760362a79e0",errorMessage:this.errorMessage,value:!0===(0,a.d)(this.value)?void 0:this.value,label:this.label,hideHelp:this.hideHelp,ref:e=>{this.fieldSelectElement=e},validationParams:this.validationParams,fields:this.pickListFields,useValueLabel:this.useValueLabel,selectionMode:this.selectionMode,onAnalysisSelectFieldClick:this.openFieldPickList,onAnalysisFieldRemove:this.onAnalysisFieldRemoved,placeholderText:this.readOnly?void 0:this.placeholderText,required:this.required,readOnly:this.readOnly}),this.fieldPickListOpen&&this.renderFieldPickList())}renderFieldPickList(){const e=this.filteredPickListFields;let t;const i=this.getEmptyFieldsMessage();let a,l,n;this.loading?t=(0,s.h)("calcite-loader",{label:this.strings.loadingFields,type:"indeterminate",slot:"no-fields"}):void 0!==i&&(t=(0,s.h)("p",{slot:"no-fields",style:{margin:"var(--analysis-half-spacing)"}},i)),this.isMultiSelect||(a=this.strings.selectFieldPicklistHeading,l=this.strings.selectOkBtnText),a=this.heading??a,n=void 0!==this.value?this.isMultiSelect?!0===this.storeAsGPValue?this.value.map((e=>e.name)):this.value:[!0===this.storeAsGPValue?this.value.name:this.value]:[];const r=void 0!==this.analysisDataset||!0===this.mapLayer?.variableJson?.isDerived;return(0,s.h)("arcgis-tunnel",{reference:this.hostElement},(0,s.h)("arcgis-field-pick-list",{dir:this.dir,class:k,layer:this.mapLayer,mapView:this.mapView,fields:this.loading?[]:e,selectedFields:n,multiple:this.isMultiSelect,showDescription:!0,showFieldName:!this.hideFieldNames,showSort:this.showSort,showSelectionAll:e.length>0,showFieldInfo:!r&&this.showFieldInfo,heading:a,okBtnText:l,filterPlaceholderText:this.readOnly?void 0:this.filterPlaceholderText,filterNoResultsText:this.strings.noSearchResults,onArcgisFieldPickListDismissed:this.arcgisFieldPickListDismissed,popoverProps:{refElement:this.fieldSelectElement,autoClose:!0,popoverWidth:300,overlayPositioning:"fixed"}},t))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{readOnly:["onReadOnlyChange"],pickListFields:["syncSelectedFieldsWithPickListFields"],value:["syncSelectedFieldsWithValue"],notAllowedFields:["disableFieldsFromPickList"],mapLayer:["updatePickListFieldsFromLayer"],usePopupTemplatesInfo:["updatePickListFieldsFromLayer"],analysisDataset:["updatePickListFieldsFromDataset"]}}};E.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;width:var(--analysis-component-default-width);margin-bottom:var(--analysis-half-spacing)}.list-item{--calcite-font-size--1:var(--calcite-font-size--2)}";const S="field-multi-select-btn-spaced",M="multi-select-container",T="border",F="border-list-items",D="border-single-list-item",V=class{constructor(e){(0,s.r)(this,e),this.analysisSelectFieldClick=(0,s.c)(this,"analysisSelectFieldClick",7),this.analysisFieldRemove=(0,s.c)(this,"analysisFieldRemove",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.disabled=!1,this.useValueLabel=!1,this.required=!1,this.readOnly=!1,this.hideHelp=!1,this.renderMessages=()=>{const e=!1===(0,a.d)(this.errorMessage),t=(0,a.z)((0,a.B)(this.strings,this.validationParams));return(0,s.h)("calcite-input-message",{icon:"exclamationMarkTriangle",status:e?a.Z.INVALID:(0,a.D)(this.validationParams?.type),scale:a.c.Scale,hidden:!e&&!0===(0,a.d)(t)},e?this.errorMessage:t)},this.handleReplaceFieldClick=e=>{const t=e.target;"calcite-list-item"!==t?.localName||e.composedPath().find((e=>"calcite-action"===e.localName))||this.analysisSelectFieldClick.emit()},this.handleMouseOver=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(void 0===this.replaceTooltip&&(this.replaceTooltip=document.createElement("calcite-tooltip"),this.replaceTooltip.placement="bottom",this.replaceTooltip.innerText=this.strings.replaceField),this.replaceTooltip.referenceElement=t,(0,l.b)(document,this.replaceTooltip))},this.handleMouseOut=()=>{(0,l.r)(this.replaceTooltip)},this.onSelectClick=()=>{this.analysisSelectFieldClick.emit()},this.onFieldRemoved=e=>{(0,l.r)(this.replaceTooltip),this.analysisFieldRemove.emit({value:e})}}get fieldLabels(){let e=[];if(!0===this.useValueLabel&&void 0!==this.value){e=(Array.isArray(this.value)?this.value:[this.value]).map((e=>[e,e]))}else!1===this.useValueLabel&&void 0!==this.fields&&(e=this.fields.map((e=>[e.name,e.alias])));return new Map(e)}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)(".")))}render(){return(0,s.h)(s.H,{key:"5db97d6813f4b925a961617356c9e211d6090ddd"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}):null,void 0===this.selectionMode||"single"===this.selectionMode?void 0===this.value?this.renderSingleSelectButton():this.renderSingleListItem():this.renderMultiple(),this.renderMessages())}renderSingleListItem(){const e="string"==typeof this.value?this.value:this.value?.name,t=this.fieldLabels.get(e)??e;return(0,s.h)("calcite-list",{interactionMode:!0===this.readOnly?"static":void 0,label:""},(0,s.h)("calcite-list-item",{"data-layerId":e,class:D,key:e?.toString(),value:e,label:t,unavailable:!0===this.readOnly,onMouseOver:!1===this.readOnly?this.handleMouseOver:void 0,onMouseOut:!1===this.readOnly?this.handleMouseOut:void 0,onClick:!1===this.readOnly?this.handleReplaceFieldClick:void 0,messageOverrides:{close:this.strings.removeField}},!1===this.readOnly&&(0,s.h)("calcite-action",{text:this.strings.removeField,slot:"actions-end",label:this.strings.removeField,appearance:"transparent",icon:"x",onClick:()=>this.onFieldRemoved(e)})))}renderSingleSelectButton(){const e="string"==typeof this.value?this.value:this.value?.name,t=void 0!==e?this.fieldLabels.get(e):this.placeholderText??this.strings.inputPlaceholderText;return(0,s.h)("calcite-button",{scale:a.c.Scale,width:"full",alignment:"space-between",appearance:"outline",kind:"neutral","icon-end":"chevron-down",onClick:this.onSelectClick,disabled:this.readOnly},this.readOnly?(0,s.h)("span",null,"\xa0"):t)}renderMultiple(){const e=void 0!==this.value&&Array.isArray(this.value)&&this.value.length>0?S:void 0,t=this.fieldLabels,i=e=>(0,s.h)("calcite-list-item",{key:e,class:F,label:t.get(e)??e,value:e,onClick:this.handleReplaceFieldClick},!1===this.readOnly&&(0,s.h)("calcite-action",{text:this.strings.removeField,slot:"actions-end",label:this.strings.removeField,appearance:"transparent",icon:"x",onClick:()=>this.onFieldRemoved(e)}));let l;return l="string"==typeof this.value?.[0]?this.value.map(i):this.value?.map((e=>i(e.name))),(0,s.h)("div",{class:M},void 0!==l&&l.length>0&&(0,s.h)("calcite-list",{class:T,label:"",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,disabled:this.readOnly},l),(0,s.h)("calcite-button",{iconStart:"plus",appearance:"outline",kind:"neutral",width:"full",onClick:this.onSelectClick,class:e,scale:a.c.Scale,disabled:this.readOnly},this.placeholderText??this.strings.multiSelectFieldButtonText))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}};V.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{width:var(--analysis-component-default-width);font-size:var(--analysis-label-font-size)}.error-message{margin-top:var(--analysis-quarter-spacing)}.field-multi-select-btn-spaced{margin-top:var(--analysis-half-spacing)}.border{border:1px solid var(--analysis-ui-border-input)}.multi-select-container{display:flex;flex-direction:column;gap:var(--analysis-quarter-spacing);width:100%;margin-bottom:var(--analysis-half-spacing)}.text-s{margin-block-start:0;margin-block-end:0;color:var(--calcite-color-text-1);font-size:var(--calcite-font-size--2);line-height:1rem}.text-m{margin-block-start:0;margin-block-end:0;color:var(--calcite-color-text-1);font-size:var(--calcite-font-size--1);line-height:1rem}.border-list-items{--calcite-font-size--1:var(--calcite-font-size--2);border-bottom:none;border-top:none}.border-single-list-item{border:1px solid var(--analysis-ui-border-input);--calcite-font-size--1:var(--calcite-font-size--2)}";const A={addVariableButton:"add-variable-button",borderListItems:"border-list-items",border:"border"},P=class{constructor(e){(0,s.r)(this,e),this.analysisGeoenrichmentInputChange=(0,s.c)(this,"analysisGeoenrichmentInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.doValidate=!1,this.readOnly=!1,this.required=!1,this.renderAddVariable=()=>{const e=(this.value?.analysisVariables?.length??0)>0?A.addVariableButton:void 0;return(0,s.h)("calcite-button",{disabled:this.readOnly,width:"full",appearance:"outline",kind:"neutral","icon-start":"plus",scale:a.c.Scale,onClick:this.openDataBrowser,class:e},this.strings.addVariableLabel)},this.renderSelectedVariables=()=>{const e=this.value?.analysisVariables?.map(((e,t)=>(0,s.h)("calcite-list-item",{disabled:this.readOnly,key:e,label:this.value?.labels?.[t]??e,value:e,class:A.borderListItems,closable:!1===this.readOnly,onCalciteListItemClose:this.onListItemRemove})));return(0,s.h)("calcite-list",{label:"",class:A.border},e)},this.onListItemRemove=e=>{const t=e.target,i=t?.value;if(void 0!==this.value){let{analysisVariables:e,labels:s}=this.value;e=e?.filter((e=>e!==i)),s=s?.filter((e=>e!==t?.label)),this.doValidate=!0,this.value=0===e?.length?void 0:Object.assign({},this.value,{analysisVariables:e,labels:s})}this.analysisGeoenrichmentInputChange.emit()},this.openDataBrowser=()=>{this.dataBrowserElement=document.createElement("analysis-geoenrichment-databrowser"),this.dataBrowserElement.addEventListener("analysisDataBrowserSelectionChange",this.onSelectedVariables),this.dataBrowserElement.addEventListener("analysisDataBrowserClose",this.closeModal),document.body.appendChild(this.dataBrowserElement),this.dataBrowserElement.analysisVariables=this.value?.analysisVariables?.join()??"",this.dataBrowserElement.portal=this.portal,this.dataBrowserElement.countryId=this.countryId,this.dataBrowserElement.hierarchyId=this.hierarchyId},this.closeModal=()=>{void 0!==this.dataBrowserElement&&(this.dataBrowserElement.removeEventListener("analysisDataBrowserSelectionChange",this.onSelectedVariables),this.dataBrowserElement.removeEventListener("analysisDataBrowserClose",this.closeModal),this.dataBrowserElement.remove(),this.dataBrowserElement=void 0)},this.onSelectedVariables=e=>{const{selectedValues:t,countryId:i,hierarchyId:s,countryAlias:a,hierarchyAlias:l}=e.detail;this.countryId=i,this.hierarchyId=s;const[n,r]=t.reduce(((e,t)=>{const[i,s]=e;return i.push(t.value),s.push(t.label),[i,s]}),[[],[]]);this.doValidate=!0,this.value={country:this.countryId,hierarchy:this.hierarchyId,countryAlias:a,hierarchyAlias:l,analysisVariables:n,labels:r},this.analysisGeoenrichmentInputChange.emit(),this.closeModal()},this.validate=()=>{let e;return this.required&&!0===(0,a.d)(this.value?.analysisVariables)?(e=!1,this.error=this.strings.requiredInputMessage):(e=!0,this.error=void 0),e}}valueChange(e){this.countryId=e?.country??void 0,this.hierarchyId=e?.hierarchy??void 0,!0===this.doValidate&&this.validate()}get hasError(){return void 0!==this.error}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)(".")));(this.value?.analysisVariables?.length??0)>0&&(this.doValidate=!0),void 0!==this.value&&this.valueChange(this.value)}disconnectedCallback(){this.closeModal()}async checkValidity(){const e=this.validate();return Promise.resolve(e)}render(){const e=(this.value?.analysisVariables?.length??0)>0?this.renderSelectedVariables():null;return(0,s.h)(s.H,{key:"a290d6dae3b7bc1804b7a9a19df4a04ba08b2a8c"},!1===(0,a.d)(this.label)?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,e,this.renderAddVariable(),(0,s.h)("calcite-input-message",{key:"a2b48ed38ed04e66ec807a85063ce2bf0bfdb8b5",status:"invalid",scale:a.c.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.error))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{value:["valueChange"]}}};P.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.add-variables-button{margin-top:var(--analysis-half-spacing)}.border-list-items{--calcite-font-size--1:var(--calcite-font-size--2);border-bottom:none;border-top:none}.border{border:1px solid var(--analysis-ui-border-input);margin-bottom:var(--analysis-half-spacing)}";const O="analysis--rtl",R=class{constructor(e){(0,s.r)(this,e),this.analysisDataBrowserSelectionChange=(0,s.c)(this,"analysisDataBrowserSelectionChange",7),this.analysisDataBrowserClose=(0,s.c)(this,"analysisDataBrowserClose",7),this.analysisVariables="",this.onSelectButtonClick=()=>{const e=this.dataBrowserElement?.getSelectedVariables();this.analysisDataBrowserSelectionChange.emit(e)},this.resizeDataBrowser=()=>{const e=this.getWindowSize();this.dataBrowserElement.dataBrowser.domNode.style.width=.75*e.w+"px",this.dataBrowserElement.dataBrowser.domNode.style.height=.75*e.h+"px",this.dataBrowserElement.dataBrowser.domNode.style.maxWidth="100%",this.dataBrowserElement.dataBrowser.domNode.style.maxHeight="100%"},this.getWindowSize=()=>({w:window.innerWidth,h:window.innerHeight}),this.close=()=>{void 0!==this.containerRef&&(this.containerRef.open=!1),this.analysisDataBrowserClose.emit()}}portalChange(e){this.geoenrichmentUrl=e?.helperServices?.geoenrichment?.url??"https://geoenrichdev.arcgis.com/arcgis/rest/services/World/GeoenrichmentServer"}async componentWillLoad(){({strings:this.strings,locale:this.locale,dir:this.dir}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.portalChange(this.portal)}componentDidLoad(){try{setTimeout((()=>requestAnimationFrame((()=>this.containerRef?.setFocus()))),1)}catch{}}renderDialog(){return(0,s.h)("calcite-dialog",{open:!0,modal:!0,heading:this.strings.header,width:"l",onCalciteDialogClose:this.close,ref:e=>this.containerRef=e},this.renderDataBrowser(),(0,s.h)("calcite-button",{slot:"footer-end",appearance:"outline",onClick:this.close},this.strings.cancel),(0,s.h)("calcite-button",{slot:"footer-end",onClick:this.onSelectButtonClick},this.strings.select))}renderDataBrowser(){return(0,s.h)("arcgis-geoenrichment-databrowser",{customTitle:" ",locale:this.locale,class:{[O]:"rtl"===this.dir},countryId:this.countryId??"_",hierarchyId:this.hierarchyId??"esri2025",geoenrichmentURL:this.geoenrichmentUrl,analysisVariables:this.analysisVariables,onArcgisDBOnLoadCompleted:this.resizeDataBrowser,hideApplyButton:!0,hideCancelButton:!0,ref:e=>{this.dataBrowserElement=e}})}render(){return this.renderDialog()}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{portal:["portalChange"]}}},q="Deep Learning Package",_="cloudStore_amazon",N="cloudStore_azure",B="bigquery",H="snowflake",z="databricks",U="analysis-item-input",G={buttonContainer:`${U}__buttons-container`,listItem:`${U}__list-item`,loaderContainer:`${U}__loader-container`,loader:`${U}__loader`},$=class{constructor(e){(0,s.r)(this,e),this.analysisItemInputChange=(0,s.c)(this,"analysisItemInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.isProcessingItem=!1,this.deepLearningParameters={},this.required=!1,this.itemTypes=[],this.hideFilters=!0,this.hidePreview=!1,this.renderInitialMode=()=>{let e;if(void 0!==this.newItemMode){const t=this.getNewItemButtonProps(this.newItemMode);e=(0,s.h)("calcite-button",{appearance:"outline",scale:a.c.Scale,kind:"neutral","icon-start":t.icon,onClick:this.openAddItem},t.label)}return(0,s.h)("div",{class:G.buttonContainer},e,(0,s.h)("calcite-button",{appearance:"outline",kind:"neutral",scale:a.c.Scale,"icon-start":"select",onClick:this.openItemBrowser},this.selectButtonLabel??this.strings.selectItem))},this.clearSelectedItem=()=>{this.value=void 0},this.openItemBrowser=()=>{this.itemBrowserElement=document.createElement("analysis-item-browser"),this.itemBrowserElement.header=this.strings.selectItem,this.itemBrowserElement.filter=this.filterExpression,this.itemBrowserElement.q=this.q,this.itemBrowserElement.portal=this.portal,this.itemBrowserElement.user=this.user,this.itemBrowserElement.bucketOptions=this.bucketOptions,this.itemBrowserElement.hidePreview=this.hidePreview,this.itemBrowserElement.hideFilters=this.hideFilters,this.itemBrowserElement.hideAddToMap=!0,this.itemBrowserElement.selectionMode="single",this.itemBrowserElement.cardMessageOverrides={preview:this.strings.previewDetails},this.itemBrowserElement.addEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.addEventListener("analysisItemBrowserSelection",this.onSelectedBrowserItem),document.body.appendChild(this.itemBrowserElement)},this.onSelectedBrowserItem=e=>{null!==e.detail&&(this.value={itemId:e.detail.id})},this.openAddItem=()=>{if(void 0!==this.newItemMode&&void 0!==this.newItemConfig){if(this.newItemElement=document.createElement("arcgis-new-item"),this.newItemElement.allowPublish=!1,this.newItemElement.allowedItemTypes=this.itemTypes,this.newItemElement.allowedModes=[this.newItemMode],this.newItemElement.api=4,this.newItemElement.config=this.newItemConfig,this.newItemElement.portal=this.portal,this.newItemElement.user=this.user,"serviceConnection"===this.newItemMode)this.newItemElement.firstStep="serviceConnection";else if("dataStore"===this.newItemMode){const e=[[_,"dataStoreSelectCloudCredentialsAmazonS3"],[N,"dataStoreSelectCloudCredentialsAzureBlob"],[H,"dataStoreDatabaseCredentialsSnowflake"],[B,"dataStoreDatabaseCredentialsBigQuery"],[z,"dataStoreDatabaseCredentialsDatabricks"]];for(const[t,i]of e)if(`typekeywords:${t}`===this.itemFilter){this.newItemElement.firstStep=i;break}}this.newItemElement.addEventListener("workflowCancel",this.closeModals),this.newItemElement.addEventListener("workflowComplete",this.onAddItemComplete),document.body.appendChild(this.newItemElement)}},this.onAddItemComplete=e=>{void 0!==e.detail.id?this.value={itemId:e.detail.id}:this.value=void 0,void 0!==this.newItemElement&&(this.newItemElement.isActive=!1)},this.closeModals=()=>{void 0!==this.itemBrowserElement&&(this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.remove(),this.itemBrowserElement=void 0),void 0!==this.newItemElement&&(this.newItemElement.removeEventListener("workflowCancel",this.closeModals),this.newItemElement.removeEventListener("workflowComplete",this.onAddItemComplete),this.newItemElement.remove(),this.newItemElement=void 0)},this.getNewItemButtonProps=e=>{if("file"===e)return{icon:"upload-to",label:this.strings.addFile};if("dataStore"===e)return{icon:"plus",label:this.strings.addDataStore};if("serviceConnection"===e)return{icon:"plus",label:this.strings.addServiceConnection};throw new Error("Unsupported new item mode.")},this.validate=()=>{let e;return this.required&&(0,a.d)(this.value)?(e=!1,this.errorMessage=this.strings.requiredInputMessage):(e=!0,this.errorMessage=void 0),e},this.renderLoader=()=>{const e=!0===this.isProcessingItem;return(0,s.h)("div",{class:G.loaderContainer},(0,s.h)("calcite-loader",{class:G.loader,hidden:!e,inline:!0,label:"loader",scale:a.c.Scale,type:"indeterminate"}),e?this.processingItemMessage??this.strings.queryModelArgsMsg:null)},this.onListItemMouseOver=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(void 0===this.replaceTooltip&&(this.replaceTooltip=document.createElement("calcite-tooltip"),this.replaceTooltip.placement="bottom",this.replaceTooltip.innerText=this.replaceTooltipText??this.strings.replaceItem),this.replaceTooltip.referenceElement=t,(0,l.b)(document,this.replaceTooltip))},this.onListItemMouseOut=()=>{(0,l.r)(this.replaceTooltip)},this.onListItemClick=e=>{const t=e.target;"calcite-list-item"===t?.localName&&this.openItemBrowser()}}async hydrateSelectedItem(e){const t=e?.itemId;if(t!==this.selectedItem?.id){if(void 0===t)this.selectedItem=void 0,this.deepLearningParameters=void 0;else{const e=(0,a.aj)(t,this.portal);try{await e.load(),this.selectedItem=e,await this.loadItemProperties()}catch(e){this.value=void 0,"identity-manager:not-authorized"===e.name?this.errorMessage=this.strings.itemPermissionDenied:"request:server"===e.name&&"object"==typeof e.details&&null!==e.details&&"CONT_0001"===e.details.messageCode&&(this.errorMessage=this.strings.itemNotFound)}}this.analysisItemInputChange.emit()}}validateOnValueChange(){this.validate()}get hasError(){return void 0!==this.errorMessage}get filterExpression(){return(0,l.m)(this.itemTypes,this.itemFilter)}get bucketOptions(){let e;if(void 0!==this.sharingLevels){e=[...this.sharingLevels];const t=e.indexOf("org-admin");t>=0&&(e.splice(t,1),"org_admin"!==this.user.role||e.includes("org")||e.push("org"))}return e}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.hydrateSelectedItem(this.value)}disconnectedCallback(){this.closeModals(),(0,l.r)(this.replaceTooltip),void 0!==this.itemBrowserElement&&(this.itemBrowserElement.remove(),this.itemBrowserElement=void 0)}async checkValidity(){const e=this.validate();return Promise.resolve(e)}render(){const e=(0,a.d)(this.value)?this.renderInitialMode():this.renderSelection();return(0,s.h)(s.H,{key:"e90b3efd57f2176116a1b049aa8b61e0cb0483f9"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,e,(0,s.h)("calcite-input-message",{key:"dc3417213f04727a69d6cc382e0cf689dab1fa40",status:"invalid",scale:a.c.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.errorMessage))}renderSelection(){return(0,s.h)("div",null,(0,s.h)("calcite-list",{label:"",selectionMode:"none"},(0,s.h)("calcite-list-item",{key:this.selectedItem?.id??"",value:this.selectedItem?.id,label:this.selectedItem?.title??"",class:G.listItem,onMouseOver:this.onListItemMouseOver,onMouseOut:this.onListItemMouseOut,onClick:this.onListItemClick},void 0!==this.selectedItemIcon&&(0,s.h)("calcite-icon",{icon:this.selectedItemIcon,slot:"content-start"}),void 0!==this.selectedItem&&(0,s.h)("calcite-action",{text:this.strings.viewDetails,label:this.strings.viewDetails,slot:"actions-end",icon:"launch",appearance:"transparent",onClick:()=>{if(void 0===this.selectedItem)return;const e=`${`${(0,a.U)(this.portal)}/home`}/item.html?id=${this.selectedItem.id}`;open(e,"_blank","noopener")}}),(0,s.h)("calcite-action",{text:this.strings.removeItem,slot:"actions-end",label:this.strings.removeItem,appearance:"transparent",icon:"x",onClick:this.clearSelectedItem}))),this.renderLoader())}async loadItemProperties(){if(void 0!==this.abortController&&this.abortController.abort(),this.deepLearningParameters=void 0,this.selectedItem?.type===q)try{this.abortController=new AbortController,this.isProcessingItem=!0,this.deepLearningParameters=await(0,a.ak)(this.selectedItem,this.portal,{signal:this.abortController.signal}),this.isProcessingItem=!1}catch(e){!1===(0,a.ai)(e)&&(this.isProcessingItem=!1,this.errorMessage=this.strings.queryModelArgsErrMsg)}}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{value:["hydrateSelectedItem","validateOnValueChange"]}}};$.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.analysis-item-input__list-item{border:1px solid var(--analysis-ui-border-input);box-shadow:none;--calcite-font-size--1:var(--calcite-font-size--2)}.analysis-item-input__buttons-container{display:flex;flex-direction:row;flex-wrap:wrap;gap:var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.analysis-item-input__buttons-container>calcite-button{flex:1;max-width:100%}.analysis-item-input__label{cursor:pointer;padding-bottom:var(--analysis-half-spacing);margin-block-start:0;margin-block-end:0}.analysis-item-input__loader-container{font-size:var(--calcite-font-size--2)}.analysis-item-input__loader{margin-top:0.5rem}";const W=e=>{let t;return(0,s.h)(s.F,null,void 0!==e.label&&""!==e.label?(0,s.h)("analysis-label",{label:e.label,required:e.required,onAnalysisLabelHelpActionClick:()=>e.analysisHelpClick.emit(),onClick:()=>{t?.focus()},hideHelp:e.hideHelp}):null,(0,s.h)("div",{class:"controls-container"},(0,s.h)("analysis-number-input",{ref:e=>t=e,class:"control",scale:e.scale,label:"",value:e.value?.distance??e.value?.area,required:e.required,placeholderText:e.placeholderText??e.strings.inputPlaceholderText,min:e.minimum,max:e.maximum,excludeMinValue:e.excludeMinValue,excludeMaxValue:e.excludeMaxValue,choiceList:e.amountChoiceList,onAnalysisNumberInputChange:e.amountChange,numberType:"float"}),(0,s.h)("calcite-select",{scale:a.c.Scale,class:"control unit-select",dir:e.dir,label:e.strings.unitSelect,onCalciteSelectChange:e.unitChanged},e.unitChoiceList?.map((t=>(0,s.h)("calcite-option",{value:t,label:void 0!==e.choiceListLabels?e.choiceListLabels[t]:t,selected:e.value?.units===t}))))))},Q=class{constructor(e){(0,s.r)(this,e),this.analysisLinearUnitInputChange=(0,s.c)(this,"analysisLinearUnitInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.required=!1,this.hideHelp=!1,this.isValid=!0,this.distanceChange=e=>{const t=e?.target,i=t?.value,s=this.value?.units;void 0===t||Array.isArray(i)||"multi"===t.selectionMode||(void 0!==i?(this.value={units:s,distance:i},this.onUnitChoiceListChange()):this.value=void 0,this.analysisLinearUnitInputChange.emit())},this.unitChanged=e=>{const t=e?.target;this.value={distance:this.value?.distance,units:t?.value},this.validate(),void 0!==this.value?.distance&&this.analysisLinearUnitInputChange.emit()}}onUnitChoiceListChange(){const e=this.value?.units;void 0===this.unitChoiceList||void 0!==e&&this.unitChoiceList.includes(e)||(this.value={distance:this.value?.distance,units:this.unitChoiceList[0]})}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.onUnitChoiceListChange()}async checkValidity(){return await this.validate(),Promise.resolve(this.isValid)}async validate(){const e=this.hostElement.shadowRoot?.querySelector("analysis-number-input"),t=await(e?.checkValidity())??!1,i=!this.required||void 0!==this.value?.units&&this.unitChoiceList?.includes(this.value?.units);return this.isValid=t&&i,Promise.resolve()}render(){return void 0!==this.value?.units&&(void 0===this.unitChoiceList||this.unitChoiceList.includes(this.value?.units)||(this.unitChoiceList=[...this.value?.units,...this.unitChoiceList])),(0,s.h)(s.H,{key:"eded8ed6c95ecaaaa6c122f6b7b777e466a73d50"},(0,s.h)(W,{key:"e1ebf2fbdbcecf1a46e0f01a8fe54913405364c7",label:this.label,required:this.required,value:this.value,minimum:this.minimum,maximum:this.maximum,excludeMinValue:this.excludeMinValue,excludeMaxValue:this.excludeMaxValue,placeholderText:this.placeholderText,strings:this.strings,dir:this.dir,unitChoiceList:this.unitChoiceList,hideHelp:this.hideHelp??!0,amountChoiceList:this.distanceChoiceList,amountChange:this.distanceChange,unitChanged:this.unitChanged,analysisHelpClick:this.analysisHelpClick,choiceListLabels:this.choiceListLabels,scale:a.c.Scale}))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{unitChoiceList:["onUnitChoiceListChange"]}}};Q.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;--calcite-color-border-input:var(--analysis-ui-border-input)}.controls-container{display:flex;column-gap:5%}.control{flex:1 1 0}.text{cursor:pointer;padding-bottom:var(--analysis-quarter-spacing);margin-block-start:0;margin-block-end:0}.unit-select{margin-bottom:var(--analysis-half-spacing)}";const j=class{constructor(e){(0,s.r)(this,e),this.analysisStringInputChange=(0,s.c)(this,"analysisStringInputChange",7),this.analysisStringInputComboboxBeforeOpen=(0,s.c)(this,"analysisStringInputComboboxBeforeOpen",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.showVariableNodesClick=(0,s.c)(this,"showVariableNodesClick",7),this.clearVariableById=(0,s.c)(this,"clearVariableById",7),this.segmentedItems=[],this.doCalciteInputChangeOnCommit=!1,this.readOnly=!1,this.clearEnabled=!1,this.showAsRadioGroup=!1,this.showAsRadioButtonGroup=!1,this.showAsCheckList=!1,this.showSelectAllForCheckList=!1,this.showAsTextArea=!1,this.useDefaultOnReset=!1,this.allowCustomValues=!1,this.maxItems=10,this.hideHelp=!1,this.supportsVariables=!1,this.isValid=!0,this.layoutUpdating=!1,this.setErrorMessage=e=>{this.isValid=void 0===e,this.errorMessage=e},this.validateSingleInput=e=>{let t;if(!0===this.required&&""===e&&(t=(0,a.t)(this.strings.requiredError,{label:this.label})),e.length<(this.minLength??-1)&&""!==e&&(t=(0,a.t)(this.strings.minLengthError,{label:this.label,minLength:(0,a.al)(this.minLength??-1)})),e.length>(this.maxLength??Number.MAX_SAFE_INTEGER)&&(t=(0,a.t)(this.strings.maxLengthError,{label:this.label,maxLength:(0,a.al)(this.maxLength??Number.MAX_SAFE_INTEGER)})),void 0!==this.invalidCharactersRegex){const i=(0,a.am)(this.invalidCharactersRegex);void 0!==i&&!0===i.test(e)&&(t=(0,a.t)(this.strings.invalidCharacterError,{label:this.label}))}return this.setErrorMessage(t),void 0===t},this.validateInput=()=>{let e;const t=!0===(0,a.M)(this.value)?this.value?.variable:void 0,i=this.modelVariables?.find((e=>e.id===t))?.value??this.value;if(this.required||void 0!==this.maxLength||void 0!==this.invalidCharactersRegex||void 0!==this.minLength)if("multi"!==this.selectionMode){const e=i??"";this.validateSingleInput(e)}else{const t=i??[];if(0===t.length)e=(0,a.t)(this.strings.requiredError,{label:this.label}),this.setErrorMessage(e);else{let i=!0;for(let e=0;e<t.length;e+=1){this.validateSingleInput(t[e]??"")||(i=!1)}this.isValid=i,!1===i&&(e=(0,a.t)(this.strings.choiceListBadInput,{label:this.label}),this.setErrorMessage(e))}}},this.adjustLayout=()=>{const e=this.segmentedControl?.firstChild?.clientWidth;void 0!==e&&(this.layout=e*this.segmentedControl.childElementCount<this.hostElement.clientWidth?"horizontal":"vertical")},this.renderVariableDisplay=e=>{const t=this.modelVariables?.find((t=>t.id===e)),i="string"==typeof t.value?t.value:"";return(0,s.h)("variable-node-display",{variableNode:t,choiceLabel:this.choiceListLabels?.[i],onClearVariable:e=>!0!==this.readOnly&&this.clearVariableById.emit(e.detail),onChangeNode:()=>!0!==this.readOnly&&this.showVariableNodesClick.emit(),readOnly:this.readOnly})},this.renderInput=()=>{const e=this.doCalciteInputChangeOnCommit?{onCalciteInputChange:this.inputChanged}:{onCalciteInputInput:this.inputChanged},t=this.readOnly?void 0:this.placeholderText??this.strings.inputPlaceholderText;return(0,s.h)("calcite-input",{scale:a.c.Scale,type:this.showAsTextArea?"textarea":"text",readOnly:this.readOnly,value:this.value,status:this.isValid?a.Z.VALID:a.Z.INVALID,placeholder:t,...e})},this.renderCombobox=()=>{const e="multi"===this.selectionMode&&void 0===this.choiceList||!0===this.allowCustomValues,t=void 0!==this.errorMessage?a.Z.INVALID:(0,a.D)(this.validationParams?.type),i=[];if(Array.isArray(this.choiceList)&&i.push(...this.choiceList),e&&void 0!==this.initialValues){const e=new Set(i),t="multi"===this.selectionMode?this.initialValues:[this.initialValues];for(const s of t)e.has(s)||i.push(s)}const l=!1===this.readOnly?"multi"===this.selectionMode?this.strings.multiSelectComboboxPlaceholderText:this.strings.comboboxPlaceholderText:void 0,n=this.readOnly?void 0:this.placeholderText??l;return(0,s.h)("calcite-combobox",{scale:a.c.Scale,status:t,label:this.strings.choiceList,disabled:this.readOnly,maxItems:this.maxItems,selectionMode:"multi"!==this.selectionMode?this.required?"single-persist":"single":"multiple",placeholder:n,placeholderIcon:this.placeholderIcon,allowCustomValues:e,onCalciteComboboxBeforeOpen:this.analysisStringInputComboboxBeforeOpen.emit,onCalciteComboboxChange:this.comboboxChanged,clearDisabled:!1===this.clearEnabled&&"multi"!==this.selectionMode},i.map((e=>this.buildComboBoxItem(e))))},this.buildComboBoxItem=e=>{let t,i=!1;return i="multi"!==this.selectionMode?this.value===e:void 0!==this.value&&this.value.includes(e),t=void 0===this.choiceListLabels?e:this.allowCustomValues?this.choiceListLabels[e]??e:this.choiceListLabels[e],(0,s.h)("calcite-combobox-item",{key:e,value:e,textLabel:t,icon:void 0!==this.choiceListIcons?this.choiceListIcons[e]:void 0,selected:i,scale:a.c.Scale})},this.renderRadioGroup=()=>{const e=this.choiceList;return(0,s.h)("calcite-segmented-control",{class:"segmented-control",scale:a.c.Scale,onCalciteSegmentedControlChange:this.segmentedControlChange,ref:e=>this.segmentedControl=e,layout:this.layout,disabled:this.readOnly},e?.map((e=>this.buildRadioGroupItem(e))))},this.buildRadioGroupItem=e=>{const t=void 0!==this.choiceListLabels?this.choiceListLabels[e]:e;return(0,s.h)("calcite-segmented-control-item",{value:e,checked:e===this.value,ref:e=>{null!=e&&(e.focus=Function.prototype,this.segmentedItems.push(e))}},t)},this.renderRadioButtonGroup=()=>{const e=this.choiceList;return(0,s.h)("calcite-radio-button-group",{name:this.label,scale:a.c.Scale,layout:"vertical",onCalciteRadioButtonGroupChange:this.radioButtonGroupChange,disabled:this.readOnly},e?.map((e=>this.buildRadioButton(e))))},this.buildRadioButton=e=>{const t=void 0!==this.choiceListLabels?this.choiceListLabels[e]:e;return(0,s.h)("calcite-label",{layout:"inline",scale:a.c.Scale},(0,s.h)("calcite-radio-button",{value:e,checked:e===this.value,disabled:this.readOnly}),t)},this.renderCheckList=()=>(0,s.h)(s.F,null,this.showSelectAllForCheckList?this.renderCheckBox(!0,this.strings.selectAll):null,this.choiceList?.filter((e=>void 0!==e))?.map((e=>this.renderCheckBox(!1,e)))),this.toggleCheckListSelectAll=e=>{const t=e.target.checked?[...this.choiceList??[]]:[];this.checkListChange(t)},this.toggleCheckBoxSingleSelection=(e,t)=>{let i=e;i=e.includes(t)?i.filter((e=>e!==t)):[...i,t],this.checkListChange(i)},this.renderCheckBox=(e,t)=>{const i=e?this.strings.selectAll:this.choiceListLabels?.[t]??t,l=Array.isArray(this.value)?[...this.value]:[],n=e?l.length===this.choiceList?.length:l.includes(t),r=e&&!n&&l.length>0;return(0,s.h)("calcite-label",{layout:"inline",scale:a.c.Scale},(0,s.h)("calcite-checkbox",{disabled:this.readOnly,scale:a.c.Scale,value:i,checked:n,indeterminate:r,onCalciteCheckboxChange:i=>{e?this.toggleCheckListSelectAll(i):this.toggleCheckBoxSingleSelection(l,t)}}),i)},this.inputChanged=e=>{this.hasVariable||null!==e.target&&(this.value=e.target.value,this.validateInput(),this.analysisStringInputChange.emit())},this.comboboxChanged=e=>{if(this.hasVariable)return;const t=e.target;if(null!==t){if("multi"===this.selectionMode)this.value=t.selectedItems.filter((e=>void 0!==e?.value)).map((e=>e.value));else{const[e]=t.selectedItems;this.value=e?.value}this.validateInput(),this.analysisStringInputChange.emit()}},this.segmentedControlChange=e=>{if(this.hasVariable)return;const t=e.target;null!==t&&(this.value=t.value??"",this.validateInput(),this.analysisStringInputChange.emit())},this.radioButtonGroupChange=e=>{this.hasVariable||null!==e?.target&&(this.value=e.target.selectedItem.value,this.validateInput(),this.analysisStringInputChange.emit())},this.checkListChange=e=>{this.hasVariable||(this.value=e,this.validateInput(),this.analysisStringInputChange.emit())}}updatedSelectionMode(){this.initialValues=this.value}updatedChoiceList(e,t){if(!this.hasVariable&&!(0,n.v)(t,e)){let t=this.value;const i=(Array.isArray(t)?t:void 0!==t?[t]:[]).filter((t=>this.allowCustomValues||e?.includes(t)));t="multi"===this.selectionMode?i:i[0],this.useDefaultOnReset&&0===i.length&&(t=void 0!==e?"multi"===this.selectionMode?[e[0]]:e[0]:void 0),(0,n.v)(t,this.value)||(this.value=t,this.analysisStringInputChange.emit())}}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.updatedChoiceList(this.choiceList,void 0),this.hasVariable||(this.initialValues=this.value)}async checkValidity(){return this.validateInput(),Promise.resolve(this.isValid)}componentDidLoad(){void 0!==this.segmentedControl&&(this.resizeObserver=new ResizeObserver((()=>{0!==this.hostElement.clientWidth?this.layoutUpdating?this.layoutUpdating=!1:(this.layoutUpdating=!0,this.adjustLayout()):this.layout="horizontal"})),this.resizeObserver.observe(this.hostElement)),setTimeout((()=>{this.segmentedItems.forEach((e=>delete e?.focus)),this.segmentedItems=[]}),250)}disconnectedCallback(){this.resizeObserver?.disconnect()}get hasVariable(){return!0===(0,a.M)(this.value)}render(){this.value??(this.value=this.initialValues);const e=this.hasVariable?this.value?.variable:void 0;let t;t=void 0!==e?this.renderVariableDisplay(e):void 0===this.choiceList||0===this.choiceList.length?"multi"!==this.selectionMode?this.renderInput():this.renderCombobox():!0===this.showAsCheckList?this.renderCheckList():"multi"!==this.selectionMode&&!0===this.showAsRadioGroup?this.renderRadioGroup():"multi"!=this.selectionMode&&!0===this.showAsRadioButtonGroup?this.renderRadioButtonGroup():this.renderCombobox();const i=!1===this.isValid,l=(0,a.z)((0,a.B)(this.strings,this.validationParams)),n=!1===(0,a.d)(l)||!0===i,r=void 0!==this.errorMessage?a.Z.INVALID:(0,a.D)(this.validationParams?.type);return(0,s.h)(s.H,{key:"521dfd678b335dd152903d7f70a2d4d2675dec0d"},(0,s.h)("calcite-label",{key:"155e619b8da9b3d4e5a688f4daf597efe8ebd8eb",class:"label",scale:a.c.Scale},""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp,supportsVariables:this.supportsVariables,onShowVariableActionClick:()=>!0!==this.readOnly&&this.showVariableNodesClick.emit(),readOnly:this.readOnly}):null,t,(0,s.h)("calcite-input-message",{key:"0fbc71272e672dc38c2add499ed45456b45d405d",status:r,hidden:!n,scale:a.c.Scale,icon:"exclamationMarkTriangle"},this.errorMessage??l)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{selectionMode:["updatedSelectionMode"],choiceList:["updatedChoiceList"]}}};j.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;width:var(--analysis-component-default-width);--calcite-color-border-input:var(--analysis-ui-border-input)}.label{width:var(--analysis-component-default-width)}.segmented-control:not([layout]){visibility:hidden;position:absolute}";const Z="now",K="custom",X="unspecified",J="UTC",Y="GeoLocal",ee=class{constructor(e){(0,s.r)(this,e),this.analysisTrafficTimeInputChange=(0,s.c)(this,"analysisTrafficTimeInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.value={timeOfDay:a.an,timeZoneForTimeOfDay:J},this.readOnly=!1,this.isValid=!0,this.resetTimeZoneValue=!1,this.validateSelection=async()=>{let e=!0;this.selectedTimeMode===K&&!0===this.required?(void 0!==this.dateInputElement&&(e=await this.dateInputElement.checkValidity()),this.isValid=e&&void 0!==this.value):this.isValid=e},this.setSelectedTimeMode=e=>{switch(e?.timeZoneForTimeOfDay){case void 0:const t={timeOfDay:void 0,timeZoneForTimeOfDay:void 0};this.value={...t},this.selectedTimeMode=X;break;case Y:const i=e.timeOfDay;if(void 0!==i&&"number"==typeof i){const e={timeOfDay:i,timeZoneForTimeOfDay:Y};this.value={...e}}this.selectedTimeMode=K;break;default:const s=e??{timeOfDay:a.an,timeZoneForTimeOfData:J};s.timeOfDay=a.an,this.value={...s},this.selectedTimeMode=Z}this.analysisTrafficTimeInputChange.emit()},this.renderDatePicker=()=>this.selectedTimeMode===K?(0,s.h)("analysis-date-input",{label:"",required:this.required,onAnalysisDateInputChange:this.datePickerChange,ref:e=>{this.dateInputElement=e},value:this.value?.timeOfDay,readOnly:this.readOnly}):null,this.timeSelectChange=()=>{switch(this.selectedTimeMode=this.timeSelectElement.value,this.selectedTimeMode){case Z:this.value={timeOfDay:a.an,timeZoneForTimeOfDay:J};break;case X:this.value={timeOfDay:void 0,timeZoneForTimeOfDay:void 0};break;case K:const e=this.value?.timeOfDay;this.value={timeOfDay:e,timeZoneForTimeOfDay:Y}}this.analysisTrafficTimeInputChange.emit()},this.datePickerChange=()=>{if(this.selectedTimeMode===K){const e=this.dateInputElement?.value;this.value={timeOfDay:e,timeZoneForTimeOfDay:Y},this.analysisTrafficTimeInputChange.emit()}}}resetTimeZoneValueChange(e){!0===e&&(this.value={timeOfDay:void 0,timeZoneForTimeOfDay:void 0},this.setSelectedTimeMode(this.value))}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.setSelectedTimeMode(this.value)}async checkValidity(){return await this.validateSelection(),Promise.resolve(this.isValid)}render(){return(0,s.h)(s.H,{key:"9b3def109e627b17e8a0e07c5b6e2e278048fe65"},(0,s.h)("calcite-label",{key:"196856cfdaf5d917ef2b8d94917d5d5761940f6c",class:"label",scale:a.c.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-select",{key:"9ac7334cc1491d0de08450c365e47c33b028d6f9",value:this.selectedTimeMode,scale:a.c.Scale,label:this.label??this.strings.arriveTime,onCalciteSelectChange:this.timeSelectChange,ref:e=>this.timeSelectElement=e,disabled:this.readOnly},(0,s.h)("calcite-option",{key:"b4153ffc867e90d7358eafd647fb611ed6bc1ff4",selected:"UTC"===this.value?.timeZoneForTimeOfDay,value:Z},this.strings.modes.now),(0,s.h)("calcite-option",{key:"f35272da4ca3353840e852d2361bc75da1d12217",selected:"GeoLocal"===this.value?.timeZoneForTimeOfDay,value:K},this.strings.modes.custom),(0,s.h)("calcite-option",{key:"2851a48b76f47916534b01568e0adf99e3f0cf93",selected:void 0===this.value?.timeZoneForTimeOfDay,value:X},this.strings.modes.unspecified))),this.renderDatePicker())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{resetTimeZoneValue:["resetTimeZoneValueChange"]}}};ee.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;width:var(--analysis-component-default-width);--calcite-color-border-input:var(--analysis-ui-border-input)}.label{width:var(--analysis-component-default-width)}";const te=e=>!("isConnected"in e)||e.isConnected,ie=((e,t)=>{let i;return(...s)=>{i&&clearTimeout(i),i=setTimeout((()=>{i=0,e(...s)}),t)}})((e=>{for(let t of e.keys())e.set(t,e.get(t).filter(te))}),2e3),se=e=>"function"==typeof e?e():e,ae=(e,t)=>{const i=e.indexOf(t);i>=0&&(e[i]=e[e.length-1],e.length--)},le=((e,t)=>{const i=((e,t=(e,t)=>e!==t)=>{const i=se(e);let s=new Map(Object.entries(i??{}));const a={dispose:[],get:[],set:[],reset:[]},l=()=>{s=new Map(Object.entries(se(e)??{})),a.reset.forEach((e=>e()))},n=e=>(a.get.forEach((t=>t(e))),s.get(e)),r=(e,i)=>{const l=s.get(e);t(i,l,e)&&(s.set(e,i),a.set.forEach((t=>t(e,i,l))))},o="undefined"==typeof Proxy?{}:new Proxy(i,{get:(e,t)=>n(t),ownKeys:e=>Array.from(s.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>s.has(t),set:(e,t,i)=>(r(t,i),!0)}),h=(e,t)=>(a[e].push(t),()=>{ae(a[e],t)});return{state:o,get:n,set:r,on:h,onChange:(t,i)=>{const s=h("set",((e,s)=>{e===t&&i(s)})),a=h("reset",(()=>i(se(e)[t])));return()=>{s(),a()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(h("set",t.set)),t.get&&e.push(h("get",t.get)),t.reset&&e.push(h("reset",t.reset)),t.dispose&&e.push(h("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{a.dispose.forEach((e=>e())),l()},reset:l,forceUpdate:e=>{const t=s.get(e);a.set.forEach((i=>i(e,t,t)))}}})(e,t);return i.use((()=>{if("function"!=typeof s.d)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const i=(0,s.d)();i&&((e,t,i)=>{const s=e.get(t);s?s.includes(i)||s.push(i):e.set(t,[i])})(e,t,i)},set:t=>{const i=e.get(t);i&&e.set(t,i.filter(s.f)),ie(e)},reset:()=>{e.forEach((e=>e.forEach(s.f))),ie(e)}}})()),i})({activeSketchToolName:""}),ne="flex-container",re="primary-button",oe="border",he="warning-message",ce="loading-message-wrapper",de="loading-sketch-message",pe="loader",ue="list-item",me=class{constructor(e){(0,s.r)(this,e),this.analysisLayerInputChange=(0,s.c)(this,"analysisLayerInputChange",7),this.analysisLayerInputClose=(0,s.c)(this,"analysisLayerInputClose",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.hideAddToMap=!1,this.required=!1,this.enableSketch=!1,this.ignoreTimeExtent=!1,this.mapLayers=[],this.hideModelVariableLayers=!1,this.processedLayerProperties={},this.descriptionDisplay="featureCount",this.hideBrowseButton=!1,this.hideHelp=!1,this.creationMode="browse",this.readOnly=!1,this.canCreateAnalysisSketch=!1,this.isSketchLoading=!0,this.featureCounts=new Map,this.browsedLayers=[],this.replaceId=null,this.filteredMapLayers=[],this.filteredModelVariables=[],this.modelVariableLayers=[],this.showNoticeMessage=!1,this.noticeMessage=[],this.warningMessageForPopover=[],this.refreshHandlers=[],this.dataUpdatingHandlers=[],this.filterFeatureLayers=e=>e.filter((e=>void 0!==e&&(0,a.K)(e)&&e.loaded)),this.updateWarningMessage=(e,t)=>{const i=t.length-e.length;if(this.warningMessage=void 0,i>0){const s=new Map(this.mapLayers.map((e=>[e.id,e]))),l=t.find((t=>!e.includes(t)))??"",n=s.get(l)?.title??"",r=1===i?this.strings.layerNotAvailable:this.strings.multipleLayersNotAvailable;this.warningMessage=(0,a.t)(r,{layerName:n})}},this.syncValueWithIds=async()=>{const e=[...this.browsedLayers??[],...this.mapLayers??[],...this.modelVariableLayers??[]],t=[],i=[],s="multi"!==this.selectionMode;for(const s of this.selectedLayerIds??[]){const l=e.find((e=>s===e.id)),n=this.modelVariables?.some((e=>s===e.id));if(void 0!==l){let e;i.push(l),!0===n?e={variable:s}:(0,a.K)(l)?e=await(0,a.ao)(l,this.mapView):(0,a.ap)(l)||(0,a.aq)(l)?e=(0,a.ar)(l):(0,a.as)(l)&&(e=(0,a.at)(l)),void 0!==e&&t.push(e)}}if(this.value=s?t[0]:t,this.selectedLayers=s?i[0]:i,this.processedLayerProperties={},s||Array.isArray(this.selectedLayers)&&1===this.selectedLayers.length){const e=i[0];if(void 0!==e&&((0,a.ap)(e)||(0,a.aq)(e)))this.processedLayerProperties=await(0,a.au)(e);else if(void 0!==e&&(0,a.K)(e)){const t=(0,a.$)(e).fields,i=t?.map((e=>e.name));this.processedLayerProperties.fieldNames=i}}this.analysisLayerInputChange.emit({creationMode:this.creationMode})},this.renderInitialMode=()=>(this.removeTooltip(),(0,s.h)("section",null,void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}):null,this.renderButton())),this.renderErrorMessage=()=>{const e=!1===(0,a.d)(this.validationParams?.message)||void 0!==this.errorMessage,t=(0,a.z)((0,a.B)(this.strings,this.validationParams)),i=void 0!==this.validationParams?(0,a.D)(this.validationParams.type):a.Z.INVALID;return(0,s.h)("calcite-input-message",{status:i,hidden:!e,scale:a.c.Scale,icon:"exclamationMarkTriangle"},t??this.errorMessage)},this.renderWarningMessage=()=>void 0!==this.warningMessage?(0,s.h)("calcite-input-message",{icon:"exclamationMarkTriangle",scale:a.c.Scale},(0,s.h)("div",{class:he},this.warningMessage)):null,this.renderSketchLoadingMessage=()=>!0===this.canCreateAnalysisSketch&&!0===this.isSketchLoading&&(0,s.h)("div",{class:ce},(0,s.h)("calcite-loader",{class:pe,scale:a.c.Scale,label:this.strings.loadingSketch}),(0,s.h)("p",{class:de},this.strings.loadingSketch)),this.handleAnalysisSketchToolsRendered=()=>{this.isSketchLoading=!1,this.setupOutsideSketchClickListener()},this.handleAnalysisSketchLayerChange=e=>{const t=e.detail;(0,a.m)(t)&&(this.currentSketchLayerId=t.id,this.selectedLayers=[t])},this.handleAnalysisSketchRemove=async()=>{await this.removeAnalysisSketch()},this.renderCreateSketchButton=()=>(0,s.h)(s.F,null,(0,s.h)("calcite-button",{ref:e=>{void 0!==e&&(this.createSketchButton=e)},scale:a.c.Scale,appearance:"outline",kind:"neutral",iconStart:"pencil-mark",onClick:this.onCreateSketchButtonClicked,label:this.strings.createSketch}),(0,s.h)("calcite-tooltip",{dir:this.dir,overlayPositioning:"fixed",referenceElement:this.createSketchButton,placement:"top"},this.strings.drawInputFeatures)),this.removeAnalysisSketch=async()=>{void 0!==this.analysisSketch&&(document.removeEventListener("click",this.handleClickedOutsideSketch),await(this.analysisSketch?.removeSketch()),this.analysisSketch?.remove(),this.analysisSketch=void 0,this.canCreateAnalysisSketch=!1,this.isSketchLoading=!0)},this.setupOutsideSketchClickListener=()=>{document.addEventListener("click",this.handleClickedOutsideSketch),le.onChange("activeSketchToolName",(async e=>{this.analysisSketchToolName!==e&&await this.removeAnalysisSketch()}))},this.handleClickedOutsideSketch=async e=>{e.target.tagName.includes("ANALYSIS-")&&await this.removeAnalysisSketch()},this.onCreateSketchButtonClicked=e=>{e.stopPropagation(),this.analysisSketchToolName=`${this.toolTitle?.trim()??""} ${this.label}`,le.state.activeSketchToolName=this.analysisSketchToolName,this.canCreateAnalysisSketch=!0},this.renderButton=()=>(0,s.h)("div",{class:ne},(0,s.h)("calcite-button",{class:re,appearance:"outline",kind:"neutral",scale:a.c.Scale,iconStart:"add-layer",disabled:this.readOnly,onClick:this.primaryButtonClicked},this.strings.layer),!0===this.enableSketch&&!(0,l.v)(this.mapView)&&this.renderCreateSketchButton()),this.renderListMode=()=>{const e=Array.isArray(this.selectedLayers)?this.selectedLayers:[this.selectedLayers];return(0,s.h)("section",null,(0,s.h)("calcite-label",null,void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-list",{class:oe,label:"",selectionMode:"none",disabled:this.readOnly,onClick:this.replaceLayer,onMouseOver:this.mouseOver,onMouseOut:this.mouseOut},e.map((e=>this.renderListModeItem(e))))),"multi"===this.selectionMode?this.renderButton():null)},this.renderListModeItem=e=>{const t=this.modelVariables?.find((t=>t.id===e.id)),i=(0,a.N)(e),l=t?.name??"";let n="";if((0,a.K)(e)&&!0!==t?.isDerived&&"featureCount"===this.descriptionDisplay&&!(0,a.av)(e))n=(0,a.t)(this.strings.numberFeatures,{featureCount:this.featureCounts.get(t?.id??e.id)??this.strings.numberFeaturesLoading});else if("spatialReference"===this.descriptionDisplay){const t=(0,a.$)(e),i=(t.fullExtent?.spatialReference).latestWkid;n=this.wkidMap.get(i)??""}const r=(0,a.t)(this.strings.layerAction,{layerName:i}),o=(0,a.t)(this.strings.variableValue,{val:(0,a.av)(e)?"":i});return(0,s.h)("calcite-list-item",{class:ue,key:e.id,value:e.id,label:i},void 0!==this.selectedLayerIcon&&(0,s.h)("calcite-icon",{icon:this.selectedLayerIcon,slot:"content-start"}),(0,s.h)("div",{slot:"content",style:{pointerEvents:"none",lineBreak:"anywhere"},class:"content"},(0,s.h)("div",null,""!==l&&!1===this.hideModelVariableLayers?l:i),""!==l&&!0!==t?.isDerived&&!1===this.hideModelVariableLayers&&(0,s.h)("div",null,o),""!==n&&(0,s.h)("div",null,n)),!1===this.readOnly&&(0,s.h)("calcite-action",{"data-layerId":e.id,text:r,slot:"actions-end",label:r,appearance:"transparent",icon:"x",onClick:this.actionClicked}))},this.layerSelectionChange=async e=>{this.creationMode="list","multi"!==this.selectionMode&&((0,l.r)(this.layerInputPopover),this.layerInputPopover=void 0);const t=e.detail;if(null===this.replaceId){const e=(this.selectedLayerIds??[]).filter((e=>this.browsedLayers.some((t=>t.id===e))));this.selectedLayerIds=[...t,...e]}else this.browsedLayers=this.browsedLayers.map((e=>this.replaceId===e.id?void 0:e)).filter((e=>void 0!==e)),this.selectedLayerIds=this.selectedLayerIds?.map((e=>e===this.replaceId?t?.[0]:e)),this.replaceId=null;const i=this.selectedLayerIds?.find((e=>e===this.currentSketchLayerId));void 0===i&&await this.removeAnalysisSketch(),await this.syncValueWithIds(),await this.validate()},this.handleLayerBrowsed=async e=>{this.creationMode="browse","multi"!==this.selectionMode?(this.browsedLayers=e.detail,this.selectedLayers=this.browsedLayers[0]):null===this.replaceId?(this.browsedLayers=[...this.browsedLayers,...e.detail],this.selectedLayers=[...this.selectedLayers??[],...this.browsedLayers]):(this.browsedLayers=this.browsedLayers.map((t=>this.replaceId===t.id?e.detail[0]:t)),this.selectedLayers=this.selectedLayers?.map((t=>this.replaceId===t.id?e.detail[0]:t)),this.replaceId=null),await this.validate()},this.primaryButtonClicked=e=>{this.createLayerPopover(e.currentTarget)},this.replaceLayer=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(this.replaceId=t.value,this.createLayerPopover(t),void 0!==this.layerInputPopover&&null!==this.replaceId&&(this.layerInputPopover.selectedIds=[this.replaceId]))},this.actionClicked=async e=>{const t=e.target?.getAttribute("data-layerId");this.selectedLayerIds=this.selectedLayerIds?.filter((e=>e!==t)),this.browsedLayers=this.browsedLayers.filter((e=>e.id!==t)),this.analysisLayerInputClose.emit(),await this.removeAnalysisSketch(),await this.syncValueWithIds(),await this.validate()},this.mouseOver=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(void 0===this.replaceTooltip&&(this.replaceTooltip=document.createElement("calcite-tooltip"),this.replaceTooltip.placement="bottom",this.replaceTooltip.innerText=this.strings.replaceLayer),this.replaceTooltip.referenceElement=t,(0,l.b)(document,this.replaceTooltip))},this.mouseOut=()=>{this.removeTooltip()},this.layerPopoverClose=async()=>{this.replaceId=null,(0,l.r)(this.layerInputPopover),this.layerInputPopover=void 0,await this.validate()},this.validate=async()=>{this.warningMessage=void 0,this.errorMessage=void 0;const e=(0,a.z)((0,a.B)(this.strings,this.validationParams));if(!1===(!this.required||void 0!==this.selectedLayers&&(!Array.isArray(this.selectedLayers)||this.selectedLayers.length>0)))return void(this.errorMessage=void 0!==this.validationParams?.message?e:(0,a.t)(this.strings.isRequired,{label:this.label??this.strings.layer}));const t=(0,a.M)(this.value),i=Array.isArray(this.selectedLayers)?this.selectedLayers:[this.selectedLayers];if(t){if((0,a.av)(i[0]))return;const{filteredLayers:t}=await(0,a.E)({layers:i,layerFilterTypes:this.layerFilterType,user:this.user}),{filteredLayers:s}=(0,l.f)({layers:i,layerFilterTypes:this.layerFilterType}),n=t.length>0;if(s.length>0)return void(this.errorMessage=void 0!==this.validationParams?.message?e:this.strings.dataTypeMismatch);if(n)return void(this.errorMessage=void 0!==this.validationParams?.message?e:this.strings.geometryMismatch)}void 0!==this.selectedLayerFeatureCount&&(void 0!==this.minimumFeatureCount&&this.selectedLayerFeatureCount<this.minimumFeatureCount&&(this.errorMessage=void 0!==this.validationParams?.message?e:(0,a.t)(this.strings.featureCountBelowMinimum,{label:this.label,minimum:this.minimumFeatureCount.toString()})),void 0!==this.maximumFeatureCount&&this.selectedLayerFeatureCount>this.maximumFeatureCount&&(this.errorMessage=void 0!==this.validationParams?.message?e:(0,a.t)(this.strings.featureCountAboveMaximum,{label:this.label,maximum:this.maximumFeatureCount.toString()})))},this.removeTooltip=()=>{(0,l.r)(this.replaceTooltip)},this.updateFeatureCounts=e=>{const{countExtent:t,mapView:i,ignoreTimeExtent:s}=this,l=this.filterFeatureLayers(e).map((async e=>{let l;try{"mapExtent"!==this.countExtent&&(l=(await(0,a.aw)(e,i,s,t)).toString())}catch{}return[e.id,l]}));return Promise.all(l).then((e=>{const t=e.filter((([,e])=>void 0!==e)),i=[...this.featureCounts].filter((([e])=>this.selectedLayerIds?.includes(e)));this.featureCounts=new Map([...i,...t])})).catch((()=>{}))},this.updateFeatureCountsLayerView=async e=>{const t=(0,a.ax)().debounce(((e,t)=>{e.queryFeatureCount({geometry:this.mapView.extent}).then((e=>{this.featureCounts.set(t,e.toString()),this.featureCounts=new Map(this.featureCounts)}))}));this.dataUpdatingHandlers.forEach((e=>e.remove())),this.dataUpdatingHandlers=[];const i=(0,a.a7)(),s=this.filterFeatureLayers(e);for(const e of s){if(this.currentSketchLayerId===e.id)t(e,e.id),this.dataUpdatingHandlers.push(i.watch((()=>[this.mapView.viewpoint]),t.bind(this,e,e.id)));else{const s=await this.mapView.whenLayerView(e);t(s,e.id),this.dataUpdatingHandlers.push(i.watch((()=>[this.mapView.viewpoint]),t.bind(this,s,e.id))),this.dataUpdatingHandlers.push(i.watch((()=>[!s.dataUpdating]),t.bind(this,s,e.id)))}}}}async mapLayersChange(e,t){this.warningMessageForPopover=[];const i=void 0!==this.selectedLayerIds?.find((e=>e===this.currentSketchLayerId)),s=void 0===e.find((e=>e?.id===this.currentSketchLayerId));e.length!==t?.length&&!0===i&&!0===s&&(this.selectedLayerIds=this.selectedLayerIds?.filter((e=>e!==this.currentSketchLayerId)),await this.syncValueWithIds());const{proxyAllowedLayers:l,filteredLayersByType:n,filteredLayersAllowAnalysis:r}=await(0,a.ay)(e,this.layerFilterType,this.user?.portal);if(r.length<e.length){this.noticeMessage=[];const t=l.length<e.length,i=r.length<n.length;t&&this.warningMessageForPopover.push("proxyReason"),i&&this.warningMessageForPopover.push("allowAnalysisReason")}this.showNoticeMessage=this.warningMessageForPopover.length>0,this.filteredMapLayers=r.filter((e=>e.loaded)),void 0!==this.layerInputPopover&&(this.layerInputPopover.mapLayers=this.filteredMapLayers)}async modelVariablesChange(e){if(this.modelVariableLayers=e?.map((e=>e.layer)).filter((e=>void 0!==e))??[],void 0===e)return void(this.filteredModelVariables=[]);const t=Object.groupBy(e,(({isDerived:e})=>!0===e?"derived":"nonDerived")),{validLayers:i}=(0,l.f)({layers:t.derived?.map((e=>e.layer)).filter((e=>void 0!==e))??[],layerFilterTypes:this.layerFilterType}),s=[];i.forEach((t=>{const i=e.find((e=>e.id===t.id));void 0!==i&&s.push(i)}));const{validLayers:n}=await(0,a.E)({layers:t.nonDerived?.map((e=>e.layer)).filter((e=>void 0!==e))??[],layerFilterTypes:this.layerFilterType,user:this.user}),r=[];n.forEach((t=>{const i=e.find((e=>e.id===t.id));void 0!==i&&r.push(i)})),this.filteredModelVariables=[...r,...s],void 0===this.layerInputPopover||this.hideModelVariableLayers||(this.layerInputPopover.modelVariables=this.filteredModelVariables)}async selectedLayersChange(e,t){if((0,a.m)(e)&&!(0,n.v)(e,t)){let t=Array.isArray(e)?e:[e];"featureCount"===this.descriptionDisplay&&("mapExtent"===this.countExtent?this.updateFeatureCountsLayerView(t):this.updateFeatureCounts(t)),this.refreshHandlers.forEach((e=>e.remove())),this.refreshHandlers=this.filterFeatureLayers(t).map((e=>(0,a.$)(e).on("refresh",(e=>{e.dataChanged&&("mapExtent"===this.countExtent?this.updateFeatureCountsLayerView(t):this.updateFeatureCounts(t))}))));const i=t.map((e=>e.id)),s=await Promise.allSettled(t.map((e=>e?.loaded?Promise.resolve(e):e?.load?.())));t=s.filter((e=>"fulfilled"===e.status)).map((e=>e.value));const l=t.filter((e=>e.loaded)).map((e=>e.id));this.updateWarningMessage(l,i),this.selectedLayerIds=Array.from(new Set(l));const n=this.featureCounts.get(this.selectedLayerIds?.[0]??"");void 0!==n&&"multi"!==this.selectionMode&&(this.selectedLayerFeatureCount=parseInt(n)),await this.syncValueWithIds(),void 0===this.warningMessage&&this.validate()}else this.dataUpdatingHandlers.forEach((e=>e.remove()))}async layerFilterTypeChange(e,t){(0,n.v)(e,t)||await this.mapLayersChange(this.mapLayers)}externalBrowsedLayersChange(e){this.browsedLayers=[...e??[],...this.browsedLayers]}async countExtentChange(e,t){if(void 0===this.selectedLayers||(0,n.v)(e,t))return;const i=Array.isArray(this.selectedLayers)?this.selectedLayers:[this.selectedLayers];"mapExtent"===e?this.updateFeatureCountsLayerView(i):(this.dataUpdatingHandlers.forEach((e=>e.remove())),await this.updateFeatureCounts(i))}onFeatureCountChange(){if(void 0!==this.selectedLayerIds&&this.selectedLayerIds.length>0&&"multi"!==this.selectionMode){const e=this.featureCounts.get(this.selectedLayerIds[0]);void 0!==e&&this.selectedLayerFeatureCount!==parseInt(e)&&(this.selectedLayerFeatureCount=parseInt(e),this.analysisLayerInputChange.emit({creationMode:this.creationMode}))}}async checkValidity(){await this.validate();const e=void 0===this.errorMessage&&(void 0===this.validationParams?.message||"informative"===this.validationParams.type);return Promise.resolve(e)}disconnectedCallback(){(0,l.r)(this.layerInputPopover),(0,l.r)(this.replaceTooltip),document.removeEventListener("click",this.handleClickedOutsideSketch),this.refreshHandlers.forEach((e=>e.remove())),this.dataUpdatingHandlers.forEach((e=>e.remove()))}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.wkidMap=(0,a.az)(),this.browsedLayers=[...this.externalBrowsedLayers??[],...this.browsedLayers],void 0!==this.modelVariables&&await this.modelVariablesChange(this.modelVariables),void 0!==this.mapLayers&&await this.mapLayersChange(this.mapLayers),await this.selectedLayersChange(this.selectedLayers,void 0)}get isInitialMode(){return void 0===this.selectedLayerIds||0===this.selectedLayerIds.length||void 0===this.selectedLayers}render(){return(0,s.h)(s.H,{key:"92e131b9c23de080a757578c774e9aaaeefbd191"},(0,s.h)(s.F,{key:"927ec824ff1444452ccaffe74311cb924d745716"},!0===this.canCreateAnalysisSketch&&(0,s.h)("analysis-sketch",{key:"bd73eb7c15840b59b0b11c2583a81c9fe6eef336",ref:e=>{void 0!==e&&(this.analysisSketch=e)},referenceElement:this.hostElement,label:this.label,toolTitle:this.toolTitle,layerFilterType:this.layerFilterType,mapView:this.mapView,mapLayers:this.filteredMapLayers,onAnalysisSketchToolsRendered:this.handleAnalysisSketchToolsRendered,onAnalysisSketchLayerChange:this.handleAnalysisSketchLayerChange,onAnalysisSketchRemove:this.handleAnalysisSketchRemove}),this.isInitialMode?this.renderInitialMode():this.renderListMode(),!1===this.readOnly&&this.renderErrorMessage(),!1===this.readOnly&&this.renderWarningMessage(),this.renderSketchLoadingMessage()))}createLayerPopover(e){const t=(0,l.v)(this.mapView)&&null!=this.layerFilterType?(0,l.e)(this.layerFilterType):this.layerFilterType;void 0===this.layerInputPopover&&(this.layerInputPopover=document.createElement("analysis-layer-input-popover"),this.layerInputPopover.addEventListener("analysisLayerInputPopoverClose",this.layerPopoverClose),this.layerInputPopover.addEventListener("analysisLayerInputPopoverSelectionChange",this.layerSelectionChange),this.layerInputPopover.addEventListener("analysisLayerInputPopoverLayerBrowsed",this.handleLayerBrowsed)),!0===this.isInitialMode||"calcite-button"===e.localName?(this.layerInputPopover.selectionMode=this.selectionMode,void 0!==this.selectedLayerIds&&(this.layerInputPopover.selectedIds=[...this.selectedLayerIds])):this.layerInputPopover.selectionMode="single",this.layerInputPopover.mapLayers=this.filteredMapLayers,this.hideModelVariableLayers||(this.layerInputPopover.modelVariables=this.filteredModelVariables),this.layerInputPopover.hideModelVariableLayers=this.hideModelVariableLayers,this.layerInputPopover.hideAddToMap=this.hideAddToMap,this.layerInputPopover.itemBrowserFilter=(0,l.g)(t),this.layerInputPopover.itemBrowserQ=(0,l.h)(this.mapView,t,this.user?.orgId??void 0),this.layerInputPopover.itemBrowserAllowedGeometries=(0,l.j)(t),this.layerInputPopover.layerFilterType=t,this.layerInputPopover.showNoticeMessage=this.showNoticeMessage;const i=this.warningMessageForPopover.map((e=>{const t="allowAnalysisReason"===e?"allowAnalysis":"supportedData",i=!0===this.user?.portal?.isPortal&&void 0!==this.portalHelpMap?this.portalHelpMap?.m[r.n.map.OtherHelpLinks[t]]:r.m.map.OtherHelpLinks[t],s=(0,a.l)({url:i,basePath:(0,a.A)(this.user?.portal),portalUrl:this.user?.portal?.restUrl});return(0,a.t)(this.strings[e],{docLink:s})}));this.layerInputPopover.noticeMessage=[...this.noticeMessage,...i],this.layerInputPopover.placement="leading",this.layerInputPopover.dir=this.dir,this.layerInputPopover.hideBrowseButton=this.hideBrowseButton,this.layerInputPopover.referenceElement=e.parentElement??e,this.layerInputPopover.popoverWidth=this.popoverWidth??e.parentElement?.offsetWidth,this.layerInputPopover.mapView=this.mapView,void 0!==this.user&&(this.layerInputPopover.user=this.user,this.layerInputPopover.portal=this.user?.portal),(0,l.b)(document,this.layerInputPopover)}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{mapLayers:["mapLayersChange"],modelVariables:["modelVariablesChange"],selectedLayers:["selectedLayersChange"],layerFilterType:["layerFilterTypeChange"],externalBrowsedLayers:["externalBrowsedLayersChange"],countExtent:["countExtentChange"],featureCounts:["onFeatureCountChange"]}}};me.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;width:var(--analysis-component-default-width);margin-bottom:var(--analysis-half-spacing);--calcite-label-margin-bottom:0;--layer-selected-margin-bottom:var(--analysis-half-spacing)}:host([hidden]){display:none}.flex-container{display:flex;width:var(--analysis-component-default-width);column-gap:3%}.primary-button{flex:1 1 auto}.secondary-button{flex:auto 1 auto}.text{padding-bottom:var(--analysis-quarter-spacing);margin-block-start:0;margin-block-end:0}.border{border:1px solid var(--calcite-color-border-input);margin-bottom:var(--layer-selected-margin-bottom)}.warning-message{word-wrap:break-word;overflow-wrap:anywhere}.loading-message-wrapper{margin-top:var(--analysis-half-spacing);display:flex;justify-content:center;gap:1rem}.loading-message-wrapper .loading-sketch-message{margin:0}.loading-message-wrapper .loader{--calcite-loader-size:1rem;margin:0;padding:0}.list-item{--calcite-font-size--1:var(--calcite-font-size--2)}.list-item .content :first-child{color:var(--calcite-color-text-1)}";const ye="calcite-chip",ge="calcite-list-item",ve=class{constructor(e){(0,s.r)(this,e),this.analysisSummaryFieldsChange=(0,s.c)(this,"analysisSummaryFieldsChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.valueMap=new Map,this.useInitialSelectedStatistics=!1,this.selection=new Set,this.storeAsGPValue=!1,this.required=!1,this.usePopupTemplatesInfo=!0,this.allowDateType=!1,this.allowDateOnlyType=!1,this.allowTimeOnlyType=!1,this.allowStringType=!1,this.showFirstLastStatistics=!1,this.alwaysShowAnyCountStatistics=!1,this.showFieldDescription=!1,this.fieldPopoverOpen=!1,this.readOnly=!1,this.updateValueMap=(e,t)=>{if(!1===this.valueMap.has(e))this.valueMap.set(e,[t]);else{const i=this.valueMap.get(e)??[];!1===i.includes(t)&&(i.push(t),this.valueMap.set(e,i))}},this.popoverAction=()=>{this.fieldPopoverOpen=!0,!0===this.fieldPopoverOpen?this.createSummaryFieldsPopover():void 0!==this.summaryFieldsPopover&&(this.summaryFieldsPopover.open=!1,this.validate())},this.createSummaryFieldsPopover=()=>{void 0===this.summaryFieldsPopover&&(this.summaryFieldsPopover=document.createElement("analysis-summary-fields-popover"),this.summaryFieldsPopover.addEventListener("analysisSummaryFieldSelectionDone",this.onAnalysisSummaryFieldSelectionDone),this.summaryFieldsPopover.addEventListener("analysisSummaryFieldPopoverClose",this.closePopover)),this.summaryFieldsPopover.referenceElement=this.fieldButton,this.summaryFieldsPopover.open=!0,this.summaryFieldsPopover.layer=this.layer,this.summaryFieldsPopover.usePopupTemplatesInfo=this.usePopupTemplatesInfo,this.summaryFieldsPopover.selection=new Set(this.selection.keys()),this.summaryFieldsPopover.allowDateType=this.allowDateType,this.summaryFieldsPopover.allowStringType=this.allowStringType,this.summaryFieldsPopover.allowDateOnlyType=this.allowDateOnlyType,this.summaryFieldsPopover.allowTimeOnlyType=this.allowTimeOnlyType,this.summaryFieldsPopover.layerInputLocalizedLabel=this.layerInputLocalizedLabel,this.summaryFieldsPopover.noFieldsText=this.noFieldsText,this.summaryFieldsPopover.noLayersText=this.noLayersText,this.summaryFieldsPopover.showFieldDescription=this.showFieldDescription,!1===document.body.contains(this.summaryFieldsPopover)&&(this.summaryFieldsPopover.open=!0,document.body.appendChild(this.summaryFieldsPopover))},this.closePopover=()=>{void 0!==this.summaryFieldsPopover&&!0===document.body.contains(this.summaryFieldsPopover)&&(document.body.removeChild(this.summaryFieldsPopover),this.summaryFieldsPopover?.remove(),this.summaryFieldsPopover=void 0,this.fieldPopoverOpen=!1)},this.onAnalysisSummaryFieldSelectionDone=e=>{this.selection=e.detail,this.fieldPopoverOpen=!1,0===this.selection.size?(this.valueMap=new Map,this.value=void 0):(Array.from(this.valueMap.keys()).map((e=>{!1===this.selection.has(e)&&this.removeFromValueMap(e)})),Array.from(this.selection).map((e=>{const t=this.layer.fieldsIndex.get(e),{statistics:i}=this.getSupportedStatisticTypes(t.type);this.useInitialSelectedStatistics=!0,!1===this.valueMap.has(e)&&this.updateValueMap(t.name,i[0])})),this.updateValue()),this.analysisSummaryFieldsChange.emit(),this.validate()},this.onAnalysisChipGroupSelectionChange=e=>{const t=e.target,i=t.selectedChips,s=t.parentElement,a=s.description??s.id;!0===this.useInitialSelectedStatistics&&(this.useInitialSelectedStatistics=!1),this.valueMap.set(a,i),this.updateValue(),this.analysisSummaryFieldsChange.emit()},this.closeField=e=>{const t=e.target.parentElement.id;if(this.selection.delete(t),this.removeFromValueMap(t),void 0!==this.value){let e;e=!0===this.storeAsGPValue?this.value.filter((e=>e.onStatisticField.name!==t)):"string"===this.valueFormat?this.value.filter((e=>e.split(" ")[0]!==t)):this.value.filter((e=>e.onStatisticField!==t)),this.value=[...e],this.analysisSummaryFieldsChange.emit()}this.validate()},this.validate=()=>{this.errorMessage=void 0;const e=!this.required||this.valueMap.size>0,t=Array.from(this.valueMap.values()).every((e=>e.length>0));!this.required||e&&t||(this.errorMessage=this.validationParams?.requiredMessage??this.strings.isRequired)},this.renderErrorMessage=()=>void 0!==this.errorMessage?(0,s.h)("calcite-input-message",{status:a.Z.INVALID,scale:a.c.Scale,icon:"exclamationMarkTriangle"},this.errorMessage):null,this.renderFields=()=>{const e={badInputMessage:this.strings.statisticNotSelected,...this.validationParams};return(0,s.h)("calcite-list",{label:"",disabled:this.readOnly},[...this.valueMap.keys()].map((t=>{const i=this.layer?.fieldsIndex?.get(t),a=i?.alias??t,l=this.valueMap.get(t),{statistics:n,labels:r}=this.getSupportedStatisticTypes(i?.type??"integer");return(0,s.h)("calcite-list-item",{class:ge,label:a,key:t,id:t,description:i?.name??t},(0,s.h)("analysis-chip-group",{slot:"content-bottom",onAnalysisChipGroupSelectionChange:this.onAnalysisChipGroupSelectionChange,required:!0,scale:"s",class:ye,chipLabel:r,value:n,label:this.strings.statistic,selectionMode:"multi",selectAllEnabled:!0!==this.readOnly,initialChipSelection:this.useInitialSelectedStatistics?l:[],selectedChips:l,validationParams:e}),!0!==this.readOnly&&(0,s.h)("calcite-action",{text:"",slot:"actions-end",icon:"trash",appearance:"transparent",onClick:this.closeField}))})))}}valueChange(){this.valueFormat=void 0!==this.value&&this.value.length>0&&"object"==typeof this.value[0]?"object":this.valueFormat??"string",void 0!==this.value&&0===this.valueMap.size&&void 0!==this.valueFormat&&(this.selection=new Set,this.value.forEach((e=>{let t,i;if("string"===this.valueFormat){const s=e.split(" ");t=s[0],i=s[1]}else{const s=e;t="string"==typeof s.onStatisticField?s.onStatisticField:s.onStatisticField.name,i=s.statisticType}this.updateValueMap(t,i),this.selection.add(t)})))}async layerChange(e,t){if(!0!==this.readOnly&&void 0!==e&&t?.id!==e.id){this.abortController?.abort();try{this.abortController=new AbortController;const e=(await(0,a.aa)(this.layer,this.usePopupTemplatesInfo,this.abortController.signal)).filter((e=>this.selection.has(e.name))).map((e=>e.name));this.selection=new Set(e);const t=new Map;this.valueMap.forEach(((e,i)=>{if(this.selection.has(i)){const s=this.layer.fieldsIndex.get(i),{statistics:a}=this.getSupportedStatisticTypes(s.type),l=a.filter((t=>e.includes(t)));l.length>0?t.set(i,l):this.selection.delete(i)}})),this.useInitialSelectedStatistics=!0,(this.valueMap.size!==t.size||[...this.valueMap.entries()].some((([e,i])=>t.get(e).length!==i.length)))&&(this.valueMap=t,this.updateValue(),this.analysisSummaryFieldsChange.emit())}catch(e){!1===(0,a.ai)(e)&&(this.errorMessage=this.strings.fieldLoadingErrorText)}}this.closePopover()}disconnectedCallback(){this.abortController?.abort(),this.closePopover()}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)("."))),void 0!==this.value&&(this.valueChange(),this.useInitialSelectedStatistics=!0),await this.layerChange(this.layer)}componentShouldUpdate(){return this.layer?.loaded}async checkValidity(){return!0===this.readOnly?Promise.resolve(!0):(this.validate(),Promise.resolve(void 0===this.errorMessage))}updateValue(){const e=[];this.valueMap.forEach(((t,i)=>{t.forEach((t=>{let s;if(!0===this.storeAsGPValue){const s={onStatisticField:(0,a.aA)(this.layer,i),statisticType:t};e.push(s)}else"string"===this.valueFormat?(s=`${i} ${t}`,e.push(s)):(s={onStatisticField:i,statisticType:t},e.push(s))}))})),this.value=[...e]}removeFromValueMap(e){const t=this.valueMap;t.delete(e),this.valueMap=new Map(t)}getSupportedStatisticTypes(e){let t=[],i=[];return!0===(0,a.aB)(e)?(t=[l.S.Sum,l.S.Minimum,l.S.Maximum,l.S.Mean,l.S.StdDev],i=[this.strings.sum,this.strings.min,this.strings.max,this.strings.mean,this.strings.standardDeviation]):"date"===e&&!0===this.allowDateType?(t=[l.S.Minimum,l.S.Maximum],i=[this.strings.min,this.strings.max]):"string"===e&&!0===this.allowStringType?(t=[l.S.Any,l.S.Count],i=[this.strings.any,this.strings.count]):("date-only"===e&&!0===this.allowDateOnlyType||"time-only"===e&&!0===this.allowTimeOnlyType)&&(t=[l.S.Minimum,l.S.Maximum],i=[this.strings.min,this.strings.max]),!0===this.alwaysShowAnyCountStatistics&&"string"!==e?(t=[...t,l.S.Any,l.S.Count],i=[...i,this.strings.any,this.strings.count]):!0===this.showFirstLastStatistics&&(t=[...t,l.S.First,l.S.Last],i=[...i,this.strings.first,this.strings.last]),{statistics:t,labels:i}}render(){return(0,s.h)(s.H,{key:"cc0ce472e26656935b1b39f0c5070743f0842de3"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,void 0!==this.valueMap&&this.valueMap.size>0&&this.renderFields(),(0,s.h)("calcite-button",{key:"288140f7b23509063f5cca03ee052737a2c8bbc4",appearance:"outline",kind:"neutral","icon-start":"plus",width:"full",scale:a.c.Scale,disabled:this.readOnly,ref:e=>{this.fieldButton=e},onClick:this.popoverAction},this.strings.field),this.renderErrorMessage())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{value:["valueChange"],layer:["layerChange"],usePopupTemplatesInfo:["layerChange"]}}};ve.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;margin-bottom:var(--analysis-half-spacing)}.label{margin-top:0}.calcite-chip{margin:var(--analysis-quarter-spacing)}.calcite-list-item{border:2px solid var(--calcite-color-border-1);margin-bottom:var(--analysis-half-spacing);margin-top:var(--analysis-quarter-spacing);border-radius:var(--analysis-quarter-spacing);overflow:hidden;--calcite-font-size--1:var(--calcite-font-size--2)}.calcite-switch{border:2px solid var(--calcite-color-border-1);margin-bottom:var(--analysis-quarter-spacing);margin-top:var(--analysis-quarter-spacing);padding:var(--analysis-quarter-spacing);padding-top:var(--analysis-three-quarter-spacing);border-radius:var(--analysis-quarter-spacing);overflow:hidden}";const fe=class{constructor(e){(0,s.r)(this,e),this.variableNodeSelection=(0,s.c)(this,"variableNodeSelection",7),this.modelVariables=[],this.selectionMode="single",this.open=!1,this.selectedNodes=[],this.dataNodeList=()=>{const e=[],t=o.D[this.toolParam.dataType]??"rounded-rectangle";return this.modelVariables.forEach((i=>{i.dataType===this.toolParam.dataType&&e.push((0,s.h)("calcite-list-item",{iconEnd:t,label:`${i.name}`,description:(0,a.t)(this.strings.nodeValue,{val:i.value}),value:i.id,onClick:this.onDataNodeClick,selected:void 0!==this.selectedNodes&&this.selectedNodes.includes(i.id),scale:"s"}))})),e},this.onDataNodeClick=()=>{this.variableNodeSelection.emit(this.listElement?.selectedItems?.map((e=>e.value)))},this.handleFilter=e=>{const t=e.target;this.showEmpty=0===t.filteredData.length}}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.G)(this.hostElement,(0,s.g)(".")));const e=this.toolParam.value?.variable;void 0!==e&&this.selectedNodes.push(e),this.showEmpty=void 0===this.modelVariables||0===this.modelVariables.length}render(){return(0,s.h)(s.H,{key:"a6327e8918d1e62638e0dc452832695f8e8d80d2",dir:this.dir},(0,s.h)("calcite-popover",{key:"8f0ceb7cdbfd30b3c3b7538d75ede36ac61d9f86",autoClose:!0,closable:!0,heading:this.strings.header,referenceElement:this.referenceElement,open:this.open,label:"",focusTrapDisabled:!0,pointerDisabled:!0,placement:"leading",onCalcitePopoverClose:()=>(0,a.V)(this.hostElement)},(0,s.h)("calcite-panel",{key:"1fcd3e09b8fd422d2179387061bb947bbd35cf3f"},(0,s.h)("calcite-list",{key:"f7ce13b62ab8a087afc4ec813e17ee4d29c25188",label:"",selectionMode:"multi"===this.selectionMode?"multiple":"single",filterEnabled:!0,filterPlaceholder:this.strings.search,onCalciteListFilter:this.handleFilter,scale:"s",ref:e=>{this.listElement=e}},this.showEmpty&&(0,s.h)("div",{key:"bafd1b68d083cd325f5c14b036a16ce06ea9b839",class:"empty-entrant"},this.strings.noFound),this.dataNodeList()))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}};fe.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host .empty-entrant{margin:7px}:host calcite-panel{max-width:22rem}";const be=class{constructor(e){(0,s.r)(this,e),this.analysisNumberInputChange=(0,s.c)(this,"analysisNumberInputChange",7),this.showVariableNodesClick=(0,s.c)(this,"showVariableNodesClick",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.clearVariableById=(0,s.c)(this,"clearVariableById",7),this.doCalciteInputChangeOnCommit=!1,this.readOnly=!1,this.hideHelp=!1,this.supportsVariables=!1,this.renderVariableDisplay=e=>{const t=this.modelVariables?.find((t=>t.id===e));return(0,s.h)("variable-node-display",{variableNode:t,onClearVariable:e=>!0!==this.readOnly&&this.clearVariableById.emit(e.detail),onChangeNode:()=>!0!==this.readOnly&&this.showVariableNodesClick.emit(),readOnly:this.readOnly})},this.renderSingleInput=()=>void 0===this.choiceList?this.renderInput():this.renderCombobox(),this.renderInput=()=>{const e=void 0!==this.errorMessage?a.Z.INVALID:(0,a.D)(this.validationParams?.type),t=this.doCalciteInputChangeOnCommit?{onCalciteInputChange:this.inputChanged}:{onCalciteInputInput:this.inputChanged};return(0,s.h)("calcite-input",{type:"number",value:(0,a.aC)(this.value),status:!1===this.readOnly?e:a.Z.IDLE,placeholder:!1===this.readOnly?this.placeholderText??this.strings.inputPlaceholderText:void 0,step:this.isFloatType?"any":1,readOnly:this.readOnly,required:this.required||void 0,min:this.min,max:this.max,scale:this.scale??a.c.Scale,groupSeparator:!0,...t})},this.renderCombobox=()=>{const e=this.choiceList?.map((e=>this.buildComboBoxItem((0,a.aC)(e),e===this.value)));return(0,s.h)("calcite-combobox",{scale:this.scale??a.c.Scale,label:this.label??this.strings.comboboxLabel,selectionMode:"single",placeholder:!1===this.readOnly?this.placeholderText??this.strings.comboboxPlaceholderText:void 0,clearDisabled:!0,disabled:this.readOnly},e)},this.buildComboBoxItem=(e,t)=>(0,s.h)("calcite-combobox-item",{key:e,value:e,textLabel:e,selected:t,onCalciteComboboxItemChange:this.comboboxItemChanged}),this.renderAnalysisMultiInput=()=>{const e=this.value?.map((e=>(0,a.aC)(e))),t=this.choiceList?.map((e=>(0,a.aC)(e))),{isFloatType:i,min:l,max:n,excludeMinValue:r,excludeMaxValue:o,minValues:h,maxValues:c}=this,d={isFloatType:i,min:l,max:n,excludeMinValue:r,excludeMaxValue:o,minValues:h,maxValues:c};return(0,s.h)("analysis-multiple-input",{dataType:"number",value:e,choiceList:t,placeholderText:this.placeholderText,required:this.required,validationOptions:d,validationParams:this.validationParams,ref:e=>{this.multiInputElement=e},onAnalysisMultipleInputChange:e=>{this.value=e.detail.map((e=>(0,a.aD)(e))),this.analysisNumberInputChange.emit()},readOnly:this.readOnly})},this.inputChanged=e=>{const t=e.currentTarget?.value;this.value=(0,a.aD)(t),this.analysisNumberInputChange.emit(),this.validate()},this.comboboxItemChanged=e=>{if(this.isMultiSelect)return;const t=e.target,i=t?.value,s=(0,a.aD)(i);this.value!==s&&t?.selected&&(this.value=s,this.analysisNumberInputChange.emit(),this.validate())}}onValueChange(){this.maxOfValues=Array.isArray(this.value)?Math.max(...this.value):this.value}onRequiredChange(){this.validate()}async onValidationChange(){void 0!==this.multiInputElement&&(this.multiInputElement.validationOptions=this.formatValidationOptions()),this.errorMessage=void 0,!1===(0,a.d)(this.value)&&await this.validate()}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)("."))),(0,a.d)(this.value)||this.onValueChange()}get isFloatType(){return void 0===this.numberType||"float"===this.numberType}get isMultiSelect(){return"multi"===this.selectionMode}get formatOptions(){return{min:`${this.min??Number.MIN_SAFE_INTEGER}`,max:`${this.max??Number.MAX_SAFE_INTEGER}`}}render(){const e=!0===(0,a.M)(this.value)?this.value?.variable:void 0,t=void 0!==this.errorMessage,i=(0,a.z)(this.validationParams),l=!1===(0,a.d)(i)||!0===t,n=t?a.Z.INVALID:(0,a.D)(this.validationParams?.type);return(0,s.h)(s.H,{key:"fca7b3bb4ae24afb74a475f10308a802145097b7"},(0,s.h)("calcite-label",{key:"bb57aded2d34f249fe7915a1d0282c29cc9b2f23",class:"label",scale:this.scale??a.c.Scale},""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),supportsVariables:this.supportsVariables,onShowVariableActionClick:()=>!0!==this.readOnly&&this.showVariableNodesClick.emit(),readOnly:this.readOnly,hideHelp:this.hideHelp}):null,void 0!==e?this.renderVariableDisplay(e):this.isMultiSelect?this.renderAnalysisMultiInput():this.renderSingleInput(),!1===this.readOnly&&(0,s.h)("calcite-input-message",{key:"8e02985f3143a4c5d346ef482c6d0257076f0d97",status:n,scale:a.c.Scale,hidden:!l||this.isMultiSelect,icon:"exclamationMarkTriangle"},this.errorMessage??i)))}async checkValidity(){await this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}async validate(){if(this.isMultiSelect)void 0!==this.multiInputElement&&(this.multiInputElement.errorMessage=void 0),await(this.multiInputElement?.checkValidity()),this.errorMessage=this.multiInputElement?.errorMessage;else{let e;const t=!0===(0,a.M)(this.value)?this.value?.variable:void 0;e=void 0!==t?this.modelVariables?.find((e=>e.id===t))?.value??0:this.value;const i=(0,l.k)(e,this.formatValidationOptions()),s=void 0!==i?(0,a.t)(this.strings[i],this.formatOptions):void 0;this.errorMessage=s}}formatValidationOptions(){return{required:this.required,isFloatType:this.isFloatType,excludeMaxValue:this.excludeMaxValue,excludeMinValue:this.excludeMinValue,max:this.max??Number.MAX_SAFE_INTEGER,min:this.min??Number.MIN_SAFE_INTEGER}}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{value:["onValueChange"],required:["onRequiredChange"],min:["onValidationChange"],max:["onValidationChange"],excludeMaxValue:["onValidationChange"],excludeMinValue:["onValidationChange"],numberType:["onValidationChange"]}}};be.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;width:var(--analysis-component-default-width);--calcite-color-border-input:var(--analysis-ui-border-input)}:host([hidden]){display:none}.label{width:var(--analysis-component-default-width)}";const Ce="dataset-input",xe={border:`${Ce}__border`,container:`${Ce}__container`,listItem:`${Ce}__list-item`},we=class{constructor(e){(0,s.r)(this,e),this.analysisDatasetInputChange=(0,s.c)(this,"analysisDatasetInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.required=!1,this.hideHelp=!1,this.renderInitialMode=()=>(0,s.h)("section",null,(0,s.h)("calcite-label",{scale:a.c.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}):null,this.renderAddButton(),this.renderErrorMessage())),this.renderListMode=()=>{const e=this.valueArray?.map((e=>(0,s.h)("calcite-list-item",{class:xe.listItem,key:e.id,value:e.id,label:e.name,description:e.description},(0,s.h)("calcite-action",{text:this.strings.remove,slot:"actions-end",label:this.strings.remove,appearance:"transparent",icon:"x",onClick:()=>this.onRemoveDataset(e.id)}))));return(0,s.h)("section",{class:xe.container},(0,s.h)("calcite-label",{scale:a.c.Scale},(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit(),hideHelp:this.hideHelp}),(0,s.h)("calcite-list",{class:xe.border,label:"",onMouseOver:this.onListMouseOver,onMouseOut:this.onListMouseOut,onCalciteListChange:this.onListItemSelected},e),this.renderErrorMessage()),this.isMultiSelect&&this.renderAddButton())},this.renderErrorMessage=()=>{const e=void 0!==this.errorMessage;return(0,s.h)("calcite-input-message",{hidden:!e,icon:"exclamationMarkTriangle",status:a.Z.INVALID,scale:a.c.Scale},this.errorMessage)},this.renderAddButton=()=>(0,s.h)("calcite-button",{appearance:"outline",kind:"neutral","icon-start":"plus",onClick:this.onAddButtonClicked,width:"full",scale:a.c.Scale},this.strings.dataset),this.onAddButtonClicked=e=>{this.createDatasetInputPopover(e.target)},this.onListMouseOver=e=>{const t=e.target;"calcite-list-item"===t?.localName&&(void 0===this.replaceTooltip&&(this.replaceTooltip=document.createElement("calcite-tooltip"),this.replaceTooltip.placement="bottom",this.replaceTooltip.innerText=this.strings.replaceDataset),this.replaceTooltip.referenceElement=t,(0,l.b)(document,this.replaceTooltip))},this.onListMouseOut=()=>{(0,l.r)(this.replaceTooltip)},this.onListItemSelected=e=>{this.createDatasetInputPopover(e.target)},this.onRemoveDataset=e=>{const t=this.valueArray?.filter((t=>t.id!==e));this.updateValueFromArray(t)},this.createDatasetInputPopover=e=>{void 0===this.datasetInputPopover&&(this.datasetInputPopover=document.createElement("analysis-dataset-input-popover"),this.datasetInputPopover.addEventListener("analysisDatasetInputPopoverClose",this.onDatasetPopoverClose),this.datasetInputPopover.addEventListener("analysisDatasetInputPopoverSelectionChange",this.onDatasetInputPopoverChange)),this.datasetInputPopover.selectedDatasetIds=this.valueArray?.map((e=>e.id)),this.datasetInputPopover.selectionMode=this.isMultiSelect?"multiple":"single",this.datasetInputPopover.analysisDatasets=this.analysisDatasets,this.datasetInputPopover.placement="leading",this.datasetInputPopover.referenceElement=e.parentElement??e,(0,l.b)(document,this.datasetInputPopover)},this.onDatasetPopoverClose=()=>{(0,l.r)(this.datasetInputPopover),this.datasetInputPopover=void 0,this.validate()},this.onDatasetInputPopoverChange=e=>{const t=e.detail.selectedDatasetIds,i=new Set(t),s=this.analysisDatasets?.filter((e=>i.has(e.id)));this.updateValueFromArray(s)},this.updateValueFromArray=e=>{if(this.isMultiSelect)this.value=e;else{const t=void 0===e||e.length<1;this.value=t?void 0:e[0]}this.analysisDatasetInputChange.emit()},this.validate=()=>{this.required&&!this.hasValue?this.errorMessage=(0,a.t)(this.strings.isRequired,{label:this.label}):this.errorMessage=void 0}}onValueChange(){this.validate()}get isMultiSelect(){return"multi"===this.selectionMode}get hasValue(){return this.isMultiSelect?void 0!==this.value&&this.value.length>0:void 0!==this.value}get valueArray(){let e;return void 0!==this.value&&(e=this.isMultiSelect?this.value:[this.value]),e}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)(".")))}disconnectedCallback(){(0,l.r)(this.datasetInputPopover),(0,l.r)(this.replaceTooltip)}render(){return(0,s.h)(s.H,{key:"9f911971b1e85ba9365f8e06ba657c6912a8006c"},this.hasValue?this.renderListMode():this.renderInitialMode())}async checkValidity(){this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{value:["onValueChange"]}}};we.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;width:var(--analysis-component-default-width)}.dataset-input__border{border:1px solid var(--analysis-ui-border-input)}.dataset-input__container{margin-bottom:var(--analysis-half-spacing)}.dataset-input__list-item{--calcite-font-size--1:var(--calcite-font-size--2)}";const Ie="chip-container",Le="custom-input-label",ke=class{constructor(e){(0,s.r)(this,e),this.analysisMultipleInputChange=(0,s.c)(this,"analysisMultipleInputChange",7),this.dataType="number",this.scale=a.c.Scale,this.readOnly=!1,this.renderCombobox=()=>{const{choiceList:e,errorMessage:t,value:i,scale:l,placeholderText:n}=this,r=void 0!==this.errorMessage,o=e?.map((e=>{const t=void 0!==i&&i.includes(e);return this.buildComboBoxItem(e,t)})),h=(0,a.z)(this.validationParams),c=!1===(0,a.d)(h)||!0===r,d=r?a.Z.INVALID:(0,a.D)(this.validationParams?.type);return(0,s.h)("calcite-label",{scale:l},(0,s.h)("calcite-combobox",{label:this.label,scale:l,selectionMode:"multiple",placeholder:!1===this.readOnly?n??this.strings.defaultPlaceholder:void 0,onCalciteComboboxChange:this.handleComboboxChange,disabled:this.readOnly},o),!1===this.readOnly&&(0,s.h)("calcite-input-message",{status:d,scale:a.c.Scale,hidden:!c,icon:"exclamationMarkTriangle"},t??h))},this.buildComboBoxItem=(e,t)=>(0,s.h)("calcite-combobox-item",{key:e,value:e,textLabel:e,selected:t}),this.buildChip=e=>(0,s.h)("calcite-chip",{label:e,closable:!0,scale:a.c.Scale,value:e,key:e,onCalciteChipClose:this.handleChipClose,messageOverrides:{dismissLabel:this.strings.remove},disabled:this.readOnly},(0,a.al)(e)),this.handleComboboxChange=e=>{const t=e.target?.selectedItems,i=t?.map((e=>e.value));Array.isArray(i)&&0!==i.length||!0!==this.required?(this.value=i,this.analysisMultipleInputChange.emit(this.value),this.errorMessage=this.validate(this.value),this.checkUnderMinValues()):this.errorMessage=this.strings.requiredInputMessage},this.handleNewChip=()=>{if(this.isAtMaxValues)return;const e=this.inputElement?.value;if(void 0!==e&&""!==e&&(this.errorMessage=this.validate([e]),this.isValid)){const t=new Set([...this.value??[],e]);this.value=Array.from(t),this.analysisMultipleInputChange.emit(this.value),void 0!==this.inputElement&&(this.inputElement.value=""),this.errorMessage=this.validate(this.value),this.checkUnderMinValues()}},this.handleKeyDown=e=>{"Tab"===e?.key&&""!==this.inputElement?.value&&(e.preventDefault(),this.handleNewChip())},this.handleChipClose=async e=>{const t=e?.target,i=t?.value,s=t?.previousElementSibling,a=this.value.filter((e=>e!==i));this.value=a,this.analysisMultipleInputChange.emit(this.value),this.errorMessage=this.validate(this.value),this.checkUnderMinValues(),await(s?.setFocus())},this.checkUnderMinValues=()=>{const e=this.validationOptions?.minValues;void 0!==e&&(this.errorMessage=this.isUnderMinValues?(0,a.t)(this.strings.minValuesMessage,{minValues:(0,a.al)(e)}):this.errorMessage)}}get isValid(){return void 0===this.errorMessage||""===this.errorMessage}get isOverMaxValues(){const e=this.validationOptions?.maxValues??Number.MAX_SAFE_INTEGER;return this.value?.length>e}get isAtMaxValues(){const e=this.validationOptions?.maxValues??Number.MAX_SAFE_INTEGER;return this.value?.length===e}get isUnderMinValues(){const e=this.validationOptions?.minValues??0;return this.value?.length<e}async checkValidity(){this.isOverMaxValues&&(this.errorMessage=(0,a.t)(this.strings.maxValuesMessage,{maxValues:(0,a.al)(this.validationOptions?.maxValues)})),0!==this.value?.length&&this.isUnderMinValues&&(this.errorMessage=(0,a.t)(this.strings.minValuesMessage,{minValues:(0,a.al)(this.validationOptions?.minValues)}));const e="informative"!==this.validationParams?.type;return this.errorMessage=this.validate(this.value)??this.errorMessage??(e?this.validationParams?.message:void 0),Promise.resolve(this.isValid)}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)(".")))}render(){return void 0!==this.choiceList&&this.choiceList.length>0?this.renderCombobox():this.renderNoChoiceList()}renderNoChoiceList(){const e=void 0!==this.errorMessage;let t,i=!1;void 0!==this.validationOptions?.maxValues&&(i=!e&&this.isAtMaxValues,t=(0,a.t)(this.strings.maxValuesMessage,{maxValues:(0,a.al)(this.validationOptions.maxValues)}));const l=(0,a.z)(this.validationParams),n=!0===e||!0===i,r=!1===(0,a.d)(l)||n,o=n?a.Z.INVALID:(0,a.D)(this.validationParams?.type),h=n?a.Z.INVALID:(0,a.d)(this.validationParams)?a.Z.IDLE:(0,a.D)(this.validationParams?.type);return(0,s.h)(s.H,null,(0,s.h)("calcite-label",{scale:this.scale,class:Le},this.label,(0,s.h)("calcite-input",{disabled:this.isAtMaxValues,type:this.dataType,placeholder:!1===this.readOnly?this.placeholderText??this.strings.defaultPlaceholder:void 0,scale:this.scale,status:h,numberButtonType:"none",max:this.validationOptions?.max,min:this.validationOptions?.min,step:!0===this.validationOptions?.isFloatType?"any":1,onCalciteInputChange:this.handleNewChip,onKeyDown:this.handleKeyDown,ref:e=>this.inputElement=e,readOnly:this.readOnly},(0,s.h)("calcite-button",{disabled:this.isAtMaxValues||this.readOnly,scale:this.scale,slot:"action",onClick:this.handleNewChip,"icon-start":"plus"},this.strings.add)),!1===this.readOnly&&(0,s.h)("calcite-input-message",{class:Le,status:o,scale:a.c.Scale,hidden:!r,icon:"exclamationMarkTriangle"},this.errorMessage??t??l)),(0,s.h)("div",{class:Ie},this.value?.map((e=>this.buildChip(e)))))}validate(e=this.value){let t;if(!0!==this.required||void 0!==e&&0!==e?.length)if("number"===this.dataType){const i={required:!1,...this.validationOptions},s=e=>(0,l.k)((0,a.aD)(e),i),n=e?.map(s).find((e=>void 0!==e)),{min:r,max:o}=i,h={min:(0,a.al)(r),max:(0,a.al)(o)};t=void 0!==n?(0,a.t)(this.strings[n],h):void 0}else t=void 0;else t=this.strings.requiredInputMessage;return t}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}};ke.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{--calcite-color-border-input:var(--analysis-ui-border-input)}.chip-container{display:flex;flex-wrap:wrap;gap:0.25rem}.custom-input-label{margin-bottom:var(--analysis-quarter-spacing)/2}";const Ee=class{constructor(e){(0,s.r)(this,e),this.analysisTreeValueChange=(0,s.c)(this,"analysisTreeValueChange",7),this.data={},this.renderedTree=[],this.treeItemsOpen=new Set,this.handleMutations=e=>{e.forEach((e=>{if("attributes"===e.type&&"expanded"===e.attributeName){const t=e.target;if("key"in t.dataset&&void 0!==t.dataset.key){this.treeItemsOpen.has(t.dataset.key)!==t.expanded&&this.toggleTreeItem(t.dataset.key)}}}))},this.toggleTreeItem=e=>{this.treeItemsOpen.has(e)?this.treeItemsOpen.delete(e):this.treeItemsOpen.add(e),this.buildJSXTree()}}onDataChange(){this.setupComponent()}componentWillLoad(){this.setupComponent()}componentDidLoad(){this.setupObserver()}disconnectedCallback(){this.observer?.disconnect()}setupComponent(){this.treeItemsOpen.clear(),this.buildJSXTree()}setupObserver(){this.observer=new MutationObserver(this.handleMutations);const e=this.hostElement.shadowRoot??this.hostElement;this.observer.observe(e,{attributes:!0,subtree:!0,attributeFilter:["expanded"]})}buildJSXTree(){const e=t=>{const i=[];for(const s in t){const a=t[s];let l;"object"==typeof a&&(l=this.treeItemsOpen.has(s)?e(a):[]);const n="object"==typeof a?s:a;i.push(this.createTreeItem(s,n,l))}return i};this.renderedTree=e(this.data)}createTreeItem(e,t,i){return(0,s.h)("calcite-tree-item",{key:`${e}-item`,"data-key":e,selected:this.value===e,"aria-selected":this.value===e,expanded:this.treeItemsOpen.has(e),"aria-expanded":this.treeItemsOpen.has(e)},t,void 0!==i&&(0,s.h)("calcite-tree",{key:`${e}-child-tree`,slot:"children"},i))}handleTreeSelect(e){const t=e.target,i=t?.selectedItems[0]?.dataset.key;void 0!==i&&(this.value=i,this.analysisTreeValueChange.emit())}render(){return(0,s.h)(s.H,{key:"fb5e64c5d6807a4fbbfda16f276470f94ba1d63c"},(0,s.h)("div",{key:"5753525cc9e8297146f17eee094d35f5eabf206f"},(0,s.h)("calcite-tree",{key:"base-tree",scale:a.c.Scale,onCalciteTreeSelect:e=>this.handleTreeSelect(e)},this.renderedTree)))}get hostElement(){return(0,s.a)(this)}static get watchers(){return{data:["onDataChange"]}}};Ee.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{overflow-y:auto;overflow-x:hidden;scroll-behavior:smooth;height:100%;width:100%}";const Se="no-matches-found-msg",Me=class{constructor(e){(0,s.r)(this,e),this.analysisSpatialReferenceValueChange=(0,s.c)(this,"analysisSpatialReferenceValueChange",7),this.analysisSpatialReferenceSelectorDismissed=(0,s.c)(this,"analysisSpatialReferenceSelectorDismissed",7),this.autoFilterToDefault=!1,this.defaultWkid=4326,this.hideDone=!1,this.searchText="",this.performantFilterSpatialReferences=(0,r.l)((e=>{this.updateSearchResults(e)}),250,{leading:!1,trailing:!0})}onAutoFilterToDefaultChange(){this.autoFilterSpatialReferences()}onDefaultWkidChange(){this.autoFilterSpatialReferences()}async getSRDescription(){return void 0!==this.value?.latestWkid?Promise.resolve((0,a.aE)(this.value?.latestWkid)):Promise.resolve(void 0)}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.value=this.value??{latestWkid:this.defaultWkid};const e=this.filterSrCategories(a.aF);this.visibleSrCategories=this.translateSrCategories(e)}componentDidLoad(){this.autoFilterSpatialReferences()}translateSrCategories(e){const t={};return this.recursiveTranslate(e,t),t}recursiveTranslate(e,t){Object.keys(e).forEach((i=>{const s=this.getTranslatedKey(i);"object"==typeof e[i]?(t[s]={},this.recursiveTranslate(e[i],t[s])):t[s]=e[i]}))}getTranslatedKey(e){return e in this.strings?this.strings[e]:e}filterSrCategories(e){const t={};return Object.keys(e).forEach((i=>{void 0!==this.hideCategories&&!1!==this.hideCategories?.includes(i)||("object"==typeof e[i]?t[i]=this.filterSrCategories(e[i]):t[i]=e[i])})),t}setSpatialRef(e){this.value={latestWkid:Number(e)},this.analysisSpatialReferenceValueChange.emit(this.value)}inputKeyDown(e){"Enter"===e.key&&this.selectFirstChild(!0)}selectFirstChild(e){const t=this.treeElement,i=t?.shadowRoot?.querySelector("calcite-tree-item:not([has-children]):not([data-key='placeholder'])")||void 0;void 0!==t&&void 0!==i&&(i.selected=!0,this.setSpatialRef(i.dataset.key??""),e&&i.focus())}updateSearchResults(e){this.searchResults=(0,a.aG)(e)}searchSpatialReferences(e){null!==e.target&&this.setSearchText(e.target.value??"")}setSearchText(e){this.searchText=e,this.searchText.length>1?this.performantFilterSpatialReferences(this.searchText):this.searchResults=void 0}autoFilterSpatialReferences(){this.autoFilterToDefault&&!1===(0,a.d)(this.defaultWkid)&&void 0!==this.searchInput&&(this.searchInput.value=this.defaultWkid.toString(),this.setSearchText(this.searchInput.value))}render(){const e=(0,a.t)(this.strings.noMatchesFound,{searchTerm:this.searchText??""});return(0,s.h)(s.H,{key:"86b001d167b7291c02cb229f2c9e35d4b0067564",dir:this.dir},(0,s.h)("calcite-panel",{key:"e771ea085b870902ba6bb99f8829df17be79e4fe",closable:!1,closed:!1,onCalcitePanelClose:()=>this.analysisSpatialReferenceSelectorDismissed.emit(this.value)},(0,s.h)("calcite-input",{key:"1a1cb1e8abd4ecb3038071cc13b72779912e3cd5",onCalciteInputInput:e=>this.searchSpatialReferences(e),onKeyDown:e=>this.inputKeyDown(e),placeholder:this.strings.searchPlaceholder,scale:a.c.Scale,type:"search",icon:!0,autofocus:!0,ref:e=>this.searchInput=e}),this.searchText.length>1&&(0,a.d)(this.searchResults)&&(0,s.h)("p",{key:"2c0e623afb538eb3dbbc7dac63c6ec3ab149e9ba",class:Se},e),(0,s.h)("analysis-tree",{key:"tree",ref:e=>this.treeElement=e,data:void 0!==this.searchResults&&this.searchText.length>0?this.searchResults:this.visibleSrCategories,value:this.value&&`${this.value?.latestWkid}`,onAnalysisTreeValueChange:()=>{this.setSpatialRef(this.treeElement.value)}}),this.hideDone?void 0:(0,s.h)("calcite-button",{appearance:"solid",scale:a.c.Scale,width:"full",slot:"footer-actions",onClick:()=>this.analysisSpatialReferenceSelectorDismissed.emit(this.value)},this.strings.done)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{autoFilterToDefault:["onAutoFilterToDefaultChange"],defaultWkid:["onDefaultWkidChange"]}}};Me.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{overflow-y:hidden;display:flex;flex-direction:column;--calcite-color-border-input:var(--analysis-ui-border-input);height:var(--analysis-popover-content-height);min-width:20rem;max-width:27rem}.no-matches-found-msg{margin:var(--analysis-half-spacing);font-size:var(--calcite-font-size--2)}analysis-tree{flex:1}";const Te="select-button",Fe=class{constructor(e){(0,s.r)(this,e),this.analysisSpatialReferenceInputChange=(0,s.c)(this,"analysisSpatialReferenceInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.required=!1,this.createPopover=e=>{this.spatialReferencePopover&&(this.spatialReferencePopover.remove(),this.spatialReferencePopover=void 0),this.spatialReferencePopover=document.createElement("calcite-popover");const t={autoClose:!0,dir:this.dir,focusTrapDisabled:!0,heading:this.strings.browseCoordinateSystems,closable:!0,open:!0,referenceElement:e.target};Object.assign(this.spatialReferencePopover,t),this.spatialReferencePopover.addEventListener("calcitePopoverClose",this.handleSpatialReferenceClose);const i=document.createElement("analysis-spatial-reference-selector");i.hideCategories=this.hideCategories,i.value=this.value,i.addEventListener("analysisSpatialReferenceValueChange",this.handleSpatialReferenceChange),i.addEventListener("analysisSpatialReferenceSelectorDismissed",this.handleSpatialReferenceClose),this.spatialReferencePopover.append(i),document.body.append(this.spatialReferencePopover),setTimeout((()=>requestAnimationFrame((()=>{this.spatialReferencePopover.open=!0,this.spatialReferencePopover?.setFocus()}))),1)},this.validate=()=>(this.required&&void 0===this.value?this.errorMessage=(0,a.t)(this.strings.isRequired,{label:this.label}):this.errorMessage=void 0,void 0===this.errorMessage),this.handleSpatialReferenceChange=e=>{this.value={latestWkid:e.detail.latestWkid,wkid:e.detail.latestWkid},this.analysisSpatialReferenceInputChange.emit(this.value)},this.handleSpatialReferenceClose=()=>{this.spatialReferencePopover?.remove(),this.spatialReferencePopover=void 0,this.validate()}}onValueChange(){var e,t;void 0!==this.value&&((e=this.value).wkid??(e.wkid=this.value.latestWkid),(t=this.value).latestWkid??(t.latestWkid=this.value.wkid)),this.validate()}async componentWillLoad(){var e,t;({strings:this.strings,dir:this.dir}=await(0,a.G)(this.hostElement,(0,s.g)("."))),void 0!==this.value&&((e=this.value).wkid??(e.wkid=this.value.latestWkid),(t=this.value).latestWkid??(t.latestWkid=this.value.wkid))}disconnectedCallback(){this.spatialReferencePopover?.remove()}async checkValidity(){this.validate();const e=void 0===this.errorMessage||""===this.errorMessage;return Promise.resolve(e)}render(){const e=(0,a.d)(this.value)?this.strings.browseCoordinateSystems:(0,a.aE)(this.value?.latestWkid)??this.strings.browseCoordinateSystems;return(0,s.h)(s.H,{key:"6e7d9e1d043824ea5d8e435e976894f858304df9"},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-button",{key:"6fed31a0184bce918164d9297f1f27701b4ebd8a",width:"full",appearance:"outline",kind:"neutral","icon-end":"chevron-down",alignment:"icon-end-space-between",onClick:this.createPopover,class:Te,scale:a.c.Scale},e),(0,s.h)("calcite-input-message",{key:"885eac45fd984b5cfe35706c8e102f1f75f2af81",status:"invalid",scale:a.c.Scale,hidden:void 0===this.errorMessage,icon:"exclamationMarkTriangle"},this.errorMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{value:["onValueChange"]}}};Fe.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;flex-direction:column;width:var(--analysis-component-default-width)}.select-button{margin-bottom:var(--analysis-half-spacing)}";const De="container",Ve="border",Ae="list-item",Pe=class{constructor(e){(0,s.r)(this,e),this.analysisWorkflowSelectChange=(0,s.c)(this,"analysisWorkflowSelectChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.workflowOptions={},this.isValid=!0,this.hideElements=()=>{this.toolSettingsElement=this.parentAppContainer?.shadowRoot?.querySelector("analysis-tool-settings"),this.toolFooterElement=this.parentAppContainer?.shadowRoot?.querySelector("div[slot=footer]"),this.toolSettingsElement&&(this.toolSettingsElement.hidden=!0),this.toolFooterElement&&(this.toolFooterElement.hidden=!0)},this.showElements=()=>{!0===this.toolSettingsElement?.hidden&&(this.toolSettingsElement.hidden=!1),!0===this.toolFooterElement?.hidden&&(this.toolFooterElement.hidden=!1)},this.onSelectionChange=e=>{e!==this.value&&(this.value=e,this.updateSelectedUIParameters(),this.validate()),this.showElements()},this.replaceWorkflow=e=>{this.removeWorkflowReplacePopover(),this.workflowSelectPopover=this.createWorkflowSelectPopoverElement(e.target),(0,l.b)(document,this.workflowSelectPopover)},this.removeWorkflowReplacePopover=()=>{(0,l.r)(this.workflowSelectPopover)},this.createWorkflowSelectPopoverElement=e=>{const t=document.createElement("analysis-workflow-select-popover"),i={autoClose:!0,closable:!0,focusTrapDisabled:!0,heading:this.strings.popoverHeader,label:this.strings.popoverHeader,placement:"auto",referenceElement:e};return t.popoverOptions=i,t.renderPopoverContent=()=>this.renderWorkflowOptions(!0),t.addEventListener("calcitePopoverClose",(()=>{this.removeWorkflowReplacePopover()})),t}}onUIparameterInfosChange(e){this.processUIparameterInfos(e)}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await(0,a.G)(this.hostElement,(0,s.g)("."))),void 0===this.value&&(this.parentAppContainer=(0,a.aH)("analysis-tool-app-container",this.hostElement)),void 0!==this.UIparameterInfos&&this.processUIparameterInfos(this.UIparameterInfos),this.updateSelectedUIParameters()}componentDidLoad(){void 0===this.value&&this.hideElements()}disconnectedCallback(){this.removeWorkflowReplacePopover(),this.showElements()}async checkValidity(){return this.validate()}validate(){let e=!0;return!0===this.required&&void 0===this.value&&(e=!1),this.isValid=e,Promise.resolve(this.isValid)}processUIparameterInfos(e){const t={},i={};for(const s of e??[]){const e=s?.name;if(void 0===e)throw new Error("UIparameterInfo goal must have a name property");t[e]=s,i[e]=s.label??e}this.workflowOptions=t,this.choiceListLabels=i,this.resetValueIfInvalid()}updateSelectedUIParameters(){const e=void 0===this.value?void 0:[this.workflowOptions[this.value]];!1===(0,n.v)(e,this.selectUIparameterInfos)&&(this.selectUIparameterInfos=e,this.analysisWorkflowSelectChange.emit())}resetValueIfInvalid(){void 0!==this.value&&void 0===this.workflowOptions[this.value]&&this.onSelectionChange(void 0)}renderReplaceTooltip(){const{replaceWorkflow:e}=this.strings;return(0,s.h)("calcite-tooltip",{closeOnClick:!0,dir:this.dir,overlayPositioning:"fixed",placement:"bottom",onClick:e=>e.stopPropagation(),ref:e=>this.selectedWorkflowTooltip=e},e)}renderWorkflowOptions(e=!1){const t=e||void 0===this.value,i=t?this.removeWorkflowReplacePopover:this.replaceWorkflow,a=t?Object.keys(this.workflowOptions).map((e=>this.renderListItem(this.workflowOptions[e],!1))):this.renderListItem(this.workflowOptions[this.value],!0);return(0,s.h)("calcite-list",{class:Ve,dir:this.dir,label:"",onClick:i,selectionMode:e?"single-persist":"none",selectionAppearance:"icon"},this.renderReplaceTooltip(),a)}renderWorkflowHelpAction(e){const{workflowHelp:t}=this.strings;return(0,s.h)("calcite-action",{label:t,text:t,onClick:t=>{t.stopPropagation();const i=t.target,s=i.parentElement,a=e.label??e.name;this.analysisHelpClick.emit({paramName:e.name,paramLabel:a,refElement:s??i})},icon:"information",slot:"actions-end"})}renderListItem(e,t){const{name:i,label:a}=e,l=t?()=>{}:()=>this.onSelectionChange(e.name);return(0,s.h)("calcite-list-item",{class:Ae,key:i,id:i,value:i,label:a??i,selected:i===this.value,onClick:l,ref:e=>{!0===t&&void 0!==this.selectedWorkflowTooltip&&void 0!==this.value&&null!==e&&(this.selectedWorkflowTooltip.referenceElement=e)}},this.renderWorkflowHelpAction(e))}renderLabel(){return void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):void 0}renderErrorMessage(){const e=this.validationParams?.requiredMessage??(0,a.t)(this.strings.isRequired,{label:this.label});return!1===this.isValid&&""!==e?(0,s.h)("calcite-input-message",{status:a.Z.INVALID,scale:a.c.Scale,icon:"exclamationMarkTriangle",hidden:this.isValid},e):void 0}render(){return(0,s.h)(s.H,{key:"d3c268ffd366f0f7a63c8118e1482c3ee2a9fed3"},(0,s.h)("calcite-section",{key:"597c9598506d81ec2623222877c17869ab9b08d5",class:De},(0,s.h)("calcite-label",{key:"67372f465e300cdd3990f62bf08c18f06d38db2b",scale:a.c.Scale},this.renderLabel(),this.renderWorkflowOptions(),this.renderErrorMessage())))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{UIparameterInfos:["onUIparameterInfosChange"]}}};Pe.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{width:var(--analysis-component-default-width)}.container{margin-bottom:var(--analysis-half-spacing)}.border{border:1px solid var(--calcite-color-border-input)}.list-item{--calcite-font-size--1:var(--calcite-font-size--2)}";const Oe="analysis-popover",Re="js-app-flyout",qe="help-iframe-s",_e="help-iframe-m",Ne="learn-more",Be="OnlineOnly",He="PortalOnly",ze="modelBuilderOnly",Ue="toolPaneOnly",Ge="help-custom-tool-param",$e=class{constructor(e){(0,s.r)(this,e),this.analysisHelpPopoverClose=(0,s.c)(this,"analysisHelpPopoverClose",7),this.analysisHelpPopoverSelectionChange=(0,s.c)(this,"analysisHelpPopoverSelectionChange",7),this.isHelpFileExternalAsset=!1,this.placement="auto",this.analysisEngine=r.A.Standard,this.offsetDistance=20,this.offsetSkidding=0,this.triggerDisabled=!1,this.helpMode="standalone"}async portalChange(e){void 0!==e&&e.isPortal&&void 0===this.portalHelpMap&&(this.portalHelpMap=await(0,a.aI)(e))}async componentWillLoad(){({strings:this.strings,dir:this.dir,locale:this.locale}=await(0,a.G)(this.hostElement,(0,s.g)("."))),void 0!==this.portal&&await this.portalChange(this.portal)}componentDidLoad(){try{setTimeout((()=>requestAnimationFrame((()=>this.popoverElement?.setFocus()))),1),setTimeout((()=>{this.popoverElement?.reposition?.()}),a.c.PopoverTimer)}catch(e){}}async reposition(){await(this.popoverElement?.reposition?.())}get modifierClasses(){const e="model"===this.helpMode?ze:Ue;return`${!0===this.portal?.isPortal?He:Be}-${e}`}getContentStyleClass(e){let t=qe;return(-1!==e.indexOf("Category")||-1!==e.indexOf("Tool")||-1!==e.indexOf("toolDescription"))&&(t=_e),t}getLocalizedLearnMoreUrl(){let e;if(void 0!==this.learnMoreBaseUrl){e="/"!==this.learnMoreBaseUrl.charAt(this.learnMoreBaseUrl.length-1)?this.learnMoreBaseUrl+"/":this.learnMoreBaseUrl;const t=this.locale.toLocaleLowerCase();!0===a.aJ.includes(t)&&(e=e.replace(/(\/|^)(en)(\/|$)/,`$1${t}$3`))}return e}getLearnMoreUrlForWebAnalysis(){let e;if(void 0!==this.learnMoreBaseUrl){const t=!0===this.portal?.isPortal?r.n.map:r.m.map,i=(0,n.w)(t,`${this.helpFileName}${(0,a.k)(this.analysisEngine)}.${this.helpId}`);if(void 0!==i&&void 0!==this.learnMoreBaseUrl){const t=this.getLocalizedLearnMoreUrl();if(!0===this.portal?.isPortal&&void 0!==this.portalHelpMap?.m){e=`${t}${this.portalHelpMap.m[i]}`;const{restUrl:s}=this.portal;e=(0,a.aK)(e,s)}else void 0!==this.portal&&!1!==this.portal?.isPortal||(e=`${t}analyze/${i}`)}}return e}getLearnMoreForCustomHelpMap(){let e;if(void 0!==this.externalHelpMap&&void 0!==this.helpId&&void 0!==this.helpFileName&&(e=(0,n.w)(this.externalHelpMap.map,`${this.helpFileName}.${this.helpId}`),void 0!==e&&void 0!==this.learnMoreBaseUrl)){const t="/"!==this.learnMoreBaseUrl.charAt(this.learnMoreBaseUrl.length-1)?this.learnMoreBaseUrl+"/":this.learnMoreBaseUrl;e=`${!0===this.isHelpFileExternalAsset?t:this.getLocalizedLearnMoreUrl()}${e}`}return e}getLearnMoreUrl(){let e;return void 0!==this.learnMoreBaseUrl?e=void 0!==this.externalHelpMap?this.getLearnMoreForCustomHelpMap():this.getLearnMoreUrlForWebAnalysis():void 0!==this.learnMoreUrl&&(e=this.learnMoreUrl),e}renderIframeUsingSrcDoc(){return(0,s.h)("iframe",{class:this.getContentStyleClass(this.helpId),id:this.helpId,title:this.heading??this.helpId,srcdoc:this.helpSrcdoc})}renderIframeUsingHelpUrl(){const e=!1===this.isHelpFileExternalAsset?(0,s.g)(this.helpUrl):this.helpUrl,t=void 0!==e?`${e}#${this.helpId}-${this.modifierClasses}`:"";return(0,s.h)("iframe",{class:this.getContentStyleClass(this.helpId),id:this.helpId,title:this.heading??this.helpId,src:t})}render(){let e,t;if(!1===(0,a.d)(this.helpSrcdoc))e=this.renderIframeUsingSrcDoc(),t=this.getLearnMoreUrl();else if(!1===(0,a.d)(this.helpUrl))e=this.renderIframeUsingHelpUrl(),t=this.getLearnMoreUrl();else{const i="toolDescription"===this.helpId?(0,n.w)(this.referenceElement?.getRootNode(),"host.webToolJSON.description"):this.referenceElement?.getAttribute("description");e=(0,s.h)("div",{key:"e6b384c16ac5aaf57dc4e6d9bb712d7d780bef11",class:Ge},(0,s.h)("p",{key:"a0e8215219b9c25e13817eff5b71304a0dd8df5b"},i??"")),t=(0,n.w)(this.referenceElement?.getRootNode(),"host.webToolJSON.helpUrl")}return(0,s.h)(s.H,{key:"eab3f913383a773867c8f59bb869e6d07057b8a1",class:`${Oe} ${Re}`,dir:this.dir,mode:this.mode},(0,s.h)("calcite-popover",{key:"73d7164ec65e4e847c6e4dafc6f9c79f0a49848e",overlayPositioning:"fixed",autoClose:!0,ref:e=>this.popoverElement=e,referenceElement:this.referenceElement??"analysis-tool",placement:this.placement,open:this.open,closable:!0,heading:this.heading??this.helpId,headingLevel:4,triggerDisabled:this.triggerDisabled,focusTrapDisabled:!0,label:this.heading??this.helpId??"",offsetDistance:this.offsetDistance,offsetSkidding:this.offsetSkidding,onCalcitePopoverClose:()=>this.analysisHelpPopoverClose.emit()},e,void 0!==t&&(0,s.h)("calcite-link",{key:"e0c6b8a4b29e53665a340fac85306934c40a3c25",rel:"help",target:"_blank",href:t,class:Ne},this.strings.learnMoreLabel)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{portal:["portalChange"]}}};$e.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex;background-color:var(--calcite-color-foreground-1)}.help-iframe-s{padding:var(--analysis-quarter-spacing);min-height:var(--analysis-popover-content-min-height-s);max-height:var(--analysis-popover-content-max-height);border:0px}.help-iframe-m{padding:var(--analysis-quarter-spacing);min-height:var(--analysis-popover-content-min-height-m);max-height:var(--analysis-popover-content-max-height);border:0px}.help-custom-tool-param{font-size:12px;font-family:Verdana, Helvetica, sans-serif;overflow-y:auto;padding:var(--analysis-quarter-spacing);min-height:var(--analysis-popover-content-min-height-s);max-height:var(--analysis-popover-content-max-height);width:300px}.help-custom-tool-param p{margin:var(--analysis-half-spacing)}.learn-more{margin:var(--analysis-full-spacing)}";const We="description-text",Qe=class{constructor(e){(0,s.r)(this,e),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.required=!1,this.hideLabel=!1,this.isValid=!0,this.getMessageText=()=>{const e=!0===this.user?.portal?.isPortal&&void 0!==this.portalHelpMap?this.portalHelpMap?.m[r.n.map.OtherHelpLinks.unsupportedGPType]:r.m.map.OtherHelpLinks.unsupportedGPType,t=(0,a.l)({url:e,basePath:(0,a.A)(this.user?.portal),portalUrl:this.user?.portal?.restUrl});let i="";return i="GPValueTable"===this.dataType?(0,a.t)(!1===this.isDefaultValueProvided()?this.strings.unsupportedParameterConfig:this.strings.unsupportedParameterConfigDefaultValue,{docLink:t}):(0,a.t)(!1===this.isDefaultValueProvided()?this.strings.unsupportedGPType:this.strings.defaultValue,{docLink:t}),i},this.isDefaultValueProvided=()=>!((0,a.d)(this.value)||Array.isArray(this.value)&&!this.value.some((e=>!(0,a.d)(e)))||"object"==typeof this.value&&"dataType"in this.value&&(0,a.d)(this.value.value))}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)(".")))}async checkValidity(){return this.isValid=this.required&&this.isDefaultValueProvided()||!this.required,Promise.resolve(this.isValid)}render(){return(0,s.h)(s.H,{key:"4ffcb13b44baadd238e0306fb8484ea9de14e09f"},!1===this.hideLabel&&(0,s.h)("analysis-label",{key:"dd8ff8d3c8ad597c8c49e177236a70f89c2f0adb",label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),(0,s.h)("div",{key:"80598b77e92747599e67924bfaa03a6babfcc248",innerHTML:this.getMessageText(),class:We}),(0,s.h)("calcite-input-message",{key:"03d9d4b95b2811576e99692d3827b6224d113602",status:"invalid",hidden:this.isValid,scale:a.c.Scale,icon:"exclamationMarkTriangle"},this.strings.requiredMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}};Qe.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{margin-bottom:var(--analysis-half-spacing)}.description-text{color:var(--calcite-color-text-3);font-size:var(--calcite-font-size--2)}";const je="and",Ze="or",Ke=["Meters","Kilometers","Feet","Yards","Miles"],Xe={Intersects:"intersects",NotIntersects:"notIntersects",WithinDistance:"withinDistance",NotWithinDistance:"notWithinDistance",Contains:"contains",NotContains:"notContains",Within:"within",NotWithin:"notWithin",Nearest:"nearest"},Je="error-notice",Ye={ParsingFailed:"parsingPreviousQueryError",MissingField:"missingFields",UnsupportedFieldType:"unsupportedFieldType",InvalidFieldTypeForOperator:"invalidFieldTypeForOperator",UnsupportedOperator:"unsupportedOperator",InvalidOperandValue:"invalidOperandValue",MissingColumnReference:"missingColumnReference",InvalidExpression:"invalidExpression",MixedLogicalOperators:"mixedLogicalOperators",MixedLayers:"mixedLayers",PartialThisMonthExpression:"partialThisMonthExpression",PartialThisDayExpression:"partialThisDayExpression",ThisDateMismatchedFields:"thisDateMixedFields",UnsupportedDateUnit:"unsupportedDateUnit"};function et(e){return"small-integer"===e||"integer"===e||"big-integer"===e||"long"===e||"oid"===e}function tt(e){return"single"===e||"double"===e}class it extends Error{constructor(e){super(`QueryBuilderError: ${e}`),this.code=e}static fromUnknownError(e,t){return e instanceof it?e:(console.warn("Unrecognized query error.",e),new it(t??Ye.ParsingFailed))}toTranslatedString(e){return e[this.code]}}function st(e,t){if(!1===e){if(Object.values(Ye).includes(t))throw new it(t);throw new Error(t)}}let at=0;function lt(){return at+=1,`${at}`}const nt=86399e3;function rt(e){const t=function(e){return new Date(e.toDateString())}(e),i=function(e){return new Date(e.getTime()+nt)}(e);return[t,i]}function ot(e){const t=e[0],i=(s=e[1],new Date(s.getTime()-nt));var s;return Math.abs(i.getTime()-t.getTime())<1e3}const ht=Object.freeze({equal:(e,t)=>`${e} = ${t}`,not_equal:(e,t)=>`${e} <> ${t}`,is_in:(e,t)=>`${e} IN(${t.join(", ")})`,is_not_in:(e,t)=>`${e} NOT IN(${t.join(", ")})`,less:(e,t)=>`${e} < ${t}`,less_or_equal:(e,t)=>`${e} <= ${t}`,greater:(e,t)=>`${e} > ${t}`,greater_or_equal:(e,t)=>`${e} >= ${t}`,between:(e,t)=>`${e} BETWEEN ${t.join(" AND ")}`,not_between:(e,t)=>`${e} NOT BETWEEN ${t.join(" AND ")}`,contains:(e,t)=>`${e} LIKE '%${t.slice(1,-1)}%'`,not_contains:(e,t)=>`${e} NOT LIKE '%${t.slice(1,-1)}%'`,begins_with:(e,t)=>`${e} LIKE '${t.slice(1,-1)}%'`,not_begins_with:(e,t)=>`${e} NOT LIKE '${t.slice(1,-1)}%'`,ends_with:(e,t)=>`${e} LIKE '%${t.slice(1,-1)}'`,not_ends_with:(e,t)=>`${e} NOT LIKE '%${t.slice(1,-1)}'`,is_empty:(e,t)=>`${e} = ''`,is_not_empty:(e,t)=>`${e} <> ''`,is_blank:(e,t)=>`${e} IS Null`,is_not_blank:(e,t)=>`${e} IS NOT Null`,is_on:(e,t)=>`${e} BETWEEN ${t}`,is_not_on:(e,t)=>`${e} NOT BETWEEN ${t}`,is_before:(e,t)=>`${e} < ${t}`,is_after:(e,t)=>`${e} > ${t}`,in_the_last:(e,t)=>`${e} BETWEEN ${t}`,this_year:(e,t)=>`EXTRACT(YEAR FROM ${e}) = EXTRACT(YEAR FROM CURRENT_DATE)`,this_month:(e,t)=>`(EXTRACT(MONTH FROM ${e}) = EXTRACT(MONTH FROM CURRENT_DATE) AND EXTRACT(YEAR FROM ${e}) = EXTRACT(YEAR FROM CURRENT_DATE))`,this_day:(e,t)=>`(EXTRACT(DAY FROM ${e}) = EXTRACT(DAY FROM CURRENT_DATE) AND EXTRACT(MONTH FROM ${e}) = EXTRACT(MONTH FROM CURRENT_DATE) AND EXTRACT(YEAR FROM ${e}) = EXTRACT(YEAR FROM CURRENT_DATE))`,not_in_the_last:(e,t)=>`${e} NOT BETWEEN ${t}`,is_true:(e,t)=>`${e} IS TRUE`,is_false:(e,t)=>`${e} IS FALSE`}),ct={"<":"less","<=":"less_or_equal",">":"greater",">=":"greater_or_equal","=":"equal","<>":"not_equal",IN:"is_in","NOT IN":"is_not_in",BETWEEN:"between",NOTBETWEEN:"not_between"},dt=["between","not_between","equal","not_equal","is_in","is_not_in","greater","greater_or_equal","less","less_or_equal","is_blank","is_not_blank"],pt=["equal","not_equal","is_in","is_not_in","contains","not_contains","begins_with","not_begins_with","ends_with","not_ends_with","is_blank","is_not_blank","is_empty","is_not_empty"],ut=["between","not_between","is_on","is_not_on","is_before","is_after","in_the_last","not_in_the_last","is_blank","is_not_blank","this_year","this_month","this_day"],mt=["between","not_between","is_on","is_not_on","is_before","is_after","in_the_last","not_in_the_last","is_blank","is_not_blank","this_year","this_month","this_day"],yt=["is_blank","is_not_blank"],gt=["is_blank","is_not_blank","is_true","is_false"],vt=["between","not_between"],ft=["is_in","is_not_in"],bt=["in_the_last","not_in_the_last"],Ct={date:["minute","hour","day","week"],"date-only":["day","week"]},xt=["is_blank","is_not_blank","is_empty","is_not_empty","is_true","is_false","this_year","this_month","this_day"];function wt(e){return vt.includes(e)}function It(e){return ft.includes(e)}function Lt(e){return xt.includes(e)}function kt(e){let t,i;switch(e){case"string":t="equal",i=pt;break;case"small-integer":case"integer":case"big-integer":case"single":case"double":case"long":case"oid":t="equal",i=dt;break;case"date":t="is_on",i=ut;break;case"date-only":t="is_on",i=mt;break;case"geometry":t="is_blank",i=yt;break;case"boolean":t="is_true",i=gt;break;default:throw new it(Ye.UnsupportedFieldType)}return{defaultOperator:t,supportedOperators:i}}function Et(e,t){return t?`"${e}"`:e}function St(e,t){switch(t){case"integer":case"small-integer":case"big-integer":case"long":case"oid":return null==e?"0":("number"!=typeof e&&(e=parseInt(e)),"number"==typeof e&&isNaN(e)?"0":`${e}`);case"double":case"single":return null==e?"0.0":("number"!=typeof e&&(e=parseFloat(e)),"number"==typeof e&&isNaN(e)?"0.0":`${e}`);case"date":const t=e instanceof Date?e:void 0;return void 0!==t?`timestamp '${function(e){if(void 0===e)return"";const t=`${e.getUTCFullYear()}`;let i=`${e.getUTCMonth()+1}`;1===i.length&&(i=`0${i}`);let s=`${e.getUTCDate()}`;1===s.length&&(s=`0${s}`);let a=`${e.getUTCHours()}`;1===a.length&&(a=`0${a}`);let l=`${e.getUTCMinutes()}`;1===l.length&&(l=`0${l}`);let n=`${e.getUTCSeconds()}`;return 1===n.length&&(n=`0${n}`),`${t}-${i}-${s} ${a}:${l}:${n}`}(t)}'`:"''";case"date-only":return void 0!==e?`date '${e}'`:"''";case"string":const i=e;return`'${null==i?"":i.replace(/'/g,"''")}'`;case"boolean":case"geometry":return"";default:throw new it(Ye.UnsupportedFieldType)}}function Mt(e){switch(e.type){case"string":case"number":case"date":case"boolean":return e.value;case"null":return null;case"timestamp":return function(e){const t=new Date(e);return new Date(t.getTime()-6e4*t.getTimezoneOffset())}(e.value);default:throw new it(Ye.InvalidOperandValue)}}function Tt(e){if("binary-expression"!==e.type||"="!==e.operator||"function"!==e.left.type||"extract"!==e.left.name||"expression-list"!==e.left.args.type||"function"!==e.right.type||"extract"!==e.right.name||"expression-list"!==e.right.args.type)return;const t=[...e.left.args.value,...e.right.args.value];let i,s,a;if("string"===t[0].type)switch(t[0].value.toLowerCase()){case"year":i="this_year";break;case"month":i="this_month";break;case"day":i="this_day"}if(void 0===i)throw new it(Ye.UnsupportedDateUnit);for(const e of t)"column-reference"===e.type?s=e.column:"current-time"===e.type&&(a=e);if(void 0===s)throw new it(Ye.MissingColumnReference);if(void 0===a)throw new it(Ye.InvalidOperandValue);return{field:s,operator:i}}function Ft(e){if("binary-expression"!==e.type)return;let t;if("="===e.operator){if(t=Tt(e),"this_month"===t?.operator)throw new it(Ye.PartialThisMonthExpression);if("this_day"===t?.operator)throw new it(Ye.PartialThisDayExpression)}else if("AND"===e.operator)if("binary-expression"===e.left.type&&"AND"===e.left.operator){const i=Tt(e.left.left),s=Tt(e.left.right),a=Tt(e.right),l=[i?.operator,s?.operator,a?.operator],n=new Set([i?.field,s?.field,a?.field]);if(l.includes("this_day")&&l.includes("this_month")&&l.includes("this_year")){if(1!==n.size)throw new it(Ye.ThisDateMismatchedFields);t={field:i.field,operator:"this_day"}}}else{const i=Tt(e.left),s=Tt(e.right),a=[i?.operator,s?.operator],l=new Set([i?.field,s?.field]);if(a.includes("this_month")&&a.includes("this_year")){if(1!==l.size)throw new it(Ye.ThisDateMismatchedFields);t={field:i.field,operator:"this_month"}}}return t}var Dt;function Vt(e){return null==e}function At(e){let t=!0;return Vt(e)||""===e?t=!1:"number"!=typeof e||!isNaN(e)&&isFinite(e)||(t=!1),t}class Pt{constructor(e,t,i,s,a){this.field=e,this.dataType=t,this.value=i,this.operator=s,this.id=a??lt()}}class Ot extends Pt{constructor(){super(...arguments),this.type="value"}validate(){return Lt(this.operator)||At(this.value)}toSQL(e){let t;if("date"===this.dataType)t=this.toSQLForDate(this.value,this.operator,e);else if("date-only"===this.dataType)t=this.toSQLForDateOnly(this.value,this.operator,e);else{const i=Et(this.field,!0===e?.useDelimitedIdentifiers),s=St(this.value,this.dataType);t=ht[this.operator](i,s)}return t}toSQLForDate(e,t,i){const s=Et(this.field,!0===i?.useDelimitedIdentifiers);switch(t){case"is_on":case"is_not_on":const i=void 0!==e?rt(e).map((e=>St(e,"date"))):["''","''"];return ht[t](s,`${i[0]} AND ${i[1]}`);default:const a=St(e,"date");return ht[t](s,a)}}toSQLForDateOnly(e,t,i){const s=Et(this.field,!0===i?.useDelimitedIdentifiers),a=St(e,this.dataType);switch(t){case"is_on":return ht.equal(s,a);case"is_not_on":return ht.not_equal(s,a);default:return ht[t](s,a)}}}class Rt extends Pt{constructor(){super(...arguments),this.type="multi-value"}get validValues(){return this.value.filter(At)}validate(){return this.validValues.length>0}toSQL(e){const t=Et(this.field,!0===e?.useDelimitedIdentifiers),i=this.validValues.map((e=>St(e,this.dataType)));return ht[this.operator](t,i)}}class qt extends Pt{constructor(){super(...arguments),this.type="range"}validate(){return At(this.value[0])&&At(this.value[1])}toSQL(e){const t=Et(this.field,!0===e?.useDelimitedIdentifiers),i=St(this.value[0],this.dataType),s=St(this.value[1],this.dataType);return ht[this.operator](t,[i,s])}}class _t extends Pt{constructor(){super(...arguments),this.type="distance"}validate(){return At(this.value.distance)&&At(this.value.unit)}toSQL(e){if("date"!==this.dataType&&"date-only"!==this.dataType)throw new it(Ye.InvalidFieldTypeForOperator);const t=Et(this.field,!0===e?.useDelimitedIdentifiers),i=function(e,t,i){const s="date-only"===i?"CURRENT_DATE":"CURRENT_TIMESTAMP";switch(t){case"minute":return`CURRENT_TIMESTAMP - INTERVAL '${e}' MINUTE AND CURRENT_TIMESTAMP`;case"hour":return`CURRENT_TIMESTAMP - INTERVAL '${e}' HOUR AND CURRENT_TIMESTAMP`;case"day":return`${s} - INTERVAL '${e}' DAY AND ${s}`;case"week":return`${s} - INTERVAL '${7*e}' DAY AND ${s}`;default:throw new it(Ye.UnsupportedDateUnit)}}(this.value.distance??0,this.value.unit??"hour",this.dataType);return ht[this.operator](t,i)}}class Nt{constructor(e,t,i,s){this.layer=e,this.selectingLayer=t,this.spatialRelationship=i,this.spatialRelationshipParams=s}get isDistanceRelationship(){return"withinDistance"===this.spatialRelationship||"notWithinDistance"===this.spatialRelationship}validate(){let e=void 0!==this.selectingLayer&&void 0!==this.spatialRelationship;if(this.isDistanceRelationship){const{distance:t,units:i}=this.spatialRelationshipParams??{};e=e&&At(t)&&At(i)}return e}changeSelectingLayer(e){return new Nt(this.layer,e,this.spatialRelationship,this.spatialRelationshipParams)}static getValidLayersForRelationships(e,t,i){const s=new Map;return i.forEach((i=>{let a=this.filterLayersBasedOnGeometryType(e,t,i);a=this.getValidSelectingLayers(e,a??[]),s.set(i,a)})),s}static filterLayersBasedOnGeometryType(e,t,i){const s=new Map;t.forEach((e=>{if(s.has(e.geometryType)){s.get(e.geometryType).push(e)}else s.set(e.geometryType,[e])}));const a=e.geometryType,l=s.get("polygon")??[],n=s.get("polyline")??[],r=s.get("point")??[],o=s.get("multipoint")??[];let h=[];return h="contains"===i||"notContains"===i?"polygon"===a?[...r,...n,...l,...o]:"polyline"===a?[...r,...n,...o]:"point"===a||"multipoint"===a?[...r,...o]:[]:"within"===i||"notWithin"===i?"point"===a||"multipoint"===a?[...r,...n,...l,...o]:"polyline"===a?[...l,...n]:"polygon"===a?l:[]:t,h}static getValidSelectingLayers(e,t){return t.filter((t=>e.id!==t.id))}changeSpatialRelationship(e){const t=new Nt(this.layer,this.selectingLayer,e);return t.isDistanceRelationship&&(t.spatialRelationshipParams={distance:this.spatialRelationshipParams?.distance,units:this.spatialRelationshipParams?.units??Ke[0]}),t}changeSpatialRelationshipDistance(e){const t={...this.spatialRelationshipParams,distance:e};return new Nt(this.layer,this.selectingLayer,this.spatialRelationship,t)}changeSpatialRelationshipUnit(e){const t={...this.spatialRelationshipParams,units:e};return new Nt(this.layer,this.selectingLayer,this.spatialRelationship,t)}}function Bt(e,t,i){if(null==e)return!1;const s=t?.allowGeometryFields??!1,a=[i?.geometryFieldsInfo?.shapeAreaField,i?.geometryFieldsInfo?.shapeLengthField].includes(e.name)&&!1===s;if(!0===t?.hideObjectIdField&&e.name===i?.objectIdField||!0===a)return!1;switch(e.type){case"string":case"small-integer":case"integer":case"single":case"double":case"long":case"big-integer":case"date":case"date-only":case"geometry":case"oid":return!0;default:return!1}}function Ht(e,t){let i;return Vt(e.description)||(e.description===t?.booleanFieldDescription?i="boolean":!0===t?.geometryFieldDescriptions?.includes(e.description)&&(i="geometry")),i}function zt(e){let t="value";return wt(e)?t="range":It(e)?t="multi-value":function(e){return bt.includes(e)}(e)&&(t="distance"),t}class Ut{constructor(e){this.expression=e}changeOperator(e){const{field:t,dataType:i,id:s}=this.expression,a=Dt.create({field:t,dataType:i,operator:e,id:s});return zt(e)===this.expression.type&&(a.value=this.expression.value),a}changeField(e,t){if(!Bt(e,t))throw new it(Ye.UnsupportedFieldType);const i=Ht(e,t)??e.type;return Dt.create({field:e.name,dataType:i,id:this.expression.id})}changeValue(e){return Dt.create({field:this.expression.field,dataType:this.expression.dataType,operator:this.expression.operator,value:e,id:this.expression.id})}static create({field:e,dataType:t,operator:i,id:s,value:a}){let l;const{supportedOperators:n,defaultOperator:r}=kt(t);if(void 0!==i&&!n.includes(i))throw new it(Ye.InvalidFieldTypeForOperator);const o=i??r;switch(zt(o)){case"value":l=new Ot(e,t,a,o,s);break;case"multi-value":l=new Rt(e,t,a??[],o,s);break;case"range":l=new qt(e,t,a??[void 0,void 0],o,s);break;case"distance":l=new _t(e,t,a??{unit:"day"},o,s)}return l}static createDefaultForLayer(e,t){const i=e.fields.filter((i=>Bt(i,t,e)));if(!(i.length<1)){const e=i[0],s=Ht(e,t)??e.type;return Dt.create({field:e.name,dataType:s})}}}Dt=Ut,Ut.fromSQL=async(e,t,i)=>{try{const s=await(0,a.aL)(e,t);return Dt.fromSQLNode(s.parseTree,t,i)}catch(e){throw it.fromUnknownError(e,Ye.InvalidExpression)}},Ut.fromSQLNode=(e,t,i)=>{st("binary-expression"===e.type,Ye.InvalidExpression);const s=Ft(e);if(void 0!==s){const e=t.get(s.field);return st((0,a.m)(e),Ye.MissingField),st(Bt(e,i),Ye.UnsupportedFieldType),st("date"===e.type||"date-only"===e.type,Ye.InvalidFieldTypeForOperator),new Ot(e.name,e.type,void 0,s.operator)}let l,n;"column-reference"===e.left.type?(l=e.left,n=e.right):(l=e.right,n=e.left),st("column-reference"===l.type,Ye.InvalidExpression);const r=t.get(l.column);let o;st((0,a.m)(r),Ye.MissingField),st(Bt(r,i),Ye.UnsupportedFieldType);const h=ct[e.operator],c=function(e){if("expression-list"!==e.type)return;const t=e.value;if(2===t.length&&"binary-expression"===t[0].type&&"current-time"===t[0].left.type&&"interval"===t[0].right.type&&"current-time"===t[1].type&&"interval-period"===t[0].right.qualifier.type){const e=t[0].right.qualifier.period,i=Number.parseFloat(t[0].right.value.value);switch(st(!isNaN(i),Ye.InvalidOperandValue),e){case"day":return i%7==0?{distance:i/7,unit:"week"}:{distance:i,unit:"day"};case"hour":return{distance:i,unit:"hour"};case"minute":return{distance:i,unit:"minute"};case"month":case"second":case"year":throw new it(Ye.UnsupportedDateUnit)}}}(n);if(void 0!==c){const e="between"===h?"in_the_last":"not_in_the_last";o=new _t(r.name,r.type,c,e)}else if(wt(h)){st("expression-list"===n.type,Ye.InvalidExpression);const e=n.value,t=Mt(e[0]),i=Mt(e[1]);if(o=new qt(r.name,r.type,[t,i],h),t instanceof Date&&i instanceof Date&&ot([t,i])){const e="between"===o.operator?"is_on":"is_not_on";o=new Ot(r.name,r.type,t,e)}}else if(It(h)){st("expression-list"===n.type,Ye.InvalidExpression);const e=n.value.map(Mt);o=new Rt(r.name,r.type,e,h)}else{const[t,s]=function(e,t){const i=Mt(t);switch(e){case"IS":if(null===i)return["is_blank",void 0];if("boolean"==typeof i)return[!0===i?"is_true":"is_false",void 0];throw new it(Ye.InvalidOperandValue);case"ISNOT":if(null===i)return["is_not_blank",void 0];throw new it(Ye.InvalidOperandValue);case"=":return""===i?["is_empty",""]:"date"===t.type?["is_on",i]:["equal",i];case"<>":return""===i?["is_not_empty",""]:"date"===t.type?["is_not_on",i]:["not_equal",i];case"<":return"date"===t.type||"timestamp"===t.type?["is_before",i]:["less",i];case">":return"date"===t.type||"timestamp"===t.type?["is_after",i]:["greater",i];case"LIKE":return st("string"==typeof i,Ye.InvalidOperandValue),i.startsWith("%")&&i.endsWith("%")?["contains",i.substring(1,i.length-1)]:i.endsWith("%")?["begins_with",i.substring(0,i.length-1)]:i.startsWith("%")?["ends_with",i.substring(1)]:["equal",i];case"NOT LIKE":return st("string"==typeof i,Ye.InvalidOperandValue),i.startsWith("%")&&i.endsWith("%")?["not_contains",i.slice(1,i.length-1)]:i.endsWith("%")?["not_begins_with",i.slice(0,i.length-1)]:i.startsWith("%")?["not_ends_with",i.slice(1)]:["not_equal",i];default:const s=ct[e];return st(void 0!==s,Ye.UnsupportedOperator),[s,i]}}(e.operator,n),a=Ht(r,i)??r.type;o=new Ot(r.name,a,s,t)}const{supportedOperators:d}=kt(o.dataType);return st(d.includes(o.operator),Ye.InvalidFieldTypeForOperator),o};class Gt{constructor(e,t="",i=[],s,a){this.toJSON=async(e,t)=>{const i=this.getUsedLayers(e);return{expressions:this.toGPQuery(i),inputLayers:await this.serializeLayers(i,t)}},this.toGPQuery=(e,t="")=>{const i=[];return this.children.forEach(((s,a)=>{let l=0===a?t:this.operator;if(s instanceof Gt){if(!0===s.spatialExpression?.validate()){const t=(({expression:e,operator:t,layer:i,layerList:s})=>{const{spatialRelationship:a,spatialRelationshipParams:l}=e,n=e.selectingLayer;return{operator:t,layer:s.findIndex((e=>e.id===i.id)),selectingLayer:s.findIndex((e=>e.id===n.id)),spatialRel:a,distance:l?.distance,units:l?.units}})({operator:l,expression:s.spatialExpression,layer:this.layer,layerList:e});i.push(t),l="and"}const t=s.toGPQuery(e,l);t.length>0&&i.push(t)}else if(s.validate()){const t=(({expression:e,operator:t,layer:i,layerList:s})=>({operator:t,layer:s.findIndex((e=>e.id===i.id)),where:e.toSQL()}))({operator:l,expression:s,layer:this.layer,layerList:e});i.push(t)}})),i},this.layer=e,this.operator=t,this.children=i,this.spatialExpression=s,this.id=a??lt()}static async fromSQL(e,t,i){let s,l;if(""===e)s=new Gt(t);else try{const{parseTree:n}=await(0,a.aL)(e,t.fieldsIndex),r=Gt.fromSQLNode(n,t,i);s=r.group,l=0===r.errors.length?void 0:r.errors}catch(e){l=[it.fromUnknownError(e)]}return{group:s,errors:l}}static fromSQLNode(e,t,i){let s;const a=[],l=[],n=[e];for(;n.length>0;)try{const e=n.pop();if("binary-expression"===e.type&&("AND"===e.operator&&void 0===Ft(e)||"OR"===e.operator))if(s??(s=e.operator),s===e.operator)n.push(e.right),n.push(e.left);else{const s=Gt.fromSQLNode(e,t,i);l.push(...s.errors),a.push(s.group)}else{const s=Ut.fromSQLNode(e,t.fieldsIndex,i);a.push(s)}}catch(e){const t=it.fromUnknownError(e,Ye.MissingField);l.push(t)}const r=void 0===s?"and":s.toLowerCase();return{group:new Gt(t,r,a),errors:l}}toSQL(e){const t=this.operator.toUpperCase();return this.children.map((t=>{let i;if(t instanceof Gt){const s=t.toSQL(e);""!==s&&(i=`(${s})`)}else t.validate()&&(i=t.toSQL(e));return i})).filter((e=>void 0!==e)).join(` ${t} `)}static async fromJSON(e,t){let i,s;if(e.length<1)i=new Gt(t[0]);else{const a=await Gt._fromJSON(e,t);i=a.group,s=0===a.errors.length?void 0:a.errors}return{group:i,errors:s}}static async _fromJSON(e,t){let i,s,a="";const l=[],n=new Set,r=[];for(let o=0;o<e.length;o++)if(!n.has(o))try{let h,c;const d=e[o];if(Array.isArray(d)){const e=await Gt._fromJSON(d,t);r.push(...e.errors),l.push(e.group),c=e.group.layer,h=e.combineOperator}else if("spatialRel"in d){const{layer:i,selectingLayer:s,units:a,distance:p,spatialRel:u,operator:m}=d,y=new Nt(t[i],t[s],u,{units:a,distance:p}),g=e[o+1];if(Array.isArray(g)){const e=await Gt._fromJSON(g,t);if(r.push(...e.errors),y.selectingLayer===e.group.layer)e.group.spatialExpression=y,l.push(e.group),n.add(o+1);else{const e=y.selectingLayer,t=new Gt(e,m,[],y);l.push(t)}}else{const e=new Gt(t[s],m,[],y);l.push(e)}c=t[i],h=m}else{const{where:e,layer:i,operator:s}=d,a=await Ut.fromSQL(e,t[i].fieldsIndex);l.push(a),c=t[i],h=s}0===o?a=h:(s??(s=h),st(s===h,Ye.MixedLogicalOperators)),i??(i=c),st(i===c,Ye.MixedLayers)}catch(e){const t=it.fromUnknownError(e);r.push(t)}let o;return o=void 0===i?new Gt(t[0],"and",[]):new Gt(i,s??"and",l),{group:o,combineOperator:a,errors:r}}getUsedLayersIds(e){return e.add(this.layer.id),void 0!==this.spatialExpression&&e.add(this.spatialExpression.selectingLayer.id),this.children.forEach((t=>{t instanceof Gt&&t.getUsedLayersIds(e)})),e}getUsedLayers(e){const t=[...this.getUsedLayersIds(new Set)],i=new Map;e.forEach((e=>i.set(e.id,e)));return t.map((e=>i.get(e)))}async serializeLayers(e,t){let i=[];return i=(await Promise.all(e.map((e=>(0,a.ao)(e,t))))).map((e=>(0,r.o)(e,"itemId"))),i}changeTarget(e){return new Gt(e,this.operator,[],void 0,this.id)}addDefaultSpatialExpression(e,t){const i=Nt.getValidSelectingLayers(e,t)[0]??e,s=new Nt(e,i,Xe.Intersects),a=new Gt(i,"and",[],s),l=[...this.children,a];return new Gt(this.layer,this.operator,l,this.spatialExpression,this.id)}addExpression(e){const t=[...this.children,e];return new Gt(this.layer,this.operator,t,this.spatialExpression,this.id)}addDefaultExpression(e){const t=Ut.createDefaultForLayer(this.layer,e);return void 0===t?this:this.addExpression(t)}addGroup(e){const t=[...this.children,e];return new Gt(this.layer,this.operator,t,this.spatialExpression,this.id)}addNewGroup(e="and"){const t=new Gt(this.layer,e,[],void 0,this.id);return this.addGroup(t)}removeChild(e){return this.children.splice(e,1),new Gt(this.layer,this.operator,this.children,this.spatialExpression,this.id)}changeSpatialExpression(e){const{layer:t,children:i}=this;let s=t,a=i;const l=this.spatialExpression?.selectingLayer,n=e.selectingLayer;return l!==n&&(s=n,a=[]),new Gt(s,this.operator,a,e,this.id)}clone(){const e=[...this.cloneChildren(this.children)];return new Gt(this.layer,this.operator,e,this.spatialExpression,this.id)}cloneChildren(e){return e.map((e=>{if(e instanceof Gt){const t=this.cloneChildren(e.children);return new Gt(e.layer,e.operator,t,e.spatialExpression,e.id)}return t=e,(0,r.p)(t,5);var t}))}}const $t="border",Wt="mb-half",Qt="list-item",jt={error:"__aborted__"},Zt=class{constructor(e){(0,s.r)(this,e),this.analysisQueryInputChange=(0,s.c)(this,"analysisQueryInputChange",7),this.analysisHelpClick=(0,s.c)(this,"analysisHelpClick",7),this.loading=!0,this.required=!1,this.mode="analysis",this.hideHelp=!1,this.mapLayers=[],this.recordsTerm="features",this.readOnly=!1,this.openModal=()=>{this.queryModal=document.createElement("analysis-query-modal"),"sql"===this.mode?(this.queryModal.target=this.layer??this.expressionGroup?.layer,this.queryModal.layers=[]):(this.queryModal.target=this.layer??this.expressionGroup?.layer??this.combinedLayers[0],this.queryModal.layers=this.combinedLayers);const e="howToBuildAQuery",t=!0===this.portal?.isPortal&&void 0!==this.portalHelpMap?this.portalHelpMap?.m[r.n.map.OtherHelpLinks[e]]:r.m.map.OtherHelpLinks[e],i=(0,a.l)({url:t,basePath:(0,a.A)(this.portal),portalUrl:this.portal?.restUrl});!1===this.hideHelp&&(this.queryModal.docLink=i),this.queryModal.expressionGroup=this.expressionGroup,this.queryModal.recordsTerm=this.recordsTerm,this.queryModal.mode=this.mode,this.queryModal.open=!0;const s=!0===this.modelVariables?.find((e=>this.queryModal?.target?.id===e.id))?.isDerived,l=(0,a.m)(this.modelVariables)&&(0,a.av)(this.queryModal.target);this.queryModal.options={showDerivedLayerMessage:s,hideObjectIdField:l,...this.options},this.hasValue&&void 0!==this.value&&(this.queryModal.value=this.value),this.queryModal.addEventListener("analysisQueryModalAdd",this.onQueryModalAddClick),this.queryModal.addEventListener("analysisQueryModalError",this.onQueryModalError),this.queryModal.addEventListener("analysisQueryModalDismissed",this.onQueryModalDismissed),document.body.appendChild(this.queryModal)},this.closeModal=()=>{this.queryModal?.removeEventListener("analysisQueryModalAdd",this.onQueryModalAddClick),this.queryModal?.removeEventListener("analysisQueryModalError",this.onQueryModalError),this.queryModal?.removeEventListener("analysisQueryModalDismissed",this.onQueryModalDismissed),this.queryModal?.remove()},this.onQueryModalError=e=>{this.errorMessage=e.detail},this.onQueryModalAddClick=async e=>{const t=e.detail;this.value=await this.serializeExpressionGroup(t),this.analysisQueryInputChange.emit(this.value),this.validate()},this.serializeExpressionGroup=async e=>{let t;if("sql"===this.mode)t=e?.toSQL(this.options);else{const i=await(e?.toJSON(this.combinedLayers,this.mapView));void 0!==i?.expressions&&void 0!==i?.inputLayers&&(t={expressions:i?.expressions,inputLayers:i?.inputLayers})}return t},this.onQueryModalDismissed=()=>{this.closeModal(),this.validate({preserveExistingErrors:!0})},this.onDeleteQuery=()=>{this.value=void 0,this.analysisQueryInputChange.emit(void 0),this.validate()}}async valueChange(){if("analysis"===this.mode){const e=await this.loadGPQueryLayers(this.value,this.combinedLayers);this.combinedLayers=this.combineLayers(e.result??[],this.combinedLayers)}const e=await this.parseCurrentValue();this.expressionGroup=e.result,this.maybeSetFirstError([e]),this.setValueLabel()}setValueLabel(){const e="features"===this.recordsTerm?this.strings.featureValueHeader:this.strings.recordsValueHeader,t=this.expressionGroup?.layer;(0,a.m)(t?.title)?this.valueLabel=(0,a.t)(e,{layer:t.title}):this.valueLabel=(0,a.t)(e,{layer:""})}async mapLayersChange(e){const t=await this.loadSupportedMapLayers(e),i=this.expressionGroup?.getUsedLayers(this.combinedLayers);this.combinedLayers=this.combineLayers(i??[],t.result??[]),this.maybeSetFirstError([t])}async targetLayerChange(e){if(void 0===e)return;const t=await this.loadTargetLayer(e),i=await this.parseCurrentValue();void 0===t.error&&void 0!==i.result&&(this.expressionGroup=i.result,this.setValueLabel()),void 0!==this.errorMessage&&this.errorMessage!==this.strings.isRequired&&(this.errorMessage=void 0),this.maybeSetFirstError([t,i])}get hasError(){return(0,a.m)(this.errorMessage)}get hasValue(){let e;if("string"==typeof this.value)e=""!==this.value;else if(void 0!==this.value){const{expressions:t,inputLayers:i}=this.value;e=void 0!==t&&t.length>0&&void 0!==i&&i.length>0}else e=!1;return e}get hasAnalysisLayersLoadError(){return"analysis"===this.mode&&this.errorMessage===this.strings.layersLoadError}get canCreateQuery(){const e=void 0===this.layer||void 0!==this.layer.loadError&&null!==this.layer.loadError,t=void 0===this.combinedLayers||0===this.combinedLayers.length;return"sql"===this.mode?!e&&!this.readOnly:!(e&&t)}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.loading=!0,this.loadInitialState().finally((()=>this.loading=!1))}async loadInitialState(){const e=await this.loadTargetLayer(this.layer),t=await this.loadSupportedMapLayers(this.mapLayers),i=t.result??[],s=await this.loadGPQueryLayers(this.value,i),a=s.result??[];if(this.combinedLayers=this.combineLayers(a,i),0!==this.combinedLayers.length||void 0!==this.layer){const i=await this.parseCurrentValue();if(void 0!==i.result){this.expressionGroup=i.result,this.setValueLabel();[e,t,s].some((e=>void 0!==e.error))||void 0===this.value||"string"==typeof this.value||(this.value={expressions:this.value.expressions,inputLayers:this.addMapLayerFiltersToInputLayers(this.value.inputLayers,this.combinedLayers)},this.analysisQueryInputChange.emit(this.value))}this.maybeSetFirstError([e,t,s,i])}else this.maybeSetFirstError([e,t,s])}componentDidRender(){void 0!==this.tooltipRef&&null!==this.tooltipRef&&((0,a.m)(this.valueRef)?this.tooltipRef.referenceElement=this.valueRef:(0,a.m)(this.addButtonRef)&&(this.tooltipRef.referenceElement=this.addButtonRef))}disconnectedCallback(){this.abortController?.abort(),this.closeModal()}async checkValidity(){return Promise.resolve(this.validate({preserveExistingErrors:!0}))}render(){return!0===this.loading?this.renderLoadingState():this.hasValue&&!this.hasAnalysisLayersLoadError?this.renderValueState():this.renderInitialState()}renderLoadingState(){return(0,s.h)(s.H,null,(0,s.h)("calcite-label",{scale:a.c.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-button",{appearance:"outline",kind:"neutral","icon-start":"plus",width:"full",scale:a.c.Scale,onClick:()=>{},loading:!0,disabled:!0},this.strings.createQuery)))}renderInitialState(){return(0,s.h)(s.H,null,(0,s.h)("calcite-label",{scale:a.c.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-button",{appearance:"outline",kind:"neutral","icon-start":"plus",width:"full",scale:a.c.Scale,onClick:()=>{this.canCreateQuery&&this.openModal()},disabled:!1===this.canCreateQuery,ref:e=>this.addButtonRef=e},this.strings.createQuery),!1===this.canCreateQuery&&!this.readOnly&&(0,s.h)("calcite-tooltip",{referenceElement:this.addButtonRef,ref:e=>this.tooltipRef=e,overlayPositioning:"fixed"},this.disabledTooltip??this.strings.disabledTooltip)),!1===this.readOnly&&(0,s.h)("calcite-input-message",{class:Wt,hidden:!this.hasError,icon:"exclamationMarkTriangle",status:a.Z.INVALID,scale:a.c.Scale},!1===this.hasError?this.strings.isRequired:this.errorMessage))}renderValueState(){const e="sql"===this.mode&&"string"==typeof this.value?this.truncateString(this.value,25):this.strings.editDescription;return(0,s.h)(s.H,null,(0,s.h)("calcite-label",{scale:a.c.Scale},void 0!==this.label&&""!==this.label?(0,s.h)("analysis-label",{label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}):null,(0,s.h)("calcite-list",{label:"",onClick:()=>this.openModal(),class:`${$t} ${Wt}`},(0,s.h)("calcite-list-item",{class:Qt,value:"query",ref:e=>this.valueRef=e,label:this.valueLabel,description:e,disabled:"sql"===this.mode&&!this.canCreateQuery},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",icon:"pencil",text:this.strings.editAction}))),"sql"===this.mode&&"string"==typeof this.value&&(0,s.h)("calcite-tooltip",{referenceElement:this.valueRef,ref:e=>this.tooltipRef=e,overlayPositioning:"fixed"},this.canCreateQuery?(0,s.h)(s.F,null,this.strings.clickToEditExpression,(0,s.h)("br",null),(0,s.h)("code",null,this.value)):(0,s.h)(s.F,null,!this.readOnly&&(0,s.h)(s.F,null,this.disabledTooltip??this.strings.disabledTooltip,(0,s.h)("br",null),(0,s.h)("br",null)),(0,s.h)("code",null,this.value)))),(0,s.h)("calcite-button",{class:Wt,appearance:"outline",kind:"neutral","icon-start":"trash",width:"full",scale:a.c.Scale,onClick:this.onDeleteQuery,disabled:"sql"===this.mode&&this.readOnly},this.strings.deleteQuery),!1===this.readOnly&&(0,s.h)("calcite-input-message",{class:Wt,status:"invalid",scale:a.c.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.errorMessage))}async loadTargetLayer(e){let t;this.abortController?.abort(),this.abortController=new AbortController;try{await(e?.load({signal:this.abortController.signal})),t={result:void 0===e?void 0:e}}catch(e){if((0,a.ai)(e))return jt;const t="records"===this.recordsTerm?"targetDatasetLoadError":"layersLoadError";return{error:this.strings[t]}}return t}async loadSupportedMapLayers(e){let t;if(void 0===e)t={result:[]};else{const i=e.filter(a.aM).filter((e=>!e.isTable));await Promise.allSettled(i.map((e=>e.load())));const s=i.filter((e=>e.loaded));t=s.length!==i.length?{result:s,error:this.strings.layersLoadError}:{result:s}}return t}async loadGPQueryLayers(e,t){let i;if("string"!=typeof e&&Array.isArray(e?.inputLayers)){const s=(t??[]).reduce(((e,t)=>(e.set((0,l.l)(t),t),e)),new Map),n=e.inputLayers.filter((e=>!s.has(e.url)));try{const e=await(0,a.aN)(n);n.forEach(((t,i)=>s.set(t.url,e[i])))}catch{return{error:this.strings.layersLoadError}}i={result:e.inputLayers.map((e=>s.get(e.url))).filter((e=>void 0!==e))}}else i={result:[]};return i}combineLayers(e,t){const i=new Set,s=[];for(const a of[...e,...t]){const e=(0,l.l)(a);i.has(e)||(i.add(e),s.push(a))}return s}addMapLayerFiltersToInputLayers(e,t){const i=t.reduce(((e,t)=>(e.set((0,l.l)(t),t.definitionExpression),e)),new Map);return e.map((e=>(e.filter=i.get(e.url)??void 0,e)))}async parseCurrentValue(){let e,t;return"analysis"===this.mode&&"object"==typeof this.value?({group:e,errors:t}=await Gt.fromJSON(this.value.expressions,this.combinedLayers)):"sql"===this.mode&&"string"==typeof this.value&&({group:e,errors:t}=await Gt.fromSQL(this.value,this.layer,this.options)),void 0!==t&&t.length>0?{result:e,error:t[0].toTranslatedString(this.strings)}:{result:e}}validate(e){let t;return void 0!==this.errorMessage&&!0===e?.preserveExistingErrors?t=!1:!this.hasValue&&this.required?(t=!1,this.errorMessage=this.strings.isRequired):(t=!0,this.errorMessage=void 0),t}maybeSetFirstError(e){const t=e.find((e=>void 0!==e.error));void 0!==t&&t.error!==jt.error&&(this.errorMessage=t.error)}truncateString(e,t){return e.length<=t?e:e.slice(0,t)+"..."}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}static get watchers(){return{value:["valueChange"],mapLayers:["mapLayersChange"],layer:["targetLayerChange"]}}};Zt.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.border{border:1px solid var(--calcite-color-border-input)}.mb-half{margin-bottom:var(--analysis-half-spacing)}.list-item{--calcite-font-size--1:var(--calcite-font-size--2)}";const Kt="expression-tile-select-w-third",Xt="expression-tile-select-group",Jt=class{constructor(e){(0,s.r)(this,e),this.analysisQueryModalAdd=(0,s.c)(this,"analysisQueryModalAdd",7),this.analysisQueryModalDismissed=(0,s.c)(this,"analysisQueryModalDismissed",7),this.analysisQueryModalError=(0,s.c)(this,"analysisQueryModalError",7),this.selectedExpressionType="attribute",this.isOnboarding=!0,this.layers=[],this.recordsTerm="features",this.close=()=>{void 0!==this.containerRef&&(this.containerRef.open=!1)},this.onQueryError=e=>{this.analysisQueryModalError.emit(e.detail)},this.onTargetChange=e=>{this.target=e.target.target},this.onSelectExpressionType=e=>{const t=e.target;this.selectedExpressionType=t.value},this.onOnboardingNextClick=()=>{this.expressionGroup=this.createDefaultGroup(),this.isOnboarding=!1},this.onAddClick=()=>{setTimeout((()=>{this.analysisQueryModalAdd.emit(this.newValue??this.expressionGroup),this.close()}),100)},this.onClose=()=>{this.analysisQueryModalDismissed.emit()},this.onQueryChange=e=>{this.newValue=e.detail}}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)("."))),this.isOnboarding=void 0===this.value||"string"!=typeof this.value&&this.value.expressions.length<1,await Promise.allSettled(this.layers.map((e=>e.load())))}componentDidRender(){void 0!==this.tooltipRef&&null!==this.tooltipRef&&void 0!==this.spatialExpressionTile&&(this.tooltipRef.referenceElement=this.spatialExpressionTile)}get loadedLayers(){return(0===this.layers.length&&void 0!==this.target?[this.target]:this.layers).filter((e=>e.loaded))}createDefaultGroup(){const e=this.target??this.loadedLayers[0];let t=new Gt(e,"and");return t="group"===this.selectedExpressionType?t.addNewGroup("and"):"spatial"===this.selectedExpressionType?t.addDefaultSpatialExpression(e,this.loadedLayers):t.addDefaultExpression(this.options),t}render(){return(0,s.h)("calcite-dialog",{key:"bd2997a1efa1be05aa2f8ba4a8caea1affe561d1",modal:!0,escapeDisabled:!0,outsideCloseDisabled:!0,open:this.open,class:"query-modal",heading:this.strings.header,ref:e=>this.containerRef=e,onCalciteDialogClose:this.onClose},(0,a.m)(this.docLink)&&(0,s.h)("calcite-action",{key:"55aae5754da6662c92bc75cc9133e97ea87f83c4",text:h.S.helpActionText,icon:"information",scale:a.c.Scale,onClick:()=>{window.open(this.docLink,"_blank")},slot:"header-actions-end"}),this.isOnboarding?this.renderOnboardingContent():this.renderQueryBuilder(),(0,s.h)("calcite-button",{key:"ddce246f126c3d2a26a26c995ce29f554453106d",slot:"footer-end",appearance:"outline",onClick:this.close},this.strings.cancel),(0,s.h)("calcite-button",{key:"7c78513f5f920fe41dd5eec746c98fe2b3ee2bdf","data-testid":"next-add-btn",slot:"footer-end",onClick:this.isOnboarding?this.onOnboardingNextClick:this.onAddClick},this.isOnboarding?this.strings.next:this.strings.add))}renderOnboardingContent(){const e=new Set(this.layers.map(l.l)),t="sql"!==this.mode?Kt:"";return(0,s.h)(s.F,null,(0,s.h)("analysis-query-target-select",{target:this.target,layers:this.loadedLayers,onAnalysisQueryTargetSelectChange:this.onTargetChange,recordsTerm:this.recordsTerm,disabled:"sql"===this.mode}),(0,s.h)("calcite-tile-select-group",{class:Xt},(0,s.h)("calcite-tile-select",{class:t,heading:this.getString(this.strings.attributeExpressionTitle,this.strings.expressionTitle),description:this.getString(this.strings.attributeExpressionDescription,this.strings.expressionDescription),checked:"attribute"===this.selectedExpressionType||void 0,icon:"list-check",value:"attribute",inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),"sql"!==this.mode&&(0,s.h)(s.F,null,(0,s.h)("calcite-tile-select",{class:t,ref:e=>{e&&(this.spatialExpressionTile=e)},heading:this.strings.spatialExpressionTitle,description:this.strings.spatialExpressionDescription,checked:"spatial"===this.selectedExpressionType||void 0,icon:"geographic-link-chart-layout",value:"spatial",disabled:e.size>1==!1,inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType}),e.size>1==!1&&(0,s.h)("calcite-tooltip",{referenceElement:this.spatialExpressionTile,ref:e=>this.tooltipRef=e,overlayPositioning:"fixed",placement:"top"},this.strings.spatialExpressionTwoLayers)),(0,s.h)("calcite-tile-select",{class:t,heading:this.strings.expressionGroupTitle,description:this.strings.expressionGroupDescription,checked:"group"===this.selectedExpressionType||void 0,icon:"group-form-plus",value:"group",inputEnabled:!0,inputAlignment:"end",onCalciteTileSelectChange:this.onSelectExpressionType})))}renderQueryBuilder(){return(0,s.h)("analysis-query-builder",{expressionGroup:this.expressionGroup,layers:this.loadedLayers,mode:this.mode,recordsTerm:this.recordsTerm,onAnalysisQueryChange:this.onQueryChange,onAnalysisQueryError:this.onQueryError,options:this.options})}getString(e,t){return"features"===this.recordsTerm?e:t}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}};Jt.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.query-modal{--calcite-dialog-background-color:var(--calcite-color-foreground-1)}.expression-tile-select-group{justify-content:center}.expression-tile-select-w-third{width:33%}";class Yt{constructor(){this.requestCache={}}getOrPut(e,t){const i=this.requestCache[t];return null==i&&(this.requestCache[t]=e()),this.requestCache[t]}}const ei=class{constructor(e){(0,s.r)(this,e),this.analysisQueryChange=(0,s.c)(this,"analysisQueryChange",7),this.analysisQueryError=(0,s.c)(this,"analysisQueryError",7),this.cache=new Yt,this.recordsTerm="features",this.layers=[],this.onGroupChange=e=>{this.workingExpressionGroup=e.target.expressionGroup,this.analysisQueryChange.emit(this.workingExpressionGroup)},this.onTargetChange=e=>{const t=e.target.target;this.workingExpressionGroup=this.workingExpressionGroup.changeTarget(t),this.analysisQueryChange.emit(this.workingExpressionGroup)},this.resetError=()=>{this.errorMessage=void 0,this.analysisQueryError.emit(this.errorMessage)}}get hasError(){return void 0!==this.errorMessage}async componentWillLoad(){let e;({strings:this.strings,locale:e}=await(0,a.G)(this.hostElement,(0,s.g)("."))),(0,c.s)(this.strings,e),this.workingExpressionGroup=this.expressionGroup.clone()}render(){return(0,s.h)(s.H,{key:"0b47d53a76a1882eba451d2b38587cfbbb4dd0b8"},(0,s.h)("analysis-query-target-select",{key:"540c686f08364a6df5adec53168034a0df6aea9a",target:this.workingExpressionGroup.layer,layers:this.layers,onAnalysisQueryTargetSelectChange:this.onTargetChange,disabled:"sql"===this.mode,recordsTerm:this.recordsTerm}),(0,s.h)("analysis-expression-group",{key:"431fe3cb7628298f49912a82e618cfbfad4dda14",expressionGroup:this.workingExpressionGroup,layers:this.layers,cache:this.cache,onAnalysisExpressionGroupChange:this.onGroupChange,recordsTerm:this.recordsTerm,mode:this.mode,allowedExpressions:"sql"===this.mode?["attribute","group"]:["attribute","group","spatial"],options:this.options}),this.hasError&&(0,s.h)("calcite-notice",{key:"e143c265efaa15d2282146719e15312df99692b1",class:Je,open:!0,kind:"danger",closable:!0,scale:a.c.Scale,width:"auto",onCalciteNoticeClose:this.resetError},(0,s.h)("div",{key:"e31d775437903b6e45a0313e795eec1875835f00",slot:"title"},this.strings.error),(0,s.h)("div",{key:"c0ab8ea16a341cec51b13f9e20b11b2c321ccb99",slot:"message"},this.errorMessage)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}};ei.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.error-notice{margin-top:var(--analysis-half-spacing)}";const ti=class{constructor(e){(0,s.r)(this,e),this.analysisQueryTargetSelectChange=(0,s.c)(this,"analysisQueryTargetSelectChange",7),this.disabled=!1,this.recordsTerm="features",this.layers=[],this.onLayerSelectChange=e=>{const t=e.target.selectedOption.value;this.target=this.layers.find((e=>e.id===t))??this.layers[0],this.analysisQueryTargetSelectChange.emit(this.target)}}async componentWillLoad(){({strings:this.strings}=await(0,a.G)(this.hostElement,(0,s.g)(".")))}render(){const e="records"===this.recordsTerm?this.strings.recordsLabel:this.strings.featuresLabel;return(0,s.h)(s.H,{key:"b613a739e6bb723e06759ea8272f602e842da9d0"},(0,s.h)("calcite-label",{key:"0e028d3f18fa8c50fbbc5628b9429b96e16b9d59"},e,(0,s.h)("calcite-select",{key:"92681c71c802d89c441aa712a599b6d49098daf7",label:e,onCalciteSelectChange:this.onLayerSelectChange,width:"auto",disabled:this.disabled},this.layers.map((e=>(0,s.h)("calcite-option",{value:e.id,selected:this.target.id===e.id,key:e.id},(0,a.N)(e)))))))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,s.a)(this)}};ti.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}:host{display:flex}";const ii="add-btns-container",si="error-message",ai="group-content-container",li="operator-container",ni=class{constructor(e){(0,s.r)(this,e),this.analysisExpressionGroupChange=(0,s.c)(this,"analysisExpressionGroupChange",7),this.allowedExpressions=["attribute","group","spatial"],this.recordsTerm="features",this.depth=0,this.onAddSpatialExpressionClick=()=>{this.expressionGroup=this.expressionGroup.addDefaultSpatialExpression(this.expressionGroup.layer,this.layers),this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onAddAttributeExpressionClick=()=>{this.error=void 0,this.expressionGroup=this.expressionGroup.addDefaultExpression(this.options),this.analysisExpressionGroupChange.emit()},this.onOperatorSelect=e=>{this.expressionGroup.operator=e.target.selectedOption.value,this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onAddGroupClick=()=>{this.expressionGroup=this.expressionGroup.addNewGroup(),this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onRemoveChild=(e,t)=>{this.expressionGroup=this.expressionGroup.removeChild(e),this.error=void 0,this.analysisExpressionGroupChange.emit(),t.stopPropagation()},this.onChildExpressionChange=(e,t)=>{this.expressionGroup.children[e]=t.target.expression,this.error=void 0,this.analysisExpressionGroupChange.emit()},this.onChildSpatialExpressionChange=e=>{const t=e.target.spatialExpression;this.expressionGroup=this.expressionGroup.changeSpatialExpression(t),this.analysisExpressionGroupChange.emit()},this.onChildGroupChange=(e,t)=>{this.expressionGroup.children[e]=t.target.expressionGroup,this.analysisExpressionGroupChange.emit(),t.stopPropagation()}}componentDidRender(){void 0!==this.spatialExpressionButtonTooltipRef&&null!==this.spatialExpressionButtonTooltipRef&&void 0!==this.addSpatialExpressionButtonRef&&(this.spatialExpressionButtonTooltipRef.referenceElement=this.addSpatialExpressionButtonRef)}get hasError(){return void 0!==this.error}componentWillLoad(){this.strings=(0,c.g)()}render(){const e=this.expressionGroup;return(0,s.h)(s.F,{key:"6dda5d27181afbe812353947ec1741476f0da678"},0===this.depth?(0,s.h)(s.F,null,this.renderOperatorContainer(),void 0!==e.spatialExpression&&this.renderSpatialExpression(),this.renderChildExpressions(),this.renderTopLevelButtons()):void 0===e.spatialExpression?(0,s.h)(s.F,null,(0,s.h)("div",{class:ai},this.renderOperatorContainer(),this.renderChildExpressions(),this.renderExpressionDropdown())):(0,s.h)(s.F,null,this.renderSpatialExpression(),this.depth<=2&&(0,s.h)("div",{class:ai},e.children.length>0&&this.renderOperatorContainer(),this.renderChildExpressions(),this.renderExpressionDropdown())),(0,s.h)("calcite-input-message",{key:"0356fcac9e7362622890a5141587e916cd165723",status:"invalid",class:si,scale:a.c.Scale,hidden:!this.hasError,icon:"exclamationMarkTriangle"},this.error))}renderOperatorContainer(){return(0,s.h)("div",{class:li},(0,s.h)("calcite-label",null,this.strings.where,(0,s.h)("calcite-select",{width:"auto",label:this.strings.groupOperatorSelect,onCalciteSelectChange:this.onOperatorSelect},(0,s.h)("calcite-option",{value:je,selected:this.expressionGroup.operator===je},this.strings.andOperatorLabel),(0,s.h)("calcite-option",{value:Ze,selected:this.expressionGroup.operator===Ze},this.strings.orOperatorLabel))))}renderSpatialExpression(){return(0,s.h)("analysis-spatial-expression",{layers:this.layers,spatialExpression:this.expressionGroup.spatialExpression,onAnalysisExpressionChange:e=>this.onChildSpatialExpressionChange(e)})}renderChildExpressions(){return this.expressionGroup.children.map(((e,t)=>e instanceof Gt?(0,s.h)("analysis-query-entry",{kind:"group",appearance:"section",key:e.id,onAnalysisQueryEntryRemove:e=>this.onRemoveChild(t,e)},(0,s.h)("analysis-expression-group",{expressionGroup:e,layers:this.layers,depth:this.depth+1,mode:this.mode,cache:this.cache,allowedExpressions:this.allowedExpressions,options:this.options,onAnalysisExpressionGroupChange:e=>this.onChildGroupChange(t,e)})):(0,s.h)("analysis-attribute-expression",{expression:e,cache:this.cache,target:this.expressionGroup.layer,key:e.id,options:this.options,onAnalysisExpressionChange:e=>this.onChildExpressionChange(t,e),onAnalysisExpressionRemoveClick:e=>this.onRemoveChild(t,e)})))}renderTopLevelButtons(){const e=new Set(this.allowedExpressions);return("analysis"===this.mode&&Nt.getValidSelectingLayers(this.expressionGroup.layer,this.layers).length<1||"sql"===this.mode)&&e.delete("spatial"),(0,s.h)("div",{class:ii},(0,s.h)("calcite-button",{disabled:!1===e.has("attribute"),appearance:"outline-fill",kind:"neutral",iconStart:"plus",onClick:this.onAddAttributeExpressionClick},"features"===this.recordsTerm?this.strings.attributeExpression:this.strings.expression),"sql"!==this.mode&&(0,s.h)(s.F,null,(0,s.h)("calcite-button",{disabled:!1===e.has("spatial"),ref:e=>{e&&(this.addSpatialExpressionButtonRef=e)},appearance:"outline-fill",kind:"neutral",iconStart:"plus",onClick:this.onAddSpatialExpressionClick},this.strings.spatialExpression),!1===e.has("spatial")&&(0,s.h)("calcite-tooltip",{referenceElement:this.addSpatialExpressionButtonRef,ref:e=>this.spatialExpressionButtonTooltipRef=e,overlayPositioning:"fixed",placement:"top"},this.strings.spatialExpressionTwoLayers)),(0,s.h)("calcite-button",{disabled:!1===e.has("group"),appearance:"outline-fill",kind:"neutral",iconStart:"group-form-plus",onClick:this.onAddGroupClick},this.strings.expressionGroup))}renderExpressionDropdown(){const e=new Set(this.allowedExpressions);return this.depth>=2&&e.delete("group"),"analysis"===this.mode&&Nt.getValidSelectingLayers(this.expressionGroup.layer,this.layers).length<1&&e.delete("spatial"),(0,s.h)("calcite-dropdown",{widthScale:"m",overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconStart:"plus",iconEnd:"chevron-down"},this.strings.expression),(0,s.h)("calcite-dropdown-group",null,e.has("attribute")&&(0,s.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:this.onAddAttributeExpressionClick},"features"===this.recordsTerm?this.strings.attributeExpression:this.strings.expression),e.has("spatial")&&(0,s.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:this.onAddSpatialExpressionClick},this.strings.spatialExpression),e.has("group")&&(0,s.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:this.onAddGroupClick},this.strings.expressionGroup)))}get hostElement(){return(0,s.a)(this)}};ni.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.operator-container{display:flex}.group-content-container{width:calc(100% - 2 * var(--analysis-half-spacing) - 2px);padding:var(--analysis-half-spacing);background-color:var(--calcite-color-background);border:1px solid var(--calcite-color-border-1)}.add-btns-container{display:flex;gap:var(--analysis-quarter-spacing)}.error-message{margin-top:var(--analysis-half-spacing)}";const ri="flex-container",oi="half-width",hi="single-value",ci="field-select",di="operator-select",pi="value-select",ui="value-sm";const mi=class{constructor(e){(0,s.r)(this,e),this.analysisExpressionChange=(0,s.c)(this,"analysisExpressionChange",7),this.analysisExpressionRemoveClick=(0,s.c)(this,"analysisExpressionRemoveClick",7),this.defaultMaxDropdownItems=2e3,this.fieldValues=[],this.showUniqueValuesPopover=!1,this.handleUniqueValuesListChange=e=>{const t=e.detail.selectedValues,i=this.parseStringInput(t[0],this.expression.dataType);this.expression=new Ut(this.expression).changeValue(i),this.analysisExpressionChange.emit(),this.showUniqueValuesPopover=!1},this.onRemoveClick=e=>{this.analysisExpressionRemoveClick.emit(),e.stopPropagation()},this.onFieldSelect=e=>{const t=e.target.selectedOption.value,i=this.fields?.find((e=>e.name===t));void 0!==i&&(this.expression=new Ut(this.expression).changeField(i,this.options),!0===this.options?.showDerivedLayerMessage?this.fieldValuesLoadingMessage=this.strings.suggestedValuesNotAvailable:this.loadFieldValues(i.name)),this.analysisExpressionChange.emit()},this.getFieldValuesByUniqueValues=async e=>{const t=`${this.target.id}-${e}`,i=await this.cache.getOrPut((()=>(0,a.aO)({layer:this.target,fieldName:e})),t);return(i?.uniqueValueInfos??[]).map((e=>({value:e.value,count:!0===this.options?.hideUniqueValueCounts?void 0:e.count,label:e.label??`${e.value}`})))},this.onOperatorSelect=e=>{const t=e.target.selectedOption.value;this.expression=new Ut(this.expression).changeOperator(t),this.analysisExpressionChange.emit()},this.onValueInputChange=e=>{const t=e.target.value;this.expression.value=this.parseStringInput(t,this.expression.dataType),this.analysisExpressionChange.emit()},this.onValueComboboxChange=e=>{const t=e.target.value,i=Array.isArray(t)?t[0]:t;this.expression.value=this.parseStringInput(i,this.expression.dataType),this.analysisExpressionChange.emit()},this.onValuesComboboxChange=e=>{st("multi-value"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value,i=(Array.isArray(t)?t:[t]).map((e=>this.parseStringInput(e,this.expression.dataType)));this.expression.value=i.filter((e=>!1===(0,a.d)(e))),this.analysisExpressionChange.emit()},this.onValueDateChange=()=>{const e=this.parseDateValueFromInputs(this.valueDateInputElement,this.valueTimeInputElement);this.expression.value=e,this.analysisExpressionChange.emit()},this.onDateOnlyRangeChange=e=>{st("range"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value;this.expression.value=[this.parseStringInput(t[0],"date-only"),this.parseStringInput(t[1],"date-only")],this.analysisExpressionChange.emit()},this.onRangeStartDateChange=()=>{st("range"===this.expression.type,"Incorrect render function for expression type.");const e=this.parseDateValueFromInputs(this.startDateInputElement,this.startTimeInputElement);this.expression.value[0]=e,this.analysisExpressionChange.emit()},this.onRangeEndDateChange=()=>{st("range"===this.expression.type,"Incorrect render function for expression type.");const e=this.parseDateValueFromInputs(this.endDateInputElement,this.endTimeInputElement);this.expression.value[1]=e,this.analysisExpressionChange.emit()},this.onRangeStartInputChange=e=>{st("range"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value;this.expression.value[0]=this.parseStringInput(t,this.expression.dataType),this.analysisExpressionChange.emit()},this.onRangeEndInputChange=e=>{st("range"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value;this.expression.value[1]=this.parseStringInput(t,this.expression.dataType),this.analysisExpressionChange.emit()},this.onDistanceInputChange=e=>{st("distance"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.value;this.expression=new Ut(this.expression).changeValue({distance:this.parseStringInput(t,"double"),unit:this.expression.value.unit}),this.analysisExpressionChange.emit()},this.onDistanceUnitChange=e=>{st("distance"===this.expression.type,"Incorrect render function for expression type.");const t=e.target.selectedOption.value;this.expression.value.unit=t,this.analysisExpressionChange.emit()},this.parseStringInput=(e,t)=>{let i;return i=(0,a.d)(e)?void 0:tt(t)?""===e?void 0:Number(e):et(t)?""===e?void 0:Math.floor(Number(e)):e,i},this.parseDateValueFromInputs=(e,t)=>{const i=e?.valueAsDate,s=t?.value?t.value.split(":"):[0,0];return new Date(i.getFullYear(),i.getMonth(),i.getDate(),Number(s[0]),Number(s[1]))}}get maxDropdownItems(){return this.options?.maxDropdownItems??this.defaultMaxDropdownItems}get selectedField(){return this.fields?.find((e=>e.name===this.expression?.field))}async loadFields(e){this.loadAbortController?.abort(),this.loadAbortController=new AbortController;try{await(e?.load({signal:this.loadAbortController.signal}))}catch(e){}const t=e?.fields??[];this.fields=t.filter((t=>Bt(t,this.options,e)))}async componentWillLoad(){this.strings=(0,c.g)(),await this.loadFields(this.target),!0===this.options?.showDerivedLayerMessage?this.fieldValuesLoadingMessage=this.strings.suggestedValuesNotAvailable:this.loadFieldValues(this.expression.field)}componentDidRender(){(0,a.m)(this.tooltipRef)&&(0,a.m)(this.uniqueValuesPopoverButtonRef)&&(this.tooltipRef.referenceElement=this.uniqueValuesPopoverButtonRef)}render(){switch(this.expression.type){case"value":return(0,s.h)("analysis-query-entry",{kind:"expression",appearance:"inline",onAnalysisQueryEntryRemove:this.onRemoveClick},(0,s.h)("div",{class:hi},this.renderFieldSelect("auto"),this.renderOperatorSelect("auto"),this.renderValueInput(),this.showUniqueValuesPopover&&this.renderUniqueValuesPopover()));case"multi-value":return(0,s.h)("analysis-query-entry",{kind:"expression",appearance:"section",onAnalysisQueryEntryRemove:this.onRemoveClick},(0,s.h)("div",{class:ri},this.renderFieldSelect("half"),this.renderOperatorSelect("half")),this.renderValuesInput());case"range":return(0,s.h)("analysis-query-entry",{kind:"expression",appearance:"section",onAnalysisQueryEntryRemove:this.onRemoveClick},(0,s.h)("div",{class:ri},this.renderFieldSelect("half"),this.renderOperatorSelect("half")),this.renderRangeInputs());case"distance":return(0,s.h)("analysis-query-entry",{kind:"expression",appearance:"inline",onAnalysisQueryEntryRemove:this.onRemoveClick},(0,s.h)("div",{class:hi},this.renderFieldSelect("auto"),this.renderOperatorSelect("auto"),this.renderDistanceInputs()))}}renderFieldSelect(e="auto"){return(0,s.h)("calcite-select",{class:ci,label:this.strings.fieldSelect,width:e,onCalciteSelectChange:this.onFieldSelect},this.fields?.map((e=>(0,s.h)("calcite-option",{value:e.name,selected:e.name===this.expression?.field},e.alias))))}renderOperatorSelect(e="auto"){const t=function(e){switch(e.dataType){case"string":return pt;case"small-integer":case"integer":case"big-integer":case"single":case"double":case"long":case"oid":return dt;case"date":return ut;case"date-only":return mt;case"geometry":return yt;case"boolean":return gt}}(this.expression),i=void 0!==this.getSelectedFieldDomainOptions(),a=t.filter((e=>!(i&&wt(e)))).filter((e=>{const{useIntervalQueries:t,useExtractDatePartQueries:i}=this.options??{},s=!0!==t&&["in_the_last","not_in_the_last"].includes(e),a=!0!==i&&["this_year","this_month","this_day"].includes(e);return!s&&!a&&"this_day"!==e}));return(0,s.h)("calcite-select",{class:di,label:this.strings.expressionOperatorSelect,key:this.expression.operator,width:e,onCalciteSelectChange:this.onOperatorSelect},a.map((e=>{const t=this.strings.operators[e],i="is_true"===e||"is_false"===e?t.toLocaleLowerCase():t;return(0,s.h)("calcite-option",{value:e,selected:this.expression?.operator===e},i)})))}renderUniqueValuesPopover(e=!1){let t=this.expression.dataType;if("oid"===this.expression.dataType){t=!0===(void 0===this.fieldValues.find((e=>"string"==typeof e.value)))?"integer":this.expression.dataType}let i=!1,a=this.fieldValues;a.length>this.maxDropdownItems&&(i=!0,a=a.slice(0,this.maxDropdownItems));const l=this.numberInputElement.getBoundingClientRect().width;return(0,s.h)("calcite-popover",{autoClose:!0,focusTrapDisabled:!0,placement:"bottom-end",offsetDistance:0,offsetSkidding:0,pointerDisabled:!0,overlayPositioning:"fixed",open:!0,referenceElement:this.numberInputElement,onCalcitePopoverClose:()=>{this.showUniqueValuesPopover=!1},label:this.strings.chooseFromUniqueValues},(0,s.h)("arcgis-common-sql-expression-config-unique-list",{style:{width:`${l}px`},ref:e=>this.filterUniqueRefElement=e,uid:`arcgis-filter-unique-list_${this.expression.field}`,uniqueValues:a,partialUniqueValues:i,selectedValues:[this.expression.value],layerFieldType:t,props:this.filterUniqueRefElement?.props??{layer:this.target,fields:this.target.fields},multiple:e,sortBy:"name",maxHeight:300,onArcgisChanged:this.handleUniqueValuesListChange}))}renderValueInput(){st("value"===this.expression.type,"Incorrect render function for expression type.");const{dataType:e,value:t,operator:i}=this.expression;let l;if(Lt(i))l=null;else if(tt(e)||et(e)){const i=tt(e)?"any":1,n=this.getSelectedFieldMinMax();l=(0,s.h)(s.F,null,(0,s.h)("calcite-input-number",{step:i,placeholder:this.strings.inputPlaceholderText,value:void 0===t?void 0:`${t}`,onCalciteInputNumberChange:this.onValueInputChange,min:n?.min,max:n?.max,ref:e=>{void 0!==e&&(this.numberInputElement=e)}},(0,s.h)("calcite-button",{slot:"action",label:this.strings.chooseFromUniqueValues,ref:e=>this.uniqueValuesPopoverButtonRef=e,disabled:void 0!==this.fieldValuesLoadingMessage,appearance:"outline",kind:"neutral",scale:a.c.MediumScale,iconEnd:"chevron-down",onClick:()=>{this.showUniqueValuesPopover=!this.showUniqueValuesPopover}})),void 0!==this.fieldValuesLoadingMessage&&(0,s.h)("calcite-tooltip",{referenceElement:this.uniqueValuesPopoverButtonRef,ref:e=>this.tooltipRef=e,placement:"bottom",overlayPositioning:"fixed"},this.fieldValuesLoadingMessage))}else l="date-only"===e?(0,s.h)("div",{class:ri},(0,s.h)("calcite-input-date-picker",{placement:"bottom-start",overlayPositioning:"fixed",value:t,onCalciteInputDatePickerChange:this.onValueInputChange})):"date"===e?this.renderValueDateInput():(0,s.h)("calcite-combobox",{class:pi,label:this.strings.choiceList,allowCustomValues:!0,scale:a.c.MediumScale,selectionMode:"single",key:this.expression.operator,value:void 0===t?void 0:`${t}`,placeholder:this.strings.inputPlaceholderText,onCalciteComboboxChange:this.onValueComboboxChange,overlayPositioning:"fixed"},this.renderComboboxItems());return l}renderValuesInput(){st("multi-value"===this.expression.type,"Incorrect render function for expression type.");const e=this.expression.validValues.map((e=>`${e}`));return(0,s.h)("calcite-combobox",{label:this.strings.multiInputPlaceholderText,onCalciteComboboxChange:this.onValuesComboboxChange,allowCustomValues:!0,selectionMode:"multiple",scale:a.c.MediumScale,value:e,key:this.expression.operator,overlayPositioning:"fixed",placeholder:this.strings.inputPlaceholderText,clearDisabled:!0},this.renderComboboxItems())}renderComboboxItems(){const e=[];let t="multi-value"===this.expression.type?this.expression.value:[this.expression.value];t=t.filter((e=>void 0!==e));for(const i of t){const t=`${i}`;e.push((0,s.h)("calcite-combobox-item",{key:t,value:t,textLabel:t,selected:!0}))}if(void 0!==this.fieldValuesLoadingMessage)e.push((0,s.h)("calcite-combobox-item",{key:this.fieldValuesLoadingMessage,value:void 0,textLabel:this.fieldValuesLoadingMessage,selected:!1,disabled:!0}));else{const i=new Set(t),a=this.maxDropdownItems+t.length;for(const t of this.fieldValues)if(i.has(t.value)||e.push((0,s.h)("calcite-combobox-item",{key:t.label,value:`${t.value}`,textLabel:t.label})),e.length>=a){e.push((0,s.h)("calcite-combobox-item",{key:this.strings.tooManyValuesToDisplay,value:void 0,textLabel:this.strings.tooManyValuesToDisplay,selected:!1,disabled:!0}));break}}return(0,s.h)(s.F,null,e)}renderValueDateInput(){st("value"===this.expression.type,"Incorrect render function for expression type.");const{operator:e,value:t}=this.expression,i=t,a=this.parseTimeValue(i),l=["is_on","is_not_on"].includes(e);return(0,s.h)("div",{class:ri},(0,s.h)("calcite-input-date-picker",{key:"value-date",placement:"bottom",class:l?ri:oi,layout:"vertical",overlayPositioning:"fixed",valueAsDate:i,onCalciteInputDatePickerChange:this.onValueDateChange,ref:e=>{this.valueDateInputElement=e}}),!l&&(0,s.h)("calcite-input-time-picker",{key:"value-time",placement:"bottom",class:oi,overlayPositioning:"fixed",value:a,onCalciteInputTimePickerChange:this.onValueDateChange,ref:e=>{this.valueTimeInputElement=e}}))}renderRangeInputs(){st("range"===this.expression.type,"Incorrect render function for expression type.");const{dataType:e,value:t}=this.expression;let i;if(tt(e)||et(e)){const a=tt(e)?"any":1,l=this.getSelectedFieldMinMax();i=(0,s.h)("div",{class:ri},(0,s.h)("calcite-input-number",{step:a,class:oi,value:void 0===t[0]?"":`${t[0]}`,onCalciteInputNumberChange:this.onRangeStartInputChange,min:l?.min,max:l?.max}),(0,s.h)("calcite-input-number",{step:a,class:oi,value:void 0===t[1]?"":`${t[1]}`,onCalciteInputNumberChange:this.onRangeEndInputChange,min:l?.min,max:l?.max}))}else if("date-only"===e){const e=[t[0]??"",t[1]??""];i=(0,s.h)("calcite-input-date-picker",{placement:"bottom-start",overlayPositioning:"fixed",value:e,range:!0,onCalciteInputDatePickerChange:this.onDateOnlyRangeChange})}else i="date"===e?this.renderRangeDateInputs():(0,s.h)("p",null,"Not supported yet.");return i}renderRangeDateInputs(){st("range"===this.expression.type,"Incorrect render function for expression type.");const{value:e}=this.expression,t=e[0],i=e[1],a=this.parseTimeValue(t),l=this.parseTimeValue(i);return(0,s.h)("div",{class:ri},(0,s.h)("calcite-input-date-picker",{key:"start-date",class:oi,placement:"bottom",overlayPositioning:"fixed",valueAsDate:t,onCalciteInputDatePickerChange:this.onRangeStartDateChange,ref:e=>{this.startDateInputElement=e}}),(0,s.h)("calcite-input-time-picker",{key:"start-time",class:oi,placement:"bottom",overlayPositioning:"fixed",value:a,onCalciteInputTimePickerChange:this.onRangeStartDateChange,ref:e=>{this.startTimeInputElement=e}}),(0,s.h)("calcite-input-date-picker",{key:"end-date",class:oi,placement:"bottom",overlayPositioning:"fixed",valueAsDate:i,onCalciteInputDatePickerChange:this.onRangeEndDateChange,ref:e=>{this.endDateInputElement=e}}),(0,s.h)("calcite-input-time-picker",{key:"end-time",class:oi,placement:"bottom",overlayPositioning:"fixed",value:l,onCalciteInputTimePickerChange:this.onRangeEndDateChange,ref:e=>{this.endTimeInputElement=e}}))}renderDistanceInputs(){st("distance"===this.expression.type,"Incorrect render function for expression type."),st("date"===this.expression.dataType||"date-only"===this.expression.dataType,"Incorrect data type.");const{distance:e,unit:t}=this.expression.value;return(0,s.h)(s.F,null,(0,s.h)("calcite-input-number",{step:1,placeholder:this.strings.inputPlaceholderText,value:void 0===e?void 0:`${e}`,onCalciteInputNumberChange:this.onDistanceInputChange,class:ui,min:0}),(0,s.h)("calcite-select",{label:this.strings.expressionDateUnitSelect,onCalciteSelectChange:this.onDistanceUnitChange},Ct[this.expression.dataType].map((i=>(0,s.h)("calcite-option",{value:i,selected:i===t},(0,c.a)(i,e))))))}async loadFieldValues(e){let t=this.getSelectedFieldDomainOptions()??[];if(t.length<1)try{this.fieldValuesLoadingMessage=this.strings.loadingFieldValues,t=await this.getFieldValuesByUniqueValues(e)}catch{return this.fieldValues=[],void(this.fieldValuesLoadingMessage=this.strings.errorRetrievingFieldValues)}this.fieldValues=t.filter((e=>!1===(0,a.d)(e.value))),this.fieldValuesLoadingMessage=this.fieldValues.length<1?this.strings.noFieldValuesRetrieved:void 0}getSelectedFieldMinMax(){let e;const t=this.selectedField?.domain;return"range"===t?.type&&(e={min:t.minValue,max:t.maxValue}),e}getSelectedFieldDomainOptions(){let e;const t=this.selectedField?.name,i=this.selectedField?.domain;if("coded-value"===i?.type)e=i.codedValues.map((e=>({label:e.name,value:e.code})));else if(void 0!==t&&t===this.target?.typeIdField)e=this.target?.types?.map((e=>({label:e.name,value:e.id})));else if(void 0!==t&&(0,a.m)(this.target?.types)){const i=new Map;for(const e of this.target.types){const s=e.domains[t];if("coded-value"===s?.type)for(const e of s.codedValues){const t=i.get(e.code);void 0===t?i.set(e.code,[e.name]):t.includes(e.name)||t.push(e.name)}}if(i.size>0){e=[];for(const[t,s]of i)e.push({label:s.join(" | "),value:t})}}return e}parseTimeValue(e){return e instanceof Date?e.toTimeString().substring(0,5):void 0}get hostElement(){return(0,s.a)(this)}static get watchers(){return{target:["loadFields"]}}};mi.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.flex-container{display:flex}.half-width{width:50%}.single-value{display:flex}.single-value .field-select{max-inline-size:45%}.single-value .operator-select{flex-grow:1}.single-value .value-select{--calcite-combobox-input-height:1rem;min-width:150px}.single-value .value-sm{width:10rem}";const yi="flex-container",gi="flex-grow",vi="layer-select",fi=class{constructor(e){(0,s.r)(this,e),this.analysisExpressionChange=(0,s.c)(this,"analysisExpressionChange",7),this.spatialRelationships=Object.values(Xe),this.spatialRelationshipUnits=Ke,this.onSpatialRelationshipSelect=e=>{const t=e.target.selectedOption.value;this.spatialExpression=this.spatialExpression.changeSpatialRelationship(t);const i=this.spatialExpression.selectingLayer,s=this.spatialRelationshipLayers.get(t),a=s.find((e=>e.id===i.id));this.spatialExpression=void 0!==a?this.spatialExpression.changeSelectingLayer(a):this.spatialExpression.changeSelectingLayer(s[0]),this.analysisExpressionChange.emit()},this.onSpatialRelationshipUnitsSelect=e=>{const t=e.target.selectedOption.value;this.spatialExpression=this.spatialExpression.changeSpatialRelationshipUnit(t),this.analysisExpressionChange.emit()},this.onDistanceInputChange=e=>{const t=parseFloat(e.target.value);this.spatialExpression=this.spatialExpression.changeSpatialRelationshipDistance(t),this.analysisExpressionChange.emit()},this.onLayerSelectChange=e=>{const t=e.target.value,i=this.layers?.find((e=>e.id===t));void 0!==this.layers&&void 0!==i&&(this.spatialExpression=this.spatialExpression.changeSelectingLayer(i)),this.analysisExpressionChange.emit()}}setLayersToSpatialRelationships(e){void 0!==e&&(this.spatialRelationshipLayers=Nt.getValidLayersForRelationships(this.spatialExpression.layer,e,this.spatialRelationships))}componentWillLoad(){this.strings=(0,c.g)(),this.setLayersToSpatialRelationships(this.layers),this.spatialRelationshipLayers=Nt.getValidLayersForRelationships(this.spatialExpression.layer,this.layers??[],this.spatialRelationships)}render(){return(0,s.h)(s.H,{key:"485f1dc673e99d50513e05586742e918bd32dd28"},this.renderSpatialRelationshipSelect(),this.renderLayerSelect())}renderSpatialRelationshipSelect(e="auto"){const t=this.spatialExpression.spatialRelationship;return(0,s.h)("div",{class:yi},(0,s.h)("calcite-select",{class:gi,label:this.strings.spatialRelationshipSelect,width:e,onCalciteSelectChange:this.onSpatialRelationshipSelect},this.spatialRelationships.map((e=>(0,s.h)("calcite-option",{selected:t===e,value:e,key:e,disabled:(0,a.d)(this.spatialRelationshipLayers.get(e))},(0,a.d)(this.spatialRelationshipLayers.get(e))?(0,a.t)(this.strings.spatialRelationships[e],{noCompatibleLayers:this.strings.noCompatibleLayers}):(0,a.t)(this.strings.spatialRelationships[e],{noCompatibleLayers:""}))))),this.spatialExpression.isDistanceRelationship&&this.renderSpatialRelationshipParams())}renderSpatialRelationshipParams(e="auto"){const t=this.spatialExpression.spatialRelationshipParams?.units,i=this.spatialExpression.spatialRelationshipParams?.distance;return(0,s.h)("div",{class:yi},(0,s.h)("calcite-input-number",{class:gi,step:1,placeholder:this.strings.inputPlaceholderText,value:void 0===i?"":`${i}`,onCalciteInputNumberChange:this.onDistanceInputChange}),(0,s.h)("calcite-select",{class:gi,label:this.strings.spatialRelationshipParamsDistanceInput,width:e,onCalciteSelectChange:this.onSpatialRelationshipUnitsSelect},this.spatialRelationshipUnits.map((e=>(0,s.h)("calcite-option",{selected:t===e,value:e,key:e},this.strings.spatialRelationshipUnits[e])))))}renderLayerSelect(e="auto"){const t=this.spatialRelationshipLayers.get(this.spatialExpression.spatialRelationship),i=this.spatialExpression.selectingLayer;return(0,s.h)("calcite-select",{class:vi,label:this.strings.spatialRelationshipLayerSelect,width:e,onCalciteSelectChange:this.onLayerSelectChange},t?.map((e=>(0,s.h)("calcite-option",{value:e.id,key:e.id,selected:i?.id===e.id},(0,a.N)(e)))))}get hostElement(){return(0,s.a)(this)}static get watchers(){return{layers:["setLayersToSpatialRelationships"]}}};fi.style=":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:var(--calcite-color-border-2);--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh;--analysis-popover-z-index:calc(var(--calcite-z-index-overlay) - 1)}.flex-container{display:flex}.flex-container .flex-grow{flex-grow:1}"},52095:(e,t,i)=>{let s,a;function l(e,t="en"){s=e,a=t}function n(){if(void 0===s)throw new Error("Translation strings are not loaded.");return s}i.d(t,{a:()=>o,g:()=>n,s:()=>l});const r=new Map;function o(e,t){const i=`${a}-${e}`;r.has(i)||r.set(i,new Intl.NumberFormat(a,{style:"unit",unit:e,unitDisplay:"long"}));const s=r.get(i).formatToParts(t);return s[s.length-1].value}},69402:(e,t,i)=>{i.d(t,{H:()=>s,S:()=>a});const s={labelContainer:"label-container",action:"action",actionGroup:"action-group",textWrapper:"text-wrapper"},a={helpActionText:"help",showVariableNodes:"variable nodes"}}}]);