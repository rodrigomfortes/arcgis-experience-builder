/*! For license information please see arcgis_analysis_node_modules_arcgis_common-components_dist_components_arcg-44e42a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_common-components_dist_components_arcg-44e42a"],{17898:(e,t,i)=>{i.r(t),i.d(t,{ArcgisCommonCkeditor5:()=>m});var o=i(6364),r=i(61833),n=i(70757),s=i(4395),a=i(91021),c=i(49258),d=i(79388),l=i(95437),g=i(43889);const h=i(55088).AH`@layer{.arcgis-common-ckeditor{max-width:var(--arcgis-common-ckeditor5-max-width);font-family:var(--calcite-font-family);background:var(--calcite-color-foreground-1);border-radius:3px;.ck-source-editing-area,.ck-editor__editable_inline{height:var(--arcgis-common-ckeditor5-initial-height)}&.readOnly{.ck.ck-content.ck-editor__editable{border-radius:0}}&.resizable{.ck.ck-content.ck-editor__editable,.ck-source-editing-area textarea{resize:vertical}}&.generic-code-blocks{.ck.ck-editor__editable pre[data-language]:after,.ck-code-block-dropdown .ck-splitbutton__arrow{display:none}}.ck.ck-toolbar{background-color:#f3f3f3;border-color:var(--calcite-color-border-1)}.ck-editor__editable_inline{overflow-y:scroll;box-sizing:border-box}.ck-content{font-size:var(--calcite-font-size-0);h2{font-size:var(--calcite-font-size-3)}h3{font-size:var(--calcite-font-size-2)}h4{font-size:var(--calcite-font-size-1)}span.mention{background-color:inherit!important;color:inherit!important}ul,ol{padding-inline-start:2rem}}.ck-editor .ck.ck-editor__main>.ck-editor__editable:not(.ck-focused){border-color:var(--calcite-color-border-1)}.ck-source-editing-area{overflow:hidden;textarea{overflow:unset!important}}.ck-editor .ck-source-editing-button{.ck-button__label{display:none!important}}}.ck-body .ck.ck-balloon-panel{box-shadow:val(--calcite-shadow-1);border:1px solid var(--calcite-color-border-1);border-radius:3px;.ck.ck-reset.ck-list.ck-mentions{max-width:var(--arcgis-common-ckeditor5-mentions-max-width)}.arcgis-common-ckeditor-mention-header{font-weight:500;line-height:1.25rem;padding-left:var(--calcite-spacing-lg);padding-top:var(--calcite-spacing-sm);padding-bottom:var(--calcite-spacing-sm);padding-right:var(--calcite-spacing-lg);width:100%;display:block;background-color:var(--calcite-color-background);font-family:var(--calcite-font-family)}}.ck.ck-balloon-panel.ck-tooltip{min-width:auto}.ck.ck-list__item .arcgis-common-ckeditor-mention-item-container.ck-button{--ck-list-button-padding: 0px;padding:0;position:relative!important;border-bottom:1px solid var(--calcite-color-foreground-3)!important;.arcgis-common-ckeditor-mention-item{cursor:pointer!important;display:flex!important;background-color:var(--calcite-color-foreground-1)!important;flex-flow:column!important;padding:var(--calcite-spacing-sm) var(--calcite-spacing-md)!important;transition:background-color calc(.25s / 3) ease-in-out!important;&:hover,&:focus{background-color:var(--calcite-color-foreground-3)!important}.heading{overflow:hidden!important;pointer-events:none!important;text-overflow:ellipsis!important;color:var(--calcite-color-neutral-blk-180)!important;font-family:var(--calcite-font-family)!important}.summary{overflow:hidden!important;pointer-events:none!important;text-overflow:ellipsis!important;color:var(--calcite-color-neutral-blk-180)!important;font-size:var(--calcite-font-size-sm)!important;font-family:var(--calcite-code-family)!important}}&.ck-on .arcgis-common-ckeditor-mention-item{background-color:var(--calcite-color-foreground-3)!important;border-color:#00619b!important;z-index:1!important}}arcgis-common-ckeditor5-popover{.arcgis-common-ckeditor{box-shadow:0 0 #0000;padding:var(--calcite-spacing-lg) var(--calcite-spacing-lg) 0 var(--calcite-spacing-lg)}}}`;class m extends r.WF{constructor(){super(),this.textAreaElement=(0,n._)(),this.actualLanguage="en",this.sanitizer=new d.S({whiteList:{figure:["style","class"],thead:[]},onTagAttr:(e,t,i)=>{if(("src"===t&&"img"===e||"a"===e&&"href"===t||"source"===e&&"src"===t)&&this.mentionFields?.some((e=>e.id===i)))return`${t}="${i}"`}},!0),this.resizeObserver=new ResizeObserver((e=>{const t=e[0];this.currentEditableAreaHeight=t.borderBoxSize[0].blockSize})),this.sourceResizeObserver=new ResizeObserver((e=>{const t=e[0];this.currentSourceAreaHeight=t.borderBoxSize[0].blockSize,this.editor.editing.view.getDomRoot().nextSibling.style.height=`${t.borderBoxSize[0].blockSize}px`})),this.mutationObserver=new MutationObserver((e=>{for(const t of e){const e=t.addedNodes;if(e?.length){const t=Array.from(e).find((e=>e.classList.contains("ck-alignment-dropdown")));t&&this.configureAlignmentTooltips(t.parentElement)}}})),this.editorType="html",this.mentionFields=[],this.intlTextPlaceHolder="",this.intlExpressionsGroupHeading="",this.intlFieldsGroupHeading="",this.currentLanguage="en",this.canResizeVertically=!1,this.groupFieldsAndExpressions=!1,this.arcgisCreated=(0,r.lh)(),this.arcgisDataUpdated=(0,r.lh)(),this.arcgisSourceEditingChanged=(0,r.lh)(),this.listen("input",(e=>{e.target===this.sourceTextarea&&this.editor.plugins.get("SourceEditing").updateEditorData()}))}static{this.properties={editor:16,editorType:1,customConfig:1,textData:1,readOnly:5,mentionFields:0,intlTextPlaceHolder:1,intlExpressionsGroupHeading:1,intlFieldsGroupHeading:1,currentLanguage:1,canResizeVertically:5,groupFieldsAndExpressions:5,customExpressionCheck:0}}static{this.styles=h}static{this.shadowRootOptions=r.Iq}get propClass(){const e=this.readOnly?"readOnly":this.canResizeVertically?"resizable":"",t=this.editor?.config.codeBlock?.languages;return[e,1===t?.length&&"plaintext"===t[0].language?"generic-code-blocks":""].join(" ").trim()}get baseEditor(){return"html"===this.editorType?c.HTMLEditor:c.MarkdownEditor}get baseConfig(){return this.baseEditor.defaultConfig}get additionalConfig(){const e=this.getFields.bind(this),t=this.customItemRenderer.bind(this);return{language:this.actualLanguage,mention:{dropdownLimit:this.mentionFields?.length,feeds:[{marker:"{",feed:e,itemRenderer:t}]}}}async getData(){return"html"===this.editorType?this.postProcessCkeditorHtml():this.editor.getData()}async setFocus(){setTimeout((()=>{this.textAreaElement.value?.focus()}),100)}async load(){let e=this.currentLanguage.toLowerCase(),t=u.find((t=>t===e));if(!t&&e.includes("-")&&(e=e.substring(0,e.indexOf("-")),t=u.find((t=>t===e))),this.actualLanguage=t||"en","en"!==this.actualLanguage){const e=(0,o.g)(`./assets/common-ckeditor5/translations/${this.actualLanguage}.js`);try{const t=await fetch(e);t.ok&&(this.languageScript=document.createElement("script"),this.languageScript.type="text/javascript",this.languageScript.text=await t.text())}catch(e){console.error("Error loading language file:",e)}}}willUpdate(e){e.has("textData")&&this.updateData(this.textData),e.has("readOnly")&&this.readOnlyWatcher(),!this.hasUpdated&&this.editor&&(this.editor.config._config.FieldExpression=this.customConfig.FieldExpression,this.editor.config._config.ArcgisColorPicker=this.customConfig.ArcgisColorPicker)}loaded(){("en"===this.actualLanguage||this.languageScript)&&this.createEditor()}disconnectedCallback(){super.disconnectedCallback(),this.canResizeVertically&&(this.resizeObserver.unobserve(this.editor.ui.view.editable.element),this.sourceResizeObserver.disconnect()),this.mutationObserver.disconnect()}updateData(e){this.editor?.setData(e)}readOnlyWatcher(){this.updateReadOnlyStatus()}async createEditor(){const e="html"===this.editorType?c.HTMLEditor:c.MarkdownEditor,t={...this.baseConfig,...this.additionalConfig,...this.customConfig};try{const i=await e.create(this.textAreaElement.value,t);this.editor=i,this.editor.model.document.on("change:data",(async()=>{this.arcgisDataUpdated.emit(await this.getData())})),this.editor.setData(this.textData??""),this.configureReadOnlySettings(),this.configureSourceEditing(),this.canResizeVertically&&this.configureResizing(),this.arcgisCreated.emit(this.el),this.setUpTooltipReconfiguring()}catch(e){console.error(e.stack)}}configureResizing(){this.resizeObserver.observe(this.editor.ui.view.editable.element),this.editor.ui.focusTracker.on("change:isFocused",(()=>{this.editor.ui.view.editable.element.style.height=`${this.currentEditableAreaHeight}px`}))}configureReadOnlySettings(){const e=this.editor.ui.view.toolbar.element;this.editor.on("change:isReadOnly",((t,i,o)=>{e.style.display=o?"none":"flex"})),this.updateReadOnlyStatus()}setUpTooltipReconfiguring(){this.configureAlignmentTooltips(this.el);const e=this.el.querySelector(".ck-toolbar__grouped-dropdown");e&&e.addEventListener("click",(()=>this.configureAlignmentTooltips(e)));const t=this.el.querySelector(".ck-toolbar__items");t&&this.mutationObserver.observe(t,{childList:!0})}configureAlignmentTooltips(e){const t=(0,a.O)(this.el),i=e?.querySelector(".ck-alignment-dropdown");i&&i.addEventListener("click",(()=>{i.querySelectorAll(".ck-button").forEach((e=>{const o=window.innerWidth-i.getBoundingClientRect().right,r=i.getBoundingClientRect().left;"ltr"===t&&"e"===e.dataset.ckeTooltipPosition?r>o&&(e.dataset.ckeTooltipPosition="w"):"rtl"===t&&"w"===e.dataset.ckeTooltipPosition&&o>r&&(e.dataset.ckeTooltipPosition="e")}))}))}updateReadOnlyStatus(){this.readOnly?this.editor?.enableReadOnlyMode("isReadOnlyProp"):this.editor?.disableReadOnlyMode("isReadOnlyProp")}configureSourceEditing(){const e=this.editor.plugins.get("SourceEditing");e&&e?.on("change:isSourceEditingMode",(()=>{const t=e?.isSourceEditingMode;if(this.arcgisSourceEditingChanged.emit(t),t){const e=this.editor.editing.view.getDomRoot()?.nextSibling;this.sourceTextarea=this.editor.editing.view.getDomRoot()?.nextSibling?.firstChild,this.canResizeVertically&&(e.style.height=`${this.currentEditableAreaHeight}px`,this.sourceTextarea.style.height=`${this.currentEditableAreaHeight}px`,this.sourceResizeObserver.observe(this.editor.editing.view.getDomRoot()?.nextSibling?.firstChild))}else this.canResizeVertically&&(this.sourceResizeObserver.disconnect(),this.editor.ui.view.editable.element.style.height=`${this.currentSourceAreaHeight}px`)}))}updateMentionHeadings(){this.removeMentionHeadings();const e=this.intlExpressionsGroupHeading,t=this.intlFieldsGroupHeading;this.addMentionHeading("[data-first-expression]",e),this.addMentionHeading("[data-first-field]",t)}removeMentionHeadings(){document.querySelectorAll(`.${g.C.arcgisCommonCkeditorMentionHeader}`).forEach((e=>e.remove()))}addMentionHeading(e,t){const i=document.querySelector(e);if(i){const e=document.createElement("div");e.setAttribute("class",g.C.arcgisCommonCkeditorMentionHeader),e.textContent=t,i.parentElement?.insertAdjacentElement("beforebegin",e)}}getFields(e){const t=this.isItemMatching.bind(this,e);return new Promise((e=>{setTimeout((()=>{const i=this.mentionFields?.filter(t),o=i?.filter((e=>this.isExpression(e))),r=i?.filter((e=>!this.isExpression(e)));o.length&&(o[0].isFirstExpression=!0),r.length&&(r[0].isFirstField=!0);const n=o.concat(r);this.groupFieldsAndExpressions&&setTimeout((()=>this.updateMentionHeadings()),10),e(n)}),100)}))}isItemMatching(e,t){const i=e.toLowerCase();return t.name.toLowerCase().includes(i)||t.id.toLowerCase().includes(i)}customItemRenderer(e){const t=document.createElement("div");t.setAttribute("class",`custom-item ${g.C.arcgisCommonCkeditorMentionItemContainer}`),e.isFirstExpression&&t.setAttribute("data-first-expression",""),e.isFirstField&&t.setAttribute("data-first-field","");const i=document.createElement("div");return i.setAttribute("class",g.C.arcgisCommonCkeditorMentionItem),t.appendChild(i),i.innerHTML=`<span class="heading">${e.name}</span><span class="summary">${e.id}</span>`,t.id=`mention-list-item-id-${e.id}`,t.appendChild(i),t}postProcessCkeditorHtml(){const e=this.editor.getData(),t=this.sanitizer.sanitize(e),i=document.createElement("div");i.innerHTML=t;const o=i.querySelectorAll("span.mention");for(let e=0;e<o.length;++e){const t=document.createTextNode(o[e].textContent??"");o[e].parentNode?.replaceChild(t,o[e])}return i.innerHTML}isExpression(e){return this.customExpressionCheck?this.customExpressionCheck(e):this.defaultExpressionCheck(e)}defaultExpressionCheck(e){return e.id.includes(l.f.expression)}render(){return s.qy`${"en"!==this.actualLanguage&&this.languageScript||""}<div class=${`${g.C.arcgisCommonCkeditor} ${this.propClass}`}><textarea placeholder=${(this.readOnly?void 0:this.intlTextPlaceHolder)??r.s6} ${(0,n.K)(this.textAreaElement)}></textarea></div>`}}const u=["af","ar","ast","az","bg","bn","bs","ca","cs","da","de-ch","de","el","en-au","en-gb","eo","es-co","es","et","eu","fa","fi","fr","gl","gu","he","hi","hr","hu","hy","id","it","ja","jv","kk","km","kn","ko","ku","lt","lv","ms","nb","ne","nl","no","oc","pl","pt-br","pt","ro","ru","si","sk","sl","sq","sr-latn","sr","sv","th","tk","tr","tt","ug","uk","ur","uz","vi","zh-cn","zh"];(0,o.c)("arcgis-common-ckeditor5",m)},43889:(e,t,i)=>{i.d(t,{C:()=>o});const o={arcgisCommonCkeditor:"arcgis-common-ckeditor",arcgisCommonCkeditorMentionHeader:"arcgis-common-ckeditor-mention-header",arcgisCommonCkeditorMentionItem:"arcgis-common-ckeditor-mention-item",arcgisCommonCkeditorMentionItemContainer:"arcgis-common-ckeditor-mention-item-container",arcgisCommonCkeditorPopoverContainer:"arcgis-common-ckeditor-popover-container",arcgisCommonCkeditorPopoverFooter:"arcgis-common-ckeditor-popover-footer",popover:"popover"}}}]);