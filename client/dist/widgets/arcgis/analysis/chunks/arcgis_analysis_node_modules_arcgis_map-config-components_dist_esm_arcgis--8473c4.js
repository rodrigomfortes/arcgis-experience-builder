/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--8473c4.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--8473c4"],{34272:(e,t,i)=>{i.r(t),i.d(t,{arcgis_popup_association_config_popover:()=>p});var s=i(11254),o=i(69811),a=i(17840),n=i(53127),r=i(43568),c=(i(56612),i(82780),i(79865)),l=i(14528);const p=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.manager=(0,l.u)(this),this.sourceUtilityNetworkLayerList=[],this.utilityNetworkLayerIdMap=new Map,this.referenceElement=void 0,this.associationsContent=void 0,this.associationType=void 0,this.popupState=void 0}async reposition(){this.popoverNode?.reposition()}async componentWillLoad(){const{popupState:e}=this;this.allUtilityNetworkLayersAndTables=await this.getAllUtilityNetworkLayersAndTables();const{mapView:t,layer:i}=e,{map:a}=t,{utilityNetworks:n}=a,r=(0,c.g)(i);this.currentUtilityNetwork=n.find((e=>e.sourceJSON?.serviceItemId===r)),this.syncUtilityNetworkLayerIdMap();const l=await(0,o.l)();this.layerListHandle=l.watch((()=>a?.allLayers.filter((e=>(0,c.g)(e)===r)).length),(()=>{this.syncUtilityNetworkLayerIdMap(),(0,s.f)(this.el)})),this.tableListHandle=l.watch((()=>a?.allTables.filter((e=>(0,c.g)(e)===r)).length),(()=>{this.syncUtilityNetworkLayerIdMap(),(0,s.f)(this.el)}))}componentDidLoad(){this.arcgisChange.emit(),this.panelNode?.setFocus()}componentDidUpdate(){this.arcgisChange.emit()}disconnectedCallback(){this.layerListHandle?.remove(),this.tableListHandle?.remove()}render(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)(s.H,{key:"3b86442c1b8fdb9509cae3f4a420776a3a2f7184",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"879b0f7d1e998016360feff741bfe715c8e2a34a",referenceElement:this.referenceElement,open:!0,class:"popover",label:t.associations.configureType,placement:"leading-start",pointerDisabled:!0,triggerDisabled:!0,offsetDistance:-Math.round(this.referenceElement.getBoundingClientRect().width),offsetSkidding:50,ref:e=>this.popoverNode=e},(0,s.h)("calcite-panel",{key:"1b24069bed850307aaba22d88ac2cffd53a0162c",closable:!0,style:{width:`${this.referenceElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit(),ref:e=>this.panelNode=e},(0,s.h)("div",{key:"c73a1c4eb56e26b00b0ed465a411b14550d6b2bc",slot:"header-content"},t.associations.configureType),this.renderDoneButton(),(0,s.h)("div",{key:"7f5f6d427c1b2069744b55807ed536e16df0ea52",class:"associations-div"},this.renderAssociationsTypeSelection(),this.renderAssociationsFilterForLayerSelection(),this.renderAssociationsDisplayOptions()))))}renderAssociationsTypeSelection(){const{popupState:e}=this,{strings:t}=e,{associationsContent:i,associationType:o}=this,a=i.associationTypes.map((e=>e.type)),n=r.a.filter((e=>o.type===e||!a.includes(e))).map((e=>{const t=this.getAssociationTypeString(e);return(0,s.h)("calcite-combobox-item",{value:e,heading:t,selected:e===o.type})}));return(0,s.h)("calcite-label",null,t.associations.type,(0,s.h)("calcite-combobox",{label:t.associations.type,scale:"s",selectionMode:"single-persist",clearDisabled:!0,onCalciteComboboxChange:e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()},ref:e=>this.typeComboboxNode=e,overlayPositioning:"fixed"},n))}renderAssociationsFilterForLayerSelection(){const{popupState:e}=this,{strings:t}=e;return this.syncUtilityNetworkLayerIdMap(),this.setSourceLayerList(),(0,s.h)("calcite-label",null,t.associations.layer,(0,s.h)("calcite-combobox",{label:t.associations.layer,scale:"s",selectionMode:"single-persist",placeholder:t.associations.optionalLayerSelection,onCalciteComboboxChange:e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()},ref:e=>this.layerComboboxNode=e,overlayPositioning:"fixed"},this.sourceUtilityNetworkLayerList))}renderAssociationsDisplayOptions(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)("calcite-block-section",{open:!0,text:t.options},(0,s.h)("div",{class:"options-block"},this.renderTitle(),this.renderDescription()))}renderTitle(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)("calcite-label",{scale:"s"},t.title,(0,s.h)("calcite-input",{type:"text",ref:e=>this.titleNode=e,value:this.associationType.title,placeholder:t.enterTitle,onCalciteInputInput:(0,n.d)((e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()}),300)}))}renderDescription(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)("calcite-label",{scale:"s"},t.desc,(0,s.h)("calcite-input",{type:"text",ref:e=>this.descriptionNode=e,value:this.associationType.description,placeholder:t.enterDescription,onCalciteInputInput:(0,n.d)((e=>{e.preventDefault(),e.stopPropagation(),this.changeAssociationProperties()}),300)}))}renderDoneButton(){const{popupState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{appearance:"outline-fill",slot:"footer",width:"full",onClick:()=>this.closePopupPopovers.emit()},t.done)}async getAllUtilityNetworkLayersAndTables(){const{popupState:e}=this,{layer:t}=e,i="url"in t&&t.url||"portalItem"in t&&t.portalItem?.url;try{const e=await(0,o.p)(),t=await e(i,{responseType:"json",method:"auto",query:{f:"json"}}),s=[...t?.data?.layers||[],...t?.data?.tables||[]];return Promise.resolve(s)}catch(e){return await Promise.resolve([])}}syncUtilityNetworkLayerIdMap(){const{popupState:e}=this,{mapView:t,layer:i}=e,{map:s}=t,{allUtilityNetworkLayersAndTables:o,currentUtilityNetwork:a}=this;this.utilityNetworkLayerIdMap.clear();const n=(0,c.g)(i),r=s?.allLayers.flatten((e=>"sublayers"in e?e.sublayers:null))??[],l=[...r,...s?.allTables.flatten((e=>"sublayers"in e?e.sublayers:null))??[]].filter((e=>(0,c.g)(e)===n));l.forEach((e=>{const t="subtype-sublayer"===e.type?e.parent.layerId:e.layerId,i=o.find((e=>e.id===t)).name;this.utilityNetworkLayerIdMap.set(t,i)}));const p=this.associationType.associatedNetworkSourceId,d=a.getLayerIdBySourceId(p);this.utilityNetworkLayerIdMap.has(d)||(this.associationType.associatedNetworkSourceId=null)}setSourceLayerList(){const{allUtilityNetworkLayersAndTables:e,currentUtilityNetwork:t,associationType:i}=this;this.sourceUtilityNetworkLayerList=e.filter((e=>(0,a.i)(this.utilityNetworkLayerIdMap.get(e.id))&&(0,a.i)(t.getSourceIdByLayerId(e.id)))).map((e=>{const o=this.utilityNetworkLayerIdMap.get(e.id),a=t.getSourceIdByLayerId(e.id);return(0,s.h)("calcite-combobox-item",{value:a,heading:o,selected:i.associatedNetworkSourceId===a})}))}changeAssociationProperties(){this.associationType.title=this.titleNode.value,this.associationType.description=this.descriptionNode.value,this.associationType.type=this.typeComboboxNode.selectedItems[0]?.value,this.associationType.associatedNetworkSourceId=this.layerComboboxNode.selectedItems[0]?.value??null,(0,s.f)(this.el)}getAssociationTypeString(e){const{popupState:t}=this,{strings:i}=t;switch(e){case"attachment":return i.associations.attachment;case"connectivity":return i.associations.connectivity;case"container":return i.associations.container;case"content":return i.associations.content;case"structure":return i.associations.structure}}get el(){return(0,s.a)(this)}};p.style=".popover{--calcite-popover-z-index:100}.associations-div{background-color:var(--calcite-color-foreground-1);padding:var(--calcite-spacing-sm);max-height:calc(60vh - 102px);}.options-block{margin-top:var(--calcite-spacing-sm)}"},43568:(e,t,i)=>{i.d(t,{a:()=>s,b:()=>o});const s=["attachment","connectivity","container","content","structure"];var o;!function(e){e.title="title",e.description="description",e.displayCount="displayCount"}(o||(o={}))},53127:(e,t,i)=>{i.d(t,{a:()=>o,d:()=>s,t:()=>a});const s=(e,t)=>{let i,s="idle";const o=async(...o)=>await new Promise((a=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),a(e(...o))):a(null);break;case"invoked":clearTimeout(i),s="idle",a(e(...o));break;case"cancelled":clearTimeout(i),s="idle",a(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>{s="idle",a(e(...o))}),t)}}));return o.flush=async function(...e){return s="flushed",await o(...e)},o.invoke=async function(...e){return s="invoked",await o(...e)},o.cancel=async function(...e){return s="cancelled",await o(...e)},o.getStatus=function(){return s},o},o=(e,t)=>{let i;return async(...s)=>await new Promise((o=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,o(e(...s))}),t))}))};function a(e){return new Promise((t=>setTimeout(t,e)))}},79865:(e,t,i)=>{function s(e){const{mapView:t,layer:i,portal:s}=e,{map:a}=t,{portalHostname:n}=s;if(!a)return!1;const{utilityNetworks:r}=a;if(!r)return!1;const c=s.isPortal,l="1"===window.localStorage.getItem("utility-networks-agol")&&("devext.arcgis.com"===n||"qaext.arcgis.com"===n);if(!c&&!l)return!1;const p=o(i),d=r.find((e=>e.sourceJSON?.serviceItemId===p));if(!d)return!1;return d.isUtilityLayer(i)}function o(e){return"subtype-sublayer"===e.type?e.parent.serviceItemId:e.serviceItemId}i.d(t,{g:()=>o,i:()=>s})},82780:(e,t,i)=>{var s,o,a,n;i.d(t,{A:()=>o,C:()=>s,I:()=>n,P:()=>a}),function(e){e.ATTRIBUTES="attributes",e.ATTACHMENTS="attachments",e.CHARTS="charts",e.IMAGES="images",e.RICH_TEXT="richText",e.ARCADE="arcade",e.RELATIONSHIP="relationship",e.ASSOCIATIONS="associations",e.EDIT_INFO_SUMMARY="editInfoSummary"}(s||(s={})),function(e){e.PREVIEW="preview",e.LIST="list",e.AUTO="auto"}(o||(o={})),function(e){e.IMAGE="image",e.BAR_CHART="bar-chart",e.COLUMN_CHART="column-chart",e.LINE_CHART="line-chart",e.PIE_CHART="pie-chart"}(a||(a={})),function(e){e.SOURCE_URL="sourceUrl",e.TITLE="title",e.CAPTION="caption",e.LINK_URL="linkUrl",e.ALT_TEXT="altText"}(n||(n={}))}}]);