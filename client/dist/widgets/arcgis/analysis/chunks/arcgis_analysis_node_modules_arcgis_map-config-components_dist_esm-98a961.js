/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-98a961.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-98a961"],{8339:(e,t,i)=>{i.r(t),i.d(t,{arcgis_aggregation_fields:()=>u,arcgis_aggregation_scale_threshold_slider:()=>h,arcgis_aggregation_symbol_styler_popover:()=>g});var s=i(11254),n=i(36239),r=i(32416),o=(i(56612),i(69811)),a=i(14528),l=i(44735),c=i(10465),d=i(56255);const u=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcgisBackClick=(0,s.c)(this,"arcgisBackClick",7),this.manager=(0,a.u)(this),this.mapView=void 0,this.layer=void 0,this.portal=void 0,this.strings=void 0,this.flowNode=void 0,this.hideLayerTitle=!1,this.autoGeneratedPieChartClusterFields=void 0,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async done(){this.closePopovers()}async setFocus(){this.flowItemNode?.setFocus()}async componentWillLoad(){const[e,t]=await Promise.all([(0,o.e)(),(0,o.f)()]);this.modules={AggregateField:e,FieldInfo:t}}componentDidLoad(){this.flowItemNode?.setFocus()}disconnectedCallback(){this.closePopovers()}render(){const{layer:e,strings:t,hideLayerTitle:i}=this,n=e.featureReduction.fields;return(0,s.h)(s.H,{key:"309c086196d9b4113859d53bc31452a4e3d15a3f",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"c295ab5e19e9b51259969f7257bc11d582b852d9",heading:"binning"===e.featureReduction.type?t.bin.binAttributesHeading:t.cluster.clusterAttributesHeading,description:i?void 0:e.title??void 0,showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemBack:()=>this.arcgisBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderStatsFieldsNotice(n),(0,s.h)("div",{key:"4d27c5e8c777df0eaf7bace035fd6aa45114fb0f",class:"fields"},n?.map(((e,t)=>this.renderStatsField(e,t)))),this.renderAddField()))}renderStatsFieldsNotice(e){const{strings:t}=this;return e?.length?(0,s.h)(s.F,null):(0,s.h)("calcite-card",{class:"stats-fields-notice"},(0,s.h)("div",{slot:"heading"},t.fields.msgTitle),(0,s.h)("div",{slot:"description"},t.fields.msg))}renderStatsField(e,t){const{layer:i,mapView:n,portal:o,selectedFieldName:a,modules:l,strings:c,autoGeneratedPieChartClusterFields:d}=this;(0,r.a)(e,i,l);const u=d?.includes(e.name);return(0,s.h)("arcgis-aggregation-field",{layer:i,mapView:n,portal:o,strings:c,aggregateField:e,isAutoGeneratedPieChartClusterField:u,open:a===e.name,onArcgisChange:()=>{this.selectedFieldName=e.name,i.featureReduction.fields[t]=e,this.arcgisChange.emit(),(0,s.f)(this.el)},onArcgisDelete:()=>{this.selectedFieldName=void 0,this.arcgisChange.emit(),(0,s.f)(this.el),setTimeout((()=>{this.fabNode?.setFocus()}),300)}})}renderAddField(){const{strings:e}=this;return this.checkAllFieldsAdded()?(0,s.h)(s.F,null):(0,s.h)("calcite-fab",{slot:"fab",appearance:"outline-fill",kind:"neutral",scale:"s",icon:"plus",textEnabled:!0,text:e.fields.addField,onClick:()=>this.addStatsField(),ref:e=>this.fabNode=e})}checkAllFieldsAdded(){const{layer:e}=this,t=(0,r.g)(e);let i=0,s=(0,r.b)(t[i]),n=0,o=(0,r.h)(e,t[i].name,s[n]);for(;i<t.length&&o;){for(;n<s.length&&o;)n++,n<s.length&&(o=(0,r.h)(e,t[i].name,s[n]));o&&(i++,i<t.length&&(s=(0,r.b)(t[i]),n=0,o=(0,r.h)(e,t[i].name,s[n])))}return o}addStatsField(){const{layer:e,strings:t,modules:i}=this,{AggregateField:o}=i,a=(0,r.g)(e);let l=0,c=(0,r.b)(a[l]),d=0,u=(0,r.h)(e,a[l].name,c[d]);for(;l<a.length&&u;){for(;d<c.length&&u;)d++,d<c.length&&(u=(0,r.h)(e,a[l].name,c[d]));u&&(l++,l<a.length&&(c=(0,r.b)(a[l]),d=0,u=(0,r.h)(e,a[l].name,c[d])))}const h=a[l],g=c[d],f=new o({name:`${h.name}_${g}`,onStatisticField:h.name,alias:`${h.alias||h.name} ${(0,n.h)(g,t).toLocaleLowerCase()}`,statisticType:g,visible:!0}),m=e.featureReduction;m.fields=m.fields||[],m.fields.push(f),(0,r.a)(f,e,i),this.selectedFieldName=f.name,(0,s.f)(this.el)}closePopovers(){this.attributesFormattingNode&&(document.body.removeChild(this.attributesFormattingNode),this.attributesFormattingNode=void 0)}get el(){return(0,s.a)(this)}};u.style=":host{display:none}:host([selected]){display:flex}.stats-fields-notice{margin:var(--calcite-spacing-lg)}.fields{background-color:var(--calcite-color-foreground-1)}.field-icon{padding:0 var(--calcite-spacing-lg);display:flex;align-items:center}";const h=class{constructor(e){(0,s.r)(this,e),this.manager=(0,a.u)(this),this.view=void 0,this.layer=void 0,this.portal=void 0,this.strings=void 0}async componentDidLoad(){const e=await(0,o.j)();(0,l.i)(this.el.shadowRoot,e)}render(){const{strings:e}=this;return(0,s.h)(s.H,{key:"a8e385057d87f06631dcc5b4e2aa4019cfdffa10"},(0,s.h)("div",{key:"e3afc27f8c1e3c01abf5f8a6e9ce23b0f51cfaad",class:"slider-title-wrapper"},(0,s.h)("calcite-label",{key:"563f91947db94bcddec8eb1decc3c4e3cc2117c7",class:"slider-heading"},e.cluster.scaleThreshold),(0,s.h)("div",{key:"55c579b9fd0e287291320382626bb07b288448fd",class:"slider-div"},(0,s.h)("div",{key:"87c2037982413e7fe5f040ad39fde51f650b9cde",ref:e=>{e&&this.addScaleRangeSlider(e)}}))))}async addScaleRangeSlider(e){const{layer:t,strings:i}=this,{view:s,portal:n}=this,r=n?.region||"wo",{scaleRangeSlider:a}=this;if(!a&&t){const n=await(0,o.aH)();this.scaleRangeSlider=new n({label:i.cluster.scaleThreshold,view:s,layer:t,region:r,mode:"max-scale-only"});let a=!0;if(this.scaleRangeSlider.watch("maxScale",(async e=>{a?(this.scaleRangeSlider.viewModel.sliderViewModel.values=[this.scaleRangeSlider.viewModel.mapScaleToSlider(t.featureReduction.maxScale)],a=!1):t.featureReduction.maxScale=e})),!this.scaleRangeSlider.container){const t=document.createElement("div");e.append(t),this.scaleRangeSlider.container=t}}}get el(){return(0,s.a)(this)}};h.style=".slider-title-wrapper{background-color:var(--calcite-color-foreground-1);border-bottom:1px solid var(--calcite-color-foreground-3);padding:var(--calcite-spacing-lg)}.slider-heading{display:inline-block;padding:var(--calcite-spacing-sm) 0}.esri-scale-range-slider{min-width:50px}";const g=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcgisClose=(0,s.c)(this,"arcgisClose",7),this.manager=(0,a.u)(this),this.referenceElement=void 0,this.props=void 0}async reposition(){this.popoverNode?.reposition()}async setFocus(){this.closeActionNode?.setFocus()}async componentWillLoad(){const[e,t,i,s,n]=await Promise.all([(0,o.a4)(),(0,o.am)(),(0,o.ab)(),(0,o.az)(),(0,o.aA)()]);this.modules={symbolUtils:e,cimSymbolUtils:t,Color:i,SimpleMarkerSymbol:s,SimpleLineSymbol:n}}render(){const{props:e,referenceElement:t}=this,{strings:i}=e;return(0,s.h)(s.H,{key:"cc1a1cd7d3144f144f4943433db82996dc3a5011",class:"js-app-flyout arcgis-aggregation-popover"},(0,s.h)("calcite-popover",{key:"eb92ad2efb520e359c3ef7951a9db699210477a1",open:!0,placement:"leading-start",offsetDistance:0,offsetSkidding:45,pointerDisabled:!0,label:i.symbolStyle,referenceElement:t,triggerDisabled:!0,class:"popover",ref:e=>this.popoverNode=e},(0,s.h)("calcite-panel",{key:"c1f3eebcb4539811c8d4c334d663a2edfc5d17ff",heading:i.symbolStyle,closable:!1},(0,s.h)("div",{key:"9544c1ec6a1b22820ca4c532531de988a8a78251",slot:"header-content"},i.symbolStyle),(0,s.h)("calcite-action",{key:"d363ff0458aba9763e91ec58b29cf89750418cd2",slot:"header-actions-end",scale:"s",icon:"x",text:i.close,onClick:()=>this.arcgisClose.emit(),ref:e=>this.closeActionNode=e}),(0,s.h)("div",{key:"ff95f9bc5447f9e90cd20f6d526ff7e63edc7f7e",class:"symbol-styler-div",ref:e=>{e&&this.buildSymbolStyler(e)}}))))}async buildSymbolStyler(e){const{props:t,modules:i}=this,{layer:s,portal:n}=t,{Color:r}=i;let o=s.featureReduction.symbol;(0,d.i)(o)||(o=(0,d.g)(i));const a="picture-marker"!==o.type&&!!o.color,l=(0,d.h)(o),u="cim"===o.type&&"CIMPointSymbol"===o.data.symbol.type,h="rtl"===(0,c.b)(this.el);let g;if("simple-marker"===o.type){const e=o;g=e.outline?{color:e.outline.color?e.outline.color:new r([0,0,0,.5]),size:e.outline.width}:{color:new r([0,0,0,.5]),size:1}}else g="cim"===o.type?void 0:{color:new r([255,255,255,.5]),size:1};const f=document.createElement("arcgis-map-config-symbol-styler");f.popoverProps={placement:"bottom-end",offsetDistance:10,offsetSkidding:h?3:-3,refElement:this.closeActionNode};const m=this.referenceElement.getBoundingClientRect();if(m?.bottom){const e=45,t=53,i=20,s=(m?.top??0)+e+t+i+(window.innerHeight-(m?.bottom??0));f.style=`max-height: max(calc(100vh - ${s}px), 200px)`}const p=f.edit(o.clone(),{portal:n,symbolFilter:void 0,sections:{marker:u||["simple-marker","picture-marker"].includes(o.type)?{open:!0,symbolsOpen:!0,sizeOpen:!0,parts:{size:!1},markerType:"all"}:void 0,fill:{type:"color",optional:!0,open:!0,suggestedColorsOpen:!0,transparencyOpen:(0,d.a)(o,i)},stroke:{type:"color",optional:!0,extraParts:{style:!["simple-marker","picture-marker","cim"].includes(o.type),width:!0}}},fill:{color:(0,d.b)(o,i)||(0,d.c)(new r("#ff8200"),.85)},marker:{size:(0,d.d)(o,i)},stroke:g,fillEnabled:a,strokeEnabled:l});f.addEventListener("arcgisEdit",(e=>this.handleSymbolChange(e))),e.appendChild(f),await p}handleSymbolChange({detail:{symbol:e}}){const{props:t}=this,{layer:i}=t;i.featureReduction.symbol=e,this.arcgisChange.emit()}get el(){return(0,s.a)(this)}};g.style=".popover{--calcite-popover-z-index:100}.symbol-styler-div{width:328px;height:100%;overflow-y:auto;overflow-x:hidden}"},10465:(e,t,i)=>{i.d(t,{D:()=>s,a:()=>u,b:()=>l,c:()=>a,g:()=>y,s:()=>w});class s{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}const n=(e,t,i)=>(0,o(t).subscribe)((t=>{const s=t.some((t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target)));s&&i()})),r={},o=e=>{const t=e.join(","),i=r[t];if(void 0!==i)return i;const s=new Set,n=new MutationObserver((e=>s.forEach((t=>t(e)))));globalThis.document&&n.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const o={subscribe:e=>(s.add(e),()=>{s.delete(e),0===s.size&&(n.disconnect(),r[t]=void 0)})};return r[t]=o,o},a=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const s=i.getRootNode?.();if(s===globalThis.document)return null;i=s.host}return null},l=e=>c(e,"dir","ltr"),c=(e,t,i)=>{const s=a(e,`[${t}]`);return s?.getAttribute(t)??i},d=e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},u=()=>[d(2),d(1),d(1),d(1),d(3)].join("-"),h="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),g=new Set(h),f="en",m={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},p={},b=async(e,t)=>{const i=`${t}${e}.json`;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===f?{}:await b(f,t)},y=e=>{const t=c(e,"lang",globalThis.navigator?.language||f);return{lang:t,t9nLocale:v(t)}},v=e=>{const[t,i]=e.split("-"),s=t.toLowerCase();let n=s;return i&&(n=`${s}-${i.toUpperCase()}`),n=m[n]??n,g.has(n)?n:i?v(s):f},w=(e,t,i,s)=>{let r;const o=()=>S(e,t(),s).then((e=>{r?.lang===e.lang&&r.t9nLocale===e.t9nLocale&&r.t9nStrings===e.t9nStrings||i(e),r=e})).catch(console.error);return queueMicrotask(o),n(e,["lang"],o)},S=async(e,t,i=e.localName.split("-").slice(1).join("-"))=>{const{lang:s,t9nLocale:n}=y(e),r=`${t}/${i}/t9n`,o=null===i?{}:await(async(e,t,i="")=>{const s=`${t}/${i}`,n=`${s}${e}.json`;return p[n]??(p[n]=b(e,s)),await p[n]})(n,r,"messages.");return{lang:s,t9nLocale:n,t9nStrings:o}}},32416:(e,t,i)=>{function s(e){return e.fields.filter((e=>["small-integer","big-integer","integer","single","double","long","number","string"].includes(e.type)))}function n(e,t){if(t)return e.fields.find((e=>e.name===t))}function r(e,t,i){const s=e.featureReduction;return!!s.fields?.find((e=>e.onStatisticField===t&&e.statisticType===i))}function o(e,t,i,s){const n=t.substring(0,t.lastIndexOf(`_${i}`)),r=e.featureReduction;return!!r.fields?.find((e=>e.name.substring(0,e.name.lastIndexOf(`_${s}`))===n&&e.statisticType===s))}function a(e,t){return!l(n(e,t)).find((i=>!r(e,t,i)))}function l(e){return["string","date","timestamp-offset"].includes(e.type)?["mode"]:["sum","avg","min","max","mode"]}function c(e,t){return e.featureReduction.popupTemplate.fieldInfos.find((e=>e.fieldName===t))}function d(e,t,i){const{FieldInfo:s}=i,n=t.featureReduction,{popupTemplate:r}=n;r.fieldInfos=r.fieldInfos||[];r.fieldInfos.find((t=>t.fieldName===e.name))||r.fieldInfos.push(new s({fieldName:e.name,label:e.alias,isEditable:!1,visible:!0,format:u(e,t)}))}function u(e,t){const i=e.onStatisticField,s=e.onStatisticExpression,r="sum"===e.statisticType,o="count"===e.statisticType,a=n(t,i),l=o||s&&r||a&&["small-integer","big-integer","integer","long","number"].includes(a.type);return a&&["single","double"].includes(a.type)?{digitSeparator:!0,places:1}:l?{digitSeparator:!0}:void 0}i.d(t,{a:()=>d,b:()=>l,c:()=>c,d:()=>n,e:()=>o,g:()=>s,h:()=>r,i:()=>a})},36239:(e,t,i)=>{i.d(t,{A:()=>c,a:()=>l,b:()=>r,c:()=>o,d:()=>s,e:()=>n,f:()=>a,g:()=>d,h:()=>h,i:()=>u});const s=9,n=90,r=37.5,o=9,a=90,l=37.5;var c;function d(e){const t=e.featureReduction;if(t)return"binning"===t.type?"binning":"cluster"===t.type?function(e){const t=e.featureReduction;return!!t.renderer&&"pie-chart"===t.renderer.type&&!t?.renderer?.authoringInfo?.isAutoGenerated}(e)?"pie-chart":"cluster":void 0}function u(e){const t=e.featureReduction;return!t?.renderer||!!t?.renderer?.authoringInfo?.isAutoGenerated}function h(e,t){switch(e){case"sum":return t.fields.sum;case"avg":return t.fields.mean;case"min":return t.fields.min;case"max":return t.fields.max;case"stddev":return t.fields.stdDev;case"mode":return t.fields.mode;case"var":return t.fields.var;case"count":return t.fields.count;default:return""}}!function(e){e.CLUSTERING="clustering",e.CHART_CLUSTERING="chartClustering",e.BINNING="binning"}(c||(c={}))},44735:(e,t,i)=>{function s(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}i.d(t,{i:()=>s})},56255:(e,t,i)=>{function s(e){return["simple-fill","simple-marker","simple-line","picture-marker","cim"].includes(e.type)}function n(e,t){return"picture-marker"===e.type||"cim"===e.type&&!function(e,t){const{cimSymbolUtils:i}=t;return!!i.getCIMSymbolColor(e)}(e,t)}function r(e){const{SimpleLineSymbol:t,SimpleMarkerSymbol:i,Color:s}=e;return new i({style:"circle",size:6.75,outline:new t({style:"solid",color:new s([92,92,92,64]),width:1}),color:new s([227,139,79,255])})}function o(e){return"picture-marker"!==e.type&&("cim"!==e.type&&!!e.outline?.color)}function a(e,t){const{cimSymbolUtils:i,Color:s}=t;return"cim"===e?.type?s.fromJSON(i.getCIMSymbolColor(e)?.toJSON()):"simple-marker"===e?.type&&["x","cross"].includes(e?.style)?e?.outline?.color:e?.color}function l(e,t){const{cimSymbolUtils:i}=t;return"cim"===e.type?i.getCIMSymbolSize(e):e.size?e.size:e.width}function c(e,t){return e.a=t,e}i.d(t,{a:()=>n,b:()=>a,c:()=>c,d:()=>l,g:()=>r,h:()=>o,i:()=>s})},56612:(e,t,i)=>{var s,n,r,o;i.d(t,{a:()=>o,f:()=>s,l:()=>n,s:()=>r}),function(e){e.expression="expression/",e.raster="Raster.",e.relationship="relationships/"}(s||(s={})),function(e){e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes"}(n||(n={})),function(e){e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms"}(r||(r={})),function(e){e.bigInteger="big-integer",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset"}(o||(o={}))}}]);