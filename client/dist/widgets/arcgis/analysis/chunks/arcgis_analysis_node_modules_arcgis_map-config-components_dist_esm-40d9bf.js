/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-40d9bf.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-40d9bf"],{10465:(t,i,e)=>{e.d(i,{D:()=>n,a:()=>h,b:()=>c,c:()=>r,g:()=>v,s:()=>C});class n{constructor(){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i}))}}const s=(t,i,e)=>(0,o(i).subscribe)((i=>{const n=i.some((i=>((t,i)=>{let e=t;for(;e;){if(e===i)return!0;if(!e.parentNode)return!1;e=e.parentNode instanceof ShadowRoot?e.parentNode.host:e.parentNode}return!1})(t,i.target)));n&&e()})),a={},o=t=>{const i=t.join(","),e=a[i];if(void 0!==e)return e;const n=new Set,s=new MutationObserver((t=>n.forEach((i=>i(t)))));globalThis.document&&s.observe(document.documentElement,{attributes:!0,attributeFilter:t,subtree:!0});const o={subscribe:t=>(n.add(t),()=>{n.delete(t),0===n.size&&(s.disconnect(),a[i]=void 0)})};return a[i]=o,o},r=(t,i)=>{let e=t;for(;e;){const t=e.closest?.(i);if(t)return t;const n=e.getRootNode?.();if(n===globalThis.document)return null;e=n.host}return null},c=t=>l(t,"dir","ltr"),l=(t,i,e)=>{const n=r(t,`[${i}]`);return n?.getAttribute(i)??e},p=t=>{let i="";for(let e=0;e<t;e++)i+=(65536*(1+Math.random())|0).toString(16).substring(1);return i},h=()=>[p(2),p(1),p(1),p(1),p(3)].join("-"),g="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),d=new Set(g),u="en",f={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},m={},b=async(t,i)=>{const e=`${i}${t}.json`;try{const t=await fetch(e);if(t.ok)return await t.json()}catch(t){return console.error(t),{}}return t===u?{}:await b(u,i)},v=t=>{const i=l(t,"lang",globalThis.navigator?.language||u);return{lang:i,t9nLocale:S(i)}},S=t=>{const[i,e]=t.split("-"),n=i.toLowerCase();let s=n;return e&&(s=`${n}-${e.toUpperCase()}`),s=f[s]??s,d.has(s)?s:e?S(n):u},C=(t,i,e,n)=>{let a;const o=()=>w(t,i(),n).then((t=>{a?.lang===t.lang&&a.t9nLocale===t.t9nLocale&&a.t9nStrings===t.t9nStrings||e(t),a=t})).catch(console.error);return queueMicrotask(o),s(t,["lang"],o)},w=async(t,i,e=t.localName.split("-").slice(1).join("-"))=>{const{lang:n,t9nLocale:s}=v(t),a=`${i}/${e}/t9n`,o=null===e?{}:await(async(t,i,e="")=>{const n=`${i}/${e}`,s=`${n}${t}.json`;return m[s]??(m[s]=b(t,n)),await m[s]})(s,a,"messages.");return{lang:n,t9nLocale:s,t9nStrings:o}}},44109:(t,i,e)=>{e.r(i),e.d(i,{arcgis_map_config_ips:()=>c});var n=e(11254),s=e(14528),a=e(84260),o=e(69811),r=e(53127);e(10465);const c=class{constructor(t){(0,n.r)(this,t),this.arcgisUpdate=(0,n.c)(this,"arcgisUpdate",7),this.arcgisError=(0,n.c)(this,"arcgisError",7),this.manager=(0,s.u)(this),this.canUseItemBrowser=!1,this.strings=(0,a.u)({blocking:!0}),this._isLicensed=!1,this.handleDistanceInputChange=(0,r.d)((t=>{!Number.isNaN(Number.parseFloat(t.value))&&t.value?(Number.parseFloat(t.value)>t.max&&(t.value=`${t.max}`),Number.parseFloat(t.value)<t.min&&(t.value=`${t.min}`),this.ipsConfig={...this.ipsConfig,pathSnapping:{...this.ipsConfig.pathSnapping,distance:Number.parseFloat(t.value)}}):t.value=`${this.ipsConfig.pathSnapping.distance}`}),300),this.map=void 0,this.portal=void 0,this.canUpdate=void 0,this.isLicensed=void 0,this.disabled=!1,this.portalItem=void 0,this.ipsConfig={appleIPS:!0,gnss:!0,pathSnapping:{distance:5,enabled:!0,units:"meter"},smoothing:!0}}watchConfigHandler(){this.map.ipsInfo=this.map.ipsInfo??{configuration:{}},this.map.ipsInfo.configuration={appleIPS:{enabled:this.ipsConfig.appleIPS},gnss:{enabled:this.ipsConfig.gnss},smoothing:{enabled:this.ipsConfig.smoothing},pathSnapping:{enabled:this.ipsConfig.pathSnapping.enabled,distance:this.ipsConfig.pathSnapping.distance,units:this.ipsConfig.pathSnapping.units}},this.arcgisUpdate.emit(this.map)}async componentWillLoad(){this.canUseItemBrowser=!!window.customElements?.get("arcgis-item-browser"),this._isLicensed=this.isLicensed??await this.checkLicense(),this.portalItem=await this.getPositioningServiceItem();const t=this.map.ipsInfo;t?.configuration&&(this.ipsConfig={appleIPS:t.configuration.appleIPS?.enabled??!0,gnss:t.configuration.gnss?.enabled??!0,smoothing:t.configuration.smoothing?.enabled??!0,pathSnapping:{enabled:t.configuration.pathSnapping?.enabled??!0,distance:t.configuration.pathSnapping?.distance??5,units:t.configuration.pathSnapping?.units??"meter"}})}render(){return this._isLicensed?(0,n.h)(n.F,null,(0,n.h)("calcite-block",{heading:this.strings.indoorPositioningData,headingLevel:2,collapsible:!0,disabled:this.disabled,expanded:!this.disabled},this.renderServiceCard(),this.renderConfigOptions())):(console.error("IPS license must be present to update configuration."),(0,n.h)(n.F,null))}renderAddService(){return this.canUpdate&&this.canUseItemBrowser?(0,n.h)("calcite-button",{alignment:"start",width:"full",appearance:"outline","icon-start":"plus",onClick:()=>this.handleAddService()},this.strings.addService):(0,n.h)(n.F,null)}renderServiceCard(){if(this.portalItem){const t=this.getItemLink(this.portalItem),i="Indoor positioning data service",e=this.portalItem.title;return(0,n.h)("calcite-block",{class:"service-card",description:i,heading:e||void 0},(0,n.h)("calcite-action",{slot:"actions-end",icon:"launch",key:"item-link",text:this.strings.moreInfo,onClick:()=>window.open(t),hidden:!t}),this.canUpdate&&this.canUseItemBrowser?(0,n.h)("calcite-action",{slot:"actions-end",icon:"x",key:"item-remove",text:this.strings.remove,onClick:()=>this.handleRemoveService(),hidden:!t}):null)}return this.renderAddService()}renderConfigOptions(){return this.canUpdate&&this.portalItem?(0,n.h)("calcite-block",{expanded:!0,collapsible:!0,class:"config-block",heading:this.strings.configuration},(0,n.h)("div",{class:"config-option"},(0,n.h)("calcite-label",{layout:"inline"},this.strings.enableSmoothing,(0,n.h)("calcite-icon",{id:"smoothing-info",scale:"s",icon:"information"}),(0,n.h)("calcite-tooltip",{"reference-element":"smoothing-info",overlayPositioning:"fixed"},this.strings.smoothingTooltip)),(0,n.h)("calcite-switch",{checked:this.ipsConfig.smoothing,scale:"s",onCalciteSwitchChange:t=>{this.ipsConfig={...this.ipsConfig,smoothing:t.target.checked}}})),(0,n.h)("div",{class:"config-option"},(0,n.h)("calcite-label",{layout:"inline"},this.strings.enableGNSS,(0,n.h)("calcite-icon",{id:"gnss-info",scale:"s",icon:"information"}),(0,n.h)("calcite-tooltip",{"reference-element":"gnss-info",overlayPositioning:"fixed"},this.strings.gnssTooltip)),(0,n.h)("calcite-switch",{checked:this.ipsConfig.gnss,scale:"s",onCalciteSwitchChange:t=>{this.ipsConfig={...this.ipsConfig,gnss:t.target.checked}}})),(0,n.h)("div",{class:"config-option"},(0,n.h)("calcite-label",{layout:"inline"},this.strings.enableAppleIps,(0,n.h)("calcite-icon",{id:"apple-ips-info",scale:"s",icon:"information"}),(0,n.h)("calcite-tooltip",{"reference-element":"apple-ips-info",overlayPositioning:"fixed"},this.strings.appleIPSTooltip)),(0,n.h)("calcite-switch",{checked:this.ipsConfig.appleIPS,scale:"s",onCalciteSwitchChange:t=>{this.ipsConfig={...this.ipsConfig,appleIPS:t.target.checked}}})),(0,n.h)("div",{class:"config-option"},(0,n.h)("calcite-label",{layout:"inline"},this.strings.enablePathSnapping,(0,n.h)("calcite-icon",{id:"path-snapping-info",scale:"s",icon:"information"}),(0,n.h)("calcite-tooltip",{"reference-element":"path-snapping-info",overlayPositioning:"fixed"},this.strings.pathSnappingTooltip)),(0,n.h)("calcite-switch",{checked:this.ipsConfig.pathSnapping.enabled,scale:"s",onCalciteSwitchChange:t=>{this.ipsConfig={...this.ipsConfig,pathSnapping:{...this.ipsConfig.pathSnapping,enabled:t.target.checked}}}})),this.ipsConfig.pathSnapping.enabled&&this.renderPathSnappingOptions(),(0,n.h)("calcite-button",{appearance:"outline",onClick:()=>this.restoreDefaults()},this.strings.restoreDefaults)):(0,n.h)(n.F,null)}renderPathSnappingOptions(){return(0,n.h)(n.F,null,(0,n.h)("calcite-label",null,this.strings.distance),(0,n.h)("div",{class:"path-snapping-options"},(0,n.h)("calcite-input-number",{class:"distance-input",min:"meter"===this.ipsConfig.pathSnapping.units?1:3.2,max:"meter"===this.ipsConfig.pathSnapping.units?10:32,step:.1,value:`${this.ipsConfig.pathSnapping.distance}`,onCalciteInputNumberInput:t=>{t.stopPropagation(),this.handleDistanceInputChange(t.target)}}),(0,n.h)("calcite-select",{class:"unit-select",label:"units",value:this.ipsConfig.pathSnapping.units,onCalciteSelectChange:t=>{const i=t.target.value;let e=this.ipsConfig.pathSnapping.distance;this.ipsConfig.pathSnapping.units!==i&&(e="feet"===i?Number.parseFloat((3.2*e).toFixed(1)):Number.parseFloat((e/3.2).toFixed(1))),this.ipsConfig={...this.ipsConfig,pathSnapping:{...this.ipsConfig.pathSnapping,units:i,distance:e}}}},(0,n.h)("calcite-option",{selected:"meter"===this.ipsConfig.pathSnapping.units,value:"meter"},this.strings.meters),(0,n.h)("calcite-option",{selected:"feet"===this.ipsConfig.pathSnapping.units,value:"feet"},this.strings.feet))))}async checkLicense(){return(this.portal.user?await this.fetchUserLicenses():[]).includes("arcgisips")}async fetchUserLicenses(){const t=`${this.portal.restUrl}/community/self`,i=await(0,o.p)();return await i(t,{query:{returnUserLicenseTypeExtensions:!0,f:"json"},responseType:"json",method:"auto"}).then((t=>t?.data?.userLicenseTypeExtensions||t?.data))}getItemLink(t){const i=t.portal?.restUrl??this.portal.restUrl;if(!i)return"";return`${i.replace("sharing/rest","home")}/item.html?id=${t.id}`}async getPositioningServiceItem(){try{const t=this.map.ipsInfo?.positioningService;return t?(await(t?.portalItem?.load()),t?.portalItem):null}catch(t){return this.arcgisError.emit(t),null}}handleAddService(){const t=document.createElement("arcgis-map-config-ips-service-browser");t.portal=this.portal,t.strings=this.strings,t.addEventListener("arcgisUpdate",(async t=>{const i=t.detail;if(i.length){this.PortalItem=this.PortalItem??await(0,o.m)(),this.IPSInfo=this.IPSInfo??await(0,o.O)(),this.PositioningService=this.PositioningService??await(0,o.P)();const t=new this.PortalItem({id:i[0].id});await t.load(),this.portalItem=t,this.map.ipsInfo=new this.IPSInfo({positioningService:new this.PositioningService({portalItem:this.portalItem})}),this.restoreDefaults(),this.arcgisUpdate.emit(this.map)}})),t.addEventListener("arcgisClose",(()=>{document.body.removeChild(t)})),document.body.appendChild(t)}handleRemoveService(){this.portalItem=void 0,this.map.ipsInfo=void 0,this.arcgisUpdate.emit(this.map)}restoreDefaults(){this.ipsConfig={appleIPS:!0,gnss:!0,pathSnapping:{distance:5,enabled:!0,units:"meter"},smoothing:!0}}static get assetsDirs(){return["assets"]}get el(){return(0,n.a)(this)}static get watchers(){return{ipsConfig:["watchConfigHandler"]}}};c.style=".config-block{margin:20px 10px 10px 0}.config-option{display:flex;width:100%;justify-content:space-between;margin-top:10px;margin-bottom:10px}.item-browser{height:50vh}.path-snapping-options{display:flex;gap:10px;margin-bottom:20px}.unit-select,.distance-input{width:100%}.service-card{border:1px solid var(--calcite-color-border-3)}#smoothing-info,#gnss-info,#apple-ips-info,#path-snapping-info{--calcite-icon-color:var(--calcite-color-text-3)}"},53127:(t,i,e)=>{e.d(i,{a:()=>s,d:()=>n,t:()=>a});const n=(t,i)=>{let e,n="idle";const s=async(...s)=>await new Promise((a=>{switch(n){case"flushed":n="idle",e?(clearTimeout(e),a(t(...s))):a(null);break;case"invoked":clearTimeout(e),n="idle",a(t(...s));break;case"cancelled":clearTimeout(e),n="idle",a(null);break;default:e&&clearTimeout(e),n="pending",e=setTimeout((()=>{n="idle",a(t(...s))}),i)}}));return s.flush=async function(...t){return n="flushed",await s(...t)},s.invoke=async function(...t){return n="invoked",await s(...t)},s.cancel=async function(...t){return n="cancelled",await s(...t)},s.getStatus=function(){return n},s},s=(t,i)=>{let e;return async(...n)=>await new Promise((s=>{e||(e=setTimeout((()=>{clearTimeout(e),e=void 0,s(t(...n))}),i))}))};function a(t){return new Promise((i=>setTimeout(i,t)))}},84260:(t,i,e)=>{e.d(i,{u:()=>o});var n=e(11254),s=e(10465),a=e(14528);function o({propertyName:t="strings",name:i}){let e=(0,a.r)();const o=(0,s.g)(e.el),c=new s.D,l={_lang:o.lang,_t9nLocale:o.t9nLocale};e.manager.onLoad((()=>c.promise));const p=new WeakRef(e);function h(){const t=p.deref();return t||d?.(),t}e=void 0;const g=r((()=>h()?.el)),d=(0,s.s)(g,(()=>(0,n.g)("./assets")),(({t9nLocale:i,t9nStrings:e,lang:n})=>{const s=h();if(!s)return;s[t]={...e,_lang:n,_t9nLocale:i},c.resolve()}),i);return l}const r=t=>new Proxy({},{get(i,e){const n=t();if(!n)return;const s=Reflect.get(n,e,n);return"function"==typeof s?s.bind(n):s}})}}]);