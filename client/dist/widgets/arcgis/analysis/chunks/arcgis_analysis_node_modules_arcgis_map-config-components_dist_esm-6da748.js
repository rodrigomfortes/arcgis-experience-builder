/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-6da748.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-6da748"],{10465:(e,t,i)=>{i.d(t,{D:()=>n,a:()=>d,b:()=>c,c:()=>o,g:()=>b,s:()=>w});class n{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}const s=(e,t,i)=>(0,a(t).subscribe)((t=>{const n=t.some((t=>((e,t)=>{let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1})(e,t.target)));n&&i()})),r={},a=e=>{const t=e.join(","),i=r[t];if(void 0!==i)return i;const n=new Set,s=new MutationObserver((e=>n.forEach((t=>t(e)))));globalThis.document&&s.observe(document.documentElement,{attributes:!0,attributeFilter:e,subtree:!0});const a={subscribe:e=>(n.add(e),()=>{n.delete(e),0===n.size&&(s.disconnect(),r[t]=void 0)})};return r[t]=a,a},o=(e,t)=>{let i=e;for(;i;){const e=i.closest?.(t);if(e)return e;const n=i.getRootNode?.();if(n===globalThis.document)return null;i=n.host}return null},c=e=>l(e,"dir","ltr"),l=(e,t,i)=>{const n=o(e,`[${t}]`);return n?.getAttribute(t)??i},u=e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t},d=()=>[u(2),u(1),u(1),u(1),u(3)].join("-"),g="ar,bg,bs,ca,cs,da,de,el,en,es,et,fi,fr,he,hr,hu,id,it,ja,ko,lt,lv,nl,nb,no,pl,pt-BR,pt-PT,ro,ru,sk,sl,sr,sv,th,tr,uk,vi,zh-CN,zh-HK,zh-TW".split(","),f=new Set(g),p="en",h={pt:"pt-PT",nb:"no",nn:"no",zh:"zh-CN"},m={},y=async(e,t)=>{const i=`${t}${e}.json`;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){return console.error(e),{}}return e===p?{}:await y(p,t)},b=e=>{const t=l(e,"lang",globalThis.navigator?.language||p);return{lang:t,t9nLocale:R(t)}},R=e=>{const[t,i]=e.split("-"),n=t.toLowerCase();let s=n;return i&&(s=`${n}-${i.toUpperCase()}`),s=h[s]??s,f.has(s)?s:i?R(n):p},w=(e,t,i,n)=>{let r;const a=()=>v(e,t(),n).then((e=>{r?.lang===e.lang&&r.t9nLocale===e.t9nLocale&&r.t9nStrings===e.t9nStrings||i(e),r=e})).catch(console.error);return queueMicrotask(a),s(e,["lang"],a)},v=async(e,t,i=e.localName.split("-").slice(1).join("-"))=>{const{lang:n,t9nLocale:s}=b(e),r=`${t}/${i}/t9n`,a=null===i?{}:await(async(e,t,i="")=>{const n=`${t}/${i}`,s=`${n}${e}.json`;return m[s]??(m[s]=y(e,n)),await m[s]})(s,r,"messages.");return{lang:n,t9nLocale:s,t9nStrings:a}}},24795:(e,t,i)=>{function n(e){return e.fields.filter((e=>["small-integer","big-integer","integer","single","double","long","number","string"].includes(e.type)))}function s(e,t){if(t)return e.fields.find((e=>e.name===t))}function r(e,t,i){const n=e.featureReduction;return!!n.fields?.find((e=>e.onStatisticField===t&&e.statisticType===i))}function a(e,t,i,n){const s=t.substring(0,t.lastIndexOf(`_${i}`)),r=e.featureReduction;return!!r.fields?.find((e=>e.name.substring(0,e.name.lastIndexOf(`_${n}`))===s&&e.statisticType===n))}function o(e,t){return!c(s(e,t)).find((i=>!r(e,t,i)))}function c(e){return["string","date","timestamp-offset"].includes(e.type)?["mode"]:["sum","avg","min","max","mode"]}function l(e,t){return e.featureReduction.popupTemplate.fieldInfos.find((e=>e.fieldName===t))}function u(e,t,i){const{FieldInfo:n}=i,s=t.featureReduction,{popupTemplate:r}=s;r.fieldInfos=r.fieldInfos||[];r.fieldInfos.find((t=>t.fieldName===e.name))||r.fieldInfos.push(new n({fieldName:e.name,label:e.alias,isEditable:!1,visible:!0,format:d(e,t)}))}function d(e,t){const i=e.onStatisticField,n=e.onStatisticExpression,r="sum"===e.statisticType,a="count"===e.statisticType,o=s(t,i),c=a||n&&r||o&&["small-integer","big-integer","integer","long","number"].includes(o.type);return o&&["single","double"].includes(o.type)?{digitSeparator:!0,places:1}:c?{digitSeparator:!0}:void 0}i.d(t,{a:()=>u,b:()=>c,c:()=>l,d:()=>s,e:()=>a,g:()=>n,h:()=>r,i:()=>o})},56612:(e,t,i)=>{var n,s,r,a;i.d(t,{a:()=>a,f:()=>n,l:()=>s,s:()=>r}),function(e){e.expression="expression/",e.raster="Raster.",e.relationship="relationships/"}(n||(n={})),function(e){e.cluster="cluster",e.feature="feature",e.mapNotes="mapNotes"}(s||(s={})),function(e){e.catalog="catalog",e.catalogFootprint="catalog-footprint",e.csv="csv",e.feature="feature",e.geojson="geojson",e.imagery="imagery",e.imageryTile="imagery-tile",e.knowledgeGraphSublayer="knowledge-graph-sublayer",e.mapImage="map-image",e.ogcFeature="ogc-feature",e.orientedImagery="oriented-imagery",e.parquet="parquet",e.scene="scene",e.stream="stream",e.subtype="subtype",e.tile="tile",e.voxel="voxel",e.wcs="wcs",e.wfs="wfs",e.wms="wms"}(r||(r={})),function(e){e.bigInteger="big-integer",e.date="date",e.dateOnly="date-only",e.double="double",e.globalId="global-id",e.guid="guid",e.integer="integer",e.long="long",e.number="number",e.oid="oid",e.single="single",e.smallInteger="small-integer",e.string="string",e.timeOnly="time-only",e.timestampOffset="timestamp-offset"}(a||(a={}))},63065:(e,t,i)=>{i.r(t),i.d(t,{arcgis_map_config_feature_reduction:()=>l});var n=i(11254),s=i(69811),r=i(89268),a=i(24795),o=(i(56612),i(14528)),c=i(84260);i(10465);const l=class{constructor(e){(0,n.r)(this,e),this.arcgisClose=(0,n.c)(this,"arcgisClose",7),this.arcgisChange=(0,n.c)(this,"arcgisChange",7),this.arcgisError=(0,n.c)(this,"arcgisError",7),this.arcgisStyleBtnClick=(0,n.c)(this,"arcgisStyleBtnClick",7),this.arcgisStyleBtnBackClick=(0,n.c)(this,"arcgisStyleBtnBackClick",7),this.arcgisActive=(0,n.c)(this,"arcgisActive",7),this.manager=(0,o.u)(this),this.strings=(0,c.u)({blocking:!0}),this.tileNodes={binning:void 0,cluster:void 0,"pie-chart":void 0},this.lastFeatureReduction={binning:void 0,cluster:void 0,"pie-chart":void 0},this.view=void 0,this.layer=void 0,this.portal=void 0,this.config=void 0,this.hideLayerTitle=!1,this.symbolStylerConfig={},this.options=void 0}async setFocus(){this.flowItemNode?.setFocus()}async componentWillLoad(){await this.loadAllModules();const{view:e,layer:t}=this;this.props={view:e,layer:t},this.initializeFieldInfos()}componentDidLoad(){this.flowItemNode?.setFocus();const{props:e,modules:t}=this,{layer:i}=e,n=i.featureReduction;if(n&&!n.fields?.length){const e=new t.AggregateField({name:"aggregateCount",onStatisticField:void 0,alias:"aggregateCount",statisticType:"count",visible:!0});i.featureReduction.fields=[e]}n&&this.arcgisActive.emit(!0)}disconnectedCallback(){this.arcgisActive.emit(!1)}render(){const{layer:e,options:t}=this;return(0,n.h)(n.H,{key:"8e683139eec4f40d756f69376dbeae50dc5ead9d",class:"calcite-match-height"},(0,n.h)("calcite-flow",{key:"b7b3f7f8563cd61f1429800432a479c3296da0a6",class:"flow",ref:e=>this.flowNode=e,customItemSelectors:"arcgis-map-config-feature-reduction-clustering, arcgis-map-config-feature-reduction-binning, arcgis-map-config-feature-reduction-fields"},"featureEffect"in e&&e.featureEffect?this.renderFeatureSpecificEffectsMessage():this.renderFeatureReductionOptions(),(t===r.F.CLUSTERING||t===r.F.CHART_CLUSTERING)&&this.renderClusteringOptions(),t===r.F.BINNING&&this.renderBinningOptions()))}renderFeatureSpecificEffectsMessage(){const{layer:e,hideLayerTitle:t,strings:i}=this;return(0,n.h)("calcite-flow-item",{heading:i.aggregation,description:t?void 0:e.title??void 0,class:"panel",closable:!0,onCalciteFlowItemClose:()=>this.arcgisClose.emit(),ref:e=>this.flowItemNode=e},(0,n.h)("calcite-card",{class:"feature-specific-effects-notice"},(0,n.h)("div",{slot:"description"},i.cluster.leNotSupportedMessage)))}renderFeatureReductionOptions(){const{props:e,hideLayerTitle:t,config:i,flowItemNode:s,tileNodes:a,options:o,strings:c}=this,{layer:l}=e,u=l.featureReduction,d={flowItemNode:s,strings:c,config:i},{renderer:g}=l,f=this.isSpike(),p="unique-value"===g.type,h=p&&!!g.field2,m="heatmap"===g.type,y="pie-chart"===g.type,b=!!g.valueExpression,R="class-breaks"===g.type&&"class-breaks-color"===g.authoringInfo?.type,w=p?g.uniqueValueInfos?.length:R?g.classBreakInfos?.length:0,v=!(f||m||y||h||"point"!==l.geometryType&&"multipoint"!==l.geometryType),C=(p||R)&&w<=10&&!h&&!b&&("point"===l.geometryType||"multipoint"===l.geometryType),F=(0,r.g)(l);return(0,n.h)("calcite-flow-item",{heading:c.aggregation,description:t?void 0:l.title??void 0,class:"panel",closable:!0,selected:![r.F.CLUSTERING,r.F.CHART_CLUSTERING,r.F.BINNING].includes(o),onCalciteFlowItemClose:()=>this.arcgisClose.emit(),ref:e=>this.flowItemNode=e},(0,n.h)("div",{class:"toggle"},(0,n.h)("calcite-label",{layout:"inline-space-between"},c.enableAggregation,(0,n.h)("calcite-switch",{scale:"s",checked:!!u,label:c.enableAggregation,onCalciteSwitchChange:e=>this.handleToggleFeatureReduction(e),ref:e=>this.switchNode=e}))),(0,n.h)("div",null,v&&(0,n.h)("arcgis-map-config-feature-reduction-tile",{props:{title:c.clustering,imagePath:(0,n.g)("./assets/map-config-feature-reduction-thumbnails/clustering.jpg"),moreInfo:c.info.clustering,helpId:"120003927",...d},selected:"cluster"===F,ref:e=>a.cluster=e,onArcgisSelect:async()=>{await this.enableFeatureReduction("cluster"),(0,n.f)(this.el)},onArcgisOptionsClick:()=>{this.options=r.F.CLUSTERING,(0,n.f)(this.el)}}),C&&(0,n.h)("arcgis-map-config-feature-reduction-tile",{props:{title:c.chartClustering,imagePath:(0,n.g)("./assets/map-config-feature-reduction-thumbnails/chartClustering.jpg"),moreInfo:c.info.chartClustering,helpId:"120003927",...d},selected:"pie-chart"===F,ref:e=>a["pie-chart"]=e,onArcgisSelect:async()=>{await this.enableFeatureReduction("pie-chart"),(0,n.f)(this.el)},onArcgisOptionsClick:()=>{this.options=r.F.CHART_CLUSTERING,(0,n.f)(this.el)}}),(0,n.h)("arcgis-map-config-feature-reduction-tile",{props:{title:c.binning,imagePath:(0,n.g)("./assets/map-config-feature-reduction-thumbnails/binning.jpg"),moreInfo:c.info.binning,helpId:"120003926",...d},selected:"binning"===F,ref:e=>a.binning=e,onArcgisSelect:async()=>{await this.enableFeatureReduction("binning"),(0,n.f)(this.el)},onArcgisOptionsClick:()=>{this.options=r.F.BINNING,(0,n.f)(this.el)}})))}renderClusteringOptions(){const{props:e,hideLayerTitle:t,portal:i,config:s,flowNode:a,options:o,strings:c}=this,{layer:l,view:u}=e;return(0,n.h)("arcgis-map-config-feature-reduction-clustering",{view:u,layer:l,portal:i,config:s,flowNode:a,selected:o===r.F.CLUSTERING||o===r.F.CHART_CLUSTERING,hideLayerTitle:t,strings:c,onArcgisChange:e=>{e.stopPropagation(),this.arcgisChange.emit()},onArcgisBackClick:()=>this.options=void 0})}renderBinningOptions(){const{props:e,hideLayerTitle:t,portal:i,config:s,flowNode:a,strings:o,symbolStylerConfig:c,options:l}=this,{layer:u,view:d}=e;return(0,n.h)("arcgis-map-config-feature-reduction-binning",{view:d,layer:u,portal:i,config:s,flowNode:a,selected:l===r.F.BINNING,hideLayerTitle:t,symbolStylerConfig:c,strings:o,onArcgisStyleBtnClick:()=>this.arcgisStyleBtnClick.emit(),onArcgisStyleBtnBackClick:()=>this.arcgisStyleBtnBackClick.emit(),onArcgisChange:e=>{e.stopPropagation(),this.arcgisChange.emit()},onArcgisBackClick:()=>this.options=void 0})}async loadAllModules(){const[e,t,i,n,r,a,o,c,l]=await Promise.all([(0,s.i)(),(0,s.a)(),(0,s.b)(),(0,s.c)(),(0,s.d)(),(0,s.e)(),(0,s.f)(),(0,s.g)(),(0,s.h)()]);this.modules={popupClusters:e,popupUtils:t,binLevel:i,clusterLabelCreator:n,binLabelCreator:r,AggregateField:a,FieldInfo:o,pieChartCreator:c,colorCreator:l}}async handleToggleFeatureReduction(e){e.currentTarget.checked?await this.enableFeatureReduction("default"):this.disableFeatureReduction(),(0,n.f)(this.el)}async enableFeatureReduction(e){const{props:t,flowItemNode:i}=this,{layer:s}=t,{renderer:a}=s,o=this.isSpike(),c="unique-value"===a.type&&!!a.field2,l="heatmap"===a.type,u="pie-chart"===a.type;if("default"===e&&this.lastFeatureReductionType&&this.lastFeatureReduction[this.lastFeatureReductionType])s.featureReduction=this.lastFeatureReduction[this.lastFeatureReductionType],s.featureReduction=s.featureReduction.clone(),this.arcgisChange.emit(),this.arcgisActive.emit(!0);else{"default"===e&&(e=o||l||u||c||"point"!==s.geometryType&&"multipoint"!==s.geometryType?"binning":"cluster");const t=(0,r.g)(s);if(t&&("binning"===s.featureReduction.type&&(s.featureReduction.labelsVisible=!1),this.lastFeatureReduction[t]=s.featureReduction),this.lastFeatureReduction[e])s.featureReduction=this.lastFeatureReduction[e],s.featureReduction=s.featureReduction.clone(),this.arcgisChange.emit(),this.arcgisActive.emit(!0);else try{i.loading=!0,"binning"===e?await this.createBinning():await this.createCluster(e),i.loading=!1,s.featureReduction=s.featureReduction.clone(),this.arcgisChange.emit(),this.arcgisActive.emit(!0)}catch(e){i.loading=!1,this.arcgisError.emit({message:"Feature reduction style could not be changed.",type:"warning"}),this.arcgisActive.emit(!1),(0,n.f)(this.el)}}}async createCluster(e){const{props:t,switchNode:i,tileNodes:n,modules:s}=this,{layer:o,view:c}=t,{popupClusters:l,clusterLabelCreator:u,pieChartCreator:d}=s,g=o.featureReduction;try{const t="cluster"===e&&await u.getLabelSchemes({layer:o,renderer:o.renderer,view:c});let i;o.featureReduction={type:"cluster",clusterMinSize:t?.primaryScheme?.clusterMinSize||r.c,clusterMaxSize:r.a,clusterRadius:r.b,labelsVisible:"cluster"===e,labelingInfo:t?.primaryScheme?.labelingInfo},"pie-chart"===e&&(i=await d.createRendererForClustering({layer:o}),o.featureReduction.renderer=i.renderer,o.featureReduction.fields=o.featureReduction.fields.concat(i.fields));const n=await l.getTemplates({layer:o,renderer:o.renderer});if("cluster"===e){const e=n.primaryTemplate.value;o.featureReduction.popupTemplate=e}else{const e=n.secondaryTemplates[0].value;o.featureReduction.popupTemplate=e,i&&i.fields.forEach((e=>(0,a.a)(e,o,s)))}await Promise.resolve()}catch(e){o.featureReduction=g,o.featureReduction?n[(0,r.g)(o)].setFocus():i.setFocus(),await Promise.reject(new Error("Failed to create clusters"))}}async createBinning(){const{props:e,switchNode:t,tileNodes:i,modules:n}=this,{layer:s,view:a}=e,{popupUtils:o,binLevel:c,binLabelCreator:l,AggregateField:u,colorCreator:d}=n,g=s.featureReduction;try{const e=await c({view:a});if(s.featureReduction={type:"binning",fixedBinLevel:e||1},!s.featureReduction.fields?.length){const e=new u({name:"aggregateCount",onStatisticField:void 0,alias:"aggregateCount",statisticType:"count",visible:!0});s.featureReduction.fields=[e]}const t=await d.createContinuousRenderer({layer:s,view:a,field:"aggregateCount",outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,defaultSymbolEnabled:!1,forBinning:!0});s.featureReduction.renderer=t.renderer;const i=await l.getLabelSchemes({layer:s});s.featureReduction.labelingInfo=i?.primaryScheme?.labelingInfo,s.featureReduction.labelsVisible=!1;const n=s.featureReduction.fields.map((e=>e.onStatisticField)),r=o.createPopupTemplateForFeatureReduction({featureReduction:s.featureReduction,fields:s.fields.filter((e=>n.includes(e.name)))});return s.featureReduction.popupTemplate=r,await Promise.resolve()}catch(e){return s.featureReduction=g,s.featureReduction?i[(0,r.g)(s)].setFocus():t.setFocus(),void await Promise.reject(new Error("Failed to create binning"))}}disableFeatureReduction(){const{props:e}=this,{layer:t}=e,i=(0,r.g)(t);"binning"===i?(t.featureReduction.labelsVisible=!1,this.lastFeatureReduction[i]=t.featureReduction):this.lastFeatureReduction[i]=t.featureReduction,this.lastFeatureReductionType=i,t.featureReduction=null,this.arcgisChange.emit(),this.arcgisActive.emit(!1)}initializeFieldInfos(){const{layer:e,modules:t}=this,i=e.featureReduction;i?.popupTemplate&&!i.popupTemplate.fieldInfos&&i.fields.forEach((i=>(0,a.a)(i,e,t)))}isSpike(){const{layer:e}=this,{renderer:t}=e;return!!t.authoringInfo?.visualVariables?.some((e=>"spike"===e.theme))}static get assetsDirs(){return["assets"]}get el(){return(0,n.a)(this)}};l.style=":host{height:100%}.flow{height:100%}.panel{height:100%}.toggle{background-color:white;padding:15px 10px 5px 10px}.feature-specific-effects-notice{margin:var(--calcite-spacing-lg)}"},84260:(e,t,i)=>{i.d(t,{u:()=>a});var n=i(11254),s=i(10465),r=i(14528);function a({propertyName:e="strings",name:t}){let i=(0,r.r)();const a=(0,s.g)(i.el),c=new s.D,l={_lang:a.lang,_t9nLocale:a.t9nLocale};i.manager.onLoad((()=>c.promise));const u=new WeakRef(i);function d(){const e=u.deref();return e||f?.(),e}i=void 0;const g=o((()=>d()?.el)),f=(0,s.s)(g,(()=>(0,n.g)("./assets")),(({t9nLocale:t,t9nStrings:i,lang:n})=>{const s=d();if(!s)return;s[e]={...i,_lang:n,_t9nLocale:t},c.resolve()}),t);return l}const o=e=>new Proxy({},{get(t,i){const n=e();if(!n)return;const s=Reflect.get(n,i,n);return"function"==typeof s?s.bind(n):s}})},89268:(e,t,i)=>{i.d(t,{F:()=>l,a:()=>c,b:()=>r,c:()=>a,d:()=>n,e:()=>s,f:()=>o,g:()=>u,h:()=>g,i:()=>d});const n=9,s=90,r=37.5,a=9,o=90,c=37.5;var l;function u(e){const t=e.featureReduction;if(t)return"binning"===t.type?"binning":"cluster"===t.type?function(e){const t=e.featureReduction;return!!t.renderer&&"pie-chart"===t.renderer.type&&!t?.renderer?.authoringInfo?.isAutoGenerated}(e)?"pie-chart":"cluster":void 0}function d(e){const t=e.featureReduction;return!t?.renderer||!!t?.renderer?.authoringInfo?.isAutoGenerated}function g(e,t){switch(e){case"sum":return t.fields.sum;case"avg":return t.fields.mean;case"min":return t.fields.min;case"max":return t.fields.max;case"stddev":return t.fields.stdDev;case"mode":return t.fields.mode;case"var":return t.fields.var;case"count":return t.fields.count;default:return""}}!function(e){e.CLUSTERING="clustering",e.CHART_CLUSTERING="chartClustering",e.BINNING="binning"}(l||(l={}))}}]);