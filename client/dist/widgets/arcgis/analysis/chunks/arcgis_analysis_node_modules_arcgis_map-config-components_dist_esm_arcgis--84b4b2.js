/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--84b4b2.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--84b4b2"],{14528:(e,t,i)=>{function a(e){const t=[];s=e,queueMicrotask((()=>{s===e&&(s=void 0)}));const i=e.componentWillLoad;return e.componentWillLoad=async()=>{await Promise.all(t.map((e=>e()))).then((()=>{})),await(i?.call(e))},{onLoad:e=>t.push(e)}}let s;function r(){return s}i.d(t,{r:()=>r,u:()=>a})},46222:(e,t,i)=>{i.r(t),i.d(t,{arcgis_floor_configuration_additional_layers:()=>l,arcgis_floor_configuration_layer_picker:()=>n});var a=i(11254),s=i(84792),r=i(14528);const l=class{constructor(e){(0,a.r)(this,e),this.arcgisDismiss=(0,a.c)(this,"arcgisDismiss",7),this.arcgisDisable=(0,a.c)(this,"arcgisDisable",7),this.arcgisFloorInfoChange=(0,a.c)(this,"arcgisFloorInfoChange",7),this.manager=(0,r.u)(this),this.placement="bottom-start",this.strings=void 0,this.view=void 0,this.reRender=!1}disconnectedCallback(){const{popoverNode:e}=this;e&&(e.open=!1,e.parentElement?.removeChild(e))}async setFocus(){return await(this.layerPanel?.setFocus())}async open(){requestAnimationFrame((()=>{this.popoverNode&&(this.popoverNode.open=!0)}))}async close(e){const{popoverNode:t}=this;t&&(this.disableContainer(!1),t.open=!1,t.remove(),this.popoverNode=void 0,this.reRender=!this.reRender,e&&this.arcgisFloorInfoChange.emit())}render(){return(0,a.h)(a.H,{key:"4df7b4bec7f8166575cdde25ecbfbee9696c1c80"},this.renderNotice(),this.renderPanel())}renderNotice(){const{strings:e}=this,t=this.getLayers();return t?.length?(0,a.h)(a.F,null):(0,a.h)("calcite-notice",{scale:"s",width:"auto",open:!0},(0,a.h)("div",{slot:"message"},e.additionalLayersTip))}renderPanel(){const{strings:e}=this,t=(0,s.c)(this.view);return(0,a.h)("calcite-panel",{ref:e=>this.layerPanel=e},this.renderLayers(),(0,a.h)("calcite-fab",{slot:"fab",icon:"plus",appearance:"outline-fill",kind:"neutral",textEnabled:!0,label:e.addLayers,text:e.addLayers,disabled:0===t.length,scale:"s",ref:e=>this.triggerButton=e,onClick:()=>this.create()}))}renderLayers(){const e=this.getLayers();return(0,a.h)("calcite-list",{label:this.strings.additionalLayers,class:"calcite-mode-light",onClick:e=>this.edit(e)},e.map((e=>this.renderLayer(e))))}renderLayer(e){const{title:t,floorInfo:i,id:s}=e;if(!i)return(0,a.h)(a.F,null);const r=`{${i.floorField}}`;return(0,a.h)("calcite-list-item",{label:t||"",description:r,value:s},(0,a.h)("calcite-action",{slot:"actions-end",text:this.strings.remove,icon:"x",onClick:t=>{t.stopPropagation(),this.removeLayer(e)}}))}create(){const e=this.createPopover(),t=this.createAddLayersFlow("add-layer");e.appendChild(t),this.open()}createAddLayersFlow(e){this.disableContainer(!0);const t=document.createElement("arcgis-floor-configuration-add-layers-flow");return t.view=this.view,t.mode=e,t.strings=this.strings,t.addEventListener("arcgisDone",this.close.bind(this,!0)),t.addEventListener("arcgisDismiss",this.close.bind(this,!1)),t}createPopover(){this.popoverNode=document.createElement("calcite-popover");const e=this.popoverNode;return e.classList.add("js-app-primary-flyout"),e.referenceElement=this.triggerButton??this.el,e.offsetSkidding=75,e.label=this.strings.addLayers,e.placement="bottom-end",e.pointerDisabled=!0,document.body.appendChild(e),e}disableContainer(e){const t=this.el.closest("calcite-block");t&&(t.disabled=e),this.arcgisDisable.emit(e)}edit(e){const t=this.getSelectedLayer(e);if(!t)return;const i=this.createPopover(),a=this.createAddLayersFlow("replace-field");a.layers=[t],i.appendChild(a),this.open()}findLayer(e){const t=this.getLayers();return t?.find((t=>t.id===e))}getLayers(){const e=this.view,{map:t}=e,i=t?.allLayers;let a=[];return i?.forEach((e=>{if("map-image"===e.type){const{allSublayers:t}=e;a=a.concat(t?.filter((e=>e.fieldsIndex&&e?.floorInfo)).toArray())}else e.floorInfo&&a.push(e)})),a}getSelectedLayer(e){const t="calcite-list-item"===e.target.localName?e.target:"calcite-list-item"===e.target.parentElement?.localName?e.target.parentElement:void 0;return t?this.findLayer(t.value):void 0}removeLayer(e){e.floorInfo=void 0,this.reRender=!this.reRender,this.arcgisFloorInfoChange.emit()}get el(){return(0,a.a)(this)}};l.style=":host{height:100%}calcite-notice{margin-bottom:1em}";const n=class{constructor(e){(0,a.r)(this,e),this.arcgisListChange=(0,a.c)(this,"arcgisListChange",7),this.manager=(0,r.u)(this),this.geometryType="polygon",this.iconEnd="pencil",this.label=void 0,this.open=!1,this.placement="bottom-start",this.requiredFields=void 0,this.selectedLayer=void 0,this.strings=void 0,this.view=void 0}calcitePopoverCloseHandler(){this.open=!1}async setFocus(){this.panel?await this.panel.setFocus():await Promise.resolve()}render(){const{selectedLayer:e}=this,t=e?.title||this.strings.none,i=this.getLayers(),s=this.open||!i?.length,r=new Map;return e&&r.set(e.id,e),(0,a.h)(a.H,{key:"a52d8e6349d4b6fc33f9b45e14aee9818589a56b"},(0,a.h)("calcite-label",{key:"38a5b0292ee723520c75c7667ffc214f9f3a4e07"},this.label,(0,a.h)("span",{key:"fbbd8d8b5e6a81056681f408e778e5a1fb787806"},(0,a.h)("calcite-button",{key:"745cb57eca1810a47b6bb071b87a3f561296daa7",appearance:"outline-fill",alignment:"icon-end-space-between",kind:"neutral",iconEnd:"pencil",width:"full",disabled:s,ref:e=>{e&&(this.triggerButton=e)},onClick:()=>{this.open=!this.open,setTimeout((()=>{this.setFocus()}),25)}},t),(0,a.h)("calcite-action",{key:"5c9af15a1c22db2c051a5acfe55dd42e4d63a712",icon:"x",scale:"s",text:this.strings.clear,disabled:!this.selectedLayer,onClick:()=>{this.selectedLayer=null,this.arcgisListChange.emit()}}))),(0,a.h)("calcite-popover",{key:"1a8f8dd3d2e946a4fa2485757a1804e2e7fdedd9",label:this.label,pointerDisabled:!0,referenceElement:this.triggerButton,open:this.open,placement:this.placement,ref:e=>{e&&(this.popoverNode=e)}},(0,a.h)("calcite-panel",{key:"197dd03da3926fc93e23ac59654c1d2f17c772cd",heading:this.label,closed:!1,ref:e=>{e&&(this.panel=e)}},(0,a.h)("arcgis-floor-configuration-layer-list",{key:"3e9c689579bc812aec52e763861bb3cc021d1be5",layers:i,selection:r,strings:this.strings,onArcgisListChange:e=>this.selectedLayer=e?.detail[0]}),(0,a.h)("calcite-button",{key:"cd3f074a80587c2f46780b62993d7edecd4da3a0",width:"full",slot:"footer",onClick:()=>this.open=!1},this.strings.done))))}checkRequiredFields(e){const{requiredFields:t}=this;return!t||!e.fieldsIndex||t.every((t=>e.fieldsIndex.get(t)))}getCompatibleLayers(){const{geometryType:e}=this,{map:t}=this.view,i=t?.allLayers;let a=[];return i?.forEach((t=>{if("map-image"===t.type){const e=t.allSublayers.filter((e=>!!e.fieldsIndex)).toArray();a=a.concat(e)}else("feature"===t.type&&!e||t?.geometryType===e)&&a.push(t)})),a}getLayers(){const e=this.getCompatibleLayers();return e?.length?e.filter((e=>this.checkRequiredFields(e))):[]}get el(){return(0,a.a)(this)}};n.style="calcite-label span {\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n}\n\ncalcite-label span calcite-action {\n  margin-left: 0.3em;\n}\n\n.arcgis--rtl {\n  calcite-label span calcite-action {\n    margin-left: auto;\n    margin-right: 0.3em;\n  }\n}\n"},84792:(e,t,i)=>{i.d(t,{a:()=>d,b:()=>y,c:()=>h,d:()=>g,g:()=>f,r:()=>o,s:()=>l,u:()=>n});const a={facilityLayer:{facilityIdField:"FACILITY_ID",siteIdField:"SITE_ID",nameField:"NAME"},levelLayer:{levelIdField:"LEVEL_ID",facilityIdField:"FACILITY_ID",longNameField:"NAME",shortNameField:"NAME_SHORT",levelNumberField:"LEVEL_NUMBER",verticalOrderField:"VERTICAL_ORDER"},siteLayer:{siteIdField:"SITE_ID",nameField:"NAME"}};let s;const r=e=>{const t=e?.map;return s=s||t?.floorInfo||{...a},s.siteLayer=s?.siteLayer?.layerId?s.siteLayer:null,s},l=e=>{const t=e?.map,i=r(e);t&&c(i)?t.set("floorInfo",i):o(e)},n=(e,t)=>{const i=r(t),{name:s}=e,n=e.layer;if(n){const e="sublayer"===n.type;i[s]={...a[s]},i[s]&&(i[s].layerId=e?n.layer?.id:n.id,i[s].sublayerId=e?n.id:void 0)}else i[s]=void 0;l(t)},o=e=>{const t=e?.map;t&&(t.floorInfo=null)},c=e=>!(!e?.facilityLayer?.layerId||!e?.levelLayer?.layerId||e?.siteLayer&&!e?.siteLayer.layerId),d=e=>{const t=a[e];return Object.values(t)},h=e=>{const{map:t}=e,i=t?.allLayers;let a=[];return i?.forEach((e=>{const{type:t,floorInfo:i}=e;"map-image"===t?a=a.concat(e.allSublayers.filter((e=>e.fieldsIndex&&!e?.floorInfo)).toArray()):!i&&["feature","oriented-imagery"].includes(t)&&a.push(e)})),a},y=async e=>{const{map:t}=e,i=t?.allLayers,a=i?.map((async e=>await p(e))).filter((e=>"failed"!==e?.loadStatus)),s=a?await Promise.all(a):[];let r=[];return s.forEach((e=>{const{type:t,geometryType:i}=e;"map-image"===t?r=r.concat(e.allSublayers.filter((e=>e.fieldsIndex&&"esriGeometryPolygon"===e.sourceJSON?.geometryType)).toArray()):"feature"===t&&"polygon"===i&&r.push(e)})),r},p=async e=>(void 0!==e.loadAll?await e.loadAll():await e.load(),e),f=(e,t)=>{const i=t.map,a=i?.allLayers,s=r(t),l=s?.[e]?.layerId,n=s?.[e]?.sublayerId;let o=l?a?.find((e=>e.id===l)):null;return"map-image"===o?.type&&(o=o.allSublayers.find((e=>e.id===n))),o},g=e=>{const{layer:t}=e;let i;if(i="arcgis-field-list"===e?.localName||"arcgis-floor-configuration-field-list"===e?.localName?e.selection.values().next().value:e?.field,i){const e=t.floorInfo||{};e.floorField=i.name,t.set("floorInfo",e)}}}}]);