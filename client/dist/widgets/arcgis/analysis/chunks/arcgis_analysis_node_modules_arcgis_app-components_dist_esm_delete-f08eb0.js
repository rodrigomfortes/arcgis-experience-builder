/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_delete-f08eb0.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_delete-f08eb0"],{50822:(e,t,r)=>{r.d(t,{a:()=>o,b:()=>a,c:()=>c,d:()=>d,e:()=>u,f:()=>p,g:()=>m,i:()=>s,u:()=>l});r(93814);var i=r(87744);function n(e){var t;return!!(null===(t=e.owner)||void 0===t?void 0:t.toLowerCase().includes("esri"))}function a(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Credits"))}function o(e){var t;return n(e)&&!!(null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Requires Subscription"))}function s(e,t){return e.owner===t.username}function l(e,t){return s(e,t)||function(e,t){var r;if(null!=e.isAdmin)return!!e.isAdmin;const i=e.owner,n="admin"===e.itemControl,a=["esri_livingatlas","esri_demographics","esri_boundaries"];if((null===(r=e.portal)||void 0===r?void 0:r.isPortal)&&!s(e,t)&&n&&i.includes("esri_")&&!a.includes(i))return!1;return n}(e,t)}const c=(e,t)=>!!t.orgId&&e.every((e=>e.isOrgItem)),d=(e,t)=>`${(0,i.a)(t)}item.html?id=${e}`,u=(e,t)=>`${(0,i.g)(t)}/content/users/${e}`,p=e=>e.reduce(((e,t)=>(e[t.owner]=e[t.owner]?[...e[t.owner],t.id]:[t.id],e)),{}),m=(e,t)=>`${(0,i.a)(t)}content/items/${e}`},68194:(e,t,r)=>{r.d(t,{r:()=>a});var i=r(50637),n=r(59317);const a=async(e,t,r={})=>{const{body:a,usePost:o,addTokenManually:s,api:l=(null===n.c||void 0===n.c?void 0:n.c.api),customToken:c}=r,d=new URLSearchParams;a&&Object.entries(a).forEach((([e,t])=>{void 0!==t&&d.append(e,t)}));const u=new URL(e);if(u.searchParams.append("f","json"),c)u.searchParams.append("token",c);else{const e=!1===s?null:await(0,i.b)(t,l);e&&u.searchParams.append("token",e)}const p=await fetch(u.toString(),{body:o?d:void 0,method:o?"POST":"GET"}),m=await p.json(),v=m.error;if(v)throw"string"==typeof v?new Error(v):v;return m}},68616:(e,t,r)=>{r.d(t,{i:()=>i});const i=(e,t)=>"Feature Service"===t&&e.includes("Hosted Service")},80021:(e,t,r)=>{r.d(t,{a:()=>d,b:()=>h,c:()=>w,d:()=>c,e:()=>g,f:()=>I,g:()=>m,i:()=>k,s:()=>C});var i=r(4429),n=(r(93814),r(59317),r(68616)),a=r(90310),o=r(50822),s=r(87744),l=r(50637);const c=async(e,t,r=!1)=>{const i=`${(0,o.e)(e.owner,t)}/items/${e.id}/delete`;return(0,l.r)(i,{permanentDelete:r},{},"post")},d=async(e,t,r=!1)=>{const n=(0,o.f)(e),a=[];for(const e in n){const s=`${(0,o.e)(e,t)}/deleteItems`,c=n[e];(0,i.g)(c,100).forEach((e=>{const t={items:e.join(","),permanentDelete:r};a.push((0,l.r)(s,t,{},"post"))}))}return{results:(await Promise.all(a)).flatMap((e=>e.results))}},u=async(e,t)=>{var r,i;const{type:n,typeKeywords:o}=e,s=["Scene Service","Map Service","WFS","OGCFeatureServer","Vector Tile Service","3DTiles Service"].includes(n),l=["Map Service","Vector Tile Service"].includes(n);try{const c=s?[{relationshipType:"Service2Service",direction:"reverse"},{relationshipType:"Service2Data",direction:"forward"}]:o.indexOf("Bulk Published Service")>-1?{relationshipType:"DataStore2BPService",direction:"reverse"}:"Geoprocessing Service"===n&&o.includes("Notebook Web Tool")?{relationshipType:"Notebook2WebTool",direction:"reverse"}:o.includes("Route Layer")?{relationshipType:"Service2Route",direction:"reverse"}:"Mobile Application"===n?{relationshipType:"MobileApp2Code",direction:"reverse"}:"Map Package"===n?{relationshipType:"Area2Package",direction:"reverse"}:"Route Layer"===n?{relationshipType:"Service2Route",direction:"reverse"}:"Feature Service"===n?{relationshipType:"Service2Layer",direction:"reverse"}:o.includes("Document")?{relationshipType:"Item2Attachment",direction:"reverse"}:"Application Configuration"===n?{relationshipType:"Map2AppConfig",direction:"reverse"}:{relationshipType:"Service2Data",direction:"forward"};if(!c)return null;if(!Array.isArray(c)){return null!==(i={sourceData:null===(r=(await(0,a.c)(e.id,t,c)).relatedItems)||void 0===r?void 0:r[0],relationship:c})&&void 0!==i?i:null}if(s){let r={relationshipType:"Service2Service",direction:"reverse"};const i=await(0,a.c)(e.id,t,r),n=(null==i?void 0:i.total)?i.relatedItems.shift():null;if(l&&!(e=>(null==e?void 0:e.typeKeywords.includes("View Service"))||!1)(n)||!n){r={relationshipType:"Service2Data",direction:"forward"};const i=await(0,a.c)(e.id,t,r);return{sourceData:(null==i?void 0:i.total)?i.relatedItems.shift():n,relationship:r}}return{sourceData:n,relationship:r}}}catch(e){return console.error(e),{sourceData:null,relationship:{relationshipType:null}}}},p=async(e,t)=>{try{const{type:r,typeKeywords:i}=e,o=(()=>"Notebook"===r?{relationshipType:"Notebook2WebTool",direction:"forward"}:i.includes("Has Related Route Layers")?{relationshipType:"Service2Route",direction:"forward"}:(0,n.i)(i,r)?{relationshipType:"Service2Service",direction:"Feed"===r?"reverse":"forward"}:{relationshipType:"Service2Data",direction:"reverse"})(),s=await(0,a.c)(e.id,t,o);return{resultData:{items:s.total>0?s.relatedItems:null,count:s.aggregations.total.count},relationship:o}}catch(e){return console.error(e),{resultData:null,relationship:{relationshipType:null}}}};async function m(e,t){const r=await(0,l.r)(`${(0,s.d)(e)}portals/helpmap?culture=${t}`);return null==r?void 0:r.helpMap.m}const v=["Area2Package","Item2Attachment","Listed2Provisioned","Map2AppConfig","Map2Area","Map2IndoorsConfig","MobileApp2Code","Notebook2WebTool","Service2Layer","Service2Route","WMA2Code"],y=["ArcgisWorkflowManager","ArcGISWorkflowJobLocation","Workflow Manager"],h=async(e,t,r=!1)=>{const i=[],a=[],s=[],c=[],d=(t,i,a)=>{const o=((e,t,r)=>{const{typeKeywords:i,type:a}=e;return!t&&(null==r?void 0:r.length)&&!(0,n.i)(i,a)})(t,i,a);return{preventSourceDelete:!o&&(null==a?void 0:a.filter((e=>!e.inRecycleBin)).length)>0&&!T(t,a)&&!E(t,a),discourageSourceDelete:o,discouragedAllowedSourceItem:r&&1===e.length&&o?{item:t,error:{message:"Delete discouraged"}}:null}},m=async(r,i)=>{var n;const{sourceData:a,relationship:s}=await u(r,t),{resultData:c,relationship:h}=await p(r,t),w=v.includes(s.relationshipType),g=v.includes(h.relationshipType);try{const{preventSourceDelete:n,discourageSourceDelete:s,discouragedAllowedSourceItem:u}=d(r,a,null==c?void 0:c.items),p=await(async e=>{var t,r;const{item:i,portal:n,permanentlyDelete:a}=e,s=(null!==(r=null===(t=n.sourceJSON)||void 0===t?void 0:t.recycleBinEnabled)&&void 0!==r?r:n.recycleBinEnabled)&&!a?"/canRecycle":"/canDelete",c=`${(0,o.e)(i.owner,n)}/items/${i.id}${s}`;return await(0,l.r)(c)})({item:r,portal:t,permanentlyDelete:i});return p.success?g?{bucket:"UNPROTECTED",bucketItem:{item:r,relatedItems:{resultData:c,isComposite:!0}}}:u?{bucket:"UNPROTECTED",bucketItem:u}:await S({selectedItems:e,resultData:null==c?void 0:c.items,portal:t})||!s&&!n?{bucket:i?"UNRECYCLABLE":"UNPROTECTED",bucketItem:{item:r,relatedItems:{resultData:c}}}:{bucket:"PROTECTED",bucketItem:{item:r,error:s?{message:"Delete discouraged",offendingItems:c.items}:{messageCode:"CONT_00481",offendingItems:c.items}}}:r.protected?{bucket:"PROTECTED",bucketItem:{item:r,error:{messageCode:"CONT_0048"}}}:{bucket:"UNRECYCLABLE",bucketItem:{item:r}}}catch(o){const s=(null===(n=null==o?void 0:o.details)||void 0===n?void 0:n.raw)||Object.assign({},o);switch(o.messageCode||s.messageCode){case"CONT_00481":{s.offendingItems=c.items;const i=!y.some((e=>r.typeKeywords.includes(e)));return await S({selectedItems:e,resultData:c.items,portal:t})?{bucket:i?"UNPROTECTED":"UNRECYCLABLE",bucketItem:{item:r,relatedItems:{resultData:c}}}:{bucket:"PROTECTED",bucketItem:{item:r,error:s}}}case"CONT_0048":return{bucket:"PROTECTED",bucketItem:{item:r,error:s}};case"CONT_0298":return w&&f({items:e,sourceData:a})?{bucket:"COMPOSITE",bucketItem:{item:r,relatedItems:{sourceData:a}}}:i?{bucket:"UNRECYCLABLE",bucketItem:{item:r,relatedItems:{sourceData:a}}}:m(r,!0);default:return console.error(o),{bucket:"PROTECTED",bucketItem:{item:r,error:s}}}}};return await Promise.all(e.map((async e=>{const{bucket:t,bucketItem:r}=await m(e);switch(t){case"UNPROTECTED":a.push(r);break;case"PROTECTED":i.push(r);break;case"UNRECYCLABLE":s.push(r);break;case"COMPOSITE":c.push(r)}}))),Promise.resolve({protectedItems:i,unprotectedItems:a,unrecyclableItems:s,selectedCompositeItems:c})},w=e=>{const{protectedItems:t,unrecyclableItems:r,unprotectedItems:i}=e,n=[];return t.length>0&&n.push("PROTECTED"),r.length>0&&n.push("UNRECYCLABLE"),i.length>0&&n.push("UNPROTECTED"),n.join("_")},g=e=>{let t="DELETE";switch(e){case"PROTECTED":t="NONE";break;case"UNRECYCLABLE":case"PROTECTED_UNRECYCLABLE":t="PERMANENTLY_DELETE"}return t},S=async e=>{var t,r;const{selectedItems:n,offendingItems:a,resultData:o,portal:s}=e,l=null!==(t=await b({items:o,portal:s}))&&void 0!==t?t:[],c=null!==(r=null==a?void 0:a.map((e=>e.itemId)))&&void 0!==r?r:[],d=(0,i.b)([...l,...c]),u=n.filter((e=>d.includes(e.id))),p=d.every((e=>n.some((t=>t.id===e)))),m=u.every((e=>!e.protected));return p&&m},b=async e=>{var t,r;null!==(t=e.accumulatedIds)&&void 0!==t||(e.accumulatedIds=[]);const{items:i,portal:n,accumulatedIds:a}=e;if(!i)return a;const o=i.filter((e=>!e.inRecycleBin));a.push(...o.map((e=>e.id)));for(const e of null!=o?o:[]){const{resultData:t}=await p(e,n);return b({items:null!==(r=null==t?void 0:t.items)&&void 0!==r?r:[],accumulatedIds:a,portal:n})}return a},f=e=>{const{items:t,sourceData:r}=e;return!!r&&t.find((e=>e.id===r.id))},T=(e,t)=>{const{typeKeywords:r,type:i}=e;return"Feed"===e.type&&(0,n.i)(r,i)&&1===(null==t?void 0:t.length)&&"Feature Service"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")},E=(e,t)=>{const{typeKeywords:r,type:i}=e;return"Feature Service"===e.type&&(0,n.i)(r,i)&&1===(null==t?void 0:t.length)&&"Feed"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")},I=({item:e})=>{var t,r;const{typeKeywords:i,type:a}=e;return(0,n.i)(i,a)&&"Feature Service"===e.type&&!!(null!==(r=null===(t=e.sourceJSON)||void 0===t?void 0:t.origin)&&void 0!==r?r:null==e?void 0:e.origin)},C=e=>{const{deletedItems:t,permanentlyDeletedItems:r}=e,i={successes:[],errors:[]};for(const e of t)e.success?i.successes.push(Object.assign(Object.assign({},e),{permanentDelete:!1})):i.errors.push(Object.assign(Object.assign({},e),{permanentDelete:!1}));for(const e of r)e.success?i.successes.push(Object.assign(Object.assign({},e),{permanentDelete:!0})):i.errors.push(Object.assign(Object.assign({},e),{permanentDelete:!0}));return i},k=e=>{var t;return 1===e.length&&(null===(t=e[0].relatedItems)||void 0===t?void 0:t.isComposite)}},80379:(e,t,r)=>{r.d(t,{a:()=>a,b:()=>n,i:()=>o});const i=["appExtensionError","forbiddenCredential","disabledSubscription","unauthorized","timeout","itemExists","exceedsFileSize","fileExists","emptyFile","unavailableGeocoder","dataNotAvailable","invalidShapefile","invalidFileGeodatabase","providePath","useSameFileName","invalidExtension","tokenRequired","invalidToken","invalid3DObjectFeatureClass","invalidClassification","serviceNameInvalid","titleInvalid","titleStartsWithNumber","titleRequired","titleInUseService","itemInRecycleBin","summaryInvalid","descriptionInvalid","missingUserOrPortal","dataStoreTitleInvalid","serviceNameExists","folderNameExists","serviceNotExist","unsupportedWFSVersion","invalidWMTS","invalidSpatialRef","emptyFeatureLayer","invalidFeatureLayerUrl","invalidUrl","httpWarning","flowAborted","duplicateFieldNames","failToFetchText","mapServiceError","noTilingSchemeFound","noMatchSpatialRef","invalidDataStorePublishType","noRegisteredServersForDataStore","noContentInDataStore","failToPublishFromDataStore","failToListDataStoreContents","invalidUsernameOrPassword","invalidConnection","invalidCredentials","invalidBigQueryProjectId","invalidSnowflakeServer","invalidSnowflakeRole","invalidSnowflakeWarehouse","invalidSnowflakeSchema","invalidSnowflakeDatabase","invalidAWSBucket","invalidAzureContainer","invalidJSON","invalidKeyFile","unauthorizedCredentials","unknownAGSType","unhandledError","incompatibleGeometries","multiPatchRestriction","invalidUniqueIdentifier","cannotAddNullData","exceededMaxFieldLength","invalidFieldType","failToCreate3DLayer"],n=e=>i.includes(null==e?void 0:e.code),a=e=>e&&e.hasOwnProperty("code")&&e.hasOwnProperty("message")&&e.hasOwnProperty("details")&&(!e.details||Array.isArray(e.details)),o=e=>{const t=e.toLocaleLowerCase();return t.includes("unexpected end of")||t.includes("did not match the expected pattern")}},90310:(e,t,r)=>{r.d(t,{a:()=>S,b:()=>u,c:()=>p,d:()=>m,f:()=>d,g:()=>v,l:()=>b});var i=r(50637),n=r(80379),a=r(50822),o=r(931),s=r(87744),l=r(83929),c=r(68194);const d=async(e,t,r)=>{const{owningSystemUrl:n}=await(0,i.f)((async()=>(0,l.g)(e)),"portalInfo",e.id);return(await Promise.all(t.map((async e=>{try{const{owningSystemUrl:t}=await(0,l.a)(e,r);return{owningSystemUrl:t,url:e}}catch(t){return console.error(t),{owningSystemUrl:null,url:e}}})))).filter((({owningSystemUrl:e})=>e===n)).map((({url:e})=>e))},u=async(e,t)=>{var r;try{return{result:await(0,c.r)(e,t,{addTokenManually:!1})}}catch(e){const t="token required";return(null===(r=null==e?void 0:e.message)||void 0===r?void 0:r.toLowerCase().includes(t))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}};async function p(e,t,r){var n;const{relationshipType:a,direction:o}=r,l=`${(0,s.g)(t)}content/items/${e}/relatedItems`,c=await(0,i.r)(l,{relationshipType:a,direction:o,includeRecycleBin:!0});return(null===(n=null==c?void 0:c.relatedItems)||void 0===n?void 0:n.length)&&(c.relatedItems=c.relatedItems.filter((t=>(null==t?void 0:t.id)!==e))),c}const m=async(e,t,r)=>{const n=!!r,a=(0,s.g)(t),o=n?`${a}/content/groups/${r.id}/search`:`${a}/search`;try{return{result:(await(0,i.r)(o,{filter:`id:(${e.join(" OR ")})`,num:100})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},v=async(e,t,r)=>{try{const n=[],a=[],o=[];await Promise.all(e.map((async e=>{const{result:s,error:c}=await(0,i.f)((()=>u(e,t)),"itemMetadata",`${e}--no-token`);if("tokenRequired"!==(null==c?void 0:c.code))if(y(s))n.push(h(s,e));else try{const t=await(0,l.a)(e,r);o.push(Object.assign(Object.assign({},s),{owningSystemUrl:t.owningSystemUrl}))}catch(c){console.warn(c)}else a.push(e)})));const s=await d(t,a,r),p=(await Promise.all(s.map((async e=>({response:await(0,c.r)(e,t,{addTokenManually:!0}),owningSystemUrl:(await(0,l.a)(e,r)).owningSystemUrl,url:e}))))).reduce(((e,{response:t,url:r,owningSystemUrl:i})=>y(t)?(n.push(h(t,r)),e):[...e,Object.assign(Object.assign({},t),{owningSystemUrl:i})]),[]),m=await Promise.all([...o,...p].map((async({serviceItemId:e,owningSystemUrl:t})=>{if(!e)return null;const{result:r}=await g({itemId:e,owningSystemUrl:t});return{item:r,owningSystemUrl:t}}))),{result:w}=n.length<=0?{result:[]}:await v(n,t,r);return{result:[...m.filter((e=>!!e)),...w]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},y=e=>!!(null==e?void 0:e.sources),h=(e,t)=>{var r;const i=null===(r=Object.values(e.sources)[0])||void 0===r?void 0:r.url;return i?i.includes("..")?(0,s.t)({url:t,path:i}):i:null},w=e=>`${e}/sharing/rest`,g=async({itemId:e,owningSystemUrl:t,requestOptions:r})=>{try{const n=(0,a.g)(e,w(t));return{result:await(0,i.r)(n,{},Object.assign(Object.assign({},r),{addTokenManually:!1}))}}catch(e){return console.error(e),(0,n.a)(e)&&e.message.toLocaleLowerCase().includes("invalid token")?{error:{code:"invalidToken"}}:{error:{code:"unhandledError"}}}},S=async({itemId:e,owningSystemUrl:t,requestOptions:r})=>{try{const n=`${(0,a.g)(e,w(t))}/data`;return{result:await(0,i.r)(n,{},Object.assign(Object.assign({},r),{addTokenManually:!1}))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},b=async(e,t)=>{try{const[r]=await(0,o.l)(["esri/portal/PortalItem"]),i=new r({id:e,portal:t});return await i.load(),{result:i}}catch(e){return console.error("Fail to reload item",e),{error:{code:"unhandledError"}}}}}}]);