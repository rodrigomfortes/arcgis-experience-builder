/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-d28886.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-d28886"],{35365:(e,t,s)=>{s.d(t,{c:()=>n,u:()=>l});var r=s(10465),a=(s(56612),s(76744)),i=s(14528);function n(e){e.selectedFields=[],e.layerFields=void 0,e.fields=void 0,e.hideLayerTitle=!1,e.supportsArcade=!1,e.stringFieldsCount=-1,e.dateFieldsCount=-1,e.numberFieldsCount=-1,e.containsFlow=!0,e.oneFeatureResponseStatus=a.s.MISSING,e.selectedAttribute=void 0,e.selectedAttributeText=void 0,e.selectedTypeValue=void 0,e.selectedValue=void 0,e.lastDefault=void 0,e.lastDefaults=void 0,e.dotColorSelected=void 0,e.backgroundStyleSelected=void 0,e.lastSettings=void 0,e.classedSymbolSelectedIdx=void 0,e.allUniqueValues=void 0,e.useFeatureReduction=void 0,e.symbolStylerConfig={},e.rasterInfo=void 0}function l(){const e=(0,i.r)(),t=e;e.manager.onLoad((()=>{t.smartMappingState=function(e,t){const s=o.get(e);if(s)return s;const a=(0,r.c)(e,t);if(a&&"store"in a)return o.set(e,a.store),a.store;return null}(e.el,"arcgis-smart-mapping").state}))}const o=new WeakMap},82659:(e,t,s)=>{s.r(t),s.d(t,{arcgis_smart_mapping_raster_preset_renderer_button:()=>l,arcgis_smart_mapping_raster_preset_renderer_dialog:()=>h});var r=s(11254),a=s(14528),i=(s(56612),s(76744)),n=s(35365);s(10465),s(17840),s(69811),s(39020);const l=class{constructor(e){(0,r.r)(this,e),this.arcgisDone=(0,r.c)(this,"arcgisDone",7),this.manager=(0,a.u)(this),this.smartMappingState=(0,n.u)(),this.handleOpenPresetRendererDialog=()=>{const{mode:e,smartMappingState:{layer:t}}=this,s=document.createElement("arcgis-smart-mapping-raster-preset-renderer-dialog");s.layer=t,s.originalRasterProps=this.originalRasterProps,s.mode=e,s.open=!0,s.smartMappingState=this.smartMappingState,s.addEventListener("arcgisClose",(e=>{e.stopPropagation();const t=e.detail;s.parentElement?.removeChild(s),this.arcgisDone.emit(t)})),document.body.append(s)},this.mode="register",this.originalRasterProps=void 0}render(){const{layer:e,strings:t}=this.smartMappingState,s=e;return"imagery"!==s.type&&"imagery-tile"!==s.type||"register"===this.mode&&s.activePresetRendererName?(0,r.h)(r.F,null):"edit"!==this.mode||s.activePresetRendererName?(0,r.h)("calcite-button",{class:"edit"===this.mode?"button-margin-large":"",appearance:"register"===this.mode?"outline-fill":"outline",width:"full",onClick:()=>this.handleOpenPresetRendererDialog()},"register"===this.mode?t.rasterPresetRenderer.registerNewStyle:t.manage):(0,r.h)(r.F,null)}get el(){return(0,r.a)(this)}};l.style=".button-margin-large{margin-bottom:var(--calcite-spacing-xl)}";const o=e=>{const{serviceRasterInfo:t}=e;return t?.multidimensionalInfo?.variables?.map((({name:e})=>e))??[]},d=(e,t)=>c(e)&&!t?.presetRenderers?.find((({name:t})=>t===e)),c=e=>!!e?.trim().length,h=class{constructor(e){(0,r.r)(this,e),this.arcgisClose=(0,r.c)(this,"arcgisClose",7),this.manager=(0,a.u)(this),this.presetRendererName="",this.styleOptions=[],this.processingOptions=[],this.rasterFunctionNames=[],this.variableNames=[],this.layer=void 0,this.mode=void 0,this.open=!1,this.originalRasterProps=void 0,this.smartMappingState=void 0,this.state=void 0,this.showDialog=!1,this.currentInternalMode=void 0}async componentWillLoad(){this.init(),this.showDialog=this.open}render(){const{currentInternalMode:e,state:t,smartMappingState:{strings:s}}=this,a="register"===e?s.rasterPresetRenderer.registerStyle:"edit"===e?s.rasterPresetRenderer.editStyle:s.rasterPresetRenderer.registerStyle;if(!this.showDialog)return(0,r.h)(r.F,null);if(!t)return(0,r.h)("calcite-dialog",{heading:a,modal:!0,open:!0,width:"s"},this.renderLoader(),this.renderFooterAction({disabled:!0}));const{isValidName:i,isValidProcessingValue:n}=t;return(0,r.h)(r.H,null,(0,r.h)("calcite-dialog",{id:"imagery-preset-style",heading:a,modal:!0,open:!0,width:"s",onCalciteDialogClose:()=>this.handleCancel()},this.renderStyleNameInput(),this.renderStyleTypeSelect(),this.renderProcessingTypeSelect(),this.renderProcessingValue(),this.renderFooterAction({disabled:!i||!n})))}renderStyleNameInput(){const{state:e,smartMappingState:{strings:t}}=this,{styleName:s,isValidName:a}=e;return(0,r.h)("calcite-label",null,t.rasterPresetRenderer.styleName,(0,r.h)("calcite-input-text",{value:s,placeholder:t.rasterPresetRenderer.enterStyleName,onCalciteInputTextInput:e=>this.handleStyleNameChange(e),status:a?"valid":"invalid",validationIcon:"exclamation-mark-triangle",validationMessage:s?t.rasterPresetRenderer.duplicateNameError.replace("${name}",s):t.rasterPresetRenderer.emptyNameError}))}renderStyleTypeSelect(){const{state:e,smartMappingState:{strings:t}}=this,{styleType:s}=e;return(0,r.h)("calcite-label",null,t.rasterPresetRenderer.styleType,(0,r.h)("calcite-select",{disabled:!0,label:t.rasterPresetRenderer.styleType,value:s},this.styleOptions.map((({type:e,label:t})=>(0,r.h)("calcite-option",{key:e,value:e},t)))))}renderProcessingTypeSelect(){const{currentInternalMode:e,state:t,smartMappingState:{strings:s}}=this,{processingType:a}=t;return(0,r.h)("calcite-label",null,s.rasterPresetRenderer.processingType,(0,r.h)("calcite-select",{label:s.rasterPresetRenderer.processingType,disabled:"register"===e||"save-as"===e,value:a,onCalciteSelectChange:async e=>await this.handleProcessingTypeChange(e)},this.processingOptions.map((({type:e,label:t})=>(0,r.h)("calcite-option",{key:e,value:e},t)))))}renderProcessingValue(){const{currentInternalMode:e,rasterFunctionNames:t,state:s,smartMappingState:{strings:a},variableNames:i}=this,{processingType:n,processingValue:l,isValidProcessingValue:o}=s;if("none"===n)return(0,r.h)(r.F,null);const d="raster-function-template"===n?t:i;return(0,r.h)("calcite-label",null,a.rasterPresetRenderer.name,(0,r.h)("calcite-select",{label:a.rasterPresetRenderer.name,disabled:"register"===e||"save-as"===e,value:l,status:o?"valid":"invalid",validationIcon:"exclamation-mark-triangle",validationMessage:a.rasterPresetRenderer.rftError,onCalciteSelectChange:async e=>await this.handleProcessingValueChange(e)},d.map((e=>(0,r.h)("calcite-option",{value:e},e)))))}renderFooterAction({disabled:e=!1}){const{currentInternalMode:t,smartMappingState:{strings:s}}=this;return(0,r.h)(r.F,null,"edit"===t&&(0,r.h)("calcite-button",{slot:"footer-end",kind:"danger",appearance:"outline",onClick:()=>this.handleDelete()},s.rasterPresetRenderer.deleteRegisteredStyle),(0,r.h)("calcite-button",{slot:"footer-end",kind:"brand",appearance:"outline",onClick:()=>this.handleCancel()},s.rasterPresetRenderer.cancel),("register"===t||"save-as"===t)&&(0,r.h)("calcite-button",{slot:"footer-end",disabled:e,kind:"brand",onClick:()=>this.handleRegister()},s.rasterPresetRenderer.save),"edit"===t&&(0,r.h)("calcite-split-button",{slot:"footer-end",disabled:e,primaryText:s.rasterPresetRenderer.save,overlayPositioning:"fixed",onCalciteSplitButtonPrimaryClick:()=>this.handleSave()},(0,r.h)("calcite-dropdown-item",{onCalciteDropdownItemSelect:()=>this.handleSaveAs()},s?.rasterPresetRenderer.saveAs)))}renderLoader(){const{smartMappingState:{strings:e}}=this;return(0,r.h)("calcite-loader",{label:e.rasterPresetRenderer.imagePresetStyleLoader})}async init(){const{smartMappingState:e}=this;this.presetRendererName=this.layer.activePresetRendererName??"",this.styleOptions=this.getRendererOptions(),this.rasterFunctionNames=(0,i.aU)(this.layer),this.variableNames=o(this.layer),this.processingOptions=this.getProcessingTypeOptions(),this.rasterFunctionNames.length||(this.processingOptions=this.processingOptions.filter((({type:e})=>"raster-function-template"!==e))),this.variableNames.length||(this.processingOptions=this.processingOptions.filter((({type:e})=>"variable"!==e))),this.currentInternalMode=this.mode,this.state=((e,t,s,r)=>{if("edit"===t){const t=s.presetRenderers?.find((({name:e})=>e===r)),{name:a,method:n="none",renderer:l,value:o=""}=t??{};return{styleName:a??"",isValidName:!0,styleType:(0,i.aT)(e,t)?"raster-rgb":l?.type,processingType:n,processingValue:o,isValidProcessingValue:!0}}{const{renderer:t,rasterFunction:r,type:a}=s,n=r?.functionName??(0,i.aU)(s)?.[0],l="imagery"===a?s.mosaicRule?.multidimensionalDefinition:s?.multidimensionalDefinition,d=l?.[0]?.variableName??o(s)?.[0],c=n&&"None"!==n;return{styleName:"",isValidName:!0,styleType:(0,i.aT)(e)?"raster-rgb":t?.type,processingType:c?"raster-function-template":d?"variable":"none",processingValue:c?n:d??"",isValidProcessingValue:!0}}})(e,this.mode,this.layer,this.presetRendererName)}handleStyleNameChange(e){const{layer:t,currentInternalMode:s,presetRendererName:r}=this,a=e.target,i=a.value?.trim();this.state="edit"!==s||i!==r?{...this.state,styleName:i,isValidName:!!i&&d(i,t)}:{...this.state,isValidName:!0}}async handleProcessingTypeChange(e){const{rasterFunctionNames:t,variableNames:s}=this,r=e.target.value;let a="",i=!0;"raster-function-template"===r?(a=t?.[0],i=await this.isValidRFT(a)):"variable"===r&&(a=s?.[0]),this.state={...this.state,processingType:r,processingValue:a,isValidProcessingValue:i}}async handleProcessingValueChange(e){const t=e.target.value,s=await this.isValidRFT(t);this.state={...this.state,processingValue:t,isValidProcessingValue:s}}handleDelete(){const{presetRendererName:e}=this;((e,t)=>{e&&(t.presetRenderers=t.presetRenderers?.filter((({name:t})=>t!==e)),t.bandIds=[],t.activePresetRendererName=void 0)})(e,this.layer),this.showDialog=!1,this.arcgisClose.emit("delete")}handleRegister(){const{styleName:e,processingType:t,processingValue:s}=this.state,r=e.trim();if(!r)return void(this.state={...this.state,isValidName:!1});const{modules:a}=this.smartMappingState,n=new a.RasterPresetRenderer({method:t,name:r,value:s});if(this.layer.renderer)if(d(r,this.layer)){if(n.bandIds=this.layer.bandIds??[],n.renderer=this.layer.renderer.clone(),"edit"===this.mode&&"save-as"===this.currentInternalMode){const e=this.layer.presetRenderers?.find((({name:e})=>e===this.presetRendererName)),t=(0,i.n)(this.smartMappingState);e&&(["raster-flow","raster-rgb","raster-stretch"].includes(t)&&(this.layer.effect=this.originalRasterProps?.originalEffect,"raster-rgb"!==t&&"raster-stretch"!==t||(this.layer.bandIds=this.originalRasterProps?.originalBandCombination)),(0,i.u)(this.smartMappingState,this.originalRasterProps?.originalRendererObj))}((e,t)=>{if(!e)return;e.name=e.name?.trim(),!d(e?.name,t)||(t.presetRenderers=t.presetRenderers??[],t.presetRenderers.push(e))})(n,this.layer),(0,i.aV)(n.name,this.layer),this.arcgisClose.emit("register"),this.showDialog=!1}else this.state={...this.state,isValidName:!1};else this.showDialog=!1}async handleSave(){const{styleName:e,processingType:t,processingValue:s}=this.state,r=e.trim();if(!r)return void(this.state={...this.state,isValidName:!1});const{modules:a}=this.smartMappingState,n=new a.RasterPresetRenderer({method:t,name:r,value:s}),l=this.layer.presetRenderers?.find((({name:e})=>e===this.presetRendererName));l?(n.bandIds=l.bandIds,n.renderer=l.renderer,((e,t,s)=>{const r=s.presetRenderers?.find((({name:t})=>t===e));r&&(s.presetRenderers=s.presetRenderers?.map((s=>s?.name===e?t:s)),s.activePresetRendererName===e&&(0,i.aV)(t.name,s))})(this.presetRendererName,n,this.layer),this.smartMappingState.rasterInfo=await(0,i.o)(this.layer),this.showDialog=!1,this.arcgisClose.emit("save")):this.showDialog=!1}handleSaveAs(){this.state={...this.state,styleName:"",isValidName:!0},this.currentInternalMode="save-as"}handleCancel(){this.showDialog=!1,this.arcgisClose.emit("cancel")}getRendererOptions(){const{smartMappingState:{strings:e}}=this;return[{type:"class-breaks",label:e.tile.symbologyClassBreaksStyle},{type:"unique-value",label:e.tile.symbologyUniqueValuesStyle},{type:"raster-stretch",label:e.tile.symbologyStretchStyle},{type:"raster-rgb",label:e.tile.symbologyRGBStyle},{type:"raster-shaded-relief",label:e.tile.symbologyShadedReliefStyle},{type:"raster-colormap",label:e.tile.symbologyColormapStyle},{type:"vector-field",label:e.tile.symbologyVectorFieldStyle},{type:"flow",label:e.tile.rasterFlowStyle}]}getProcessingTypeOptions(){const{smartMappingState:{strings:e}}=this;return[{type:"raster-function-template",label:e.rasterPresetRenderer.rasterFunctionTemplate},{type:"variable",label:e.rasterPresetRenderer.variable},{type:"none",label:e.rasterPresetRenderer.none}]}async isValidRFT(e){const{smartMappingState:t,state:s}=this,{modules:r,layer:a}=t,n=a,{processingType:l}=s,o=(0,i.n)(t),d="raster-function-template"===l?{functionName:e}:void 0,c=await(r.smartMappingRasterUtils?.getSupportedRendererInfo({layer:n,rasterFunction:d})),h=c?.supportedTypes;return!!h?.includes(o)}get el(){return(0,r.a)(this)}}}}]);