/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-e9a335.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-e9a335"],{298:(e,t,i)=>{function s(e,t,i){t.labelFormatFunction=t=>r(e,t,i,"short-date"),t.inputFormatFunction=t=>r(e,t,i,"short-date"),t.inputParseFunction=e=>function(e,t){if(!e)return e;let i;if(t&&"system"!==t)if("unknown"===t)i=e;else{const s=new Date;i=e+(new Date(s.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(s.toLocaleString("en-US",{timeZone:t})).getTime())}else{i=e+6e4*(new Date).getTimezoneOffset()}return console.log("mapTZToUTC",e," - ",new Date(e).toISOString()," - ",new Date(i).toISOString()),i}(Date.parse(e),i)}function a(e,t){let i;if(t&&"system"!==t)if("unknown"===t)i=new Date(e).toISOString();else{const s=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:t});i=new Date(new Date(a).getTime()-6e4*s).toISOString()}else{const t=(new Date).getTimezoneOffset();i=new Date(e-6e4*t).toISOString()}return i}function n(e,t,i){let s;if(t&&"system"!==t)if("unknown"===t)s=new Date(e).toISOString();else{const i=(new Date).getTimezoneOffset(),a=new Date(e).toLocaleString("en-US",{timeZone:t});s=new Date(new Date(a).getTime()-6e4*i).toISOString()}else{const t=(new Date).getTimezoneOffset();s=new Date(e-6e4*t).toISOString()}return s=i?s.substring(11,19):s.substring(11,16),s}function o(e,t){let i,s=new Date(e);if(s=new Date(s.getTime()-6e4*s.getTimezoneOffset()),t&&"system"!==t)if("unknown"===t)i=s.getTime();else{const e=new Date(s.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(s.toLocaleString("en-US",{timeZone:t})).getTime();i=s.getTime()+e}else{const e=(new Date).getTimezoneOffset();i=s.getTime()+6e4*e}return i}function r(e,t,i,s){const{modules:a}=e;let n;return n="unknown"===i?a.intl.formatDate(t,{...a.intl.convertDateFormatToIntlOptions(s||"short-date-short-time"),timeZone:"utc",timeZoneName:"shortOffset"}):a.intl.formatDate(t,{...a.intl.convertDateFormatToIntlOptions(s||"short-date-short-time"),timeZone:i}),n}i.d(t,{a:()=>s,b:()=>n,d:()=>o,u:()=>a})},9047:(e,t,i)=>{i.r(t),i.d(t,{arcgis_smart_mapping_color_size_slider:()=>w,arcgis_smart_mapping_color_slider:()=>k,arcgis_smart_mapping_heatmap_slider:()=>N,arcgis_smart_mapping_panels_chart:()=>I,arcgis_smart_mapping_panels_chart_size:()=>E,arcgis_smart_mapping_panels_color:()=>z,arcgis_smart_mapping_panels_color_size:()=>V,arcgis_smart_mapping_panels_color_size_univariate:()=>B,arcgis_smart_mapping_panels_compare:()=>T,arcgis_smart_mapping_panels_dot_density:()=>F,arcgis_smart_mapping_panels_heatmap:()=>P,arcgis_smart_mapping_panels_predominance:()=>D,arcgis_smart_mapping_panels_predominance_size:()=>L,arcgis_smart_mapping_panels_relationship:()=>R,arcgis_smart_mapping_panels_relationship_size:()=>O,arcgis_smart_mapping_panels_simple:()=>_,arcgis_smart_mapping_panels_type:()=>Ut,arcgis_smart_mapping_panels_type_size:()=>qt,arcgis_smart_mapping_relationship_color_slider:()=>$t,arcgis_smart_mapping_relationship_focus_button:()=>Jt,arcgis_smart_mapping_relationship_legend:()=>Kt,arcgis_smart_mapping_type_actions_popover:()=>jt,arcgis_smart_mapping_type_add_value:()=>Wt});var s=i(11254),a=(i(56612),i(76744)),n=i(298),o=i(72513),r=i(35365),l=i(1664),c=i(14528),d=i(39715),h=i(68474),p=i(53127),u=i(44735),m=i(16029),g=i(39020);i(10465),i(17840),i(69811);function S(e,t){const i=e.slice(0);let s,a,n,o,r,l,c,d,h,p,u=0;const m=!t||(null==t.tolerance?2:t.tolerance);let g=t?.indexes;const S=!t||null!=t.strictBounds&&t.strictBounds,y=(e,t)=>e-t;if(g)g.sort(y);else for(g=[],c=0;c<i.length;c++)g.push(c);for(c=0;c<g.length;c++)if(p=g[c],s=i[p],a=0===p?void 0:i[p-1],n=p===i.length-1?void 0:i[p+1],o=f(s),r=o.fractional,r){for(d=0,h=!1;d<=r&&!h;)l=b(s,d),u=S&&0===c?l[1]:l[0],h=v(s,u,a,n,m),d++;h&&(i[p]=u)}return i}function f(e){const t=String(e),i=t.match(/^-?(\d+)(\.(\d+))?$/i);let s={integer:0,fractional:0};if(i?.[1])s.integer=i[1].split("").length,s.fractional=i[3]?i[3].split("").length:0;else if(t.toLowerCase().includes("e")){const e=t.split("e"),i=e[0],a=e[1];let n,o;if(i&&a){const e=Number(i);let t=Number(a);o=t>0,o||(t=Math.abs(t)),n=f(e),o?(n.integer+=t,t>n.fractional?n.fractional=0:n.fractional-=t):(n.fractional+=t,t>n.integer?n.integer=1:n.integer-=t),s=n}}return s}function b(e,t){let i,s;return i=Number(e.toFixed(t)),i<e?s=i+1/10**t:(s=i,i-=-1/10**t),i=Number(i.toFixed(t)),s=Number(s.toFixed(t)),[i,s]}function v(e,t,i,s,a){const n=function(e,t,i,s){const a={prev:null,next:null};let n,o,r;null!=i&&(n=e-i,o=t-i,r=o-n,a.prev=Math.floor(Math.abs(100*r/n)));null!=s&&(n=s-e,o=s-t,r=o-n,a.next=Math.floor(Math.abs(100*r/n)));return a}(e,t,i,s),o=null==n.prev||n.prev<=a,r=null==n.next||n.next<=a;return o&&r||n.prev+n.next<=2*a}function y(e,t,i,s,a,n){const o=t?.length?x(t,i.bins[a]):M(e,t.stops,i.bins[a]);o&&(n.setAttribute("fill",o.toHex()),n.setAttribute("opacity",`${Math.max(o.a,.2)}`)),s?.push(n)}function C(e,t,i,s,a){t&&i?.forEach(((i,n)=>{const o=(a||t.histogramConfig)?.bins?.[n],r="breaks"in t?x(s||t.breaks,o):M(e,(s||t).stops,o);r&&(i.setAttribute("fill",r.toHex()),i.setAttribute("opacity",`${Math.max(r.a,.2)}`))}))}function M(e,t,i){const{modules:s}=e;if(!i)return;const a=(i.maxValue-i.minValue)/2+i.minValue;let n=t[0],o=t[t.length-1];const r=n.value,l=o.value;if(a<r)return n.color;if(a>l)return o.color;const c=t.filter((e=>e.value===a));if(c.length>0)return c[0].color;n=null,o=null,t.forEach(((e,i)=>{!n&&!o&&e.value>=a&&(n=t[i-1],o=e)}));const d=(a-n.value)/(o.value-n.value);return s.EsriColor.blendColors(n.color,o.color,d)}function x(e,t){if(!t)return;const i=(t.maxValue-t.minValue)/2+t.minValue;let s=e[0],a=e[e.length-1];if(i<s.min||i>a.max)return;const n=e.filter((e=>e.min===i));return n.length>0?n[0].color:(s=e[e.length-1],a=null,e.forEach(((t,n)=>{!a&&t.min>=i&&(s=e[n-1],a=t)})),s.color)}const w=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingColorSizeSliderChange=(0,s.c)(this,"arcgisSmartMappingColorSizeSliderChange",7),this.arcgisSmartMappingColorSizeSliderError=(0,s.c)(this,"arcgisSmartMappingColorSizeSliderError",7),this.manager=(0,c.u)(this),this.currentColorStopValues=[],this.currentSizeStopSizes=[],this.zigzagClick=!1,this.styleSheetStatus="not-loaded",this.smartMappingState=(0,r.u)(),this.histogramStatus=a.s.MISSING,this.statisticsStatus=a.s.MISSING,this.sliderZoomed=!1}async updateStatistics(){this.statisticsStatus=a.s.MISSING,this.statistics=void 0,this.histogramStatus=a.s.MISSING,this.histogram=void 0,this.colorSizeSlider?.destroy(),this.colorSizeSlider=void 0,this.sliderZoomed=!1,this.getStatistics()}componentWillLoad(){this.getStatistics()}render(){const{config:e}=this.smartMappingState;return(0,s.h)(s.H,{key:"cce7063920a82b1c47ea2f97ddf94726088a7045"},(0,s.h)("link",{key:"fd3e4bdccfba3c768b0697125bcf976b8672b3b6",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,s.f)(this.el)},onError:()=>{this.styleSheetStatus="failed",(0,s.f)(this.el)}}),"loaded"===this.styleSheetStatus?this.renderColorSizeSlider():"not-loaded"===this.styleSheetStatus?this.renderColorSizeSliderLoading():null)}renderColorSizeSlider(){const{histogramStatus:e,statistics:t,statisticsStatus:i,sliderZoomed:n,smartMappingState:o}=this,{strings:r}=o,c=(0,a.g)(o),d=c.authoringInfo,h=(0,a.b)(c,"color"),p=(0,a.b)(c,"size"),u="above-and-below"===d.univariateTheme;if(i===a.s.FAILED||i===a.s.MISSING)return this.colorSizeSlider&&(this.colorSizeSlider.destroy(),this.colorSizeSlider=void 0),(0,s.h)(s.F,null);if(i===a.s.IN_PROGRESS||e===a.s.IN_PROGRESS&&!this.colorSizeSlider)return this.renderColorSizeSliderLoading();{const e=this.prepareColorSizeSlider();let i=!1;if(h&&!n){const e=(0,a.d)(c,"color"),s=(0,l.k)(o),n=(0,a.aK)(s,e?.minSliderValue??t.min,e?.maxSliderValue??t.max);(n?.minMaxSame||!(0,a.S)(n?.min)&&!(0,a.S)(n?.max))&&(i=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}else if(p&&!n){const e=(0,a.d)(c,"size"),s=(0,a.aK)(u?p.stops:[{value:p.minDataValue},{value:p.maxDataValue}],e?.minSliderValue??t.min,e?.maxSliderValue??t.max);(s?.minMaxSame||!(0,a.S)(s?.min)&&!(0,a.S)(s?.max))&&(i=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}return h&&(this.currentColorStopValues=h.stops.map((e=>e.value))),p?.stops&&(this.currentSizeStopSizes=p.stops.map((e=>e.size))),(e||this.colorSizeSlider)&&this.colorSizeSlider.min!==this.colorSizeSlider.max?(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-label",null,r.colorSizeSlider.dataRange),(0,s.h)("div",{class:"slider-box-buttons-front"},this.renderInvertButton(),p&&(0,s.h)(s.F,null,(0,s.h)("div",null,"\xa0"),this.renderZoomButton(i))),(0,s.h)("div",{ref:e=>{e&&this.afterColorSizeSliderCreate(e)}})):this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max?(0,s.h)(s.F,null):this.renderColorSizeSliderLoading()}}renderColorSizeSliderLoading(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}renderInvertButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("arcgis-smart-mapping-action",{text:e.colorSizeSlider.invertSlider,icon:"arrowUpDown",onClick:()=>this.handleInvertSlider()})}renderZoomButton(e){const{strings:t}=this.smartMappingState,{sliderZoomed:i}=this;return(0,s.h)("arcgis-smart-mapping-action",{text:t.colorSizeSlider.zoomSlider,icon:i?"magnifyingGlassMinus":"magnifyingGlassPlus",disabled:e,onClick:()=>this.handleZoomSlider(),ref:e=>{e&&(this.zoomButtonNode=e)}})}prepareColorSizeSlider(){const{statistics:e,histogram:t,histogramStatus:i,sliderZoomed:s,smartMappingState:r}=this,{mapView:c,modules:d}=r,h=(0,a.g)(r),p=(0,a.k)(r),u="above-and-below"===h.authoringInfo.univariateTheme,m=["size-age","color-size-age","type-size-age"].includes(p),g=this.getFieldInfo().simpleFieldType===a.w.DATE,S=(0,a.b)(h,"color"),f=(0,a.b)(h,"size"),b=(0,a.d)(h,"size"),v=(0,a.d)(h,"color");let M,x,w;v?(M=(0,a.aJ)(v.theme,S.stops,!0),x=v.minSliderValue,w=v.maxSliderValue):(x=b?.minSliderValue??e.min,w=b?.maxSliderValue??e.max),({min:x,max:w}=(0,a.aH)({min:x,max:w}));const k=this.colorSizeSlider;if(this.colorSizeSlider&&(S&&k.style||!S&&!k.style)&&(this.colorSizeSlider?.destroy(),this.colorSizeSlider=void 0),i===a.s.IN_PROGRESS)return!1;if(this.colorSizeSlider){const i=this.colorSizeSlider;if("dragging"===i.slider?.state)return!0;let p={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:x??e.min,max:w??e.max};S?(p={...p,...M},p.stops=(0,l.k)(r),p.precision=(0,o.g)(p.stops),p.hasTimeData=g&&!m,g&&(0,n.a)(r,p,c.timeZone),s?this.zigzagClick||(p.zoomOptions=(0,a.aK)(S.stops,v?.minSliderValue??e.min,v?.maxSliderValue??e.max)):p.zoomOptions=null,p.histogramConfig.barCreatedFunction=t&&this.colorSliderBars&&y.bind(this,r,S,t,this.colorSliderBars),C(r,this.colorSizeSlider,this.colorSliderBars,p,t)):(p.style={trackBelowFillColor:(0,a.h)(r,h.classBreakInfos[0].symbol)||new d.EsriColor([0,0,0,.5]),trackAboveFillColor:(0,a.h)(r,h.classBreakInfos[1].symbol)||new d.EsriColor([0,0,0,.5])},p.stops=f.stops,p.precision=(0,o.g)(p.stops),s?this.zigzagClick||(p.zoomOptions=(0,a.aK)(u?f.stops:[{value:f.minDataValue},{value:f.maxDataValue}],b?.minSliderValue??e.min,b?.maxSliderValue??e.max)):p.zoomOptions=null),this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(p.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.colorSizeSlider.slider.min=p.zoomOptions.min,p.zoomOptions.min=null):(this.colorSizeSlider.slider.max=p.zoomOptions.max,p.zoomOptions.max=null)),this.adjustedZoomOptions=void 0,this.zoomAdjustment=void 0,this.colorSizeSlider.set(p),this.zigzagClick=!1}else{this.colorSliderBars=[];let i={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:x??e.min,max:w??e.max};u&&(i.primaryHandleEnabled=!0,i.persistSizeRangeEnabled=!0),g&&(i.hasTimeData=!0,(0,n.a)(r,i,c.timeZone)),S?(i={...i,...M},i.stops=(0,l.k)(r),i.precision=(0,o.g)(S.stops),i.histogramConfig.barCreatedFunction=t&&y.bind(this,r,i,t,this.colorSliderBars),this.colorSizeSlider=new d.ColorSizeSlider(i),this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max&&this.colorSizeSlider.set(i),this.colorSizeSlider&&C(r,this.colorSizeSlider,this.colorSliderBars)):(i.style={trackBelowFillColor:(0,a.h)(r,h.classBreakInfos[0].symbol)||new d.EsriColor([0,0,0,.5]),trackAboveFillColor:(0,a.h)(r,h.classBreakInfos[1].symbol)||new d.EsriColor([0,0,0,.5])},i.stops=f.stops,i.handlesSyncedToPrimary=!1,i.precision=(0,o.g)(i.stops),this.colorSizeSlider=new d.BinaryColorSizeSlider(i),this.colorSizeSlider&&this.colorSizeSlider.min===this.colorSizeSlider.max&&this.colorSizeSlider.set(i)),this.createColorSizeSliderChangeEvents()}return(0,a.S)(this.colorSizeSlider)}handleInvertSlider(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color");if((0,a.J)(),i){let e=i.stops.map((e=>e.color));e=e.reverse(),i.stops.forEach(((t,i)=>{t.color=e[i]}))}else{const i=(0,a.h)(e,t.classBreakInfos[0].symbol);(0,a.j)(e,t.classBreakInfos[0].symbol,(0,a.h)(e,t.classBreakInfos[1].symbol)),(0,a.j)(e,t.classBreakInfos[1].symbol,i)}const n=(0,a.b)(t,"size");[n.minSize,n.maxSize]=[n.maxSize,n.minSize],(0,a.t)(e),(0,s.f)(this.el),this.arcgisSmartMappingColorSizeSliderChange.emit()}handleZoomSlider(e){const{smartMappingState:t}=this;if(this.histogramStatus===a.s.IN_PROGRESS)return;const{statistics:i}=this,s=(0,a.g)(t),n="above-and-below"===s.authoringInfo.univariateTheme;this.sliderZoomed=(0,a.S)(e)?!!e:!this.sliderZoomed;const o=(0,a.b)(s,"size");o||(this.sliderZoomed=!1);const r=(o?o.normalizationField:s.normalizationField)??void 0,l=this.getFieldInfo(),c=(0,a.d)(s,"size"),d=this.sliderZoomed?(0,a.aK)(n?o.stops:[{value:o.minDataValue},{value:o.maxDataValue}],c?.minSliderValue??i.min,c?.maxSliderValue??i.max):null,h=c?.minSliderValue===c?.maxSliderValue;this.getHistogram(l,r,i,d?.min||(h?i.min:c?.minSliderValue??i.min),d?.max||(h?i.max:c?.maxSliderValue??i.max))}afterColorSizeSliderCreate(e){if(this.colorSizeSlider.container)e.append(this.colorSizeSlider.container);else{const t=document.createElement("div");t.classList.add("slider-container"),e.append(t),this.colorSizeSlider.container=t}}getStatistics(){const{smartMappingState:e}=this,{layer:t,useFeatureReduction:i,mapView:s,modules:n}=e,o=t,r=(0,a.g)(e),l=(0,a.b)(r,"size"),c=(0,a.d)(r,"size"),d=this.getFieldInfo(),h=(l?l.normalizationField:r.normalizationField)??void 0;let p=c.minSliderValue,u=c.maxSliderValue;this.statisticsStatus=a.s.IN_PROGRESS,this.statistics||n.summaryStatistics({layer:o,view:s,field:d.field??void 0,valueExpression:d.expression??void 0,normalizationField:h,forBinning:"featureReduction"in o&&"binning"===o.featureReduction?.type&&i,outStatisticTypes:{exclude:["median"]}}).then((e=>{if(0===e.count){const[t,i]=this.getDefaultDataRange(d),s=c.minSliderValue||t,n=c.maxSliderValue||i;e.min=s,e.max=n,e.avg=(n+s)/2,(0,a.S)(c.minSliderValue)||(c.minSliderValue=s,c.maxSliderValue=n)}else if(!(0,a.S)(e.avg)||!(0,a.S)(e.min)||!(0,a.S)(e.max))return void(this.statisticsStatus=a.s.FAILED);e=(0,a.aH)(e),({min:p,max:u}=(0,a.aH)({min:p,max:u})),p=p??e.min,u=u??e.max,this.statistics=e,this.statisticsStatus=a.s.SUCCESS,this.getHistogram(d,h,e,p,u)}),(e=>{console.log(e),this.statisticsStatus=a.s.FAILED}))}getHistogram(e,t,i,s,n){const{layer:o,useFeatureReduction:r,mapView:l,modules:c}=this.smartMappingState,d=o;(i=i||this.statistics)&&0!==i.count&&(this.histogramStatus=a.s.IN_PROGRESS,c.histogram({layer:d,view:l,field:e.field??void 0,valueExpression:e.expression??void 0,numBins:50,minValue:(0,a.S)(s)?s:i.min??void 0,maxValue:(0,a.S)(n)?n:i.max??void 0,normalizationField:t??void 0,forBinning:"featureReduction"in d&&"binning"===d.featureReduction?.type&&r}).then((e=>{this.histogram=e,this.histogramStatus=a.s.SUCCESS}),(()=>{this.histogramStatus=a.s.FAILED})))}onMinMaxChange(e,t,i){const{smartMappingState:s}=this,n=(0,a.g)(s),o=n.authoringInfo,r="above-and-below"===o?.univariateTheme,l=(0,a.b)(n,"color"),c=(0,a.b)(n,"size");l?.stops&&(e=Math.min(e,l.stops[0].value),t=Math.max(t,l.stops[l.stops.length-1].value)),r&&(e=Math.min(e,c.stops[0].value),t=Math.max(t,c.stops[c.stops.length-1].value),c.stops.forEach(((e,t)=>{e.size=this.currentSizeStopSizes[t]}))),this.handleMinMaxChange(e,t,i)}handleMinMaxChange(e,t,i){const{statistics:s,smartMappingState:n}=this,o=(0,a.g)(n),r=(0,a.b)(o,"color"),l=(0,a.b)(o,"size"),c=(0,a.d)(o,"color")||{},d=(0,a.d)(o,"size")||{};"min"===i?(c.minSliderValue=e,d.minSliderValue=e):(c.maxSliderValue=t,d.maxSliderValue=t);const h=(0,a.aK)(r?.stops,c.minSliderValue,c.maxSliderValue);this.zoomButtonNode&&(this.sliderZoomed?this.zoomButtonNode.disabled=!1:!h||h.minMaxSame||!(0,a.S)(h.min)&&!(0,a.S)(h.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1),this.sliderZoomed&&(this.adjustedZoomOptions=this.colorSizeSlider.zoomOptions,"min"===i?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=t,this.zoomAdjustment="max"));const p=this.getFieldInfo(),u=l?l.normalizationField:o.normalizationField;this.getHistogram(p,u,s,e,t),C(n,this.colorSizeSlider,this.colorSliderBars,r,this.histogram),e===c.minSliderValue&&t===c.maxSliderValue&&(this.sliderZoomed=!1),o.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingColorSizeSliderChange.emit()}createColorSizeSliderChangeEvents(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.k)(e),n=(0,a.b)(t,"size"),o=["size-age","color-size-age","type-size-age"].includes(i),r=this.getFieldInfo().simpleFieldType===a.w.DATE;this.colorSizeSlider&&(this.colorSizeSlider.watch("zoomOptions",((e,t)=>{this.sliderZoomed&&(t?.min&&!e?.min||t?.max&&!e?.max)&&(this.zigzagClick=!0,this.handleZigzagClick(e))})),this.colorSizeSlider.on("min-change",(e=>{e.value>this.currentColorStopValues[0]?(this.colorSizeSlider.stops.forEach(((e,t)=>{e.value=this.currentColorStopValues[t]})),this.onMinMaxChange(this.currentColorStopValues[0],this.colorSizeSlider.slider.max,"min")):this.onMinMaxChange(e.value,this.colorSizeSlider.slider.max,"min")})),this.colorSizeSlider.on("max-change",(e=>{e.value<this.currentColorStopValues[this.currentColorStopValues.length-1]?(this.colorSizeSlider.stops.forEach(((e,t)=>{e.value=this.currentColorStopValues[t]})),this.onMinMaxChange(this.colorSizeSlider.slider.min,this.currentColorStopValues[this.currentColorStopValues.length-1],"max")):this.onMinMaxChange(this.colorSizeSlider.slider.min,e.value,"max")})),this.colorSizeSlider.on("thumb-change",(e=>{if(n){if(r&&!o&&0===e.value)return void(0,s.f)(this.el);this.updateRendererStops(this.colorSizeSlider.stops)}})),this.colorSizeSlider.on("thumb-drag",(()=>{if(n){const e=this.colorSizeSlider.stops;this.updateRendererStops(e)}})),this.colorSizeSlider.on("segment-drag",(()=>{this.updateRendererStops(this.colorSizeSlider.stops)})))}updateRendererStops(e){const{smartMappingState:t}=this,i=(0,a.g)(t),s=(0,a.b)(i,"color"),n=(0,a.b)(i,"size"),o=(0,a.d)(i,"size"),r="above-and-below"===i.authoringInfo.univariateTheme;n.stops?n.stops.forEach(((t,i)=>{t.value=e[i].value,t.size=e[i].size,t.label=""})):(n.minDataValue=e[0].value,n.maxDataValue=e[e.length-1].value),s&&s.stops.forEach(((t,i)=>{t.value=e[i].value,t.color=e[i].color,t.label=""})),this.currentColorStopValues=e.map((e=>e.value)),this.currentSizeStopSizes=e.map((e=>e.size)),2===i.classBreakInfos.length&&(i.classBreakInfos[0].maxValue=e[2].value,i.classBreakInfos[1].minValue=e[2].value);const l=(0,a.aK)(r?n.stops:[{value:n.minDataValue},{value:n.maxDataValue}],o.minSliderValue,o.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!l||l.minMaxSame||!(0,a.S)(l.min)&&!(0,a.S)(l.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,C(t,this.colorSizeSlider,this.colorSliderBars),(0,a.t)(t)}getDefaultDataRange(e){if(e.simpleFieldType===a.w.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"size"),s=(0,a.y)(e,i?i.field:t.field);return{field:i?.field||t.field,expression:i?.valueExpression||t.valueExpression,expressionTitle:i?.valueExpressionTitle||t.valueExpressionTitle,simpleFieldType:s?s.simpleFieldType:a.w.NUMBER}}handleZigzagClick(e){const{statistics:t,smartMappingState:i}=this,s=(0,a.g)(i),n=(0,a.b)(s,"size"),o=(0,a.d)(s,"size"),r=this.getFieldInfo(),l=n?n.normalizationField:s.normalizationField,c=o.minSliderValue===o.maxSliderValue;this.getHistogram(r,l,t,e?.min??(c?t.min:o.minSliderValue),e?.max??(c?t.max:o.maxSliderValue)),e||(this.sliderZoomed=!1)}get el(){return(0,s.a)(this)}};w.style=".slider-box {\n  height: 320px;\n\n  .esri-color-size-slider,\n  .esri-binary-color-size-slider {\n    min-width: 200px;\n  }\n\n  .esri-color-size-slider .esri-slider .esri-slider__content,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__content {\n    height: 175px;\n  }\n\n  .esri-color-size-slider__histogram-container,\n  .esri-binary-color-size-slider__histogram-container {\n    width: 85px;\n  }\n\n  .esri-color-size-slider .esri-slider .esri-slider__label,\n  .esri-color-size-slider .esri-slider .esri-slider__min,\n  .esri-color-size-slider .esri-slider .esri-slider__max,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__label,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__min,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__max {\n    text-decoration: underline;\n  }\n\n  .esri-color-size-slider .esri-slider .esri-slider__label:hover,\n  .esri-color-size-slider .esri-slider .esri-slider__min:hover,\n  .esri-color-size-slider .esri-slider .esri-slider__max:hover,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__label:hover,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__min:hover,\n  .esri-binary-color-size-slider .esri-slider .esri-slider__max:hover {\n    border: 1px solid #bbb;\n    background-color: #f3f3f3;\n    text-decoration: none;\n    z-index: 1;\n  }\n}\n\n.slider-box-buttons-front {\n  display: flex;\n}\n\n.slider-container {\n  overflow: hidden;\n}\n";const k=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingColorSliderChange=(0,s.c)(this,"arcgisSmartMappingColorSliderChange",7),this.arcgisSmartMappingColorSliderError=(0,s.c)(this,"arcgisSmartMappingColorSliderError",7),this.manager=(0,c.u)(this),this.currentStopValues=[],this.currentBreakValues=[],this.zigzagClick=!1,this.styleSheetStatus="not-loaded",this.smartMappingState=(0,r.u)(),this.histogramStatus=a.s.MISSING,this.statisticsStatus=a.s.MISSING,this.sliderZoomed=!1,this.cap=void 0}async updateStatistics(){this.statisticsStatus=a.s.MISSING,this.statistics=void 0,this.histogramStatus=a.s.MISSING,this.histogram=void 0,this.colorSlider?.destroy(),this.colorSlider=void 0,this.sliderZoomed=!1,this.getStatistics()}componentWillLoad(){this.getStatistics()}render(){const{config:e}=this.smartMappingState;return(0,s.h)(s.H,{key:"07ce2a4458a408c63289e9c3bff5bd1b96f4f544"},(0,s.h)("link",{key:"aed4a76037fffae703ce2367a47006265c098f08",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,s.f)(this.el)},onError:()=>{this.styleSheetStatus="failed",(0,s.f)(this.el)}}),"loaded"===this.styleSheetStatus?this.renderColorSlider():"not-loaded"===this.styleSheetStatus?this.renderColorSliderLoading():null)}renderColorSlider(){const{statisticsStatus:e,histogramStatus:t,sliderZoomed:i,smartMappingState:n}=this,{strings:o}=n,r=(0,a.g)(n),l=(0,a.b)(r,"color");if(e===a.s.FAILED||e===a.s.MISSING||l&&1===l.stops.length||!l&&1===r.classBreakInfos.length)return this.colorSlider&&(this.colorSlider.destroy(),this.colorSlider=void 0),(0,s.h)(s.F,null);if(e===a.s.IN_PROGRESS||t===a.s.IN_PROGRESS&&!this.colorSlider)return this.renderColorSliderLoading();{const e=this.prepareColorSlider();let t=!1;if(l&&!i){const e=(0,a.d)(r,"color"),i=(0,a.aK)(l.stops,e.minSliderValue,e.maxSliderValue);(i?.minMaxSame||!(0,a.S)(i?.min)&&!(0,a.S)(i?.max))&&(t=!0,this.zoomButtonNode&&(this.zoomButtonNode.disabled=!0))}return l?this.currentStopValues=l.stops.map((e=>e.value)):this.currentBreakValues=r.classBreakInfos.map((e=>({min:e.minValue,max:e.maxValue}))),(e||this.colorSlider)&&this.colorSlider.min!==this.colorSlider.max?(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-label",null,o.panels.color.dataRange),(0,s.h)("div",{class:"slider-box-buttons-front"},this.renderInvertButton(),l&&(0,s.h)(s.F,null,(0,s.h)("div",null,"\xa0"),this.renderZoomButton(t))),(0,s.h)("div",{ref:e=>{e&&this.afterColorSliderCreate(e)}})):this.colorSlider&&this.colorSlider.min===this.colorSlider.max?(0,s.h)(s.F,null):this.renderColorSliderLoading()}}renderColorSliderLoading(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}renderInvertButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("arcgis-smart-mapping-action",{text:e.panels.color.invertSlider,icon:"arrowUpDown",onClick:()=>this.handleInvertSlider()})}renderZoomButton(e){const{strings:t}=this.smartMappingState,{sliderZoomed:i}=this;return(0,s.h)("arcgis-smart-mapping-action",{text:t.panels.color.zoomSlider,icon:i?"magnifyingGlassMinus":"magnifyingGlassPlus",disabled:e,onClick:()=>this.handleZoomSlider(),ref:e=>this.zoomButtonNode=e})}prepareColorSlider(){const{statistics:e,histogram:t,histogramStatus:i,sliderZoomed:s,smartMappingState:r}=this,{mapView:l,modules:c}=r,h=(0,a.g)(r),p=(0,a.k)(r),u=["color-age","color-age-size"].includes(p),m=this.getFieldInfo().simpleFieldType===a.w.DATE,g=(0,a.b)(h,"color"),S=(0,a.d)(h,"color");let f,b,v;if(S?(f=(0,a.aJ)(S.theme,g.stops),b=S.minSliderValue,v=S.maxSliderValue):(b=h.classBreakInfos[0].minValue,v=h.classBreakInfos[h.classBreakInfos.length-1].maxValue),({min:b,max:v}=(0,a.aH)({min:b,max:v})),i===a.s.IN_PROGRESS)return!1;if(!this.colorSlider||g&&this.colorSlider.breaks||!g&&this.colorSlider.stops){this.colorSlider?.destroy(),this.colorSliderBars=[];let i={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:b??e.min,max:v??e.max};g?(i={...i,...f},m&&!u&&(i.hasTimeData=!0,(0,n.a)(r,i,l.timeZone)),i.stops=g.stops,i.precision=(0,o.g)(g.stops),i.histogramConfig.barCreatedFunction=t&&y.bind(this,r,g,t,this.colorSliderBars),this.colorSlider=new c.ColorSlider(i),this.colorSlider&&this.colorSlider.min===this.colorSlider.max&&this.colorSlider.set(i)):(i.histogramConfig.min=h.classBreakInfos[0].minValue,i.histogramConfig.max=h.classBreakInfos[h.classBreakInfos.length-1].maxValue,this.sliderZoomed=!1,i.breaks=(0,d.g)(r),i.precision=(0,o.g)(i.breaks),i.histogramConfig.barCreatedFunction=t&&y.bind(this,r,i.breaks,t,this.colorSliderBars),this.colorSlider=new c.ClassedColorSlider(i),this.colorSlider&&this.colorSlider.min===this.colorSlider.max&&this.colorSlider.set(i),C(r,this.colorSlider,this.colorSliderBars,i.breaks,t)),this.createColorSliderChangeEvents()}else{const i=this.colorSlider;if("dragging"===i.slider?.state)return!0;let c={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1},min:b??e.min,max:v??e.max};g?(c={...c,...f},c.stops=g.stops,c.precision=(0,o.g)(g.stops),c.hasTimeData=m&&!u,m&&!u&&(0,n.a)(r,c,l.timeZone),s?this.zigzagClick||(c.zoomOptions=(0,a.aK)(g.stops,S?.minSliderValue??e.min,S?.maxSliderValue??e.max)):c.zoomOptions=null,c.histogramConfig.barCreatedFunction=t&&this.colorSliderBars&&y.bind(this,r,g,t,this.colorSliderBars),C(r,i,this.colorSliderBars,g,t)):(c.breaks=(0,d.g)(r),c.precision=(0,o.g)(c.breaks),c.histogramConfig.barCreatedFunction=t&&this.colorSliderBars&&y.bind(this,r,c.breaks,t,this.colorSliderBars),C(r,i,this.colorSliderBars,c.breaks,t)),this.sliderZoomed&&this.adjustedZoomOptions&&!this.zigzagClick&&(c.zoomOptions=this.adjustedZoomOptions,"min"===this.zoomAdjustment?(this.colorSlider.slider.min=c.zoomOptions.min,c.zoomOptions.min=null):(this.colorSlider.slider.max=c.zoomOptions.max,c.zoomOptions.max=null)),this.adjustedZoomOptions=void 0,this.zoomAdjustment=void 0,this.colorSlider.set(c),this.zigzagClick=!1}return(0,a.S)(this.colorSlider)}handleInvertSlider(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,a.g)(e),n=(0,a.b)(i,"color");if((0,a.J)(),C(e,this.colorSlider,this.colorSliderBars,n||(0,d.g)(e),this.histogram),n){let e=n.stops.map((e=>e.color));e=e.reverse(),n.stops.forEach(((t,i)=>{t.color=e[i]}))}else{let s=i.classBreakInfos.map((i=>(0,a.h)(e,i.symbol)||new t.EsriColor({r:64,g:64,b:64,a:1})));s=s.reverse(),i.classBreakInfos.forEach(((t,i)=>{(0,a.h)(e,t.symbol)&&(0,a.j)(e,t.symbol,s[i])}))}(0,a.t)(e),(0,s.f)(this.el),this.arcgisSmartMappingColorSliderChange.emit()}handleZoomSlider(e){const{smartMappingState:t}=this;if(this.cap=this.colorSlider.slider.max,this.histogramStatus===a.s.IN_PROGRESS)return;const{statistics:i}=this,s=(0,a.g)(t);this.sliderZoomed=(0,a.S)(e)?!!e:!this.sliderZoomed;const n=(0,a.b)(s,"color");n||(this.sliderZoomed=!1);const o=(0,a.d)(s,"color"),r=this.sliderZoomed?(0,a.aK)(n.stops,o?.minSliderValue??i.min,o?.maxSliderValue??i.max):null,l=o?.minSliderValue===o?.maxSliderValue;this.getHistogram({field:n.field,expression:n.valueExpression,expressionTitle:n.valueExpressionTitle,simpleFieldType:a.w.NUMBER},n.normalizationField??void 0,i,(r?.min||(l?i.min:o?.minSliderValue??i.min))??void 0,(r?.max||(l?i.max:o?.maxSliderValue??i.max))??void 0)}afterColorSliderCreate(e){if(this.colorSlider.container)e.append(this.colorSlider.container);else{const t=document.createElement("div");t.classList.add("slider-container"),e.append(t),this.colorSlider.container=t}}getStatistics(){const{smartMappingState:e}=this,{layer:t,useFeatureReduction:i,mapView:s,modules:n}=e,o=t,r=(0,a.g)(e);let l,c;const d=this.getFieldInfo(),h=(0,a.b)(r,"color"),p=(h?h.normalizationField:r.normalizationField)??void 0,u=(0,a.d)(r,"color")||{};l=u.minSliderValue??r.classBreakInfos?.[0]?.minValue,c=u.maxSliderValue??r.classBreakInfos?.[r.classBreakInfos.length-1]?.maxValue,this.statisticsStatus=a.s.IN_PROGRESS,this.statistics||n.summaryStatistics({layer:o,view:s,field:d.field??void 0,valueExpression:d.expression??void 0,normalizationField:p,forBinning:"featureReduction"in o&&"binning"===o.featureReduction?.type&&i,outStatisticTypes:{exclude:["median"]}}).then((e=>{if(0===e.count){const[t,i]=this.getDefaultDataRange(d),s=u.minSliderValue||t,n=u.maxSliderValue||i;e.min=s,e.max=n,e.avg=(n+s)/2,(0,a.S)(u.minSliderValue)||(u.minSliderValue=s,u.maxSliderValue=n)}else if(!(0,a.S)(e.avg)||!(0,a.S)(e.min)||!(0,a.S)(e.max))return void(this.statisticsStatus=a.s.FAILED);e=(0,a.aH)(e),({min:l,max:c}=(0,a.aH)({min:l,max:c})),l=l??e.min,c=c??e.max,this.statistics=e,this.statisticsStatus=a.s.SUCCESS,this.getHistogram(d,p,e,l,c)}),(e=>{console.log(e),this.statisticsStatus=a.s.FAILED}))}getHistogram(e,t,i,s,n){const{layer:o,useFeatureReduction:r,mapView:l,modules:c}=this.smartMappingState,d=o;(i=i||this.statistics)&&0!==i.count&&(this.histogramStatus=a.s.IN_PROGRESS,c.histogram({layer:d,view:l,field:e.field??void 0,valueExpression:e.expression??void 0,numBins:50,minValue:(0,a.S)(s)?s:i.min??void 0,maxValue:(0,a.S)(n)?n:i.max??void 0,normalizationField:t,forBinning:"featureReduction"in d&&"binning"===d.featureReduction?.type&&r}).then((e=>{this.histogram=e,this.histogramStatus=a.s.SUCCESS}),(e=>{console.log(e),this.histogramStatus=a.s.FAILED})))}onMinMaxChange(e,t,i){const{statistics:s,smartMappingState:n}=this,o=(0,a.g)(n),r=(0,a.b)(o,"color"),l=(0,a.d)(o,"color")||{};if(!r){const i=o.classBreakInfos[0],s=o.classBreakInfos[o.classBreakInfos.length-1];i.minValue=e,i.label=(0,a.aI)(i,this.colorSlider.precision),s.maxValue=t,s.label=`> ${(0,a.aI)(s,this.colorSlider.precision)}`}"min"===i?l.minSliderValue=e:l.maxSliderValue=t;const c=(0,a.aK)(r?.stops,l.minSliderValue,l.maxSliderValue);this.zoomButtonNode&&(this.sliderZoomed?this.zoomButtonNode.disabled=!1:!c||c.minMaxSame||!(0,a.S)(c.min)&&!(0,a.S)(c.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1),this.sliderZoomed&&(this.adjustedZoomOptions=this.colorSlider.zoomOptions,"min"===i?(this.adjustedZoomOptions.min=e,this.zoomAdjustment="min"):(this.adjustedZoomOptions.max=t,this.zoomAdjustment="max"));const h=this.getFieldInfo(),p=(r?r.normalizationField:o.normalizationField)??void 0;this.getHistogram(h,p,s,e,t),C(n,this.colorSlider,this.colorSliderBars,r||(0,d.g)(n),this.histogram),e===l.minSliderValue&&t===l.maxSliderValue&&(this.sliderZoomed=!1),o.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingColorSliderChange.emit()}createColorSliderChangeEvents(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color");this.colorSlider&&(this.colorSlider.watch("zoomOptions",((e,t)=>{this.sliderZoomed&&(t?.min&&!e?.min||t?.max&&!e?.max)&&(this.zigzagClick=!0,this.handleZigzagClick(e))})),this.colorSlider.on("min-change",(e=>{i?e.value>this.currentStopValues[0]?(this.colorSlider.stops.forEach(((e,t)=>{e.value=this.currentStopValues[t]})),this.onMinMaxChange(this.currentStopValues[0],this.colorSlider.slider.max,"min")):this.onMinMaxChange(e.value,this.colorSlider.slider.max,"min"):e.value>this.currentBreakValues[0].max?this.onMinMaxChange(this.currentBreakValues[0].max,this.colorSlider.slider.max,"min"):this.onMinMaxChange(e.value,this.colorSlider.slider.max,"min")})),this.colorSlider.on("max-change",(e=>{i?e.value<this.currentStopValues[this.currentStopValues.length-1]?(this.colorSlider.stops.forEach(((e,t)=>{e.value=this.currentStopValues[t]})),this.onMinMaxChange(this.colorSlider.slider.min,this.currentStopValues[this.currentStopValues.length-1],"max")):this.onMinMaxChange(this.colorSlider.slider.min,e.value,"max"):e.value<this.currentBreakValues[this.currentBreakValues.length-1].min?this.onMinMaxChange(this.colorSlider.slider.min,this.currentBreakValues[this.currentBreakValues.length-1].min,"max"):this.onMinMaxChange(this.colorSlider.slider.min,e.value,"max")})),this.colorSlider.on("thumb-change",(e=>{if(i){const t=this.getFieldInfo();if((0,a.aL)(t)&&0===e.value)return void(0,s.f)(this.el);const i=this.colorSlider.stops;this.updateRendererStops(i)}else this.updateRendererBreaks(this.colorSlider.breaks)})),this.colorSlider.on("thumb-drag",(()=>{if(i){const e=this.colorSlider.stops;this.updateRendererStops(e)}else this.updateRendererBreaks(this.colorSlider.breaks)})),this.colorSlider.on("segment-drag",(()=>{if(i){const e=this.colorSlider.stops;this.updateRendererStops(e)}else this.updateRendererBreaks(this.colorSlider.breaks)})))}updateRendererStops(e){const{smartMappingState:t}=this,i=(0,a.g)(t),s=(0,a.b)(i,"color"),n=(0,a.d)(i,"color");5===e.length&&e.forEach((e=>e.label="")),s.stops=e,this.currentStopValues=s.stops.map((e=>e.value));const o=(0,a.aK)(s?.stops,n.minSliderValue,n.maxSliderValue);this.sliderZoomed?this.zoomButtonNode.disabled=!1:!o||o.minMaxSame||!(0,a.S)(o.min)&&!(0,a.S)(o.max)?this.zoomButtonNode.disabled=!0:this.zoomButtonNode.disabled=!1,C(t,this.colorSlider,this.colorSliderBars,s,this.histogram),(0,a.t)(t)}updateRendererBreaks(e){const{smartMappingState:t}=this,i=(0,a.g)(t);i.authoringInfo.classificationMethod="manual",i.classBreakInfos.forEach(((t,i)=>{if(t.minValue!==e[i].min||t.maxValue!==e[i].max){t.minValue=e[i].min,t.maxValue=e[i].max;const s=i>0?"> ":"";t.label=`${s} ${(0,a.aI)(t,this.colorSlider.precision)}`,this.currentBreakValues[i].min=e[i].min,this.currentBreakValues[i].max=e[i].max}})),C(t,this.colorSlider,this.colorSliderBars,(0,d.g)(t),this.histogram),(0,a.t)(t),this.arcgisSmartMappingColorSliderChange.emit()}getDefaultDataRange(e){if(e.simpleFieldType===a.w.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color"),s=(0,a.y)(e,i?i.field:t.field);return{field:i?.field||t.field,expression:i?.valueExpression||t.valueExpression,expressionTitle:i?.valueExpressionTitle||t.valueExpressionTitle,simpleFieldType:s?s.simpleFieldType:a.w.NUMBER}}handleZigzagClick(e){const{statistics:t,smartMappingState:i}=this,s=(0,a.g)(i),n=(0,a.b)(s,"color"),o=(0,a.d)(s,"color"),r=this.getFieldInfo(),l=(n?n.normalizationField:s.normalizationField)??void 0,c=o.minSliderValue===o.maxSliderValue;this.getHistogram(r,l,t,e?.min??(c?t.min:o.minSliderValue),e?.max??(c?t.max:o.maxSliderValue)),e||(this.sliderZoomed=!1)}get el(){return(0,s.a)(this)}};k.style=".slider-box {\n  height: 320px;\n\n  .esri-color-slider,\n  .esri-classed-color-slider {\n    min-width: 200px;\n  }\n\n  .esri-color-slider .esri-slider .esri-slider__content,\n  .esri-classed-color-slider .esri-slider .esri-slider__content {\n    height: 175px;\n  }\n\n  .esri-color-slider__histogram-container,\n  .esri-classed-color-slider__histogram-container {\n    width: 85px;\n  }\n\n  .esri-color-slider .esri-slider .esri-slider__label,\n  .esri-color-slider .esri-slider .esri-slider__min,\n  .esri-color-slider .esri-slider .esri-slider__max,\n  .esri-classed-color-slider .esri-slider .esri-slider__label,\n  .esri-classed-color-slider .esri-slider .esri-slider__min,\n  .esri-classed-color-slider .esri-slider .esri-slider__max {\n    text-decoration: underline;\n  }\n  .esri-color-slider .esri-slider .esri-slider__label:hover,\n  .esri-color-slider .esri-slider .esri-slider__min:hover,\n  .esri-color-slider .esri-slider .esri-slider__max:hover,\n  .esri-classed-color-slider .esri-slider .esri-slider__label:hover,\n  .esri-classed-color-slider .esri-slider .esri-slider__min:hover,\n  .esri-classed-color-slider .esri-slider .esri-slider__max:hover {\n    border: 1px solid #bbb;\n    background-color: #f3f3f3;\n    text-decoration: none;\n    z-index: 1;\n  }\n}\n\n.slider-box-buttons-front {\n  display: flex;\n}\n\n.slider-container {\n  overflow: hidden;\n}\n";const N=class{constructor(e){(0,s.r)(this,e),this.manager=(0,c.u)(this),this.styleSheetStatus="not-loaded",this.smartMappingState=(0,r.u)()}render(){const{config:e}=this.smartMappingState;return(0,s.h)(s.H,{key:"6b7a2f01fc4355fd98a1f50fe9784efb7d9ff8d4"},(0,s.h)("link",{key:"3a2dee19a86269d91f0bcb346791847d09981cb8",rel:"stylesheet",href:`${e.jsapiUrl}/themes/light/main.css`,onLoad:()=>{this.styleSheetStatus="loaded",(0,s.f)(this.el)},onError:()=>{this.styleSheetStatus="failed",(0,s.f)(this.el)}}),"loaded"===this.styleSheetStatus?this.renderHeatmapSlider():"not-loaded"===this.styleSheetStatus?this.renderHeatmapSliderLoading():null)}renderHeatmapSlider(){return this.prepareHeatmapSlider()||this.heatmapSlider?(0,s.h)("div",{class:"slider-box"},(0,s.h)("div",{ref:e=>{e&&this.afterHeatmapSliderCreate(e)}})):this.renderHeatmapSliderLoading()}renderHeatmapSliderLoading(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}prepareHeatmapSlider(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,a.g)(e);if(this.heatmapSlider){const e=this.heatmapSlider;if("dragging"===e.slider?.state)return!0;const s=i.colorStops.map((e=>new t.HeatmapColorStop({color:new t.EsriColor(e.color.toRgba()),ratio:e.ratio}))),a={stops:s.splice(3,s.length-3)};this.heatmapSlider.set(a)}else{const e=i.colorStops.map((e=>new t.HeatmapColorStop({color:new t.EsriColor(e.color.toRgba()),ratio:e.ratio}))),s={stops:e.splice(3,e.length-3)};this.heatmapSlider=new t.HeatmapSlider(s),this.createHeatmapSliderChangeEvents()}return(0,a.S)(this.heatmapSlider)}afterHeatmapSliderCreate(e){if(this.heatmapSlider.container)e.append(this.heatmapSlider.container);else{const t=document.createElement("div");e.append(t),this.heatmapSlider.container=t}}createHeatmapSliderChangeEvents(){this.heatmapSlider&&(this.heatmapSlider.on("thumb-change",(()=>{this.handleHeatmapSliderEvent()})),this.heatmapSlider.on("thumb-drag",(()=>{this.handleHeatmapSliderEvent()})))}handleHeatmapSliderEvent(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,a.g)(e),s=this.heatmapSlider.values[0],n=this.heatmapSlider.values[1];s===n&&(s+.001<=1?this.heatmapSlider.viewModel.setValue(1,s+.001):this.heatmapSlider.viewModel.setValue(0,n-.001));const o=i.colorStops.filter(((e,t)=>t<3)).map((e=>new t.HeatmapColorStop({color:new t.EsriColor(e.color.toRgba()),ratio:e.ratio}))),r=o[o.length-1].ratio;s<r&&this.heatmapSlider.viewModel.setValue(0,r);const l=o.concat(this.heatmapSlider.stops.slice());i.colorStops=l,(0,a.t)(e)}get el(){return(0,s.a)(this)}};N.style=".slider-box {\n  height: 255px;\n\n  .esri-heatmap-slider__ramp {\n    width: 30px;\n  }\n\n  .esri-heatmap-slider .esri-slider .esri-slider__content {\n    height: 175px;\n  }\n\n  .esri-heatmap-slider {\n    min-width: 200px;\n  }\n}\n";const I=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsChartBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsChartBackClick",7),this.arcgisSmartMappingPanelsChartClose=(0,s.c)(this,"arcgisSmartMappingPanelsChartClose",7),this.arcgisSmartMappingPanelsChartError=(0,s.c)(this,"arcgisSmartMappingPanelsChartError",7),this.manager=(0,c.u)(this),this.inputNodes={},this.labelNodes={},this.popoverSettings={},this.valueSymbolNodes={},this.smartMappingState=(0,r.u)(),this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,modules:t,strings:i}=this.smartMappingState,s=(0,a.g)(this.smartMappingState);this.originalRendererJSON=s.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,s.defaultLabel||(s.defaultLabel=i.panels.chart.noData),this.smartMappingState.lastDefault={otherColor:s.othersCategory?.color,otherLabel:s.othersCategory?.label||i.panels.chart.other,threshold:s.othersCategory?.threshold,defaultColor:s.defaultColor,defaultLabel:s.defaultLabel},this.percentLabelFlip=(0,a.a1)(this.smartMappingState,this.el)}componentDidLoad(){(0,u.i)(this.el.shadowRoot,this.smartMappingState.modules.esriConfig),requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.sizeSliderWatchHandle?.remove(),this.smartMappingState.lastDefault=void 0,this.smartMappingState.selectedAttribute=void 0,this.smartMappingState.selectedValue=void 0,(0,a.a9)(),this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=e?void 0:i?.title??t.title;return(0,s.h)(s.H,{key:"e0509741d173fd1bc6067222636d8f35c389b185",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"0103272f01d80599781e00b74ac21adc0f7d881e",class:"flow-item",closable:(0,a.K)(this.el),heading:n.panels.styleOptions,description:o,showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsChartBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderDoneButton(),this.renderCancelButton()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,i="chart-size"===(0,a.k)(e);return(0,s.h)("calcite-block",{class:"chart-block",heading:i?t.panels.chart.chartStyleColor:t.panels.chart.chartStyle,open:!0,collapsible:!1},this.renderChartSymbol(),this.renderValues(),this.renderChartSize(),this.renderShape(),this.renderMinSlice(),this.renderBackgroundStyle())}renderChartSymbol(){const{smartMappingState:e}=this,{mapView:t,modules:i}=e,n=(0,a.g)(e).attributes,o=i.pieChartSchemes.getSchemes({basemap:t.map?.basemap,geometryType:(0,a.I)(e),numColors:n.length}),r=(0,a.ae)(o,Math.min(n.length,10))[0].colors,l=n?.length?n.slice(0,10).map(((e,t)=>e.color?new i.EsriColor(e.color):new i.EsriColor(r[t%r.length]))):[];return(0,s.h)("arcgis-smart-mapping-symbol-button",{type:"chart-ramp",colors:l,rampType:"discrete",onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,s.f)(this.el)})}renderValues(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e);return(0,s.h)("calcite-label",{class:"top-padding"},t.panels.chart.fieldName,(0,s.h)("calcite-list",{class:"top-grey-border",label:t.panels.chart.fields},(0,s.h)("calcite-list",{label:"attributes","drag-enabled":!0,onCalciteListOrderChange:e=>{const t=Array.from(e.target.children);this.handleSortLegend(t)}},i.attributes.map(((e,t)=>this.renderValue(e,t)))),this.renderOtherValue(),this.renderNullValue()))}renderValue(e,t){return(0,s.h)("calcite-list-item",{scale:"s",key:e.field,value:e.field},this.renderSymbolNode(e,t),this.renderTextNode(e,t))}renderSymbolNode(e,t){const{smartMappingState:i}=this,{modules:n,selectedAttribute:o,strings:r}=i,l=(0,a.f)(i);l.color=new n.EsriColor(e.color),l.outline=void 0;const c={symbol:!0,"symbol-is-white":(0,a.T)(i,l)},d={"symbol-icon":!0,selected:o===t};return(0,s.h)("div",{class:c,slot:"content-start",role:"button","aria-label":r.panels.chart.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":o===t,onClick:()=>this.handleValueSymbolClick(t),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(t)}},(0,s.h)("div",{class:d,tabIndex:0,"aria-hidden":"true",ref:e=>{e&&(this.valueSymbolNodes[t]=e,(0,a.aM)(i,l)?(e.style.backgroundColor="",e.style.opacity=""):(e.style.backgroundColor=l.color?.toHex()??"#ffffff",e.style.opacity=l.color?.a??0))}}))}renderOtherValue(){const{smartMappingState:e}=this,{lastDefault:t,modules:i,selectedAttribute:n,strings:o}=e,r=(0,a.g)(e),l=r.othersCategory?.color||t.otherColor,c=(0,a.f)(e);c.color=new i.EsriColor(l),c.outline=void 0;const d=r.othersCategory?.label||t.otherLabel,h={"other-symbol":!0,"symbol-is-white":(0,a.T)(e,c)},p={"symbol-icon":!0,selected:-1===n};return(0,s.h)("calcite-list-item",{scale:"s",class:"top-grey-border other-null-list-item"},(0,s.h)("div",{class:h,slot:"content-start",role:"button","aria-haspopup":"true","aria-expanded":-1===n,"aria-label":o.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",d),onClick:()=>this.handleValueSymbolClick(-1),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(-1)}},(0,s.h)("div",{class:p,tabIndex:0,"aria-hidden":"true",ref:t=>{t&&(this.valueSymbolNodes[-1]=t,(0,a.aM)(e,c)?(t.style.backgroundColor="",t.style.opacity=""):(t.style.backgroundColor=c.color?.toHex()??"#ffffff",t.style.opacity=c.color?.a??0))}})),this.renderTextNode({symbol:c,label:d},-1))}renderTextNode(e,t){const{strings:i}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("div",{"aria-label":i.panels.chart.accessibility.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{(0,a.J)(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),this.smartMappingState.selectedValue=t},onKeyDown:e=>{(0,a.J)()," "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),this.smartMappingState.selectedValue=t)},ref:e=>this.labelNodes[t]=e},e.label),(0,s.h)("calcite-input",{class:"hidden",slot:"content",tabIndex:0,value:e.label,onFocusout:e=>{const i=e.target;this.handleValueTextChange(t,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleValueTextChange(t,i.value)}},ref:e=>this.inputNodes[t]=e}))}renderNullValue(){const{smartMappingState:e}=this,{lastDefault:t,modules:i,selectedAttribute:n,strings:o}=e,r=(0,a.g)(e),l=r.defaultColor||t.defaultColor,c=(0,a.f)(e);c.color=new i.EsriColor(l),c.outline=void 0;const d=r.defaultLabel||t.defaultLabel,h=(0,a.aM)(e,c),p={"null-symbol":!0,"symbol-is-white":(0,a.T)(e,c)},u={"symbol-icon":!0,selected:-2===n};return(0,s.h)("calcite-list-item",{scale:"s",class:"other-null-list-item"},(0,s.h)("calcite-switch",{scale:"s",disabled:h,slot:"actions-start",class:"null-value-toggle",tabIndex:h?-1:void 0,checked:!!r.defaultColor&&!h,onClick:()=>this.handleNullValueCheckChange(),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleNullValueCheckChange()}}),(0,s.h)("div",{class:p,slot:"content-start",role:"button","aria-haspopup":"true","aria-expanded":-2===n,"aria-label":o.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",d),onClick:()=>this.handleValueSymbolClick(-2),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(-2)}},(0,s.h)("div",{class:u,tabIndex:0,"aria-hidden":"true",ref:e=>{e&&(this.valueSymbolNodes[-2]=e,h?(e.style.backgroundColor="",e.style.opacity=""):(e.style.backgroundColor=c.color?.toHex()??"#ffffff",e.style.opacity=c.color?.a??0))}})),this.renderTextNode({symbol:c,label:d},-2))}renderChartSize(){const{smartMappingState:e}=this,{mapView:t,strings:i}=e,n=(0,a.g)(e);if((0,a.b)(n,"size"))return(0,s.h)(s.F,null);const o=(0,a.b)(n,"size","auto"),r=this.getSizeValue(),l=Math.round(r/.75);return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,i.panels.chart.chartSize),(0,s.h)("arcgis-smart-mapping-slider-input",{min:10,max:120,values:[l],precision:0,suffixText:i.panels.chart.px,onArcgisSmartMappingSliderInputChange:e=>this.handleChartSizeChange(.75*e.detail)}),(0,s.h)("calcite-label",{scale:"s",layout:"inline"},(0,s.h)("calcite-checkbox",{scale:"s",checked:!!o,onCalciteCheckboxChange:e=>{this.handleAutoSizeChange(e.target.checked?"automatic":"fixed")},ref:e=>{this.adjustSizeNode=e,this.sizeSliderWatchHandle=t.watch("scale",(0,p.d)((()=>(0,s.f)(this.el)),100))}}),i.panels.chart.adjustChartSizeAutomatically))}renderShape(){const{smartMappingState:e}=this,{modules:t,strings:i}=e,n=(0,a.g)(e);if(this.shapeSlider){const e={values:[n.holePercentage??.5]};this.shapeSlider.set(e)}else{const i={min:0,max:Math.max(.9,n.holePercentage),values:[n.holePercentage??.5],precision:1};this.shapeSlider=new t.Slider(i),this.shapeSlider?.on("thumb-drag",(t=>{(0,a.g)(e).holePercentage=t.value,(0,a.t)(e)})),this.shapeSlider?.on("thumb-change",(t=>{(0,a.g)(e).holePercentage=t.value,(0,a.t)(e)}))}return(0,s.h)("div",{class:"top-padding"},(0,s.h)("calcite-label",null,i.panels.chart.shape),(0,s.h)("div",{class:"shape-slider slider-bottom-label",ref:e=>{e&&(e.style.width="100%",this.shapeSlider&&(this.shapeSlider.container=e))}}),(0,s.h)("div",{class:"slider-labels space-between","aria-hidden":"true"},(0,s.h)("calcite-label",null,i.panels.chart.pie),(0,s.h)("calcite-label",null,i.panels.chart.donut)))}renderMinSlice(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e),n=i.othersCategory?.threshold??.04;return(0,s.h)("div",{class:"top-padding"},(0,s.h)("div",{class:"space-between"},(0,s.h)("calcite-label",{layout:"inline"},t.panels.chart.grouping),(0,s.h)("calcite-icon",{scale:"s",icon:"information",role:"button",ref:e=>{e&&(0,a.ab)(e,`<div>${t.panels.chart.groupingInfo.replace("${other}",i.othersCategory?.label||t.panels.chart.other)}</div>`,!1)}})),(0,s.h)("arcgis-smart-mapping-slider-input",{disabled:!i.othersCategory,min:0,max:50,values:[Math.round(100*n)],precision:0,prefixText:this.percentLabelFlip?"%":void 0,suffixText:this.percentLabelFlip?void 0:"%",onArcgisSmartMappingSliderInputChange:t=>{const i=(0,a.g)(e);i.othersCategory&&(i.othersCategory.threshold=t.detail/100),(0,a.t)(e)}}))}renderBackgroundStyle(){return(0,s.h)("arcgis-smart-mapping-background-symbol",null)}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsChartClose.emit("save"),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{const{originalRendererJSON:t,originalFeatureReduction:i}=this;(0,a.J)(),(0,a.v)(e,t,i),this.arcgisSmartMappingPanelsChartClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}getSizeByScale(e,t){const i=e.stops,s=i.length-1,a=i[0].value,n=i[s].value;if(t<=a)return i[0].size;if(t>=n)return i[s].size;for(let e=0;e<=s;e++){const s=i[e],a=i[e+1];if(t>=s.value&&t<a.value){const e=a.value-s.value,i=s.size-a.size,n=(t-s.value)/e,o=s.size-i*n;return Math.round(100*o)/100}}return 1}getSizeValue(){const{smartMappingState:e}=this,{mapView:t}=e,i=(0,a.g)(e),s=(0,a.b)(i,"size","auto");if(s){const e=t.scale,i=s.stops;let a=0,n=!1;for(let t=0;t<i.length;t++){const s=i[t];if(e<=s.value){if(n=!0,t>0){const n=i[t-1],o=(e-n.value)/(s.value-n.value);a=n.size+(s.size-n.size)*o}else a=i[0].size;break}}return n||(a=i[i.length-1].size),a}return i.size}handleAutoSizeChange(e){const{smartMappingState:t}=this,i=(0,a.g)(t);if("fixed"===e){const e=(0,a.a)(i,"size","auto");i.visualVariables=e?.length?e:void 0,(0,a.t)(t),(0,s.f)(this.el)}else(0,d.r)((0,l.b)(t,{sizeOptimizationEnabled:!0}),this.flowItemNode).then((e=>{(0,a.t)(t,e.renderer),(0,s.f)(this.el)}),(e=>{this.adjustSizeNode.checked=!1,this.arcgisSmartMappingPanelsChartError.emit(e)}))}handleChartSizeChange(e){const{smartMappingState:t}=this,{mapView:i}=t,s=(0,a.g)(t),n=Math.max(e,.1),o=(0,a.b)(s,"size","auto");if(o){const e=n/this.getSizeByScale(o,i.scale);this.updateAutoSizeStops(o,e)}else s.size=n;(0,a.t)(t)}handleNullValueCheckChange(){const{smartMappingState:e}=this,{lastDefault:t}=e,i=(0,a.g)(e);i.defaultColor?(t.defaultColor=i.defaultColor,i.defaultColor=void 0):i.defaultColor=t.defaultColor,(0,a.t)(e),(0,s.f)(this.el)}handleSortLegend(e){const{smartMappingState:t}=this,i=(0,a.g)(t),n=i.attributes.map((e=>e.clone())),o=e.map((e=>e.value));n.sort(((e,t)=>o.indexOf(e.field)-o.indexOf(t.field))),i.attributes=n,(0,a.t)(t),(0,s.f)(this.el)}handleValueSymbolClick(e){this.popoverSettings?.popoverNode?(this.valueSymbolNodes[e].classList.remove("selected"),this.popoverSettings.index===e?((0,a.J)(),this.popoverSettings.popoverNode=void 0,this.popoverSettings.index=void 0,this.valueSymbolNodes[e].focus()):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}handleValueTextChange(e,t){const{smartMappingState:i}=this,{lastDefault:n,modules:o,strings:r}=i,l=(0,a.g)(i),c=o.rendererJsonUtils.fromJSON(this.originalRendererJSON);if(this.inputNodes[e].classList.add("hidden"),!t.length)if(-1===e)t=c.othersCategory?.label||r.panels.chart.other;else if(-2===e)t=r.panels.chart.noData;else{const i=c.attributes.find((t=>t.field===l.attributes[e].field));t=i.label}-1===e?(l.othersCategory=l.othersCategory||{color:n?.otherColor,threshold:n?.threshold??0,label:void 0},l.othersCategory.label=t,n.otherLabel=t):-2===e?(l.defaultLabel=t,n.defaultLabel=t):l.attributes=l.attributes.map(((i,s)=>(s===e&&(i.label=t),i))),(0,a.t)(i),(0,s.f)(this.el),this.labelNodes[e].classList.remove("hidden"),this.labelNodes[e].innerHTML=t,this.inputNodes[e].value=t,setTimeout((()=>{this.smartMappingState.selectedValue===e&&(this.labelNodes[e].focus(),this.smartMappingState.selectedValue=void 0)}),300)}openSymbolStylerForValue(e){const{smartMappingState:t}=this;(0,a.J)(),this.popoverSettings.popoverNode=(0,h.b)(t,{referenceElement:this.flowItemNode,heading:t.strings.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,h.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=void 0,this.valueSymbolNodes[e].classList.remove("selected"),setTimeout((()=>{this.valueSymbolNodes[e].focus()}),100)})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,h.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=void 0,this.valueSymbolNodes[e].classList.remove("selected")})),this.smartMappingState.selectedAttribute=e,(0,h.d)(t,{popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,a.t)(t),(0,s.f)(this.el)}}),this.valueSymbolNodes[e].classList.add("selected")}updateAutoSizeStops(e,t){e.stops.forEach((e=>{e.size*=t}))}get el(){return(0,s.a)(this)}};I.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.chart-block {\n  overflow-x: hidden;\n}\n\n.null-value-toggle {\n  margin-left: -9px;\n}\n\n.hidden {\n  display: none;\n}\n\n.top-grey-border {\n  border-top: 1.5px solid #e0e0e0;\n}\n\n.top-padding {\n  margin-top: 12px;\n}\n\n.label {\n  font-size: var(--calcite-font-size--1);\n  padding-top: 5px;\n  padding-bottom: 5px;\n}\n\n.label:focus,\n.symbol-icon:focus {\n  outline: 2px solid var(--calcite-color-brand);\n}\n\n.selected {\n  outline: 1px solid var(--calcite-color-brand);\n}\n\n.other-null-list-item {\n  min-height: 45px;\n}\n\n.other-symbol {\n  margin-left: 21px;\n}\n\n.null-value-actions {\n  display: contents;\n}\n\n.shape-slider {\n  background-color: transparent;\n  position: relative;\n  width: 100%;\n  padding: 0 4px;\n}\n\n.slider-labels {\n  margin-top: 10px;\n}\n\n.space-between {\n  display: flex;\n  justify-content: space-between;\n}\n\n.symbol {\n  margin-left: 3px;\n}\n\n.symbol-icon {\n  width: 19px;\n  height: 19px;\n  margin: 2px;\n}\n\n.symbol-is-white {\n  background-color: #f3f3f3;\n}\n\n.text-wrap {\n  overflow-wrap: anywhere;\n}\n\n:dir(rtl) {\n  .null-value-toggle {\n    margin-right: -9px;\n    margin-left: auto;\n  }\n  .other-symbol {\n    margin-right: 21px;\n    margin-left: auto;\n  }\n\n  .symbol {\n    margin-right: 3px;\n    margin-left: auto;\n  }\n}\n";const E=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsChartSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsChartSizeBackClick",7),this.arcgisSmartMappingPanelsChartSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsChartSizeClose",7),this.arcgisSmartMappingPanelsChartSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsChartSizeError",7),this.manager=(0,c.u)(this),this.tileNodes={},this.smartMappingState=(0,r.u)(),this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsChartSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsChartSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.B)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,mapImageSublayer:t,layer:i,strings:n}=this.smartMappingState,o=e?void 0:t?.title??i.title;return(0,s.h)(s.H,{key:"8d3a22bde576f68bf6304f1a2255dea740108079",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"2978969c41dcd04f9d55cadd7236731a832e1531",class:"flow-item",closable:(0,a.K)(this.el),heading:n.panels.styleOptions,description:o??void 0,showBackButton:this.showBackButton,selected:this.selected,ref:e=>this.flowItemNode=e,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsChartSizeBackClick.emit()},onCalciteFlowItemClose:()=>this.arcgisSmartMappingPanelsChartSizeClose.emit()},this.renderChartTile(),this.renderSizeTile(),this.renderDoneButton(),this.renderCancelButton()))}renderChartTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"chart",selected:"chart"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="chart",this.handleOptionsClick("chart")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("chart"),ref:e=>{e&&(this.tileNodes.chart=e)}})}renderSizeTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"size",selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),ref:e=>{e&&(this.tileNodes.size=e)}})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsChartSizeClose.emit(),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{(0,a.v)(e,this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsChartSizeClose.emit()},appearance:"outline-fill",width:"half"},t.cancel)}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[this.lastClick]?.setFocus())))),300)}get el(){return(0,s.a)(this)}};E.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}";const z=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsColorClose=(0,s.c)(this,"arcgisSmartMappingPanelsColorClose",7),this.arcgisSmartMappingPanelsColorBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsColorBackClick",7),this.arcgisSmartMappingPanelsColorError=(0,s.c)(this,"arcgisSmartMappingPanelsColorError",7),this.manager=(0,c.u)(this),this.smartMappingState=(0,r.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsColorClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,a.v)(i,e,t),this.arcgisSmartMappingPanelsColorClose.emit("cancel")},this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return(0,s.h)(s.H,{key:"3c3a10fb61b06bdb3d9e1d5e8d19b18af5e29991",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"ceacc0dc3ec340d7bc9ca5a1603754c144aea51e",heading:i.panels.styleOptions,description:t?void 0:e.title,class:"flow-item",closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsColorBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,s.h)(s.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,s.h)(s.F,null)}renderVisualization(){const{visualizationOpen:e,hideTransparency:t,hideRotation:i,smartMappingState:n}=this,{strings:o}=n,r=(0,a.k)(n),l=["color-age","color-age-size"].includes(r),c=(0,a.g)(n),d=(0,a.b)(c,"color"),h=d?d.field?(0,a.y)(n,d.field)?.label:d.valueExpressionTitle||o.expression:c.field?(0,a.y)(n,c.field)?.label:c.valueExpressionTitle||o.expression,p=(0,a.r)(n)[0].simpleFieldType===a.w.DATE;return(0,s.h)("calcite-block",{class:"color-block",heading:l?o.panels.color.colorAgeStyle:p?o.panels.color.colorStyleDate:o.panels.color.colorStyle,collapsible:!t||!i,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},l?null:(0,s.h)("calcite-label",{class:"attribute-name"},h),this.renderAge(),this.renderTheme(),this.renderDividedBy(),this.renderSymbol(),this.renderColorSlider(),this.renderRegenerateStyle(),this.renderBackgroundStyle(),this.renderDefaultSymbol(),this.renderShowInLegend(),this.renderClassify())}renderAge(){const{smartMappingState:e}=this,t=(0,a.k)(e);return["color-age","color-age-size"].includes(t)?(0,s.h)("arcgis-smart-mapping-age",{rendererSubtype:"color",onArcgisSmartMappingAgeChange:()=>{this.sliderNode.updateStatistics()},onArcgisSmartMappingAgeError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)}):(0,s.h)(s.F,null)}renderTheme(){const{smartMappingState:e}=this,t=(0,a.g)(e);if(!(0,a.b)(t,"color"))return(0,s.h)(s.F,null);const i=(0,a.k)(e);return(0,s.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:"color",onArcgisSmartMappingThemeButtonBeforeOpen:()=>(0,a.J)(),onArcgisSmartMappingThemeButtonChange:t=>{let n=d.b;["color-age","color-age-size"].includes(i)&&(n=d.c),(0,d.r)(n(e,{theme:t.detail,discardMinMax:!0}),this.flowItemNode).then((t=>{const i=(0,a.g)(e);i.visualVariables=(0,a.a)(i,"color")||[],i.visualVariables.push((0,a.b)(t.renderer,"color")),i.authoringInfo.visualVariables=(0,a.c)(i,"color")||[],i.authoringInfo.visualVariables.push((0,a.d)(t.renderer,"color")),(0,a.t)(e),(0,s.f)(this.el),this.themeButtonNode&&(0,s.f)(this.themeButtonNode),this.classifyNode&&(0,s.f)(this.classifyNode),this.sliderNode&&((0,s.f)(this.sliderNode),this.sliderNode.updateStatistics())}),(e=>{(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingPanelsColorError.emit(e)}))}})}renderDividedBy(){const{smartMappingState:e}=this,{fields:t}=e,i=(0,a.g)(e),n=(0,a.k)(e);if(["color-age","color-age-size"].includes(n))return(0,s.h)(s.F,null);if((0,a.N)(e,t).number<2)return(0,s.h)(s.F,null);const o=(0,a.b)(i,"color");if(o){const t=(0,a.y)(e,o.field),i={field:o.field,expression:o.valueExpression,expressionTitle:o.valueExpressionTitle,simpleFieldType:t?t.simpleFieldType:a.w.NUMBER};if(i.expression||i.simpleFieldType!==a.w.NUMBER)return(0,s.h)(s.F,null)}else if(i.valueExpression)return(0,s.h)(s.F,null);return(0,s.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"color",normalizationField:(o?o.normalizationField:i.normalizationField)??void 0,onArcgisSmartMappingDividedByChange:()=>{(0,s.f)(this.el),this.sliderNode.updateStatistics(),this.classifyNode&&(0,s.f)(this.classifyNode)},onArcgisSmartMappingDividedByError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)})}renderSymbol(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color"),n=t.classBreakInfos,o=n[0].symbol;let r;return i?r=i.stops.map((e=>{const t=e.color.clone();return t.a=1,t})):n?.length&&(r=n.map((t=>(0,a.h)(e,t.symbol)))),(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:o,colors:r,type:"color-ramp",rampType:i?"continuous":"discrete",ref:e=>{e&&(this.symbolButtonNode=e)},onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode),this.classifyNode&&(0,s.f)(this.classifyNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderColorSlider(){return(0,s.h)("arcgis-smart-mapping-color-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingColorSliderChange:()=>{(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode),this.classifyNode&&(0,s.f)(this.classifyNode),this.rotationNode&&(0,s.f)(this.rotationNode)},onArcgisSmartMappingColorSliderError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)})}renderRegenerateStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return t?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-regenerate-style",{rendererSubtype:"color",onArcgisRendererRegenerate:()=>{(0,s.f)(this.el),this.sliderNode&&((0,s.f)(this.sliderNode),this.sliderNode.updateStatistics()),this.classifyNode&&(0,s.f)(this.classifyNode)}})}renderBackgroundStyle(){const{smartMappingState:e}=this,t=(0,a.k)(e);return(0,a.e)(e)&&"color-size"===t?(0,s.h)("arcgis-smart-mapping-background-symbol",null):(0,s.h)(s.F,null)}renderDefaultSymbol(){return(0,s.h)("arcgis-smart-mapping-default-symbol",{ref:e=>{e&&(this.defaultSymbolNode=e)},onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,a.J)(),onArcgisSmartMappingDefaultSymbolChange:()=>(0,s.f)(this.symbolButtonNode)})}renderShowInLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e),n=(0,a.b)(i,"color");if(!n)return(0,s.h)(s.F,null);const o=n.legendOptions,r=!o||!1!==o.showLegend;return(0,s.h)("calcite-label",{class:"legend-toggle-padding",layout:"inline-space-between"},t.panels.color.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:r,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderClassify(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.k)(e),n=(0,a.r)(e)[0].simpleFieldType===a.w.DATE,o=["color-age","color-age-size"].includes(i);if("color"!==i||n||o)return(0,s.h)(s.F,null);const r=t.classBreakInfos;return(0,s.h)("arcgis-smart-mapping-classify",{ref:e=>this.classifyNode=e,onArcgisSmartMappingClassifyChange:t=>{const i=t.detail;(i?.closePopovers||i?.classesChange)&&(0,a.J)(),(i?.classesChange||i?.symbolChange)&&(this.symbolButtonNode.colors=r.map((t=>(0,a.h)(e,t.symbol)))),(0,s.f)(this.el),(0,s.f)(this.sliderNode),(i?.toggle||!i?.symbolChange&&!i?.closePopovers)&&this.sliderNode.updateStatistics(),this.classifyNode&&(0,s.f)(this.classifyNode),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode),this.defaultSymbolNode&&(0,s.f)(this.defaultSymbolNode)},onArcgisSmartMappingClassifyError:e=>this.arcgisSmartMappingPanelsColorError.emit(e.detail)})}renderTransparency(){const{hideTransparency:e,smartMappingState:t}=this;if(e)return(0,s.h)(s.F,null);const i=(0,a.g)(t),n=(0,a.b)(i,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!n,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsColorError.emit(e)})}renderRotation(){const{hideRotation:e,smartMappingState:t}=this;if(e)return(0,s.h)(s.F,null);const i=(0,a.g)(t),n=(0,a.b)(i,"opacity"),o=(0,a.b)(i,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!n&&!!o,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsColorError.emit(e)})}handleIncludeInLegendToggle(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color"),s=i.legendOptions;s&&!1===s.showLegend?s.title?s.showLegend=!0:i.legendOptions=void 0:(i.legendOptions=s||{},i.legendOptions.showLegend=!1),(0,a.t)(e)}get el(){return(0,s.a)(this)}};z.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.color-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const V=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsColorSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeClose",7),this.arcgisSmartMappingPanelsColorSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeBackClick",7),this.arcgisSmartMappingPanelsColorSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeError",7),this.manager=(0,c.u)(this),this.tileNodes={},this.smartMappingState=(0,r.u)(),this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"color":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsColorClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsColorSizeClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,a.v)(i,e,t),this.arcgisSmartMappingPanelsColorSizeClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.B)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return(0,s.h)(s.H,{key:"51c6f20239b8376d4bd1c38ddb622eabaf4d2988",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"3d5a7768217f3825ffc67d94781f3368f525f53b",heading:i.panels.styleOptions,description:t?void 0:e.title,class:"flow-item",closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsColorSizeBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderColorTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},e.cancel)}renderColorTile(){const{lastClick:e,smartMappingState:t}=this,i="color-age-size"===(0,a.k)(t)?"color-age":"color",n=(0,a.z)(t,"color");return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${i}-${n}`,type:i,selected:"color"===e,onArcgisSmartMappingTileSelect:()=>{this.lastClick=i,this.handleOptionsClick("color")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("color"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsColorSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes[i]=e)}})}renderSizeTile(){const{lastClick:e,smartMappingState:t}=this,i="color-size-age"===(0,a.k)(t)?"size-age":"size",n=(0,a.z)(t,"size");return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${i}-${n}`,type:i,selected:"size"===e,onArcgisSmartMappingTileThemeChange:()=>(0,s.f)(this.el),onArcgisSmartMappingTileSelect:()=>{this.lastClick=i,this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsColorSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes[i]=e)}})}renderTransparency(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity"),n=(0,a.b)(t,"rotation");return(0,a.d)(t,"spike")?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-rotation",{open:!i&&!!n,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeError.emit(e)})}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>this.tileNodes[this.lastClick]?.setFocus()))),300)}get el(){return(0,s.a)(this)}};V.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}";const B=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsColorSizeUnivariateClose=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeUnivariateClose",7),this.arcgisSmartMappingPanelsColorSizeUnivariateBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeUnivariateBackClick",7),this.arcgisSmartMappingPanelsColorSizeUnivariateError=(0,s.c)(this,"arcgisSmartMappingPanelsColorSizeUnivariateError",7),this.manager=(0,c.u)(this),this.smartMappingState=(0,r.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsColorSizeUnivariateClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,a.v)(i,e,t),this.arcgisSmartMappingPanelsColorSizeUnivariateClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return(0,s.h)(s.H,{key:"b281878cc7e0ea1e07e1fd7be1fafe7b96beac67",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"204575daf15100ff713f640cbda79bc6ee5ea647",heading:i.panels.styleOptions,description:t?void 0:e.title,class:"flow-item",closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsColorSizeUnivariateBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,s.h)(s.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,s.h)(s.F,null)}renderVisualization(){const{visualizationOpen:e,smartMappingState:t}=this,{strings:i}=t,n=(0,a.g)(t),o=(0,a.b)(n,"color"),r=o?o.field?(0,a.y)(t,o.field)?.label:o.valueExpressionTitle||i.expression:n.field?(0,a.y)(t,n.field)?.label:n.valueExpressionTitle||i.expression;return(0,s.h)("calcite-block",{class:"color-size-univariate-block",heading:i.panels.colorSizeUnivariate.colorSizeStyle,collapsible:!0,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},(0,s.h)("calcite-label",{class:"attribute-name"},r),this.renderTheme(),this.renderDividedBy(),this.renderSymbolPairButton(),this.renderAboveAndBelowSymbols(),this.renderColorScheme(),this.renderSymbol(),this.renderColorSizeSlider(),this.renderRegenerateStyle(),this.renderSizeRange(),this.renderBackgroundStyle(),this.renderDefaultSymbol(),this.renderShowInLegend())}renderTheme(){const{smartMappingState:e}=this;return(0,s.h)("arcgis-smart-mapping-theme-button",{ref:e=>this.themeButtonNode=e,rendererSubtype:"colorSize",onArcgisSmartMappingThemeButtonBeforeOpen:()=>(0,a.J)(),onArcgisSmartMappingThemeButtonChange:t=>{const i="above-and-below"===(0,a.g)(e).authoringInfo.univariateTheme,n="above-and-below"===t.detail;let o=l.e;!i&&n&&(o=l.j),(0,d.r)(o(e,{theme:t.detail,fieldInfos:(0,a.r)(e),discardMinMax:!0}),this.flowItemNode).then((t=>{(0,a.t)(e,t.renderer),(0,s.f)(this.el),this.themeButtonNode&&(0,s.f)(this.themeButtonNode),this.rotationNode&&(0,s.f)(this.rotationNode),(0,s.f)(this.sizeRangeSliderNode),this.sliderNode&&((0,s.f)(this.sliderNode),this.sliderNode.updateStatistics())}),(e=>{(0,s.f)(this.themeButtonNode),this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)}))}})}renderDividedBy(){const{smartMappingState:e}=this,{fields:t}=e,i=(0,a.g)(e),n=(0,a.k)(e);if(["color-age","color-age-size"].includes(n))return(0,s.h)(s.F,null);const o=(0,a.r)(e)[0];if(o.expression||o.simpleFieldType!==a.w.NUMBER)return(0,s.h)(s.F,null);if((0,a.N)(e,t).number<2)return(0,s.h)(s.F,null);const r=(0,a.b)(i,"color");return(0,s.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"color",normalizationField:r?.normalizationField??i.normalizationField??void 0,onArcgisSmartMappingDividedByChange:()=>{(0,s.f)(this.el),this.sliderNode.updateStatistics()},onArcgisSmartMappingDividedByError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail)})}renderSymbolPairButton(){const{smartMappingState:e}=this;if((0,a.H)(e))return(0,s.h)(s.F,null);return"above-and-below"===(0,a.g)(e).authoringInfo.univariateTheme?(0,s.h)("arcgis-smart-mapping-symbol-pair-button",{symbolType:"above-and-below",onArcgisSmartMappingSymbolPairButtonBeforeOpen:()=>(0,a.J)(),onArcgisSmartMappingSymbolPairButtonChange:()=>{(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode),this.symbolPairButtonNode&&(0,s.f)(this.symbolPairButtonNode)},onArcgisSmartMappingSymbolPairButtonError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail),ref:e=>{e&&(this.symbolPairButtonNode=e)}}):(0,s.h)(s.F,null)}renderAboveAndBelowSymbols(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e),n=i.authoringInfo;if(!("above-and-below"===n.univariateTheme))return(0,s.h)(s.F,null);if(!n.univariateSymbolStyle||2!==i.classBreakInfos?.length)return(0,s.h)(s.F,null);const o=(0,a.b)(i,"color"),r=(0,a.y)(e,o?.field||i.field),l=r?.simpleFieldType===a.w.DATE,c=i.classBreakInfos[1].symbol,d=i.classBreakInfos[0].symbol;return(0,s.h)("div",{class:"symbol-above-and-below"},(0,s.h)("arcgis-smart-mapping-symbol-button",{class:"above-below-symbol-button",popoverReferenceElement:this.flowItemNode,symbol:d,type:"below",label:l?t.panels.colorSizeUnivariate.before:t.panels.colorSizeUnivariate.below,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.symbolPairButtonNode&&(0,s.f)(this.symbolPairButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode)}}),(0,s.h)("arcgis-smart-mapping-symbol-button",{class:"above-below-symbol-button",popoverReferenceElement:this.flowItemNode,symbol:c,type:"above",label:l?t.panels.colorSizeUnivariate.after:t.panels.colorSizeUnivariate.above,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.symbolPairButtonNode&&(0,s.f)(this.symbolPairButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode)}}))}renderColorScheme(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e);if(!("above-and-below"===i.authoringInfo.univariateTheme))return(0,s.h)(s.F,null);const n=(0,a.b)(i,"color");return(0,s.h)("calcite-label",null,t.panels.colorSizeUnivariate.colorScheme,(0,s.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:e=>{e.stopPropagation(),this.handleColorSchemeChange(e.target.selectedItem.value)}},(0,s.h)("calcite-segmented-control-item",{checked:!!n,value:"continuous",ref:e=>this.continuousNode=e},t.panels.colorSizeUnivariate.continuous),(0,s.h)("calcite-segmented-control-item",{checked:!n,value:"binary",ref:e=>this.binaryNode=e},t.panels.colorSizeUnivariate.binary)))}renderSymbol(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color"),n=t.classBreakInfos;let o;return i?o=i.stops.map((e=>{const t=e.color.clone();return t.a=1,t})):n?.length&&(o=n.map((t=>(0,a.h)(e,t.symbol)))),(0,s.h)("arcgis-smart-mapping-symbol-button",{colors:o,type:"color-ramp",rampType:i?"continuous":"discrete",ref:e=>this.symbolButtonNode=e,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderColorSizeSlider(){return(0,s.h)("arcgis-smart-mapping-color-size-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingColorSizeSliderChange:()=>{(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode)},onArcgisSmartMappingColorSizeSliderError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail)})}renderRegenerateStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return t?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-regenerate-style",{onArcgisRendererRegenerate:()=>{(0,s.f)(this.el),this.sliderNode&&((0,s.f)(this.sliderNode),this.sliderNode.updateStatistics()),(0,s.f)(this.sizeRangeSliderNode)}})}renderSizeRange(){return(0,s.h)("arcgis-smart-mapping-size-range-slider",{onArcgisSmartMappingSizeRangeSliderError:e=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e.detail),ref:e=>this.sizeRangeSliderNode=e})}renderBackgroundStyle(){const{smartMappingState:e}=this,t=(0,a.k)(e);return(0,a.e)(e)&&"color-size"===t?(0,s.h)("arcgis-smart-mapping-background-symbol",null):(0,s.h)(s.F,null)}renderDefaultSymbol(){return(0,s.h)("arcgis-smart-mapping-default-symbol",{onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,a.J)(),onArcgisSmartMappingDefaultSymbolChange:()=>(0,s.f)(this.symbolButtonNode)})}renderShowInLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e),n=(0,a.b)(i,"color"),o=n?.legendOptions,r=!o||!1!==o.showLegend;return(0,s.h)("calcite-label",{class:"legend-toggle-padding",layout:"inline-space-between"},t.panels.colorSizeUnivariate.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:r,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderTransparency(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity"),n=(0,a.b)(t,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!i&&!!n,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)})}handleColorSchemeChange(e){const{smartMappingState:t}=this;(0,d.r)((0,l.e)(t,{isContinuous:"continuous"===e}),this.flowItemNode).then((e=>{(0,a.t)(t,e.renderer),(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode),(0,a.J)()}),(e=>{this.continuousNode.checked?(this.continuousNode.checked=!1,this.binaryNode.checked=!0):(this.binaryNode.checked=!1,this.continuousNode.checked=!0),this.arcgisSmartMappingPanelsColorSizeUnivariateError.emit(e)}))}handleIncludeInLegendToggle(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color"),s=(0,a.b)(t,"size"),n=s.legendOptions;n&&!1===n.showLegend?(n.title?n.showLegend=!0:s.legendOptions=void 0,i?.legendOptions?.title?i.legendOptions.showLegend=!0:i&&(i.legendOptions=void 0)):(s.legendOptions=n||{},s.legendOptions.showLegend=!1,i&&(i.legendOptions=n||{},i.legendOptions.showLegend=!1)),(0,a.t)(e)}get el(){return(0,s.a)(this)}};B.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.color-size-univariate-block{overflow-x:hidden}.attribute-name{word-break:break-all}.symbol-above-and-below{display:flex;justify-content:space-between}.above-below-symbol-button{width:49%}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const T=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsCompareClose=(0,s.c)(this,"arcgisSmartMappingPanelsCompareClose",7),this.arcgisSmartMappingPanelsCompareBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsCompareBackClick",7),this.arcgisSmartMappingPanelsCompareError=(0,s.c)(this,"arcgisSmartMappingPanelsCompareError",7),this.manager=(0,c.u)(this),this.smartMappingState=(0,r.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsCompareClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,a.v)(i,e,t),this.arcgisSmartMappingPanelsCompareClose.emit("cancel")},this.hideRotation=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1,this.statisticsStatus=a.s.MISSING}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.getStatistics()}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,strings:i}=this.smartMappingState;return(0,s.h)(s.H,{key:"a2ec7a0a5d38396cd926bf38d429685eaf009da7",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"fa5fdaf74c50f4686bdb3d01fb5d240ff1603861",heading:i.panels.styleOptions,description:t?void 0:e.title,class:"flow-item",closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsCompareBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,s.h)(s.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,s.h)(s.F,null)}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,{visualizationOpen:i,hideRotation:n}=this,o=(0,a.G)(e)&&!n,r=(0,a.g)(e),l=(0,a.b)(r,"color"),c=(0,a.d)(r,"color"),d=(0,a.y)(e,l.field),h=(0,a.y)(e,l.normalizationField),p=("ratio"===c.style?t.panels.compare.ratioTitle:"percent"===c.style?t.panels.compare.percentTitle:t.panels.compare.percentTotalTitle).replace(/\$\{field1\}/gu,d.label).replace("${field2}",h.label);return(0,s.h)("calcite-block",{class:"compare-block",heading:t.panels.compare.compareStyle,collapsible:o,open:i,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},(0,s.h)("calcite-label",null,p),this.renderSymbol(),this.renderColorSlider(),this.renderRegenerateStyle(),this.renderLabels(),this.renderCenterAt(),this.renderDefaultSymbol(),this.renderShowInLegend())}renderSymbol(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color"),n=t.classBreakInfos[0].symbol,o=i.stops.map((e=>{const t=e.color.clone();return t.a=1,t}));return(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:n,colors:o,type:"color-ramp",rampType:"continuous",ref:e=>{e&&(this.symbolButtonNode=e)},onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderColorSlider(){const{smartMappingState:e}=this;return(0,s.h)("arcgis-smart-mapping-color-slider",{ref:e=>{e&&(this.sliderNode=e)},onArcgisSmartMappingColorSliderChange:()=>{const t=(0,a.g)(e),i=(0,a.b)(t,"color"),n=(0,a.d)(t,"color"),o=!!n&&"percent"===n.style,r=!!n&&"percent-of-total"===n.style;i.stops[0].label=`< ${(0,m.g)(i.stops[0].value,o,r)}`,i.stops[2].label=(0,m.g)(i.stops[2].value,o,r),i.stops[4].label=`> ${(0,m.g)(i.stops[4].value,o,r)}`,this.segmentedControlNode&&(1===i.stops[2].value?(this.equalNode.checked=!0,this.averageNode.checked=!1):(this.equalNode.checked=!1,this.averageNode.checked=!0)),(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode)},onArcgisSmartMappingColorSliderError:e=>this.arcgisSmartMappingPanelsCompareError.emit(e.detail)})}renderRegenerateStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return t?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-regenerate-style",{onArcgisRendererRegenerate:()=>{(0,s.f)(this.el),this.sliderNode&&((0,s.f)(this.sliderNode),this.sliderNode.updateStatistics())}})}renderLabels(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e),n=(0,a.d)(i,"color"),o=n?n.style:void 0;return(0,s.h)("calcite-label",null,t.panels.compare.labels,(0,s.h)("calcite-select",{width:"full",role:"button",label:t.panels.compare.labels,onCalciteSelectChange:e=>this.handleLabelChange(e)},(0,s.h)("calcite-option",{value:t.panels.compare.ratioLabel,label:t.panels.compare.ratioLabel,selected:"ratio"===o}),(0,s.h)("calcite-option",{value:t.panels.compare.percentTotalLabel,label:t.panels.compare.percentTotalLabel,selected:"percent-of-total"===o}),(0,s.h)("calcite-option",{value:t.panels.compare.percentLabel,label:t.panels.compare.percentLabel,selected:"percent"===o})))}renderCenterAt(){const{statistics:e,statisticsStatus:t,smartMappingState:i}=this,{strings:n}=i;if(t!==a.s.SUCCESS)return(0,s.h)(s.F,null);const o=(0,a.g)(i),r=(0,a.b)(o,"color");if(!(0,a.S)(e.min)||!(0,a.S)(e.max)||e.min>=1||e.max<=1)return(0,s.h)(s.F,null);const l=1===r.stops[2].value?"equal":"average";return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,n.panels.compare.centerAt),(0,s.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:e=>{e.stopPropagation(),this.handleCenterAtChange(e.target.selectedItem.value)},ref:e=>{e&&(this.segmentedControlNode=e)}},(0,s.h)("calcite-segmented-control-item",{checked:"equal"===l,value:"equal",ref:e=>{e&&(this.equalNode=e)}},n.panels.compare.centerEqualValues),(0,s.h)("calcite-segmented-control-item",{checked:"average"===l,value:"average",ref:e=>{e&&(this.averageNode=e)}},n.panels.compare.centerAverageValue)))}renderDefaultSymbol(){return(0,s.h)("arcgis-smart-mapping-default-symbol",{onArcgisSmartMappingDefaultSymbolBeforeToggle:()=>(0,a.J)(),onArcgisSmartMappingDefaultSymbolChange:()=>(0,s.f)(this.symbolButtonNode)})}renderShowInLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e),n=(0,a.b)(i,"color").legendOptions,o=!n||!1!==n.showLegend;return(0,s.h)("calcite-label",{class:"legend-toggle-padding",layout:"inline-space-between"},t.panels.compare.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:o,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderRotation(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity"),n=(0,a.b)(t,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!i&&!!n,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsCompareError.emit(e)})}handleLabelChange(e){const{smartMappingState:t}=this,i=e.currentTarget.value,{strings:n}=t,o=i===n.panels.compare.ratioLabel?"ratio":i===n.panels.compare.percentTotalLabel?"percent-of-total":"percent",r=(0,a.g)(t),l=(0,a.b)(r,"color");(0,a.d)(r,"color").style=o,"percent"===o?(l.stops[0].label=`< ${(0,m.g)(l.stops[0].value,!0,!1)}`,l.stops[2].label=(0,m.g)(l.stops[2].value,!0,!1),l.stops[4].label=`> ${(0,m.g)(l.stops[4].value,!0,!1)}`):"percent-of-total"===o?(l.stops[0].label=`< ${(0,m.g)(l.stops[0].value,!1,!0)}`,l.stops[2].label=(0,m.g)(l.stops[2].value,!1,!0),l.stops[4].label=`> ${(0,m.g)(l.stops[4].value,!1,!0)}`):(l.stops[0].label=`< ${(0,m.g)(l.stops[0].value,!1,!1)}`,l.stops[2].label=(0,m.g)(l.stops[2].value,!1,!1),l.stops[4].label=`> ${(0,m.g)(l.stops[4].value,!1,!1)}`),(0,a.t)(t),(0,s.f)(this.el)}getStatistics(){const{smartMappingState:e}=this,{layer:t,useFeatureReduction:i,mapView:s,modules:n}=e,o=t,r=(0,a.g)(e);let l,c;const d=this.getFieldInfo(),h=(0,a.b)(r,"color"),p=h?h.normalizationField:r.normalizationField,u=(0,a.d)(r,"color")||{};l=u.minSliderValue,c=u.maxSliderValue,this.statisticsStatus=a.s.IN_PROGRESS,this.statistics||n.summaryStatistics({layer:o,view:s,field:d.field??void 0,valueExpression:d.expression??void 0,normalizationField:p??void 0,forBinning:"featureReduction"in o&&"binning"===o.featureReduction?.type&&i,outStatisticTypes:{exclude:["median"]}}).then((e=>{if(0===e.count){const[t,i]=this.getDefaultDataRange(d),s=u.minSliderValue||t,n=u.maxSliderValue||i;e.min=s,e.max=n,e.avg=(n+s)/2,(0,a.S)(u.minSliderValue)||(u.minSliderValue=s,u.maxSliderValue=n)}else if(!(0,a.S)(e.avg)||!(0,a.S)(e.min)||!(0,a.S)(e.max))return void(this.statisticsStatus=a.s.FAILED);e=(0,a.aH)(e),({min:l,max:c}=(0,a.aH)({min:l,max:c})),l=l??e.min,c=c??e.max,this.statistics=e,this.statisticsStatus=a.s.SUCCESS}),(e=>{console.log(e),this.statisticsStatus=a.s.FAILED}))}getDefaultDataRange(e){if(e.simpleFieldType===a.w.DATE){const e=(new Date).getFullYear();return[new Date(`1/1/${e}`).getTime(),new Date(`12/31/${e}`).getTime()]}return[0,100]}getFieldInfo(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color"),s=(0,a.y)(e,i?i.field:t.field);return{field:i?.field||t.field,expression:i?.valueExpression||t.valueExpression,expressionTitle:i?.valueExpressionTitle||t.valueExpressionTitle,simpleFieldType:s?s.simpleFieldType:a.w.NUMBER}}handleCenterAtChange(e){const{statisticsStatus:t,smartMappingState:i}=this,n=this.statistics;if(t!==a.s.SUCCESS)return;const o=(0,a.g)(i),r=(0,a.b)(o,"color"),l=(0,a.d)(o,"color"),c=!!l&&"percent"===l.style,d=!!l&&"percent-of-total"===l.style;let h;if("average"===e){const e=n.avg;let t=Math.max(e-n.stddev,n.min),i=Math.min(e+n.stddev,n.max);0===n.count&&(t=n.min,i=n.max),h=S([t,i]),t=h[0],i=h[1],h=[Math.max(t,n.min),Math.max(t+(e-t)/2,n.min),e,Math.min(e+(i-e)/2,n.max),Math.min(i,n.max)],h=S(h)}else{let e=Math.max(1-n.stddev,n.min),t=Math.min(1+n.stddev,n.max);h=S([e,t]),e=h[0],t=h[1],h=[Math.max(e,n.min),Math.max(e+(1-e)/2,n.min),1,Math.min(1+(t-1)/2,n.max),Math.min(t,n.max)],h=S(h)}r.stops[0].value=h[0],r.stops[0].label=`< ${(0,m.g)(h[0],c,d)}`,r.stops[1].value=h[1],r.stops[1].label="",r.stops[2].value=h[2],r.stops[2].label=(0,m.g)(h[2],c,d),r.stops[3].value=h[3],r.stops[3].label="",r.stops[4].value=h[4],r.stops[4].label=`> ${(0,m.g)(h[4],c,d)}`,(0,a.t)(i),(0,s.f)(this.symbolButtonNode),this.sliderNode&&(0,s.f)(this.sliderNode)}handleIncludeInLegendToggle(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"color"),s=i.legendOptions;s&&!1===s.showLegend?s.title?s.showLegend=!0:i.legendOptions=void 0:(i.legendOptions=s||{},i.legendOptions.showLegend=!1),(0,a.t)(e)}get el(){return(0,s.a)(this)}};T.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.compare-block{overflow-x:hidden}.attribute-name{word-break:break-all}.legend-toggle-padding{padding-top:12px;padding-bottom:12px}";const F=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsDotDensityBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsDotDensityBackClick",7),this.arcgisSmartMappingPanelsDotDensityClose=(0,s.c)(this,"arcgisSmartMappingPanelsDotDensityClose",7),this.manager=(0,c.u)(this),this.labelNodes={},this.inputNodes={},this.legendSwatchNodes={},this.popoverSettings={},this.labelChanged=!1,this.smartMappingState=(0,r.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsDotDensityClose.emit("save")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,mapView:t,modules:i}=this.smartMappingState,s=(0,a.g)(this.smartMappingState);this.dotValue=s.dotValue,(0,a.S)(s.referenceScale)&&(this.dotValue=Math.round(s.calculateDotValue(t.scale)),this.tickDotValue=this.dotValue),this.originalRendererJSON=s.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?i.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())));const{mapView:e,modules:t}=this.smartMappingState;this.mapViewWatchHandle=t.reactiveUtils.watch((()=>e.scale),(0,p.d)((e=>this.updateDotValue(e)),300)),(0,u.i)(this.el.shadowRoot,this.smartMappingState.modules.esriConfig),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.dotWatchHandle?.remove(),this.mapViewWatchHandle?.remove(),this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=e?void 0:i?.title??t.title;return(0,s.h)(s.H,{key:"842c8a679fb909b5951fbdc42f6635068383ef1d",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"6f3f54ef764caa2f36acdc45512e1e964db3c23e",class:"flow-item",heading:n.panels.dotDensity.styleOptions,description:o,closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,ref:e=>this.flowItemNode=e,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsDotDensityBackClick.emit()}},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization()))}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{const{originalRendererJSON:t,originalFeatureReduction:i}=this;(0,a.J)(),(0,a.v)(e,t,i),this.arcgisSmartMappingPanelsDotDensityClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}renderVisualization(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-block",{class:"dot-density-block",heading:e.panels.dotDensity.dotDensityStyle,open:!0},this.renderDotStyle(),this.renderLegend(),this.renderUnits(),this.renderDotValue(),this.renderDotSize(),this.renderRegenerateStyle(),this.renderBackgroundStyle(),this.renderOptions())}renderDotStyle(){const{smartMappingState:e}=this,t=(0,a.g)(e).attributes.map((e=>e.color));return(0,s.h)("arcgis-smart-mapping-symbol-button",{type:"dot-density-ramp",rampType:"discrete",colors:t,onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,s.f)(this.el)})}renderLegend(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e);return(0,s.h)("calcite-label",null,t.panels.dotDensity.legend,(0,s.h)("calcite-list",{label:t.panels.dotDensity.values,class:"top-grey-border",dragEnabled:!0,onCalciteListOrderChange:e=>{const t=Array.from(e.target.children);this.handleSortLegend(t)}},i.attributes.map(((e,t)=>this.renderLegendItem(e,t)))))}renderLegendItem(e,t){const{smartMappingState:i}=this,{modules:n,selectedAttribute:o,strings:r}=i,l=(0,a.g)(i);return(0,s.h)("calcite-list-item",{value:e.field,key:`item-${e.field}`},(0,s.h)("div",{class:"symbol",slot:"content-start",tabIndex:0,role:"button","aria-label":r.panels.dotDensity.editSymbolFor.replace("${fieldName}",e.label),"aria-haspopup":"true","aria-expanded":o===t,onClick:()=>{this.popoverSettings?.popoverNode?(this.legendSwatchNodes[t].classList.remove("selected"),this.popoverSettings.index===t?((0,a.J)(),this.popoverSettings.popoverNode=void 0,this.popoverSettings.index=void 0):(this.popoverSettings.index=t,this.openSymbolStylerForLegendSwatch(t))):(this.popoverSettings.index=t,this.openSymbolStylerForLegendSwatch(t))},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.openSymbolStylerForLegendSwatch(t))},ref:e=>this.legendSwatchNodes[t]=e},(0,s.h)("img",{src:n.symbolUtils.renderDotDensityPreviewHTML(l,new n.EsriColor([e.color.r,e.color.g,e.color.b]),{swatchSize:16}).src,"aria-hidden":"true"})),this.renderTextNode(e,t))}renderTextNode(e,t){const{strings:i}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("div",{"aria-label":i.panels.dotDensity.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus()},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus())},ref:e=>this.labelNodes[t]=e},e.label),(0,s.h)("calcite-input",{class:"hidden",slot:"content",value:e.label,placeholder:e.label,onFocusout:e=>{const i=e.target;this.handleLegendItemTextChange(t,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleLegendItemTextChange(t,i.value)}},ref:e=>this.inputNodes[t]=e}))}renderUnits(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e);return(0,s.h)("calcite-label",null,t.panels.dotDensity.dotsRepresent,(0,s.h)("calcite-input",{value:i.legendOptions?.unit||"",onCalciteInputInput:t=>{const i=(0,a.g)(e),s=t.target;i.legendOptions=i.legendOptions??{unit:void 0},i.legendOptions.unit=s.value||"",this.updateDotValueEquation(),(0,a.t)(e)}}))}renderDotValue(){const{smartMappingState:e}=this,{modules:t,strings:i}=e,n=(0,a.g)(e),o=n.authoringInfo,{tickDotValue:r}=this;if(!o)return(0,s.h)(s.F,null);const l=this.initSliderSteps(),c=[{mode:"position",visibleElements:{labels:!0},labelsVisible:!0,values:[this.getSliderStepsPos(r)],tickCreatedFunction:(e,t,i)=>{t.onclick=()=>{this.handleDotValueChange(r)},i.onclick=()=>{this.handleDotValueChange(r)}}}];if(this.dotValueSlider){let e={values:[this.getSliderStepsPos(this.dotValue)]};(l||this.dotValueSlider.tickConfigs[0].values[0]!==c[0].values[0])&&(e={min:0,max:this.sliderSteps.length-1,values:[this.getSliderStepsPos(this.dotValue)],labelFormatFunction:e=>this.sliderSteps[e],tickConfigs:c}),this.dotValueSlider.set(e)}else{const e={min:0,max:this.sliderSteps.length-1,values:[this.getSliderStepsPos(this.dotValue)],visibleElements:{labels:!0,rangeLabels:!0},rangeLabelInputsEnabled:!1,precision:0,labelInputsEnabled:!0,labelFormatFunction:e=>this.sliderSteps[e],inputFormatFunction:e=>this.sliderSteps[e],inputParseFunction:e=>{this.labelChanged=!0;let t=Number.parseInt(e);return Number.isNaN(t)?this.dotValueSlider.values[0]:(t<=0&&(t=1),this.sliderSteps.includes(t)||(this.sliderSteps?.push(t),this.sliderSteps?.sort(((e,t)=>e-t)),this.dotValueSlider?.set({max:this.sliderSteps.length-1,values:[this.getSliderStepsPos(t)]})),this.handleDotValueChange(t),this.getSliderStepsPos(t))},tickConfigs:c};this.dotValueSlider=new t.Slider(e),this.dotValueSlider?.on("thumb-change",(e=>{this.labelChanged||this.handleDotValueChange(this.sliderSteps[e.value])})),this.dotValueSlider?.on("thumb-drag",(e=>{this.labelChanged||this.handleDotValueChange(this.sliderSteps[e.value])}))}const d=o.minSliderValue!==o.maxSliderValue,h=o.minSliderValue.toString().length>5||o.maxSliderValue.toString().length>5;return d?(0,s.h)("calcite-label",null,i.panels.dotDensity.dotValue,(0,s.h)("div",{class:"dot-value-content"},(0,s.h)("div",{class:"slider dot-value-slider "+(h?"slider-bottom-label":""),ref:e=>{setTimeout((()=>{this.dotValueSlider&&e&&(this.dotValueSlider.container=e)}),1)}}),(0,s.h)("calcite-label",{alignment:"center",ref:e=>this.dotValueEquationNode=e},i.panels.dotDensity.dotValueEquation.replace("${value}",this.dotValue.toString()).replace("${units}",n.legendOptions?.unit||"")))):(0,s.h)(s.F,null)}renderDotSize(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:i,strings:n}=e;if(i&&t.version<11.1)return(0,s.h)(s.F,null);const o=(0,a.g)(e),r=Math.round(o.dotSize/.75*10)/10;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,n.panels.dotDensity.dotSize),(0,s.h)("arcgis-smart-mapping-slider-input",{min:.5,max:4,values:[r],precision:1,suffixText:n.panels.dotDensity.px,onArcgisSmartMappingSliderInputChange:t=>{const i=(0,a.g)(e),s=Math.round(.75*t.detail*10)/10;s!==i.dotSize&&(i.dotSize=s,(0,a.t)(e))}}))}renderRegenerateStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return t?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-regenerate-style",{onArcgisRendererRegenerate:()=>{const{smartMappingState:e}=this,{mapView:t}=e;(0,s.f)(this.el),this.updateDotValue(t.scale)}})}renderBackgroundStyle(){return(0,s.h)("arcgis-smart-mapping-background-symbol",{onArcgisSmartMappingBackgroundSymbolChange:()=>(0,s.f)(this.el)})}renderOptions(){const{smartMappingState:e}=this,{mapImageSublayer:t,mapView:i,strings:n}=e,o=(0,a.g)(e);return(0,s.h)(s.F,null,(0,s.h)("calcite-label",{layout:"inline-space-between",class:"top-margin"},n.panels.dotDensity.varyDotByScale,(0,s.h)("calcite-switch",{scale:"s",checked:o.referenceScale===i.scale,onCalciteSwitchChange:t=>{const s=t.target;(0,a.g)(e).referenceScale=s.checked?i.scale:void 0,(0,a.t)(e)}})),!t&&(0,s.h)("calcite-label",{layout:"inline-space-between"},n.panels.dotDensity.blendOverlappingColors,(0,s.h)("calcite-switch",{scale:"s",checked:o.dotBlendingEnabled,onCalciteSwitchChange:t=>{const i=t.target;(0,a.g)(e).dotBlendingEnabled=i.checked,(0,a.t)(e)}})))}getSliderStepsPos(e){let t=0;return this.sliderSteps.forEach(((i,s)=>{(e>=i||e-this.sliderSteps[t]>i-e)&&(t=s)})),t}handleLegendItemTextChange(e,t){const{smartMappingState:i}=this,s=(0,a.g)(i);if(!t.length){t=this.originalRendererJSON.attributes.find((t=>t.field===s.attributes[e].field)).label}s.attributes[e].label=t,this.inputNodes[e].classList.add("hidden"),this.labelNodes[e].classList.remove("hidden"),this.labelNodes[e].innerHTML=t,setTimeout((()=>this.labelNodes[e].focus()),300),(0,a.t)(i)}handleDotValueChange(e){const{smartMappingState:t}=this,{mapView:i}=t;this.dotValue=e,this.labelChanged=!1;const n=(0,a.g)(t);n.dotValue=Math.round(this.dotValue),n.referenceScale=(0,a.S)(n.referenceScale)?i.scale:void 0,this.updateDotValueEquation(),(0,a.t)(t),(0,s.f)(this.el)}handleSortLegend(e){const{smartMappingState:t}=this,i=(0,a.g)(t),n=i.attributes.map((e=>e.clone())),o=e.map((e=>e.value));n.sort(((e,t)=>o.indexOf(e.field)-o.indexOf(t.field))),i.attributes=n,(0,a.t)(t),(0,s.f)(this.el)}initSliderSteps(){const{smartMappingState:e}=this,t=(0,a.g)(e).authoringInfo,i=this.dotValue,s=t.minSliderValue,n=Math.max(t.maxSliderValue,i);if(this.sliderSteps?.includes(i))return!1;let o=(n-s)/2**19;o=Math.max(o,1);const r=[s];for(let e=0;e<79;e++){let t=Math.round(s+2**(e/4)*o);if(t<s+(e+1)&&(t=s+(e+1)),i<t&&i>r[r.length-1]&&r.push(i),t>=n){r.push(n);break}r.push(t)}return this.sliderSteps=r,!0}openSymbolStylerForLegendSwatch(e){const{smartMappingState:t}=this,{strings:i}=t;(0,a.J)();const n=this.legendSwatchNodes[e];document.createElement("div").className="symbol-styler-div",this.popoverSettings.popoverNode=(0,h.b)(t,{referenceElement:this.flowItemNode,heading:i.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,h.r)(this.popoverSettings.popoverNode),setTimeout((()=>n?.focus()),300),n.classList.remove("selected")})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,h.r)(this.popoverSettings.popoverNode),n.classList.remove("selected"),this.popoverSettings.popoverNode=void 0})),(0,h.e)(t,{selectedAttribute:e,popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,a.t)(t),(0,s.f)(this.el)}}),n.classList.add("selected")}updateDotValue(e){const t=(0,a.g)(this.smartMappingState);if((0,a.S)(t.referenceScale)){const i=Math.round(t.calculateDotValue(e));this.handleDotValueChange(i)}}updateDotValueEquation(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e);this.dotValueEquationNode.innerHTML=t.panels.dotDensity.dotValueEquation.replace("${value}",this.dotValue.toString()).replace("${units}",this.htmlEncode(i.legendOptions?.unit||""))}htmlEncode(e){const t=document.createElement("textarea");return t.innerText=e,t.innerHTML.split("<br>").join("\n")}get el(){return(0,s.a)(this)}};F.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.dot-density-block {\n  overflow-x: hidden;\n}\n\n.hidden {\n  display: none;\n}\n\nimg {\n  width: 16px;\n  height: 16px;\n}\n\n.label {\n  font-size: var(--calcite-font-size--1);\n  padding-top: 5px;\n  padding-bottom: 5px;\n}\n\n.label:focus,\n.symbol:focus {\n  outline: 2px solid var(--calcite-color-brand);\n}\n\n.selected {\n  outline: 1px solid var(--calcite-color-brand);\n}\n\n.symbol {\n  width: 16px;\n  height: 16px;\n  margin: 2px;\n}\n\n.top-margin {\n  margin-block-start: var(--calcite-label-margin-bottom, 0.75rem);\n}\n\n.top-grey-border {\n  border-top: 1px solid #e0e0e0;\n}\n\n.text-wrap {\n  overflow-wrap: anywhere;\n}\n\n.dot-value-content {\n  display: flex;\n  flex-direction: column;\n}\n\n.dot-value-slider {\n  width: 100%;\n  height: 70px;\n  position: relative;\n  margin: 0 auto 10px auto;\n\n  &.esri-slider--horizontal .esri-slider__tick-label {\n    cursor: pointer;\n  }\n  &.slider-bottom-label .esri-slider__max,\n  &.slider-bottom-label .esri-slider__min {\n    width: -moz-fit-content;\n    width: fit-content;\n    position: absolute;\n    bottom: 11px;\n  }\n  &.slider-bottom-label .esri-slider__max {\n    right: 0;\n    text-align: right;\n  }\n  &.slider-bottom-label .esri-slider__min {\n    left: 0;\n    text-align: left;\n  }\n  &.esri-slider--horizontal .esri-slider__label {\n    text-decoration: underline;\n  }\n  &.esri-slider--horizontal .esri-slider__label:hover {\n    border: 1px solid #bbb;\n    background-color: #f3f3f3;\n    text-decoration: none;\n    z-index: 1;\n  }\n}\n";const P=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsHeatmapClose=(0,s.c)(this,"arcgisSmartMappingPanelsHeatmapClose",7),this.arcgisSmartMappingPanelsHeatmapBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsHeatmapBackClick",7),this.arcgisSmartMappingPanelsHeatmapError=(0,s.c)(this,"arcgisSmartMappingPanelsHeatmapError",7),this.manager=(0,c.u)(this),this.smartMappingState=(0,r.u)(),this.handleDone=()=>{(0,a.J)(),this.arcgisSmartMappingPanelsHeatmapClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,a.v)(i,e,t),this.arcgisSmartMappingPanelsHeatmapClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){(0,a.a9)(),this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=e?void 0:i?.title??t.title;return(0,s.h)(s.H,{key:"480d2c0ddf83419a814798ee6f13c2bfca696013",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"d1ef3bf030845f5927e9fd4749c86da47b502b2f",class:"flow-item",heading:n.panels.heatmap.styleOptions,description:o,closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsHeatmapBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderDoneButton(),this.renderCancelButton()))}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},e.cancel)}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e),n=i.field?(0,a.y)(e,i.field)?.label:void 0;return(0,s.h)("calcite-block",{class:"heatmap-block",heading:t.panels.heatmap.heatmapStyle,open:!0},n?(0,s.h)("calcite-label",{class:"attribute-name"},n):null,this.renderSymbol(),this.renderHeatmapSlider(),this.renderSoftEdges(),this.renderInfluenceValue(),this.renderLock(),this.renderRegenerate())}renderSymbol(){const{smartMappingState:e}=this,t=(0,a.g)(e).colorStops.map((e=>{const t=e.color.clone();return t.a=1,t}));return(0,s.h)("arcgis-smart-mapping-symbol-button",{type:"heatmap-ramp",rampType:"continuous",colors:t,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.sliderNode&&(0,s.f)(this.sliderNode)}})}renderHeatmapSlider(){return(0,s.h)("arcgis-smart-mapping-heatmap-slider",{ref:e=>{e&&(this.sliderNode=e)}})}renderSoftEdges(){const{smartMappingState:e}=this,{strings:t,modules:i}=e,n=i.rendererJsonUtils.fromJSON(this.originalRendererJSON);return(0,s.h)("div",null,(0,s.h)("calcite-label",null," ",t.panels.heatmap.softenEdges," "),(0,s.h)("calcite-slider",{min:0,max:1,minLabel:t.panels.heatmap.less,maxLabel:t.panels.heatmap.more,step:.01,value:n.authoringInfo?.fadeRatio||0,onCalciteSliderInput:t=>{const i=t.target.value,n=(0,a.g)(e);if(n.authoringInfo?.fadeRatio===i)return;const o=(0,m.u)(e,i);(0,a.t)(e,o),this.sliderNode&&(0,s.f)(this.sliderNode)}}),(0,s.h)("div",{class:"slider-labels","aria-hidden":"true"},(0,s.h)("calcite-label",null,t.panels.heatmap.less),(0,s.h)("calcite-label",null,t.panels.heatmap.more)))}renderInfluenceValue(){const{smartMappingState:e}=this,{strings:t,modules:i}=e,n=i.rendererJsonUtils.fromJSON(this.originalRendererJSON);return(0,s.h)("div",{class:"top-bottom-margin-small"},(0,s.h)("calcite-label",null,t.panels.heatmap.areaOfInfluence),(0,s.h)("calcite-slider",{min:1,max:60,minLabel:t.panels.heatmap.smaller,maxLabel:t.panels.heatmap.larger,value:n.radius||0,onCalciteSliderInput:t=>{const i=t.target;(0,a.g)(e).radius=i.value||10,(0,a.t)(e)}}),(0,s.h)("div",{class:"slider-labels","aria-hidden":"true"},(0,s.h)("calcite-label",null,t.panels.heatmap.smaller),(0,s.h)("calcite-label",null,t.panels.heatmap.larger)))}renderLock(){const{smartMappingState:e}=this,{mapImageSublayer:t,strings:i}=e;if(t)return(0,s.h)(s.F,null);const n=(0,a.g)(e),{referenceScale:o}=n;return(0,s.h)("div",{class:"top-margin-medium"},(0,s.h)("calcite-label",{layout:"inline-space-between"},i.panels.heatmap.lock,(0,s.h)("calcite-switch",{scale:"s",checked:!!o,onCalciteSwitchChange:()=>{const{mapView:t}=this.smartMappingState,i=(0,a.g)(e);i.referenceScale=i.referenceScale?0:t.scale,(0,a.t)(e)},ref:e=>this.calciteSwitchNode=e,onMouseOver:()=>(0,a.ab)(this.calciteSwitchNode,i.panels.heatmap.lockHelp),onMouseOut:()=>(0,a.a9)(),onFocus:()=>(0,a.ab)(this.calciteSwitchNode,i.panels.heatmap.lockHelp),onFocusout:()=>(0,a.a9)()})))}renderRegenerate(){const{smartMappingState:e}=this,{mapImageSublayer:t,strings:i}=e;return t?(0,s.h)(s.F,null):(0,s.h)("div",{class:"top-bottom-margin-small"},(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",onClick:()=>{(0,d.r)((0,m.e)(e),this.flowItemNode).then((()=>{(0,a.t)(e)}),(e=>this.arcgisSmartMappingPanelsHeatmapError.emit(e)))},label:i.panels.heatmap.regenerate},i.panels.heatmap.regenerate))}get el(){return(0,s.a)(this)}};P.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.heatmap-block{overflow-x:hidden}.attribute-name{word-break:break-all}.slider-labels{display:flex;justify-content:space-between}.top-bottom-margin-small{margin:10px 0}.top-margin-medium{margin-top:18px}";const D=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsPredominanceBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceBackClick",7),this.arcgisSmartMappingPanelsPredominanceClose=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceClose",7),this.arcgisSmartMappingPanelsPredominanceError=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceError",7),this.arcgisSmartMappingPanelsPredominanceRegenerateRenderer=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceRegenerateRenderer",7),this.manager=(0,c.u)(this),this.valueSymbolNodes={},this.labelNodes={},this.inputNodes={},this.maxCountOtherValues=200,this.popoverSettings={},this.smartMappingState=(0,r.u)(),this.handleDone=()=>{(0,a.J)(),this.arcgisSmartMappingPanelsPredominanceClose.emit("save")},this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t,strings:i}=this.smartMappingState,s=e,n=(0,a.g)(this.smartMappingState);return this.smartMappingState.lastDefault={defaultSymbol:n.defaultSymbol||(0,a.f)(this.smartMappingState),defaultLabel:n.defaultLabel||i.panels.predominance.other},this.originalRendererJSON=n.toJSON(),this.originalFeatureReduction="featureReduction"in s&&s.featureReduction?t.esriLang.clone(s.featureReduction):void 0,this.originalOrderBy="knowledge-graph-sublayer"!==s.type&&"subtype-sublayer"!==s.type?s.orderBy??void 0:void 0,this.visualizationOpen=!0,await new Promise(((e,t)=>{(0,l.l)(this.smartMappingState,{fieldInfos:n.uniqueValueGroups[0].classes.map((e=>({field:e.values[0].value,simpleFieldType:a.w.NUMBER})))}).then((t=>{this.predominantCategoryInfos=t.predominantCategoryInfos,e(t.predominantCategoryInfos)})).catch((e=>{this.arcgisSmartMappingPanelsPredominanceError.emit({message:e,type:"error"}),t(new Error(e))}))}))}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.smartMappingState.lastDefault=void 0,this.smartMappingState.selectedValue=void 0,this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=e?void 0:i?.title??t.title;return(0,s.h)(s.H,{key:"1465bf173683bcc4fb91ee6546dfb10a257a3606",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"ce64fc8a36095a0f26eff9589e4635aa539347e7",class:"flow-item",heading:n.panels.predominance.styleOptions,description:o,closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsPredominanceBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderTransparency(),this.renderRotation(),this.renderDone(),this.renderCancel()))}renderVisualization(){const{strings:e}=this.smartMappingState,t=!this.hideTransparency||!this.hideRotation;return(0,s.h)("calcite-block",{class:"predominance-block",heading:e.panels.predominance.predominanceStyle,collapsible:t,open:this.visualizationOpen,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},this.renderPredominanceSymbol(),this.renderDrawingOrder(),this.renderValues(),this.renderMsg(),this.renderBackgroundStyle())}renderPredominanceSymbol(){const{smartMappingState:e}=this,{mapView:t,modules:i}=e,n=(0,a.g)(e).uniqueValueGroups[0].classes,o=i.predominanceSchemes.getSchemes({basemap:t.map?.basemap,geometryType:(0,a.I)(e),numColors:n.length}),r=(0,a.ae)(o,Math.min(n.length,10))[0].colors,l=n?.length?n.slice(0,10).map(((t,s)=>(0,a.h)(e,t.symbol)||new i.EsriColor(r[s%r.length]))):[];return(0,s.h)("arcgis-smart-mapping-symbol-button",{type:"predominance-ramp",colors:l,rampType:"discrete",popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderDrawingOrder(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:i,strings:n}=e;if(i||"subtype-sublayer"===t.type||"catalog-footprint"===t.type||"knowledge-graph-sublayer"===t.type)return(0,s.h)(s.F,null);const o=(0,a.g)(e);return(0,s.h)("calcite-label",{layout:"inline-space-between"},n.panels.predominance.drawingOrder,(0,s.h)("calcite-switch",{scale:"s",checked:o.orderByClassesEnabled,onCalciteSwitchChange:t=>{const i=t.target;(0,a.J)();const s=e.layer;(0,a.g)(e).orderByClassesEnabled=i.checked,i.checked?s.orderBy=void 0:s.orderBy=this.originalOrderBy,(0,a.t)(e)}}))}renderValues(){const{smartMappingState:e}=this,{lastDefault:t,strings:i}=e,n=(0,a.g)(e),o=n.defaultLabel||t.defaultLabel;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,i.panels.predominance.fieldName),(0,s.h)("calcite-list",{label:i.panels.predominance.fieldName,class:"top-grey-border","drag-enabled":!0,onCalciteListOrderChange:e=>{const t=Array.from(e.target.children);this.handleSortValues(t)}},n.uniqueValueGroups[0].classes.map(((e,t)=>this.renderValue(e,t)))),(0,s.h)("calcite-list",{label:o},this.renderDefaultValue()))}renderValue(e,t){return(0,s.h)("calcite-list-item",{scale:"s",value:e.values[0].value,key:`values-${e.values[0].value}`,"sort-values":e.values[0].value},this.renderSymbolNode(e,t),this.renderTextNode(e,t),this.renderCountNode(e))}renderSymbolNode(e,t){const{smartMappingState:i}=this,{selectedValue:n,strings:o}=i,r={"default-symbol":-1===t,symbol:t>-1,"symbol-is-white":(0,a.T)(i,e.symbol)};return(0,s.h)("div",{class:r,slot:"content-start",onClick:()=>this.handleValueSymbolClick(t),role:"button",tabIndex:0,"aria-label":o.panels.predominance.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":n===t,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(t))},ref:e=>{e&&(t>-1?this.valueSymbolNodes[t]=e:this.defaultSymbolNode=e,this.createValueSymbol(t,e))}})}renderTextNode(e,t){const{strings:i}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("div",{"aria-label":i.panels.predominance.accessibility.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{this.smartMappingState.selectedValue=t,e.target.classList.add("hidden");const i=-1===t?this.defaultInputNode:this.inputNodes[t];i.classList.remove("hidden"),i.setFocus()},onKeyDown:e=>{if(" "===e.key||"Enter"===e.key){e.preventDefault(),e.stopPropagation(),this.smartMappingState.selectedValue=t,e.target.classList.add("hidden");const i=-1===t?this.defaultInputNode:this.inputNodes[t];i.classList.remove("hidden"),i.setFocus()}},ref:e=>{t>-1?this.labelNodes[t]=e:this.defaultLabelNode=e}},e.label),(0,s.h)("calcite-input",{class:"hidden",slot:"content",value:e.label??void 0,onFocusout:e=>{const i=e.target;this.handleValueTextChange(t,i.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const i=e.currentTarget;this.handleValueTextChange(t,i.value)}},ref:e=>{t>-1?this.inputNodes[t]=e:this.defaultInputNode=e}}))}renderCountNode(e){const{strings:t}=this.smartMappingState,i=this.getPredominantCategoryValue(e.values[0].value);return i&&(0,a.S)(i.count)?(0,s.h)("div",{slot:"content-end",class:"value-count","aria-label":t.panels.predominance.accessibility.countFor.replace("${value}",e.label)},`${i.count}`):(0,s.h)(s.F,null)}renderDefaultValue(){const{smartMappingState:e}=this,{lastDefault:t,strings:i}=e,n=(0,a.g)(e),o=n.defaultSymbol||t.defaultSymbol,r=n.defaultLabel||t.defaultLabel,l=this.getPredominantCategoryValue();return(0,s.h)("calcite-list-item",{class:"top-grey-border"},(0,s.h)("calcite-switch",{class:"default-value-toggle",scale:"s",slot:"actions-start",checked:!!n.defaultSymbol,onClick:()=>{n.defaultSymbol?n.defaultSymbol=void 0:(n.defaultSymbol=t.defaultSymbol,n.defaultLabel=t.defaultLabel),(0,a.t)(e),(0,s.f)(this.el)},onKeyDown:i=>{" "!==i.key&&"Enter"!==i.key||(n.defaultSymbol?n.defaultSymbol=void 0:(n.defaultSymbol=t.defaultSymbol,n.defaultLabel=t.defaultLabel),(0,a.t)(e),(0,s.f)(this.el))}}),this.renderSymbolNode(r,-1),this.renderTextNode({symbol:o,label:r},-1),(0,s.h)("div",{slot:"content-end","aria-label":i.panels.predominance.accessibility.countFor.replace("${value}",r)},`${l&&(0,a.S)(l.count)?l.count:0}`))}renderMsg(){const{smartMappingState:e}=this,{lastDefault:t,strings:i}=e,n=(0,a.g)(e);return n.uniqueValueGroups[0].classes&&n.uniqueValueGroups[0].classes.length>this.maxCountOtherValues?(0,s.h)("div",null,i.panels.predominance.tooManyValues.replace("${count}",this.maxCountOtherValues.toString())):n.uniqueValueGroups[0].classes.length?(0,s.h)(s.F,null):(0,s.h)("div",null,i.panels.predominance.noFeatures.replace("${other}",t.defaultLabel))}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return"predominance-size"!==(0,a.k)(e)||t?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-background-symbol",null)}renderTransparency(){const{smartMappingState:e}=this;if(this.hideTransparency)return(0,s.h)(s.F,null);const t=(0,a.b)((0,a.g)(e),"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e)})}renderRotation(){const{smartMappingState:e}=this;if(this.hideRotation)return(0,s.h)(s.F,null);const t=(0,a.b)((0,a.g)(e),"opacity"),i=(0,a.b)((0,a.g)(e),"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceError.emit(e),ref:e=>this.rotationNode=e})}renderDone(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancel(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{const{originalRendererJSON:t,originalFeatureReduction:i,originalOrderBy:s}=this;e.layer.orderBy=s,(0,a.J)(),(0,a.v)(e,t,i),this.arcgisSmartMappingPanelsPredominanceClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}async createValueSymbol(e,t){const{smartMappingState:i}=this,{lastDefault:s,modules:n}=i,o=(0,a.g)(i);let r;for(r=-1===e?o.defaultSymbol||s.defaultSymbol:o.uniqueValueGroups[0].classes[e].symbol.clone();t?.childNodes?.length;)t.removeChild(t.childNodes[0]);if(r){const e=await n.symbolUtils.renderPreviewHTML(r,{size:(0,a.U)(r),symbolConfig:"cim"===r.type&&"CIMPolygonSymbol"===r.data.symbol.type?{isSquareFill:!0}:void 0});t.appendChild(e)}}getPredominantCategoryValue(e){if(!this.predominantCategoryInfos)return;const t=this.predominantCategoryInfos.filter((t=>t.value==e));return t?.length?t[0]:void 0}handleSortValues(e){const{smartMappingState:t}=this,{modules:i}=t;(0,a.J)();const n=e.map((e=>e.value)),o=(0,a.g)(t),r=o.uniqueValueGroups[0].classes.filter((e=>n.includes(`${e.values[0].value}`))).map((e=>i.esriLang.clone(e)));r.sort(((e,t)=>n.indexOf(e.values[0].value)-n.indexOf(t.values[0].value))),o.uniqueValueGroups[0].classes=r,(0,a.t)(t),(0,s.f)(this.el)}handleValueSymbolClick(e){if(this.popoverSettings?.popoverNode){(-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e]).classList.remove("selected"),this.popoverSettings.index===e?((0,a.J)(),this.popoverSettings.popoverNode=void 0,this.popoverSettings.index=void 0):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}else this.popoverSettings.index=e,this.openSymbolStylerForValue(e)}handleValueTextChange(e,t){const{smartMappingState:i}=this,{lastDefault:s,modules:n,strings:o}=i,r=(0,a.g)(i),l=n.rendererJsonUtils.fromJSON(this.originalRendererJSON);if(!t.length)if(-1===e)t=l.defaultLabel||o.panels.predominance.other;else{t=l.uniqueValueGroups[0].classes.find((t=>t.values[0].value===r.uniqueValueGroups[0].classes[e].values[0].value)).label}-1===e?(r.defaultLabel=t,s.defaultLabel=t):r.uniqueValueGroups[0].classes[e].label=t,(0,a.t)(i);const c=-1===e?this.defaultInputNode:this.inputNodes[e];c.classList.add("hidden");const d=-1===e?this.defaultLabelNode:this.labelNodes[e];d.classList.remove("hidden"),d.innerHTML=t,c.value=t,setTimeout((()=>{e===i.selectedValue&&(d.focus(),this.smartMappingState.selectedValue=void 0)}),300)}openSymbolStylerForValue(e){const{smartMappingState:t}=this;(0,a.J)();const i=-1===e?this.defaultSymbolNode:this.valueSymbolNodes[e];this.popoverSettings.popoverNode=(0,h.b)(t,{referenceElement:this.flowItemNode,heading:t.strings.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,h.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=void 0,setTimeout((()=>i.focus()),300),i.classList.remove("selected")})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,h.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=void 0,i.classList.remove("selected")})),this.smartMappingState.selectedValue=e,(0,h.f)(t,{popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,a.t)(t),(0,s.f)(this.el),this.rotationNode&&(0,s.f)(this.rotationNode)}}),i.classList.add("selected")}get el(){return(0,s.a)(this)}};D.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.predominance-block {\n  overflow-x: hidden;\n}\n\n.default-value-toggle {\n  margin-left: -9px;\n}\n\n.default-symbol {\n  display: flex;\n}\n\n.hidden {\n  display: none;\n}\n\n.label {\n  font-size: var(--calcite-font-size--1);\n  padding-top: 5px;\n  padding-bottom: 5px;\n}\n\n.label:focus,\n.symbol:focus {\n  outline: 2px solid var(--calcite-color-brand);\n}\n\n.selected {\n  outline: 1px solid var(--calcite-color-brand);\n}\n\n.symbol {\n  min-width: 26px;\n  display: flex;\n  margin-left: 3px;\n}\n\n.symbol div,\n.default-symbol div {\n  margin: auto;\n}\n\n.symbol-is-white {\n  background-color: #f3f3f3;\n}\n\n.text-wrap {\n  overflow-wrap: anywhere;\n}\n\n.top-grey-border {\n  border-top: 1px solid #e0e0e0;\n}\n\n.list-item-top-grey-border {\n  border-top: 1.5px solid #e0e0e0;\n}\n\n:dir(rtl) {\n  .default-value-toggle {\n    margin-right: -9px;\n    margin-left: auto;\n  }\n\n  .symbol {\n    margin-right: 3px;\n    margin-left: auto;\n  }\n}\n";const L=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsPredominanceSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceSizeBackClick",7),this.arcgisSmartMappingPanelsPredominanceSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceSizeClose",7),this.arcgisSmartMappingPanelsPredominanceSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsPredominanceSizeError",7),this.manager=(0,c.u)(this),this.tileNodes={},this.smartMappingState=(0,r.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsPredominanceSizeClose.emit("save")},this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e))),e.addEventListener("arcgisSmartMappingPanelsSizeRegenerateRenderer",(()=>{(0,s.f)(this.el),this.transparencyNode&&((0,s.f)(this.transparencyNode),this.transparencyNode.updateStatistics())})),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceRegenerateRenderer",(()=>{(0,s.f)(this.el),this.transparencyNode&&((0,s.f)(this.transparencyNode),this.transparencyNode.updateStatistics())})),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.B)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=t?void 0:i?.title??e.title;return(0,s.h)(s.H,{key:"c8d1a46149939036fd71ad25c57efff6a5162bbe",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"5943f75ae5c362e59c71d2a4f003f5d083dcf653",class:"flow-item",heading:n.panels.styleOptions,description:o,closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,ref:e=>this.flowItemNode=e,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsPredominanceSizeBackClick.emit()}},this.renderPredominanceTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderPredominanceTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"predominance",selected:!1,onArcgisSmartMappingTileSelect:()=>{this.lastClick="predominance",this.handleOptionsClick("predominance")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("predominance"),ref:e=>{e&&(this.tileNodes.predominance=e)}})}renderSizeTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"size",selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),ref:e=>{e&&(this.tileNodes.size=e)}})}renderTransparency(){const{smartMappingState:e}=this,t=(0,a.b)((0,a.g)(e),"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e),ref:e=>this.transparencyNode=e})}renderRotation(){const{smartMappingState:e}=this,t=(0,a.b)((0,a.g)(e),"opacity"),i=(0,a.b)((0,a.g)(e),"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsPredominanceSizeError.emit(e)})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{(0,a.v)(e,this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsPredominanceSizeClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[this.lastClick]?.setFocus())))),300)}get el(){return(0,s.a)(this)}};L.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}";const R=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsRelationshipClose=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipClose",7),this.arcgisSmartMappingPanelsRelationshipBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipBackClick",7),this.arcgisSmartMappingPanelsRelationshipError=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipError",7),this.manager=(0,c.u)(this),this.colorSliderNodes=[],this.smartMappingState=(0,r.u)(),this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,hideLayerTitle:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=t?void 0:i?.title??e.title;return(0,s.h)(s.H,{key:"5ed5151d72267a81a9db82ba319220e33a29f4f0",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"5dc41f8afe98fb22615ba6de1e326aaef37b1f3f",heading:n.panels.styleOptions,description:o,class:"flow-item",closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:()=>this.handleDone(),onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsRelationshipBackClick.emit()},ref:e=>{e&&(this.flowItemNode=e)}},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderLegend(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.handleDone(),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>this.handleCancel(),appearance:"outline-fill",width:"half"},e.cancel)}renderVisualization(){const{visualizationOpen:e,hideTransparency:t,hideRotation:i}=this,{strings:a}=this.smartMappingState;return(0,s.h)("calcite-block",{class:"relationship-block",heading:a.panels.relationship.relationshipStyle,collapsible:!t||!i,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},this.renderSymbol(),this.renderGridSize(),this.renderMethod(),this.renderField1(),this.renderField2(),this.renderRegenerateStyle(),this.renderBackgroundStyle(),this.renderDefaultSymbol())}renderSymbol(){const{smartMappingState:e}=this,{mapView:t,modules:i}=e,n=(0,a.g)(e).uniqueValueInfos??[];if(!n.length)return(0,s.h)(s.F,null);const o=i.relationshipSchemes.getSchemes({basemap:t.map?.basemap,geometryType:(0,a.I)(e)}),r=(0,a.ae)(o,Math.min(n.length,10))[0].colors,l=(n?.length?n.filter(((e,t)=>t<10)).map(((t,s)=>(0,a.h)(e,t.symbol)||new i.EsriColor(r[s%r.length]))):[]).reverse();return(0,s.h)("arcgis-smart-mapping-symbol-button",{colors:l,type:"relationship-ramp",rampType:"discrete",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.colorSliderNodes[0]&&(0,s.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,s.f)(this.colorSliderNodes[1]),(0,s.f)(this.legendNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderGridSize(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e).authoringInfo.numClasses;return(0,s.h)("calcite-label",null,t.panels.relationship.gridSize,(0,s.h)("calcite-select",{label:t.panels.relationship.gridSize,onCalciteSelectChange:e=>{const t=e.target;this.handleGridSizeChange(Number.parseFloat(t.value))}},(0,s.h)("calcite-option",{value:"2",selected:2===i},t.panels.relationship.gridsize2),(0,s.h)("calcite-option",{value:"3",selected:3===i},t.panels.relationship.gridsize3),(0,s.h)("calcite-option",{value:"4",selected:4===i},t.panels.relationship.gridsize4)))}renderMethod(){const{smartMappingState:e}=this,t=(0,a.k)(e);return(0,s.h)("arcgis-smart-mapping-method-button",{onArcgisSmartMappingMethodButtonBeforeOpen:()=>(0,a.J)(),onArcgisSmartMappingMethodButtonChange:i=>{const n=i.target,o=(0,a.g)(e);"manual"===i.detail?(o.authoringInfo.classificationMethod="manual",(0,a.t)(e),(0,s.f)(this.el)):(0,d.r)((0,l.a)(e,{classificationMethod:i.detail}),this.flowItemNode).then((i=>{if(["relationship-size"].includes(t)){const e=(0,a.b)(o,"size");i.renderer.visualVariables=i.renderer.visualVariables||[],i.renderer.visualVariables.push(e);const t=(0,a.d)(o,"size");i.renderer.authoringInfo=i.renderer.authoringInfo||{},i.renderer.authoringInfo.visualVariables=i.renderer.authoringInfo.visualVariables||[],i.renderer.authoringInfo.visualVariables.push(t)}(0,a.t)(e,i.renderer),(0,s.f)(this.el),(0,s.f)(n)}),(e=>{(0,s.f)(n),this.arcgisSmartMappingPanelsRelationshipError.emit(e)}))},ref:e=>this.methodButtonNode=e})}renderField1(){const{smartMappingState:e}=this,t=(0,a.g)(e).authoringInfo.field1,i=(0,a.y)(e,t.field),n=i.layerField.alias||i.layerField.name;return(0,s.h)("calcite-block-section",{text:n},(0,s.h)("div",{class:"block-section-padding"},this.renderDividedBy(0),this.renderColorSlider(0)))}renderField2(){const{smartMappingState:e}=this,t=(0,a.g)(e).authoringInfo.field2,i=(0,a.y)(e,t.field),n=i.layerField.alias||i.layerField.name;return(0,s.h)("calcite-block-section",{text:n},(0,s.h)("div",{class:"block-section-padding"},this.renderDividedBy(1),this.renderColorSlider(1)))}renderDividedBy(e){const{smartMappingState:t}=this,i=(0,a.g)(t).authoringInfo,n=0===e?i.field1:i.field2,o=n?.normalizationField;return(0,s.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"relationship",fieldPos:e,normalizationField:o,onArcgisSmartMappingDividedByChange:()=>{(0,s.f)(this.el),this.colorSliderNodes[e]&&this.colorSliderNodes[e].updateStatistics()}})}renderColorSlider(e){return(0,s.h)("arcgis-smart-mapping-relationship-color-slider",{fieldPos:e,ref:t=>{t&&(this.colorSliderNodes[e]=t)},onArcgisSmartMappingRelationshipColorSliderChange:()=>this.methodButtonNode&&(0,s.f)(this.methodButtonNode)})}renderRegenerateStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return t?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-regenerate-style",{rendererSubtype:"relationship",onArcgisRendererRegenerate:()=>{(0,s.f)(this.el),this.colorSliderNodes.forEach((e=>{(0,s.f)(e),e.updateStatistics()}))}})}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return t||!(0,a.e)(e)||"relationship-size"!==(0,a.k)(e)?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-background-symbol",null)}renderDefaultSymbol(){return(0,s.h)("arcgis-smart-mapping-default-symbol",null)}renderLegend(){return(0,s.h)("arcgis-smart-mapping-relationship-legend",{onArcgisSmartMappingRelationshipLegendFocusChange:()=>(0,s.f)(this.el),ref:e=>this.legendNode=e})}renderTransparency(){const{hideTransparency:e,smartMappingState:t}=this;if(e)return(0,s.h)(s.F,null);const i=(0,a.g)(t),n=(0,a.b)(i,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!n,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}renderRotation(){if(this.hideRotation)return(0,s.h)(s.F,null);const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity"),n=(0,a.b)(t,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!i&&!!n,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}handleDone(){this.arcgisSmartMappingPanelsRelationshipClose.emit("save")}handleCancel(){const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:i}=this;(0,a.v)(i,e,t),this.arcgisSmartMappingPanelsRelationshipClose.emit("cancel")}handleGridSizeChange(e){(0,a.J)();const{smartMappingState:t}=this;(0,d.r)((0,l.a)(t,{numClasses:e}),this.flowItemNode).then((e=>{if("relationship-size"===(0,a.k)(t)){const i=(0,a.g)(t),s=(0,a.b)(i,"size");e.renderer.visualVariables=e.renderer.visualVariables||[],e.renderer.visualVariables.push(s);const n=(0,a.d)(i,"size");e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(n)}(0,a.t)(t,e.renderer),(0,s.f)(this.el),this.colorSliderNodes[0]&&(0,s.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,s.f)(this.colorSliderNodes[1])}))}get el(){return(0,s.a)(this)}};R.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.relationship-block{overflow-x:hidden}.attribute-name{word-break:break-all}.block-section-padding{padding-top:6px}";const O=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsRelationshipSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipSizeClose",7),this.arcgisSmartMappingPanelsRelationshipSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipSizeBackClick",7),this.arcgisSmartMappingPanelsRelationshipSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipSizeError",7),this.manager=(0,c.u)(this),this.tileNodes={},this.smartMappingState=(0,r.u)(),this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.hideTransparency=!0,e.hideRotation=!0,e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.B)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,mapImageSublayer:t,hideLayerTitle:i,strings:n}=this.smartMappingState,o=i?void 0:t?.title??e.title;return(0,s.h)(s.H,{key:"c69c4d231024eef70e471d41fa22686680a3d391",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"21247846682af213cabcf5424926dea67a66fb03",heading:n.panels.styleOptions,description:o,class:"flow-item",closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:()=>this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("save"),onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsRelationshipSizeBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderRelationshipTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("save"),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{(0,a.v)(e,this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsRelationshipSizeClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}renderRelationshipTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"relationship",selected:"relationship"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="relationship",this.handleOptionsClick("relationship")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("relationship"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes.relationship=e)}})}renderSizeTile(){const{smartMappingState:e}=this,t=(0,a.z)(e,"size");return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${t}`,type:"size",selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileThemeChange:()=>(0,s.f)(this.el),onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes.size=e)}})}renderTransparency(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity"),n=(0,a.b)(t,"rotation");return(0,a.d)(t,"spike")?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-rotation",{open:!i&&!!n,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipSizeError.emit(e)})}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[this.lastClick]?.setFocus())))),300)}get el(){return(0,s.a)(this)}};O.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}";const _=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsSimpleClose=(0,s.c)(this,"arcgisSmartMappingPanelsSimpleClose",7),this.arcgisSmartMappingPanelsSimpleBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsSimpleBackClick",7),this.arcgisSmartMappingPanelsSimpleError=(0,s.c)(this,"arcgisSmartMappingPanelsSimpleError",7),this.manager=(0,c.u)(this),this.smartMappingState=(0,r.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsSimpleClose.emit("save")},this.handleCancel=()=>{const{originalRenderer:e,originalFeatureReduction:t,smartMappingState:i}=this,{layer:s}=i;if(s&&"geo-rss"===s.type){const t=e;s.pointSymbol=t[0],s.lineSymbol=t[1],s.polygonSymbol=t[2]}else(0,a.v)(i,e,t);this.arcgisSmartMappingPanelsSimpleClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:t}=this.smartMappingState;if(e&&"geo-rss"===e.type){const t=e;this.originalRenderer=[t.pointSymbol.clone(),t.lineSymbol.clone(),t.polygonSymbol.clone()]}else{const i=(0,a.g)(this.smartMappingState);this.originalRenderer=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,await(0,a.q)(this.smartMappingState)}}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,useFeatureReduction:t,hideLayerTitle:i,strings:n}=this.smartMappingState,o=t?n.panels.gallery.binStyles:n.panels.gallery.styles;return(0,s.h)(s.H,{key:"9a0a56529f94acefae2fdf710c8abf0ad193c763",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"f2dbc25fe3ba9fc86a9acd0b68cb36b050721c7b",heading:o,description:i?void 0:e.title,class:"flow-item",closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsSimpleBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,s.h)(s.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,s.h)(s.F,null)}renderVisualization(){const{visualizationOpen:e,smartMappingState:t}=this,{layer:i,strings:n}=this.smartMappingState;return(0,s.h)("calcite-block",{class:"simple-block",heading:n.panels.simple.simpleStyle,collapsible:"geo-rss"!==i.type&&(0,a.aN)(t),open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},"geo-rss"===i.type?this.renderGeoRssSymbols():this.renderSymbol())}renderSymbol(){const{smartMappingState:e}=this,t=(0,a.g)(e).symbol;return(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:t,type:"simple",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderGeoRssSymbols(){return(0,s.h)("div",null,this.renderGeoRssSymbol("point"),this.renderGeoRssSymbol("line"),this.renderGeoRssSymbol("polygon"))}renderGeoRssSymbol(e){const{layer:t,strings:i}=this.smartMappingState,a=t,n="point"===e?a.pointSymbol:"line"===e?a.lineSymbol:a.polygonSymbol,o="point"===e?i.panels.simple.pointSymbolStyle:"line"===e?i.panels.simple.lineSymbolStyle:i.panels.simple.polygonSymbolStyle;return(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:n??void 0,type:"point"===e?"geo-rss-point":"line"===e?"geo-rss-line":"geo-rss-polygon",label:o,onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,s.f)(this.el)})}renderTransparency(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!i,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsSimpleError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=(0,a.b)(t,"opacity"),n=(0,a.b)(t,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!i&&!!n,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsSimpleError.emit(e)})}get el(){return(0,s.a)(this)}};function A(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function H(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?A(Object(i),!0).forEach((function(t){U(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):A(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function U(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function q(){return q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},q.apply(this,arguments)}function $(e,t){if(null==e)return{};var i,s,a=function(e,t){if(null==e)return{};var i,s,a={},n=Object.keys(e);for(s=0;s<n.length;s++)i=n[s],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(s=0;s<n.length;s++)i=n[s],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}_.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.simple-block{overflow-x:hidden}";function J(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var Z=J(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),K=J(/Edge/i),j=J(/firefox/i),W=J(/safari/i)&&!J(/chrome/i)&&!J(/android/i),Y=J(/iP(ad|od|hone)/i),X=J(/chrome/i)&&J(/android/i),Q={capture:!1,passive:!1};function ee(e,t,i){e.addEventListener(t,i,!Z&&Q)}function te(e,t,i){e.removeEventListener(t,i,!Z&&Q)}function ie(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function se(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function ae(e,t,i,s){if(e){i=i||document;do{if(null!=t&&(">"===t[0]?e.parentNode===i&&ie(e,t):ie(e,t))||s&&e===i)return e;if(e===i)break}while(e=se(e))}return null}var ne,oe=/\s+/g;function re(e,t,i){if(e&&t)if(e.classList)e.classList[i?"add":"remove"](t);else{var s=(" "+e.className+" ").replace(oe," ").replace(" "+t+" "," ");e.className=(s+(i?" "+t:"")).replace(oe," ")}}function le(e,t,i){var s=e&&e.style;if(s){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),void 0===t?i:i[t];t in s||-1!==t.indexOf("webkit")||(t="-webkit-"+t),s[t]=i+("string"==typeof i?"":"px")}}function ce(e,t){var i="";if("string"==typeof e)i=e;else do{var s=le(e,"transform");s&&"none"!==s&&(i=s+" "+i)}while(!t&&(e=e.parentNode));var a=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return a&&new a(i)}function de(e,t,i){if(e){var s=e.getElementsByTagName(t),a=0,n=s.length;if(i)for(;a<n;a++)i(s[a],a);return s}return[]}function he(){var e=document.scrollingElement;return e||document.documentElement}function pe(e,t,i,s,a){if(e.getBoundingClientRect||e===window){var n,o,r,l,c,d,h;if(e!==window&&e.parentNode&&e!==he()?(o=(n=e.getBoundingClientRect()).top,r=n.left,l=n.bottom,c=n.right,d=n.height,h=n.width):(o=0,r=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,h=window.innerWidth),(t||i)&&e!==window&&(a=a||e.parentNode,!Z))do{if(a&&a.getBoundingClientRect&&("none"!==le(a,"transform")||i&&"static"!==le(a,"position"))){var p=a.getBoundingClientRect();o-=p.top+parseInt(le(a,"border-top-width")),r-=p.left+parseInt(le(a,"border-left-width")),l=o+n.height,c=r+n.width;break}}while(a=a.parentNode);if(s&&e!==window){var u=ce(a||e),m=u&&u.a,g=u&&u.d;u&&(l=(o/=g)+(d/=g),c=(r/=m)+(h/=m))}return{top:o,left:r,bottom:l,right:c,width:h,height:d}}}function ue(e){var t=pe(e),i=parseInt(le(e,"padding-left")),s=parseInt(le(e,"padding-top")),a=parseInt(le(e,"padding-right")),n=parseInt(le(e,"padding-bottom"));return t.top+=s+parseInt(le(e,"border-top-width")),t.left+=i+parseInt(le(e,"border-left-width")),t.width=e.clientWidth-i-a,t.height=e.clientHeight-s-n,t.bottom=t.top+t.height,t.right=t.left+t.width,t}function me(e,t,i){for(var s=ve(e,!0),a=pe(e)[t];s;){var n=pe(s)[i];if(!("top"===i||"left"===i?a>=n:a<=n))return s;if(s===he())break;s=ve(s,!1)}return!1}function ge(e,t,i,s){for(var a=0,n=0,o=e.children;n<o.length;){if("none"!==o[n].style.display&&o[n]!==Mt.ghost&&(s||o[n]!==Mt.dragged)&&ae(o[n],i.draggable,e,!1)){if(a===t)return o[n];a++}n++}return null}function Se(e,t){for(var i=e.lastElementChild;i&&(i===Mt.ghost||"none"===le(i,"display")||t&&!ie(i,t));)i=i.previousElementSibling;return i||null}function fe(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Mt.clone||t&&!ie(e,t)||i++;return i}function be(e){var t=0,i=0,s=he();if(e)do{var a=ce(e),n=a.a,o=a.d;t+=e.scrollLeft*n,i+=e.scrollTop*o}while(e!==s&&(e=e.parentNode));return[t,i]}function ve(e,t){if(!e||!e.getBoundingClientRect)return he();var i=e,s=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var a=le(i);if(i.clientWidth<i.scrollWidth&&("auto"==a.overflowX||"scroll"==a.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==a.overflowY||"scroll"==a.overflowY)){if(!i.getBoundingClientRect||i===document.body)return he();if(s||t)return i;s=!0}}}while(i=i.parentNode);return he()}function ye(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function Ce(e,t){return function(){if(!ne){var i=arguments;1===i.length?e.call(this,i[0]):e.apply(this,i),ne=setTimeout((function(){ne=void 0}),t)}}}function Me(e,t,i){e.scrollLeft+=t,e.scrollTop+=i}function xe(e){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}var we="Sortable"+(new Date).getTime();function ke(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==le(e,"display")&&e!==Mt.ghost){t.push({target:e,rect:pe(e)});var i=H({},t[t.length-1].rect);if(e.thisAnimationDuration){var s=ce(e,!0);s&&(i.top-=s.f,i.left-=s.e)}e.fromRect=i}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var i in e)if(e.hasOwnProperty(i))for(var s in t)if(t.hasOwnProperty(s)&&t[s]===e[i][s])return Number(i);return-1}(t,{target:e}),1)},animateAll:function(i){var s=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof i&&i());var a=!1,n=0;t.forEach((function(e){var t=0,i=e.target,o=i.fromRect,r=pe(i),l=i.prevFromRect,c=i.prevToRect,d=e.rect,h=ce(i,!0);h&&(r.top-=h.f,r.left-=h.e),i.toRect=r,i.thisAnimationDuration&&ye(l,r)&&!ye(o,r)&&(d.top-r.top)/(d.left-r.left)==(o.top-r.top)/(o.left-r.left)&&(t=function(e,t,i,s){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*s.animation}(d,l,c,s.options)),ye(r,o)||(i.prevFromRect=o,i.prevToRect=r,t||(t=s.options.animation),s.animate(i,d,r,t)),t&&(a=!0,n=Math.max(n,t),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),t),i.thisAnimationDuration=t)})),clearTimeout(e),a?e=setTimeout((function(){"function"==typeof i&&i()}),n):"function"==typeof i&&i(),t=[]},animate:function(e,t,i,s){if(s){le(e,"transition",""),le(e,"transform","");var a=ce(this.el),n=a&&a.a,o=a&&a.d,r=(t.left-i.left)/(n||1),l=(t.top-i.top)/(o||1);e.animatingX=!!r,e.animatingY=!!l,le(e,"transform","translate3d("+r+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),le(e,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),le(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){le(e,"transition",""),le(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),s)}}}}var Ne=[],Ie={initializeByDefault:!0},Ee={mount:function(e){for(var t in Ie)Ie.hasOwnProperty(t)&&!(t in e)&&(e[t]=Ie[t]);Ne.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),Ne.push(e)},pluginEvent:function(e,t,i){var s=this;this.eventCanceled=!1,i.cancel=function(){s.eventCanceled=!0};var a=e+"Global";Ne.forEach((function(s){t[s.pluginName]&&(t[s.pluginName][a]&&t[s.pluginName][a](H({sortable:t},i)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](H({sortable:t},i)))}))},initializePlugins:function(e,t,i,s){for(var a in Ne.forEach((function(s){var a=s.pluginName;if(e.options[a]||s.initializeByDefault){var n=new s(e,t,e.options);n.sortable=e,n.options=e.options,e[a]=n,q(i,n.defaults)}})),e.options)if(e.options.hasOwnProperty(a)){var n=this.modifyOption(e,a,e.options[a]);void 0!==n&&(e.options[a]=n)}},getEventProperties:function(e,t){var i={};return Ne.forEach((function(s){"function"==typeof s.eventProperties&&q(i,s.eventProperties.call(t[s.pluginName],e))})),i},modifyOption:function(e,t,i){var s;return Ne.forEach((function(a){e[a.pluginName]&&a.optionListeners&&"function"==typeof a.optionListeners[t]&&(s=a.optionListeners[t].call(e[a.pluginName],i))})),s}};var ze=["evt"],Ve=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.evt,a=$(i,ze);Ee.pluginEvent.bind(Mt)(e,t,H({dragEl:Te,parentEl:Fe,ghostEl:Pe,rootEl:De,nextEl:Le,lastDownEl:Re,cloneEl:Oe,cloneHidden:_e,dragStarted:Xe,putSortable:$e,activeSortable:Mt.active,originalEvent:s,oldIndex:Ae,oldDraggableIndex:Ge,newIndex:He,newDraggableIndex:Ue,hideGhostForTarget:bt,unhideGhostForTarget:vt,cloneNowHidden:function(){_e=!0},cloneNowShown:function(){_e=!1},dispatchSortableEvent:function(e){Be({sortable:t,name:e,originalEvent:s})}},a))};function Be(e){!function(e){var t=e.sortable,i=e.rootEl,s=e.name,a=e.targetEl,n=e.cloneEl,o=e.toEl,r=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,h=e.newDraggableIndex,p=e.originalEvent,u=e.putSortable,m=e.extraEventProperties;if(t=t||i&&i[we]){var g,S=t.options,f="on"+s.charAt(0).toUpperCase()+s.substr(1);!window.CustomEvent||Z||K?(g=document.createEvent("Event")).initEvent(s,!0,!0):g=new CustomEvent(s,{bubbles:!0,cancelable:!0}),g.to=o||i,g.from=r||i,g.item=a||i,g.clone=n,g.oldIndex=l,g.newIndex=c,g.oldDraggableIndex=d,g.newDraggableIndex=h,g.originalEvent=p,g.pullMode=u?u.lastPutMode:void 0;var b=H(H({},m),Ee.getEventProperties(s,t));for(var v in b)g[v]=b[v];i&&i.dispatchEvent(g),S[f]&&S[f].call(t,g)}}(H({putSortable:$e,cloneEl:Oe,targetEl:Te,rootEl:De,oldIndex:Ae,oldDraggableIndex:Ge,newIndex:He,newDraggableIndex:Ue},e))}var Te,Fe,Pe,De,Le,Re,Oe,_e,Ae,He,Ge,Ue,qe,$e,Je,Ze,Ke,je,We,Ye,Xe,Qe,et,tt,it,st=!1,at=!1,nt=[],ot=!1,rt=!1,lt=[],ct=!1,dt=[],ht="undefined"!=typeof document,pt=Y,ut=K||Z?"cssFloat":"float",mt=ht&&!X&&!Y&&"draggable"in document.createElement("div"),gt=function(){if(ht){if(Z)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),St=function(e,t){var i=le(e),s=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),a=ge(e,0,t),n=ge(e,1,t),o=a&&le(a),r=n&&le(n),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+pe(a).width,c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+pe(n).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&o.float&&"none"!==o.float){var d="left"===o.float?"left":"right";return!n||"both"!==r.clear&&r.clear!==d?"horizontal":"vertical"}return a&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||l>=s&&"none"===i[ut]||n&&"none"===i[ut]&&l+c>s)?"vertical":"horizontal"},ft=function(e){function t(e,i){return function(s,a,n,o){var r=s.options.group.name&&a.options.group.name&&s.options.group.name===a.options.group.name;if(null==e&&(i||r))return!0;if(null==e||!1===e)return!1;if(i&&"clone"===e)return e;if("function"==typeof e)return t(e(s,a,n,o),i)(s,a,n,o);var l=(i?s:a).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var i={},s=e.group;s&&"object"==G(s)||(s={name:s}),i.name=s.name,i.checkPull=t(s.pull,!0),i.checkPut=t(s.put),i.revertClone=s.revertClone,e.group=i},bt=function(){!gt&&Pe&&le(Pe,"display","none")},vt=function(){!gt&&Pe&&le(Pe,"display","")};ht&&!X&&document.addEventListener("click",(function(e){if(at)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),at=!1,!1}),!0);var yt=function(e){if(Te){e=e.touches?e.touches[0]:e;var t=(a=e.clientX,n=e.clientY,nt.some((function(e){var t=e[we].options.emptyInsertThreshold;if(t&&!Se(e)){var i=pe(e),s=a>=i.left-t&&a<=i.right+t,r=n>=i.top-t&&n<=i.bottom+t;return s&&r?o=e:void 0}})),o);if(t){var i={};for(var s in e)e.hasOwnProperty(s)&&(i[s]=e[s]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[we]._onDragOver(i)}}var a,n,o},Ct=function(e){Te&&Te.parentNode[we]._isOutsideThisEl(e.target)};function Mt(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=q({},t),e[we]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return St(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Mt.supportPointer&&"PointerEvent"in window&&!W,emptyInsertThreshold:5};for(var s in Ee.initializePlugins(this,e,i),i)!(s in t)&&(t[s]=i[s]);for(var a in ft(t),this)"_"===a.charAt(0)&&"function"==typeof this[a]&&(this[a]=this[a].bind(this));this.nativeDraggable=!t.forceFallback&&mt,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?ee(e,"pointerdown",this._onTapStart):(ee(e,"mousedown",this._onTapStart),ee(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(ee(e,"dragover",this),ee(e,"dragenter",this)),nt.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),q(this,ke())}function xt(e,t,i,s,a,n,o,r){var l,c,d=e[we],h=d.options.onMove;return!window.CustomEvent||Z||K?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=i,l.draggedRect=s,l.related=a||t,l.relatedRect=n||pe(t),l.willInsertAfter=r,l.originalEvent=o,e.dispatchEvent(l),h&&(c=h.call(d,l,o)),c}function wt(e){e.draggable=!1}function kt(){ct=!1}function Nt(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,s=0;i--;)s+=t.charCodeAt(i);return s.toString(36)}function It(e){return setTimeout(e,0)}function Et(e){return clearTimeout(e)}Mt.prototype={constructor:Mt,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Qe=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,Te):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,s=this.options,a=s.preventOnFilter,n=e.type,o=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,r=(o||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||r,c=s.filter;if(function(e){dt.length=0;var t=e.getElementsByTagName("input"),i=t.length;for(;i--;){var s=t[i];s.checked&&dt.push(s)}}(i),!Te&&!(/mousedown|pointerdown/.test(n)&&0!==e.button||s.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!W||!r||"SELECT"!==r.tagName.toUpperCase())&&!((r=ae(r,s.draggable,i,!1))&&r.animated||Re===r)){if(Ae=fe(r),Ge=fe(r,s.draggable),"function"==typeof c){if(c.call(this,e,r,this))return Be({sortable:t,rootEl:l,name:"filter",targetEl:r,toEl:i,fromEl:i}),Ve("filter",t,{evt:e}),void(a&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some((function(s){if(s=ae(l,s.trim(),i,!1))return Be({sortable:t,rootEl:s,name:"filter",targetEl:r,fromEl:i,toEl:i}),Ve("filter",t,{evt:e}),!0}))))return void(a&&e.cancelable&&e.preventDefault());s.handle&&!ae(l,s.handle,i,!1)||this._prepareDragStart(e,o,r)}}},_prepareDragStart:function(e,t,i){var s,a=this,n=a.el,o=a.options,r=n.ownerDocument;if(i&&!Te&&i.parentNode===n){var l=pe(i);if(De=n,Fe=(Te=i).parentNode,Le=Te.nextSibling,Re=i,qe=o.group,Mt.dragged=Te,Je={target:Te,clientX:(t||e).clientX,clientY:(t||e).clientY},We=Je.clientX-l.left,Ye=Je.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,Te.style["will-change"]="all",s=function(){Ve("delayEnded",a,{evt:e}),Mt.eventCanceled?a._onDrop():(a._disableDelayedDragEvents(),!j&&a.nativeDraggable&&(Te.draggable=!0),a._triggerDragStart(e,t),Be({sortable:a,name:"choose",originalEvent:e}),re(Te,o.chosenClass,!0))},o.ignore.split(",").forEach((function(e){de(Te,e.trim(),wt)})),ee(r,"dragover",yt),ee(r,"mousemove",yt),ee(r,"touchmove",yt),ee(r,"mouseup",a._onDrop),ee(r,"touchend",a._onDrop),ee(r,"touchcancel",a._onDrop),j&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Te.draggable=!0),Ve("delayStart",this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(K||Z))s();else{if(Mt.eventCanceled)return void this._onDrop();ee(r,"mouseup",a._disableDelayedDrag),ee(r,"touchend",a._disableDelayedDrag),ee(r,"touchcancel",a._disableDelayedDrag),ee(r,"mousemove",a._delayedDragTouchMoveHandler),ee(r,"touchmove",a._delayedDragTouchMoveHandler),o.supportPointer&&ee(r,"pointermove",a._delayedDragTouchMoveHandler),a._dragStartTimer=setTimeout(s,o.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Te&&wt(Te),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;te(e,"mouseup",this._disableDelayedDrag),te(e,"touchend",this._disableDelayedDrag),te(e,"touchcancel",this._disableDelayedDrag),te(e,"mousemove",this._delayedDragTouchMoveHandler),te(e,"touchmove",this._delayedDragTouchMoveHandler),te(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?ee(document,"pointermove",this._onTouchMove):ee(document,t?"touchmove":"mousemove",this._onTouchMove):(ee(Te,"dragend",this),ee(De,"dragstart",this._onDragStart));try{document.selection?It((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(st=!1,De&&Te){Ve("dragStarted",this,{evt:t}),this.nativeDraggable&&ee(document,"dragover",Ct);var i=this.options;!e&&re(Te,i.dragClass,!1),re(Te,i.ghostClass,!0),Mt.active=this,e&&this._appendGhost(),Be({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Ze){this._lastX=Ze.clientX,this._lastY=Ze.clientY,bt();for(var e=document.elementFromPoint(Ze.clientX,Ze.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Ze.clientX,Ze.clientY))!==t;)t=e;if(Te.parentNode[we]._isOutsideThisEl(e),t)do{if(t[we]){if(t[we]._onDragOver({clientX:Ze.clientX,clientY:Ze.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);vt()}},_onTouchMove:function(e){if(Je){var t=this.options,i=t.fallbackTolerance,s=t.fallbackOffset,a=e.touches?e.touches[0]:e,n=Pe&&ce(Pe,!0),o=Pe&&n&&n.a,r=Pe&&n&&n.d,l=pt&&it&&be(it),c=(a.clientX-Je.clientX+s.x)/(o||1)+(l?l[0]-lt[0]:0)/(o||1),d=(a.clientY-Je.clientY+s.y)/(r||1)+(l?l[1]-lt[1]:0)/(r||1);if(!Mt.active&&!st){if(i&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(Pe){n?(n.e+=c-(Ke||0),n.f+=d-(je||0)):n={a:1,b:0,c:0,d:1,e:c,f:d};var h="matrix(".concat(n.a,",").concat(n.b,",").concat(n.c,",").concat(n.d,",").concat(n.e,",").concat(n.f,")");le(Pe,"webkitTransform",h),le(Pe,"mozTransform",h),le(Pe,"msTransform",h),le(Pe,"transform",h),Ke=c,je=d,Ze=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!Pe){var e=this.options.fallbackOnBody?document.body:De,t=pe(Te,!0,pt,!0,e),i=this.options;if(pt){for(it=e;"static"===le(it,"position")&&"none"===le(it,"transform")&&it!==document;)it=it.parentNode;it!==document.body&&it!==document.documentElement?(it===document&&(it=he()),t.top+=it.scrollTop,t.left+=it.scrollLeft):it=he(),lt=be(it)}re(Pe=Te.cloneNode(!0),i.ghostClass,!1),re(Pe,i.fallbackClass,!0),re(Pe,i.dragClass,!0),le(Pe,"transition",""),le(Pe,"transform",""),le(Pe,"box-sizing","border-box"),le(Pe,"margin",0),le(Pe,"top",t.top),le(Pe,"left",t.left),le(Pe,"width",t.width),le(Pe,"height",t.height),le(Pe,"opacity","0.8"),le(Pe,"position",pt?"absolute":"fixed"),le(Pe,"zIndex","100000"),le(Pe,"pointerEvents","none"),Mt.ghost=Pe,e.appendChild(Pe),le(Pe,"transform-origin",We/parseInt(Pe.style.width)*100+"% "+Ye/parseInt(Pe.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,s=e.dataTransfer,a=i.options;Ve("dragStart",this,{evt:e}),Mt.eventCanceled?this._onDrop():(Ve("setupClone",this),Mt.eventCanceled||((Oe=xe(Te)).removeAttribute("id"),Oe.draggable=!1,Oe.style["will-change"]="",this._hideClone(),re(Oe,this.options.chosenClass,!1),Mt.clone=Oe),i.cloneId=It((function(){Ve("clone",i),Mt.eventCanceled||(i.options.removeCloneOnHide||De.insertBefore(Oe,Te),i._hideClone(),Be({sortable:i,name:"clone"}))})),!t&&re(Te,a.dragClass,!0),t?(at=!0,i._loopId=setInterval(i._emulateDragOver,50)):(te(document,"mouseup",i._onDrop),te(document,"touchend",i._onDrop),te(document,"touchcancel",i._onDrop),s&&(s.effectAllowed="move",a.setData&&a.setData.call(i,s,Te)),ee(document,"drop",i),le(Te,"transform","translateZ(0)")),st=!0,i._dragStartId=It(i._dragStarted.bind(i,t,e)),ee(document,"selectstart",i),Xe=!0,W&&le(document.body,"user-select","none"))},_onDragOver:function(e){var t,i,s,a,n=this.el,o=e.target,r=this.options,l=r.group,c=Mt.active,d=qe===l,h=r.sort,p=$e||c,u=this,m=!1;if(!ct){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),o=ae(o,r.draggable,n,!0),z("dragOver"),Mt.eventCanceled)return m;if(Te.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||u._ignoreWhileAnimating===o)return B(!1);if(at=!1,c&&!r.disabled&&(d?h||(s=Fe!==De):$e===this||(this.lastPutMode=qe.checkPull(this,c,Te,e))&&l.checkPut(this,c,Te,e))){if(a="vertical"===this._getDirection(e,o),t=pe(Te),z("dragOverValid"),Mt.eventCanceled)return m;if(s)return Fe=De,V(),this._hideClone(),z("revert"),Mt.eventCanceled||(Le?De.insertBefore(Te,Le):De.appendChild(Te)),B(!0);var g=Se(n,r.draggable);if(!g||function(e,t,i){var s=pe(Se(i.el,i.options.draggable)),a=ue(i.el),n=10;return t?e.clientX>a.right+n||e.clientY>s.bottom&&e.clientX>s.left:e.clientY>a.bottom+n||e.clientX>s.right&&e.clientY>s.top}(e,a,this)&&!g.animated){if(g===Te)return B(!1);if(g&&n===e.target&&(o=g),o&&(i=pe(o)),!1!==xt(De,n,Te,t,o,i,e,!!o))return V(),g&&g.nextSibling?n.insertBefore(Te,g.nextSibling):n.appendChild(Te),Fe=n,T(),B(!0)}else if(g&&function(e,t,i){var s=pe(ge(i.el,0,i.options,!0)),a=ue(i.el),n=10;return t?e.clientX<a.left-n||e.clientY<s.top&&e.clientX<s.right:e.clientY<a.top-n||e.clientY<s.bottom&&e.clientX<s.left}(e,a,this)){var S=ge(n,0,r,!0);if(S===Te)return B(!1);if(i=pe(o=S),!1!==xt(De,n,Te,t,o,i,e,!1))return V(),n.insertBefore(Te,S),Fe=n,T(),B(!0)}else if(o.parentNode===n){i=pe(o);var f,b,v,y=Te.parentNode!==n,C=!function(e,t,i){var s=i?e.left:e.top,a=i?e.right:e.bottom,n=i?e.width:e.height,o=i?t.left:t.top,r=i?t.right:t.bottom,l=i?t.width:t.height;return s===o||a===r||s+n/2===o+l/2}(Te.animated&&Te.toRect||t,o.animated&&o.toRect||i,a),M=a?"top":"left",x=me(o,"top","top")||me(Te,"top","top"),w=x?x.scrollTop:void 0;if(Qe!==o&&(b=i[M],ot=!1,rt=!C&&r.invertSwap||y),f=function(e,t,i,s,a,n,o,r){var l=s?e.clientY:e.clientX,c=s?i.height:i.width,d=s?i.top:i.left,h=s?i.bottom:i.right,p=!1;if(!o)if(r&&tt<c*a){if(!ot&&(1===et?l>d+c*n/2:l<h-c*n/2)&&(ot=!0),ot)p=!0;else if(1===et?l<d+tt:l>h-tt)return-et}else if(l>d+c*(1-a)/2&&l<h-c*(1-a)/2)return function(e){return fe(Te)<fe(e)?1:-1}(t);if((p=p||o)&&(l<d+c*n/2||l>h-c*n/2))return l>d+c/2?1:-1;return 0}(e,o,i,a,C?1:r.swapThreshold,null==r.invertedSwapThreshold?r.swapThreshold:r.invertedSwapThreshold,rt,Qe===o),0!==f){var k=fe(Te);do{k-=f,v=Fe.children[k]}while(v&&("none"===le(v,"display")||v===Pe))}if(0===f||v===o)return B(!1);Qe=o,et=f;var N=o.nextElementSibling,I=!1,E=xt(De,n,Te,t,o,i,e,I=1===f);if(!1!==E)return 1!==E&&-1!==E||(I=1===E),ct=!0,setTimeout(kt,30),V(),I&&!N?n.appendChild(Te):o.parentNode.insertBefore(Te,I?N:o),x&&Me(x,0,w-x.scrollTop),Fe=Te.parentNode,void 0===b||rt||(tt=Math.abs(b-pe(o)[M])),T(),B(!0)}if(n.contains(Te))return B(!1)}return!1}function z(r,l){Ve(r,u,H({evt:e,isOwner:d,axis:a?"vertical":"horizontal",revert:s,dragRect:t,targetRect:i,canSort:h,fromSortable:p,target:o,completed:B,onMove:function(i,s){return xt(De,n,Te,t,i,pe(i),e,s)},changed:T},l))}function V(){z("dragOverAnimationCapture"),u.captureAnimationState(),u!==p&&p.captureAnimationState()}function B(t){return z("dragOverCompleted",{insertion:t}),t&&(d?c._hideClone():c._showClone(u),u!==p&&(re(Te,$e?$e.options.ghostClass:c.options.ghostClass,!1),re(Te,r.ghostClass,!0)),$e!==u&&u!==Mt.active?$e=u:u===Mt.active&&$e&&($e=null),p===u&&(u._ignoreWhileAnimating=o),u.animateAll((function(){z("dragOverAnimationComplete"),u._ignoreWhileAnimating=null})),u!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(o===Te&&!Te.animated||o===n&&!o.animated)&&(Qe=null),r.dragoverBubble||e.rootEl||o===document||(Te.parentNode[we]._isOutsideThisEl(e.target),!t&&yt(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),m=!0}function T(){He=fe(Te),Ue=fe(Te,r.draggable),Be({sortable:u,name:"change",toEl:n,newIndex:He,newDraggableIndex:Ue,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){te(document,"mousemove",this._onTouchMove),te(document,"touchmove",this._onTouchMove),te(document,"pointermove",this._onTouchMove),te(document,"dragover",yt),te(document,"mousemove",yt),te(document,"touchmove",yt)},_offUpEvents:function(){var e=this.el.ownerDocument;te(e,"mouseup",this._onDrop),te(e,"touchend",this._onDrop),te(e,"pointerup",this._onDrop),te(e,"touchcancel",this._onDrop),te(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;He=fe(Te),Ue=fe(Te,i.draggable),Ve("drop",this,{evt:e}),Fe=Te&&Te.parentNode,He=fe(Te),Ue=fe(Te,i.draggable),Mt.eventCanceled||(st=!1,rt=!1,ot=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Et(this.cloneId),Et(this._dragStartId),this.nativeDraggable&&(te(document,"drop",this),te(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),W&&le(document.body,"user-select",""),le(Te,"transform",""),e&&(Xe&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),Pe&&Pe.parentNode&&Pe.parentNode.removeChild(Pe),(De===Fe||$e&&"clone"!==$e.lastPutMode)&&Oe&&Oe.parentNode&&Oe.parentNode.removeChild(Oe),Te&&(this.nativeDraggable&&te(Te,"dragend",this),wt(Te),Te.style["will-change"]="",Xe&&!st&&re(Te,$e?$e.options.ghostClass:this.options.ghostClass,!1),re(Te,this.options.chosenClass,!1),Be({sortable:this,name:"unchoose",toEl:Fe,newIndex:null,newDraggableIndex:null,originalEvent:e}),De!==Fe?(He>=0&&(Be({rootEl:Fe,name:"add",toEl:Fe,fromEl:De,originalEvent:e}),Be({sortable:this,name:"remove",toEl:Fe,originalEvent:e}),Be({rootEl:Fe,name:"sort",toEl:Fe,fromEl:De,originalEvent:e}),Be({sortable:this,name:"sort",toEl:Fe,originalEvent:e})),$e&&$e.save()):He!==Ae&&He>=0&&(Be({sortable:this,name:"update",toEl:Fe,originalEvent:e}),Be({sortable:this,name:"sort",toEl:Fe,originalEvent:e})),Mt.active&&(null!=He&&-1!==He||(He=Ae,Ue=Ge),Be({sortable:this,name:"end",toEl:Fe,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){Ve("nulling",this),De=Te=Fe=Pe=Le=Oe=Re=_e=Je=Ze=Xe=He=Ue=Ae=Ge=Qe=et=$e=qe=Mt.dragged=Mt.ghost=Mt.clone=Mt.active=null,dt.forEach((function(e){e.checked=!0})),dt.length=Ke=je=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":Te&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],i=this.el.children,s=0,a=i.length,n=this.options;s<a;s++)ae(e=i[s],n.draggable,this.el,!1)&&t.push(e.getAttribute(n.dataIdAttr)||Nt(e));return t},sort:function(e,t){var i={},s=this.el;this.toArray().forEach((function(e,t){var a=s.children[t];ae(a,this.options.draggable,s,!1)&&(i[e]=a)}),this),t&&this.captureAnimationState(),e.forEach((function(e){i[e]&&(s.removeChild(i[e]),s.appendChild(i[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ae(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(void 0===t)return i[e];var s=Ee.modifyOption(this,e,t);i[e]=void 0!==s?s:t,"group"===e&&ft(i)},destroy:function(){Ve("destroy",this);var e=this.el;e[we]=null,te(e,"mousedown",this._onTapStart),te(e,"touchstart",this._onTapStart),te(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(te(e,"dragover",this),te(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),nt.splice(nt.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!_e){if(Ve("hideClone",this),Mt.eventCanceled)return;le(Oe,"display","none"),this.options.removeCloneOnHide&&Oe.parentNode&&Oe.parentNode.removeChild(Oe),_e=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(_e){if(Ve("showClone",this),Mt.eventCanceled)return;Te.parentNode!=De||this.options.group.revertClone?Le?De.insertBefore(Oe,Le):De.appendChild(Oe):De.insertBefore(Oe,Te),this.options.group.revertClone&&this.animate(Te,Oe),le(Oe,"display",""),_e=!1}}else this._hideClone()}},ht&&ee(document,"touchmove",(function(e){(Mt.active||st)&&e.cancelable&&e.preventDefault()})),Mt.utils={on:ee,off:te,css:le,find:de,is:function(e,t){return!!ae(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},throttle:Ce,closest:ae,toggleClass:re,clone:xe,index:fe,nextTick:It,cancelNextTick:Et,detectDirection:St,getChild:ge},Mt.get=function(e){return e[we]},Mt.mount=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Mt.utils=H(H({},Mt.utils),e.utils)),Ee.mount(e)}))},Mt.create=function(e,t){return new Mt(e,t)},Mt.version="1.15.1";var zt,Vt,Bt,Tt,Ft,Pt,Dt=[],Lt=!1;function Rt(){Dt.forEach((function(e){clearInterval(e.pid)})),Dt=[]}function Ot(){clearInterval(Pt)}var _t=Ce((function(e,t,i,s){if(t.scroll){var a,n=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,l=t.scrollSpeed,c=he(),d=!1;Vt!==i&&(Vt=i,Rt(),zt=t.scroll,a=t.scrollFn,!0===zt&&(zt=ve(i,!0)));var h=0,p=zt;do{var u=p,m=pe(u),g=m.top,S=m.bottom,f=m.left,b=m.right,v=m.width,y=m.height,C=void 0,M=void 0,x=u.scrollWidth,w=u.scrollHeight,k=le(u),N=u.scrollLeft,I=u.scrollTop;u===c?(C=v<x&&("auto"===k.overflowX||"scroll"===k.overflowX||"visible"===k.overflowX),M=y<w&&("auto"===k.overflowY||"scroll"===k.overflowY||"visible"===k.overflowY)):(C=v<x&&("auto"===k.overflowX||"scroll"===k.overflowX),M=y<w&&("auto"===k.overflowY||"scroll"===k.overflowY));var E=C&&(Math.abs(b-n)<=r&&N+v<x)-(Math.abs(f-n)<=r&&!!N),z=M&&(Math.abs(S-o)<=r&&I+y<w)-(Math.abs(g-o)<=r&&!!I);if(!Dt[h])for(var V=0;V<=h;V++)Dt[V]||(Dt[V]={});Dt[h].vx==E&&Dt[h].vy==z&&Dt[h].el===u||(Dt[h].el=u,Dt[h].vx=E,Dt[h].vy=z,clearInterval(Dt[h].pid),0==E&&0==z||(d=!0,Dt[h].pid=setInterval(function(){s&&0===this.layer&&Mt.active._onTouchMove(Ft);var t=Dt[this.layer].vy?Dt[this.layer].vy*l:0,i=Dt[this.layer].vx?Dt[this.layer].vx*l:0;"function"==typeof a&&"continue"!==a.call(Mt.dragged.parentNode[we],i,t,e,Ft,Dt[this.layer].el)||Me(Dt[this.layer].el,i,t)}.bind({layer:h}),24))),h++}while(t.bubbleScroll&&p!==c&&(p=ve(p,!1)));Lt=d}}),30),At=function(e){var t=e.originalEvent,i=e.putSortable,s=e.dragEl,a=e.activeSortable,n=e.dispatchSortableEvent,o=e.hideGhostForTarget,r=e.unhideGhostForTarget;if(t){var l=i||a;o();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);r(),l&&!l.el.contains(d)&&(n("spill"),this.onSpill({dragEl:s,putSortable:i}))}};function Ht(){}function Gt(){}Ht.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var s=ge(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(t,s):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:At},q(Ht,{pluginName:"revertOnSpill"}),Gt.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable||this.sortable;i.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),i.animateAll()},drop:At},q(Gt,{pluginName:"removeOnSpill"}),Mt.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?ee(document,"dragover",this._handleAutoScroll):this.options.supportPointer?ee(document,"pointermove",this._handleFallbackAutoScroll):t.touches?ee(document,"touchmove",this._handleFallbackAutoScroll):ee(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?te(document,"dragover",this._handleAutoScroll):(te(document,"pointermove",this._handleFallbackAutoScroll),te(document,"touchmove",this._handleFallbackAutoScroll),te(document,"mousemove",this._handleFallbackAutoScroll)),Ot(),Rt(),clearTimeout(ne),ne=void 0},nulling:function(){Ft=Vt=zt=Lt=Pt=Bt=Tt=null,Dt.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var i=this,s=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,n=document.elementFromPoint(s,a);if(Ft=e,t||this.options.forceAutoScrollFallback||K||Z||W){_t(e,this.options,n,t);var o=ve(n,!0);!Lt||Pt&&s===Bt&&a===Tt||(Pt&&Ot(),Pt=setInterval((function(){var n=ve(document.elementFromPoint(s,a),!0);n!==o&&(o=n,Rt()),_t(e,i.options,n,t)}),10),Bt=s,Tt=a)}else{if(!this.options.bubbleScroll||ve(n,!0)===he())return void Rt();_t(e,this.options,ve(n,!1),!1)}}},q(e,{pluginName:"scroll",initializeByDefault:!0})}),Mt.mount(Gt,Ht);const Ut=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsTypeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsTypeBackClick",7),this.arcgisSmartMappingPanelsTypeClose=(0,s.c)(this,"arcgisSmartMappingPanelsTypeClose",7),this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate=(0,s.c)(this,"arcgisSmartMappingPanelsTypeClusterRequiresUpdate",7),this.arcgisSmartMappingPanelsTypeError=(0,s.c)(this,"arcgisSmartMappingPanelsTypeError",7),this.manager=(0,c.u)(this),this.groupMenuNodes=[],this.groupInputNodes=[],this.groupTextNodes=[],this.valueInputNodes=[],this.valueTextNodes=[],this.symbolNodes=[],this.checkedClasses=[],this.classSortable=[],this.groupSortable=void 0,this.otherSortable=void 0,this.symbolStylerOpen=!1,this.dragRenderToggle=!0,this.smartMappingState=(0,r.u)(),this.hideRotation=!1,this.hideTransparency=!1,this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t,strings:i}=this.smartMappingState,s=e,n=(0,a.g)(this.smartMappingState),o=(0,a.k)(this.smartMappingState),r=(0,a.d)(n,"spike");this.smartMappingState.lastDefault={defaultSymbol:n.defaultSymbol||(0,a.f)(this.smartMappingState),defaultLabel:n.defaultLabel||i.panels.type.other},this.originalRendererJSON=n.toJSON(),this.originalFeatureReduction="featureReduction"in s&&s.featureReduction?t.esriLang.clone(s.featureReduction):void 0,this.originalOrderBy="knowledge-graph-sublayer"!==s.type&&"subtype-sublayer"!==s.type?s.orderBy??void 0:void 0;try{const e=await(0,l.g)(this.smartMappingState,{fieldInfos:[{field:n.field,expression:n.valueExpression,expressionTitle:n.valueExpressionTitle}],typeScheme:(0,a.ac)(this.smartMappingState,l.o)});if(((0,a.e)(this.smartMappingState)||r)&&"type-size"===o){let i=n.uniqueValueInfos?.length?n.uniqueValueInfos[0].symbol:(0,a.f)(this.smartMappingState);const s=(0,a.g)(this.smartMappingState),o=(0,a.d)(s,"reference-size");"simple-marker"===i.type||o||r||(i=new t.SimpleMarkerSymbol),e.uniqueValueInfos.forEach((e=>{const s=t.esriLang.clone(i);(0,a.j)(this.smartMappingState,s,(0,a.h)(this.smartMappingState,e.symbol)),e.symbol=s}))}return this.smartMappingState.allUniqueValues=e.uniqueValueInfos,e}catch(e){throw this.arcgisSmartMappingPanelsTypeError.emit({message:e,type:"error"}),new Error("Could not get unique values")}}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.closePopovers(),this.scaleHandle?.remove()}render(){const{smartMappingState:e}=this,{hideLayerTitle:t,layer:i,mapImageSublayer:n,strings:o}=e,r=t?void 0:n?.title??i.title;return(0,s.h)(s.H,{key:"b0e0ad1629b23b373c91d3721306a350db7326fe",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"c38b2b03b99bb6cc18cfae7194cd49fd30932cc6",class:"flow-item",heading:o.panels.type.styleOptions,closable:(0,a.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,description:r,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsTypeBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderVisualizationContent(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderVisualizationContent(){const{smartMappingState:e}=this,{strings:t}=e,i=!this.hideTransparency||!this.hideRotation,n=(0,a.g)(e),o=(0,a.y)(e,n.field),r=o?.simpleFieldType===a.w.DATE||"date-only"===(0,a.F)(e,o?.layerField);return(0,s.h)("calcite-block",{class:"type-block",heading:r?t.panels.type.typeStyleDate:t.panels.type.typeStyle,collapsible:i,open:!0},this.renderTypesSymbol(),this.renderDrawingOrder(),this.renderGroups(),this.renderBackgroundStyle())}renderTypesSymbol(){const{smartMappingState:e}=this,{mapView:t,modules:i}=e,n=(0,a.g)(e).uniqueValueGroups??[];if(!n?.length||!n[0].classes?.length)return(0,s.h)(s.F,null);const o=[];n.forEach((e=>e.classes.forEach((e=>o.push(e)))));const r=i.typeSchemes.getSchemes({basemap:t.map?.basemap,geometryType:(0,a.I)(e),numColors:o.length}),l=(0,a.ae)(r,Math.min(o.length,10))[0].colors,c=o?.length?o.map(((t,s)=>(0,a.h)(e,t.symbol)||new i.EsriColor(l[s%l.length]))):[];return(0,s.h)("arcgis-smart-mapping-symbol-button",{rampType:"discrete",colors:c,type:"type-ramp",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.el),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderDrawingOrder(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:i,strings:n}=e;if(i||"catalog-footprint"===t.type||"subtype-sublayer"===t.type)return(0,s.h)(s.F,null);const o=(0,a.g)(e);return(0,s.h)("calcite-label",{class:"toggle-div",layout:"inline-space-between"},n.panels.type.drawingOrder,(0,s.h)("calcite-switch",{class:"toggle-button",scale:"s",checked:o.orderByClassesEnabled,onCalciteSwitchChange:e=>{const t=e.target;this.handleDrawingOrderToggle(t.checked)}}))}renderGroups(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e),n=!i.uniqueValueGroups?.length,o=i.field?(0,a.y)(e,i.field)?.label:i.valueExpressionTitle||t.expression,r=n?[this.renderNoGroup()]:i.uniqueValueGroups.map(((e,t)=>this.renderGroup(e,t))),l=this.renderOtherValues();return(0,s.h)("div",{class:"top-padding"},(0,s.h)("calcite-label",null,o),(0,s.h)("div",{key:i.uniqueValueGroups.length,ref:t=>{if(t){(0,a.g)(e).uniqueValueGroups.length&&(this.groupSortable?.destroy(),this.groupSortable=Mt.create(t,{group:{name:"shared",pull:!0,put:!1},dataIdAttr:"group-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortGroups(),handle:".group-handle"}))}}},r),(0,s.h)("div",{class:"other",key:`${l?.length}${this.dragRenderToggle}`},(0,s.h)("div",{class:r.length?"":"values-items-only"},this.renderDefaultValue()),(0,s.h)("div",{ref:e=>{e&&(this.otherSortable?.destroy(),this.otherSortable=Mt.create(e,{group:{name:"shared",pull:!1,put:!0},filter:".nodrag",sort:!1}))}},l,this.renderMsg())))}renderNoGroup(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"group"},(0,s.h)("div",{class:"group-header"},(0,s.h)("div",{class:"value-part1"},(0,s.h)("div",{class:"group-handle-disabled","aria-hidden":"true"},(0,s.h)("calcite-icon",{scale:"s",icon:"drag"})),(0,s.h)("div",{class:"group-text no-group-heading",role:"button",tabIndex:0,"aria-label":e.panels.type.accessibility.editLabelFor.replace("${value}",e.panels.type.groupNameHint)},e.panels.type.groupNameHint)),(0,s.h)("div",{class:"value-part2"},this.renderGroupMenuNode(-2))),(0,s.h)("div",null,"\xa0"))}renderGroup(e,t){const i=e.classes.map(((e,i)=>this.renderValue(e,t,i)));return(0,s.h)("div",{key:e.toJSON(),class:"group","group-sort-values":`${t}`},(0,s.h)("div",{class:"group-header"},(0,s.h)("div",{class:"value-part1"},this.renderGroupHandleNode(t),this.renderGroupTextNode(e,t)),(0,s.h)("div",{class:"value-part2"},this.renderGroupCountNode(e),this.renderGroupMenuNode(t,e))),(0,s.h)("div",{ref:e=>{e&&(this.classSortable?.[t]?.destroy(),this.classSortable[t]=Mt.create(e,{group:{name:"nested",pull:!0,put:["nested"]},dataIdAttr:"class-sort-values",ghostClass:"avatar",onSort:()=>this.handleSortClasses(t),handle:".class-handle"}))}},i))}renderGroupHandleNode(e){const{strings:t}=this.smartMappingState,i=this.selectedValueText===`${e}`;return(0,s.h)("div",{class:i?"group-handle-disabled":"group-handle","aria-hidden":"true",onMouseOver:s=>{const a=s.target;i||this.onMouseOver(`values-${e}-handle-tooltip`,a,t.panels.type.tooltips.dragGroup)},onMouseOut:()=>this.onMouseOut(`values-${e}-handle-tooltip`)},(0,s.h)("calcite-icon",{scale:"s",icon:"drag"}))}renderGroupTextNode(e,t){const{strings:i}=this.smartMappingState;let a=!1;return(0,s.h)(s.F,null,(0,s.h)("calcite-input",{class:"hidden",value:e.heading||"",onKeyDown:e=>{if(("Escape"===e.key||"Enter"===e.key)&&!a){e.preventDefault(),e.stopPropagation(),a=!0;const i=e.target;this.handleGroupTextChange(t,i.value)}},onFocusout:e=>{if(!a){a=!0;const i=e.target;this.handleGroupTextChange(t,i.value)}},ref:e=>{e&&(this.groupInputNodes[t]=e)}}),(0,s.h)("div",{class:"group-text group-text-active "+(e.heading?"group-heading":"no-group-heading"),role:"button",tabIndex:0,"aria-label":i.panels.type.accessibility.editLabelFor.replace("${value}",e.heading||i.panels.type.groupNameHint),onClick:()=>{this.onMouseOut(`group-${t}-text-tooltip`),this.handleGroupTextClick(t)},onMouseOver:e=>{const s=e.target;this.onMouseOver(`group-${t}-text-tooltip`,s,i.panels.type.tooltips.renameGroup)},onMouseOut:()=>this.onMouseOut(`group-${t}-text-tooltip`),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleGroupTextClick(t))},ref:e=>{e&&(this.groupTextNodes[t]=e)}},e.heading||i.panels.type.groupNameHint))}renderValue(e,t,i){return(0,s.h)("div",{key:`values-${e.label}`,class:"value","class-sort-values":`${t}/${i}`},(0,s.h)("div",{class:"value-part1"},this.renderHandleNode(t,i),this.renderCheckNode(t,i),this.renderSymbolNode(e,t,i),this.renderTextNode(e,t,i)),(0,s.h)("div",{class:"value-part2"},this.renderCountNode(e)))}renderHandleNode(e,t){const{strings:i}=this.smartMappingState,a=this.selectedValueText===`${e}/${t}`;return(0,s.h)("div",{class:a?"class-handle-disabled":"class-handle","aria-hidden":"true",onMouseOver:s=>{const a=s.target;this.onMouseOver(`values-${e}-${t}-handle-tooltip`,a,i.panels.type.tooltips.dragType)},onMouseOut:()=>this.onMouseOut(`values-${e}-${t}-handle-tooltip`)},(0,s.h)("calcite-icon",{scale:"s",icon:"drag"}))}renderCheckNode(e,t,i){const{strings:a}=this.smartMappingState,n=this.checkedClasses.find((i=>i.groupIdx===e&&i.classIdx===t));return(0,s.h)("calcite-action",{scale:"s",icon:n?"check-square":"square",text:a.panels.type.checkValue,appearance:"transparent",onClick:i=>{const s=i.currentTarget;this.handleCheck(e,t,s)},onKeyDown:t=>{-1===e&&i&&!t.shiftKey&&"Tab"===t.key&&this.actionsPopoverNode?.focusActionPad()},ref:t=>{-1===e&&i&&(this.lastOtherValueCheckNode=t)}})}renderSymbolNode(e,t,i){const{smartMappingState:n}=this,{strings:o}=n,r={"value-symbol":!0,"symbol-is-white":(0,a.T)(n,e.symbol)},l={symbol:!0,[(0,a.I)(n)]:!0,"symbol-selector--selected":this.selectedValue===`${t}/${i}`};return(0,s.h)("div",{class:r,onClick:()=>this.handleValueSymbolClick(t,i),role:"button","aria-label":o.panels.type.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":this.selectedValue===`${t}/${i}`,onMouseOver:e=>{const s=e.target;this.onMouseOver(`values-${t}-${i}-icon-tooltip`,s,o.panels.type.tooltips.changeSymbol)},onMouseOut:()=>this.onMouseOut(`values-${t}-${i}-icon-tooltip`),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(t,i))}},(0,s.h)("div",{class:l,tabIndex:0,ref:e=>{e&&(this.symbolNodes[t]||(this.symbolNodes[t]=[]),this.symbolNodes[t][i]=e,this.afterCreateValueSymbol(t,i,e))},"aria-hidden":"true"}))}renderTextNode(e,t,i){const{smartMappingState:n}=this,{strings:o}=n;let r=!1;return(0,s.h)(s.F,null,(0,s.h)("calcite-input",{class:"hidden",value:e.label??void 0,onKeyDown:e=>{if(("Escape"===e.key||"Enter"===e.key)&&(e.preventDefault(),e.stopPropagation(),!r)){r=!0;const s=e.target;this.handleValueTextChange(t,i,s.value)}},onFocusout:e=>{if(!r){r=!0;const s=e.target;this.handleValueTextChange(t,i,s.value)}},ref:e=>{e&&(this.valueInputNodes[t]||(this.valueInputNodes[t]=[]),this.valueInputNodes[t][i]=e)}}),(0,s.h)("div",{class:"value-text",role:"button",tabIndex:0,"aria-label":o.panels.type.accessibility.editLabelFor.replace("${value}",e.label),onClick:()=>{this.onMouseOut(`value-${t}-${i}-text-tooltip`),this.handleValueTextClick(t,i)},onMouseOver:e=>{const s=e.target;this.onMouseOver(`value-${t}-${i}-text-tooltip`,s,o.panels.type.tooltips.renameType)},onMouseOut:()=>this.onMouseOut(`value-${t}-${i}-text-tooltip`),onKeyDown:e=>{if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleValueTextClick(t,i);else if(!e.shiftKey&&"Tab"===e.key&&-1===t){const e=(0,a.g)(n),t=(0,l.m)(n);let i=0;e.uniqueValueGroups.forEach((e=>i+=e.classes.length));!!t?.length&&!(1===t.length&&!t[0].value)&&i<l.o||this.actionsPopoverNode.focusActionPad()}},ref:e=>{e&&(-1===t&&-1===i?this.otherTextNode=e:(this.valueTextNodes[t]||(this.valueTextNodes[t]=[]),this.valueTextNodes[t][i]=e))}},e.label?.trim().length?e.label:"\xa0\xa0\xa0\xa0\xa0\xa0"))}renderCountNode(e){const{allUniqueValues:t,strings:i}=this.smartMappingState;if(!t?.length)return(0,s.h)(s.F,null);let n;if(e.values.length>1)n=e.values.reduce(((e,t)=>e+(this.getUniqueValue(t.value)?.count||0)),0);else{const i=e.values[0].value,o=this.getUniqueValue(i);if(o&&!(0,a.S)(o.count))return(0,s.h)(s.F,null);if(!o&&t?.length){const e=this.getUniqueValue(t[0].value);if(!(0,a.S)(e?.count))return(0,s.h)(s.F,null)}n=o?o.count:0}return(0,s.h)("div",{class:"value-count","aria-label":i.panels.type.accessibility.countFor.replace("${value}",e.label)},`${n}`)}renderGroupCountNode(e){const{allUniqueValues:t,strings:i}=this.smartMappingState;if(!t?.length)return(0,s.h)(s.F,null);let n=0;return e.classes.forEach((e=>{e.values.forEach((e=>{const i=this.getUniqueValue(e.value);if(!i||(0,a.S)(i.count)){if(!i&&t?.length){const e=this.getUniqueValue(t[0].value);if(!(0,a.S)(e?.count))return}n+=i?.count??0}}))})),(0,s.h)("div",{class:"group-count","aria-label":i.panels.type.accessibility.countFor.replace("${value}",e.heading)},`${t?n:""}`)}renderGroupMenuNode(e,t){const{smartMappingState:i}=this,{strings:n}=i,o=(0,a.g)(i),r=o.uniqueValueGroups;let c,d,h=!1;if(-1===e){d=(0,l.n)(i);let e=0;o.uniqueValueGroups.forEach((t=>e+=t.classes?.length??0)),e+d.length>l.o&&(d=d.slice(0,l.o-e)),c=!!d.find(((e,t)=>!this.checkedClasses.find((e=>-1===e.groupIdx&&e.classIdx===t))))}else c=!!t?.classes?.find(((t,i)=>!this.checkedClasses.find((t=>t.groupIdx===e&&t.classIdx===i)))),h=!!t?.classes?.find((e=>e.values.length>1));return(0,s.h)("calcite-dropdown",{placement:"bottom-end",scale:"s",overlayPositioning:"absolute",ref:t=>{t&&(this.groupMenuNodes[e]=t)}},(0,s.h)("calcite-action",{slot:"trigger",scale:"s",text:n.panels.type.tooltips.options},(0,s.h)("calcite-icon",{scale:"s",icon:"ellipsis"})),(0,s.h)("calcite-dropdown-group",{"selection-mode":"none"},(0,s.h)("calcite-dropdown-item",{"icon-start":"pin-plus",label:n.panels.type.addValue,onClick:()=>this.handleAddValue(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleAddValue(e)}},n.panels.type.addValue),r.length>0&&(0,s.h)("calcite-dropdown-item",{"icon-start":"palette",label:n.panels.type.changeColors,onClick:()=>this.openSymbolStylerForGroup(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.openSymbolStylerForGroup(e)}},n.panels.type.changeColors)),(0,s.h)("calcite-dropdown-group",{"selection-mode":"none"},c&&(0,s.h)("calcite-dropdown-item",{"icon-start":"check-circle",label:n.panels.type.selectAllValues,onClick:()=>this.handleSelectAllValues(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleSelectAllValues(e)}},n.panels.type.selectAllValues),h&&(0,s.h)("calcite-dropdown-item",{"icon-start":"group-x",label:n.panels.type.separateValues,onClick:()=>this.handleSeparateValues(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleSeparateValues(e)}},n.panels.type.separateValues),e>0&&(0,s.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-up",label:n.panels.type.moveUp,onClick:()=>this.handleGroupMoveUp(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleGroupMoveUp(e)}},n.panels.type.moveUp),r.length>0&&e<r.length-1&&(0,s.h)("calcite-dropdown-item",{"icon-start":"arrow-bold-down",label:n.panels.type.moveDown,onClick:()=>this.handleGroupMoveDown(e),onKeyDown:t=>{t.stopPropagation()," "!==t.key&&"Enter"!==t.key||this.handleGroupMoveDown(e)}},n.panels.type.moveDown)))}renderDefaultValue(){const{smartMappingState:e}=this,{lastDefault:t,strings:i}=e,n=(0,a.g)(e),o=n.defaultSymbol||t.defaultSymbol,r=n.defaultLabel||t.defaultLabel,c=(0,l.m)(e),d=c?this.getOtherCount(c):-1;let h=0;n.uniqueValueGroups.forEach((e=>h+=e.classes.length));const p=!!c?.length&&h<l.o,u=p&&1===c.length&&!c[0].value,m={"value-symbol":!0,"symbol-is-white":(0,a.T)(e,o)},g={symbol:!0,[(0,a.I)(e)]:!0,"symbol-selector--selected":"-1"===this.selectedValue};return(0,s.h)("div",{class:"value "+(p?"default-value":"")},(0,s.h)("div",{class:"value-part1"},(0,s.h)("calcite-switch",{class:"other-value-toggle",scale:"s",checked:!!n.defaultSymbol,onMouseOver:e=>{const t=e.target;this.onMouseOver("default-value-checkbox-tooltip",t,i.panels.type.tooltips.otherTooltip)},onMouseOut:()=>this.onMouseOut("default-value-checkbox-tooltip"),onClick:()=>this.handleDefaultCheckChange(),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleDefaultCheckChange()}}),(0,s.h)("div",{class:m,onClick:()=>this.handleValueSymbolClick(-1,0),role:"button","aria-haspopup":"true","aria-expanded":"-1/0"===this.selectedValue,"aria-label":i.panels.type.accessibility.editSymbolFor.replace("${fieldName}",r),onMouseOver:e=>{const t=e.target;this.onMouseOver("default-value-symbol-tooltip",t,i.panels.type.tooltips.changeSymbol)},onMouseOut:()=>this.onMouseOut("default-value-symbol-tooltip"),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(-1,0))}},(0,s.h)("div",{class:g,tabIndex:0,ref:e=>{e&&(this.symbolNodes[-1]||(this.symbolNodes[-1]=[]),this.symbolNodes[-1][0]=e,this.afterCreateValueSymbol(-1,0,e))},"aria-hidden":"true"})),this.renderTextNode({symbol:o,label:r},-1,-1)),(0,s.h)("div",{class:"value-part2"},d>-1?(0,s.h)("div",{class:`group-count ${(!p||u)&&"group-count-no-menu"}`,"aria-label":i.panels.type.accessibility.countFor.replace("${value}",r)},`${d}`):null,p&&!u&&this.renderDefaultMenuNode()))}renderDefaultMenuNode(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-dropdown",{placement:"bottom-end",scale:"s",overlayPositioning:"absolute",ref:e=>{e&&(this.groupMenuNodes[-1]=e)}},(0,s.h)("calcite-action",{slot:"trigger",scale:"s",text:e.panels.type.tooltips.options},(0,s.h)("calcite-icon",{scale:"s",icon:"ellipsis"})),(0,s.h)("calcite-dropdown-group",{"selection-mode":"none"},(0,s.h)("calcite-dropdown-item",{"icon-start":"check-circle",label:e.panels.type.selectAllValues,onClick:()=>this.handleSelectAllValues(-1),onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||this.handleSelectAllValues(-1)}},e.panels.type.selectAllValues)))}renderOtherValues(){const{smartMappingState:e}=this,{allUniqueValues:t}=e,i=(0,a.g)(e);if(!t?.length)return(0,s.h)(s.F,null);let n=(0,l.n)(e),o=0;i.uniqueValueGroups.forEach((e=>o+=e.classes?.length??0)),o+n.length>l.o&&(n=n.slice(0,l.o-o));return n.map(((e,t)=>this.renderOtherValue(e,t,t===n.length-1)))}renderOtherValue(e,t,i){const{strings:n}=this.smartMappingState;return(0,s.h)("div",{class:"value nodrag",key:e.toJSON()},(0,s.h)("div",{class:"value-part1"},(0,s.h)("div",{class:"value-handle-placeholder"},"\xa0"),(0,a.S)(e.values[0].value)?this.renderCheckNode(-1,t,i):(0,s.h)("div",{class:"check-placeholder"},"\xa0"),(0,s.h)("div",{class:"value-text other-value-text","aria-label":e.label},null===e.values[0].value?n.panels.type.noData:e.label)),(0,s.h)("div",{class:"value-part2"},this.renderCountNode(e)))}renderMsg(){const{smartMappingState:e}=this,{allUniqueValues:t,lastDefault:i,strings:n}=e,o=(0,a.g)(e);return t&&t.length>l.o?(0,s.h)("div",{class:"type-panel-msg"},n.panels.type.errors.tooManyValues.replace("${count}",l.o.toString())):o.uniqueValueInfos.length||t?.length?(0,s.h)(s.F,null):(0,s.h)("div",{class:"type-panel-msg"},n.panels.type.errors.noFeatures.replace("${other}",i.defaultLabel))}renderBackgroundStyle(){const{smartMappingState:e}=this,{mapImageSublayer:t}=e;return"type-size"!==(0,a.k)(e)||t?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-background-symbol",null)}renderTransparency(){if(this.hideTransparency)return(0,s.h)(s.F,null);const{smartMappingState:e}=this,t=(0,a.b)((0,a.g)(e),"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e),onKeyDown:t=>{"type"===(0,a.k)(e)&&t.shiftKey&&"Tab"===t.key&&this.actionsPopoverNode.focusLastAction()},ref:e=>{e&&(this.transparencyNode=e)}})}renderRotation(){if(this.hideRotation)return(0,s.h)(s.F,null);const{smartMappingState:e}=this,t=(0,a.b)((0,a.g)(e),"opacity"),i=(0,a.b)((0,a.g)(e),"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsTypeError.emit(e),ref:e=>this.rotationNode=e})}renderDoneButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:()=>this.arcgisSmartMappingPanelsTypeClose.emit("save"),appearance:"solid",width:"half",onKeyDown:t=>{"type-size"===(0,a.k)(e)&&t.shiftKey&&"Tab"===t.key&&this.actionsPopoverNode.focusLastAction()},ref:e=>this.doneButtonNode=e},t.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{const{layer:t}=e,i=t,{originalRendererJSON:s,originalFeatureReduction:n,originalOrderBy:o}=this;this.closePopovers(),"catalog-footprint"!==i.type&&"knowledge-graph-sublayer"!==i.type&&(i.orderBy=o),(0,a.v)(e,s,n),this.arcgisSmartMappingPanelsTypeClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}addActionsPopover(){const{smartMappingState:e}=this;this.closePopovers(),this.actionsPopoverNode=document.createElement("arcgis-smart-mapping-type-actions-popover"),this.actionsPopoverNode.smartMappingState=e,this.actionsPopoverNode.referenceNode=this.flowItemNode,this.actionsPopoverNode.checkedClasses=this.checkedClasses,this.actionsPopoverNode.groupMenuNodes=this.groupMenuNodes,this.actionsPopoverNode.addEventListener("arcgisSmartMappingTypeActionsPopoverChange",(e=>{e.detail?.checkedClasses&&(this.checkedClasses=e.detail.checkedClasses,e.detail.checkedClasses.length||this.removeActionsPopover()),(0,s.f)(this.el),this.checkCluster()})),this.actionsPopoverNode.addEventListener("arcgisSmartMappingTypeActionsPopoverFocusExit",(t=>{if("bottom"===t.detail){"type"===(0,a.k)(e)?this.transparencyNode?.setFocus():this.doneButtonNode?.setFocus()}else"top"===t.detail&&(this.lastOtherValueCheckNode?this.lastOtherValueCheckNode.setFocus():this.otherTextNode.focus())})),document.body.appendChild(this.actionsPopoverNode)}afterCreateValueSymbol(e,t,i){const{smartMappingState:s}=this,{lastDefault:n,modules:o}=s,r=(0,a.g)(s),l=(0,a.d)(r,"reference-size"),c=(0,a.S)(l);let d;for(d=-1===e?r.defaultSymbol||n.defaultSymbol:r.uniqueValueGroups[e].classes[t].symbol.clone();i?.childNodes?.length;)i.removeChild(i.childNodes[0]);d&&o.symbolUtils.renderPreviewHTML(d,{size:(0,a.U)(d,c),symbolConfig:"cim"===d.type&&"CIMPolygonSymbol"===d.data.symbol.type?{isSquareFill:!0}:void 0}).then((e=>{c&&(e.style.display="block"),i.appendChild(e)}))}checkCluster(){const{layer:e,useFeatureReduction:t}=this.smartMappingState;"featureReduction"in e&&t&&e.featureReduction&&this.arcgisSmartMappingPanelsTypeClusterRequiresUpdate.emit()}closePopovers(){this.removeActionsPopover(),(0,a.J)()}getOtherCount(e){let t=0;return e.map((e=>t+=e.count)),e.length?t:-1}getUniqueValue(e){const{allUniqueValues:t}=this.smartMappingState;if(!t)return null;const i=t.filter((t=>"<Null>"===e&&null===t.value||t.value==e));return i.length?i[0]:null}handleAddValue(e){const t=document.createElement("arcgis-smart-mapping-type-add-value");t.smartMappingState=this.smartMappingState,t.groupIdx=e,t.flowItemNode=this.flowItemNode,t.referenceNode=this.groupMenuNodes[e],t.addEventListener("arcgisSmartMappingTypeAddValuePopoverClose",(()=>{setTimeout((()=>{this.groupMenuNodes[e].setFocus()}),300),t?.parentElement?.removeChild(t)})),t.addEventListener("arcgisSmartMappingTypeAddValuePopoverNewValue",(()=>{this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{this.groupMenuNodes[e].setFocus()}),300),t?.parentElement?.removeChild(t)})),document.body.appendChild(t)}handleCheck(e,t,i){const a=this.checkedClasses.findIndex((i=>i.groupIdx===e&&i.classIdx===t));a>-1?(this.checkedClasses.splice(a,1),i.icon="square",this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,s.f)(this.actionsPopoverNode),this.checkedClasses.length||this.removeActionsPopover()):(this.checkedClasses=[...this.checkedClasses,{groupIdx:e,classIdx:t}],i.icon="check-square",this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,s.f)(this.actionsPopoverNode)):this.addActionsPopover())}handleDefaultCheckChange(){const{smartMappingState:e}=this,t=(0,a.g)(e);if(t.defaultSymbol)t.defaultSymbol=void 0,t.defaultLabel=void 0;else{const{lastDefault:e}=this.smartMappingState;t.defaultSymbol=e.defaultSymbol,t.defaultLabel=e.defaultLabel}this.updateRendererAndUI()}handleDrawingOrderToggle(e){const{smartMappingState:t}=this,{layer:i}=t,s=i,n=(0,a.g)(t);(0,a.J)(),n.orderByClassesEnabled=e,s.orderBy=e?void 0:this.originalOrderBy,this.updateRendererAndUI()}handleGroupMoveUp(e){this.closePopovers();const{smartMappingState:t}=this,i=(0,a.g)(t);if(e>0){const t=i.uniqueValueGroups,s=t.splice(e,1)[0];t.splice(e-1,0,s),i.uniqueValueGroups=t,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{this.groupMenuNodes[e-1]?.setFocus()}),300)}}handleGroupMoveDown(e){this.closePopovers();const{smartMappingState:t}=this,i=(0,a.g)(t),s=i.uniqueValueGroups;if(e<s.length-1){const t=i.uniqueValueGroups,s=t.splice(e,1)[0];t.splice(e+1,0,s),i.uniqueValueGroups=t,this.checkedClasses=[],this.updateRendererAndUI(),this.checkCluster(),setTimeout((()=>{this.groupMenuNodes[e+1]?.setFocus()}),300)}}handleGroupTextChange(e,t){const{smartMappingState:i}=this,s=(0,a.g)(i),n=s.uniqueValueGroups;this.groupInputNodes[e].classList.add("hidden"),n[e].heading=t,s.uniqueValueGroups=n,this.selectedValueText=void 0,this.updateRendererAndUI(),this.groupTextNodes[e].classList.remove("hidden"),setTimeout((()=>this.groupTextNodes[e].focus()),300)}handleGroupTextClick(e){this.selectedValueText=`${e}`,this.groupTextNodes[e].classList.add("hidden"),this.groupInputNodes[e].classList.remove("hidden"),this.groupInputNodes[e].setFocus()}handleSelectAllValues(e){(0,a.J)();const{smartMappingState:t}=this,i=(0,a.g)(t);let n=0;i.uniqueValueGroups.forEach((e=>n+=e.classes?.length??0));const o=e>-1?i.uniqueValueGroups[e].classes:(0,l.n)(t);-1===e&&n+o.length>l.o&&(o.length=l.o-n),o.forEach(((t,i)=>{this.checkedClasses.find((t=>t.groupIdx===e&&t.classIdx===i))||this.checkedClasses.push({groupIdx:e,classIdx:i})})),(0,s.f)(this.el),this.actionsPopoverNode?(this.actionsPopoverNode.checkedClasses=this.checkedClasses,(0,s.f)(this.actionsPopoverNode)):this.addActionsPopover()}handleSeparateValues(e){this.closePopovers(),this.separateGroupValues(e),this.updateRendererAndUI(),this.checkCluster()}handleSortClasses(e){const t=this.classSortable?.[e].toArray()||[],{smartMappingState:i}=this,{modules:s}=i,n=(0,a.g)(i);this.closePopovers();const o=(0,l.n)(i).length;let r=0;n.uniqueValueGroups.forEach((e=>r+=e.classes?.length??0));const c=n.clone().uniqueValueGroups,d=[];c.forEach(((i,a)=>{if(a===e){const e=new s.UniqueValueGroup({heading:i.heading,classes:[]});t.forEach((t=>{const[i,s]=t.split("/").map((e=>Number.parseInt(e)));e.classes.push(c[i].classes[s])})),d.push(e)}else d.push(c[a])})),n.uniqueValueGroups=d.filter((e=>!!e.classes.length));const h=(0,l.n)(i).length;this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],o===h&&(this.dragRenderToggle=!this.dragRenderToggle),setTimeout((()=>this.updateRendererAndUI()),300),this.checkCluster();let p=0;n.uniqueValueGroups.forEach((e=>p+=e.classes?.length??0)),r!==p&&this.checkCluster()}handleSortGroups(){const{smartMappingState:e}=this,t=this.groupSortable?this.groupSortable.toArray():[],i=(0,a.g)(e);this.closePopovers();const s=i.uniqueValueGroups,n=[];t.forEach((e=>{n.push(s[Number.parseInt(e)])})),i.uniqueValueGroups=n,this.selectedValue=void 0,this.selectedValueText=void 0,this.checkedClasses=[],this.updateRendererAndUI()}handleValueSymbolClick(e,t){if(this.symbolNodes[e][t].classList.remove("symbol-selector--selected"),this.symbolStylerOpen)this.selectedValue=void 0,this.selectedValueText=void 0,(0,a.J)(),this.symbolStylerOpen=!1;else{const i=`${e}/${t}`;this.selectedValue=this.selectedValue!==i?i:void 0,this.selectedValueText=void 0,(0,a.S)(this.selectedValue)?this.openSymbolStylerForValue(e,t):(this.symbolNodes[e][t].classList.remove("symbol-selector--selected"),(0,a.J)(),this.symbolStylerOpen=!1)}}handleValueTextChange(e,t,i){const{smartMappingState:s}=this,{allUniqueValues:n,lastDefault:o,modules:r,strings:c}=s,d=(0,a.g)(s),h=d.uniqueValueGroups;if(this.valueInputNodes[e][t].classList.add("hidden"),h?.[e]?.classes?.[t].label!==i){if(!i?.length)if(-1===e)i=this.originalRendererJSON.defaultLabel||c.panels.type.other;else{const s=n.find((i=>i.value===d.uniqueValueGroups?.[e].classes?.[t].values?.[0].value));i=s?.label||d.uniqueValueGroups?.[e].classes?.[t].label}if(-1!==e||d.defaultSymbol||(o.defaultLabel=i),-1===e)d.defaultSymbol&&(d.defaultLabel=i||o.defaultLabel);else{const o=d.uniqueValueGroups,c=(0,a.y)(s,d.field);if(i)o[e].classes[t].label=i;else{const i=o[e].classes[t].values.map((e=>{const t=e.value,i=n?.find((e=>e.value===t))?.label;return i||(c?.simpleFieldType===a.w.DATE||"date-only"===(0,a.F)(s,c?.layerField)?(0,l.p)(s,t,c):c?.simpleFieldType===a.w.NUMBER?r.intl.formatNumber(t):t)}));o[e].classes[t].label=i.join(", ")}d.uniqueValueGroups=o}}this.selectedValueText=void 0,this.updateRendererAndUI(),setTimeout((()=>{const i=-1===e&&-1===t?this.otherTextNode:this.valueTextNodes[e][t];i.classList.remove("hidden"),setTimeout((()=>i.focus()),300)}))}handleValueTextClick(e,t){this.selectedValueText=`${e}/${t}`;(-1===e&&-1===t?this.otherTextNode:this.valueTextNodes[e][t]).classList.add("hidden"),this.valueInputNodes[e][t]?.classList.remove("hidden"),this.valueInputNodes[e][t]?.setFocus()}onMouseOver(e,t,i){(0,a.a9)(),(0,a.aO)(t,i,e)}onMouseOut(e){(0,a.aP)(e)}openSymbolStylerForGroup(e){const{smartMappingState:t}=this,{strings:i}=t;(0,a.J)();const s=(0,h.b)(t,{referenceElement:this.flowItemNode,heading:i.panels.type.symbolStyle});s.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,h.r)(s),this.selectedValue=void 0,this.selectedValueText=void 0,setTimeout((()=>{this.groupMenuNodes[e]?.setFocus()}),300)})),s.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{this.selectedValue=void 0,this.selectedValueText=void 0,(0,h.r)(s),setTimeout((()=>{this.groupMenuNodes[e]?.setFocus()}),300)})),(0,h.g)(t,{groupIdx:e,popoverNode:s,onChange:()=>{this.updateRendererAndUI()}})}openSymbolStylerForValue(e,t){const{smartMappingState:i}=this,{strings:n}=i;(0,a.J)();const o=(0,h.b)(i,{referenceElement:this.flowItemNode,heading:n.panels.type.symbolStyle});o.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{const i=this.symbolNodes[e][t];this.selectedValue=void 0,this.selectedValueText=void 0,(0,h.r)(o),setTimeout((()=>{i.classList.remove("symbol-selector--selected"),this.symbolStylerOpen=!1,i.focus()}),300)})),o.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{const i=this.symbolNodes[e][t];this.selectedValue=void 0,this.selectedValueText=void 0,(0,h.r)(o),setTimeout((()=>{i.classList.remove("symbol-selector--selected"),this.symbolStylerOpen=!1,i.focus()}),300)})),(0,h.h)(i,{selectedValue:this.selectedValue,popoverNode:o,onChange:()=>{this.updateRendererAndUI(),this.rotationNode&&(0,s.f)(this.rotationNode)}}),this.symbolStylerOpen=!0,this.symbolNodes[e][t].classList.add("symbol-selector--selected")}removeActionsPopover(){this.actionsPopoverNode?.parentElement?.removeChild(this.actionsPopoverNode),this.actionsPopoverNode=void 0}separateGroupValues(e){const{smartMappingState:t}=this,i=(0,a.g)(t).uniqueValueGroups;(0,l.q)(t,i[e]),this.checkedClasses=[]}updateRendererAndUI(){const{smartMappingState:e}=this;(0,a.t)(e),(0,s.f)(this.el)}get el(){return(0,s.a)(this)}};Ut.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.hidden {\n  display: none;\n}\n\n.type-block {\n  overflow: hidden;\n}\n\n.check-placeholder {\n  width: 32px;\n  height: 24px;\n}\n\n.type-panel-msg {\n  font-size: 80%;\n  margin: 5px;\n}\n\n.toggle-button {\n  margin-top: 2px;\n}\n\n.toggle-div {\n  padding-top: 6px;\n}\n\n.top-padding {\n  padding-top: 10px;\n}\n\n.symbol-selector {\n  background-color: rgb(255, 255, 255);\n  display: flex;\n  padding: 9px 9px;\n  justify-content: space-between;\n  align-items: center;\n  border-radius: 3px;\n  cursor: pointer;\n  transition: box-shadow 250ms ease-in-out;\n  box-shadow: 0 0 0 1px #e0e0e0;\n}\n\n.symbol-selector :last-child {\n  margin-bottom: 0;\n  svg {\n    fill: #c0c0c0;\n  }\n}\n\n.symbol-selector :hover {\n  box-shadow: 0 0 0 1px #c0c0c0;\n  svg {\n    fill: #404040;\n  }\n}\n\n.symbol-selector--selected,\n.symbol-selector--selected:hover {\n  outline: 1px solid var(--calcite-color-brand);\n  svg {\n    fill: #404040;\n  }\n}\n\n.symbol-is-white {\n  background-color: #f3f3f3;\n}\n\n.symbol-icon {\n  min-width: 26px;\n  display: flex;\n}\n\n.symbol-icon div {\n  margin: auto;\n}\n\n.symbol-icon.transparent {\n  height: 15px;\n  width: 100%;\n}\n\n.symbol-icon.transparent svg {\n  height: 15px;\n  width: 95%;\n  stroke: #e0e0e0;\n  stroke-width: 1px;\n}\n\n.group-header {\n  display: flex;\n  padding: 6px 0;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.group-heading {\n  font-weight: bold;\n}\n\n.no-group-heading {\n  color: rgba(50, 50, 50, 0.4);\n  font-style: italic;\n}\n\n.group {\n  border: 1px solid #e0e0e0;\n  margin: 5px 0;\n}\n\n.group-text {\n  padding: 3px 9px 0 9px;\n  word-break: break-all;\n}\n\n.group-text-active {\n  cursor: pointer;\n}\n\n.group-count {\n  padding-top: 7px;\n}\n\n.group-count-no-menu {\n  padding-right: 3px;\n}\n\n.values-items-only {\n  padding: 6px 6px;\n}\n\n.value {\n  display: flex;\n  padding: 6px 0;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.value-part1 {\n  display: flex;\n  width: -webkit-fill-available;\n  width: -moz-available;\n  align-items: center;\n  margin: 0 5px;\n}\n\n.value-part2 {\n  display: flex;\n}\n\n.group-handle,\n.class-handle {\n  color: rgba(50, 50, 50, 0.4);\n  cursor: grab;\n  width: 16px;\n  display: flex;\n}\n\n.group-handle-disabled,\n.class-handle-disabled {\n  color: #e0e0e0;\n  width: 16px;\n  display: flex;\n}\n\n.value-symbol {\n  margin: 0 5px;\n  padding: 4px;\n  cursor: pointer;\n}\n\n.value-text {\n  padding: 0 9px;\n  word-break: break-all;\n  cursor: pointer;\n}\n\n.value-count {\n  padding: 3px 3px 0 3px;\n}\n\n.menu-placeholder {\n  width: 32px;\n}\n\n.value-handle-placeholder {\n  min-width: 16px;\n}\n\n.other {\n  border: 1px solid #e0e0e0;\n}\n\n.default-value {\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.other-value-text {\n  cursor: default;\n}\n\n.other-value-toggle {\n  margin-left: 22px;\n  margin-right: 2px;\n}\n\n.symbol-styler-panel {\n  width: 328px;\n  min-height: 300px;\n}\n\n.symbol-styler-div {\n  width: 100%;\n}\n\n.avatar {\n  background-color: #f0efef;\n}\n\n.value-text:focus,\n.group-text:focus,\n.symbol:focus {\n  outline: 2px solid var(--calcite-color-brand);\n}\n";const qt=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsTypeSizeBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsTypeSizeBackClick",7),this.arcgisSmartMappingPanelsTypeSizeClose=(0,s.c)(this,"arcgisSmartMappingPanelsTypeSizeClose",7),this.arcgisSmartMappingPanelsTypeSizeError=(0,s.c)(this,"arcgisSmartMappingPanelsTypeSizeError",7),this.manager=(0,c.u)(this),this.tileNodes={},this.smartMappingState=(0,r.u)(),this.handleDone=()=>{(0,a.J)(),this.arcgisSmartMappingPanelsTypeSizeClose.emit("save")},this.handleOptionsClick=e=>{const{panelsParentNode:t}=this;switch(e){case"size":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.hideRotation=!0,e.hideTransparency=!0,e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.hideRotation=!0,e.hideTransparency=!0,e.addEventListener("arcgisSmartMappingPanelsTypeClose",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>this.cleanUpFlowItem(t,e))),e.addEventListener("arcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e))),t.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.lastClick=void 0}async setFocus(){this.flowItemNode?.setFocus()}componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,i=(0,a.g)(this.smartMappingState);this.originalRendererJSON=i.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,a.B)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.scaleHandle=(0,l.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{hideLayerTitle:e,layer:t,mapImageSublayer:i,strings:n}=this.smartMappingState,o=e?void 0:i?.title??t.title;return(0,s.h)(s.H,{key:"1ef1ac98c079822c10c6be28b745707fb7cd8213",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"1a5ea1ffd657ff4ad4fb19a43fbee580041ab2e3",class:"flow-item",closable:(0,a.K)(this.el),heading:n.panels.styleOptions,description:o,showBackButton:this.showBackButton,selected:this.selected,ref:e=>this.flowItemNode=e,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsTypeSizeBackClick.emit()},onCalciteFlowItemClose:this.handleDone},this.renderTypeTile(),this.renderSizeTile(),this.renderTransparency(),this.renderRotation(),this.renderDoneButton(),this.renderCancelButton()))}renderTypeTile(){return(0,s.h)("arcgis-smart-mapping-tile",{type:"type",selected:"type"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="type",this.handleOptionsClick("type")},onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("type"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes.type=e)}})}renderSizeTile(){const{smartMappingState:e}=this,t="type-size-age"===(0,a.k)(e)?"size-age":"size",i=(0,a.z)(e,"size");return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${t}-${i}`,type:t,selected:"size"===this.lastClick,onArcgisSmartMappingTileSelect:()=>{this.lastClick="size",this.handleOptionsClick("size")},onArcgisSmartMappingTileThemeChange:()=>(0,s.f)(this.el),onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick("size"),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e.detail),ref:e=>{e&&(this.tileNodes.size=e)}})}renderTransparency(){const{smartMappingState:e}=this,t=(0,a.b)((0,a.g)(e),"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!t,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e)})}renderRotation(){const{smartMappingState:e}=this,t=(0,a.b)((0,a.g)(e),"opacity"),i=(0,a.b)((0,a.g)(e),"rotation");return(0,a.d)((0,a.g)(e),"spike")?(0,s.h)(s.F,null):(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!i,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsTypeSizeError.emit(e)})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{smartMappingState:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:()=>{(0,a.v)(e,this.originalRendererJSON,this.originalFeatureReduction),this.arcgisSmartMappingPanelsTypeSizeClose.emit("cancel")},appearance:"outline-fill",width:"half"},t.cancel)}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[this.lastClick]?.setFocus())))),300)}get el(){return(0,s.a)(this)}};qt.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}";const $t=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingRelationshipColorSliderChange=(0,s.c)(this,"arcgisSmartMappingRelationshipColorSliderChange",7),this.arcgisSmartMappingRelationshipColorSliderError=(0,s.c)(this,"arcgisSmartMappingRelationshipColorSliderError",7),this.manager=(0,c.u)(this),this.currentBreakValues=[],this.smartMappingState=(0,r.u)(),this.fieldPos=void 0,this.histogramStatus=a.s.MISSING,this.statisticsStatus=a.s.MISSING}async updateStatistics(){this.statisticsStatus=a.s.MISSING,this.statistics=void 0,this.histogramStatus=a.s.MISSING,this.histogram=void 0,this.colorSlider?.destroy(),this.colorSlider=void 0,this.getStatistics()}componentWillLoad(){this.flowItemNode=(0,g.f)(this.el,"calcite-flow-item"),this.getStatistics()}componentDidLoad(){(0,u.i)(this.el.shadowRoot,this.smartMappingState.modules.esriConfig)}render(){const{statisticsStatus:e,smartMappingState:t}=this,{strings:i}=t,n=(0,a.g)(t).authoringInfo;if(e===a.s.FAILED||e===a.s.MISSING)return this.colorSlider?.destroy(),this.colorSlider=void 0,(0,s.h)(s.F,null);if(this.statisticsStatus===a.s.IN_PROGRESS||this.histogramStatus===a.s.IN_PROGRESS&&!this.colorSlider)return this.renderColorSliderLoading();{const e=this.prepareColorSlider(),t=0===this.fieldPos?n.field1.classBreakInfos:n.field2.classBreakInfos;return this.currentBreakValues=t.map((e=>({min:e.minValue,max:e.maxValue}))),(e||this.colorSlider)&&this.colorSlider.min!==this.colorSlider.max?(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-label",null,i.panels.relationship.dataRange),(0,s.h)("div",{ref:e=>{e&&this.afterColorSliderCreate(e)}})):this.colorSlider&&this.colorSlider.min===this.colorSlider.max?(0,s.h)(s.F,null):this.renderColorSliderLoading()}}renderColorSliderLoading(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}afterColorSliderCreate(e){if(this.colorSlider.container)e.append(this.colorSlider.container);else{const t=document.createElement("div");t.classList.add("slider-container"),e.append(t),this.colorSlider.container=t}}createColorSliderChangeEvents(){this.colorSlider&&(this.colorSlider.on("min-change",(e=>{e.value>this.currentBreakValues[0].max?this.onMinMaxChange(this.currentBreakValues[0].max,this.colorSlider.slider.max):this.onMinMaxChange(e.value,this.colorSlider.slider.max)})),this.colorSlider.on("max-change",(e=>{e.value<this.currentBreakValues[this.currentBreakValues.length-1].min?this.onMinMaxChange(this.colorSlider.slider.min,this.currentBreakValues[this.currentBreakValues.length-1].min):this.onMinMaxChange(this.colorSlider.slider.min,e.value)})),this.colorSlider.on("thumb-change",(()=>{this.updateRendererBreaks(this.colorSlider.breaks)})),this.colorSlider.on("thumb-drag",(()=>{this.updateRendererBreaks(this.colorSlider.breaks)})))}getClassBreaksColors(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,a.g)(e),s=i.authoringInfo,n=(0===this.fieldPos?s.field1.classBreakInfos:s.field2.classBreakInfos).map((e=>({min:e.minValue,max:e.maxValue,color:new t.EsriColor([0,0,0])})));let o=new t.EsriColor([0,0,0,1]),r=new t.EsriColor([0,0,0,1]);i.uniqueValueGroups[0].classes.forEach((t=>{"HH"===t.values[0].value?o=(0,a.h)(e,t.symbol):"LL"===t.values[0].value&&(r=(0,a.h)(e,t.symbol))}));let l=(o.r+o.g+o.b)/3;const c=(r.r+r.g+r.b)/3;if(2===n.length)n[1].color=new t.EsriColor([l,l,l,1]),n[0].color=new t.EsriColor([c,c,c,1]);else if(3===n.length)n[2].color=new t.EsriColor([l,l,l,1]),l=(l+c)/2,n[1].color=new t.EsriColor([l,l,l,1]),n[0].color=new t.EsriColor([c,c,c,1]);else{n[3].color=new t.EsriColor([l,l,l,1]);let e=l+(c-l)/3;n[2].color=new t.EsriColor([e,e,e,1]),e=l+2*(c-l)/3,n[1].color=new t.EsriColor([e,e,e,1]),n[0].color=new t.EsriColor([c,c,c,1])}return n}getHistogram(e,t,i,s,n){const{layer:o,useFeatureReduction:r,mapView:l,modules:c}=this.smartMappingState,d=o;(i=i||this.statistics)&&0!==i.count&&(this.histogramStatus=a.s.IN_PROGRESS,c.histogram({layer:d,view:l,field:e.field??void 0,numBins:50,minValue:s??i.min,maxValue:n??i.max,normalizationField:t,forBinning:"featureReduction"in d&&"binning"===d.featureReduction?.type&&r}).then((e=>{this.histogram=e,this.histogramStatus=a.s.SUCCESS}),(e=>{console.log("error-histogram",e),this.histogramStatus=a.s.FAILED})))}getStatistics(){const{smartMappingState:e}=this,{layer:t,useFeatureReduction:i,mapView:s,modules:n}=e,o=t,r=(0,a.g)(e).authoringInfo,l=0===this.fieldPos?r.field1:r.field2,c=l.classBreakInfos;if(!c||this.statistics)return;const d={field:l.field,simpleFieldType:a.w.NUMBER},h=l.normalizationField;let p=c[0].minValue,u=c[c.length-1].maxValue;this.statisticsStatus=a.s.IN_PROGRESS,n.summaryStatistics({layer:o,view:s,field:l.field,normalizationField:h,forBinning:"featureReduction"in o&&"binning"===o.featureReduction?.type&&i,outStatisticTypes:{exclude:["median"]}}).then((e=>{if(0===e.count)e.min=0,e.max=100,e.avg=(u+p)/2;else if(!(0,a.S)(e.avg)||!(0,a.S)(e.min)||!(0,a.S)(e.max))return void(this.statisticsStatus=a.s.FAILED);e=(0,a.aH)(e),({min:p,max:u}=(0,a.aH)({min:p,max:u})),p=p??e.min??void 0,u=u??e.max??void 0,this.statistics=e,this.statisticsStatus=a.s.SUCCESS,this.getHistogram(d,h,e,p,u)}),(e=>{console.log("error-summaryStatistics",e),this.statisticsStatus=a.s.FAILED}))}onMinMaxChange(e,t){const{statistics:i,smartMappingState:s}=this,n=(0,a.g)(s),o=n.authoringInfo,r=0===this.fieldPos?o.field1:o.field2,c=r.normalizationField,h={field:r.field,simpleFieldType:a.w.NUMBER},p=0===this.fieldPos?o.field1.classBreakInfos:o.field2.classBreakInfos;p[0].minValue=e,p[p.length-1].maxValue=t,(0,d.r)((0,l.u)(s),this.flowItemNode).then((n=>{(0,a.t)(s,n),this.getHistogram(h,c,i,e,t),C(s,this.colorSlider,this.colorSliderBars,this.getClassBreaksColors(),this.histogram)})),n.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingRelationshipColorSliderChange.emit()}prepareColorSlider(){const{statistics:e,histogram:t,histogramStatus:i,smartMappingState:s}=this,{modules:n}=s,r=(0,a.g)(s).authoringInfo,l=0===this.fieldPos?r.field1.classBreakInfos:r.field2.classBreakInfos;if(!l||i===a.s.IN_PROGRESS)return!1;let c=l[0].minValue,d=l[l.length-1].maxValue;if(({min:c,max:d}=(0,a.aH)({min:c,max:d})),this.colorSlider){const i=this.colorSlider;if("dragging"===i.slider?.state)return!0;const a=this.getClassBreaksColors(),n=(0,o.g)(a),r={histogramConfig:{bins:t?.bins,average:Math.round(10*e.avg)/10,standardDeviation:e.stddev,standardDeviationCount:1,barCreatedFunction:t&&this.colorSliderBars&&y.bind(this,s,a,t,this.colorSliderBars)},min:c??e.min,max:d??e.max,breaks:a,precision:n};C(s,i,this.colorSliderBars,a,t),this.colorSlider.set(r)}else{const e=this.getClassBreaksColors(),t=(0,o.g)(e),i={histogramConfig:{bins:this.histogram?.bins,average:Math.round(10*this.statistics.avg)/10,standardDeviation:this.statistics.stddev,standardDeviationCount:1,barCreatedFunction:this.histogram&&y.bind(this,s,e,this.histogram,this.colorSliderBars)},min:c??this.statistics.min,max:d??this.statistics.max,breaks:e,precision:t};this.colorSliderBars=[],C(s,this.colorSlider,this.colorSliderBars,e,this.histogram),this.colorSlider=new n.ClassedColorSlider(i),this.colorSlider&&this.colorSlider.min===this.colorSlider.max&&this.colorSlider.set(i),this.createColorSliderChangeEvents()}return(0,a.S)(this.colorSlider)}updateRendererBreaks(e){const{smartMappingState:t}=this,i=(0,a.g)(t).authoringInfo,s=0===this.fieldPos?i.field1:i.field2;i.classificationMethod="manual",s.classBreakInfos&&(s.classBreakInfos.forEach(((t,i)=>{t.minValue===e[i].min&&t.maxValue===e[i].max||(t.minValue=e[i].min,t.maxValue=e[i].max,this.currentBreakValues[i].min=e[i].min,this.currentBreakValues[i].max=e[i].max)})),(0,d.r)((0,l.u)(t),this.flowItemNode).then((e=>{(0,a.t)(t,e),C(t,this.colorSlider,this.colorSliderBars,this.getClassBreaksColors(),this.histogram)})),this.arcgisSmartMappingRelationshipColorSliderChange.emit())}get el(){return(0,s.a)(this)}};$t.style=".slider-box{height:310px;margin-top:6px}.esri-classed-color-slider{min-width:200px}.esri-classed-color-slider__histogram-container{width:70px}.esri-classed-color-slider .esri-slider .esri-slider__content{height:200px}.esri-classed-color-slider .esri-slider .esri-slider__label,.esri-classed-color-slider .esri-slider .esri-slider__min,.esri-classed-color-slider .esri-slider .esri-slider__max{text-decoration:underline}.esri-classed-color-slider .esri-slider .esri-slider__label:hover,.esri-classed-color-slider .esri-slider .esri-slider__min:hover,.esri-classed-color-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.slider-container{overflow:hidden}";const Jt=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingRelationshipFocusButtonChange=(0,s.c)(this,"arcgisSmartMappingRelationshipFocusButtonChange",7),this.arcgisSmartMappingRelationshipFocusButtonBeforeOpen=(0,s.c)(this,"arcgisSmartMappingRelationshipFocusButtonBeforeOpen",7),this.arcgisSmartMappingRelationshipFocusButtonError=(0,s.c)(this,"arcgisSmartMappingRelationshipFocusButtonError",7),this.manager=(0,c.u)(this),this.open=!1,this.smartMappingState=(0,r.u)(),this.flowItemNode=void 0,this.selectedFocusInfo=void 0}async setFocus(){this.buttonNode?.focus()}componentWillLoad(){const{strings:e}=this.smartMappingState,t=(0,a.g)(this.smartMappingState);this.focusInfos=[{focus:"HH",title:e.relationshipFocusButton.focusHighHigh,msg:e.relationshipFocusButton.focusHighHighMsg,selected:!1,iconPath:null},{focus:"HL",title:e.relationshipFocusButton.focusHighLow,msg:e.relationshipFocusButton.focusHighLowMsg,selected:!1,iconPath:null},{focus:"LH",title:e.relationshipFocusButton.focusLowHigh,msg:e.relationshipFocusButton.focusLowHighMsg,selected:!1,iconPath:null},{focus:"LL",title:e.relationshipFocusButton.focusLowLow,msg:e.relationshipFocusButton.focusLowLowMsg,selected:!1,iconPath:null},{focus:"none",title:e.relationshipFocusButton.none,msg:e.relationshipFocusButton.focusNoneMsg,selected:!this.selectedFocusInfo,iconPath:null}],this.setSelectedFocus(t.authoringInfo.focus||"none")}render(){const{strings:e}=this.smartMappingState;return(0,s.h)(s.H,{key:"78409046309d22058b7c3d04585460bffe41e302"},(0,s.h)("calcite-label",{key:"8cd46426b619c9295932e2b5c5692107a09d5c3a",class:"focus-margin"},e.relationshipFocusButton.focus,(0,s.h)("div",{key:"c6581c51447dd4024440c364d41b02a624404285",class:"focus-button",role:"button",tabindex:"0","aria-haspopup":"true","aria-label":e.relationshipFocusButton.focus,ref:e=>{e&&(this.buttonNode=e)},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.openFocusDropdown())},onClick:()=>this.openFocusDropdown()},(0,s.h)("div",{key:"4c3679afa54639ca43e2c5abe6e64e79c8605bf6",class:"focus-content"},(0,s.h)("div",{key:"9dfd34652b14133ca89526c715cdcbd88e005ab5",class:"focus-button-text"},(0,s.h)("div",{key:"47defad53014aa52e5539c1fdf90e78232e3e6da",class:"focus-button-title"},this.selectedFocusInfo.title),(0,s.h)("div",{key:"17aa50c1303fdebc1e64c07eedb3977c1b867427",class:"focus-button-msg"},this.selectedFocusInfo.msg)),(0,s.h)("div",{key:"89920dc7ac9a9b998cde51f3148b531876f8b64f"},(0,s.h)("calcite-icon",{key:"d00100625fa12d79aa4576e2d50ff36ff56a4225",scale:"s",icon:"chevron-down"}))))))}closeDropdown(){this.open=!1,this.dropdownNode&&(this.dropdownNode.parentNode?.removeChild(this.dropdownNode),this.dropdownNode=void 0,this.buttonNode.classList.remove("active"))}openFocusDropdown(){const{smartMappingState:e}=this;if(this.open)this.open=!1;else{this.arcgisSmartMappingRelationshipFocusButtonBeforeOpen.emit();const t=document.createElement("arcgis-smart-mapping-dropdown");t.smartMappingState=e,t.buttonNode=this.buttonNode,t.infos=this.focusInfos,this.dropdownNode=t,t.addEventListener("arcgisSmartMappingDropdownClose",(e=>{this.closeDropdown(),"Escape"===e.detail&&this.setFocus()})),t.addEventListener("arcgisSmartMappingDropdownChange",(e=>this.setNewFocus(e.detail))),t.addEventListener("arcgisSmartMappingDropdownDisconnected",(()=>this.closeDropdown())),this.buttonNode.classList.add("active"),document.body.appendChild(t),this.open=!0}}setNewFocus(e){const{smartMappingState:t}=this,i=(0,a.g)(t).authoringInfo.focus,s=e.focus;if(s===i)return this.closeDropdown(),void setTimeout((()=>{this.setFocus()}),300);(0,d.r)((0,l.u)(t,{focus:s}),this.flowItemNode).then((i=>{this.setSelectedFocus(e.focus);(0,a.g)(t).uniqueValueInfos.forEach((e=>{i.uniqueValueInfos.find((t=>e.value===t.value)).label=e.label})),(0,a.t)(t,i),setTimeout((()=>{this.setFocus()}),300),this.arcgisSmartMappingRelationshipFocusButtonChange.emit()}),(e=>{setTimeout((()=>{this.setFocus()})),this.arcgisSmartMappingRelationshipFocusButtonError.emit(e)})),this.closeDropdown()}setSelectedFocus(e){this.focusInfos.forEach((t=>{t.focus===e?(this.selectedFocusInfo=t,t.selected=!0):t.selected=!1}))}get el(){return(0,s.a)(this)}};var Zt;Jt.style=".focus-button{display:flex;padding:6px;justify-content:space-between;align-items:center;border-radius:0;cursor:pointer;background-color:var(--calcite-color-foreground-1);color:var(--calcite-color-text-1);border-color:var(--calcite-color-foreground-3);border-width:2px;border-style:solid;box-shadow:transparent 0px 0px 0px 1px inset}.focus-button:active{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}.focus-button:focus{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3);outline:2px solid var(--calcite-color-brand);outline-offset:2px}.focus-button.active{outline:1px solid var(--calcite-ui-focus-color, var(--calcite-color-brand))}.focus-content{justify-content:space-between;display:flex;align-items:center;width:100%}.focus-button-text{display:inline-block;padding:0 10px}.focus-button-title{font-weight:bold}.focus-button-msg{font-size:80%;line-height:16px}.focus-margin{margin:12px 0}",function(e){e.focusUp16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M1.71,8 L5.93,3.78 L8,5.85 L10.07,3.78 L14.29,8 L8,14.29 L1.71,8 Z",e.focusRight16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M1.71,8 L8,1.71 L12.22,5.93 L10.15,8 L12.22,10.07 L8,14.29 L1.71,8 Z",e.focusLeft16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M3.78,10.07 L5.85,8 L3.78,5.93 L8,1.71 L14.29,8 L8,14.29 L3.78,10.07 Z",e.focusDown16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M8,1.71 L14.29,8 L10.07,12.22 L8,10.15 L5.93,12.22 L1.71,8 L8,1.71 Z",e.code16="M6.865 13.965l-.957-.29 3.213-10.62.957.29zM15.19 8.45l-3.837-3.805-.704.71 3.131 3.104-3.135 3.19.712.702zm-9.833 3.2L2.221 8.458l3.13-3.104-.703-.71L.811 8.45l3.833 3.9z",e.fields16="M10.578 1A2.425 2.425 0 0 1 13 3.422V6c0 .552.448 1 1 1v1c-.552 0-1 .448-1 1v2.578A2.425 2.425 0 0 1 10.578 14H10v-1h.578c.785 0 1.421-.637 1.422-1.422V9c0-.574.247-1.121.679-1.5A1.995 1.995 0 0 1 12 6V3.422c0-.785-.637-1.421-1.422-1.422H10V1h.578zM6 1v1h-.578C4.637 2 4.001 2.637 4 3.422V6c0 .574-.247 1.121-.679 1.5.432.379.68.926.679 1.5v2.578c0 .785.637 1.421 1.422 1.422H6v1h-.578A2.425 2.425 0 0 1 3 11.578V9c0-.552-.448-1-1-1V7c.552 0 1-.448 1-1V3.422A2.425 2.425 0 0 1 5.422 1H6z"}(Zt||(Zt={}));const Kt=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingRelationshipLegendFocusChange=(0,s.c)(this,"arcgisSmartMappingRelationshipLegendFocusChange",7),this.arcgisSmartMappingRelationshipLegendError=(0,s.c)(this,"arcgisSmartMappingRelationshipLegendError",7),this.manager=(0,c.u)(this),this.valueTextNodes=[],this.smartMappingState=(0,r.u)()}componentWillLoad(){this.flowItemNode=(0,g.f)(this.el,"calcite-flow-item")}disconnectedCallback(){this.smartMappingState.selectedValue=void 0}render(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-block",{key:"7e2ba410e4c39f9b66a62b6badf102d3947273b6",open:!0,heading:e.relationshipLegend.legend,collapsible:!0},this.renderContent())}renderContent(){return(0,s.h)("div",null,(0,s.h)("div",{class:"attributes"},this.renderAttribute(0),this.renderAttribute(1)),this.renderFocus(),this.renderLabels())}renderAttribute(e){const{smartMappingState:t}=this,i=(0,a.g)(t).authoringInfo,n=0===e?i.field1:i.field2,o=(0,a.y)(t,n.field),r=this.getColorOrder(e);return(0,s.h)("div",{class:"attribute"},(0,s.h)("div",{class:"attribute-color-icon","aria-hidden":"true"},r.map(((e,t)=>this.getSwatch(r[t])))),(0,s.h)("div",{class:"attribute-name"},o.label))}renderFocus(){const e=this.flowItemNode;return(0,s.h)("arcgis-smart-mapping-relationship-focus-button",{flowItemNode:e,onArcgisSmartMappingRelationshipFocusButtonBeforeOpen:()=>(0,a.J)(),onArcgisSmartMappingRelationshipFocusButtonChange:()=>{this.arcgisSmartMappingRelationshipLegendFocusChange.emit(),(0,s.f)(this.el)},onArcgisSmartMappingRelationshipFocusButtonError:({detail:e})=>this.arcgisSmartMappingRelationshipLegendError.emit(e)})}renderLabels(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e).authoringInfo.numClasses;return(0,s.h)("calcite-label",null,t.relationshipLegend.labels,(0,s.h)("calcite-list",{label:t.relationshipLegend.labels},this.renderLabel(0),this.renderLabel(i-1),this.renderLabel(i*i-i),this.renderLabel(i*i-1)))}renderLabel(e){const{smartMappingState:t}=this,i=(0,a.g)(t).authoringInfo,n=i.numClasses,o=i.focus,r=0===e?Zt.focusUp16:e===("LH"===o||"HL"===o?n*n-n:n-1)?Zt.focusLeft16:e===("LH"===o||"HL"===o?n-1:n*n-n)?Zt.focusRight16:Zt.focusDown16;return(0,s.h)("calcite-list-item",null,this.renderIconNode(r),this.renderTextNode(e))}renderIconNode(e){const{smartMappingState:t}=this,i=!(0,a.g)(t).authoringInfo.focus;return(0,s.h)("div",{slot:"actions-start",class:"label-icon"},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16",class:i?"rotate-45":""},(0,s.h)("path",{d:e})))}renderTextNode(e){const{smartMappingState:t}=this,{strings:i}=t,n=(0,a.g)(t),o=n.authoringInfo,r=o.numClasses,l=o.focus,c=n.uniqueValueInfos[e],d=0===e?i.relationshipLegend.accessibility.editLabelForTop:e===("LH"===l||"HL"===l?r*r-r:r-1)?i.relationshipLegend.accessibility.editLabelForLeft:e===("LH"===l||"HL"===l?r-1:r*r-r)?i.relationshipLegend.accessibility.editLabelForRight:i.relationshipLegend.accessibility.editLabelForBottom;return this.selectedLabelText===e?(0,s.h)("calcite-input",{slot:"content",scale:"s",value:c.label??void 0,onFocusout:t=>{const i=t.target;this.handleLabelTextChange(e,i.value)},onKeyDown:t=>{if(t.stopPropagation(),"Escape"===t.key||"Enter"===t.key){const i=t.target;this.handleLabelTextChange(e,i.value)}},ref:e=>{e?.setFocus()}}):(0,s.h)("div",{class:"label",slot:"content",tabIndex:0,"aria-label":d,onClick:()=>this.handleLabelTextClick(e),onKeyUp:t=>{" "!==t.key&&"Enter"!==t.key||this.handleLabelTextClick(e)},ref:t=>{t&&(this.valueTextNodes[e]=t)}},c.label)}getColorOrder(e){const{smartMappingState:t}=this,i=(0,a.g)(t).authoringInfo||{};let s=[];if(2===i.numClasses)switch(i.focus){case"HH":default:s=0===e?[3,1]:[3,2];break;case"HL":s=0===e?[2,0]:[2,3];break;case"LH":s=0===e?[1,3]:[1,0];break;case"LL":s=0===e?[0,2]:[0,1]}else if(3===i.numClasses)switch(i.focus){case"HH":default:s=0===e?[8,5,2]:[8,7,6];break;case"HL":s=0===e?[6,3,0]:[6,7,8];break;case"LH":s=0===e?[2,5,8]:[2,1,0];break;case"LL":s=0===e?[0,3,6]:[0,1,2]}else switch(i.focus){case"HH":default:s=0===e?[15,11,7,3]:[15,14,13,12];break;case"HL":s=0===e?[12,8,4,0]:[12,13,14,15];break;case"LH":s=0===e?[3,7,11,15]:[3,2,1,0];break;case"LL":s=0===e?[0,4,8,12]:[0,1,2,3]}return s}getSwatch(e){const{smartMappingState:t}=this,i=(0,a.g)(t);return(0,s.h)("div",{class:"attribute-color-icon-selection",ref:s=>{if(s){const n=(0,a.h)(t,i.uniqueValueInfos[e].symbol);s.style.width=100/i.authoringInfo.numClasses+"px",s.style.backgroundColor=n?.toHex()||"#ffffff"}}})}handleLabelTextClick(e){this.smartMappingState.selectedValue=e,this.selectedLabelText=e,(0,s.f)(this.el)}handleLabelTextChange(e,t){const{smartMappingState:i}=this;(0,a.g)(i).uniqueValueInfos[e].label=t,this.selectedLabelText=void 0,(0,a.t)(i),(0,s.f)(this.el),setTimeout((()=>{this.smartMappingState.selectedValue===e&&(this.valueTextNodes[e]?.focus(),this.smartMappingState.selectedValue=void 0)}),300)}get el(){return(0,s.a)(this)}};Kt.style=".attribute {\n  display: flex;\n  padding-bottom: 6px;\n}\n\n.attributes {\n  margin: 12px 0;\n}\n\n.attribute-name {\n  padding: 0 10px;\n  width: calc(100% - 45px);\n  word-break: break-all;\n}\n.attribute-color-icon {\n  width: 45px;\n  height: 16px;\n  overflow: hidden;\n  border-radius: 3px;\n  display: flex;\n  align-self: center;\n}\n\n.attribute-color-icon-selection {\n  height: 16px;\n  display: inline-block;\n}\n\n.label {\n  display: flex;\n  padding: 6px 0;\n  align-items: center;\n  div {\n    display: flex;\n    //flex-direction: row;\n  }\n}\n.label-icon {\n  color: rgba(50, 50, 50, 0.4);\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  cursor: default;\n\n  .rotate-45 {\n    transform: rotate(45deg);\n  }\n}\n";const jt=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingTypeActionsPopoverChange=(0,s.c)(this,"arcgisSmartMappingTypeActionsPopoverChange",7),this.arcgisSmartMappingTypeActionsPopoverFocusExit=(0,s.c)(this,"arcgisSmartMappingTypeActionsPopoverFocusExit",7),this.manager=(0,c.u)(this),this.checkedClasses=void 0,this.groupMenuNodes=void 0,this.referenceNode=void 0,this.smartMappingState=void 0,this.showMoveToGroup=!1}componentWillLoad(){this.topActionHandler=e=>{e.shiftKey&&"Tab"===e.key&&this.arcgisSmartMappingTypeActionsPopoverFocusExit.emit("top")}}componentDidRender(){const e=(this.moveUpNode?.disabled?void 0:this.moveUpNode)||(this.moveDownNode?.disabled?void 0:this.moveDownNode)||this.mergeNode||this.separateNode||this.moveToGroupNode;e?.removeEventListener("keydown",this.topActionHandler),e?.addEventListener("keydown",this.topActionHandler)}async focusActionPad(){this.actionPadNode?.setFocus()}async focusLastAction(){if(this.actionPadNode){const e=Array.from(this.actionPadNode.querySelectorAll("calcite-action")).filter((e=>!e.disabled));e[e.length-1].setFocus()}}render(){const{strings:e}=this.smartMappingState;if(!this.checkedClasses?.length)return(0,s.h)(s.F,null);const t=this.referenceNode?.getBoundingClientRect(),i=t?.height;return(0,s.h)(s.H,null,(0,s.h)("calcite-popover",{class:"js-app-flyout popover",placement:"leading-start",offsetDistance:10,offsetSkidding:(0,a.S)(i)?(i-120)/4+70:0,pointerDisabled:!0,label:e.panels.type.typeActions,triggerDisabled:!0,referenceElement:this.referenceNode,open:!0,ref:e=>this.popoverNode=e},this.showMoveToGroup?this.renderMoveToGroup():this.renderActions()))}renderActions(){return(0,s.h)("calcite-action-pad",{layout:"vertical",position:"start",expanded:!0,expandDisabled:!0,ref:e=>{e&&(this.actionPadNode=e)}},this.renderGroup1(),this.renderGroup2(),this.renderGroup3())}renderMoveToGroup(){if(!this.showMoveToGroup)return(0,s.h)(s.F,null);const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e),n=i.uniqueValueGroups,o=!!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx))&&this.checkedClasses[0].groupIdx,r=n.map(((e,t)=>this.renderMoveToGroupListItem(e,t)));return(0,s.h)("calcite-panel",{heading:t.panels.type.moveToGroup,closable:!0,onCalcitePanelClose:()=>{this.showMoveToGroup=!1,(0,s.f)(this.el),setTimeout((()=>{this.moveToGroupNode.setFocus()}),300)},ref:e=>{e?.setFocus()}},(0,s.h)("calcite-list",{filterEnabled:n.length>=10,filterPlaceholder:t.panels.type.searchGroups,label:t.panels.type.selectGroup,selectionMode:"single"},r,!i.uniqueValueGroups.length&&(0,s.h)("calcite-list-item",{label:t.panels.type.untitledGroup,onCalciteListItemSelect:()=>this.moveToNewGroup(!0)}),(0,s.h)("calcite-list-item",{label:i.defaultLabel||t.panels.type.other,value:-1,disabled:-1===o,onCalciteListItemSelect:()=>{this.checkedClasses.sort(((e,t)=>t.groupIdx-e.groupIdx==0?t.classIdx-e.classIdx:t.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(n[e.groupIdx].classes.splice(e.classIdx,1),n[e.groupIdx].classes.length||n.splice(e.groupIdx,1))})),this.checkedClasses=[],i.uniqueValueGroups=n,(0,a.t)(e),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.groupMenuNodes[-1]?.setFocus()}),300)}})),(0,s.h)("calcite-button",{appearance:"outline",label:t.cancel,innerHTML:t.cancel,width:"full",slot:"footer",onClick:()=>{this.showMoveToGroup=!1,(0,s.f)(this.el),setTimeout((()=>{this.moveToGroupNode.setFocus()}),300)}}))}renderMoveToGroupListItem(e,t){const{smartMappingState:i}=this,{strings:n}=i,o=(0,a.g)(i),r=o.uniqueValueGroups,c=!!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx))&&this.checkedClasses[0].groupIdx;return(0,s.h)("calcite-list-item",{label:e.heading||n.panels.type.untitledGroup,value:t,disabled:c===t,onCalciteListItemSelect:e=>{const t=e.target.value;let s=this.checkedClasses.filter((e=>-1!==e.groupIdx)).map((e=>r[e.groupIdx].classes[e.classIdx]));const n=(0,l.n)(i);s=s.concat(this.checkedClasses.filter((e=>-1===e.groupIdx)).map((e=>n[e.classIdx])));const c=r[t];c.classes=c.classes.concat(s),this.checkedClasses.sort(((e,t)=>t.groupIdx-e.groupIdx==0?t.classIdx-e.classIdx:t.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(r[e.groupIdx].classes.splice(e.classIdx,1),r[e.groupIdx].classes.length||r.splice(e.groupIdx,1))})),this.checkedClasses=[],o.uniqueValueGroups=r,(0,a.t)(i),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.groupMenuNodes[t]?.setFocus()}),300)}})}renderGroup1(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e).uniqueValueGroups;if(this.checkedClasses.find((e=>-1===e.groupIdx)))return(0,s.h)(s.F,null);const n=this.checkedClasses.map((e=>e.classIdx)),o=n.length,r=i[this.checkedClasses[0].groupIdx]?.classes.length;n.sort(((e,t)=>e-t));const l=n[0]>0||!!n.find(((e,t)=>t>0&&e-1>n[t-1])),c=n[o-1]<r-1||!!n.find(((e,t)=>t<o-1&&e+1<n[t+1]));return(0,s.h)("calcite-action-group",null,(0,s.h)("calcite-action",{text:t.panels.type.moveUp,textEnabled:!0,disabled:!l,icon:"arrow-bold-up",onClick:()=>this.moveUp(),ref:e=>this.moveUpNode=e}),(0,s.h)("calcite-action",{text:t.panels.type.moveDown,textEnabled:!0,disabled:!c,icon:"arrow-bold-down",onClick:()=>this.moveDown(),ref:e=>this.moveDownNode=e}))}renderGroup2(){const{smartMappingState:e}=this,{strings:t}=e,i=(0,a.g)(e).uniqueValueGroups,n=!!this.checkedClasses.find((e=>e.groupIdx!==this.checkedClasses[0].groupIdx)),o=!!this.checkedClasses.find((e=>-1!==e.groupIdx))&&this.checkedClasses.length>1,r=!!this.checkedClasses.find((e=>-1!==e.groupIdx&&i[e.groupIdx].classes[e.classIdx].values.length>1)),l=!!this.checkedClasses.find((e=>-1!==e.groupIdx)),c=!n&&-1!==this.checkedClasses[0].groupIdx&&this.checkedClasses.length===i[this.checkedClasses[0].groupIdx].classes.length;return(0,s.h)("calcite-action-group",null,o&&(0,s.h)("calcite-action",{text:t.panels.type.mergeValues,textEnabled:!0,onClick:()=>this.mergeValues(),ref:e=>this.mergeNode=e}),r&&(0,s.h)("calcite-action",{text:t.panels.type.separateValues,textEnabled:!0,onClick:()=>this.separateSelectedValues(),ref:e=>this.separateNode=e}),(0,s.h)("calcite-action",{text:t.panels.type.moveToGroup,textEnabled:!0,onClick:()=>this.moveToGroup(),ref:e=>{e&&(this.moveToGroupNode=e)}}),(0,s.h)("calcite-action",{text:t.panels.type.newGroup,textEnabled:!0,disabled:c,onClick:()=>this.moveToNewGroup()}),l&&(0,s.h)("calcite-action",{text:t.panels.type.remove,textEnabled:!0,onClick:()=>this.removeValues()}))}renderGroup3(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-action-group",null,(0,s.h)("calcite-action",{text:e.panels.type.clearSelection,textEnabled:!0,onClick:()=>this.clearSelection(),onKeyDown:e=>{e.shiftKey||"Tab"!==e.key||this.arcgisSmartMappingTypeActionsPopoverFocusExit.emit("bottom")}}))}clearSelection(){let e=-1;this.checkedClasses.forEach((t=>e=-1===t.groupIdx?e:-1===e?t.groupIdx:Math.min(e,t.groupIdx))),this.checkedClasses=[],this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.groupMenuNodes[e]?.setFocus()}),300)}mergeValues(){const{smartMappingState:e}=this,t=(0,a.g)(e),i=t.uniqueValueGroups;this.checkedClasses.sort(((e,t)=>e.groupIdx-t.groupIdx==0?e.classIdx-t.classIdx:-1===e.groupIdx||-1===t.groupIdx?t.groupIdx-e.groupIdx:e.groupIdx-t.groupIdx));const s=i[this.checkedClasses[0].groupIdx].classes[this.checkedClasses[0].classIdx],n=(0,l.n)(e);this.checkedClasses.forEach(((e,t)=>{if(t>0){const t=-1===e.groupIdx?n[e.classIdx]:i[e.groupIdx].classes[e.classIdx];s.values=s.values.concat(t.values),s.label+=`, ${t.label}`}}));const o=[];i.forEach(((e,t)=>{const i=[];e.classes.forEach(((e,a)=>{this.checkedClasses[0].groupIdx===t&&this.checkedClasses[0].classIdx===a?i.push(s):this.checkedClasses.find((e=>e.groupIdx===t&&e.classIdx===a))||i.push(e)})),i.length&&(e.classes=i,o.push(e))})),t.uniqueValueGroups=o,this.checkedClasses=[],(0,a.t)(e),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}moveDown(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,a.g)(e),s=i.uniqueValueGroups,n=s[this.checkedClasses[0].groupIdx];this.checkedClasses.sort(((e,t)=>t.groupIdx-e.groupIdx==0?t.classIdx-e.classIdx:t.groupIdx-e.groupIdx));const o=t.esriLang.clone(this.checkedClasses);this.checkedClasses.forEach(((e,t)=>{if(e.classIdx<n.classes.length-1&&(0===t||t>0&&o[t-1].classIdx!==e.classIdx+1)){const i=n.classes.splice(e.classIdx,1)[0];n.classes.splice(e.classIdx+1,0,i),o[t].classIdx=e.classIdx+1}})),this.checkedClasses=o,i.uniqueValueGroups=s,(0,a.t)(e),this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((async()=>{await(this.moveDownNode.disabled?this.moveUpNode.setFocus():this.moveDownNode.setFocus())}),300)}moveToGroup(){this.showMoveToGroup=!0}moveToNewGroup(e=!1){const{smartMappingState:t}=this,{modules:i}=t,s=(0,a.g)(t),n=s.uniqueValueGroups;let o=this.checkedClasses.filter((e=>-1!==e.groupIdx)).map((e=>n[e.groupIdx].classes[e.classIdx]));const r=(0,l.n)(t);o=o.concat(this.checkedClasses.filter((e=>-1===e.groupIdx)).map((e=>r[e.classIdx])));const c=new i.UniqueValueGroup({heading:e?void 0:(0,l.r)(t,n),classes:o});n.push(c),this.checkedClasses.sort(((e,t)=>t.groupIdx-e.groupIdx==0?t.classIdx-e.classIdx:t.groupIdx-e.groupIdx)),this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(n[e.groupIdx].classes.splice(e.classIdx,1),n[e.groupIdx].classes.length||n.splice(e.groupIdx,1))})),this.checkedClasses=[],s.uniqueValueGroups=n,(0,a.t)(t),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((()=>{this.groupMenuNodes[n.length-1]?.setFocus()}),300)}moveUp(){const{smartMappingState:e}=this,{modules:t}=e,i=(0,a.g)(e),s=i.uniqueValueGroups,n=s[this.checkedClasses[0].groupIdx];this.checkedClasses.sort(((e,t)=>e.groupIdx-t.groupIdx==0?e.classIdx-t.classIdx:e.groupIdx-t.groupIdx));const o=t.esriLang.clone(this.checkedClasses);this.checkedClasses.forEach(((e,t)=>{if(e.classIdx>0&&(0===t||t>0&&o[t-1].classIdx!==e.classIdx-1)){const i=n.classes.splice(e.classIdx,1)[0];n.classes.splice(e.classIdx-1,0,i),o[t].classIdx=e.classIdx-1}})),this.checkedClasses=o,i.uniqueValueGroups=s,(0,a.t)(e),this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses}),setTimeout((async()=>{await(this.moveUpNode.disabled?this.moveDownNode.setFocus():this.moveUpNode.setFocus())}),300)}removeValues(){const{smartMappingState:e}=this,t=(0,a.g)(e);let i=t.uniqueValueGroups;const s={};this.checkedClasses?.forEach((e=>{s[e.groupIdx]||(s[e.groupIdx]=[]),s[e.groupIdx].push(e.classIdx)})),i.forEach(((e,t)=>{const i=s[t];i&&(e.classes=e.classes.filter(((e,t)=>!i.includes(t))))})),i=i.filter((e=>!!e.classes.length)),t.uniqueValueGroups=i,(0,a.t)(e),this.popoverNode.open=!1,this.checkedClasses=[],this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}separateSelectedValues(){const{smartMappingState:e}=this,t=(0,a.g)(e).uniqueValueGroups;this.checkedClasses.sort(((e,t)=>e.groupIdx-t.groupIdx==0?e.classIdx-t.classIdx:e.groupIdx-t.groupIdx));const i=[];let s=-2,n=[];this.checkedClasses.forEach((e=>{-1!==e.groupIdx&&(s!==e.groupIdx?(-2!==s&&i.push({groupIdx:s,classIdxs:n}),s=e.groupIdx,n=[e.classIdx]):n.push(e.classIdx))})),-2!==s&&i.push({groupIdx:s,classIdxs:n}),i.forEach((i=>(0,l.q)(e,t[i.groupIdx],i.classIdxs))),this.checkedClasses=[],(0,a.t)(e),this.popoverNode.open=!1,this.arcgisSmartMappingTypeActionsPopoverChange.emit({checkedClasses:this.checkedClasses})}get el(){return(0,s.a)(this)}};jt.style=".popover{--calcite-popover-z-index:100}";const Wt=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingTypeAddValuePopoverClose=(0,s.c)(this,"arcgisSmartMappingTypeAddValuePopoverClose",7),this.arcgisSmartMappingTypeAddValuePopoverNewValue=(0,s.c)(this,"arcgisSmartMappingTypeAddValuePopoverNewValue",7),this.manager=(0,c.u)(this),this.isInt=!1,this.userTouchedLabel=!1,this.flowItemNode=void 0,this.referenceNode=void 0,this.groupIdx=void 0,this.smartMappingState=void 0}componentWillLoad(){const{smartMappingState:e}=this,{allUniqueValues:t}=e,i=(0,a.g)(e);this.allValues=t?.map((e=>`${e.value}`)),i.uniqueValueGroups.forEach((e=>{e.classes.forEach((e=>{const t=e.values?.[0].value;this.allValues.includes(`${t}`)||this.allValues.push(`${t}`)}))})),this.field=(0,a.y)(e,i.field),this.isDate=this.field?.simpleFieldType===a.w.DATE,this.isNumber=this.field?.simpleFieldType===a.w.NUMBER,this.isInt=!!this.field&&["small-integer","integer","long"].includes((0,a.F)(e,this.field.layerField)||"string")}componentDidLoad(){this.panelNode?.setFocus()}render(){const{strings:e}=this.smartMappingState;return(0,s.h)(s.H,{key:"f6be6165a4f3afe3861a433bc501eaf206b21c5a"},(0,s.h)("calcite-popover",{key:"0ce928a7a7b7d1456928eefb9d5f3ef503da0fb9",referenceElement:this.referenceNode,placement:"bottom-end",offsetDistance:0,offsetSkidding:0,label:e.panels.type.addValue,open:!0,ref:e=>this.popoverNode=e},this.renderContent()))}renderContent(){const{strings:e}=this.smartMappingState,t=this.flowItemNode?.getBoundingClientRect().width;return(0,s.h)("calcite-panel",{heading:e.panels.type.addValue,closable:!0,onCalcitePanelClose:()=>this.arcgisSmartMappingTypeAddValuePopoverClose.emit(),ref:e=>this.panelNode=e},(0,s.h)("div",{ref:e=>{e&&(e.style.padding="15px",e.style.width=`${t?t+20:280}px`)}},this.renderValueInput(),this.renderLabelInput()),this.renderDoneButton())}renderValueInput(){const{strings:e}=this.smartMappingState,{isDate:t,isInt:i,isNumber:a}=this;return(0,s.h)("calcite-label",null,e.panels.type.value,t?(0,s.h)("calcite-input-date-picker",{overlayPositioning:"fixed",onCalciteInputDatePickerChange:e=>{const t=e.target;this.handleAddDate(t.value)},ref:e=>{e&&(this.valueInputNode=e)}}):a?(0,s.h)("calcite-input-number",{step:i?1:"any",integer:i,label:e.panels.type.value,placeholder:e.panels.type.storedValue,onCalciteInputNumberInput:()=>{const e=this.valueInputNode.value;""===e||Number.isNaN(Number(e))?(this.doneButtonNode.disabled=!0,this.valueInputMessageNode.hidden=!0,this.valueInputNode.value="",this.userTouchedLabel||(this.labelInputNode.value="")):this.handleAddNumber(e)},ref:e=>{e&&(this.valueInputNode=e)}}):(0,s.h)("calcite-input",{label:e.panels.type.value,placeholder:e.panels.type.storedValue,onCalciteInputInput:()=>this.handleAddString(this.valueInputNode.value),ref:e=>{e&&(this.valueInputNode=e)}}),(0,s.h)("calcite-input-message",{hidden:!0,icon:"exclamation-mark-triangle",status:"invalid",ref:e=>this.valueInputMessageNode=e},e.panels.type.valueNotUnique))}renderLabelInput(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-label",null,e.panels.type.label,(0,s.h)("calcite-input",{type:"text",value:"",placeholder:e.panels.type.displayedValue,label:e.panels.type.label,onCalciteInputInput:()=>this.userTouchedLabel=!0,ref:e=>this.labelInputNode=e}))}renderDoneButton(){const{smartMappingState:e}=this,{modules:t,strings:i}=e,{field:a,isDate:n,isInt:o,isNumber:r}=this;return(0,s.h)("calcite-button",{appearance:"solid",label:i.done,width:"full",slot:"footer",disabled:!0,onClick:()=>{this.popoverNode.open=!1;const i=this.valueInputNode.value;let s,c;n?(s=this.labelInputNode.value||(0,l.p)(e,i,a),c=i):r?(c=o?Number.parseInt(i):Number.parseFloat(i),s=this.labelInputNode.value||t.intl.formatNumber(c)):(s=this.labelInputNode.value||i,c=i),this.addValue(s,c)},ref:e=>this.doneButtonNode=e},i.done)}addValue(e,t){const{smartMappingState:i}=this,{modules:s}=i,n=(0,a.g)(i),o=s.esriLang.clone(n.uniqueValueInfos.find((e=>["simple-marker","simple-line","simple-fill","cim"].includes(e.symbol?.type??"")))?.symbol||(0,a.f)(i,(0,a.k)(i))),r=(0,a.aB)(i).colors,l=new s.EsriColor(r[n.uniqueValueInfos.length%10]);l&&(0,a.j)(i,o,l);let c=n.uniqueValueGroups;-2===this.groupIdx&&(c=[new s.UniqueValueGroup({heading:void 0,classes:[]})],this.groupIdx=0),c[this.groupIdx].classes.push(new s.UniqueValueClass({values:[new s.UniqueValue({value:t})],label:e,symbol:o})),n.uniqueValueGroups=c,this.arcgisSmartMappingTypeAddValuePopoverNewValue.emit()}handleAddDate(e){const{smartMappingState:t}=this,{allUniqueValues:i}=t,s=(0,a.g)(t),n=i?.map((e=>`${e.value}`));s.uniqueValueGroups.forEach((e=>{e.classes.forEach((e=>{const t=e.values?.[0].value;n.includes(`${t}`)||n.push(`${t}`)}))}));const o=(0,a.y)(t,s.field);this.userTouchedLabel||(this.labelInputNode.value=(0,l.p)(t,e,o)),this.valueInputMessageNode.hidden=!n.includes(e),this.doneButtonNode.disabled=!e.length||n.includes(e)}handleAddNumber(e){const{modules:t}=this.smartMappingState;if(e.length&&this.isInt){let t=`${Math.round(Number.parseFloat(e))}`;t.includes(".")&&(t=t.substring(0,t.indexOf("."))),t!==e&&(e=t)}if(!this.userTouchedLabel){const i=this.isInt?Number.parseInt(e):Number.parseFloat(e);this.labelInputNode.value=t.intl.formatNumber(i)}this.valueInputMessageNode.hidden=!this.allValues.includes(e),this.doneButtonNode.disabled=!e.length||this.allValues.includes(e)}handleAddString(e){this.userTouchedLabel||(this.labelInputNode.value=e),this.valueInputMessageNode.hidden=!this.allValues.includes(e),this.doneButtonNode.disabled=!e.length||this.allValues.includes(e)}get el(){return(0,s.a)(this)}}},16029:(e,t,i)=>{i.d(t,{a:()=>o,b:()=>n,c:()=>d,d:()=>c,e:()=>l,g:()=>h,u:()=>r});i(56612);var s=i(76744),a=i(17840);async function n(e,t){const{layer:i,mapView:a,modules:n}=e,o=i,r=(0,s.g)(e);return t=t||{},"heatmap"===(0,s.k)(e)&&(t.radius=t.radius||r.radius,t.heatmapScheme=t.heatmapScheme||(0,s.aG)(e)),t.fieldInfos?.length&&(0,s.av)(e,[t.fieldInfos[0].field]),await n.HeatmapCreator.createRenderer({layer:o,view:a,field:t.fieldInfos?.length?t.fieldInfos[0].field:null,radius:t.radius||10,heatmapScheme:t.heatmapScheme||void 0})}async function o(e,t){const{layer:i,mapView:a,modules:n}=e,o=i;t=t||{};const r=(0,s.g)(e),l=r.authoringInfo;return await n.HeatmapCreator.createRenderer({layer:o,view:a,field:t.fieldInfos?.length?t.fieldInfos[0].field:r.field,fadeRatio:t.fadeRatio??l?.fadeRatio,radius:t.radius||r.radius||10,heatmapScheme:t.heatmapScheme||(0,s.aG)(e)})}function r(e,t){const{modules:i}=e,a=(0,s.g)(e);return i.HeatmapCreator.updateRenderer({renderer:a,fadeRatio:t})}async function l(e,t){const{layer:i,mapView:a,modules:n}=e,o=i,r=(0,s.g)(e);return t=t||{},await n.heatmapStatistics({layer:o,view:a,field:r.field,radius:t.radius||r.radius||10}).then((e=>(r.minDensity=e.min,r.maxDensity=e.max,e)))}async function c(e,t){const{layer:i,useFeatureReduction:n,mapImageSublayer:o,mapView:r,modules:l}=e,c=i;t=t||{};const d=(0,s.at)(e,(0,s.g)(e));return await l.ColorCreator.createContinuousRenderer({layer:c,view:r,field:t.fieldInfos[0].field,theme:"above-and-below",colorScheme:(0,s.aD)(e,"above-and-below"),normalizationField:t.fieldInfos[1].field,outlineOptimizationEnabled:!o&&((0,a.i)(t.outlineOptimizationEnabled)?t.outlineOptimizationEnabled:(0,s.e)(e)),sizeOptimizationEnabled:!o&&(!(0,a.i)(t.sizeOptimizationEnabled)||t.sizeOptimizationEnabled),legendOptions:t.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===c.featureReduction?.type&&n}).then((e=>(((0,s.d)(e.renderer,"color")||{}).style="ratio",(0,s.au)(d,e.renderer),e)))}async function d(e,t){const{layer:i,useFeatureReduction:n,mapImageSublayer:o,mapView:r,modules:l}=e,c=i;t=t||{};const d=(0,s.g)(e),p=(0,s.b)(d,"color");if(p&&t.fieldInfo&&t.fieldInfo.field===p.field&&t.normalizationField===p.normalizationField&&(delete t.fieldInfos,(0,s.aw)(t)))return{renderer:d.clone()};const u=(0,s.d)(d,"color"),m=(0,s.at)(e,d),g=t.fieldInfos?t.fieldInfos[0]:p?{field:p.field,expression:p.valueExpression,expressionTitle:p.valueExpressionTitle,simpleFieldType:s.w.NUMBER}:{field:d.field,expression:d.valueExpression,expressionTitle:d.valueExpressionTitle,simpleFieldType:s.w.NUMBER},S=t.normalizationField?t.normalizationField:p?p.normalizationField:d.normalizationField,f=d.classBreakInfos?.length?d.classBreakInfos[0].symbol:null,b=d.defaultSymbol,v=d.defaultLabel;let y=!1;(null===t.normalizationField||t.normalizationField||t.fieldInfo)&&(y=!0);const C=t.discardMinMax?void 0:(0,a.i)(t.min)?t.min:y?void 0:u?u.minSliderValue:d.classBreakInfos[0].minValue,M=t.discardMinMax?void 0:(0,a.i)(t.max)?t.max:y?void 0:u?u.maxSliderValue:d.classBreakInfos[d.classBreakInfos.length-1].maxValue;return await l.ColorCreator.createContinuousRenderer({layer:c,view:r,field:g?g.field:d.field,theme:"above-and-below",colorScheme:(0,s.aD)(e,"above-and-below"),normalizationField:S,minValue:C,maxValue:M,outlineOptimizationEnabled:!o&&((0,a.i)(t.outlineOptimizationEnabled)?t.outlineOptimizationEnabled:!!m.sizeOutlineVisVar),sizeOptimizationEnabled:!o&&((0,a.i)(t.sizeOptimizationEnabled)?t.sizeOptimizationEnabled:!!m.sizeAutoVisVar),legendOptions:t.legendOptions?.toJSON()||p?.legendOptions?.toJSON()||d.legendOptions?.toJSON(),defaultSymbolEnabled:(0,a.i)(t.defaultSymbolEnabled)?t.defaultSymbolEnabled:!!d.defaultSymbol,forBinning:"binning"===c.featureReduction?.type&&n}).then((e=>{if(t.discardMinMax){const t=(0,s.b)(d,"color"),i=(0,s.b)(e.renderer,"color");t.stops.forEach(((e,t)=>e.value=i.stops[t].value));const a=!!u&&"percent"===u.style,n=!!u&&"percent-of-total"===u.style;t.stops[0].label=`< ${h(t.stops[0].value,a,n)}`,t.stops[2].label=h(t.stops[2].value,a,n),t.stops[4].label=`> ${h(t.stops[4].value,a,n)}`}return((0,s.d)(e.renderer,"color")||{}).style="ratio",(0,s.au)(m,e.renderer),f&&e.renderer.classBreakInfos?.length&&(e.renderer.classBreakInfos[0].symbol=f),b&&(e.renderer.defaultSymbol=b,e.renderer.defaultLabel=v),e}))}function h(e,t,i){return i?Math.round(e/(1+e)*1e4)/100+"%":t?Math.round(1e4*e)/100+"%":`${e}`}},44735:(e,t,i)=>{function s(e,t){if(!e||!t)return;let i=t.assetsPath;i.endsWith("/")||(i+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${i}esri/themes/light/main.css" />`)}i.d(t,{i:()=>s})},72513:(e,t,i)=>{i.d(t,{a:()=>r,b:()=>o,g:()=>h,u:()=>n});var s=i(17840),a=i(76744);function n(e,t){const{modules:i}=e,n=(0,a.g)(e),o=i.esriLang.clone(n.classBreakInfos);n.classBreakInfos=[],o.forEach(((i,a)=>{i=function(e,t,i,a,n){const{modules:o}=e;if((0,s.i)(i))if(0===i);else if(i<1){const e=Math.round(1/i);t.minValue="first"===n?Math.floor(t.minValue/i)/e:Math.round(t.minValue/i)/e,t.maxValue="last"===n?Math.ceil(t.maxValue/i)/e:Math.round(t.maxValue/i)/e,t.label=`${a>0?"> ":""}${t.minValue.toLocaleString(o.intl.getLocale(),{maximumSignificantDigits:15})} - ${t.maxValue.toLocaleString(o.intl.getLocale(),{maximumSignificantDigits:15})}`}else t.minValue="first"===n?Math.floor(t.minValue/i)*i:Math.round(t.minValue/i)*i,t.maxValue="last"===n?Math.ceil(t.maxValue/i)*i:Math.round(t.maxValue/i)*i,t.label=`${a>0?"> ":""}${t.minValue.toLocaleString()} - ${t.maxValue.toLocaleString()}`;return t}(e,i,t,a,0===a?"first":a===o.length-1?"last":void 0),n.addClassBreakInfo({minValue:i.minValue,maxValue:i.maxValue,symbol:i.symbol,label:i.label})}))}function o(e,t){const i=(0,a.g)(e).classBreakInfos;let s=t,n=Number.POSITIVE_INFINITY;i.forEach((e=>{s||(s=Math.max(l(e.minValue),l(e.maxValue))),n=Math.min(n,e.maxValue-e.minValue)}));const o=[];return n>1e7?(o.push(1e7),o.push(1e6),o.push(1e5),o.push(1e4),o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01)):n>1e6?(o.push(1e6),o.push(1e5),o.push(1e4),o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01)):n>1e5?(o.push(1e5),o.push(1e4),o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01)):n>1e4?(o.push(1e4),o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01)):n>1e3?(o.push(1e3),o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001)):n>100?(o.push(100),o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5)):n>10?(o.push(10),s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6)):n>1?(s>0&&o.push(1),s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6)):n>.1?(s>1&&o.push(.1),s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6)):n>.01?(s>2&&o.push(.01),s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6)):n>.001?(s>3&&o.push(.001),s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6),s>7&&o.push(1e-7)):n>1e-4?(s>4&&o.push(1e-4),s>5&&o.push(1e-5),s>6&&o.push(1e-6),s>7&&o.push(1e-7),s>8&&o.push(1e-8)):n>1e-5&&(s>5&&o.push(1e-5),s>6&&o.push(1e-6),s>7&&o.push(1e-7),s>8&&o.push(1e-8),s>9&&o.push(1e-9)),o}function r(e){const t=(0,a.g)(e);let i=1e10;return t.classBreakInfos.forEach((e=>{i=Math.min(i,c(e.minValue)),i=Math.min(i,c(e.maxValue))})),i}function l(e){let t=1;for(;Math.round(e*t)/t!==e;)t*=10;return Math.log(t)/Math.LN10}function c(e){let t=1e-8;for(;d(Math.round(e/t)*t)===e;)t*=10;return t/10}function d(e){return Number.parseFloat(e.toPrecision(12))}function h(e){let t=0;e.forEach((e=>{(0,s.i)(e.value)?t=Math.max(l(d(e.value)),t):((0,s.i)(e.minValue)&&(t=Math.max(l(d(e.minValue)),t)),(0,s.i)(e.maxValue)&&(t=Math.max(l(d(e.maxValue)),t)),(0,s.i)(e.min)&&(t=Math.max(l(d(e.min)),t)),(0,s.i)(e.max)&&(t=Math.max(l(d(e.max)),t)))})),t=Math.min(t,3);const i=e[0],a=e[e.length-1],n=Math.min(i.minValue??i.min??i.value,a.minValue??a.min??a.value),o=Math.max(i.maxValue??i.max??i.value,a.maxValue??a.max??a.value)-n;return o/e.length<2e-7?t=8:o/e.length<2e-6?t=7:o/e.length<2e-5?t=6:o/e.length<2e-4?t=5:o/e.length<.002?t=4:o/e.length<.02?t=3:o/e.length<.2?t=Math.max(t,2):o/e.length<2&&(t=Math.max(t,1)),Math.round(t)}}}]);