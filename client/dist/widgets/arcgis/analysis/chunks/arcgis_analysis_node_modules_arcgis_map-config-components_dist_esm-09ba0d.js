/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-09ba0d.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-09ba0d"],{12317:(e,t,a)=>{a.d(t,{a:()=>i,c:()=>n,f:()=>r});a(56612);var s=a(76744);async function i(e,t){const{layer:a,mapView:s,modules:i}=e,n=a;return t=t||{},await i.RasterFlowCreator.createRenderer({layer:n,view:s,theme:t.flowTheme||"flow-line",includeColorVariable:t.includeColorVariable,legendOptions:t.legendOptions,flowRepresentation:t.flowRepresentation,flowScheme:t.flowScheme||r(e)}).then((e=>(e.layerEffect&&!e.layerEffect.includes("drop-shadow")&&(n.effect=e.layerEffect),e.renderer.color=e.renderer.color&&(t.color||e.renderer.color),e)))}async function n(e,t){const{layer:a,mapView:i,modules:n}=e,l=a;t=t||{};const o=(0,s.m)(e),c=(0,s.b)(o,"color"),d=o.authoringInfo,p=t.flowTheme||d?.flowTheme||"flow-line";return await n.RasterFlowCreator.createRenderer({layer:l,view:i,theme:p,includeColorVariable:t.includeColorVariable??!!c,legendOptions:t.legendOptions||c?.legendOptions,flowRepresentation:t.flowRepresentation||o.flowRepresentation,flowScheme:t.flowScheme}).then((a=>{const i=(0,s.d)(o,"color"),l=(0,s.d)(a.renderer,"color");i?.minSliderValue&&i?.maxSliderValue&&l&&(l.minSliderValue=i.minSliderValue,l.maxSliderValue=i.maxSliderValue);const c=(0,s.b)((0,s.m)(e),"color"),h=(0,s.b)(a.renderer,"color");c&&h&&c.stops.forEach(((e,t)=>{h.stops[t].value=e.value})),a.renderer.color=a.renderer.color&&(t.color||o.color||a.renderer.color);return(t.flowScheme||r(e))&&c&&h&&c.stops.forEach(((e,t)=>{h.stops[t].color=new n.EsriColor(e.color.toJSON())})),p===d.flowTheme&&(a.renderer.flowSpeed=o.flowSpeed,a.renderer.density=o.density,a.renderer.trailLength=o.trailLength,a.renderer.trailWidth=o.trailWidth,a.renderer.trailCap=o.trailCap),a}))}function r(e){const{mapView:t,modules:a}=e,i=(0,s.m)(e),n=(0,s.b)(i,"color");if(!n)return null;const r=n.stops.map((e=>e.color)),l=a.flowSchemes.getSchemes({basemap:t.map?.basemap||"topo"}),o=[l.primaryScheme].concat(l.secondarySchemes),c=[];return o.forEach((e=>{let t=r.some(((t,a)=>!(0,s.aF)(e.colors[a],t)));t?(e.colors=e.colors.reverse(),t=r.some(((t,a)=>!(0,s.aF)(e.colors[a],t))),t||c.push(e)):c.push(e)})),c.length?c[0]:null}},16029:(e,t,a)=>{a.d(t,{a:()=>r,b:()=>n,c:()=>d,d:()=>c,e:()=>o,g:()=>p,u:()=>l});a(56612);var s=a(76744),i=a(17840);async function n(e,t){const{layer:a,mapView:i,modules:n}=e,r=a,l=(0,s.g)(e);return t=t||{},"heatmap"===(0,s.k)(e)&&(t.radius=t.radius||l.radius,t.heatmapScheme=t.heatmapScheme||(0,s.aG)(e)),t.fieldInfos?.length&&(0,s.av)(e,[t.fieldInfos[0].field]),await n.HeatmapCreator.createRenderer({layer:r,view:i,field:t.fieldInfos?.length?t.fieldInfos[0].field:null,radius:t.radius||10,heatmapScheme:t.heatmapScheme||void 0})}async function r(e,t){const{layer:a,mapView:i,modules:n}=e,r=a;t=t||{};const l=(0,s.g)(e),o=l.authoringInfo;return await n.HeatmapCreator.createRenderer({layer:r,view:i,field:t.fieldInfos?.length?t.fieldInfos[0].field:l.field,fadeRatio:t.fadeRatio??o?.fadeRatio,radius:t.radius||l.radius||10,heatmapScheme:t.heatmapScheme||(0,s.aG)(e)})}function l(e,t){const{modules:a}=e,i=(0,s.g)(e);return a.HeatmapCreator.updateRenderer({renderer:i,fadeRatio:t})}async function o(e,t){const{layer:a,mapView:i,modules:n}=e,r=a,l=(0,s.g)(e);return t=t||{},await n.heatmapStatistics({layer:r,view:i,field:l.field,radius:t.radius||l.radius||10}).then((e=>(l.minDensity=e.min,l.maxDensity=e.max,e)))}async function c(e,t){const{layer:a,useFeatureReduction:n,mapImageSublayer:r,mapView:l,modules:o}=e,c=a;t=t||{};const d=(0,s.at)(e,(0,s.g)(e));return await o.ColorCreator.createContinuousRenderer({layer:c,view:l,field:t.fieldInfos[0].field,theme:"above-and-below",colorScheme:(0,s.aD)(e,"above-and-below"),normalizationField:t.fieldInfos[1].field,outlineOptimizationEnabled:!r&&((0,i.i)(t.outlineOptimizationEnabled)?t.outlineOptimizationEnabled:(0,s.e)(e)),sizeOptimizationEnabled:!r&&(!(0,i.i)(t.sizeOptimizationEnabled)||t.sizeOptimizationEnabled),legendOptions:t.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===c.featureReduction?.type&&n}).then((e=>(((0,s.d)(e.renderer,"color")||{}).style="ratio",(0,s.au)(d,e.renderer),e)))}async function d(e,t){const{layer:a,useFeatureReduction:n,mapImageSublayer:r,mapView:l,modules:o}=e,c=a;t=t||{};const d=(0,s.g)(e),h=(0,s.b)(d,"color");if(h&&t.fieldInfo&&t.fieldInfo.field===h.field&&t.normalizationField===h.normalizationField&&(delete t.fieldInfos,(0,s.aw)(t)))return{renderer:d.clone()};const m=(0,s.d)(d,"color"),g=(0,s.at)(e,d),u=t.fieldInfos?t.fieldInfos[0]:h?{field:h.field,expression:h.valueExpression,expressionTitle:h.valueExpressionTitle,simpleFieldType:s.w.NUMBER}:{field:d.field,expression:d.valueExpression,expressionTitle:d.valueExpressionTitle,simpleFieldType:s.w.NUMBER},f=t.normalizationField?t.normalizationField:h?h.normalizationField:d.normalizationField,y=d.classBreakInfos?.length?d.classBreakInfos[0].symbol:null,S=d.defaultSymbol,b=d.defaultLabel;let C=!1;(null===t.normalizationField||t.normalizationField||t.fieldInfo)&&(C=!0);const v=t.discardMinMax?void 0:(0,i.i)(t.min)?t.min:C?void 0:m?m.minSliderValue:d.classBreakInfos[0].minValue,w=t.discardMinMax?void 0:(0,i.i)(t.max)?t.max:C?void 0:m?m.maxSliderValue:d.classBreakInfos[d.classBreakInfos.length-1].maxValue;return await o.ColorCreator.createContinuousRenderer({layer:c,view:l,field:u?u.field:d.field,theme:"above-and-below",colorScheme:(0,s.aD)(e,"above-and-below"),normalizationField:f,minValue:v,maxValue:w,outlineOptimizationEnabled:!r&&((0,i.i)(t.outlineOptimizationEnabled)?t.outlineOptimizationEnabled:!!g.sizeOutlineVisVar),sizeOptimizationEnabled:!r&&((0,i.i)(t.sizeOptimizationEnabled)?t.sizeOptimizationEnabled:!!g.sizeAutoVisVar),legendOptions:t.legendOptions?.toJSON()||h?.legendOptions?.toJSON()||d.legendOptions?.toJSON(),defaultSymbolEnabled:(0,i.i)(t.defaultSymbolEnabled)?t.defaultSymbolEnabled:!!d.defaultSymbol,forBinning:"binning"===c.featureReduction?.type&&n}).then((e=>{if(t.discardMinMax){const t=(0,s.b)(d,"color"),a=(0,s.b)(e.renderer,"color");t.stops.forEach(((e,t)=>e.value=a.stops[t].value));const i=!!m&&"percent"===m.style,n=!!m&&"percent-of-total"===m.style;t.stops[0].label=`< ${p(t.stops[0].value,i,n)}`,t.stops[2].label=p(t.stops[2].value,i,n),t.stops[4].label=`> ${p(t.stops[4].value,i,n)}`}return((0,s.d)(e.renderer,"color")||{}).style="ratio",(0,s.au)(g,e.renderer),y&&e.renderer.classBreakInfos?.length&&(e.renderer.classBreakInfos[0].symbol=y),S&&(e.renderer.defaultSymbol=S,e.renderer.defaultLabel=b),e}))}function p(e,t,a){return a?Math.round(e/(1+e)*1e4)/100+"%":t?Math.round(1e4*e)/100+"%":`${e}`}},18293:(e,t,a)=>{a.r(t),a.d(t,{arcgis_map_config_label:()=>z,arcgis_smart_mapping:()=>B,arcgis_smart_mapping_field_pick_list:()=>P,arcgis_smart_mapping_panels_assist:()=>ae,arcgis_smart_mapping_panels_gallery:()=>le,arcgis_smart_mapping_panels_raster_class_breaks:()=>oe,arcgis_smart_mapping_panels_raster_colormap:()=>ce,arcgis_smart_mapping_panels_raster_flow:()=>de,arcgis_smart_mapping_panels_raster_gallery:()=>he,arcgis_smart_mapping_panels_raster_rgb:()=>ge,arcgis_smart_mapping_panels_raster_shaded_relief:()=>be,arcgis_smart_mapping_panels_raster_stretch:()=>ve,arcgis_smart_mapping_panels_raster_unique_value:()=>we,arcgis_smart_mapping_panels_raster_vector_field:()=>Me});var s=a(11254),i=a(69811),n=a(10465),r=a(56612),l=a(17840),o=a(14528),c=a(84260),d=a(93345),p=a(39020),h=a(76744),m=a(35365),g=a(68474),u=a(19325),f=a(39715),y=a(73959),S=a(16029),b=a(1664),C=a(14143),v=a(53127),w=a(12317);async function M(e,t){const{layer:a,useFeatureReduction:s,mapImageSublayer:i,mapView:n,modules:r}=e,o=a;return t=t||{},await r.DotDensityCreator.createRenderer({layer:o,view:n,attributes:(0,l.i)(t.attributes)?t.attributes:I(e,t.fieldInfos),dotBlendingEnabled:!(0,l.i)(t.dotBlendingEnabled)||t.dotBlendingEnabled,dotValueOptimizationEnabled:!(0,l.i)(t.dotValueOptimizationEnabled)||t.dotValueOptimizationEnabled,outlineOptimizationEnabled:!i&&(!(0,l.i)(t.outlineOptimizationEnabled)||t.outlineOptimizationEnabled),legendOptions:t.legendOptions,forBinning:"binning"===o.featureReduction?.type&&s})}async function k(e,t){const{layer:a,mapImageSublayer:s,mapView:i,modules:n}=e,r=a;t=t||{};const o=(0,h.g)(e);return await n.DotDensityCreator.createRenderer({layer:r,view:i,attributes:t.attributes??o.attributes.map((e=>new n.AttributeColorInfo({field:e.field,label:e.label}))),dotBlendingEnabled:t.dotBlendingEnabled??o.dotBlendingEnabled,dotValueOptimizationEnabled:t.dotValueOptimizationEnabled??(0,l.i)(o.referenceScale),outlineOptimizationEnabled:!s&&(t.dotValueOptimizationEnabled??!0),legendOptions:t.legendOptions??o.legendOptions,forBinning:t.forBinning??"binning"===r.featureReduction?.type})}function I(e,t){return t.map((t=>({field:t.field,label:E(e,t.field)})))}function E(e,t){const a=e.fields.filter((e=>e.layerField.name===t));return a.length?a[0].label:""}async function N(e,t){t=t||{};const a=[],s=[];return a.push(t.fieldInfos[0]),a.push(t.fieldInfos[1]),s.push(t.fieldInfos[2]),function(e,t){if("relationship"===(0,h.k)(e)&&void 0===t.normalizationField1&&void 0===t.normalizationField2){const a=(0,h.g)(e).authoringInfo;if(t.fieldInfos&&t.fieldInfos.length>1&&t.fieldInfos[0].field===a.field1.field&&t.fieldInfos[1].field===a.field2.field)return!0}return!1}(e,t)?await R(e,(0,h.g)(e),s,t).then((e=>({renderer:e}))):await(0,b.c)(e,{...t,fieldInfos:a}).then((async a=>await R(e,a.renderer,s,t).then((e=>(a.renderer=e,a)))))}async function F(e,t,a){return t=t||{},await(0,y.c)(e,{...t,fieldInfos:t.fieldInfos?[t.fieldInfos[2]]:null}).then((async s=>await(0,b.a)(e,{...t,fieldInfos:t.fieldInfos?[t.fieldInfos[0],t.fieldInfos[1]]:null}).then((t=>(function(e,t,a){const{modules:s}=e;t.visualVariables=(0,h.a)(t,"size")||[],t.visualVariables=(0,h.a)(t,"size","auto")||[];const i=(0,h.b)(a,"size");t.visualVariables.push(i),t.authoringInfo=t.authoringInfo||new s.AuthoringInfo({}),t.authoringInfo.visualVariables=(0,h.c)(t,"size")||[];const n=(0,h.d)(a,"size");if(t.authoringInfo.visualVariables.push(n),(0,h.e)(e)){const s=a.classBreakInfos?.length?a.classBreakInfos[0].symbol:a.uniqueValueInfos?.length?a.uniqueValueInfos[0].symbol:(0,h.f)(e,"relationship-size"),i=t.uniqueValueInfos.slice();i.forEach((t=>{const a=(0,h.h)(e,t.symbol);t.symbol=s.clone(),(0,h.j)(e,t.symbol,a)})),t.uniqueValueInfos=i,t.backgroundFillSymbol=a.backgroundFillSymbol;const n=(0,h.b)(a,"size","outline");n&&t.visualVariables.push(n)}}(e,t.renderer,s.renderer),t.backgroundFillSymbol=(0,h.g)(e).backgroundFillSymbol,"size"===a&&(t.statistics=s.statistics),t)))))}async function R(e,t,a,s){const{modules:i}=e;return await(0,y.a)(e,{...s,fieldInfos:a}).then((a=>{const s=a.renderer;t.visualVariables=(0,h.a)(t,"size")||[],t.visualVariables=(0,h.a)(t,"size","auto")||[];const n=(0,h.b)(s,"size"),r=(0,h.d)(s,"reference-size"),l=(0,h.d)(s,"spike");r||l||t.visualVariables.push(n),t.authoringInfo.visualVariables=(0,h.c)(t,"size")||[];const o=(0,h.d)(s,"size");if(t.authoringInfo.visualVariables.push(o),(0,h.e)(e)||l){const a=s.classBreakInfos[0].symbol,n=[];t.uniqueValueInfos.forEach((e=>{n.push(i.esriLang.clone(e))})),n.forEach((e=>{t.removeUniqueValueInfo(e.value)})),n.forEach((s=>{const i=a.clone();(0,h.j)(e,i,(0,h.h)(e,s.symbol)),t.addUniqueValueInfo({value:s.value,symbol:i,label:s.label})})),t.backgroundFillSymbol=s.backgroundFillSymbol;const l=(0,h.b)(s,"size","outline");!r&&l&&t.visualVariables.push(l)}return t}))}async function T(e,t){const{layer:a,modules:s}=e,i=a,n=(0,h.m)(e),r="imagery"===i.type?i.rasterFunction:void 0;return await s.RasterClassBreaksCreator.createRenderer({layer:i,rasterFunction:r,field:t.field||n.field,classificationMethod:t.classificationMethod||n.authoringInfo.classificationMethod,numClasses:t.numClasses||n.classBreakInfos.length,colorRamp:n.authoringInfo.colorRamp,definedInterval:t.definedInterval}).then((e=>(e.renderer.classBreakInfos.forEach((e=>e.symbol.outline.width=0)),e)))}const z=class{constructor(e){(0,s.r)(this,e),this.arcgisChange=(0,s.c)(this,"arcgisChange",7),this.arcgisClose=(0,s.c)(this,"arcgisClose",7),this.manager=(0,o.u)(this),this.strings=(0,c.u)({blocking:!0}),this.mapView=void 0,this.layer=void 0,this.portal=void 0,this.layerDisplayType=r.l.feature,this.calciteFlowProps=void 0,this.dismissible=!1,this.hideLayerTitle=!1,this.labelClasses=[]}async done(){this.handleCloseLabelContentPopovers()}async setFocus(){this.flowItemNode?this.flowItemNode.setFocus():this.switchNode?.focus()}async componentWillLoad(){const{layer:e,layerDisplayType:t,calciteFlowProps:a}=this;await this.loadAllModules(),this.serviceType=(0,l.a)(e),this.layerGeometryType=await(0,l.b)(e),this.labelingInfo=t===r.l.feature?e.labelingInfo:e.featureReduction.labelingInfo,t===r.l.feature?e.labelsVisible=e.labelsVisible||!1:this.layerDisplayType===r.l.cluster&&(e.featureReduction.labelsVisible=e.featureReduction.labelsVisible||!1),a?.calciteFab&&!this.layerLabelsVisible()&&(a.calciteFab.hidden=!0)}componentDidLoad(){const{strings:e}=this;if(Array.isArray(this.labelingInfo)&&this.labelingInfo.forEach((e=>this.addLabelClass(e,1===this.labelingInfo.length))),this.calciteFlowProps&&!this.calciteFlowProps.calciteFab){const t=document.createElement("calcite-fab");t.icon="plus",t.slot="fab",t.scale="s",t.appearance="outline-fill",t.kind="neutral",t.label=e.addLabel,t.text=e.addLabel,t.textEnabled=!0,this.layerLabelsVisible()||(t.hidden=!0),this.calciteFlowProps.calciteFab=t,this.calciteFlowProps.calciteFlowItem.appendChild(t)}this.calciteFab=this.calciteFlowProps?.calciteFab??this.internalFabNode,this.calciteFab.addEventListener("click",(async e=>{e.stopPropagation(),this.handleCloseLabelContentPopovers();const t=await this.getLabelClass();this.labelingInfo?this.labelingInfo.push(t):this.labelingInfo=[t],this.addLabelClass(t,!0),this.focusLastLabelClass()})),this.flowItemNode?.setFocus()}componentDidUpdate(){this.handleInternalLabelUpdate()}disconnectedCallback(){this.calciteFab?.parentElement?.removeChild(this.calciteFab),this.calciteFab=void 0}render(){const{strings:e,layer:t,calciteFlowProps:a,hideLayerTitle:i,dismissible:n}=this;return(0,s.h)(s.H,{key:"24fff59bb1ab562a69c10d3bd4fada199dd52f60",class:"calcite-match-height"},a?(0,s.h)("div",null,this.renderSwitch(),this.renderLabelClasses()):(0,s.h)("calcite-flow",null,(0,s.h)("calcite-flow-item",{heading:e.labelFeatures,description:i?void 0:t.title??void 0,closable:n,onCalciteFlowItemClose:e=>{e.stopPropagation(),this.handleCloseLabelContentPopovers(),this.arcgisClose.emit()},ref:e=>this.flowItemNode=e},this.renderSwitch(),this.renderLabelClasses(),this.renderFab())))}renderSwitch(){const{strings:e,layer:t,layerDisplayType:a}=this;return(0,s.h)("calcite-label",{class:"enable-label",alignment:"start",layout:"inline-space-between"},e.enableLabels,(0,s.h)("calcite-switch",{ref:e=>this.switchNode=e,scale:"s",class:"label-switch",checked:this.layerLabelsVisible(),onCalciteSwitchChange:e=>{const s=e.target.checked;switch(a){case r.l.feature:t.labelsVisible=s;break;case r.l.cluster:t.featureReduction.labelsVisible=s;break;default:t.labelsVisible=s}this.enableLabel(s),this.handleInternalLabelUpdate(!0)}}))}renderLabelClasses(){return(0,s.h)("div",{class:"label-classes-wrapper",hidden:!this.layerLabelsVisible(),ref:e=>this.labelWrapperNode=e},this.labelClasses)}renderLabelClass(e,t){const{strings:a,mapView:i,layer:r,portal:l,calciteFlowProps:o,layerDisplayType:c,serviceType:d}=this;return(0,s.h)("arcgis-map-config-label-content",{key:(0,n.a)(),labelClass:e,blockOpen:t,strings:a,mapView:i,layer:r,portal:l,calciteFlowItem:o?.calciteFlowItem??this.flowItemNode,layerDisplayType:c,serviceType:d,onArcgisDisablePanel:e=>{e.stopPropagation();(this.calciteFlowProps?.calciteFlowItem??this.flowItemNode).disabled=e.detail},onArcgisDelete:e=>{this.handleCloseLabelContentPopovers();const t=this.el.shadowRoot.querySelectorAll("arcgis-map-config-label-content"),a=e.target,i=Array.from(t).indexOf(a);this.labelingInfo.splice(i,1),this.labelClasses.splice(i,1),this.calciteFab?.setFocus(),(0,s.f)(this.el)},onArcgisDuplicate:e=>{this.handleCloseLabelContentPopovers();const t=this.el.shadowRoot.querySelectorAll("arcgis-map-config-label-content"),a=e.target,i=Array.from(t).indexOf(a),n=this.labelingInfo[i].clone();this.labelingInfo.push(n),this.addLabelClass(n,!0),this.focusLastLabelClass(),(0,s.f)(this.el)},onArcgisChange:e=>{e.stopPropagation(),this.handleInternalLabelUpdate()}})}renderFab(){const{strings:e}=this;return(0,s.h)("calcite-fab",{hidden:!this.layerLabelsVisible(),icon:"plus",slot:"fab",scale:"s",appearance:"outline-fill",kind:"neutral",label:e.addLabel,text:e.addLabel,textEnabled:!0,ref:e=>this.internalFabNode=e})}async loadAllModules(){const[e,t,a,s]=await Promise.all([(0,i.L)(),(0,i.y)(),(0,i.c)(),(0,i.d)()]);this.modules={LabelClass:e,colorUtils:t,clusterLabelCreator:a,binLabelCreator:s}}layerLabelsVisible(){const{layerDisplayType:e}=this;switch(e){case r.l.feature:return this.layer.labelsVisible;case r.l.cluster:return this.layer.featureReduction.labelsVisible;default:return this.layer.labelsVisible}}enableLabel(e){this.labelWrapperNode.style.display=e?"block":"none",this.calciteFab.style.display=e?"block":"none",this.handleCloseLabelContentPopovers()}async getLabelClass(){const{mapView:e,modules:t,layer:a,layerDisplayType:s}=this;if(s===r.l.feature){const a=this.getDefaultSymbolProps(await t.colorUtils.getBackgroundColor(e),await t.colorUtils.getBackgroundColorTheme(e));return new t.LabelClass(this.getDefaultLabelProps(a))}return"binning"===a.featureReduction?.type?(await t.binLabelCreator.getLabelSchemes({layer:a}))?.primaryScheme?.labelingInfo[0]??void 0:(await t.clusterLabelCreator.getLabelSchemes({layer:a,renderer:a?.renderer,view:e}))?.primaryScheme?.labelingInfo[0]??void 0}getDefaultLabelProps(e){const{layer:t,layerDisplayType:a,serviceType:s}=this,i=this.getDefaultFieldName(),n=t.fields.find((e=>e.name===i)),l="coded-value"===n?.domain?.type;return{labelExpression:s===r.s.mapImage?`[${i}]`:null,labelExpressionInfo:a===r.l.cluster?{expression:`$feature["${i}"]`}:s!==r.s.mapImage?{expression:i?l?`$feature["${i}"]\nDomainName($feature, "${i}")`:`$feature["${i}"]`:null}:null,labelPlacement:this.getDefaultPlacement(),minScale:t.minScale||0,maxScale:t.maxScale||0,symbol:{color:e.fontColor,haloColor:e.haloColor,haloSize:e.haloSize,font:{family:e.fontFamily,size:e.fontSize},type:"text"}}}getDefaultSymbolProps(e,t){return"light"===t?{fontFamily:"Arial",fontSize:9.75,fontColor:"#262626",haloColor:"#f7f7f7",haloSize:.75}:"dark"===t?{fontFamily:"Arial",fontSize:9.75,fontColor:"#f7f7f7",haloColor:"#262626",haloSize:.75}:{fontFamily:"Arial",fontSize:9.75,fontColor:e.toHex()||"#262626",haloColor:"#f7f7f7",haloSize:.75}}getDefaultFieldName(){const{layer:e,layerDisplayType:t}=this;let a=null;if(t===r.l.cluster)a=e.featureReduction.fields[0].name;else if("displayField"in e&&"fieldsIndex"in e&&e.displayField&&e.fieldsIndex.get(e.displayField))a=e.displayField;else{const t=e.fields.find((e=>"string"===e.type));t&&(a=t.name)}return a??e.fields[0].name}getDefaultPlacement(){const{layer:e,layerDisplayType:t,layerGeometryType:a}=this;return t===r.l.cluster&&"binning"===e.featureReduction?.type?"always-horizontal":"point"===a||"multipoint"===a?"above-center":"polyline"===a?"center-along":"polygon"===a?"always-horizontal":void 0}addLabelClass(e,t=!1){this.labelClasses=[...this.labelClasses,this.renderLabelClass(e,t)]}focusLastLabelClass(){setTimeout((()=>{const e=this.el.shadowRoot.querySelectorAll("arcgis-map-config-label-content");e?.length&&e[e.length-1].setFocus()}),200)}handleInternalLabelUpdate(e){const{layerDisplayType:t}=this;this.labelingInfo&&!e&&(t===r.l.feature?this.layer.labelingInfo=[...this.labelingInfo]:this.layer.featureReduction.labelingInfo=[...this.labelingInfo]),this.arcgisChange.emit()}handleCloseLabelContentPopovers(){this.el.shadowRoot.querySelectorAll("arcgis-map-config-label-content").forEach((e=>e.closeAllPopovers()))}static get assetsDirs(){return["assets"]}get el(){return(0,s.a)(this)}};z.style=".enable-label{background-color:var(--calcite-color-foreground-1);border-bottom:solid 1px var(--calcite-color-foreground-3);display:flex;padding:var(--calcite-spacing-lg) var(--calcite-spacing-sm) var(--calcite-spacing-xxs)}.label-switch{flex:0 0 0%;margin:0;justify-self:flex-end}.label-classes-wrapper{margin:0 0 var(--calcite-spacing-lg);padding:0}";const B=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisClose=(0,s.c)(this,"arcgisClose",7),this.arcgisSmartMappingClose=(0,s.c)(this,"arcgisSmartMappingClose",7),this.arcgisBeforeBack=(0,s.c)(this,"arcgisBeforeBack",7),this.arcgisSmartMappingBeforeBack=(0,s.c)(this,"arcgisSmartMappingBeforeBack",7),this.arcgisError=(0,s.c)(this,"arcgisError",7),this.arcgisSmartMappingError=(0,s.c)(this,"arcgisSmartMappingError",7),this.arcgisClusterRequiresUpdate=(0,s.c)(this,"arcgisClusterRequiresUpdate",7),this.arcgisSmartMappingClusterRequiresUpdate=(0,s.c)(this,"arcgisSmartMappingClusterRequiresUpdate",7),this.arcgisArcadeTimeExpressionChange=(0,s.c)(this,"arcgisArcadeTimeExpressionChange",7),this.arcgisLoaded=(0,s.c)(this,"arcgisLoaded",7),this.arcgisSmartMappingLoaded=(0,s.c)(this,"arcgisSmartMappingLoaded",7),this.manager=(0,o.u)(this),this.closedViaEvent=!1,this.allFlowItemComponents="arcgis-smart-mapping,\n      arcgis-smart-mapping-panels-gallery,\n      arcgis-smart-mapping-panels-assist,\n      arcgis-smart-mapping-panels-simple,\n      arcgis-smart-mapping-panels-heatmap,\n      arcgis-smart-mapping-panels-predominance,\n      arcgis-smart-mapping-panels-predominance-size,\n      arcgis-smart-mapping-panels-relationship,\n      arcgis-smart-mapping-panels-relationship-size,\n      arcgis-smart-mapping-panels-size,\n      arcgis-smart-mapping-panels-chart,\n      arcgis-smart-mapping-panels-chart-size,\n      arcgis-smart-mapping-panels-color,\n      arcgis-smart-mapping-panels-color-size,\n      arcgis-smart-mapping-panels-color-size-univariate,\n      arcgis-smart-mapping-panels-compare,\n      arcgis-smart-mapping-panels-dot-density,\n      arcgis-smart-mapping-panels-type,\n      arcgis-smart-mapping-panels-type-size,\n      arcgis-smart-mapping-panels-raster-gallery,\n      arcgis-smart-mapping-panels-raster-flow,\n      arcgis-smart-mapping-panels-raster-vector-field,\n      arcgis-smart-mapping-panels-raster-stretch,\n      arcgis-smart-mapping-panels-raster-rgb,\n      arcgis-smart-mapping-panels-raster-shaded-relief,\n      arcgis-smart-mapping-panels-raster-class-breaks,\n      arcgis-smart-mapping-panels-raster-colormap,\n      arcgis-smart-mapping-panels-raster-unique-value",this.strings=(0,c.u)({blocking:!0}),this.smartMappingState=(0,m.u)(),this.portal=void 0,this.config=void 0,this.mapView=void 0,this.layer=void 0,this.useFeatureReduction=!1,this.skipGallery=!1,this.stylePart=void 0,this.hideLayerTitle=!1,this.symbolStylerConfig={},this.selected=!1,this.store=(0,d.c)({selectedFields:[],hideLayerTitle:!1,supportsArcade:!1,stringFieldsCount:-1,dateFieldsCount:-1,numberFieldsCount:-1,isRTL:!1,containsFlow:!0,oneFeatureResponseStatus:h.s.MISSING,symbolStylerConfig:{},modules:{}})}arcgisCloseHandler(){this.closedViaEvent=!0}smartMappingCompleteCloseHandler(e){this.arcgisClose.emit(e.detail),this.arcgisSmartMappingClose.emit(e.detail)}async setFocus(){await(this.flowNode?.setFocus())}async componentWillLoad(){const{mapView:e,layer:t,smartMappingState:a}=this;if(!t||!e)return;if(a.layer=t,a.mapView=e,a.symbolStylerConfig=this.symbolStylerConfig,await async function(e){if((0,h.i)(e)){const[t,a,s,n,r,l,o,c,d,p,h,m,g,u,f,y,S,b,C,v,w,M,k,I,E,N,F,R,T,z,B]=await Promise.all([(0,i.H)(),(0,i.az)(),(0,i.aA)(),(0,i.aI)(),(0,i.aY)(),(0,i.aZ)(),(0,i.a_)(),(0,i.a$)(),(0,i.b0)(),(0,i.b1)(),(0,i.b2)(),(0,i.b3)(),(0,i.b4)(),(0,i.b5)(),(0,i.ab)(),(0,i.b6)(),(0,i.b7)(),(0,i.y)(),(0,i.b8)(),(0,i.b9)(),(0,i.ba)(),(0,i.bb)(),(0,i.bc)(),(0,i.bd)(),(0,i.o)(),(0,i.j)(),(0,i.aD)(),(0,i.ah)(),(0,i.be)(),(0,i.a4)(),(0,i.z)()]);e.modules={Field:t,SimpleMarkerSymbol:a,SimpleLineSymbol:s,SimpleFillSymbol:n,RasterFlowCreator:r,RasterVectorFieldCreator:l,RasterStretchCreator:o,RasterRGBCreator:c,RasterShadedReliefCreator:d,RasterClassBreaksCreator:p,RasterColormapCreator:h,RasterUniqueValueCreator:m,rasterColorRampUtils:g,RasterPresetRenderer:u,EsriColor:f,typeSchemes:y,colorSchemes:S,colorUtils:b,flowSchemes:C,MultipartColorRamp:v,AlgorithmicColorRamp:w,ColorSlider:M,ClassedColorSlider:k,Slider:I,esriLang:E,esriConfig:N,fieldUtils:F,previewSymbol2D:R,smartMappingRasterUtils:T,symbolUtils:z,intl:B}}else{const[t,a,s,n,r,l,o,c,d,p,h,m,g,u,f,y,S,b,C,v,w,M,k,I,E,N,F,R,T,z,B,P,x,L,A,D,O,V,U,q,_,G,H,$,j,W,J,K,Y,Q,Z,X,ee,te,ae,se,ie,ne,re,le,oe,ce,de,pe,he,me,ge,ue,fe]=await Promise.all([(0,i.bf)(),(0,i.bg)(),(0,i.bh)(),(0,i.r)(),(0,i.u)(),(0,i.t)(),(0,i.q)(),(0,i.bi)(),(0,i.az)(),(0,i.aA)(),(0,i.aI)(),(0,i.F)(),(0,i.bj)(),(0,i.H)(),(0,i.z)(),(0,i.bk)(),(0,i.g)(),(0,i.h)(),(0,i.bl)(),(0,i.bm)(),(0,i.bn)(),(0,i.bo)(),(0,i.bp)(),(0,i.bq)(),(0,i.br)(),(0,i.bs)(),(0,i.ab)(),(0,i.b6)(),(0,i.bt)(),(0,i.bu)(),(0,i.bv)(),(0,i.aT)(),(0,i.b7)(),(0,i.bw)(),(0,i.y)(),(0,i.ay)(),(0,i.bx)(),(0,i.aP)(),(0,i.aQ)(),(0,i.by)(),(0,i.bz)(),(0,i.bA)(),(0,i.bB)(),(0,i.bC)(),(0,i.bD)(),(0,i.bE)(),(0,i.bF)(),(0,i.bG)(),(0,i.bH)(),(0,i.bb)(),(0,i.bc)(),(0,i.bI)(),(0,i.bJ)(),(0,i.bK)(),(0,i.bL)(),(0,i.bd)(),(0,i.o)(),(0,i.j)(),(0,i.ag)(),(0,i.p)(),(0,i.aD)(),(0,i.bM)(),(0,i.am)(),(0,i.ah)(),(0,i.l)(),(0,i.aE)(),(0,i.aU)(),(0,i.a4)(),(0,i.bN)()]);e.modules={AuthoringInfo:t,SimpleRenderer:a,AttributeColorInfo:s,Point:n,Polyline:r,Polygon:l,Graphic:o,SpatialReference:c,SimpleMarkerSymbol:d,SimpleLineSymbol:p,SimpleFillSymbol:h,Query:m,FeatureSet:g,Field:u,intl:f,OpacityVariableCreator:y,PieChartCreator:S,ColorCreator:b,UnivariateColorSizeCreator:C,DotDensityCreator:v,HeatmapCreator:w,LocationCreator:M,PredominanceCreator:k,RelationshipCreator:I,SizeCreator:E,TypeCreator:N,EsriColor:F,typeSchemes:R,heatmapSchemes:T,relationshipSchemes:z,predominanceSchemes:B,pieChartSchemes:P,colorSchemes:x,dotDensitySchemes:L,colorUtils:A,rendererUtils:D,heatmapStatistics:O,summaryStatistics:V,histogram:U,predominantCategories:q,SizeStop:_,RotationVariable:G,SizeVariable:H,HeatmapColorStop:$,UniqueValue:j,UniqueValueClass:W,UniqueValueGroup:J,OpacitySlider:K,HeatmapSlider:Y,ColorSlider:Q,ClassedColorSlider:Z,SizeSlider:X,ClassedSizeSlider:ee,ColorSizeSlider:te,BinaryColorSizeSlider:ae,Slider:se,esriLang:ie,esriConfig:ne,urlUtils:re,esriRequest:le,fieldUtils:oe,smartMappingUtils:ce,cimSymbolUtils:de,previewSymbol2D:pe,reactiveUtils:he,rendererJsonUtils:me,rendererSupportUtils:ge,symbolUtils:ue,spikeUtils:fe}}}(a),"esri.layers.support.Sublayer"===t.declaredClass){let s=!1;const i=t.layer.sourceJSON?.cimVersion;if(i){const e=i.split("."),a=Number.parseFloat(1===e.length?i:`${e[0]}.${e[1]}`);s=t.layer.version>=10.51&&a>=1.4}a.mapImageSublayer=t,delete a.layer,await a.modules.reactiveUtils.whenOnce((()=>!e.updating)).then((async()=>{await a.mapImageSublayer.createFeatureLayer().then((async e=>{this.layer=e,await e.load().then((async()=>{await this.loadStore(),a.supportsArcade=s,await this.processLayer()}))}))}))}else a.mapImageSublayer=void 0,await this.loadStore(),await this.processLayer();const s=(0,p.f)(this.el,"calcite-flow");s&&(a.containsFlow=!1,this.flowNode=s)}async componentDidLoad(){if(!this.smartMappingState?.containsFlow&&this.selected){const e=Array.from(this.el.childNodes);e[e.length-1].selected=!0}this.arcgisLoaded.emit(),this.arcgisSmartMappingLoaded.emit()}disconnectedCallback(){this.closedViaEvent||(this.arcgisClose.emit("save"),this.arcgisSmartMappingClose.emit("save"))}async loadStore(){const{smartMappingState:e}=this;(0,m.c)(e);const{portal:t,config:a,mapView:s,layer:i,hideLayerTitle:r,useFeatureReduction:l,symbolStylerConfig:o}=this;e.portal=t,e.config=a,e.mapView=s,e.layer=i,e.hideLayerTitle=!!r,e.strings=this.strings,e.isRTL="rtl"===(0,n.b)(this.el),e.useFeatureReduction=l,e.symbolStylerConfig=o}render(){const{smartMappingState:e}=this,{containsFlow:t}=e;return(0,s.h)(s.H,{key:"d97d2195cb68c520683e721e7f308983cf638c2d",class:"calcite-match-height"},t?(0,s.h)("calcite-flow",{class:"flow",ref:e=>this.flowNode=e,customItemSelectors:this.allFlowItemComponents},this.renderContent()):this.renderContent())}renderContent(){const{skipGallery:e,smartMappingState:t}=this,{layer:a,containsFlow:i}=t;return e?this.renderSkipGallery():"geo-rss"===a.type?(0,s.h)("arcgis-smart-mapping-panels-simple",{selected:this.selected,onArcgisSmartMappingPanelsSimpleClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsSimpleBackClick:()=>{this.arcgisClose.emit("save"),this.arcgisSmartMappingClose.emit("save")}}):(0,h.i)(t)?(0,s.h)("arcgis-smart-mapping-panels-raster-gallery",{selected:this.selected,onArcgisSmartMappingPanelsRasterGalleryClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRasterGalleryError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):(0,s.h)("arcgis-smart-mapping-panels-gallery",{showBackButton:!i,selected:this.selected,beforeBack:async()=>{i||(this.arcgisBeforeBack.emit("save"),this.arcgisSmartMappingBeforeBack.emit("save"))},onArcgisSmartMappingPanelsGalleryClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsGalleryError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)},onArcgisSmartMappingPanelsGalleryClusterRequiresUpdate:()=>{this.arcgisClusterRequiresUpdate.emit(),this.arcgisSmartMappingClusterRequiresUpdate.emit()},onArcgisSmartMappingPanelsGalleryArcadeTimeExpressionChange:()=>this.arcgisArcadeTimeExpressionChange.emit()})}renderSkipGallery(){const{originalRendererJSON:e,originalFeatureReduction:t,stylePart:a,smartMappingState:i}=this;switch((0,h.i)(i)?(0,h.n)(i):(0,h.k)(i)){case"simple":return(0,s.h)("arcgis-smart-mapping-panels-simple",{selected:this.selected,onArcgisSmartMappingPanelsSimpleClose:({detail:a})=>{"cancel"===a&&e&&(0,h.v)(i,e,t),this.arcgisClose.emit(a),this.arcgisSmartMappingClose.emit(a)},onArcgisSmartMappingPanelsSimpleError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"heatmap":return(0,s.h)("arcgis-smart-mapping-panels-heatmap",{selected:this.selected,onArcgisSmartMappingPanelsHeatmapClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsHeatmapError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"color":case"color-age":return(0,s.h)("arcgis-smart-mapping-panels-color",{selected:this.selected,onArcgisSmartMappingPanelsColorClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsColorError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"size":case"size-age":return(0,s.h)("arcgis-smart-mapping-panels-size",{selected:this.selected,onArcgisSmartMappingPanelsSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"color-size":case"color-age-size":case"color-size-age":{const e=(0,h.g)(i),t=(0,h.b)(e,"color"),n=(0,h.b)(e,"size");return t.field===n.field&&t.valueExpression===n.valueExpression&&t.valueExpressionTitle===n.valueExpressionTitle?(0,s.h)("arcgis-smart-mapping-panels-color-size-univariate",{selected:this.selected,onArcgisSmartMappingPanelsColorSizeUnivariateClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsColorSizeUnivariateError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):"color"===a?(0,s.h)("arcgis-smart-mapping-panels-color",{selected:this.selected,onArcgisSmartMappingPanelsColorClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsColorError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):"size"===a?(0,s.h)("arcgis-smart-mapping-panels-size",{selected:this.selected,onArcgisSmartMappingPanelsSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):(0,s.h)("arcgis-smart-mapping-panels-color-size",{selected:this.selected,onArcgisSmartMappingPanelsColorSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsColorSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}})}case"compare":return(0,s.h)("arcgis-smart-mapping-panels-compare",{selected:this.selected,onArcgisSmartMappingPanelsCompareClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsCompareError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"dot-density":return(0,s.h)("arcgis-smart-mapping-panels-dot-density",{selected:this.selected,onArcgisSmartMappingPanelsDotDensityClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)}});case"relationship":return(0,s.h)("arcgis-smart-mapping-panels-relationship",{selected:this.selected,onArcgisSmartMappingPanelsRelationshipClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRelationshipError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"relationship-size":return"color"===a?(0,s.h)("arcgis-smart-mapping-panels-relationship",{selected:this.selected,onArcgisSmartMappingPanelsRelationshipClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRelationshipError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):"size"===a?(0,s.h)("arcgis-smart-mapping-panels-size",{selected:this.selected,onArcgisSmartMappingPanelsSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):(0,s.h)("arcgis-smart-mapping-panels-relationship-size",{selected:this.selected,onArcgisSmartMappingPanelsRelationshipSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRelationshipSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"predominance":return(0,s.h)("arcgis-smart-mapping-panels-predominance",{selected:this.selected,onArcgisSmartMappingPanelsPredominanceClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsPredominanceError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"predominance-size":return"color"===a?(0,s.h)("arcgis-smart-mapping-panels-predominance",{selected:this.selected,onArcgisSmartMappingPanelsPredominanceClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsPredominanceError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):"size"===a?(0,s.h)("arcgis-smart-mapping-panels-size",{selected:this.selected,onArcgisSmartMappingPanelsSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):(0,s.h)("arcgis-smart-mapping-panels-predominance-size",{selected:this.selected,onArcgisSmartMappingPanelsPredominanceSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsPredominanceSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"chart":return(0,s.h)("arcgis-smart-mapping-panels-chart",{selected:this.selected,onArcgisSmartMappingPanelsChartClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsChartError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"chart-size":return"color"===a?(0,s.h)("arcgis-smart-mapping-panels-chart",{selected:this.selected,onArcgisSmartMappingPanelsChartClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsChartError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):"size"===a?(0,s.h)("arcgis-smart-mapping-panels-size",{selected:this.selected,onArcgisSmartMappingPanelsSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):(0,s.h)("arcgis-smart-mapping-panels-chart-size",{selected:this.selected,onArcgisSmartMappingPanelsChartSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsChartSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"type":return(0,s.h)("arcgis-smart-mapping-panels-type",{selected:this.selected,onArcgisSmartMappingPanelsTypeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsTypeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"type-size":return"color"===a?(0,s.h)("arcgis-smart-mapping-panels-type",{selected:this.selected,onArcgisSmartMappingPanelsTypeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsTypeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):"size"===a?(0,s.h)("arcgis-smart-mapping-panels-size",{selected:this.selected,onArcgisSmartMappingPanelsSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}}):(0,s.h)("arcgis-smart-mapping-panels-type-size",{selected:this.selected,onArcgisSmartMappingPanelsTypeSizeClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsTypeSizeError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"raster-flow":return(0,s.h)("arcgis-smart-mapping-panels-raster-flow",{selected:this.selected,onArcgisSmartMappingPanelsRasterFlowClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRasterFlowError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"raster-vector-field":return(0,s.h)("arcgis-smart-mapping-panels-raster-vector-field",{selected:this.selected,onArcgisSmartMappingPanelsRasterVectorFieldClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRasterVectorFieldError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"raster-stretch":return(0,s.h)("arcgis-smart-mapping-panels-raster-stretch",{selected:this.selected,onArcgisSmartMappingPanelsRasterStretchClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRasterStretchError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"raster-rgb":return(0,s.h)("arcgis-smart-mapping-panels-raster-rgb",{selected:this.selected,onArcgisSmartMappingPanelsRasterRgbClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRasterRgbError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"raster-shaded-relief":return(0,s.h)("arcgis-smart-mapping-panels-raster-shaded-relief",{selected:this.selected,onArcgisSmartMappingPanelsRasterShadedReliefClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRasterShadedReliefError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"raster-class-breaks":return(0,s.h)("arcgis-smart-mapping-panels-raster-class-breaks",{selected:this.selected,onArcgisSmartMappingPanelsRasterClassBreaksClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRasterClassBreaksError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});case"raster-colormap":return(0,s.h)("arcgis-smart-mapping-panels-raster-colormap",{selected:this.selected,onArcgisSmartMappingPanelsRasterColormapClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)}});case"raster-unique-value":return(0,s.h)("arcgis-smart-mapping-panels-raster-unique-value",{selected:this.selected,onArcgisSmartMappingPanelsRasterUniqueValueClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsRasterUniqueValueError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}});default:return(0,s.h)("arcgis-smart-mapping-panels-simple",{selected:this.selected,onArcgisSmartMappingPanelsSimpleClose:({detail:e})=>{this.arcgisClose.emit(e),this.arcgisSmartMappingClose.emit(e)},onArcgisSmartMappingPanelsSimpleError:({detail:e})=>{this.arcgisError.emit(e),this.arcgisSmartMappingError.emit(e)}})}}async processLayer(){const{smartMappingState:e}=this,{layer:t,strings:a,modules:s}=e;let i=(0,h.g)(e);if(t&&(0,h.i)(e)&&(e.rasterInfo=await(0,h.o)(t)),!i&&(0,h.i)(e)&&(i=await(0,h.p)(e)),"geo-rss"===t.type)return;const n=(0,h.i)(e)?(0,h.n)(e):(0,h.k)(e);e.oneFeatureResponseStatus=h.s.MISSING,"color"!==n||i.authoringInfo||(0,h.b)(i,"color")?"size"!==n||i.authoringInfo||(0,h.b)(i,"size")||(i.authoringInfo={classificationMethod:"manual",type:"class-breaks-size"}):i.authoringInfo={classificationMethod:"manual",type:"class-breaks-color"},await(0,h.q)(e).then((async()=>{if("unknown"===n)console.log("unsupported renderer",i),this.switchToSimpleRenderer(i);else{const t=await s.fieldUtils.getRendererFields(i),n=t?.some((t=>!e.layerFields?.some((e=>e.name.toLowerCase()===t.toLowerCase()))));!(0,h.i)(e)&&n?this.switchToSimpleRenderer(i):(e.selectedFields=(0,h.r)(e),e.selectedFields.forEach((e=>{e.expression&&!e.expressionTitle&&(e.expressionTitle=a.expression)})))}}))}switchToSimpleRenderer(e){const{smartMappingState:t}=this,{layer:a,modules:s}=t;this.originalRendererJSON=e.toJSON(),this.originalFeatureReduction="featureReduction"in a&&a.featureReduction?s.esriLang.clone(a.featureReduction):void 0,(0,g.c)(t).then((e=>{(0,h.t)(t,e.renderer),t.selectedFields=[]})).catch((e=>console.log(e)))}static get assetsDirs(){return["assets"]}get el(){return(0,s.a)(this)}};B.style=".sc-arcgis-smart-mapping-h{height:100%;width:100%}.flow.sc-arcgis-smart-mapping{height:100%}";const P=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingFieldPickListClose=(0,s.c)(this,"arcgisSmartMappingFieldPickListClose",7),this.arcgisSmartMappingFieldPickListChange=(0,s.c)(this,"arcgisSmartMappingFieldPickListChange",7),this.arcgisSmartMappingFieldPickListSortByChange=(0,s.c)(this,"arcgisSmartMappingFieldPickListSortByChange",7),this.manager=(0,o.u)(this),this.maxNumberFieldCount=10,this.selectedFields=[],this.fields=void 0,this.fieldToReplace=void 0,this.popoverProps=void 0,this.singleEditMode=!1,this.heading=void 0,this.okBtnText=void 0,this.filterPlaceholderText=void 0,this.lastSortBy="default",this.smartMappingState=void 0,this.filterFields=void 0,this.isOpen=!1,this.width=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async reposition(){await(this.popoverNode?.reposition())}async componentWillLoad(){this.isOpen=!0,this.rendererFieldInfosMap=this.smartMappingState.selectedFields?.reduce(((e,t)=>(e[t.field]=t,e)),{})}componentDidLoad(){this.setUpObservers(),this.resizeObserver?.observe(this.popoverProps.refElement);this.checkDisabledListItems().forEach((e=>this.listNode.removeChild(e))),requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}disconnectedCallback(){this.mutationObserver?.disconnect(),this.resizeObserver?.unobserve(this.popoverProps.refElement)}render(){const e=this.popoverProps,{isRTL:t,strings:a}=this.smartMappingState;return(0,s.h)(s.H,{key:"3cb65e97c9500c86b025c08bf2f7f8e1453a4be3",class:"js-app-flyout"},(0,s.h)("calcite-popover",{key:"532dd71cb7685b6795481503574c9d107a4f7880",dir:t?"rtl":"ltr",class:"smart-mapping-field-pick-list-popover",placement:e.placement||"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:e.refElement,offsetDistance:e.offsetDistance??-1*(e.popoverWidth??this.width)+10,offsetSkidding:e.offsetSkidding||0,overlayPositioning:e.overlayPositioning,triggerDisabled:!0,label:this.heading||(this.singleEditMode?a.replaceField:a.fieldPickList.selectFields),ref:e=>this.popoverNode=e},(0,s.h)("calcite-flow",{key:"40b43c05774fe4b8f0d7b25e236e3118e7faddc0",ref:e=>this.flowNode=e,style:{width:`${this.width||e.popoverWidth}px`}},(0,s.h)("calcite-flow-item",{key:"aea0299de55381c8d6ed818fdf93bb0c0cae5083",ref:e=>this.flowItemNode=e,class:"panel",heading:this.heading||(this.singleEditMode?a.replaceField:a.fieldPickList.selectFields),closable:!0,onCalciteFlowItemClose:()=>this.arcgisSmartMappingFieldPickListClose.emit()},!this.singleEditMode&&this.renderAddButton(),this.renderCancelButton(),this.renderList()))))}renderAddButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",appearance:"solid",width:"half",onClick:()=>this.arcgisSmartMappingFieldPickListClose.emit({selectedFields:this.selectedFields})},this.okBtnText||e.add)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",appearance:"outline-fill",width:this.singleEditMode?"full":"half",onClick:()=>this.arcgisSmartMappingFieldPickListClose.emit()},e.cancel)}renderList(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-list",{label:e.fieldPickList.fields,selectionMode:this.singleEditMode?"single-persist":"multiple",ref:e=>this.listNode=e,class:"content",filterEnabled:this.fields.length>=10,filterPlaceholder:this.filterPlaceholderText??e.fieldPickList.searchFields,onCalciteListFilter:()=>{this.filterFields=this.listNode?.filteredItems?.map((e=>e.value))}},this.renderSortDropdown(),this.renderListItems())}renderListItems(){return"type"===this.lastSortBy?this.renderItemsSortedByType():["display","field"].includes(this.lastSortBy)?[...this.getSortedList()].map((e=>this.renderListItem(e))):[...this.fields].map((e=>this.renderListItem(e)))}renderItemsSortedByType(){const e=[...this.getSortedList()];return e.filter((e=>e.simpleFieldType===h.w.NUMBER)).map((e=>this.renderListItem(e))).concat(e.filter((e=>e.simpleFieldType===h.w.STRING)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===h.w.DATE)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===h.w.OID)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===h.w.GUID)).map((e=>this.renderListItem(e)))).concat(e.filter((e=>e.simpleFieldType===h.w.UNKNOWN)).map((e=>this.renderListItem(e))))}renderListItem(e){const{layer:t,useFeatureReduction:a,mapView:i,strings:n}=this.smartMappingState,r="featureReduction"in t&&"binning"===t.featureReduction?.type&&a;return(0,s.h)("calcite-list-item",{key:e.layerField.name,label:e.label||e.layerField.name,"data-type":e.simpleFieldType,value:e.layerField.name,selected:this.singleEditMode&&e.layerField.name===this.fieldToReplace.field,metadata:{label:e.label,fieldName:e.layerField.name},onCalciteListItemSelect:()=>{this.selectedFields=this.listNode.selectedItems.map((e=>e.value)),this.singleEditMode?this.selectedFields[0]!==this.fieldToReplace.field&&this.arcgisSmartMappingFieldPickListClose.emit({selectedFields:this.selectedFields}):(this.checkDisabledListItems(),this.arcgisSmartMappingFieldPickListChange.emit({selectedFields:this.selectedFields}))}},!r&&(0,s.h)("calcite-action",{slot:"actions-end",text:n.fieldPickList.info,scale:"s",icon:"information",onClick:a=>{a.stopPropagation();const s=a.target,n=document.createElement("calcite-flow-item");n.heading=e.label??e.layerField.name,n.description=e.layerField.name;const r=document.createElement("arcgis-field-info");r.fieldName=e.layerField.name,r.layer=t,r.view=i,r.classList.add("content"),n.appendChild(r),n.addEventListener("calciteFlowItemBack",(()=>{requestAnimationFrame((async()=>await s.setFocus())),n.removeChild(r),this.flowNode.removeChild(n),this.flowItemNode.selected=!0})),this.flowNode.appendChild(n),n.selected=!0,this.flowItemNode.selected=!1,requestAnimationFrame((async()=>await n.setFocus()))}}))}renderSortDropdown(){const{strings:e}=this.smartMappingState;return this.fields.length>10?(0,s.h)("calcite-dropdown",{placement:"bottom-end",overlayPositioning:"fixed",slot:"filter-actions-end",ref:e=>this.dropdownNode=e,onCalciteDropdownOpen:()=>{this.mutationObserver?.disconnect(),this.mutationObserver?.observe(this.popoverNode,{attributes:!0})},onCalciteDropdownClose:()=>this.mutationObserver?.disconnect()},(0,s.h)("calcite-action",{slot:"trigger",text:e.fieldPickList.sort,title:e.fieldPickList.sort},(0,s.h)("calcite-icon",{scale:"s",icon:"sortDescending",flipRtl:!0})),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("calcite-dropdown-item",{label:"default",selected:"default"===this.lastSortBy,onClick:()=>{this.lastSortBy="default",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="default",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy))}},e.fieldPickList.default),(0,s.h)("calcite-dropdown-item",{label:"display",selected:"display"===this.lastSortBy,onClick:()=>{this.lastSortBy="display",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="display",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy))}},e.fieldPickList.displayName),(0,s.h)("calcite-dropdown-item",{label:"type",selected:"type"===this.lastSortBy,onClick:()=>{this.lastSortBy="type",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="type",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy))}},e.fieldPickList.type),(0,s.h)("calcite-dropdown-item",{label:"field",selected:"field"===this.lastSortBy,onClick:()=>{this.lastSortBy="field",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy)},onKeyDown:e=>{e.stopPropagation()," "!==e.key&&"Enter"!==e.key||(this.lastSortBy="field",this.arcgisSmartMappingFieldPickListSortByChange.emit(this.lastSortBy))}},e.fieldPickList.fieldName))):(0,s.h)(s.F,null)}checkDisabledListItems(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:a,supportsArcade:s}=e;if(!this.listNode)return;const i=(0,h.x)(e);this.singleEditMode?i[this.fieldToReplace.simpleFieldType]--:this.selectedFields.forEach((t=>{const a=(0,h.y)(e,t);if(a){switch(a.simpleFieldType){case"number":i.number++;break;case"string":i.string++;break;case"date":i.date++}}}));const n=[];if(this.listNode.querySelectorAll("calcite-list-item").forEach((e=>this.enableListItem(e))),"subtype-sublayer"===t.type&&i.string+i.date+i.unknown===1)this.listNode.querySelectorAll('[data-type="string"], [data-type="number"], [data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),n.push(t))}));else if("subtype-sublayer"===t.type&&1===i.number)this.listNode.querySelectorAll('[data-type="string"], [data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),n.push(t))}));else if(a&&!s&&i.number+i.string+i.date+i.unknown===1)this.listNode.querySelectorAll('[data-type="string"], [data-type="number"], [data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),n.push(t))}));else if(!a&&"subtype-sublayer"!==t.type||1!==i.date){if(1===i.string)this.listNode.querySelectorAll('[data-type="string"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),n.push(t))})),1!==i.number&&1!==i.date&&1!==i.unknown||this.listNode.querySelectorAll('[data-type="number"], [data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),n.push(t))}));else if(i.number+i.date+i.unknown>1)if(i.expression>0&&(1!==i.expression||3!==this.selectedFields.length||!this.rendererFieldInfosMap[this.selectedFields[2]].expression)||i.date>0&&2===i.number&&!this.singleEditMode||2===i.date||a&&i.date>0){let e;e=this.singleEditMode?this.fieldToReplace.simpleFieldType===h.w.NUMBER?'[data-type="date"], [data-type="string"]':h.w.STRING?'[data-type="date"], [data-type="number"]':'[data-type="string"], [data-type="number"]':'[data-type="date"], [data-type="string"], [data-type="number"]',this.listNode.querySelectorAll(e).forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),n.push(t))}))}else this.listNode.querySelectorAll('[data-type="string"]').forEach((e=>{const t=e;this.disableListItem(t),n.push(t),this.selectedFields.includes(t.value)&&(t.selected=!1)})),(i.number>2||a||i.number>0&&"subtype-sublayer"===t.type)&&this.listNode.querySelectorAll('[data-type="date"]').forEach((e=>{const t=e;this.disableListItem(t),n.push(t),this.selectedFields.includes(t.value)&&(t.selected=!1)})),1===i.date&&this.listNode.querySelectorAll('[data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),n.push(t))})),i.number>=this.maxNumberFieldCount&&this.listNode.querySelectorAll('[data-type="number"], [data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),n.push(t))}))}else this.listNode.querySelectorAll('[data-type="date"]').forEach((e=>{const t=e;this.selectedFields.includes(t.value)||(this.disableListItem(t),n.push(t))}));return n}disableListItem(e){e.disabled=!0;const t=e.querySelector("calcite-action");t&&(t.disabled=!0)}enableListItem(e){e.disabled=!1;const t=e.querySelector("calcite-action");t&&(t.disabled=!1)}getSortedList(){const e=[...this.fields];return"field"===this.lastSortBy?e.sort(((e,t)=>e.layerField.name.startsWith("_")?1:t.layerField.name.startsWith("_")?-1:e.layerField.name.localeCompare(t.layerField.name))):e.sort(((e,t)=>e.label.startsWith("_")?1:t.label.startsWith("_")?-1:e.label.localeCompare(t.label))),e}setUpObservers(){this.mutationObserver=new MutationObserver((e=>{for(const t of e)"style"===t.attributeName&&"hidden"===this.popoverNode.style.visibility&&(this.dropdownNode.open=!1)})),this.resizeObserver=new ResizeObserver((e=>{const t=e.pop();this.width=1.05*t.contentRect.width}))}get el(){return(0,s.a)(this)}};P.style=".smart-mapping-field-pick-list-popover{--calcite-popover-z-index:100}.panel{min-height:300px}.content{max-height:60vh}.selection-button-div{padding:4px 10px}";const x=["Age (color)","Age (size)","Charts","Charts and Size","Color (age) and Size","Color and Size","Color and Size (age)","Color and Size (univariate)","Compare A to B","Continuous Timeline (color)","Continuous Timeline (size)","Counts and Amounts (color)","Counts and Amounts (size)","Counts and Amounts (opacity)","Counts and Amounts (classed color)","Discrete Time Periods (categories)","Dot Density","Heat Map","Predominant category","Predominant category and Size","Relationship","Relationship and size","Types (unique symbols)","Types and Size","Types and Size (age)"],L=["Counts and Amounts (color)","Counts and Amounts (size)","Counts and Amounts (opacity)","Continuous Timeline (color)","Continuous Timeline (size)","Predominant category and Size"],A={"Counts and Amounts (color)":q,"Counts and Amounts (size)":U,"Counts and Amounts (opacity)":_,"Continuous Timeline (color)":q,"Continuous Timeline (size)":U,"Predominant category and Size":U},D={"Counts and Amounts (color)":Q,"Counts and Amounts (size)":j,"Counts and Amounts (opacity)":Z,"Continuous Timeline (color)":Q,"Continuous Timeline (size)":j,"Predominant category and Size":J},O={"Age (color)":$,"Age (size)":W,Charts:K,"Charts and Size":K,"Color (age) and Size":async function(e,t){const{fields:a,layer:s,view:i,theme:n,colorSchemeTags:r}=e,l=await $({styleName:"Age (color)",fields:[a[0]],theme:n,layer:s,view:i,colorSchemeTags:r},t),o=await j({styleName:"Counts and Amounts (size)",fields:[a[1]],theme:"above",layer:s,view:i},t);return{colorAgeStyleParams:l,sizeStyleParams:o}},"Color and Size":async function(e,t){const{fields:a,layer:s,view:i,theme:n,colorSchemeTags:r}=e,l=await H({styleName:"Counts and Amounts (color)",fields:[a[0]],theme:n,layer:s,view:i,colorSchemeTags:r},t),o=await j({styleName:"Counts and Amounts (size)",fields:[a[1]],theme:"above",layer:s,view:i},t);return{colorStyleParams:l,sizeStyleParams:o}},"Color and Size (age)":async function(e,t){const{fields:a,layer:s,view:i,theme:n,colorSchemeTags:r}=e,l=await H({styleName:"Counts and Amounts (color)",fields:[a[0]],theme:n,layer:s,view:i,colorSchemeTags:r},t),o=await W({styleName:"Age (size)",fields:[a[1]],theme:"above",layer:s,view:i});return{colorStyleParams:l,sizeAgeStyleParams:o}},"Color and Size (univariate)":async function(e,t){const{fields:a,layer:s,view:i,theme:n,colorSchemeTags:r}=e,{modules:l}=t;let o;const c=a[0];r&&(o=l.colorSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:r,theme:n||"high-to-low"})[0]);return{layer:s,view:i,field:c,normalizationField:undefined,theme:n,colorOptions:{colorScheme:o}}},"Compare A to B":H,"Continuous Timeline (color)":H,"Continuous Timeline (size)":j,"Counts and Amounts (color)":H,"Counts and Amounts (size)":j,"Counts and Amounts (opacity)":Z,"Counts and Amounts (classed color)":H,"Discrete Time Periods (categories)":G,"Dot Density":async function(e,t){const{fields:a,layer:s,view:i,colorSchemeTags:n}=e,{modules:r}=t;let l;n&&(l=r.dotDensitySchemes.getSchemesByTag({includedTags:n,numColors:Math.min(a.length,8)})[0]);return{layer:s,view:i,legendOptions:{unit:"units"},attributes:a.map((e=>({field:e,label:s.fields.find((t=>t.name===e))?.alias??""}))).slice(0,8),outlineOptimizationEnabled:!0,dotDensityScheme:l}},"Heat Map":async function(e,t){const{fields:a,layer:s,view:i,colorSchemeTags:n}=e,{modules:r}=t;let l;const o=a[0];n&&(l=r.heatmapSchemes.getSchemesByTag({includedTags:n,basemap:i.map?.basemap||"topo"})[0]);return{layer:s,view:i,field:o,heatmapScheme:l}},"Predominant category":J,"Predominant category and Size":J,Relationship:Y,"Relationship and size":async function(e,t){const{fields:a,layer:s,view:i,colorSchemeTags:n}=e,r=await Y({styleName:"Relationship",layer:s,view:i,fields:[a[0],a[1]],colorSchemeTags:n},t),l=a[2]?await j({styleName:"Counts and Amounts (size)",fields:[a[2]],theme:"above",layer:s,view:i},t):null;return{relationshipStyleParams:r,sizeStyleParams:l}},"Types (unique symbols)":G,"Types and Size":async function(e,t){const{fields:a,layer:s,view:i,colorSchemeTags:n}=e,r=await G({styleName:"Types and Size",layer:s,view:i,fields:[a[0]],colorSchemeTags:n},t),l=await j({styleName:"Counts and Amounts (size)",fields:[a[1]],theme:"above",layer:s,view:i},t);return{typesStyleParams:r,sizeStyleParams:l}},"Types and Size (age)":async function(e,t){const{fields:a,layer:s,view:i,colorSchemeTags:n}=e,r=await G({styleName:"Types and Size",layer:s,view:i,fields:[a[0]],colorSchemeTags:n},t),l=await W({styleName:"Age (size)",fields:[a[1]],theme:"above",layer:s,view:i});return{typesStyleParams:r,sizeAgeStyleParams:l}}};async function V(e,t,a){const s="update"===t?await async function(e,t){const a=await async function(e,t){let{styleName:a}=e;if(!L.includes(a)){const t=L.map((e=>e.toLocaleLowerCase()));if(!t.includes(a.toLocaleLowerCase()))throw new Error(`Unsupported update method: ${a}`);{const s=L[t.indexOf(a.toLocaleLowerCase())];a=s,e.styleName=a}}const s=D[a](e,t);return await s}(t,e),{styleName:s}=t,{renderer:i}=await A[s](e,a);return i}(e,a):await async function(e,t){const a=await async function(e,t){let{styleName:a}=t;if(!x.includes(a)){const e=x.map((e=>e.toLocaleLowerCase()));if(!e.includes(a.toLocaleLowerCase()))throw new Error(`Unrecognized style: ${a}`);{const s=x[e.indexOf(a.toLocaleLowerCase())];a=s,t.styleName=a}}const s=O[a](t,e);return await s}(e,t),{styleName:s,view:i}=t,{renderer:n}=await function(e,t,a){const{modules:s}=e;switch(t){case"Age (color)":return s.ColorCreator.createAgeRenderer(a);case"Age (size)":return s.SizeCreator.createAgeRenderer(a);case"Charts":case"Charts and Size":return s.PieChartCreator.createRenderer(a);case"Color (age) and Size":return async function(e,t){const{colorAgeStyleParams:a,sizeStyleParams:s}=t,{modules:i}=e,{renderer:n,visualVariable:r}=await i.ColorCreator.createAgeRenderer(a),{renderer:l}=await i.SizeCreator.createContinuousRenderer(s),o=l.authoringInfo,c=n.authoringInfo.visualVariables.find((e=>"color"===e.type));return o.visualVariables=[...o.visualVariables,c],l.visualVariables=[...l.visualVariables,r],{renderer:l}}(e,a);case"Color and Size":return async function(e,t){const{colorStyleParams:a,sizeStyleParams:s}=t,{modules:i}=e,{renderer:n,visualVariable:r}=await i.ColorCreator.createContinuousRenderer(a),{renderer:l}=await i.SizeCreator.createContinuousRenderer(s),o=l.authoringInfo,c=n.authoringInfo.visualVariables.find((e=>"color"===e.type));return o.visualVariables=[...o.visualVariables,c],l.visualVariables=[...l.visualVariables,r],{renderer:l}}(e,a);case"Color and Size (age)":return async function(e,t){const{colorStyleParams:a,sizeAgeStyleParams:s}=t,{modules:i}=e,{renderer:n,visualVariable:r}=await i.ColorCreator.createContinuousRenderer(a),{renderer:l}=await i.SizeCreator.createAgeRenderer(s),o=l.authoringInfo,c=n.authoringInfo.visualVariables.find((e=>"color"===e.type));return o.visualVariables=[...o.visualVariables,c],l.visualVariables=[...l.visualVariables,r],{renderer:l}}(e,a);case"Color and Size (univariate)":return s.UnivariateColorSizeCreator.createContinuousRenderer(a);case"Compare A to B":case"Continuous Timeline (color)":case"Counts and Amounts (color)":return s.ColorCreator.createContinuousRenderer(a);case"Continuous Timeline (size)":case"Counts and Amounts (size)":return s.SizeCreator.createContinuousRenderer(a);case"Counts and Amounts (opacity)":return _(e,a);case"Counts and Amounts (classed color)":return s.ColorCreator.createClassBreaksRenderer({...a,numClasses:a.numClasses??void 0});case"Discrete Time Periods (categories)":case"Types (unique symbols)":return s.TypeCreator.createRenderer(a);case"Dot Density":return s.DotDensityCreator.createRenderer(a);case"Heat Map":return s.HeatmapCreator.createRenderer(a);case"Predominant category":case"Predominant category and Size":return s.PredominanceCreator.createRenderer(a);case"Relationship":return s.RelationshipCreator.createRenderer(a);case"Relationship and size":return async function(e,t){const{relationshipStyleParams:a,sizeStyleParams:s}=t,{modules:i}=e,n=a.layer.geometryType,{renderer:r}=await i.RelationshipCreator.createRenderer(a);if(!s)return{renderer:r};const{visualVariables:l,renderer:o}=await i.SizeCreator.createContinuousRenderer(s);if("polygon"===n){const e=o.classBreakInfos[0].symbol;r.uniqueValueInfos.forEach((t=>{const a=e.clone();a.color=t.symbol.color,t.symbol=a}));const t=o.backgroundFillSymbol;r.backgroundFillSymbol=t}r.visualVariables=[...r.visualVariables,...l];const c=r.authoringInfo,d=o.authoringInfo.visualVariables.find((e=>"size"===e.type));return c.visualVariables=[d],{renderer:r}}(e,a);case"Types and Size":return async function(e,t){const{typesStyleParams:a,sizeStyleParams:s}=t,{modules:i}=e,n=a.layer.geometryType,{renderer:r}=await i.TypeCreator.createRenderer(a),{visualVariables:l,renderer:o}=await i.SizeCreator.createContinuousRenderer(s);if("polygon"===n){const e=o.classBreakInfos[0].symbol;r.uniqueValueInfos.forEach((t=>{const a=e.clone();a.color=t.symbol.color,t.symbol=a}));const t=o.backgroundFillSymbol;r.backgroundFillSymbol=t}r.visualVariables=[...r.visualVariables,...l];const c=r.authoringInfo,d=o.authoringInfo.visualVariables.find((e=>"size"===e.type));return c.visualVariables=[d],{renderer:r}}(e,a);case"Types and Size (age)":return async function(e,t){const{typesStyleParams:a,sizeAgeStyleParams:s}=t,{modules:i}=e,n=a.layer.geometryType,{renderer:r}=await i.TypeCreator.createRenderer(a),{visualVariables:l,renderer:o}=await i.SizeCreator.createAgeRenderer(s);if("polygon"===n){const e=o.classBreakInfos[0].symbol;r.uniqueValueInfos.forEach((t=>{const a=e.clone();a.color=t.symbol.color,t.symbol=a}));const t=o.backgroundFillSymbol;r.backgroundFillSymbol=t}r.visualVariables=[...r.visualVariables,...l];const c=r.authoringInfo,d=o.authoringInfo.visualVariables.find((e=>"size"===e.type));return c.visualVariables=[d],{renderer:r}}(e,a);default:return s.LocationCreator.createRenderer(a)}}(e,s,a);if("Compare A to B"===s){((0,h.d)(n,"color")||{}).style="ratio"}"heatmap"===n.type&&(n.referenceScale=i.scale);"pie-chart"===n.type&&(n.size=4);"dot-density"===n.type&&(n.dotSize=2,n.dotShape="circle");return n}(e,a);return s}async function U(e,t){const a=(0,h.k)(e),s=(0,h.r)(e),i=X(e,"size");return{renderer:(await i(e,{fieldInfos:t.field?["color","color-age","type","relationship","predominance"].includes(a)?[...s,{field:t.field,simpleFieldType:(0,h.y)(e,t.field).simpleFieldType}]:void 0:[...s],includeSizeVariable:t.includeSizeVariable})).renderer}}async function q(e,t){const a=(0,h.k)(e),s=(0,h.r)(e),i=X(e,"color");return{renderer:(await i(e,{fieldInfos:["size","size-age"].includes(a)?[{field:t.field,simpleFieldType:(0,h.y)(e,t.field).simpleFieldType},s[0]]:void 0,colorScheme:t.colorScheme,sizeScheme:t.colorScheme,relationshipScheme:t.colorScheme,predominanceScheme:t.colorScheme,pieChartScheme:t.colorScheme,dotDensityScheme:t.colorScheme,heatmapScheme:t.colorScheme,locationScheme:t.colorScheme,typeScheme:t.colorScheme})).renderer}}async function _(e,t){const{modules:a}=e,s=t.layer.renderer.clone();if("dictionary"===s.type)return{renderer:s};const{visualVariable:i}=await a.OpacityVariableCreator.createVisualVariable(t);return s.visualVariables=(0,h.a)(s,"opacity")||[],s.visualVariables.push(i),s.authoringInfo&&(s.authoringInfo.visualVariables=(0,h.c)(s,"opacity")||[]),{renderer:s}}async function G(e,t){const{fields:a,layer:s,view:i,colorSchemeTags:n}=e,{modules:r}=t;let l;const o=a[0],c=a[1],d=a[2];return n&&(l=r.typeSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:n})[0]),{layer:s,view:i,field:o,field2:c,field3:d,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,typeScheme:l}}async function H(e,t){const{fields:a,layer:s,view:i,styleName:n,colorSchemeTags:r}=e;let{theme:l}=e;const{modules:o}=t;let c,d;const p=a[0];return c??=a[1],"Compare A to B"===n&&(c??=a[1],l="above-and-below"),r&&(d=o.colorSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:r,theme:l||"high-to-low"})[0]),{layer:s,view:i,field:p,normalizationField:c,theme:l,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:d}}async function $(e,t){const{fields:a,layer:s,view:i,theme:n,colorSchemeTags:r}=e,{modules:l}=t,o=a[0];let c;return r&&(c=l.colorSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:r,theme:n||"high-to-low"})[0]),{layer:s,view:i,startTime:o,endTime:new Date,theme:n,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0,colorScheme:c}}async function j(e,t){const{fields:a,layer:s,view:i,theme:n}=e;let r=a[0];const l=a[1];if(!r){const e=(0,h.r)(t);e.length&&(r=e[0].field)}return{layer:s,view:i,field:r,normalizationField:l,theme:n,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}async function W(e){const{fields:t,layer:a,view:s,theme:i}=e;return{layer:a,view:s,startTime:t[0],endTime:new Date,theme:i,sizeOptimizationEnabled:!0,outlineOptimizationEnabled:!0}}async function J(e,t){const{fields:a,layer:s,view:i,styleName:n,colorSchemeTags:r}=e,{modules:l}=t;let o;return r&&(o=l.predominanceSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:r,numColors:Math.min(a.length,10)})[0]),{layer:s,view:i,fields:a.map((e=>({name:e}))).slice(0,9),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:n.includes("Size"),predominanceScheme:o}}async function K(e,t){const{fields:a,layer:s,view:i,styleName:n,colorSchemeTags:r}=e,{modules:l}=t;let o;return o=r?l.pieChartSchemes.getSchemesByTag({basemapTheme:await l.colorUtils.getBackgroundColorTheme(i),geometryType:s.geometryType,includedTags:r,numColors:Math.min(a.length,8)})[0]:l.pieChartSchemes.getSchemes({basemapTheme:await l.colorUtils.getBackgroundColorTheme(i),geometryType:s.geometryType,numColors:Math.min(a.length,8)}).primaryScheme,{layer:s,view:i,attributes:a.map((e=>({field:e,label:s.fields.find((t=>t.name===e))?.alias??""}))).slice(0,8),outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,includeSizeVariable:n.includes("Size"),pieChartScheme:o}}async function Y(e,t){const{fields:a,layer:s,view:i,colorSchemeTags:n}=e,{modules:r}=t;let l;const o={field:a[0]},c={field:a[1]};return n&&(l=r.relationshipSchemes.getSchemesByTag({geometryType:s.geometryType,includedTags:n})[0]),{layer:s,view:i,field1:o,field2:c,outlineOptimizationEnabled:!0,sizeOptimizationEnabled:!0,relationshipScheme:l}}async function Q(e,t){const{fields:a,layer:s,view:i,theme:n,colorSchemeTags:r}=e;let l,o=a[0];const c=a[1];if(!o){const e=(0,h.r)(t);e.length&&(o=e[0].field)}if(r){const e=function(e){const{modules:t}=e,a=(0,h.k)(e);switch(a){case"color":case"color-age":case"color-size":case"color-age-size":case"color-size-age":case"compare":return t.colorSchemes.getSchemesByTag;case"type":case"type-size":case"type-size-age":return t.typeSchemes.getSchemesByTag;case"dot-density":return t.dotDensitySchemes.getSchemesByTag;case"heatmap":return t.heatmapSchemes.getSchemesByTag;case"relationship":case"relationship-size":return t.relationshipSchemes.getSchemesByTag;case"predominance":case"predominance-size":return t.predominanceSchemes.getSchemesByTag;case"chart":case"chart-size":return t.pieChartSchemes.getSchemesByTag;default:return console.error("unknown renderer type",a),t.colorSchemes.getSchemesByTag}}(t);l=e({geometryType:s.geometryType,includedTags:r,theme:n||(0,h.z)(t,"color")})[0]}return{layer:s,view:i,field:o,normalizationField:c,theme:n,colorScheme:l}}async function Z(e,t){const{fields:a,layer:s,view:i}=e;let n=a[0];const r=a[1];if(!n){const e=(0,h.r)(t);e.length&&(n=e[0].field)}return{layer:s,view:i,field:n,normalizationField:r}}function X(e,t){const{layer:a}=e;if(!(0,h.l)(a))return;const s=a.renderer.authoringInfo,i=(0,h.k)(e);switch(i){case"simple":return g.a;case"color":return"size"===t?y.m:"class-breaks-color"===s?.type?f.a:f.b;case"size":return"color"===t?y.m:"type"===t?y.l:"relationship"===t?N:"class-breaks-size"===s?.type?y.n:y.c;case"type":return"size"===t?y.l:b.f;case"color-age":return"size"===t?y.k:f.c;case"size-age":return"color"===t?y.h:"type"===t?y.i:y.j;case"color-size":return"univariate-color-size"===s?.type?b.e:y.g;case"color-age-size":return y.f;case"color-size-age":return y.e;case"type-size":return y.d;case"type-size-age":return y.b;case"dot-density":return k;case"heatmap":return S.a;case"relationship":return"size"===t?N:b.a;case"relationship-size":return F;case"predominance":case"predominance-size":return b.d;case"chart":case"chart-size":return b.b;case"compare":return S.c;default:return void console.error("unknown renderer type:",i)}}const ee=({portal:e})=>{const t=window.customElements?.get("arcgis-user-avatar");return t&&e?.user?(0,s.h)("arcgis-user-avatar",{class:"avatar-user",user:e.user,portal:e}):e?(0,s.h)("div",{class:"avatar avatar-portal"},(0,s.h)("calcite-icon",{class:"avatar-icon",icon:"user",scale:"s"})):(0,s.h)("div",{class:"avatar avatar-bot"},(0,s.h)("calcite-icon",{class:"avatar-icon",icon:"effects",scale:"s"}))},te=()=>(0,s.h)("div",{class:"message-loader"},(0,s.h)("svg",{version:"1.1",id:"message-loader",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 100 100","enable-background":"new 0 0 0 0"},(0,s.h)("circle",{fill:"#000",stroke:"none",cx:"6",cy:"50",r:"6"},(0,s.h)("animate",{attributeName:"opacity",dur:"1s",values:"0;1;0",repeatCount:"indefinite",begin:"0.1"})),(0,s.h)("circle",{fill:"#000",stroke:"none",cx:"26",cy:"50",r:"6"},(0,s.h)("animate",{attributeName:"opacity",dur:"1s",values:"0;1;0",repeatCount:"indefinite",begin:"0.2"})),(0,s.h)("circle",{fill:"#000",stroke:"none",cx:"46",cy:"50",r:"6"},(0,s.h)("animate",{attributeName:"opacity",dur:"1s",values:"0;1;0",repeatCount:"indefinite",begin:"0.3"})))),ae=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsAssistClose=(0,s.c)(this,"arcgisSmartMappingPanelsAssistClose",7),this.arcgisSmartMappingPanelsAssistBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsAssistBackClick",7),this.arcgisSmartMappingPanelsAssistError=(0,s.c)(this,"arcgisSmartMappingPanelsAssistError",7),this.arcgisSmartMappingPanelsAssistClusterRequiresUpdate=(0,s.c)(this,"arcgisSmartMappingPanelsAssistClusterRequiresUpdate",7),this.manager=(0,o.u)(this),this.chat=[],this.tileNodes=[],this.smartMappingState=(0,m.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsAssistClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:a}=this;(0,h.v)(a,e,t),this.arcgisSmartMappingPanelsAssistClose.emit("cancel")},this.handleGenerate=async()=>{const{textAreaNode:e,chat:t,activeRendererIdx:a,smartMappingState:s}=this,{layer:i,strings:n}=s;if(!(0,h.l)(i))return;const r=e.value;if(!r)return;this.usingLastStyleTile()||(t.length=a+1),t.push({text:r,type:"question"}),this.loading=!0,this.scrollTo(),e.value="";const l={text:r},o=await(0,u.a)(s,l);if(this.loading){if("valid"!==o.status)return t.push(o),this.loading=!1,void this.scrollTo();await async function(e,t,a){const{text:s}=t,{layer:i,mapView:n}=e;if(!(0,h.l)(i))throw new Error("layer not a FL");if(![200,902].includes(a.dataObject.status_code))return a.message=a.dataObject.botMessage,a.status="error",console.log("*** question/response: ",JSON.stringify({question:s,responseObj:a})),a;const{actionResponse:r}=a.dataObject,{action:l}=r,o=r.style_name;let c;r.theme&&(c=r.theme.trim().toLowerCase().replace(/"/gu,"").replace(/theme/gu,"").replace(/:/gu,"").replace(/;/gu,"").replace(/'/gu,"").trim().replace(/ /gu,"-"),c="none"===r.theme.toLowerCase()?void 0:c);const d=r.field_names,p=[r.color_scheme];console.log("*** question/response: ",JSON.stringify({question:s,actionResponse:r}));try{const t=await V(e,l,{layer:i,view:n,fields:d,styleName:o,theme:c,colorSchemeTags:p});return a.renderer=t,a.rendererFields=d,a.message=`${a.message}. Here's a ${o} map.`,a}catch(e){return a.message=`I'm sorry. There must have been a misunderstanding. I see the following error: ${e.message}`,a.status="error",a}}(s,l,o),t.push(o),o.renderer&&(this.activeRendererIdx=t.length-1,(0,h.t)(s,o.renderer),this.smartMappingState.selectedFields=(0,h.r)(s),this.smartMappingState.selectedFields.forEach((e=>{e.expression&&!e.expressionTitle&&(e.expressionTitle=n.expression)}))),this.loading=!1,this.scrollTo()}},this.handleRestart=()=>{this.chat=[],this.loading=!1;const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:a}=this;(0,h.v)(a,e,t),(0,s.f)(this.el),setTimeout((()=>{this.textAreaNode.setFocus()}),500)},this.handleChip=e=>{const{textAreaNode:t,smartMappingState:a}=this,{strings:i}=a;switch(e){case 0:t.value="How can I style the data in the layer";break;case 1:t.value=`${i.panels.assist.mainSuggestion1} `;break;case 2:t.value=`${i.panels.assist.mainSuggestion2} `;break;case 3:t.value=`${i.panels.assist.mainSuggestion3} `;break;default:t.value=`${i.panels.assist.mainSuggestion4} `}(0,s.f)(this.el),setTimeout((async()=>await t.setFocus()),300)},this.handleSecondaryChip=e=>{const{textAreaNode:t,smartMappingState:a}=this,{strings:i}=a;switch(e){case 1:t.value=`${i.panels.assist.secondSuggestion1} `;break;case 2:t.value=`${i.panels.assist.secondSuggestion2} `;break;default:t.value=`${i.panels.assist.secondSuggestion3} `}(0,s.f)(this.el),setTimeout((async()=>await t.setFocus()),300)},this.handleStyleTileClick=e=>{const{chat:t,smartMappingState:a}=this,s=t[e];this.activeRendererIdx=e,(0,h.t)(a,s.renderer)},this.handleStyleTileCustomize=e=>{const{chat:t,panelsParentNode:a,smartMappingState:i}=this,n=t[e],r=(0,h.A)(i,n.renderer),{selectedFields:l}=i;switch(r){case"simple":{const e=document.createElement("arcgis-smart-mapping-panels-simple");e.addEventListener("arcgisSmartMappingPanelsSimpleClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsSimpleBackClick",(()=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsSimpleError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"color":case"color-age":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.addEventListener("arcgisSmartMappingPanelsColorClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"size":case"size-age":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.addEventListener("arcgisSmartMappingPanelsSizeClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.addEventListener("arcgisSmartMappingPanelsTypeClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsTypeClusterRequiresUpdate",(()=>{this.arcgisSmartMappingPanelsAssistClusterRequiresUpdate.emit()})),e.addEventListener("arcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"compare":{const e=document.createElement("arcgis-smart-mapping-panels-compare");e.addEventListener("arcgisSmartMappingPanelsCompareClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsCompareBackClick",(()=>{this.cleanUpFlowItem(a,e),a.removeChild(e)})),e.addEventListener("arcgisSmartMappingPanelsCompareError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"heatmap":{const e=document.createElement("arcgis-smart-mapping-panels-heatmap");e.addEventListener("arcgisSmartMappingPanelsHeatmapClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsHeatmapBackClick",(()=>{this.cleanUpFlowItem(a,e),a.removeChild(e)})),e.addEventListener("arcgisSmartMappingPanelsHeatmapError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>{this.cleanUpFlowItem(a,e),a.removeChild(e)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"dot-density":{const e=document.createElement("arcgis-smart-mapping-panels-dot-density");e.addEventListener("arcgisSmartMappingPanelsDotDensityClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsDotDensityBackClick",(()=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"color-size":case"color-age-size":case"color-size-age":if(l.length>1){const e=document.createElement("arcgis-smart-mapping-panels-color-size");e.addEventListener("arcgisSmartMappingPanelsColorSizeClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1}else{const e=document.createElement("arcgis-smart-mapping-panels-color-size-univariate");e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(a,e),a.removeChild(e)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1}break;case"type-size":case"type-size-age":{const e=document.createElement("arcgis-smart-mapping-panels-type-size");e.addEventListener("arcgisSmartMappingPanelsTypeSizeClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance-size":{const e=document.createElement("arcgis-smart-mapping-panels-predominance-size");e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeBackClick",(()=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart-size":{const e=document.createElement("arcgis-smart-mapping-panels-chart-size");e.addEventListener("arcgisSmartMappingPanelsChartSizeClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsChartSizeBackClick",(()=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsChartSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship-size":{const e=document.createElement("arcgis-smart-mapping-panels-relationship-size");e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeClose",(t=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone(t.detail,n)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeBackClick",(()=>{this.cleanUpFlowItem(a,e),this.handleStyleOptionsDone("save",n)})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsAssistError.emit(e))),a.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0,this.loading=!1,this.activeRendererIdx=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,a=(0,h.g)(this.smartMappingState);this.originalRendererJSON=a.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.panelsParentNode=(0,h.B)(this.smartMappingState,this.el)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}disconnectedCallback(){}render(){const{layer:e,hideLayerTitle:t,strings:a}=this.smartMappingState;return console.log("chat",this.chat),(0,s.h)(s.H,{key:"2ddd18c4538e96b656565585a85a5e5a99b8d2e3",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"fc96b117609e7a647cfc4f76f8dc26f135bb8dca",heading:a.panels.assist.heading,description:t?void 0:e.title??void 0,class:"flow-item",closable:!1,showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:e=>{e.stopPropagation(),this.arcgisSmartMappingPanelsAssistBackClick.emit()},ref:e=>this.flowItemNode=e},this.renderDoneButton(),this.renderCancelButton(),this.renderContent(),this.renderDisclaimer()))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,s.h)(s.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,s.h)(s.F,null)}renderContent(){const{chat:e,loading:t}=this;return e.length||t?this.renderGeneratedContent():this.renderInitialContent()}renderInitialContent(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"content content-initial"},(0,s.h)("calcite-icon",{icon:"effects"}),(0,s.h)("div",{class:"title"},e.panels.assist.title),(0,s.h)("div",{class:"sub-title"},e.panels.assist.subTitle),this.renderInput(),this.renderSuggestions())}renderGeneratedContent(){const{chat:e,loading:t}=this;return(0,s.h)("div",{class:"content content-generated"},(0,s.h)("div",{class:"messages",ref:e=>this.messagesNode=e},e.map(((e,t)=>this.renderChatMessage(e,t))),t&&(0,s.h)(te,null)),(0,s.h)("div",{class:"bottom-input"},this.renderSecondarySuggestions(),this.renderInput()))}renderChatMessage(e,t){return(0,s.h)("div",{class:"message","data-value":t},"question"===e.type?this.rendererQuestion(e):this.renderResponse(e,t))}rendererQuestion(e){const{portal:t}=this.smartMappingState;return(0,s.h)("div",{class:"chat-question"},(0,s.h)(ee,{portal:t}),(0,s.h)("div",{class:"question"},e.text))}renderResponse(e,t){return e.renderer?this.renderStyleTile(e,t):(0,s.h)("div",{class:"chat-response"},(0,s.h)(ee,null),(0,s.h)("div",{class:"response"},e.message))}renderStyleTile(e,t){const{activeRendererIdx:a,smartMappingState:i}=this,n=(0,h.A)(i,e.renderer),r=(0,h.r)(i,e.renderer)?.map((e=>(0,h.y)(i,e.field)?.label||e.field));return(0,s.h)("div",{class:"chat-response"},(0,s.h)(ee,null),(0,s.h)("arcgis-smart-mapping-tile",{key:t,class:"tile",tileType:"assist",type:n,selected:a===t,fields:r,ref:e=>{e&&(this.tileNodes[t]=e)},onArcgisSmartMappingTileSelect:()=>this.handleStyleTileClick(t),onArcgisSmartMappingTileOptions:()=>this.handleStyleTileCustomize(t)}))}renderInput(){const{chat:e,smartMappingState:t}=this,{strings:a}=t;return(0,s.h)(s.F,null,(0,s.h)("calcite-text-area",{disabled:this.loading,class:"text-input",placeholder:a.panels.assist.placeholder,value:"",scale:"s",resize:"vertical",rows:3,onCalciteTextAreaInput:()=>this.generateButtonNode.disabled=!this.textAreaNode.value,onKeyUp:e=>{"Enter"===e.key&&this.textAreaNode.value&&(e.preventDefault(),this.handleGenerate())},ref:e=>this.textAreaNode=e}),(0,s.h)("div",{class:"generate-buttons"},!!e.length&&(0,s.h)(s.F,null,(0,s.h)("calcite-button",{class:"restart-button",slot:"footer",iconStart:"refresh",label:a.panels.assist.restart,onClick:this.handleRestart,appearance:"transparent",width:"auto"},a.panels.assist.restart),(0,s.h)("span",null,"\xa0\xa0")),(0,s.h)("calcite-button",{disabled:this.loading||!this.textAreaNode?.value,class:"generate-button",slot:"footer",iconStart:"effects",label:a.panels.assist.generate,onClick:()=>{this.loading||this.handleGenerate()},appearance:"solid",width:"auto",ref:e=>this.generateButtonNode=e},a.panels.assist.generate)))}renderSuggestions(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"suggestions"},(0,s.h)("div",{class:"suggestions-title"},e.panels.assist.suggestedPrompts),(0,s.h)("calcite-chip",{class:"chip",scale:"s",value:"0",appearance:"outline-fill",label:"How can I style the data in the layer",onClick:()=>this.handleChip(0)},"How can I style the data in the layer"),(0,s.h)("br",null),(0,s.h)("calcite-chip",{class:"chip",scale:"s",value:"1",appearance:"outline-fill",label:e.panels.assist.mainSuggestion1,onClick:()=>this.handleChip(1)},`${e.panels.assist.mainSuggestion1}...`),(0,s.h)("br",null),(0,s.h)("calcite-chip",{class:"chip",scale:"s",value:"2",appearance:"outline-fill",label:e.panels.assist.mainSuggestion2,onClick:()=>this.handleChip(2)},`${e.panels.assist.mainSuggestion2}...`),(0,s.h)("br",null),(0,s.h)("calcite-chip",{class:"chip",scale:"s",value:"3",appearance:"outline-fill",label:e.panels.assist.mainSuggestion3,onClick:()=>this.handleChip(3)},`${e.panels.assist.mainSuggestion3}...`),(0,s.h)("br",null),(0,s.h)("calcite-chip",{class:"chip",scale:"s",value:"4",appearance:"outline-fill",label:e.panels.assist.mainSuggestion4,onClick:()=>this.handleChip(4)},`${e.panels.assist.mainSuggestion4}...`))}renderSecondarySuggestions(){const{strings:e}=this.smartMappingState;return(0,s.h)("div",{class:"secondary-suggestions"},(0,s.h)("calcite-chip",{disabled:this.loading,class:"chip",scale:"s",value:"1",appearance:"solid",label:e.panels.assist.secondSuggestion1,onClick:()=>!this.loading&&this.handleSecondaryChip(1)},e.panels.assist.secondSuggestion1),(0,s.h)("calcite-chip",{disabled:this.loading,class:"chip",scale:"s",value:"2",appearance:"solid",label:e.panels.assist.secondSuggestion2,onClick:()=>!this.loading&&this.handleSecondaryChip(2)},e.panels.assist.secondSuggestion2))}renderDisclaimer(){return(0,s.h)("div",{class:"disclaimer"},(0,s.h)("div",{class:"disclaimer-icon"},(0,s.h)("calcite-icon",{class:"disclaimer-icon",icon:"information",scale:"s"})),(0,s.h)("div",null,"\xa0\xa0"),(0,s.h)("div",{class:"disclaimer-text"},(0,s.h)("span",null,'"AI generated content may be inaccurate or misleading."')))}handleStyleOptionsDone(e,t){const{layer:a,modules:s}=this.smartMappingState;"save"===e&&(t.renderer=s.esriLang.clone(a.renderer))}cleanUpFlowItem(e,t){e.removeChild(t),this.focusSelectedTile(),this.selected=!0}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[0]?.setFocus())))),300)}usingLastStyleTile(){const{chat:e,activeRendererIdx:t}=this;if(e.length>1&&(0,l.i)(t)){let a=e.length;return e.forEach(((e,t)=>{"renderer"in e&&e.renderer&&(a=t)})),t===a}return!0}scrollTo(){const{textAreaNode:e,messagesNode:t}=this;setTimeout((()=>{t?.scrollTo(0,t.scrollHeight)}),300),setTimeout((()=>{e?.setFocus(),t?.scrollTo(0,t.scrollHeight)}),500)}get el(){return(0,s.a)(this)}};let se;function ie(e,t){se&&clearTimeout(se),se=setTimeout((()=>{se=null,ne(e,t)}),1e3)}function ne(e,t){const{selectedFields:a,layer:s,mapImageSublayer:i}=e,n="ogc-feature"===s.type,r="wfs"===s.type,o="parquet"===s.type,c="subtype-sublayer"===s.type,d=s.capabilities?.query?.supportsSqlExpression,p=n||r||o||c||d,m=a.map((t=>(0,h.y)(e,t.field))),u=(0,h.r)(e),C=(0,h.k)(e);if(!(0,h.C)(a,u))if(0===a.length)t("heatmap"===C?(0,S.b)(e):(0,g.c)(e));else if(1===a.length){const n=m[0];if("heatmap"!==C||!p||a[0].expression||a[0].featureReductionExpression||a[0].simpleFieldType!==h.w.NUMBER)if("color-size"===C&&(0,h.D)(a[0],u[0]))t((0,f.d)(e,{fieldInfos:a}));else if("type-size"===C&&(0,h.D)(a[0],u[0]))t((0,b.g)(e,{fieldInfos:a}));else if(["color-size","type-size"].includes(C)&&(0,h.D)(a[0],u[u.length>1?1:0]))t((0,y.a)(e,{fieldInfos:a}));else if(a[0].expression||a[0].featureReductionExpression)a[0].simpleFieldType===h.w.NUMBER||a[0].simpleFieldType===h.w.DATE?t((0,f.d)(e,{fieldInfos:a})):t((0,b.g)(e,{fieldInfos:a}));else if(n.simpleFieldType===h.w.STRING||"string"===(0,h.E)(e,n)||"domain"in n.layerField&&n.layerField.domain)t((0,b.g)(e,{fieldInfos:a}));else if(["integer","double","single","small-integer","big-integer"].includes((0,h.F)(e,n.layerField))&&"objectIdField"in s&&s.objectIdField!==n.layerField.name)if((0,h.G)(e))"featureReduction"in s&&s.featureReduction?t((0,f.d)(e,{fieldInfos:a})):t((0,y.a)(e,{fieldInfos:a}));else if((0,h.H)(e))t((0,y.a)(e,{fieldInfos:a}));else{const s=(0,h.E)(e,n);["integer","small-integer","big-integer"].includes((0,h.F)(e,n.layerField))||(0,l.i)(s)&&"integer"===s?t((0,y.a)(e,{fieldInfos:a})):t((0,f.d)(e,{fieldInfos:a}))}else"date"===(0,h.F)(e,n.layerField)&&("color-age-size"===C&&(0,h.D)(a[0],u[0])?t((0,f.e)(e,{fieldInfos:a})):["color-size-age","type-size-age"].includes(C)&&(0,h.D)(a[0],u[1])?t((0,y.o)(e,{fieldInfos:a})):i?t((0,f.e)(e,{fieldInfos:a})):"subtype-sublayer"===s.type?t((0,b.g)(e,{fieldInfos:a})):t((0,f.d)(e,{fieldInfos:a})));else t((0,S.b)(e,{fieldInfos:a}))}else if(2===a.length){const s=m[0];"type"!==C&&"type-size"!==C||!(0,h.D)(a[0],u[0])?a[0].expression||a[0].featureReductionExpression?a[0].simpleFieldType===h.w.NUMBER&&a[1].simpleFieldType===h.w.NUMBER?t((0,y.m)(e,{fieldInfos:a})):t((0,y.l)(e,{fieldInfos:a})):a[0].simpleFieldType===h.w.STRING||"string"===(0,h.E)(e,s)||"domain"in s.layerField&&s.layerField.domain?a[1].simpleFieldType===h.w.DATE&&(["color-size-age","type-size-age"].includes(C)||i)?t((0,y.i)(e,{fieldInfos:a})):t((0,y.l)(e,{fieldInfos:a})):a[0].simpleFieldType===h.w.DATE||a[1].simpleFieldType===h.w.DATE?a[0].simpleFieldType===h.w.DATE&&(["color-age","color-age-size"].includes(C)||i)?t((0,y.k)(e,{fieldInfos:a})):a[1].simpleFieldType===h.w.DATE&&(["color-size-age","type-size-age"].includes(C)||i)?t((0,y.h)(e,{fieldInfos:a})):t((0,y.m)(e,{fieldInfos:a})):a[0].expression||a[0].featureReductionExpression||a[1].expression||a[1].featureReductionExpression?t((0,y.m)(e,{fieldInfos:a})):"dot-density"===C?t(M(e,{fieldInfos:a})):"predominance"===C?t((0,b.h)(e,{fieldInfos:a})):"predominance-size"===C?t((0,b.h)(e,{fieldInfos:a,includeSizeVariable:!0})):"chart"===C?t((0,b.i)(e,{fieldInfos:a})):"chart-size"===C?t((0,b.i)(e,{fieldInfos:a,includeSizeVariable:!0})):"compare"===C?t((0,S.d)(e,{fieldInfos:a})):["relationship","relationship-size"].includes(C)?t((0,b.c)(e,{fieldInfos:a})):t(c?(0,b.h)(e,{fieldInfos:a}):(0,y.m)(e,{fieldInfos:a})):t((0,y.l)(e,{fieldInfos:a}))}else 3===a.length&&(["relationship","relationship-size"].includes(C)||a[2].expression||a[2].featureReductionExpression||!p)?t(N(e,{fieldInfos:a})):"dot-density"===C&&a.length<=8?t(M(e,{fieldInfos:a})):"predominance-size"===C?t((0,b.h)(e,{fieldInfos:a,includeSizeVariable:!0})):"chart"===C?t((0,b.i)(e,{fieldInfos:a,includeSizeVariable:!1})):"chart-size"===C?t((0,b.i)(e,{fieldInfos:a,includeSizeVariable:!0})):i&&!p||a[2].simpleFieldType===h.w.DATE?t(N(e,{fieldInfos:a})):t((0,b.h)(e,{fieldInfos:a}))}ae.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n.flow-item {\n  height: 100%;\n}\n.content {\n  height: 100%;\n  background-color: #ffffff;\n}\n.content-initial {\n  padding: 12px 9px;\n}\n.content-generated {\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  overflow-y: hidden;\n}\n.title {\n  font-weight: bold;\n  font-size: 16px;\n}\n.sub-title {\n  font-size: var(--calcite-font-size--1);\n  padding-bottom: 10px;\n}\n.text-input {\n  padding: 10px 0 20px 0;\n  width: 100%;\n}\n.generate-buttons {\n  display: flex;\n  justify-content: right;\n  margin-bottom: 20px;\n}\n:dir(rtl) {\n  .generate-buttons {\n    justify-content: left;\n  }\n}\n.generate-button {\n}\n.suggestions {\n  background-color: var(--calcite-color-foreground-2);\n  padding: 8px;\n  margin: 20px 0;\n}\n.suggestions-title {\n  font-size: var(--calcite-font-size--1);\n  padding-bottom: 5px;\n}\n.chip {\n  max-width: 100%;\n  margin-top: 5px;\n}\n.disclaimer {\n  font-size: var(--calcite-font-size--2);\n  background-color: #ffffff;\n  padding: 8px;\n  display: flex;\n  justify-content: space-between;\n}\n.disclaimer-icon {\n  height: 100%;\n  vertical-align: middle;\n}\n.disclaimer-text {\n  line-height: 16px;\n}\n.avatar {\n  border-radius: 50%;\n  width: 30px;\n  min-width: 30px;\n  height: 30px;\n  display: flex;\n  justify-content: center;\n}\n.avatar-user {\n  min-width: 30px;\n}\n.avatar-portal {\n  background-color: var(--calcite-color-foreground-2);\n}\n.avatar-bot {\n  background-color: #dcf2f4;\n}\n.avatar-icon {\n  vertical-align: middle;\n  height: 100%;\n}\n.bottom-input {\n  border-top: 1px solid var(--calcite-color-foreground-2);\n  padding: 0 9px;\n}\n.messages {\n  height: 100%;\n  overflow-y: auto;\n  overflow-x: hidden;\n  padding: 12px 9px;\n}\n.message-loader {\n  display: flex;\n  height: 40px;\n  margin: 0 10px;\n}\n.message {\n  margin-bottom: 14px;\n}\n.chat-question {\n  display: flex;\n  -moz-column-gap: 5px;\n       column-gap: 5px;\n}\n.chat-response {\n  display: flex;\n  margin: 3px 0;\n  -moz-column-gap: 5px;\n       column-gap: 5px;\n}\n.question,\n.response {\n  background-color: var(--calcite-color-foreground-2);\n  padding: 8px 10px;\n  border-radius: 8px;\n  font-size: var(--calcite-font-size--2);\n  line-height: 19.25px;\n  white-space: pre-wrap;\n}\n.tile {\n  width: 100%;\n}\n";const re="timeProperties",le=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsGalleryClose=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryClose",7),this.arcgisSmartMappingPanelsGalleryError=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryError",7),this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryClusterRequiresUpdate",7),this.arcgisSmartMappingPanelsGalleryArcadeTimeExpressionChange=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryArcadeTimeExpressionChange",7),this.manager=(0,o.u)(this),this.tileNodes=[],this.lastSortBy="default",this.hasArcadeTimeExpressionChange=!1,this.smartMappingState=(0,m.u)(),this.handleGenerateClick=()=>{const e=document.createElement("arcgis-smart-mapping-panels-assist");e.addEventListener("arcgisSmartMappingPanelsAssistClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile(),setTimeout((()=>this.focusSelectedTile()),500)})),e.addEventListener("arcgisSmartMappingPanelsAssistBackClick",(()=>{(0,s.f)(this.el),setTimeout((()=>this.focusSelectedTile()),500),this.removeFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsAssistError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),e.addEventListener("arcgisSmartMappingPanelsAssistClusterRequiresUpdate",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1},this.addExpression=async()=>{const{smartMappingState:e}=this,{useFeatureReduction:t}=e;this.addExpressionButtonNode.disabled=!0,(0,h.J)();try{const a=await(0,C.u)(e);this.addExpressionButtonNode.disabled=!1,a.simpleFieldType===h.w.UNKNOWN&&(a.simpleFieldType=h.w.NUMBER);const{selectedFields:s,modules:i,strings:n}=this.smartMappingState;if(2===s.length&&a?.simpleFieldType===h.w.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:n.panels.gallery.errors.expressionMustBeNumber,type:"warning"});if(1===s.length&&s[0].simpleFieldType===h.w.STRING&&a?.simpleFieldType===h.w.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:n.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const r=t?s.find((e=>"aggregateCount"===e.field)):void 0,l=r?i.esriLang.clone(s).filter((e=>"aggregateCount"!==e.field)):i.esriLang.clone(s);if(l.push(a),3===l.length)for(let e=0;e<3;e++){const t=l[e];if(t.simpleFieldType===h.w.DATE&&2!==e){l.splice(e,1),l.splice(2,0,t);break}}r&&l.push(r),l.length>1&&l[1].simpleFieldType===h.w.STRING&&l.reverse(),this.smartMappingState.selectedFields=l,a.expression?.includes(re)&&(this.hasArcadeTimeExpressionChange=!0),ie(e,this.galleryRequestWrapper)}catch(e){this.addExpressionButtonNode.disabled=!1,this.addExpressionButtonNode.setFocus()}},this.handleArcadeEdit=async e=>{(0,h.J)();try{const{smartMappingState:t}=this,{selectedFields:a,strings:i}=t,n=await(0,C.u)(t,a[e]);if(n.simpleFieldType===h.w.UNKNOWN&&(n.simpleFieldType=h.w.NUMBER),0!==e&&n?.simpleFieldType===h.w.STRING&&a[0].simpleFieldType===h.w.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:i.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const r=a[e];"string"===n.simpleFieldType?(a.splice(e,1),a.unshift(n),e=0,(0,s.f)(this.el)):a[e]=n;const l=r.expression?.includes(re),o=n.expression?.includes(re);(l&&!o||o&&!l)&&(this.hasArcadeTimeExpressionChange=!0),this.smartMappingState.selectedFields.length!==a.length?(this.smartMappingState.selectedFields=a,ie(t,this.galleryRequestWrapper)):(this.smartMappingState.selectedFields=a,function(e,t,a,s){const{selectedFields:i}=e,n=(0,h.g)(e),{idx:r,oldFieldInfo:l}=t,o=(0,h.k)(e);if(!(0,h.D)(i[r],l))if(i[r].expression===l.expression){const t=i[r];if("size"===o||"color-size"===o&&1===r||"type-size"===o&&1===r||"relationship-size"===o&&2===r){const e=n,a=(0,h.b)(n,"size");a?a.valueExpressionTitle=t.expressionTitle:e.valueExpressionTitle&&(e.valueExpressionTitle=t.expressionTitle)}else if("color"===o||"color-size"===o&&0===r){const e=n,a=(0,h.b)(n,"color");a?a.valueExpressionTitle=t.expressionTitle:e.valueExpressionTitle&&(e.valueExpressionTitle=t.expressionTitle)}else("type"===o||"type-size"===o&&0===r)&&(n.valueExpressionTitle=t.expressionTitle);(0,h.t)(e),s()}else i[r].simpleFieldType===l.simpleFieldType?"size"===o?a((0,y.c)(e,{fieldInfos:i})):"color"===o?a((0,f.b)(e,{fieldInfos:i})):"type"===o?a((0,b.f)(e,{fieldInfos:i})):"color-size"===o?1===i.length?a((0,b.e)(e,{fieldInfos:i})):a((0,y.g)(e,{fieldInfos:i})):"type-size"===o?a((0,y.d)(e,{fieldInfos:i})):"relationship-size"===o?a(F(e,{fieldInfos:i})):ne(e,a):ne(e,a)}(t,{idx:e,oldFieldInfo:r},this.galleryRequestWrapper,(()=>(0,s.f)(this.el))))}catch(e){this.addExpressionButtonNode.setFocus()}},this.handleListOrderChange=e=>{const{smartMappingState:t}=this,{selectedFields:a,modules:s}=t,i=[];e.target.querySelectorAll("calcite-list-item").forEach((e=>{i.push(s.esriLang.clone(a[Number.parseInt(e.value)]))})),this.smartMappingState.selectedFields=i,ie(t,this.galleryRequestWrapper)},this.handleListChange=e=>{const{selectedFields:t}=this.smartMappingState;!!t[e].expression?this.handleArcadeEdit(e):this.openFieldPickList(!0,e)},this.handleRemoveAttribute=e=>{const{smartMappingState:t}=this,{selectedFields:a}=t,s=a.some((e=>e.expression?.includes(re)));this.smartMappingState.selectedFields=a?.filter(((t,a)=>a!==e));const i=this.smartMappingState.selectedFields.some((e=>e.expression?.includes(re)));s&&!i&&(this.hasArcadeTimeExpressionChange=!0),ie(t,this.galleryRequestWrapper)},this.handleSelectClick=e=>{const{smartMappingState:t}=this;!function(e,t,a){const{selectedFields:s}=e;switch(t){case"simple":e.selectedFields=[],a((0,g.c)(e));break;case"type":a((0,b.g)(e,{fieldInfos:s}));break;case"color":a((0,f.d)(e,{fieldInfos:s}));break;case"size":a((0,y.a)(e,{fieldInfos:s}));break;case"color-age":a((0,f.e)(e,{fieldInfos:s}));break;case"size-age":a((0,y.o)(e,{fieldInfos:s}));break;case"dot-density":a(M(e,{fieldInfos:s}));break;case"heatmap":a((0,S.b)(e,{fieldInfos:s}));break;case"compare":a((0,S.d)(e,{fieldInfos:s}));break;case"relationship":a((0,b.c)(e,{fieldInfos:s}));break;case"relationship-size":a(N(e,{fieldInfos:s}));break;case"predominance":a((0,b.h)(e,{fieldInfos:s}));break;case"predominance-size":a((0,b.h)(e,{fieldInfos:s,includeSizeVariable:!0}));break;case"chart":a((0,b.i)(e,{fieldInfos:s}));break;case"chart-size":a((0,b.i)(e,{fieldInfos:s,includeSizeVariable:!0}));break;case"type-size":a((0,y.l)(e,{fieldInfos:s}));break;case"type-size-age":a((0,y.i)(e,{fieldInfos:s}));break;case"color-size":1===s.length?a((0,b.j)(e,{fieldInfos:s})):a((0,y.m)(e,{fieldInfos:s}));break;case"color-age-size":a((0,y.k)(e,{fieldInfos:s}));break;case"color-size-age":a((0,y.h)(e,{fieldInfos:s}))}}(t,e,this.galleryRequestWrapper)},this.handleOptionsClick=e=>{const{selectedFields:t}=this.smartMappingState;switch(e){case"simple":{const e=document.createElement("arcgis-smart-mapping-panels-simple");e.addEventListener("arcgisSmartMappingPanelsSimpleClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsSimpleBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsSimpleError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.selected=!0,e.showBackButton=!0,this.selected=!1;break}case"color":case"color-age":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.addEventListener("arcgisSmartMappingPanelsColorClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"size":case"size-age":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.addEventListener("arcgisSmartMappingPanelsTypeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsTypeClusterRequiresUpdate",(()=>{this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()})),e.addEventListener("arcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"compare":{const e=document.createElement("arcgis-smart-mapping-panels-compare");e.addEventListener("arcgisSmartMappingPanelsCompareClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsCompareBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsCompareError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"heatmap":{const e=document.createElement("arcgis-smart-mapping-panels-heatmap");e.addEventListener("arcgisSmartMappingPanelsHeatmapClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsHeatmapBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsHeatmapError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"dot-density":{const e=document.createElement("arcgis-smart-mapping-panels-dot-density");e.addEventListener("arcgisSmartMappingPanelsDotDensityClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsDotDensityBackClick",(()=>this.cleanUpFlowItem(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"color-size":case"color-age-size":case"color-size-age":if(t.length>1){const e=document.createElement("arcgis-smart-mapping-panels-color-size");e.addEventListener("arcgisSmartMappingPanelsColorSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsColorSizeBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1}else{const e=document.createElement("arcgis-smart-mapping-panels-color-size-univariate");e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1}break;case"type-size":case"type-size-age":{const e=document.createElement("arcgis-smart-mapping-panels-type-size");e.addEventListener("arcgisSmartMappingPanelsTypeSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsTypeSizeBackClick",(()=>{(0,s.f)(this.el),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"predominance-size":{const e=document.createElement("arcgis-smart-mapping-panels-predominance-size");e.showBackButton=!0,e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"chart-size":{const e=document.createElement("arcgis-smart-mapping-panels-chart-size");e.addEventListener("arcgisSmartMappingPanelsChartSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsChartSizeBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsChartSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"relationship-size":{const e=document.createElement("arcgis-smart-mapping-panels-relationship-size");e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeBackClick",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsGalleryClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:t,smartMappingState:a}=this,{selectedFields:s}=a,i=s.some((e=>e.expression?.includes(re))),n=e?.visualVariables?.some((e=>e.valueExpression?.includes(re)));(i&&!n||!i&&n)&&(this.hasArcadeTimeExpressionChange=!0),(0,h.v)(a,e,t),this.arcgisSmartMappingPanelsGalleryClose.emit("cancel"),this.handleArcadeTimeExpressionChange()},this.galleryRequestWrapper=e=>{const{smartMappingState:t}=this,{strings:a}=t;(0,f.r)(e,this.flowItemNode).then((e=>{const{layer:a}=t;(0,h.t)(t,e.renderer),(0,s.f)(this.el),"featureReduction"in a&&"cluster"===a.featureReduction?.type&&(this.checkCluster(),this.checkClusterRenderer()),this.focusSelectedTile(),this.handleArcadeTimeExpressionChange()}),(()=>{this.arcgisSmartMappingPanelsGalleryError.emit({message:a.panels.gallery.errors.changeRendererErrorMsg,type:"warning"})}))},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{layer:e,modules:t}=this.smartMappingState,a=(0,h.g)(this.smartMappingState);this.originalRendererJSON=a.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?t.esriLang.clone(e.featureReduction):void 0,this.flowNode=(0,p.f)(this.el,"calcite-flow");const s=t.urlUtils.urlToObject(document.URL);this.urlObjectQuery=s.query||{}}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.setUpWatchBinScale(!0)}disconnectedCallback(){this.scaleHandle?.remove()}render(){const{layer:e,useFeatureReduction:t,hideLayerTitle:a,strings:i}=this.smartMappingState,n=t?i.panels.gallery.binStyles:i.panels.gallery.styles;let r=!1;if("featureReduction"in e&&"cluster"===e.featureReduction?.type){const t=e.featureReduction;"pie-chart"!==t.renderer?.type||t.renderer.authoringInfo?.isAutoGenerated||(r=!0)}return(0,s.h)(s.H,{key:"437eb3e354e5f3d38a91399026533349d7757075",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"a6c9724424f019d85f6e5fc0cce35242d4c22081",heading:n,description:a?void 0:e.title,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:this.handleDone,ref:e=>this.flowItemNode=e},r?this.renderClusteringWarning():this.renderGalleryContent()))}renderGalleryContent(){return(0,s.h)(s.F,null,this.renderDoneButton(),this.renderCancelButton(),this.renderGenerate(),this.renderStepOne(),this.renderStepTwo())}renderClusteringWarning(){const{strings:e}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("calcite-card",{class:"clustering-warning-notice"},(0,s.h)("div",{slot:"description"},e.panels.gallery.chartClusterMsg)),(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.done))}renderDoneButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.done,onClick:this.handleDone,appearance:"solid",width:"half"},t.done):(0,s.h)(s.F,null)}renderCancelButton(){const{layer:e,strings:t}=this.smartMappingState;return e?(0,s.h)("calcite-button",{slot:"footer",label:t.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},t.cancel):(0,s.h)(s.F,null)}renderGenerate(){const e=this.urlObjectQuery,{layer:t,portal:a,strings:i}=this.smartMappingState,n=Object.keys(u.b).includes(e.assist);return e.assist&&(0,h.l)(t)&&(n&&"devext.arcgis.com"===a.portalHostname||n&&"qaext.arcgis.com"===a.portalHostname||n&&"www.arcgis.com"===a.portalHostname&&a.user&&"jsapi"===a.urlKey)?(0,s.h)(s.F,null,(0,s.h)("div",{class:"gallery-block"},(0,s.h)("div",{class:"generate-block"},(0,s.h)("calcite-icon",{icon:"effects"}),(0,s.h)("calcite-label",{layout:"inline-space-between"},(0,s.h)("div",null,(0,s.h)("div",{class:"generate-title"},i.panels.gallery.styleWithAI),(0,s.h)("div",{class:"generate-description"},i.panels.gallery.styleWithAIMsg)),(0,s.h)("calcite-button",{class:"generate-button",onClick:this.handleGenerateClick},i.panels.gallery.go)))),(0,s.h)("div",{class:"separator"},(0,s.h)("div",{class:"separator-line"}),(0,s.h)("span",{class:"separator-text"},i.panels.gallery.or),(0,s.h)("div",{class:"separator-line"}))):(0,s.h)(s.F,null)}renderStepOne(){const{smartMappingState:e}=this,{layer:t,selectedFields:a,strings:i,useFeatureReduction:n}=e,r=a.length,l=(0,h.x)(e).string>0,o=3===r&&(a[2].expression||a[2].featureReductionExpression),c=n&&2===r&&a[0].simpleFieldType===h.w.DATE,d=3===r&&a[2].simpleFieldType===h.w.DATE,p=a.map(((e,t)=>this.renderAttribute(t))),m=r>1&&!l&&!o&&!d&&!c;return(0,s.h)("div",{class:"attributes gallery-block"},(0,s.h)("div",null,(0,s.h)("div",{class:"center"},(0,s.h)("calcite-icon",{class:"number-icon",icon:"number-circle-1"})),(0,s.h)("div",{class:"attributes-header-text center"},i.panels.gallery.chooseAttributes)),!r&&(0,s.h)("div",{class:"attributes-msg center"},i.panels.gallery.chooseAttributesMsg),(0,s.h)("calcite-list",{label:i.panels.gallery.attributes,class:p.length>0?"attribute-list":"",key:`gallery-attributes-selects-${a}`,dragEnabled:m,onCalciteListOrderChange:this.handleListOrderChange},p),t&&this.renderAddButtons(),t&&this.renderTip())}renderAttribute(e){const{smartMappingState:t}=this,{selectedFields:a,strings:i,useFeatureReduction:n}=t,r=a[e].field||a[e].expressionTitle||a[e].featureReductionExpressionTitle,l=!!a[e].expression,o=(0,h.y)(t,a[e].field),c=o?o.label:a[e].expressionTitle||a[e].featureReductionExpressionTitle,d=a[e].simpleFieldType,p=!l&&(d===h.w.NUMBER?"number":n&&["date","timestamp-offset"].includes((0,h.F)(t,o.layerField))?"date-time":d===h.w.STRING?"date-only"===(0,h.F)(t,o.layerField)?"calendar":"string":d===h.w.DATE?"date-time":null);return(0,s.h)("calcite-list-item",{key:`gallery-attribute-${e}-${r}`,label:c,value:e,onClick:t=>t.target&&this.handleListChange(e),onKeyDown:t=>{" "===t.key&&(t.preventDefault(),this.handleListChange(e))}},p&&(0,s.h)("div",{slot:"actions-end"},(0,s.h)("calcite-icon",{scale:"s",icon:p,class:"field-type"})),(0,s.h)("calcite-action",{key:`gallery-attribute-${e}-${r}-remove`,slot:"actions-end",text:l?i.panels.gallery.removeExpression:i.panels.gallery.removeField,label:l?i.panels.gallery.removeExpression:i.panels.gallery.removeField,onClick:t=>{t.stopPropagation(),this.handleRemoveAttribute(e)},onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.stopPropagation(),this.handleRemoveAttribute(e))}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}renderTip(){const{selectedFields:e,portal:t,strings:a}=this.smartMappingState;if(e.length>1)return(0,s.h)(s.F,null);if(!e.length&&(0,h.L)(h.R.ARCGIS_COMPONENT_NOTIFICATIONS,h.Q.SMART_MAPPING_TIP1_DISMISSED)||1===e.length&&(0,h.L)(h.R.ARCGIS_COMPONENT_NOTIFICATIONS,h.Q.SMART_MAPPING_TIP2_DISMISSED))return(0,s.h)(s.F,null);const i=a.panels.gallery.tip1.indexOf("${smartMappingLink}"),n=t.helpMap?.m||t.helpMap,r=a.panels.gallery.tip1.replace("${smartMappingLink}",a.panels.gallery.tip1Link);return(0,s.h)("div",{key:"gallery-tip",class:"tip"},(0,s.h)("calcite-input-message",{key:"gallery-tip-message",icon:"lightbulb",class:"tip-message"},0===e.length&&t.helpBase&&n?(0,s.h)("div",{key:"gallery-tip-text"},(0,s.h)("span",{class:"tip-text"},a.panels.gallery.tip1.substring(0,i)),(0,s.h)("calcite-link",{target:"_blank",href:`${t.helpBase}${n[120003249]}`},a.panels.gallery.tip1Link),(0,s.h)("span",{class:"tip-text"},a.panels.gallery.tip1.substring(i+19))):0===e.length?(0,s.h)("span",{key:"gallery-tip-text",class:"tip-text"},r," "):(0,s.h)("span",{key:"gallery-tip-text",class:"tip-text"},a.panels.gallery.tip2)),(0,s.h)("calcite-action",{scale:"s",label:a.close,text:a.close,onClick:()=>{const{selectedFields:e}=this.smartMappingState;e.length?(0,h.M)(h.R.ARCGIS_COMPONENT_NOTIFICATIONS,{key:h.Q.SMART_MAPPING_TIP2_DISMISSED,value:"true"}):(0,h.M)(h.R.ARCGIS_COMPONENT_NOTIFICATIONS,{key:h.Q.SMART_MAPPING_TIP1_DISMISSED,value:"true"}),(0,s.f)(this.el)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}renderAddButtons(){const{smartMappingState:e}=this,{layer:t,mapImageSublayer:a,selectedFields:i,strings:n,supportsArcade:r}=e,l=i.length,o=(0,h.N)(e),c=(0,h.x)(e),d=c.string>0,p=c.date>0,m=c.expression>0,g=t.capabilities?.query?.supportsSqlExpression,u=(0,h.g)(e),f=(0,h.d)(u,"reference-size"),y=(0,h.d)(u,"spike");let S=!(a&&!r&&1===l||!(l<10)||2===l&&(d||m)||a&&2===l&&p||"subtype-sublayer"===t.type&&(m||p||d)||3===l&&(p||i[2].expression||i[2].featureReductionExpression||!g));S=S&&(1===c.string&&c.number+c.date===0&&o.number+o.date>0||0===c.string&&c.date<2&&c.number+c.date<3&&c.string+c.number+c.date<o.string+o.number+o.date||c.number>=2&&c.number<o.number);const b=!f&&!y&&(!a||r)&&!("subtype-sublayer"===t.type&&l>0)&&(l<2||2===l&&!m&&i[0].simpleFieldType===h.w.NUMBER&&i[1].simpleFieldType===h.w.NUMBER);return(0,s.h)("div",{class:"add-button-div"},(0,s.h)("div",{class:"add-buttons"},(0,s.h)("calcite-button",{disabled:!S,onClick:()=>this.openFieldPickList(),appearance:"outline-fill",kind:"neutral",width:"full",label:n.panels.gallery.addField,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addFieldButtonNode=e},n.panels.gallery.field),(0,s.h)("span",null,"\xa0\xa0"),(0,s.h)("calcite-button",{disabled:!b,onClick:this.addExpression,appearance:"outline-fill",kind:"neutral",width:"full",label:n.panels.gallery.addExpression,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addExpressionButtonNode=e},n.expression)))}renderStepTwo(){const{smartMappingState:e}=this,{selectedFields:t,strings:a}=e,i=function(e){const{layer:t,useFeatureReduction:a,mapImageSublayer:s,selectedFields:i,supportsArcade:n}=e,r="ogc-feature"===t.type,l="wfs"===t.type,o="stream"===t.type,c="parquet"===t.type,d="subtype-sublayer"===t.type,p="featureReduction"in t&&t.featureReduction,m=i.length,g=(0,h.x)(e),u=g.string>0,f=g.date>0,y=g.expression>0,S=t.capabilities?.query?.supportsSqlExpression,b=r||l||o||c||S,C=[];return C.push("simple"),1!==m||u||(s||d)&&f||C.push("color"),1!==m||u||(s||d)&&f||C.push("size"),s&&!n||d||1!==m||!f||y||!b||C.push("color-age"),s&&!n||d||1!==m||!f||y||!b||C.push("size-age"),s&&!n||d||1!==m&&2!==m||u||s&&f||C.push("color-size"),s&&!n||d||2!==m||u||!f||i[0].simpleFieldType!==h.w.DATE||i[0].expression||i[0].featureReductionExpression||!b||s&&g.date>1||C.push("color-age-size"),s&&!n||d||2!==m||u||!f||i[1].simpleFieldType!==h.w.DATE||i[1].expression||i[1].featureReductionExpression||!b||s&&g.date>1||C.push("color-size-age"),(!s||n)&&!d&&m>0&&m<=8&&!y&&(0,h.e)(e)&&!u&&!f&&b&&C.push("dot-density"),(!s||n)&&m>1&&m<=10&&!y&&!u&&!f&&b&&C.push("predominance"),s&&!n||d||!(m>1)||y||u||f||!b||C.push("predominance-size"),!s&&!d&&(!p||"binning"===p.type)&&m>1&&m<=10&&!y&&["polygon","point","multipoint"].includes((0,h.I)(e))&&!u&&!f&&b&&C.push("chart"),s||d||p&&"binning"!==p.type||d||!(m>1)||y||!["polygon","point","multipoint"].includes((0,h.I)(e))||u||f||!b||C.push("chart-size"),s&&!n||d||2!==m||y||u||f||C.push("relationship"),s&&!n||d||3!==m||y&&(1!==g.expression||!i[2].expression&&!i[2].featureReductionExpression)||s&&f||C.push("relationship-size"),s&&!n||d||2!==m||y||u||f||C.push("compare"),1!==m||s&&f||C.push("type"),s&&!n||d||2!==m||!(g.date<2)||s&&f||C.push("type-size"),(!s||n)&&!d&&2===m&&f&&g.date<2&&i[1].simpleFieldType===h.w.DATE&&i[1].field&&b&&C.push("type-size-age"),s&&!n||d||!["point","multipoint"].includes((0,h.I)(e))||p&&("binning"!==p?.type||a)||!(b&&m<=1||!b&&0===m)||u||f||0!==g.expression||C.push("heatmap"),C}(e),n=function(e){const t=(0,h.k)(e),a=(0,h.r)(e),s=a.length>0?a[0].simpleFieldType:null;let i=[];switch(t){case"simple":i=["simple","color","size","color-age","size-age","color-size","type","heatmap","dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"];break;case"type":i=["type","color","size","color-age","size-age","color-size","dot-density","heatmap","simple","type-size","type-size-age","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","compare","relationship","relationship-size"];break;case"color":i=["color","size","color-age","size-age","color-size","dot-density"],i="string"===s||"date"===s?i.concat(["type","heatmap","simple"]):i.concat(["heatmap","simple","type"]),i=i.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"color-age":i=["color-age","color","size","size-age","color-size","dot-density"],i="string"===s||"date"===s?i.concat(["type","heatmap","simple"]):i.concat(["heatmap","simple","type"]),i=i.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size":i=["size","size-age","color","color-age","color-size","dot-density"],i="string"===s||"date"===s?i.concat(["type","heatmap","simple"]):i.concat(["heatmap","simple","type"]),i=i.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size-age":i=["size-age","size","color-age","color","color-size","dot-density"],i="string"===s||"date"===s?i.concat(["type","heatmap","simple"]):i.concat(["heatmap","simple","type"]),i=i.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"heatmap":i=["heatmap","color","size","color-age","size-age","color-size","dot-density"],i="string"===s?i.concat(["type","simple"]):i.concat(["simple","type"]),i=i.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"predominance":i=["predominance","predominance-size","chart","chart-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],i="string"===s?i.concat(["type","simple"]):i.concat(["simple","type"]);break;case"chart":i=["chart","chart-size","predominance","predominance-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],i="string"===s?i.concat(["type","simple"]):i.concat(["simple","type"]);break;case"dot-density":i=["dot-density","color-size","color-age-size","color-size-age","predominance","predominance-size","chart","chart-size","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],i="string"===s?i.concat(["type","simple"]):i.concat(["simple","type"]);break;case"compare":i=["compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===s&&(i=i.concat(["type"])),i=i.concat(["simple"]),s&&"string"===s||(i=i.concat(["type"]));break;case"relationship":i=["relationship","relationship-size","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===s&&(i=i.concat(["type"])),i=i.concat(["simple"]),s&&"string"===s||(i=i.concat(["type"]));break;case"color-size":i=["color-size","color-age-size","color-size-age","color","size","color-age","size-age","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","type","heatmap","simple"];break;case"color-age-size":i=["color-age-size","color-size-age","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"color-size-age":i=["color-size-age","color-age-size","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"type-size":i=["type-size","type-size-age","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type","size","simple","color","color-age","size-age","heatmap","compare","relationship","relationship-size"];break;case"type-size-age":i=["type-size-age","type-size","color-age-size","color-size-age","color-size","dot-density","predominance","predominance-size","chart","chart-size","type","size","size-age","simple","color","color-age","heatmap","compare","relationship","relationship-size"];break;case"predominance-size":i=["predominance-size","predominance","chart-size","chart","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],i="string"===s?i.concat(["type","simple"]):i.concat(["simple","type"]);break;case"chart-size":i=["chart-size","chart","predominance-size","predominance","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],i="string"===s?i.concat(["type","simple"]):i.concat(["simple","type"]);break;case"relationship-size":i=["relationship-size","relationship","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===s&&(i=i.concat(["type"])),i=i.concat(["simple"]),"string"!==s&&(i=i.concat(["type"]));break;default:i=["color","size","color-age","size-age","color-size"],"string"===s&&(i=i.concat(["type"])),i=i.concat(["heatmap","simple"]),"string"!==s&&(i=i.concat(["type"])),i=i.concat(["dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"])}return i}(e),r=t?.length?1===t.length&&t[0].field&&t[0].simpleFieldType===h.w.NUMBER?a.panels.gallery.styleMsg.oneNumber:2===t.length&&t[0].field&&t[1].field&&t[0].simpleFieldType===h.w.NUMBER&&t[1].simpleFieldType===h.w.NUMBER?a.panels.gallery.styleMsg.multipleNumber:a.panels.gallery.styleMsg.any:a.panels.gallery.styleMsg.empty;i.sort(((e,t)=>n.indexOf(e)-n.indexOf(t)));const l=i.map(((e,t)=>this.renderStyleTile(e,t)));return(0,s.h)("div",{class:"gallery-block"},(0,s.h)("div",{class:"style-tiles"},(0,s.h)("div",{class:"attributes-header"},(0,s.h)("div",{class:"center"},(0,s.h)("calcite-icon",{class:"number-icon",icon:"number-circle-2"})),(0,s.h)("div",{class:"styles-msg-title center"},a.panels.gallery.pickStyle),(0,s.h)("div",{class:"styles-msg center"},r)),l))}renderStyleTile(e,t){const{smartMappingState:a}=this,i=(0,h.g)(a),{selectedFields:n}=a,r=(0,h.k)(a),l=(0,h.z)(a),o=`${n?.[0]?.simpleFieldType===h.w.DATE}\n        ${n?.[1]?.simpleFieldType===h.w.DATE}`,c=(0,h.d)(i,"reference-size"),d=(0,h.S)(c),p=(0,h.d)(i,"spike"),m=(0,h.S)(p);return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${e}-${l}-${d}-${m}-${o}`,tileType:"gallery",type:e,selected:e===r,ref:e=>{e&&(this.tileNodes[t]=e)},onArcgisSmartMappingTileSelect:()=>this.handleSelectClick(e),onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick(e),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsGalleryError.emit(e.detail),onArcgisSmartMappingTileThemeChange:()=>(0,s.f)(this.el)})}addField(e){const{smartMappingState:t}=this,{layer:a,selectedFields:s,modules:i,useFeatureReduction:n}=t;(0,h.O)(t,e);const r=n?s.find((e=>"aggregateCount"===e.field)):void 0,l=r?i.esriLang.clone(s).filter((e=>"aggregateCount"!==e.field)):i.esriLang.clone(s);if(e.forEach((e=>{const s=(0,h.y)(t,e);let i;if("featureReduction"in a&&n){i=a.featureReduction.fields.find((e=>e.name===s.layerField.name&&e.onStatisticExpression))}s.simpleFieldType===h.w.STRING||n&&s.simpleFieldType===h.w.DATE?i?l.unshift({field:e,simpleFieldType:s.simpleFieldType,featureReductionExpression:i.onStatisticExpression.expression,featureReductionExpressionTitle:i.onStatisticExpression.title??void 0}):l.unshift({field:e,simpleFieldType:n&&s.simpleFieldType===h.w.DATE?h.w.DATE:h.w.STRING}):i?l.push({field:e,simpleFieldType:s.simpleFieldType,featureReductionExpression:i.onStatisticExpression.expression,featureReductionExpressionTitle:i.onStatisticExpression.title??void 0}):l.push({field:e,simpleFieldType:s.simpleFieldType})})),3===l.length)for(let e=0;e<3;e++){const t=l[e];if(t.simpleFieldType===h.w.DATE&&2!==e){l.splice(e,1),l.splice(2,0,t);break}}r&&l.push(r),(0,h.C)(s,l)||(this.smartMappingState.selectedFields=l,ie(t,this.galleryRequestWrapper))}editAttribute(e,t){const{smartMappingState:a}=this,{layer:s,selectedFields:i,modules:n,useFeatureReduction:r}=a;(0,h.O)(a,e);const l=n.esriLang.clone(i);e.forEach((e=>{const n=(0,h.y)(a,e);let l;if("featureReduction"in s&&r){l=s.featureReduction.fields.find((e=>e.name===n.layerField.name&&e.onStatisticExpression))}n.simpleFieldType===h.w.STRING||r&&n.simpleFieldType===h.w.DATE?(i.splice(t,1),l?i.unshift({field:e,simpleFieldType:n.simpleFieldType,featureReductionExpression:l.onStatisticExpression.expression,featureReductionExpressionTitle:l.onStatisticExpression.title??void 0}):i.unshift({field:e,simpleFieldType:r&&n.simpleFieldType===h.w.DATE?h.w.DATE:h.w.STRING})):i[t]=l?{field:e,simpleFieldType:n.simpleFieldType,featureReductionExpression:l.onStatisticExpression.expression,featureReductionExpressionTitle:l.onStatisticExpression.title??void 0}:{field:e,simpleFieldType:n.simpleFieldType}})),(0,h.C)(i,l)||(this.smartMappingState.selectedFields=i,ie(a,this.galleryRequestWrapper))}appendFlowItem(e){const{flowNode:t}=this,a=(0,p.f)(this.el,"arcgis-smart-mapping");(0,h.K)(this.el)?t.appendChild(e):a.appendChild(e),this.setUpWatchBinScale(!1)}removeFlowItem(e){const{flowNode:t}=this,a=(0,p.f)(this.el,"arcgis-smart-mapping");(0,h.K)(this.el)?t.removeChild(e):a.removeChild(e),this.setUpWatchBinScale(!0),this.selected=!0}checkCluster(){const{layer:e}=this.smartMappingState;"featureReduction"in e&&e.featureReduction&&this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()}checkClusterRenderer(){const{layer:e}=this.smartMappingState;if("featureReduction"in e&&"cluster"===e.featureReduction?.type){const t=e.featureReduction;t.renderer=void 0,e.featureReduction=t.clone()}}handleArcadeTimeExpressionChange(){this.hasArcadeTimeExpressionChange&&(this.arcgisSmartMappingPanelsGalleryArcadeTimeExpressionChange.emit(),this.hasArcadeTimeExpressionChange=!1)}openFieldPickList(e=!1,t){(0,h.J)();const{fields:a,selectedFields:s}=this.smartMappingState,i=s.map((e=>e.field)),n=a.filter((a=>{let s=!i.includes(a.layerField.name);return e&&(s=s||a.layerField.name===i[t]),s})),r=document.createElement("arcgis-smart-mapping-field-pick-list");r.smartMappingState=this.smartMappingState,r.fields=n,r.popoverProps={refElement:this.flowItemNode,placement:"leading",popoverWidth:1.05*this.flowItemNode.getBoundingClientRect().width,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!0},r.singleEditMode=e,r.fieldToReplace=e?s[t]:void 0,r.lastSortBy=this.lastSortBy,document.body.appendChild(r),(0,h.P)(this.flowItemNode,!0),r.addEventListener("arcgisSmartMappingFieldPickListClose",(a=>{document.body.removeChild(r),(0,h.P)(this.flowItemNode,!1),a.detail?.selectedFields&&(e?this.editAttribute(a.detail.selectedFields,t):this.addField(a.detail.selectedFields)),this.addFieldButtonNode.setFocus()})),r.addEventListener("arcgisSmartMappingFieldPickListSortByChange",(e=>this.lastSortBy=e.detail))}cleanUpFlowItem(e){this.focusSelectedTile(),this.removeFlowItem(e),this.selected=!0}focusSelectedTile(){this.setUpWatchBinScale(!0),setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[0]?.setFocus())))),300)}setUpWatchBinScale(e){this.scaleHandle?.remove(),e&&(this.scaleHandle=(0,b.w)(this.smartMappingState,this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel"))))}get el(){return(0,s.a)(this)}};le.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.clustering-warning-notice {\n  margin: var(--calcite-spacing-lg);\n}\n\n.generate-block {\n  --calcite-panel-background-color: var(--calcite-color-foreground-1);\n  padding: 0 var(--calcite-spacing-sm);\n}\n\n.generate-title {\n  font-weight: var(--calcite-font-weight-bold);\n  padding-top: var(--calcite-spacing-xs);\n  font-size: var(--calcite-font-size-0);\n}\n\n.generate-description {\n  padding-top: var(--calcite-spacing-xs);\n  font-size: var(--calcite-font-size--1);\n}\n\n.generate-button {\n  padding-right: var(--calcite-spacing-xs);\n}\n\n:dir(rtl) {\n  .generate-button {\n    padding-left: var(--calcite-spacing-xs);\n    padding-right: 0;\n  }\n}\n\n.separator {\n  display: flex;\n  align-items: center;\n  margin-bottom: var(--calcite-spacing-sm);\n}\n\n.separator-line {\n  flex-grow: 1;\n  height: var(--calcite-spacing-px);\n  background-color: var(--calcite-color-border-1);\n  margin: 0 var(--calcite-spacing-md);\n}\n\n.separator-text {\n  padding: 0 var(--calcite-spacing-xl);\n  color: var(--calcite-color-text-1);\n  font-weight: var(--calcite-font-weight-bold);\n}\n\n.add-button-div {\n  margin: 0 3px;\n}\n\n.add-buttons {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  background-color: #ffffff;\n}\n.attributes {\n  padding: 6px 6px 0 6px;\n  background-color: #ffffff;\n}\n.attributes-header-text {\n  font-weight: bold;\n  font-size: 16px;\n  padding: 10px 0;\n}\n.attributes-msg {\n  font-size: var(--calcite-font-size--2);\n}\n.attributes-add-new {\n  margin-top: 10px;\n}\n.tip {\n  margin-top: 15px;\n  display: flex;\n  justify-content: space-between;\n}\n.tip-message {\n  justify-content: center;\n}\n.tip-text {\n  color: #3d5f1d;\n}\n.tip-close {\n  margin-top: 4px;\n}\n.field-type {\n  display: flex;\n  align-items: center;\n  height: 100%;\n  color: var(--calcite-color-text-1);\n}\n.attribute-list {\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.gallery-block {\n  padding: 12px 3px;\n  margin-bottom: 12px;\n  background-color: #ffffff;\n  box-shadow:\n    0 1px 10px 2px rgba(0, 0, 0, 0.05),\n    0 0 0 1px #e0e0e0;\n}\n.style-tiles {\n  /* calcite-checkbox bug in RTL */\n  overflow-x: hidden;\n}\n.center {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n}\n.number-icon {\n  color: var(--calcite-color-brand);\n}\n.styles-msg-title {\n  padding: 6px;\n  font-weight: bold;\n  font-size: 16px;\n  display: flex;\n  justify-content: center;\n}\n.styles-msg {\n  font-size: var(--calcite-font-size--2);\n}\n";const oe=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsRasterClassBreaksClose=(0,s.c)(this,"arcgisSmartMappingPanelsRasterClassBreaksClose",7),this.arcgisSmartMappingPanelsRasterClassBreaksBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRasterClassBreaksBackClick",7),this.arcgisSmartMappingPanelsRasterClassBreaksError=(0,s.c)(this,"arcgisSmartMappingPanelsRasterClassBreaksError",7),this.manager=(0,o.u)(this),this.symbolNodes=[],this.labelNodes=[],this.inputNodes=[],this.disconnected=!1,this.smartMappingState=(0,m.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterClassBreaksClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,smartMappingState:t}=this;(0,h.u)(t,e),this.arcgisSmartMappingPanelsRasterClassBreaksClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{modules:e}=this.smartMappingState,t=(0,h.m)(this.smartMappingState);this.originalRendererObj=e.esriLang.clone((0,h.m)(this.smartMappingState)),this.defaultColorRamp=t.classBreakInfos.map((e=>e.symbol.color))}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}disconnectedCallback(){this.disconnected=!0,clearTimeout(this.definedIntervalChangeHandle),clearTimeout(this.classesChangeHandle)}render(){const{hideLayerTitle:e,layer:t,strings:a}=this.smartMappingState,i=t.title;return(0,s.h)(s.H,{key:"7a20dfd0b0db23e40a597f5ca3750f77af54aa21",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"7c52c58fefb93abde772f78ca66e88c0e656686e",heading:a.panels.classBreaks.styleOptions,description:e?void 0:i,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRasterClassBreaksBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderFooterButtons()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.V)(e,t.panels.classBreaks.classBreaks);return(0,s.h)("calcite-block",{class:"class-breaks-block",heading:a,open:!0},this.renderManageStyleButton(),this.renderFieldSelector(),this.renderMethod(),this.renderClasses(),this.renderDefinedInterval(),this.renderColorScheme(),this.renderColorSlider(),this.renderValues())}renderManageStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"edit",originalRasterProps:{originalRendererObj:this.originalRendererObj},onArcgisDone:e=>{"delete"!==e.detail?(0,s.f)(this.el):this.arcgisSmartMappingPanelsRasterClassBreaksBackClick.emit("delete")},ref:e=>this.manageStyleButtonNode=e})}renderFieldSelector(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e).field||t.panels.classBreaks.value,i=function(e){const{rasterInfo:t,modules:a,strings:s}=e;let i;const n=t?.attributeTable?.fields;return i=n?n.filter((e=>"oid"!==e.type&&"string"!==e.type)):[new a.Field({name:"value",alias:s.panels.classBreaks.value})],i}(e),n=i.map((e=>({label:e.alias,layerField:e,simpleFieldType:h.w.STRING}))),r=i.find((e=>e.name===a));return(0,s.h)("arcgis-smart-mapping-attribute-input",{label:t.panels.classBreaks.field,fieldList:n,selectedField:{field:r?.name??t.panels.classBreaks.value,simpleFieldType:h.w.STRING},mode:"simple",popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingAttributeInputChange:e=>{if(e.detail){const t=e.detail.field;this.handleFieldChange(t)}}})}renderMethod(){const{smartMappingState:e}=this,t=(0,h.m)(e);return(0,s.h)("arcgis-smart-mapping-method-button",{key:t.authoringInfo.classificationMethod,showDefinedInterval:!0,onArcgisSmartMappingMethodButtonBeforeOpen:()=>(0,h.J)(),onArcgisSmartMappingMethodButtonChange:t=>{const a=(0,h.m)(e);if("manual"===t.detail){a.authoringInfo.classificationMethod="manual",(0,h.u)(e),(0,s.f)(this.el),setTimeout((()=>{this.methodButtonNode.setFocus()}),300)}else{let i,n=a?.authoringInfo?.numClasses||a.classBreakInfos?.length;if("defined-interval"===t.detail){const e=a.classBreakInfos;i=(e[e.length-1].maxValue-e[0].minValue)/5,n=Math.ceil((a.classBreakInfos[n-1].maxValue-a.classBreakInfos[0].minValue)/i)}(0,f.r)(T(e,{classificationMethod:t.detail,numClasses:n,definedInterval:i}),this.flowItemNode).then((e=>{this.updateRasterClassBreaksRenderer(e.renderer),(0,s.f)(this.el),setTimeout((()=>{this.methodButtonNode.setFocus()}),300)}),(e=>{(0,s.f)(this.methodButtonNode),this.arcgisSmartMappingPanelsRasterClassBreaksError.emit(e)}))}},ref:e=>{e&&(this.methodButtonNode=e)}})}renderClasses(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i=a.classBreakInfos.length,n=a.authoringInfo.classificationMethod;return(0,s.h)("calcite-label",null,t.panels.classBreaks.classifyClasses,(0,s.h)("calcite-input-number",{value:`${i}`,disabled:"defined-interval"===n,inputMode:"decimal",min:1,max:10,step:1,scale:"s",onCalciteInputNumberInput:(0,v.d)((()=>{if(this.disconnected)return;clearTimeout(this.classesChangeHandle);const e=Number.parseInt(this.classesNode.value);e!==i&&(!e||e<this.classesNode.min||e>this.classesNode.max?this.classesChangeHandle=setTimeout((()=>this.handleClassesChange()),3e3):this.handleClassesChange())}),300),ref:e=>{e&&(this.classesNode=e)}}))}renderDefinedInterval(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e);if("defined-interval"!==a.authoringInfo.classificationMethod)return(0,s.h)(s.F,null);const i=a.classBreakInfos[0].maxValue-a.classBreakInfos[0].minValue,n=Math.floor((a.classBreakInfos[a.classBreakInfos.length-1].maxValue-a.classBreakInfos[0].minValue)/9.1),r=a.classBreakInfos[a.classBreakInfos.length-1].maxValue-a.classBreakInfos[0].minValue;return(0,s.h)("calcite-label",null,t.panels.classBreaks.definedInterval,(0,s.h)("calcite-input-number",{value:""+Math.round(100*i)/100,inputMode:"decimal",min:n,max:r,step:.1,scale:"s",onCalciteInputNumberInput:e=>{clearTimeout(this.definedIntervalChangeHandle);const t=e.target,a=Number.parseFloat(t.value);!t.value||a<t.min||a>t.max?this.definedIntervalChangeHandle=setTimeout((()=>this.handleDefinedIntervalChange()),3e3):this.handleDefinedIntervalChange()},ref:e=>this.definedIntervalNode=e}))}renderColorScheme(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e).classBreakInfos.map((t=>(0,h.h)(e,t.symbol)));return(0,s.h)("arcgis-smart-mapping-symbol-button",{label:t.panels.classBreaks.colorScheme,type:"raster-class-breaks",rampType:"discrete",colors:a,onArcgisSmartMappingSymbolButtonSymbolChange:t=>{const a=t.target,i=(0,h.m)(e);this.defaultColorRamp=i.classBreakInfos.map((e=>e.symbol.color)),(0,h.u)(e),(0,s.f)(this.el),(0,s.f)(this.sliderNode),(0,s.f)(a)},ref:e=>this.symbolButtonNode=e})}renderColorSlider(){const{smartMappingState:e}=this;return(0,s.h)("arcgis-smart-mapping-class-breaks-color-slider",{onArcgisSmartMappingClassBreaksColorSliderChange:t=>{const a=(0,h.m)(e),i=t.detail;i?.updateValues&&(a.authoringInfo.classificationMethod="manual"),i?.invertColors&&(0,s.f)(this.symbolButtonNode),(0,s.f)(this.el),(0,s.f)(this.sliderNode),this.defaultColorRamp=a.classBreakInfos.map((e=>e.symbol.color))},ref:e=>this.sliderNode=e})}renderValues(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e);return this.labelNodes=[],this.inputNodes=[],(0,s.h)("calcite-list",{label:t.panels.classBreaks.classBreaks},a.classBreakInfos.map(((e,t)=>this.renderValue(e,t))).reverse())}renderValue(e,t){return(0,s.h)("calcite-list-item",null,(0,s.h)("div",{class:"symbol-container",slot:"actions-start"},this.renderSymbolNode(e,t)),this.renderTextNode(e,t))}renderSymbolNode(e,t){const{smartMappingState:a}=this,{strings:i}=a,n=(0,h.m)(a).classBreakInfos[t].symbol.clone(),r={"symbol-is-white":(0,h.T)(a,n),symbol:!0};return(0,s.h)("div",{class:r,tabindex:"0","aria-label":i.panels.classBreaks.accessibility.editColorFor.replace("${value}",e.label),"aria-haspopup":"true",ref:e=>{e&&this.symbolNodes.unshift(e)},onClick:()=>{this.popoverNode?(this.symbolNodes[this.selectedPopoverIdx].classList.remove("selected"),this.selectedPopoverIdx===t?((0,h.J)(),this.popoverNode=void 0,this.selectedPopoverIdx=void 0):(this.selectedPopoverIdx=t,this.handleValueSymbolClick(t))):(this.selectedPopoverIdx=t,this.handleValueSymbolClick(t))},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleValueSymbolClick(t))}},(0,s.h)("div",{ref:e=>{e&&this.afterCreateValueSymbol(e,t)}}))}renderTextNode(e,t){const{strings:a}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("div",{class:"label",slot:"content",tabindex:"0",ref:e=>{e&&this.labelNodes.unshift(e)},"aria-label":a.panels.classBreaks.accessibility.editLabelFor.replace("${value}",e.label),onClick:e=>{const a=this.inputNodes[t];a.classList.remove("hidden"),a.setFocus(),e.target.classList.add("hidden")},onKeyDown:e=>{if(" "===e.key||"Enter"===e.key){const a=this.inputNodes[t];a.classList.remove("hidden"),a.setFocus(),e.target.classList.add("hidden")}}},e.label),(0,s.h)("calcite-input",{slot:"content",class:"hidden",scale:"s",ref:e=>{e&&this.inputNodes.unshift(e)},value:e.label??void 0,onCalciteInputChange:e=>{this.inputNodes[t].classList.add("hidden"),this.labelNodes[t].classList.remove("hidden"),this.handleValueTextChange(t,e)},onFocusout:e=>{this.inputNodes[t].classList.add("hidden"),this.labelNodes[t].classList.remove("hidden"),this.handleValueTextChange(t,e)},onKeyDown:a=>{if(a.stopPropagation(),"Escape"===a.key||"Enter"===a.key){this.inputNodes[t].classList.add("hidden");const s=a.currentTarget;s.value=e.label||"",s.disabled=!0,this.handleValueTextChange(t,a),this.labelNodes[t].classList.remove("hidden"),s.disabled=!1,setTimeout((()=>this.labelNodes[t].focus()),300)}}}))}renderFooterButtons(){return(0,s.h)("div",{class:"footer-buttons",slot:"footer"},this.renderDoneButton(),this.renderRegisterStyleButton(),this.renderCancelButton())}renderRegisterStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"register",onArcgisDone:e=>{const{smartMappingState:t}=this,{modules:a}=t;if((0,s.f)(this.el),"register"===e.detail){const e=(0,h.m)(t);this.originalRendererObj=a.esriLang.clone(e)}this.manageStyleButtonNode&&(0,s.f)(this.manageStyleButtonNode),(0,s.f)(this.registerStyleButtonNode)},ref:e=>this.registerStyleButtonNode=e})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.done,onClick:this.handleDone,appearance:"solid",width:"full"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.cancel)}handleFieldChange(e){const{smartMappingState:t}=this,a=(0,h.m)(t);(0,f.r)(T(t,{field:e}),this.flowItemNode).then((e=>this.updateRasterClassBreaksRenderer(e.renderer)),(e=>{this.fieldNode.value=a.field,this.arcgisSmartMappingPanelsRasterClassBreaksError.emit(e)}))}handleDefinedIntervalChange(){const{smartMappingState:e}=this,t=(0,h.m)(e),a=t.classBreakInfos[0].maxValue-t.classBreakInfos[0].minValue;let s=Number.parseFloat(this.definedIntervalNode.value);s!==a&&(Number.isNaN(s)||s<this.definedIntervalNode.min?s=this.definedIntervalNode.min:s>this.definedIntervalNode.max&&(s=this.definedIntervalNode.max),s=Number.parseFloat(s.toFixed(2)),this.definedIntervalNode.value=`${s}`,(0,f.r)(T(e,{definedInterval:s}),this.flowItemNode).then((e=>this.updateRasterClassBreaksRenderer(e.renderer)),(e=>{this.definedIntervalNode.value=`${a}`,this.arcgisSmartMappingPanelsRasterClassBreaksError.emit(e)})))}handleClassesChange(){(0,h.J)();const{smartMappingState:e}=this,t=(0,h.m)(e),a=t.classBreakInfos.length,{authoringInfo:s}=t||{};s.numClasses=this.classesNode.value?Number.parseInt(this.classesNode.value,10):0;const i=s.classificationMethod;"manual"===i&&(s.classificationMethod="equal-interval");const n=Math.min(Math.max(Number.parseInt(this.classesNode.value),1),10)||5;`${n}`!==this.classesNode.value&&(this.classesNode.value=`${n}`),(0,f.r)(T(e,{numClasses:n}),this.flowItemNode).then((e=>{"manual"===i&&(e.renderer.authoringInfo.classificationMethod="manual"),this.updateRasterClassBreaksRenderer(e.renderer)}),(e=>{this.classesNode.value=`${a}`,this.arcgisSmartMappingPanelsRasterClassBreaksError.emit(e)}))}afterCreateValueSymbol(e,t){const{smartMappingState:a}=this,{modules:s}=a,i=(0,h.m)(a).classBreakInfos[t].symbol.clone();for(-1===t&&i.outline&&(i.outline.width=0),(0,h.T)(a,i)&&(i.outline=new s.SimpleLineSymbol({color:"#bdc3c7",width:.75}));e?.childNodes?.length;)e.removeChild(e.childNodes[0]);const{symbolUtils:n}=s;i&&n.renderPreviewHTML(i,{size:(0,h.U)(i),ignoreWhiteSymbols:!0,symbolConfig:{isSquareFill:!0}}).then((t=>e?.appendChild(t)))}handleValueSymbolClick(e){(0,h.J)();const{smartMappingState:t}=this,{strings:a}=t,i=(0,g.b)(t,{referenceElement:this.flowItemNode,heading:a.panels.classBreaks.colorScheme});i.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,g.r)(i),setTimeout((()=>{this.symbolNodes[e].focus(),this.popoverNode=void 0,this.symbolNodes[e].classList.remove("selected")}),300)})),i.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,g.r)(i),setTimeout((()=>{this.popoverNode=void 0,this.symbolNodes[e].classList.remove("selected")}),300)})),this.smartMappingState.classedSymbolSelectedIdx=e,(0,C.b)(t,{popoverNode:i,onChange:()=>{(0,h.u)(t),(0,s.f)(this.el),(0,s.f)(this.sliderNode)}}),this.popoverNode=i,this.symbolNodes[e].classList.add("selected")}handleValueTextChange(e,t){const{smartMappingState:a}=this,i=(0,h.m)(a),n=t.currentTarget;if(i.classBreakInfos[e].label=n.value,""===n.value){const t=i.classBreakInfos[e];t.label=`${t.minValue.toLocaleString()} - ${t.maxValue.toLocaleString()}`,this.inputNodes[e].value=this.labelNodes[e].textContent}(0,h.u)(a),(0,s.f)(this.el)}handleInversionStatus(e){const{smartMappingState:t}=this,{modules:a}=t;if(JSON.stringify(this.defaultColorRamp[0])!==JSON.stringify(e.classBreakInfos[0].symbol.color)){let s=e.classBreakInfos.map((e=>(0,h.h)(t,e.symbol)||new a.EsriColor({r:64,g:64,b:64,a:1})));s=s.reverse(),e.classBreakInfos.forEach(((e,a)=>{(0,h.h)(t,e.symbol)&&(0,h.j)(t,e.symbol,s[a])}))}else this.defaultColorRamp=e.classBreakInfos.map((e=>e.symbol.color))}updateRasterClassBreaksRenderer(e){const{smartMappingState:t}=this;this.handleInversionStatus(e),(0,h.u)(t,e),(0,s.f)(this.el),(0,s.f)(this.sliderNode)}get el(){return(0,s.a)(this)}};oe.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.class-breaks-block{overflow-x:hidden;overflow-wrap:anywhere}.hidden{display:none}.symbol{margin-left:2px;margin-right:2px}.label:focus,.symbol:focus{outline:2px solid var(--calcite-color-brand)}.label,.symbol-container{padding-top:5px;padding-bottom:5px}.selected{outline:1px solid var(--calcite-color-brand)}.footer-buttons{width:100%;display:flex;flex-direction:column;gap:var(--calcite-spacing-sm)}";const ce=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsRasterColormapClose=(0,s.c)(this,"arcgisSmartMappingPanelsRasterColormapClose",7),this.arcgisSmartMappingPanelsRasterColormapBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRasterColormapBackClick",7),this.manager=(0,o.u)(this),this.inputNodes=[],this.labelNodes=[],this.smartMappingState=(0,m.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterColormapClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,smartMappingState:t}=this;(0,h.u)(t,e),this.arcgisSmartMappingPanelsRasterColormapClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{modules:e}=this.smartMappingState,t=(0,h.m)(this.smartMappingState);this.originalRendererObj=e.esriLang.clone((0,h.m)(this.smartMappingState)),t.colormapInfos.forEach(((e,a)=>{e.label||(t.colormapInfos[a].label=" ")})),(0,h.u)(this.smartMappingState)}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}render(){const{hideLayerTitle:e,layer:t,strings:a}=this.smartMappingState,i=t.title;return(0,s.h)(s.H,{key:"36d548ad368efccbb0f166468481a13cbbad617b",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"a537bdf1b2ab306880ad1e67ab96ccdf7751ed67",heading:a.panels.colormap.styleOptions,description:e?void 0:i,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRasterColormapBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderFooterButtons()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.V)(e,t.panels.colormap.colormap);return(0,s.h)("calcite-block",{class:"colormap-block",heading:a,open:!0},this.renderManageStyleButton(),this.renderColormapTable())}renderManageStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"edit",originalRasterProps:{originalRendererObj:this.originalRendererObj},onArcgisDone:e=>{"delete"!==e.detail?(0,s.f)(this.el):this.arcgisSmartMappingPanelsRasterColormapBackClick.emit("delete")},ref:e=>this.manageStyleButtonNode=e})}renderColormapTable(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e);this.labelNodes=[],this.inputNodes=[];const i=a.colormapInfos.map(((e,t)=>this.renderColormapRow(e,t)));return(0,s.h)("calcite-table",{class:"table",caption:t.panels.colormap.colormapTable},(0,s.h)("calcite-table-row",{slot:"table-header"},(0,s.h)("calcite-table-header",{heading:t.panels.colormap.color,alignment:"center"}),(0,s.h)("calcite-table-header",{heading:t.panels.colormap.value,alignment:"center"}),(0,s.h)("calcite-table-header",{heading:t.panels.colormap.label,alignment:"center"})),i)}renderColormapRow(e,t){return(0,s.h)("calcite-table-row",null,(0,s.h)("calcite-table-cell",{alignment:"center"},this.renderColorNode(e)),(0,s.h)("calcite-table-cell",{alignment:"center"},e.value),(0,s.h)("calcite-table-cell",{alignment:"center",class:"label-cell"},this.renderLabelNode(e,t)))}renderColorNode(e){return(0,s.h)("div",{class:"color",ref:t=>{t&&this.afterCreateColor(t,e)}})}renderLabelNode(e,t){const{strings:a}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("div",{class:"label",tabindex:"0",ref:e=>{e&&(this.labelNodes[t]=e)},"aria-label":a.panels.classBreaks.accessibility.editLabelFor.replace("${value}",e.label),onClick:e=>{const a=this.inputNodes[t];a.classList.remove("hidden"),a.setFocus(),e.target.classList.add("hidden")},onKeyDown:e=>{if(" "===e.key||"Enter"===e.key){const a=this.inputNodes[t];a.classList.remove("hidden"),a.setFocus(),e.target.classList.add("hidden")}}},e.label),(0,s.h)("calcite-input",{class:"hidden",ref:e=>{e&&(this.inputNodes[t]=e)},value:e.label??void 0,onCalciteInputChange:e=>{this.inputNodes[t].classList.add("hidden"),this.labelNodes[t].classList.remove("hidden"),this.handleValueTextChange(t,e)},onFocusout:e=>{this.inputNodes[t].classList.add("hidden"),this.labelNodes[t].classList.remove("hidden"),this.handleValueTextChange(t,e)},onKeyDown:a=>{if("Escape"===a.key||"Enter"===a.key){this.inputNodes[t].classList.add("hidden");const s=a.currentTarget;s.value=e.label||"",s.disabled=!0,this.handleValueTextChange(t,a),this.labelNodes[t].classList.remove("hidden"),s.disabled=!1,setTimeout((()=>this.labelNodes[t].focus()),300)}}}))}renderFooterButtons(){return(0,s.h)("div",{class:"footer-buttons",slot:"footer"},this.renderDoneButton(),this.renderRegisterStyleButton(),this.renderCancelButton())}renderRegisterStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"register",onArcgisDone:e=>{const{smartMappingState:t}=this,{modules:a}=t;if((0,s.f)(this.el),"register"===e.detail){const e=(0,h.m)(t);this.originalRendererObj=a.esriLang.clone(e)}this.manageStyleButtonNode&&(0,s.f)(this.manageStyleButtonNode),(0,s.f)(this.registerStyleButtonNode)},ref:e=>this.registerStyleButtonNode=e})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.done,onClick:this.handleDone,appearance:"solid",width:"full"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.cancel)}afterCreateColor(e,t){const{modules:a}=this.smartMappingState;for(;e?.childNodes?.length;)e.removeChild(e.childNodes[0]);const{symbolUtils:s}=a,i=s.renderColorRampPreviewHTML([t.color.clone()],{gradient:!1,width:20,height:20});i.classList.add("colorblock"),e.appendChild(i)}handleValueTextChange(e,t){const{smartMappingState:a}=this,i=(0,h.m)(a),n=t.currentTarget;""===n.value?this.inputNodes[e].value=this.labelNodes[e].textContent:i.colormapInfos[e].label=n.value,(0,h.u)(a),(0,s.f)(this.el)}get el(){return(0,s.a)(this)}};ce.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.colormap-block{overflow-x:hidden}.table{width:100%}.color{display:flex;justify-content:center}.colorblock{border:1px solid #000}.hidden{display:none}.label{padding-top:5px;padding-bottom:5px}.label:focus{outline:2px solid var(--calcite-color-brand)}.label-cell{overflow-wrap:anywhere}.footer-buttons{width:100%;display:flex;flex-direction:column;gap:var(--calcite-spacing-sm)}";const de=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsRasterFlowClose=(0,s.c)(this,"arcgisSmartMappingPanelsRasterFlowClose",7),this.arcgisSmartMappingPanelsRasterFlowBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRasterFlowBackClick",7),this.arcgisSmartMappingPanelsRasterFlowError=(0,s.c)(this,"arcgisSmartMappingPanelsRasterFlowError",7),this.manager=(0,o.u)(this),this.smartMappingState=(0,m.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterFlowClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,originalEffect:t,smartMappingState:a}=this,{layer:s}=a;s.effect=t,(0,h.u)(a,e),this.arcgisSmartMappingPanelsRasterFlowClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{modules:e,layer:t}=this.smartMappingState,a=t;this.originalRendererObj=e.esriLang.clone((0,h.m)(this.smartMappingState)),this.originalEffect=a.effect??void 0}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}render(){const{hideLayerTitle:e,layer:t,strings:a}=this.smartMappingState,i=t.title;return(0,s.h)(s.H,{key:"19f1f189b3527f4b7f1975f794ceb2380d4b2367",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"d18d89d8a55dd406a3659f84fcc5469a710f7753",heading:a.panels.flow.styleOptions,description:e?void 0:i,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRasterFlowBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderFooterButtons()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.V)(e,t.panels.flow.flowStyle);return(0,s.h)("calcite-block",{class:"flow-block",heading:a,open:!0},this.renderManageStyleButton(),this.renderMode(),this.renderSpeed(),this.renderDensity(),this.renderLength(),this.renderWidth(),this.renderColor(),this.renderColorSlider(),this.renderDirection(),this.renderRoundCaps(),this.renderShowInLegend(),this.renderEffects())}renderManageStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"edit",originalRasterProps:{originalRendererObj:this.originalRendererObj,originalEffect:this.originalEffect},onArcgisDone:e=>{"delete"!==e.detail?(0,s.f)(this.el):this.arcgisSmartMappingPanelsRasterFlowBackClick.emit("delete")},ref:e=>this.manageStyleButtonNode=e})}renderMode(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i=a.authoringInfo,n=i?.flowTheme?"wave-front"===i?.flowTheme:a.trailLength<1;return(0,s.h)("div",{class:"block-content-padding-large"},(0,s.h)("calcite-chip",{value:"flowline",label:t.panels.flow.flowline,appearance:n?"outline-fill":"solid",kind:n?"neutral":"brand",class:n?"mode-hover":"",scale:"s",onClick:()=>this.handleModeChange("flowline")},t.panels.flow.flowline),(0,s.h)("span",null,"\xa0"),(0,s.h)("calcite-chip",{value:"wavefront",label:t.panels.flow.wavefront,appearance:n?"solid":"outline-fill",kind:n?"brand":"neutral",class:n?"":"mode-hover",scale:"s",onClick:()=>this.handleModeChange("wavefront")},t.panels.flow.wavefront))}renderSpeed(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i="wave-front"===a.authoringInfo.flowTheme,{flowSpeed:n}=a;return(0,s.h)("calcite-label",null,t.panels.flow.speed,(0,s.h)("arcgis-smart-mapping-raster-slider",{rendererType:"flow",type:"speed",min:0,max:i?20:40,values:[n],precision:1,minLabel:t.panels.flow.slow,maxLabel:t.panels.flow.fast}))}renderDensity(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{density:i}=a;return(0,s.h)("calcite-label",null,t.panels.flow.density,(0,s.h)("arcgis-smart-mapping-raster-slider",{rendererType:"flow",type:"density",min:.1,max:1,values:[i],precision:1,minLabel:t.panels.flow.low,maxLabel:t.panels.flow.high}))}renderLength(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i="wave-front"===a.authoringInfo.flowTheme,{trailLength:n}=a;return(0,s.h)("calcite-label",null,t.panels.flow.length,(0,s.h)("arcgis-smart-mapping-raster-slider",{rendererType:"flow",type:"trail-length",min:i?.1:1,max:i?50:200,values:[n/.75],precision:i?1:0,minLabel:t.panels.flow.short,maxLabel:t.panels.flow.long}))}renderWidth(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i="wave-front"===a.authoringInfo.flowTheme,{trailWidth:n}=a,r=Math.round(n/.75*10)/10;return(0,s.h)("div",{class:"block-content-padding-large"},(0,s.h)("calcite-label",null,t.panels.flow.width),(0,s.h)("arcgis-smart-mapping-slider-input",{min:i?Math.min(5,Math.floor(r)):.1,max:i?Math.max(12,Math.ceil(r)):Math.max(5,Math.ceil(r)),values:[r],precision:1,suffixText:t.panels.flow.px,onArcgisSmartMappingSliderInputChange:t=>{const a=(0,h.m)(e),s=t.detail,{trailWidth:i}=a;s!==Math.round(i/.75*10)/10&&(a.trailWidth=.75*s,(0,h.u)(e))}}))}renderColor(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i=(0,h.b)(a,"color");return(0,s.h)("calcite-radio-button-group",{class:"block-content-padding",name:"colorType",onCalciteRadioButtonGroupChange:e=>this.handleColorTypeChange(e.target.selectedItem.value)},(0,s.h)("div",{class:"color-wrapper"},(0,s.h)("div",null,(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{checked:!i,value:"singleColor",ref:e=>this.singleColorNode=e}),t.panels.flow.singleColor),!i&&this.renderSingleColor()),(0,s.h)("div",null,(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-radio-button",{checked:!!i,value:"colorRamp",ref:e=>this.colorRampNode=e}),t.panels.flow.colorRamp),i&&this.renderColorRamp())))}renderSingleColor(){const{smartMappingState:e}=this,t=(0,h.m)(e),{color:a}=t,i=(0,h.W)(e);return i.color=a,i.outline.color=a,(0,s.h)("div",{class:"symbol-button-padding"},(0,s.h)("arcgis-smart-mapping-symbol-button",{symbol:i,hideLabel:!0,type:"raster-flow",rampType:"continuous",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,h.u)(e),(0,s.f)(this.el)}}))}renderColorRamp(){const{smartMappingState:e}=this,t=(0,h.m)(e),a=(0,h.b)(t,"color");if(!a)return(0,s.h)(s.F,null);const i=a.stops.map((e=>{const t=e.color.clone();return t.a=1,t}));return(0,s.h)("div",{class:"symbol-button-padding"},(0,s.h)("arcgis-smart-mapping-symbol-button",{colors:i,hideLabel:!0,type:"raster-flow",rampType:"continuous",ref:e=>{e&&(this.symbolButtonNode=e)},onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,h.u)(e),(0,s.f)(this.el),this.flowColorSliderNode&&(0,s.f)(this.flowColorSliderNode)}}))}renderColorSlider(){const{smartMappingState:e}=this,t=(0,h.m)(e);return(0,h.b)(t,"color")?(0,s.h)("arcgis-smart-mapping-flow-color-slider",{ref:e=>{e&&(this.flowColorSliderNode=e)},onArcgisSmartMappingFlowColorSliderChange:()=>{(0,s.f)(this.el),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode)},onArcgisSmartMappingFlowColorSliderError:e=>this.arcgisSmartMappingPanelsRasterFlowError.emit(e.detail)}):(0,s.h)(s.F,null)}renderDirection(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{flowRepresentation:i}=a;return(0,s.h)("calcite-label",{layout:"inline-space-between",class:"block-content-padding"},t.panels.flow.flowDirection,(0,s.h)("calcite-segmented-control",{layout:"horizontal",appearance:"solid",onCalciteSegmentedControlChange:e=>this.handleDirectionChange(e.target.selectedItem.value)},(0,s.h)("calcite-segmented-control-item",{value:"to",checked:"flow-from"!==i},t.panels.flow.to),(0,s.h)("calcite-segmented-control-item",{value:"from",checked:"flow-from"===i},t.panels.flow.from)))}renderRoundCaps(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{trailWidth:i,authoringInfo:n}=a,r="flow-line"===n.flowTheme,l="round"===a.trailCap,o=Math.round(1e3*i)/1e3>3;return(0,s.h)("div",{class:"toggles block-content-padding"},(0,s.h)("calcite-label",{class:"toggle-text",layout:"inline-space-between"},t.panels.flow.roundEndCaps,(0,s.h)("calcite-switch",{ref:e=>{e&&(this.roundCapToggleNode=e)},disabled:!o,scale:"s",checked:l,onCalciteSwitchChange:()=>this.handleRoundCapsToggle()})),r?(0,s.h)("div",{class:"hint-text "+(o?"":"disabled")},t.panels.flow.forWideLines):null)}renderShowInLegend(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i=(0,h.b)(a,"color");if(!i)return(0,s.h)(s.F,null);const n=i.legendOptions,r=!n||!1!==n.showLegend;return(0,s.h)("calcite-label",{layout:"inline-space-between",class:"toggle-text toggles block-content-padding"},t.panels.flow.includeInLegend,(0,s.h)("calcite-switch",{scale:"s",checked:r,onCalciteSwitchChange:()=>this.handleIncludeInLegendToggle()}))}renderEffects(){const{layer:e,strings:t}=this.smartMappingState,a=e;return(0,s.h)("div",{class:"toggles block-content-padding"},(0,s.h)("calcite-label",{class:"toggle-text",layout:"inline-space-between"},t.panels.flow.layerEffects,(0,s.h)("calcite-switch",{scale:"s",checked:!!a.effect,onCalciteSwitchChange:()=>this.handleEffectToggle()})),(0,s.h)("div",{class:"hint-text"},t.panels.flow.adjustEffects))}renderFooterButtons(){return(0,s.h)("div",{class:"footer-buttons",slot:"footer"},this.renderDoneButton(),this.renderRegisterStyleButton(),this.renderCancelButton())}renderRegisterStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"register",onArcgisDone:e=>{const{smartMappingState:t}=this,{modules:a}=t,{layer:i}=t,n=i;if((0,s.f)(this.el),"register"===e.detail){const e=(0,h.m)(t);this.originalRendererObj=a.esriLang.clone(e),this.originalEffect=n.effect??void 0}this.manageStyleButtonNode&&(0,s.f)(this.manageStyleButtonNode),(0,s.f)(this.registerStyleButtonNode)},ref:e=>this.registerStyleButtonNode=e})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.done,onClick:this.handleDone,appearance:"solid",width:"full"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.cancel)}handleModeChange(e){const{smartMappingState:t}=this,a=(0,h.m)(t).authoringInfo,i="wave-front"===a.flowTheme,n="wave-front"===a.flowTheme?"flow-line":"wave-front";(!i&&"wavefront"===e||i&&"flowline"===e)&&((0,h.J)(),(0,f.r)((0,w.c)(t,{flowTheme:n}),this.flowItemNode).then((e=>{(0,h.u)(t,e.renderer),this.roundCapToggleNode.checked=!1,(0,s.f)(this.el)}),(e=>this.arcgisSmartMappingPanelsRasterFlowError.emit(e))))}handleColorTypeChange(e){(0,h.J)();const{smartMappingState:t}=this,a={includeColorVariable:"colorRamp"===e};"colorRamp"!==e?this.lastFlowTheme=(0,w.f)(t):this.lastFlowTheme&&(a.flowScheme=this.lastFlowTheme),(0,f.r)((0,w.c)(t,a),this.flowItemNode).then((e=>{(0,h.u)(t,e.renderer),(0,s.f)(this.el)}),(e=>{this.singleColorNode.checked?(this.singleColorNode.checked=!1,this.colorRampNode.checked=!0):(this.colorRampNode.checked=!1,this.singleColorNode.checked=!0),this.arcgisSmartMappingPanelsRasterFlowError.emit(e)}))}handleDirectionChange(e){const{smartMappingState:t}=this;(0,h.m)(t).flowRepresentation="from"===e?"flow-from":"flow-to",(0,h.u)(t)}handleRoundCapsToggle(){const{smartMappingState:e}=this,t=(0,h.m)(e);t.trailCap="round"===t.trailCap?"butt":"round",(0,h.u)(e)}handleIncludeInLegendToggle(){const{smartMappingState:e}=this,t=(0,h.m)(e),a=(0,h.b)(t,"color"),s=a.legendOptions;s&&!1===s.showLegend?s.title?s.showLegend=!0:a.legendOptions=void 0:(a.legendOptions=s||{},a.legendOptions.showLegend=!1),(0,h.u)(e)}handleEffectToggle(){const{smartMappingState:e}=this,{layer:t}=e,a=t,s=(0,h.m)(e);if(a.effect)a.effect=void 0;else{const t=s.authoringInfo;(0,w.a)(e,{flowTheme:t.flowTheme}).then((t=>{a.effect=t.layerEffect,(0,h.u)(e)}),(e=>this.arcgisSmartMappingPanelsRasterFlowError.emit(e)))}}get el(){return(0,s.a)(this)}};function pe(e,t,a){switch(t){case"raster-flow":a((0,w.a)(e));break;case"raster-vector-field":a(async function(e){const{layer:t,modules:a}=e,s=t,i="imagery"===s.type?s.rasterFunction??void 0:void 0;return await a.RasterVectorFieldCreator.createRenderer({layer:s,rasterFunction:i}).then((t=>(s.effect=void 0,(0,h.u)(e,t.renderer),t)))}(e));break;case"raster-stretch":a((0,h.Z)(e));break;case"raster-rgb":a((0,h.Y)(e));break;case"raster-shaded-relief":a(async function(e){const{layer:t,modules:a}=e,s=t,i="imagery"===s.type?s.rasterFunction??void 0:void 0;return await a.RasterShadedReliefCreator.createRenderer({layer:s,rasterFunction:i})}(e));break;case"raster-class-breaks":a(async function(e){const{layer:t,modules:a}=e,s=t,i="imagery"===s.type?s.rasterFunction??void 0:void 0,n=(0,C.c)(e,[[245,245,0],[255,0,0]].map((e=>new a.EsriColor(e))));return await a.RasterClassBreaksCreator.createRenderer({layer:s,rasterFunction:i,colorRamp:n}).then((e=>(e.renderer.classBreakInfos.forEach((e=>e.symbol.outline.width=0)),e)))}(e));break;case"raster-colormap":a(async function(e){const{layer:t,modules:a}=e,s=t,i="imagery"===s.type?s.rasterFunction??void 0:void 0;return await a.RasterColormapCreator.createRenderer({layer:s,rasterFunction:i}).then((e=>(e.renderer.colormapInfos.forEach(((t,a)=>{t.label||(e.renderer.colormapInfos[a].label=" ")})),e)))}(e));break;case"raster-unique-value":a((0,h.X)(e))}}de.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.flow-block{overflow-x:hidden}.block-content-padding{padding-bottom:10px}.block-content-padding-large{padding-bottom:20px}.color-wrapper{display:flex;flex-direction:column;width:100%}.symbol-button-padding{padding-bottom:12px}.mode-hover{cursor:pointer}.toggles{padding-top:10px}.toggle-text{width:100%}.hint-text{font-size:smaller;margin-top:-8px}.hint-text.disabled{opacity:0.5}.footer-buttons{width:100%;display:flex;flex-direction:column;gap:var(--calcite-spacing-sm)}";const he=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsRasterGalleryClose=(0,s.c)(this,"arcgisSmartMappingPanelsRasterGalleryClose",7),this.arcgisSmartMappingPanelsRasterGalleryError=(0,s.c)(this,"arcgisSmartMappingPanelsRasterGalleryError",7),this.manager=(0,o.u)(this),this.tileNodes=[],this.smartMappingState=(0,m.u)(),this.handleSelectClick=(e,t)=>{const{smartMappingState:a}=this,{layer:i}=a,n=i;if(("imagery"===n.type||"imagery-tile"===n.type)&&t){const e=n.presetRenderers?.find((({name:e})=>e===t)),i=(0,h.n)(a,e);n.bandIds=e.bandIds??[],"raster-flow"!==i&&(n.effect=void 0),n.activePresetRendererName=t,(0,h.u)(a,e?.renderer),(0,s.f)(this.el)}else n.bandIds=[],"activePresetRendererName"in n&&(n.activePresetRendererName=void 0),pe(a,e,this.galleryRequestWrapper)},this.handleOptionsClick=e=>{switch(e){case"raster-class-breaks":{const e=document.createElement("arcgis-smart-mapping-panels-raster-class-breaks");e.addEventListener("arcgisSmartMappingPanelsRasterClassBreaksClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterClassBreaksBackClick",(t=>{"delete"===t.detail&&pe(this.smartMappingState,"raster-class-breaks",this.galleryRequestWrapper),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsRasterClassBreaksError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-colormap":{const e=document.createElement("arcgis-smart-mapping-panels-raster-colormap");e.addEventListener("arcgisSmartMappingPanelsRasterColormapClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterColormapBackClick",(t=>{"delete"===t.detail&&pe(this.smartMappingState,"raster-colormap",this.galleryRequestWrapper),this.cleanUpFlowItem(e)})),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-flow":{const e=document.createElement("arcgis-smart-mapping-panels-raster-flow");e.addEventListener("arcgisSmartMappingPanelsRasterFlowClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterFlowBackClick",(t=>{"delete"===t.detail&&pe(this.smartMappingState,"raster-flow",this.galleryRequestWrapper),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsRasterFlowError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-rgb":{const e=document.createElement("arcgis-smart-mapping-panels-raster-rgb");e.addEventListener("arcgisSmartMappingPanelsRasterRgbClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterRgbBackClick",(t=>{"delete"===t.detail&&pe(this.smartMappingState,"raster-rgb",this.galleryRequestWrapper),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsRasterRgbError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-shaded-relief":{const e=document.createElement("arcgis-smart-mapping-panels-raster-shaded-relief");e.addEventListener("arcgisSmartMappingPanelsRasterShadedReliefClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterShadedReliefBackClick",(t=>{"delete"===t.detail&&pe(this.smartMappingState,"raster-shaded-relief",this.galleryRequestWrapper),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsRasterShadedReliefError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-stretch":{const e=document.createElement("arcgis-smart-mapping-panels-raster-stretch");e.addEventListener("arcgisSmartMappingPanelsRasterStretchClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterStretchBackClick",(t=>{"delete"===t.detail&&pe(this.smartMappingState,"raster-stretch",this.galleryRequestWrapper),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsRasterStretchError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-unique-value":{const e=document.createElement("arcgis-smart-mapping-panels-raster-unique-value");e.addEventListener("arcgisSmartMappingPanelsRasterUniqueValueClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterUniqueValueBackClick",(t=>{"delete"===t.detail&&pe(this.smartMappingState,"raster-unique-value",this.galleryRequestWrapper),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsRasterUniqueValueError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}case"raster-vector-field":{const e=document.createElement("arcgis-smart-mapping-panels-raster-vector-field");e.addEventListener("arcgisSmartMappingPanelsRasterVectorFieldClose",(()=>this.cleanUpFlowItem(e))),e.addEventListener("arcgisSmartMappingPanelsRasterVectorFieldBackClick",(t=>{"delete"===t.detail&&pe(this.smartMappingState,"raster-vector-field",this.galleryRequestWrapper),this.cleanUpFlowItem(e)})),e.addEventListener("arcgisSmartMappingPanelsRasterVectorFieldError",(({detail:e})=>this.arcgisSmartMappingPanelsRasterGalleryError.emit(e))),this.flowNode.appendChild(e),e.showBackButton=!0,e.selected=!0,this.selected=!1;break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterGalleryClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,originalActivePresetRendererName:t,originalActivePresetRendererObj:a,originalEffect:s,originalBandCombination:i,smartMappingState:n}=this,{layer:r}=n,l=r;l.effect=s,l.bandIds=i;const o="activePresetRendererName"in l?l.activePresetRendererName:void 0;if(t){if(!o){pe(n,(0,h.n)(n,a),this.galleryRequestWrapper)}}else"activePresetRendererName"in l&&(l.activePresetRendererName=void 0),(0,h.u)(n,e);this.arcgisSmartMappingPanelsRasterGalleryClose.emit("cancel")},this.galleryRequestWrapper=e=>{const{smartMappingState:t}=this,{strings:a}=t;(0,f.r)(e,this.flowItemNode).then((e=>{(0,h.u)(t,e.renderer),(0,s.f)(this.el)}),(()=>{this.arcgisSmartMappingPanelsRasterGalleryError.emit({message:a.panels.gallery.errors.changeRendererErrorMsg,type:"warning"})}))},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){await this.syncGalleryOptions(),this.flowNode=(0,p.f)(this.el,"calcite-flow")}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}componentDidUpdate(){setTimeout((()=>{this.tileNodes[0]?.setFocus()}),300)}render(){const{strings:e}=this.smartMappingState;return(0,s.h)(s.H,{key:"5901846796dcbc737878aa2e834d92fd5f272717",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"e287f4c5a11689df1903fab119ac9faf68002cfd",heading:e.panels.rasterGallery.style,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,ref:e=>this.flowItemNode=e},this.renderRasterGalleryContent()))}renderRasterGalleryContent(){return(0,s.h)(s.F,null,this.renderStyleOptions(),this.renderDoneButton(),this.renderCancelButton())}renderStyleOptions(){const{smartMappingState:e}=this,{modules:t,strings:a,layer:i}=e,n=i&&("imagery"===i.type||"imagery-tile"===i.type),r=(0,h.n)(e),l=t.esriLang.clone(this.supportedRendererTypes).map((e=>({type:e,presetRendererName:void 0})));if(n){const t=i.presetRenderers;t?.length&&t.forEach((t=>{const a=(0,h.n)(e,t),s=l.findIndex((e=>e.type===a));if(s>-1){const e={type:a,rasterPresetRendererName:t.name};l.splice(s+1,0,e)}}))}const o=n?i.activePresetRendererName:void 0,c=l.sort(((e,t)=>e.type===r&&t.type!==r?-1:e.type===r&&t.type===r?o&&e.rasterPresetRendererName===o?-1:o&&t.rasterPresetRendererName===o?1:0:1)).map(((e,t)=>{const a=e.type,s=e.rasterPresetRendererName;return this.renderStyleTile(a,t,s)}));return(0,s.h)(s.F,null,(0,s.h)("calcite-label",{class:"styles-msg-title"},a.panels.rasterGallery.symbologyOptions),c)}renderStyleTile(e,t,a){const{smartMappingState:i}=this,{layer:n}=i,r=n&&("imagery"===n.type||"imagery-tile"===n.type)?n.activePresetRendererName:void 0,l=(0,h.n)(i);return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${e}-${a}`,tileType:"raster-gallery",type:e,selected:r?n.activePresetRendererName===a:!a&&e===l,ref:e=>{e&&(this.tileNodes[t]=e)},rasterPresetRendererName:a,onArcgisSmartMappingTileSelect:()=>this.handleSelectClick(e,a),onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick(e)})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleDone,appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},e.cancel)}async syncGalleryOptions(){const{smartMappingState:e}=this,{layer:t,modules:a}=e,s=t,i=s.rasterFunction,n=(0,h._)(e);await a.smartMappingRasterUtils.getSupportedRendererInfo({layer:s,rasterFunction:i}).then((async e=>{const t=n?n.bandIds:s.bandIds;this.supportedRendererTypes&&this.supportedRendererTypes.length===e.supportedTypes.length&&this.supportedRendererTypes.every((t=>e.supportedTypes.includes(t)))||(this.supportedRendererTypes=e.supportedTypes,this.originalRendererObj=a.esriLang.clone((0,h.m)(this.smartMappingState)),this.originalActivePresetRendererName=n?s.activePresetRendererName:void 0,this.originalActivePresetRendererObj=a.esriLang.clone(n),this.originalEffect=s.effect??void 0,this.originalBandCombination=(t||await a.smartMappingRasterUtils.getDefaultBandCombination({layer:s,rasterFunction:i}))??void 0)}))}async cleanUpFlowItem(e){this.flowNode.removeChild(e),this.focusSelectedTile(),this.selected=!0;const{smartMappingState:t}=this,{layer:a}=t;("imagery"===a.type||"imagery-tile"===a.type)&&await this.syncGalleryOptions()}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((async()=>await(this.tileNodes[0]?.setFocus())))),300)}get el(){return(0,s.a)(this)}};var me;he.style=":host{display:none}:host([selected]){display:flex}.styles-msg-title{margin-top:12px;padding:6px;font-weight:bold;font-size:16px;display:flex}.styles-msg{font-size:var(--calcite-font-size--2)}",function(e){e[e.ALL=-1]="ALL",e[e.RED=0]="RED",e[e.GREEN=1]="GREEN",e[e.BLUE=2]="BLUE"}(me||(me={}));const ge=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsRasterRgbClose=(0,s.c)(this,"arcgisSmartMappingPanelsRasterRgbClose",7),this.arcgisSmartMappingPanelsRasterRgbBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRasterRgbBackClick",7),this.arcgisSmartMappingPanelsRasterRgbError=(0,s.c)(this,"arcgisSmartMappingPanelsRasterRgbError",7),this.manager=(0,o.u)(this),this.disconnected=!1,this.smartMappingState=(0,m.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterRgbClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,originalEffect:t,originalBandCombination:a,smartMappingState:s}=this,{layer:i}=s,n=i;n.effect=t;const r=(0,h._)(s);r?r.bandIds=a:n.bandIds=a,(0,h.u)(s,e),this.arcgisSmartMappingPanelsRasterRgbClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}async componentWillLoad(){const{smartMappingState:e}=this,{layer:t,rasterInfo:a,modules:s}=e,i=t,{statistics:n}=a,r=(0,h._)(e);r&&!r.bandIds?.length?r.bandIds=await(0,h.$)(e):i.bandIds?.length||(i.bandIds=await(0,h.$)(e)),this.originalRendererObj=s.esriLang.clone((0,h.m)(this.smartMappingState)),this.originalEffect=i.effect??void 0,this.originalBandCombination=(0,h.a0)(e),this.originalStatistics=s.esriLang.clone(n),this.currentStatistics=[];for(let e=0;e<a.bandCount;e++){if(r?r.bandIds?.includes(e):i.bandIds?.includes(e)){const t=r?r.bandIds.indexOf(e):i.bandIds.indexOf(e);let a;this.originalRendererObj?.customStatistics?.[t]&&(a=s.esriLang.clone(this.originalRendererObj.customStatistics[t])),a?this.currentStatistics.push(a):this.originalStatistics?.[e]?this.currentStatistics.push(s.esriLang.clone(this.originalStatistics[e])):this.currentStatistics.push({min:0,max:255,avg:0,stddev:1})}else this.originalStatistics?.[e]?this.currentStatistics.push(s.esriLang.clone(this.originalStatistics[e])):this.currentStatistics.push({min:0,max:255,avg:0,stddev:1})}this.rendererStatisticsSelection=r?r.bandIds[0]:i.bandIds[0],this.setGammaDisplay(),this.percentLabelFlip=(0,h.a1)(this.smartMappingState,this.el)}componentDidLoad(){const e=(0,h.m)(this.smartMappingState),{stretchType:t=h.a4.STRETCH_TYPE}=e||{},a=t===h.a3.PERCENT_CLIP,s=t===h.a3.NONE,{dynamicRangeAdjustment:i}=e;!i&&!(s||a)&&e.customStatistics?.[0]&&this.updateStatisticsDisplay(e.customStatistics[0]),requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}disconnectedCallback(){this.disconnected=!0,this.clearHandles()}render(){const{hideLayerTitle:e,layer:t,strings:a}=this.smartMappingState,i=t.title;return(0,s.h)(s.H,{key:"a9d4eb7ae039679ba102f10275e84ef0d922362a",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"3efcf62f7e10911031f270cff74afe0cf7db3009",heading:a.panels.rgb.styleOptions,description:e?void 0:i,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRasterRgbBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderFooterButtons()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.V)(e,t.panels.rgb.rgb);return(0,s.h)("calcite-block",{class:"rgb-block",heading:a,open:!0},this.renderManageStyleButton(),this.renderRgbBandSelectors(),this.renderStretchTypeSelector(),this.renderStandardDeviationSection(),this.renderPercentClipSection(),this.renderGammaBlock(),this.renderIndividualGammaToggle(),this.renderRangeAdjustmentToggle(),this.renderStatistics())}renderManageStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"edit",originalRasterProps:{originalRendererObj:this.originalRendererObj,originalEffect:this.originalEffect,originalBandCombination:this.originalBandCombination},onArcgisDone:e=>{"delete"!==e.detail?(0,s.f)(this.el):this.arcgisSmartMappingPanelsRasterRgbBackClick.emit("delete")},ref:e=>this.manageStyleButtonNode=e})}renderRgbBandSelectors(){const{smartMappingState:e}=this,{layer:t,rasterInfo:a,strings:i}=e,n=t,{bandInfos:r}=a,l=r.map((e=>e.name)),{red:o,green:c,blue:d}=i.panels.rgb,p=[o,c,d].map(((t,a)=>(0,s.h)("calcite-label",null,t,(0,s.h)("calcite-combobox",{overlayPositioning:"fixed",label:t,clearDisabled:!0,selectionMode:"single-persist",onCalciteComboboxChange:s=>{const i=s.target,r=(0,h.m)(e),o=(0,h._)(e),c=o?[...o.bandIds]:[...n.bandIds];c[a]=l.indexOf(i.value),o?o.bandIds=c:n.bandIds=c;const d=o?o.bandIds[a]:n.bandIds[a],p=this.currentStatistics?.[d];r.customStatistics?.length&&p&&(r.customStatistics[a]={...p}),this.statisticsControlNode&&t!==this.statisticsControlNode.value||(this.rendererStatisticsSelection=d,this.updateStatisticsDisplay({...p})),(0,h.u)(e)}},l.map(((e,t)=>this.renderBandOptions(e,t,a)))))));return(0,s.h)(s.F,null,p)}renderBandOptions(e,t,a){const{smartMappingState:i}=this,{layer:n}=i,r=n,l=(0,h._)(i),o=l?l.bandIds[a]:r.bandIds[a];return(0,s.h)("calcite-combobox-item",{textLabel:e,value:e,selected:o===t})}renderStretchTypeSelector(){const{smartMappingState:e}=this,{layer:t}=e,a=t;return(0,s.h)("arcgis-smart-mapping-stretch-type-button",{onArcgisSmartMappingStretchTypeButtonBeforeOpen:()=>(0,h.J)(),onArcgisSmartMappingStretchTypeButtonChange:t=>{const i=t.target;(0,f.r)((0,h.a2)(e,{stretchType:t.detail}),this.flowItemNode).then((n=>{const r=(0,h._)(e);"none"===t.detail&&(n.renderer.dynamicRangeAdjustment=!1),this.rendererStatisticsSelection=r?r.bandIds[0]:a.bandIds[0],(0,h.u)(e,n.renderer),(0,s.f)(this.el),(0,s.f)(i)}),(e=>this.arcgisSmartMappingPanelsRasterRgbError.emit(e)))}})}renderStandardDeviationSection(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{stretchType:i=h.a4.STRETCH_TYPE}=a||{};if(!(i===h.a3.STANDARD_DEVIATION))return(0,s.h)(s.F,null);let{numberOfStandardDeviations:n}=a||{};return(0,h.S)(n)&&0!==n||(n=h.a4.STD_DEV),(0,s.h)("calcite-label",null,t.panels.rgb.stddev,(0,s.h)("calcite-input-number",{label:t.panels.rgb.stddev,scale:"s",inputMode:"decimal",min:1,max:100,step:.1,value:`${n}`,onCalciteInputNumberInput:e=>{clearTimeout(this.stddevHandle);const t=e.target,a=Number.parseFloat(t.value);t.value&&a>=t.min&&a<=t.max?this.handlePercentOrStddevChange(t,"stddev"):this.stddevHandle=setTimeout((()=>this.handlePercentOrStddevChange(t,"stddev")),3e3)}}))}renderPercentClipSection(){const{smartMappingState:e}=this,t=(0,h.m)(e),{stretchType:a=h.a4.STRETCH_TYPE}=t||{};if(!(a===h.a3.PERCENT_CLIP))return(0,s.h)(s.F,null);let{minPercent:i,maxPercent:n}=t||{};return(!(0,h.S)(i)||i<=0||i>=100)&&(i=h.a4.MIN_PERCENT),(!(0,h.S)(n)||n<=0||n>=100)&&(n=h.a4.MAX_PERCENT),i=Number.parseFloat(i.toFixed(1)),n=Number.parseFloat(n.toFixed(1)),t.minPercent=i,t.maxPercent=n,(0,h.u)(e),(0,s.h)("div",{class:"percent-clip-section"},this.renderPercentClipSectionInput("min",i),this.renderPercentClipSectionInput("max",n))}renderPercentClipSectionInput(e,t){const{percentLabelFlip:a,smartMappingState:i}=this,{strings:n}=i;return(0,s.h)("div",{class:"percent-clip-section-input"},(0,s.h)("calcite-label",null,n.panels.rgb[e],(0,s.h)("calcite-input-number",{label:n.panels.rgb[e],scale:"s",inputMode:"decimal",min:.1,max:99.9,step:.1,prefixText:a?"%":void 0,suffixText:a?void 0:"%",value:`${t}`,onCalciteInputNumberInput:t=>{clearTimeout(this.percentClipHandle);const a=t.target,s=Number.parseFloat(a.value);a.value&&s>=a.min&&s<=a.max?this.handlePercentOrStddevChange(a,e):this.percentClipHandle=setTimeout((()=>this.handlePercentOrStddevChange(a,e)),3e3)}})))}renderIndividualGammaToggle(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-label",{layout:"inline-space-between",class:"individual-gamma-label"},e.panels.rgb.individualGamma,(0,s.h)("calcite-switch",{scale:"s",checked:this.changeIndividualGamma,onCalciteSwitchChange:e=>this.handleGammaToggle(e)}))}renderGammaBlock(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{gamma:i=[h.a4.GAMMA]}=a||{},n=a.gamma[0],r=i[me.RED]??n,l=i[me.GREEN]??n,o=i[me.BLUE]??n;return(0,s.h)("calcite-label",null,t.panels.rgb.gamma,this.changeIndividualGamma?(0,s.h)("div",{class:"individual-gamma-selection"},this.renderIndividualGamma(r,"red"),this.renderIndividualGamma(l,"green"),this.renderIndividualGamma(o,"blue")):(0,s.h)("arcgis-smart-mapping-gamma-slider",{gamma:i[0],rendererType:"raster-rgb"}))}renderIndividualGamma(e,t){const{strings:a}=this.smartMappingState;return(0,s.h)("div",{class:"individual-gamma-selection-value"},(0,s.h)("calcite-label",null,a.panels.rgb[t],(0,s.h)("calcite-input-number",{label:a.panels.rgb[t],numberButtonType:"none",scale:"s",value:`${e}`,inputMode:"decimal",min:.1,max:10,step:.1,onCalciteInputNumberInput:e=>{clearTimeout(this.individualGammaHandle);const a=e.target,s=Number.parseFloat(a.value);a.value&&s>=a.min&&s<=a.max?this.handleIndividualGammaChange(a,t):this.individualGammaHandle=setTimeout((()=>this.handleIndividualGammaChange(a,t)),3e3)}})))}renderRangeAdjustmentToggle(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{dynamicRangeAdjustment:i}=a,{stretchType:n=h.a4.STRETCH_TYPE}=a||{};return n===h.a3.NONE?(0,s.h)(s.F,null):(0,s.h)("calcite-label",{layout:"inline-space-between",class:"range-adjustment-label"},t.panels.rgb.dynamicRangeAdjustment,(0,s.h)("calcite-switch",{scale:"s",checked:i,onCalciteSwitchChange:e=>{const t=e.target.checked;this.handleDRAToggle(t),(0,s.f)(this.el)}}))}renderStatistics(){const{smartMappingState:e}=this,{layer:t,strings:a}=e,i=t,n=(0,h.m)(e),r=(0,h._)(e),l=r?r.bandIds[0]:i.bandIds[0],o=r?r.bandIds[1]:i.bandIds[1],c=r?r.bandIds[2]:i.bandIds[2],{stretchType:d=h.a4.STRETCH_TYPE}=n||{},p=d===h.a3.PERCENT_CLIP,m=d===h.a3.NONE,{dynamicRangeAdjustment:g}=n;return!g&&!(m||p)?(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,a.panels.rgb.statistics,(0,s.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:e=>{const{smartMappingState:t}=this,s=(0,h._)(t),n=e.target.value,r=n===a.panels.rgb.red?s?s.bandIds[0]:i.bandIds[0]:n===a.panels.rgb.green?s?s.bandIds[1]:i.bandIds[1]:s?s.bandIds[2]:i.bandIds[2],l=this.currentStatistics[r];this.rendererStatisticsSelection=r,this.updateStatisticsDisplay(l)},ref:e=>this.statisticsControlNode=e},(0,s.h)("calcite-segmented-control-item",{value:a.panels.rgb.red,checked:this.rendererStatisticsSelection===l},a.panels.rgb.red),(0,s.h)("calcite-segmented-control-item",{value:a.panels.rgb.green,checked:this.rendererStatisticsSelection===o&&this.rendererStatisticsSelection!==l},a.panels.rgb.green),(0,s.h)("calcite-segmented-control-item",{value:a.panels.rgb.blue,checked:this.rendererStatisticsSelection===c&&this.rendererStatisticsSelection!==l&&this.rendererStatisticsSelection!==o},a.panels.rgb.blue))),this.renderStatisticsDisplay()):(0,s.h)(s.F,null)}renderStatisticsDisplay(){const{smartMappingState:e}=this,{rasterInfo:t,strings:a}=e,i=(0,h.m)(e),{stretchType:n=h.a4.STRETCH_TYPE}=i||{},r=n===h.a3.PERCENT_CLIP,l=n===h.a3.STANDARD_DEVIATION,o=null!==t.statistics,c=this.rendererStatisticsSelection??0,d=(!o||r)&&!l,{min:p=0,max:m=255,avg:g=0,stddev:u=1}=this.currentStatistics[c??0]??{};return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,a.panels.rgb.min,(0,s.h)("calcite-input-number",{label:a.panels.rgb.min,scale:"s",inputMode:"decimal",step:.1,numberButtonType:"none",value:`${(0,h.S)(p)?this.round(p):0}`,onCalciteInputNumberInput:(0,v.d)((()=>{if(this.disconnected)return;clearTimeout(this.minStatisticHandle);const e=Number.parseFloat(this.minNode.value),t=this.getCurrentBandSelection();!Number.isNaN(e)&&e<=this.currentStatistics[t].max?(this.minNode.value=`${e}`,this.handleStatisticsChange(e,t,"min")):this.minStatisticHandle=setTimeout((()=>{const e=this.currentStatistics[t].min;this.minNode.value=`${this.round(e)}`}),3e3)}),300),ref:e=>{e&&(this.minNode=e)}})),(0,s.h)("calcite-label",null,a.panels.rgb.max,(0,s.h)("calcite-input-number",{label:a.panels.rgb.max,scale:"s",inputMode:"decimal",step:.1,numberButtonType:"none",value:`${(0,h.S)(m)?this.round(m):1}`,onCalciteInputNumberInput:(0,v.d)((()=>{if(this.disconnected)return;clearTimeout(this.maxStatisticHandle);const e=Number.parseFloat(this.maxNode.value),t=this.getCurrentBandSelection();!Number.isNaN(e)&&e>=this.currentStatistics[t].min?(this.maxNode.value=`${e}`,this.handleStatisticsChange(e,t,"max")):this.maxStatisticHandle=setTimeout((()=>{const e=this.currentStatistics[t].max;this.maxNode.value=`${this.round(e)}`}),3e3)}),300),ref:e=>{e&&(this.maxNode=e)}})),(0,s.h)("calcite-label",null,a.panels.rgb.mean,(0,s.h)("calcite-input-number",{label:a.panels.rgb.mean,scale:"s",inputMode:"decimal",step:.1,disabled:d,numberButtonType:"none",value:`${(0,h.S)(g)?this.round(g):2}`,onCalciteInputNumberInput:(0,v.d)((()=>{if(this.disconnected)return;clearTimeout(this.avgStatisticHandle);const e=Number.parseFloat(this.avgNode.value),t=this.getCurrentBandSelection();Number.isNaN(e)?this.avgStatisticHandle=setTimeout((()=>{const e=this.currentStatistics[t].avg;this.avgNode.value=`${this.round(e)}`}),3e3):(this.avgNode.value=`${e}`,this.handleStatisticsChange(e,t,"avg"))}),300),ref:e=>{e&&(this.avgNode=e)}})),(0,s.h)("calcite-label",null,a.panels.rgb.stddev,(0,s.h)("calcite-input-number",{label:a.panels.rgb.stddev,scale:"s",inputMode:"decimal",step:.1,disabled:d,numberButtonType:"none",value:`${(0,h.S)(u)?this.round(u):3}`,onCalciteInputNumberInput:(0,v.d)((()=>{if(this.disconnected)return;clearTimeout(this.stddevStatisticHandle);const e=Number.parseFloat(this.stddevNode.value),t=this.getCurrentBandSelection();Number.isNaN(e)?this.stddevStatisticHandle=setTimeout((()=>{const e=this.currentStatistics[t].stddev;this.stddevNode.value=`${this.round(e)}`}),3e3):(this.stddevNode.value=`${e}`,this.handleStatisticsChange(e,t,"stddev"))}),300),ref:e=>{e&&(this.stddevNode=e)}})))}renderFooterButtons(){return(0,s.h)("div",{class:"footer-buttons",slot:"footer"},this.renderDoneButton(),this.renderRegisterStyleButton(),this.renderCancelButton())}renderRegisterStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"register",onArcgisDone:e=>{const{smartMappingState:t}=this,{modules:a}=t;if((0,s.f)(this.el),"register"===e.detail){const e=(0,h.m)(t);this.originalRendererObj=a.esriLang.clone(e),this.originalBandCombination=(0,h.a0)(t)}this.manageStyleButtonNode&&(0,s.f)(this.manageStyleButtonNode),(0,s.f)(this.registerStyleButtonNode)},ref:e=>this.registerStyleButtonNode=e})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.done,onClick:this.handleDone,appearance:"solid",width:"full"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.cancel)}getCurrentBandSelection(){const{smartMappingState:e}=this,{layer:t}=e,a=t,s=(0,h._)(e);return(s?s.bandIds??[]:a.bandIds??[])?.indexOf(this.rendererStatisticsSelection)??0}setGammaDisplay(){const{smartMappingState:e}=this,t=(0,h.m)(e),{gamma:a=[h.a4.GAMMA]}=t||{},s=t.gamma[0],i=a[me.RED]??s,n=a[me.GREEN]??s,r=a[me.BLUE]??s;this.changeIndividualGamma=i!==n||i!==r||n!==r}handlePercentOrStddevChange(e,t){const{smartMappingState:a}=this,s=(0,h.m)(a);let i=Number.parseFloat(e.value);Number.isNaN(i)||i<e.min?i=e.min:i>e.max&&(i=e.max),i=Number.parseFloat(i.toFixed(1)),e.value=`${i}`,"min"===t?s.minPercent=i:"max"===t?s.maxPercent=i:s.numberOfStandardDeviations=i,(0,h.u)(a)}handleGammaToggle(e){const{smartMappingState:t}=this,a=(0,h.m)(t);this.changeIndividualGamma=!this.changeIndividualGamma;e.target.checked||(a.gamma=new Array(3).fill(a.gamma[0]),a.useGamma=!0),(0,h.u)(t),(0,s.f)(this.el)}handleIndividualGammaChange(e,t){const{smartMappingState:a}=this,s=(0,h.m)(a);let i=Number.parseFloat(e.value);Number.isNaN(i)||i<e.min?i=e.min:i>e.max&&(i=e.max),i=Number.parseFloat(i.toFixed(1)),e.value=`${i}`,"red"===t?s.gamma[me.RED]=i:"green"===t?s.gamma[me.GREEN]=i:s.gamma[me.BLUE]=i,s.useGamma=!0,(0,h.u)(a)}handleDRAToggle(e){const{smartMappingState:t}=this,{layer:a}=t,s=a,i=(0,h.m)(t),n=(0,h._)(t);if(i.dynamicRangeAdjustment=e,e)i.customStatistics=[];else{const e=n?n.bandIds:s.bandIds,t=this.originalStatistics?.length?e.map((e=>{const{min:t,max:a,avg:s,stddev:i}=this.originalStatistics[e];return[t,a,s,i]})):[],a=e.map((e=>{const t=this.currentStatistics[e];return{min:t.min??0,max:t.max??255,avg:t.avg??0,stddev:t.stddev??1}}));i.customStatistics=JSON.stringify(a)===JSON.stringify(t)?[]:a}(0,h.u)(t)}handleStatisticsChange(e,t,a){const{smartMappingState:s}=this,{layer:i}=s,n=i,r=(0,h.m)(s),l=(0,h._)(s),o=l?l.bandIds:n.bandIds,c=o[t];this.currentStatistics[c][a]=e,r.customStatistics=o.map((e=>{const t=this.currentStatistics[e];return{min:t.min??0,max:t.max??255,avg:t.avg??0,stddev:t.stddev??1}})),(0,h.u)(s)}updateStatisticsDisplay(e){const{min:t=0,max:a=255,avg:s=0,stddev:i=1}=e??{};this.minNode&&(this.minNode.value=`${(0,h.S)(t)?this.round(t):0}`,this.maxNode.value=`${(0,h.S)(a)?this.round(a):255}`,this.avgNode.value=`${(0,h.S)(s)?this.round(s):0}`,this.stddevNode.value=`${(0,h.S)(i)?this.round(i):1}`)}round(e){return Math.round(1e3*e)/1e3}clearHandles(){clearTimeout(this.stddevHandle),clearTimeout(this.percentClipHandle),clearTimeout(this.individualGammaHandle),clearTimeout(this.minStatisticHandle),clearTimeout(this.maxStatisticHandle),clearTimeout(this.avgStatisticHandle),clearTimeout(this.stddevStatisticHandle)}get el(){return(0,s.a)(this)}};ge.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.rgb-block{overflow-x:hidden}.percent-clip-section{display:flex;justify-content:space-between}.percent-clip-section-input{width:48%;display:flex;flex-flow:column;justify-content:space-between}.individual-gamma-label,.range-adjustment-label{font-weight:var(--calcite-font-weight-medium)}.individual-gamma-selection{display:flex;justify-content:space-between}.individual-gamma-selection-value{display:flex;flex-flow:column;justify-content:space-between;width:30%}.footer-buttons{width:100%;display:flex;flex-direction:column;gap:var(--calcite-spacing-sm)}";const ue="traditional",fe="multi-directional",ye="none",Se={azimuth:315,altitude:45,pixelSizePower:.664,pixelSizeFactor:.024,zFactor:1},be=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsRasterShadedReliefClose=(0,s.c)(this,"arcgisSmartMappingPanelsRasterShadedReliefClose",7),this.arcgisSmartMappingPanelsRasterShadedReliefBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRasterShadedReliefBackClick",7),this.arcgisSmartMappingPanelsRasterShadedReliefError=(0,s.c)(this,"arcgisSmartMappingPanelsRasterShadedReliefError",7),this.manager=(0,o.u)(this),this.handles=[],this.smartMappingState=(0,m.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterShadedReliefClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,smartMappingState:t}=this;(0,h.u)(t,e),this.arcgisSmartMappingPanelsRasterShadedReliefClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{modules:e}=this.smartMappingState;this.originalRendererObj=e.esriLang.clone((0,h.m)(this.smartMappingState))}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}disconnectedCallback(){this.handles.forEach((e=>clearTimeout(e)))}render(){const{hideLayerTitle:e,layer:t,strings:a}=this.smartMappingState,i=t.title;return(0,s.h)(s.H,{key:"14e3f50e8e6cfcada0608be336e324d99d37584b",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"a464d93da64c8d318564bf5cf3892b49b81709ca",heading:a.panels.shadedRelief.styleOptions,description:e?void 0:i,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRasterShadedReliefBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderFooterButtons()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.V)(e,t.panels.shadedRelief.shadedRelief);return(0,s.h)("calcite-block",{class:"shaded-relief-block",heading:a,open:!0},this.renderManageStyleButton(),this.renderHillshadeTypeSelector(),this.renderColorScheme(),this.renderAzimuthSlider(),this.renderAltitudeSlider(),this.renderScalingSelector(),this.renderZFactorAndPixelInputs())}renderManageStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"edit",originalRasterProps:{originalRendererObj:this.originalRendererObj},onArcgisDone:e=>{"delete"!==e.detail?(0,s.f)(this.el):this.arcgisSmartMappingPanelsRasterShadedReliefBackClick.emit("delete")},ref:e=>this.manageStyleButtonNode=e})}renderHillshadeTypeSelector(){const{smartMappingState:e}=this;return(0,s.h)("arcgis-smart-mapping-hillshade-type-button",{onArcgisSmartMappingHillshadeTypeButtonBeforeOpen:()=>(0,h.J)(),onArcgisSmartMappingHillshadeTypeButtonChange:t=>{const a=t.target,i=t.detail;(0,h.m)(e).hillshadeType=i,(0,h.u)(e),(0,s.f)(this.el),(0,s.f)(a)}})}renderColorScheme(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{colorRamp:i}=a||{},n=(0,h.a5)(e,i);return(0,s.h)("arcgis-smart-mapping-symbol-button",{label:t.panels.shadedRelief.colorScheme,type:"raster-shaded-relief",rampType:"continuous",colors:n,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,h.u)(e),(0,s.f)(this.el)}})}renderAzimuthSlider(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{hillshadeType:i=fe,azimuth:n=Se.azimuth}=a||{};return i===ue?(0,s.h)("calcite-label",null,t.panels.shadedRelief.azimuth,(0,s.h)("arcgis-smart-mapping-raster-slider",{rendererType:"shaded-relief",showThumbLabel:!0,editThumbLabel:!0,type:"azimuth",min:0,max:360,values:[n],precision:1,minLabel:"0",maxLabel:"360"})):(0,s.h)(s.F,null)}renderAltitudeSlider(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{hillshadeType:i=fe,altitude:n=Se.altitude}=a||{};return i===ue?(0,s.h)("calcite-label",null,t.panels.shadedRelief.altitude,(0,s.h)("arcgis-smart-mapping-raster-slider",{rendererType:"shaded-relief",showThumbLabel:!0,editThumbLabel:!0,type:"altitude",min:0,max:90,values:[n],precision:1,minLabel:"0",maxLabel:"90"})):(0,s.h)(s.F,null)}renderScalingSelector(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{scalingType:i=ye}=a||{},n=t.panels.shadedRelief.scalingOptions;return(0,s.h)("calcite-label",null,t.panels.shadedRelief.scaling,(0,s.h)("calcite-segmented-control",{scale:"s",width:"full",onCalciteSegmentedControlChange:e=>{const t=e.target;this.handleScalingOptionChange(t.value)}},(0,s.h)("calcite-segmented-control-item",{value:"none",checked:"none"===i},n.none),(0,s.h)("calcite-segmented-control-item",{value:"adjusted",checked:"adjusted"===i},n.adjusted)))}renderZFactorAndPixelInputs(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{scalingType:i=ye}=a||{},n=["zFactor"];return"adjusted"===i&&(n.push("pixelSizePower"),n.push("pixelSizeFactor")),(0,s.h)(s.F,null,n.map(((e,i)=>(0,s.h)("calcite-label",null,t.panels.shadedRelief[e],(0,s.h)("calcite-input-number",{label:t.panels.shadedRelief[e],inputMode:"decimal",min:0,step:.1,scale:"s",value:`${a[e]??Se[e]}`,onCalciteInputNumberInput:t=>{const a=t.target;""===a.value||Number.parseFloat(a.value)<0?this.handles[i]=setTimeout((()=>this.handleZFactorOrPixelChange(a,e)),3e3):(clearTimeout(this.handles[i]),setTimeout((()=>this.handleZFactorOrPixelChange(a,e)),300))}})))))}renderFooterButtons(){return(0,s.h)("div",{class:"footer-buttons",slot:"footer"},this.renderDoneButton(),this.renderRegisterStyleButton(),this.renderCancelButton())}renderRegisterStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"register",onArcgisDone:e=>{const{smartMappingState:t}=this,{modules:a}=t;if((0,s.f)(this.el),"register"===e.detail){const e=(0,h.m)(t);this.originalRendererObj=a.esriLang.clone(e)}this.manageStyleButtonNode&&(0,s.f)(this.manageStyleButtonNode),(0,s.f)(this.registerStyleButtonNode)},ref:e=>this.registerStyleButtonNode=e})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.done,onClick:this.handleDone,appearance:"solid",width:"full"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.cancel)}handleScalingOptionChange(e){const{smartMappingState:t}=this;(0,h.m)(t).scalingType=e,(0,h.u)(t),(0,s.f)(this.el)}handleZFactorOrPixelChange(e,t){const{smartMappingState:a}=this,s=(0,h.m)(a);let i=Number.parseFloat(e.value);(Number.isNaN(i)||i<e.min)&&(i=e.min),e.value=`${i}`,s[t]=i,(0,h.u)(a)}get el(){return(0,s.a)(this)}};be.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.shaded-relief-block{overflow-x:hidden}.footer-buttons{width:100%;display:flex;flex-direction:column;gap:var(--calcite-spacing-sm)}";const Ce={min:0,max:255,avg:0,stddev:1},ve=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsRasterStretchClose=(0,s.c)(this,"arcgisSmartMappingPanelsRasterStretchClose",7),this.arcgisSmartMappingPanelsRasterStretchBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRasterStretchBackClick",7),this.arcgisSmartMappingPanelsRasterStretchError=(0,s.c)(this,"arcgisSmartMappingPanelsRasterStretchError",7),this.manager=(0,o.u)(this),this.disconnected=!1,this.smartMappingState=(0,m.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterStretchClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,originalEffect:t,originalBandCombination:a,smartMappingState:s}=this,{layer:i}=s,n=i;n.effect=t;const r=(0,h._)(s);r?r.bandIds=a:n.bandIds=a,(0,h.u)(s,e),this.arcgisSmartMappingPanelsRasterStretchClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{smartMappingState:e}=this,{layer:t,rasterInfo:a,modules:s}=e,i=t,{statistics:n}=a;this.originalRendererObj=s.esriLang.clone((0,h.m)(this.smartMappingState)),this.originalEffect=i.effect??void 0,this.originalBandCombination=(0,h.a0)(e),this.originalStatistics=s.esriLang.clone(n);const r=(0,h._)(e);r&&1!==r.bandIds?.length?r.bandIds=[0]:1!==i.bandIds?.length&&(i.bandIds=[0]);const l=r?r.bandIds[0]:i.bandIds[0];this.currentStatistics=[];for(let e=0;e<a.bandCount;e++)if(e===l){let t;this.originalRendererObj?.customStatistics?.[0]&&(t=s.esriLang.clone(this.originalRendererObj?.customStatistics?.[0])),t?this.currentStatistics.push(t):this.originalStatistics?.[e]?this.currentStatistics.push(s.esriLang.clone(this.originalStatistics[e])):this.currentStatistics.push({min:0,max:255,avg:0,stddev:1})}else this.originalStatistics?.[e]?this.currentStatistics.push(s.esriLang.clone(this.originalStatistics[e])):this.currentStatistics.push({min:0,max:255,avg:0,stddev:1})}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}disconnectedCallback(){this.disconnected=!0,this.clearHandles()}render(){const{hideLayerTitle:e,layer:t,strings:a}=this.smartMappingState,i=t.title;return(0,s.h)(s.H,{key:"6b08174d6101851b50f2d8d66694e22a7d0448b1",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"7f63fdb6f84015955f8ea8e5b448b8f4602809b4",heading:a.panels.stretch.styleOptions,description:e?void 0:i,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRasterStretchBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderFooterButtons()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.V)(e,t.panels.stretch.stretch);return(0,s.h)("calcite-block",{class:"stretch-block",heading:a,open:!0},this.renderManageStyleButton(),this.renderStretchTypeSelector(),this.renderStandardDeviationSection(),this.renderPercentClipSection(),this.renderBandSelector(),this.renderGammaSlider(),this.renderColorScheme(),this.renderRangeAdjustmentToggle(),this.renderStatisticsTable())}renderManageStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"edit",originalRasterProps:{originalRendererObj:this.originalRendererObj,originalEffect:this.originalEffect,originalBandCombination:this.originalBandCombination},onArcgisDone:e=>{"delete"!==e.detail?(0,s.f)(this.el):this.arcgisSmartMappingPanelsRasterStretchBackClick.emit("delete")},ref:e=>this.manageStyleButtonNode=e})}renderStretchTypeSelector(){const{smartMappingState:e}=this;return(0,s.h)("arcgis-smart-mapping-stretch-type-button",{onArcgisSmartMappingStretchTypeButtonBeforeOpen:()=>(0,h.J)(),onArcgisSmartMappingStretchTypeButtonChange:t=>{const a=t.target,i=t.detail;(0,f.r)((0,h.a7)(e,{stretchType:i}),this.flowItemNode).then((t=>{const n=this.getBandIndex();(0,h.S)(this.currentStatistics)&&(t.renderer.customStatistics=[this.currentStatistics[n]]),"none"===i&&(t.renderer.dynamicRangeAdjustment=!1,t.renderer.colorRamp=void 0),(0,h.u)(e,t.renderer),(0,s.f)(this.el),(0,s.f)(a)}),(e=>{(0,s.f)(a),this.arcgisSmartMappingPanelsRasterStretchError.emit(e)}))}})}renderStandardDeviationSection(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{stretchType:i=h.a6.STRETCH_TYPE}=a||{};if(!(i===h.a8.STANDARD_DEVIATION))return(0,s.h)(s.F,null);let{numberOfStandardDeviations:n}=a||{};return(0,h.S)(n)&&0!==n||(n=h.a6.STD_DEV),(0,s.h)("calcite-label",null,t.panels.stretch.stddev,(0,s.h)("calcite-input-number",{label:t.panels.stretch.stddev,scale:"s",inputMode:"decimal",min:1,max:100,step:.1,value:`${n}`,onCalciteInputNumberInput:e=>{clearTimeout(this.stddevHandle);const t=e.target,a=Number.parseFloat(t.value);t.value&&a>=t.min&&a<=t.max?this.handlePercentOrStddevChange(t,"stddev"):this.stddevHandle=setTimeout((()=>this.handlePercentOrStddevChange(t,"stddev")),3e3)}}))}renderPercentClipSection(){const{smartMappingState:e}=this,t=(0,h.m)(e),{stretchType:a=h.a6.STRETCH_TYPE}=t||{};if(!(a===h.a8.PERCENT_CLIP))return(0,s.h)(s.F,null);let{minPercent:i,maxPercent:n}=t||{};return(!(0,h.S)(i)||i<=0||i>=100)&&(i=h.a6.MIN_PERCENT),(!(0,h.S)(n)||n<=0||n>=100)&&(n=h.a6.MAX_PERCENT),i=Number.parseFloat(i.toFixed(1)),n=Number.parseFloat(n.toFixed(1)),t.minPercent=i,t.maxPercent=n,(0,h.u)(e),(0,s.h)("div",{class:"percent-clip-section"},this.renderPercentClipSectionInput("min",i),this.renderPercentClipSectionInput("max",n))}renderPercentClipSectionInput(e,t){const{strings:a}=this.smartMappingState;return(0,s.h)("div",{class:"percent-clip-section-input"},(0,s.h)("calcite-label",null,a.panels.stretch[e],(0,s.h)("calcite-input-number",{label:a.panels.stretch[e],scale:"s",inputMode:"decimal",min:.1,max:99.9,step:.1,suffixText:"%",value:`${t}`,onCalciteInputNumberInput:t=>{clearTimeout(this.percentClipHandle);const a=t.target,s=Number.parseFloat(a.value);a.value&&s>=a.min&&s<=a.max?this.handlePercentOrStddevChange(a,e):this.percentClipHandle=setTimeout((()=>this.handlePercentOrStddevChange(a,e)),3e3)}})))}renderBandSelector(){const{smartMappingState:e}=this,{layer:t,rasterInfo:a,strings:i}=e,n=t,{bandCount:r}=a;if(!(r>1))return(0,s.h)(s.F,null);const{bandInfos:l}=a,o=l.map((e=>e.name));return(0,s.h)("calcite-label",null,i.panels.stretch.band,(0,s.h)("calcite-combobox",{overlayPositioning:"fixed",label:i.panels.stretch.band,clearDisabled:!0,selectionMode:"single-persist",onCalciteComboboxChange:t=>{const a=t.target,i=(0,h.m)(e),r=(0,h._)(e);r?r.bandIds=[o.indexOf(a.value)]:n.bandIds=[o.indexOf(a.value)];const l=this.getBandIndex();i.customStatistics=[this.currentStatistics[l]??Ce];const{min:c=0,max:d=255,avg:p=0,stddev:m=1}=i.customStatistics[0],{stretchType:g=h.a6.STRETCH_TYPE}=i||{},u=g===h.a8.PERCENT_CLIP,f=g===h.a8.NONE,{dynamicRangeAdjustment:y}=i;!y&&!(f||u)&&(this.minNode.value=`${(0,h.S)(c)?this.round(c):0}`,this.maxNode.value=`${(0,h.S)(d)?this.round(d):255}`,this.avgNode.value=`${(0,h.S)(p)?this.round(p):0}`,this.stddevNode.value=`${(0,h.S)(m)?this.round(m):1}`),(0,h.u)(e),(0,s.f)(this.el)}},o.map(((e,t)=>this.renderBandOptions(e,t)))))}renderBandOptions(e,t){const a=this.getBandIndex();return(0,s.h)("calcite-combobox-item",{textLabel:e,value:e,selected:a===t})}renderGammaSlider(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e);let{gamma:i=[h.a6.GAMMA]}=a||{};(0,h.S)(i)||(i=[h.a6.GAMMA]);const{stretchType:n=h.a6.STRETCH_TYPE}=a||{};return n===h.a8.NONE?(0,s.h)(s.F,null):(0,s.h)("calcite-label",null,t.panels.stretch.gamma,(0,s.h)("arcgis-smart-mapping-gamma-slider",{gamma:i[0],rendererType:"raster-stretch"}))}renderColorScheme(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{stretchType:i=h.a6.STRETCH_TYPE}=a||{};if(i===h.a8.NONE)return(0,s.h)(s.F,null);const{colorRamp:n}=a||{},r=(0,h.a5)(e,n);return(0,s.h)("arcgis-smart-mapping-symbol-button",{label:t.panels.stretch.colorScheme,type:"raster-stretch",rampType:"continuous",colors:r,onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,h.u)(e),(0,s.f)(this.el)}})}renderRangeAdjustmentToggle(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{dynamicRangeAdjustment:i}=a,{stretchType:n=h.a6.STRETCH_TYPE}=a||{};return n===h.a8.NONE?(0,s.h)(s.F,null):(0,s.h)("calcite-label",{layout:"inline-space-between",class:"range-adjustment-label"},t.panels.stretch.dynamicRangeAdjustment,(0,s.h)("calcite-switch",{scale:"s",checked:i,onCalciteSwitchChange:e=>{const t=e.target.checked;this.handleDRAToggle(t),(0,s.f)(this.el)}}))}renderStatisticsTable(){const{originalStatistics:e,smartMappingState:t}=this,{rasterInfo:a,modules:i,strings:n}=t,r=(0,h.m)(t),{stretchType:l=h.a6.STRETCH_TYPE}=r||{},o=l===h.a8.PERCENT_CLIP,c=l===h.a8.NONE,d=l===h.a8.STANDARD_DEVIATION,{dynamicRangeAdjustment:p}=r;if(!(!p&&!(c||o)))return(0,s.h)(s.F,null);const m=null!==a.statistics;let{customStatistics:g}=r||{};(!g||g.length<1)&&(g=i.esriLang.clone(e));const u=this.getBandIndex(),f=(!m||o)&&!d,{min:y=0,max:S=255,avg:b=0,stddev:C=1}=g?.[0]||{};return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,n.panels.stretch.statistics),(0,s.h)("calcite-label",null,n.panels.stretch.min,(0,s.h)("calcite-input-number",{label:n.panels.stretch.min,scale:"s",inputMode:"decimal",step:.1,numberButtonType:"none",value:`${(0,h.S)(y)?this.round(y):0}`,onCalciteInputNumberInput:(0,v.d)((()=>{if(this.disconnected)return;clearTimeout(this.minStatisticHandle);const e=Number.parseFloat(this.minNode.value);!Number.isNaN(e)&&e<=this.currentStatistics[u].max?(this.minNode.value=`${e}`,this.handleStatisticsChange(e,u,"min")):this.minStatisticHandle=setTimeout((()=>{const e=this.round(this.currentStatistics[u].min);this.minNode.value=`${e}`}),3e3)}),300),ref:e=>this.minNode=e})),(0,s.h)("calcite-label",null,n.panels.stretch.max,(0,s.h)("calcite-input-number",{label:n.panels.stretch.max,scale:"s",inputMode:"decimal",step:.1,numberButtonType:"none",value:`${(0,h.S)(S)?this.round(S):255}`,onCalciteInputNumberInput:(0,v.d)((()=>{if(this.disconnected)return;clearTimeout(this.maxStatisticHandle);const e=Number.parseFloat(this.maxNode.value);!Number.isNaN(e)&&e>=this.currentStatistics[u].min?(this.maxNode.value=`${e}`,this.handleStatisticsChange(e,u,"max")):this.maxStatisticHandle=setTimeout((()=>{const e=this.round(this.currentStatistics[u].max);this.maxNode.value=`${e}`}),3e3)}),300),ref:e=>this.maxNode=e})),(0,s.h)("calcite-label",null,n.panels.stretch.mean,(0,s.h)("calcite-input-number",{label:n.panels.stretch.mean,scale:"s",inputMode:"decimal",step:.1,disabled:f,numberButtonType:"none",value:`${(0,h.S)(b)?this.round(b):0}`,onCalciteInputNumberInput:(0,v.d)((()=>{if(this.disconnected)return;clearTimeout(this.avgStatisticHandle);const e=Number.parseFloat(this.avgNode.value);Number.isNaN(e)?this.avgStatisticHandle=setTimeout((()=>{const e=this.round(this.currentStatistics[u].avg);this.avgNode.value=`${e}`}),3e3):(this.avgNode.value=`${e}`,this.handleStatisticsChange(e,u,"avg"))}),300),ref:e=>this.avgNode=e})),(0,s.h)("calcite-label",null,n.panels.stretch.stddev,(0,s.h)("calcite-input-number",{label:n.panels.stretch.stddev,scale:"s",inputMode:"decimal",step:.1,disabled:f,numberButtonType:"none",value:`${(0,h.S)(C)?this.round(C):1}`,onCalciteInputNumberInput:(0,v.d)((()=>{if(this.disconnected)return;clearTimeout(this.stddevStatisticHandle);const e=Number.parseFloat(this.stddevNode.value);Number.isNaN(e)?this.stddevStatisticHandle=setTimeout((()=>{const e=this.round(this.currentStatistics[u].stddev);this.stddevNode.value=`${e}`}),3e3):(this.stddevNode.value=`${e}`,this.handleStatisticsChange(e,u,"stddev"))}),300),ref:e=>this.stddevNode=e})))}renderFooterButtons(){return(0,s.h)("div",{class:"footer-buttons",slot:"footer"},this.renderDoneButton(),this.renderRegisterStyleButton(),this.renderCancelButton())}renderRegisterStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"register",onArcgisDone:e=>{const{smartMappingState:t}=this,{modules:a}=t;if((0,s.f)(this.el),"register"===e.detail){const e=(0,h.m)(t);this.originalRendererObj=a.esriLang.clone(e),this.originalBandCombination=(0,h.a0)(t)}this.manageStyleButtonNode&&(0,s.f)(this.manageStyleButtonNode),(0,s.f)(this.registerStyleButtonNode)},ref:e=>this.registerStyleButtonNode=e})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.done,onClick:this.handleDone,appearance:"solid",width:"full"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.cancel)}getBandIndex(){const{smartMappingState:e}=this,{layer:t}=e,a=t,s=(0,h._)(e);return s?s.bandIds[0]??h.a6.BAND_INDEX:a.bandIds[0]??h.a6.BAND_INDEX}handlePercentOrStddevChange(e,t){const{smartMappingState:a}=this,s=(0,h.m)(a);let i=Number.parseFloat(e.value);Number.isNaN(i)||i<e.min?i=e.min:i>e.max&&(i=e.max),i=Number.parseFloat(i.toFixed(1)),e.value=`${i}`,"min"===t?s.minPercent=i:"max"===t?s.maxPercent=i:s.numberOfStandardDeviations=i,(0,h.u)(a)}handleDRAToggle(e){const{smartMappingState:t}=this,a=(0,h.m)(t),s=this.getBandIndex();a.dynamicRangeAdjustment=e,a.customStatistics=e?[]:[this.currentStatistics[s]],(0,h.u)(t)}handleStatisticsChange(e,t,a){const{smartMappingState:s}=this,i=(0,h.m)(s);this.currentStatistics[t][a]=e,i.customStatistics=[this.currentStatistics[t]],(0,h.u)(s)}round(e){return Math.round(1e3*e)/1e3}clearHandles(){clearTimeout(this.stddevHandle),clearTimeout(this.percentClipHandle),clearTimeout(this.minStatisticHandle),clearTimeout(this.maxStatisticHandle),clearTimeout(this.avgStatisticHandle),clearTimeout(this.stddevStatisticHandle)}get el(){return(0,s.a)(this)}};ve.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.stretch-block{overflow-x:hidden}.percent-clip-section{display:flex;justify-content:space-between}.percent-clip-section-input{width:48%;display:flex;flex-flow:column;justify-content:space-between}.range-adjustment-label{font-weight:var(--calcite-font-weight-medium)}.footer-buttons{width:100%;display:flex;flex-direction:column;gap:var(--calcite-spacing-sm)}";const we=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsRasterUniqueValueClose=(0,s.c)(this,"arcgisSmartMappingPanelsRasterUniqueValueClose",7),this.arcgisSmartMappingPanelsRasterUniqueValueBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRasterUniqueValueBackClick",7),this.arcgisSmartMappingPanelsRasterUniqueValueError=(0,s.c)(this,"arcgisSmartMappingPanelsRasterUniqueValueError",7),this.manager=(0,o.u)(this),this.inputNodes=[],this.labelNodes=[],this.colorNodes=[],this.smartMappingState=(0,m.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterUniqueValueClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,smartMappingState:t}=this;(0,h.u)(t,e),this.arcgisSmartMappingPanelsRasterUniqueValueClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{modules:e,strings:t}=this.smartMappingState,a=(0,h.m)(this.smartMappingState),s=(0,h.n)(this.smartMappingState);this.smartMappingState.lastDefault={defaultSymbol:a.defaultSymbol||(0,h.f)(this.smartMappingState,s),defaultLabel:a.defaultLabel||t.panels.uniqueValue.other},this.originalRendererObj=e.esriLang.clone((0,h.m)(this.smartMappingState))}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus())))}disconnectedCallback(){(0,h.a9)()}render(){const{hideLayerTitle:e,layer:t,strings:a}=this.smartMappingState,i=t.title;return(0,s.h)(s.H,{key:"4321ee9c470ae2fae30726a0e7962051fcd1f69b",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"bafe3afa48b323a224554dc4390135ed84a2d58c",heading:a.panels.uniqueValue.styleOptions,description:e?void 0:i,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRasterUniqueValueBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderFooterButtons()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.V)(e,t.panels.uniqueValue.uniqueValue);return(0,s.h)("calcite-block",{class:"unique-value-block",heading:a,open:!0},this.renderManageStyleButton(),this.renderFieldSelector(),this.renderColorScheme(),this.renderValues())}renderManageStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"edit",originalRasterProps:{originalRendererObj:this.originalRendererObj},onArcgisDone:e=>{"delete"!==e.detail?(0,s.f)(this.el):this.arcgisSmartMappingPanelsRasterUniqueValueBackClick.emit("delete")},ref:e=>this.manageStyleButtonNode=e})}renderFieldSelector(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e).field||t.panels.uniqueValue.value,i=(0,h.aa)(e),n=i.map((e=>({label:e.alias,layerField:e,simpleFieldType:h.w.STRING}))),r=i.find((e=>e.name===a));return(0,s.h)("arcgis-smart-mapping-attribute-input",{label:t.panels.uniqueValue.field,fieldList:n,selectedField:{field:r?.name??t.panels.uniqueValue.value,simpleFieldType:h.w.STRING},mode:"simple",popoverReferenceElement:this.flowItemNode,onArcgisSmartMappingAttributeInputChange:e=>{if(e.detail){const t=e.detail.field;this.handleFieldChange(t)}}})}renderColorScheme(){const{smartMappingState:e}=this,{mapView:t,modules:a,strings:i}=e,n=(0,h.m)(e),r=n.uniqueValueInfos;if(!r.length)return(0,s.h)(s.F,null);const l=a.typeSchemes.getSchemes({basemap:t.map?.basemap,geometryType:"polygon"}),o=(0,h.ae)(l,Math.min(r.length,10))[0].colors,c=[];return n.authoringInfo?.colorRamp?c.push(...(0,h.a5)(e,n.authoringInfo.colorRamp)):c.push(...r?.length?r.map(((t,s)=>(0,h.h)(e,t.symbol)||new a.EsriColor(o[s%o.length]))):[]),(0,s.h)("arcgis-smart-mapping-symbol-button",{label:i.panels.uniqueValue.colorScheme,type:"raster-unique-value",rampType:"continuous",colors:a.esriLang.clone(c).reverse(),onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,h.u)(e),(0,s.f)(this.el),(0,s.f)(this.symbolButtonNode)},ref:e=>this.symbolButtonNode=e})}renderValues(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e);return this.labelNodes=[],this.inputNodes=[],(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,a.field),(0,s.h)("calcite-list",{label:t.panels.uniqueValue.uniqueValue,group:"unique-value-items",class:"gray-border",dragEnabled:!0,onCalciteListOrderChange:e=>{if(e.detail.toEl){const t=e.detail.dragEl;if("other-values-list"===e.detail.toEl.id){const e=a.uniqueValueInfos.filter(((e,a)=>a!==Number.parseInt(t.label)));a.uniqueValueInfos=e}}const t=Array.from(e.target.children);this.handleSortValues(t)}},a.uniqueValueInfos.map(((e,t)=>this.renderValue(e,t)))),this.renderDefaultValue(),(0,s.h)("calcite-list",{label:t.panels.uniqueValue.uniqueValue,id:"other-values-list",dragEnabled:!0,group:"unique-value-items"}))}renderValue(e,t){return(0,s.h)("calcite-list-item",{key:`values-${e.value}`,value:`${e.value}`,label:`${t}`},(0,s.h)("div",{slot:"actions-start"},this.renderColorNode(e,t)),this.renderTextNode(e,t))}renderColorNode(e,t){const{smartMappingState:a}=this,{strings:i}=a,n=e.symbol.clone(),r={"symbol-is-white":(0,h.T)(a,n),symbol:!0};return-1!==t&&this.colorNodes.length&&(this.colorNodes=[]),(0,s.h)("div",{class:r,tabindex:"0","aria-label":i.panels.uniqueValue.accessibility.editColorFor.replace("${value}",e.label),"aria-haspopup":"true",ref:e=>{e&&(-1===t?this.defaultColorNode=e:this.colorNodes.push(e))},onClick:()=>{if(this.popoverNode){(-1===this.selectedPopoverIdx?this.defaultColorNode:this.colorNodes[this.selectedPopoverIdx]).classList.remove("selected"),this.selectedPopoverIdx===t?((0,h.J)(),this.popoverNode=void 0,this.selectedPopoverIdx=void 0):(this.selectedPopoverIdx=t,this.handleColorClick(t))}else this.selectedPopoverIdx=t,this.handleColorClick(t)},onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleColorClick(t))}},(0,s.h)("div",{ref:e=>{e&&this.afterCreateColorNode(e,t)}}))}renderTextNode(e,t){const{strings:a}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("div",{class:(-1===t?"default-label":"")+" label",slot:"content",tabindex:"0",ref:e=>{e&&(-1===t?this.defaultLabelNode=e:this.labelNodes[t]=e)},"aria-label":a.panels.uniqueValue.accessibility.editLabelFor.replace("${value}",e.label),onClick:e=>this.handleLabelEdit(t,e),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleLabelEdit(t,e)}},e.label),(0,s.h)("calcite-input",{slot:"content",class:"hidden",scale:"s",ref:e=>{e&&(-1===t?this.defaultInputNode=e:this.inputNodes[t]=e,this.defaultInputNode?.classList.add("default-input-padding"))},value:e.label??void 0,onCalciteInputChange:e=>{const a=-1===t?this.defaultInputNode:this.inputNodes[t],s=-1===t?this.defaultLabelNode:this.labelNodes[t];a.classList.add("hidden"),s.classList.remove("hidden"),this.handleValueTextChange(t,e)},onFocusout:e=>{const a=-1===t?this.defaultInputNode:this.inputNodes[t],s=-1===t?this.defaultLabelNode:this.labelNodes[t];a.classList.add("hidden"),s.classList.remove("hidden"),this.handleValueTextChange(t,e)},onKeyDown:a=>{if("Escape"===a.key||"Enter"===a.key){(-1===t?this.defaultInputNode:this.inputNodes[t]).classList.add("hidden");const s=a.currentTarget;s.value=e.label||"",s.disabled=!0,this.handleValueTextChange(t,a);const i=-1===t?this.defaultLabelNode:this.labelNodes[t];i.classList.remove("hidden"),s.disabled=!1,setTimeout((()=>i.focus()),300)}}}))}renderDefaultValue(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i=(0,h.n)(e),n=a.defaultSymbol||(0,h.f)(e,i),r=a.defaultLabel||t.panels.uniqueValue.other,l={symbol:n,label:r};return(0,s.h)("calcite-list",{class:"default-list-padding",label:r},(0,s.h)("calcite-list-item",null,(0,s.h)("calcite-checkbox",{class:"checkbox",slot:"actions-start",tabIndex:0,checked:!!a.defaultSymbol,onClick:e=>this.handleCheckboxClick(e),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleCheckboxClick(e))},onMouseOver:()=>(0,h.ab)(this.checkboxNode,t.panels.uniqueValue.otherTooltip),onMouseOut:()=>(0,h.a9)(),onFocus:()=>(0,h.ab)(this.checkboxNode,t.panels.uniqueValue.otherTooltip),onFocusout:()=>(0,h.a9)(),ref:e=>{e&&(this.checkboxNode=e)}}),(0,s.h)("div",{slot:"content-start",class:"symbol-container"},this.renderColorNode(l,-1)),this.renderTextNode(l,-1)))}renderFooterButtons(){return(0,s.h)("div",{class:"footer-buttons",slot:"footer"},this.renderDoneButton(),this.renderRegisterStyleButton(),this.renderCancelButton())}renderRegisterStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"register",onArcgisDone:e=>{const{smartMappingState:t}=this,{modules:a}=t;if((0,s.f)(this.el),"register"===e.detail){const e=(0,h.m)(t);this.originalRendererObj=a.esriLang.clone(e)}this.manageStyleButtonNode&&(0,s.f)(this.manageStyleButtonNode),(0,s.f)(this.registerStyleButtonNode)},ref:e=>this.registerStyleButtonNode=e})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.done,onClick:this.handleDone,appearance:"solid",width:"full"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.cancel)}handleFieldChange(e){const{smartMappingState:t}=this,a=(0,h.m)(t);if(!a.uniqueValueInfos.length)return;const i={field:e};!(0,h.ac)(t)&&a.authoringInfo?.colorRamp&&(i.colorRamp=a.authoringInfo.colorRamp),(0,f.r)((0,h.ad)(t,i),this.flowItemNode).then((e=>{(0,h.u)(t,e.renderer),(0,s.f)(this.el)}),(e=>{this.fieldNode.value=a.field,this.arcgisSmartMappingPanelsRasterUniqueValueError.emit(e)}))}handleSortValues(e){const{smartMappingState:t}=this,{modules:a,strings:i}=t,n=(0,h.n)(t),r=(0,h.m)(t);(0,h.J)();const l=e.map((e=>e.value)),o=r.uniqueValueInfos.map((e=>a.esriLang.clone(e)));o.sort(((e,t)=>l.indexOf(`${e.value}`)-l.indexOf(`${t.value}`))),o.length?r.uniqueValueInfos=o:(r.defaultSymbol=(0,h.f)(t,n),r.defaultLabel=i.panels.uniqueValue.other),(0,h.u)(t),(0,s.f)(this.el)}afterCreateColorNode(e,t){const{smartMappingState:a}=this,{modules:s}=a,i=(0,h.m)(a),n=(0,h.n)(a),r=-1===t?i.defaultSymbol||(0,h.f)(a,n):i.uniqueValueInfos[t].symbol.clone();for(-1===t&&r.outline&&(r.outline.width=0),(0,h.T)(a,r)&&(r.outline=new s.SimpleLineSymbol({color:"#bdc3c7",width:.75}));e?.childNodes?.length;)e.removeChild(e.childNodes[0]);const{symbolUtils:l}=s;r&&l.renderPreviewHTML(r,{size:(0,h.U)(r),ignoreWhiteSymbols:!0,symbolConfig:{isSquareFill:!0}}).then((t=>e?.appendChild(t)))}handleColorClick(e){(0,h.J)();const{smartMappingState:t}=this,{strings:a}=t,i=(0,g.b)(t,{referenceElement:this.flowItemNode,heading:a.panels.uniqueValue.colorScheme});i.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>this.handleRemoveColorFocus(i,e,!1))),i.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>this.handleRemoveColorFocus(i,e,!0))),this.smartMappingState.selectedValue=e,(0,C.a)(t,{popoverNode:i,onChange:()=>{const i=(0,h.m)(t);-1!==e||i.defaultLabel||(i.defaultLabel=a.panels.uniqueValue.other),(0,h.u)(t),(0,s.f)(this.el),this.symbolButtonNode&&(0,s.f)(this.symbolButtonNode)}}),this.popoverNode=i,-1===e?this.defaultColorNode.classList.add("selected"):this.colorNodes[e].classList.add("selected")}handleRemoveColorFocus(e,t,a){(0,g.r)(e),setTimeout((()=>{const e=-1===t?this.defaultColorNode:this.colorNodes[t];a||e.focus(),e.classList.remove("selected"),this.popoverNode=void 0}),300)}handleLabelEdit(e,t){const a=-1===e?this.defaultInputNode:this.inputNodes[e];a.classList.remove("hidden"),a.setFocus(),t.target.classList.add("hidden")}handleValueTextChange(e,t){const{smartMappingState:a}=this,{strings:i}=a,n=(0,h.m)(a);if(-1===e&&!n.defaultLabel)return this.defaultInputNode.value=i.panels.uniqueValue.other,this.defaultLabelNode.textContent=i.panels.uniqueValue.other,(0,h.u)(a),void(0,s.f)(this.el);const r=t.target;-1===e?n.defaultLabel=r.value:n.uniqueValueInfos[e].label=r.value,""===r.value?-1===e?(n.defaultLabel=i.panels.uniqueValue.other,this.defaultInputNode.value=i.panels.uniqueValue.other,this.defaultLabelNode.textContent=i.panels.uniqueValue.other):(n.uniqueValueInfos[e].label=`${n.uniqueValueInfos[e].value}`,this.inputNodes[e].value=n.uniqueValueInfos[e].label):-1===e&&(this.defaultInputNode.value=n.defaultLabel,this.defaultLabelNode.textContent=n.defaultLabel),(0,h.u)(a),(0,s.f)(this.el)}handleCheckboxClick(e){const{smartMappingState:t}=this,{lastDefault:a,strings:i}=t,n=(0,h.m)(t);(0,g.r)(this.popoverNode),this.popoverNode=void 0,(0,h.J)(),n.uniqueValueInfos.length?(n.defaultSymbol?(n.defaultSymbol=void 0,n.defaultLabel=void 0,this.defaultLabelNode.textContent=i.panels.uniqueValue.other,this.defaultInputNode.value=i.panels.uniqueValue.other):(n.defaultSymbol=a.defaultSymbol,n.defaultLabel=this.defaultLabelNode.textContent),(0,h.u)(t),(0,s.f)(this.el)):e.target.checked=!0}get el(){return(0,s.a)(this)}};we.style=":host{width:100%;display:none}:host([selected]){display:flex}.flow-item{height:100%}.unique-value-block{overflow-x:hidden;overflow-wrap:anywhere}.label{padding:5px auto}.symbol{width:19px;height:19px}.symbol:focus,.label:focus{outline:2px solid var(--calcite-color-brand)}.symbol-container{cursor:pointer}.selected{outline:1px solid var(--calcite-color-brand)}.hidden{display:none}.gray-border{border-top:1px solid #e0e0e0;border-bottom:1px solid #e0e0e0}.checkbox{margin:0px 5.5px}.default-list-padding{padding-top:8px}.footer-buttons{width:100%;display:flex;flex-direction:column;gap:var(--calcite-spacing-sm)}";const Me=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsRasterVectorFieldClose=(0,s.c)(this,"arcgisSmartMappingPanelsRasterVectorFieldClose",7),this.arcgisSmartMappingPanelsRasterVectorFieldBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRasterVectorFieldBackClick",7),this.arcgisSmartMappingPanelsRasterVectorFieldError=(0,s.c)(this,"arcgisSmartMappingPanelsRasterVectorFieldError",7),this.manager=(0,o.u)(this),this.documentClickHandler=void 0,this.smartMappingState=(0,m.u)(),this.handleDone=()=>{this.arcgisSmartMappingPanelsRasterVectorFieldClose.emit("save")},this.handleCancel=()=>{const{originalRendererObj:e,smartMappingState:t}=this;(0,h.u)(t,e),this.arcgisSmartMappingPanelsRasterVectorFieldClose.emit("cancel")},this.menuOpen=!1,this.showBackButton=!1,this.selected=!1,this.beforeBack=void 0}async setFocus(){await(this.flowItemNode?.setFocus())}componentWillLoad(){const{smartMappingState:e}=this,{modules:t}=e;this.originalRendererObj=t.esriLang.clone((0,h.m)(this.smartMappingState)),this.speedUnitOptions=this.getSpeedUnitOptions()}componentDidLoad(){requestAnimationFrame((async()=>await(this.flowItemNode?.setFocus()))),this.currentInput=this.inputUnitNode.value,this.currentOutput=this.outputUnitNode.value}render(){const{hideLayerTitle:e,layer:t,strings:a}=this.smartMappingState,i=t.title;return(0,s.h)(s.H,{key:"97a54254e166a085adf0e5ceaba0621b2ca96310",class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:"7b61afec53ee852f34945a7736adeb432af317c6",heading:a.panels.vectorField.styleOptions,description:e?void 0:i,class:"flow-item",closable:(0,h.K)(this.el),showBackButton:this.showBackButton,selected:this.selected,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsRasterVectorFieldBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderFooterButtons()))}renderVisualization(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.V)(e,t.panels.vectorField.vectorField);return(0,s.h)("calcite-block",{class:"vector-field-block",heading:a,open:!0},this.renderManageStyleButton(),this.renderSymbolStyleSelector(),this.renderSymbolDensitySlider(),this.renderSymbolScalingSlider(),this.renderInvertSymbols(),this.renderMagnitudeRange(),this.renderUnitSelectors())}renderManageStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"edit",originalRasterProps:{originalRendererObj:this.originalRendererObj},onArcgisDone:e=>{"delete"!==e.detail?(0,s.f)(this.el):this.arcgisSmartMappingPanelsRasterVectorFieldBackClick.emit("delete")},ref:e=>this.manageStyleButtonNode=e})}renderSymbolStyleSelector(){const{smartMappingState:e}=this;return(0,s.h)("arcgis-smart-mapping-vector-symbol-button",{ref:e=>this.selectNode=e,onArcgisSmartMappingSelectBeforeOpen:()=>{this.popoverNode?.parentElement?.removeChild(this.popoverNode),this.popoverNode=void 0,this.popoverOpen=!1},onArcgisSmartMappingSelectChange:t=>{const a=(0,h.m)(e);let i=t.detail;i.includes("beaufort")&&(i=this.getExactBeaufortUnit(a.outputUnit)),this.resetOutputUnit(i,a),(0,f.r)(async function(e,t){const{layer:a,modules:s}=e,i=a,n=(0,h.m)(e),r="imagery"===i.type?i.rasterFunction??void 0:void 0;return t=t||{},await s.RasterVectorFieldCreator.createRenderer({layer:i,rasterFunction:r,style:t.style||n.style}).then((e=>{e.renderer.symbolTileSize=n.symbolTileSize;const t=(0,h.b)(n,"size");return e.renderer.visualVariables=(0,h.a)(e.renderer,"size")||[],e.renderer.visualVariables.push(t),e.renderer.flowRepresentation=n.flowRepresentation,e.renderer.inputUnit=n.inputUnit,e.renderer.outputUnit=n.outputUnit,e}))}(e,{style:i}),this.flowItemNode).then((t=>{(0,h.u)(e,t.renderer),(0,s.f)(this.el),this.selectNode&&(0,s.f)(this.selectNode)}),(e=>{(0,s.f)(this.selectNode),this.arcgisSmartMappingPanelsRasterVectorFieldError.emit(e)}))}})}renderSymbolDensitySlider(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),{symbolTileSize:i}=a||{},n=100/i;return(0,s.h)("calcite-label",null,t.panels.vectorField.symbolDensity,(0,s.h)("arcgis-smart-mapping-raster-slider",{rendererType:"vector-field",type:"density",min:1,max:5,values:[Math.round(10*n)/10],precision:1,minLabel:t.panels.flow.low,maxLabel:t.panels.flow.high}))}renderSymbolScalingSlider(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i=(0,h.b)(a,"size"),{minSize:n,maxSize:r}=i;return(0,s.h)("calcite-label",null,t.panels.vectorField.symbolScaling,(0,s.h)("calcite-slider",{min:0,minValue:null!==n?n:20,max:100,maxValue:null!==r?r:80,step:1,labelHandles:!0,labelTicks:!0,precise:!0,snap:!0,onCalciteSliderInput:(0,v.d)((()=>{const e=this.symbolScalingSliderNode.minValue,t=this.symbolScalingSliderNode.maxValue;this.handleSymbolScaleChange(e,t)}),300),ref:e=>this.symbolScalingSliderNode=e}))}renderInvertSymbols(){const{smartMappingState:e}=this,{strings:t}=e,a="flow-from"!==(0,h.m)(e).flowRepresentation;return(0,s.h)("div",{class:"invert-symbol-wrapper"},(0,s.h)("calcite-label",{layout:"inline-space-between"},(0,s.h)("section",null,t.panels.vectorField.invertSymbols,(0,s.h)("calcite-button",{class:"invert-symbol-margin","icon-start":"information",scale:"s",appearance:"transparent",kind:"neutral",onClick:()=>{this.popoverOpen?(this.removePopover(),this.buttonNode.setFocus()):this.togglePopover()},ref:e=>this.buttonNode=e}))),(0,s.h)("calcite-switch",{class:"invert-symbol-switch",scale:"s",label:t.panels.vectorField.invertSymbols,checked:a,onCalciteSwitchChange:e=>this.handleInvertSymbolsChange(e.currentTarget.checked?"flow-to":"flow-from")}))}renderMagnitudeRange(){const{smartMappingState:e}=this,{strings:t}=e,a=(0,h.m)(e),i=(0,h.b)(a,"size"),{minDataValue:n,maxDataValue:r}=i,l=(0,h.S)(n)?Math.round(10*n)/10:void 0,o=(0,h.S)(r)?Math.round(10*r)/10:void 0;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,t.panels.vectorField.magnitudeRange),(0,s.h)("calcite-label",null,t.panels.vectorField.min,(0,s.h)("calcite-input-number",{label:t.panels.vectorField.min,scale:"s",inputMode:"decimal",min:l,max:o,value:`${l??""}`,numberButtonType:"none",onCalciteInputNumberInput:()=>{const e=Number.parseFloat(this.minRangeNode.value),t=Number.isNaN(Number.parseFloat(this.minRangeNode.value))?Number.NEGATIVE_INFINITY:Number.parseFloat(this.minRangeNode.value),a=Number.isNaN(Number.parseFloat(this.maxRangeNode.value))?Number.POSITIVE_INFINITY:Number.parseFloat(this.maxRangeNode.value);!Number.isNaN(e)&&e>=t&&e<=a?(this.minRangeNode.value=`${e}`,this.handleMagnitudeRangeValuesChange(e,Number.parseFloat(this.maxRangeNode.value))):(this.minRangeNode.value="",this.handleMagnitudeRangeValuesChange(void 0,Number.parseFloat(this.maxRangeNode.value)))},ref:e=>this.minRangeNode=e})),(0,s.h)("calcite-label",null,t.panels.vectorField.max,(0,s.h)("calcite-input-number",{label:t.panels.vectorField.max,scale:"s",inputMode:"decimal",min:l,max:o,value:`${o??""}`,numberButtonType:"none",onCalciteInputNumberInput:()=>{const e=Number.parseFloat(this.maxRangeNode.value),t=Number.isNaN(Number.parseFloat(this.minRangeNode.value))?Number.NEGATIVE_INFINITY:Number.parseFloat(this.minRangeNode.value),a=Number.isNaN(Number.parseFloat(this.maxRangeNode.value))?Number.POSITIVE_INFINITY:Number.parseFloat(this.maxRangeNode.value);!Number.isNaN(e)&&e>=t&&e<=a?(this.maxRangeNode.value=`${e}`,this.handleMagnitudeRangeValuesChange(Number.parseFloat(this.minRangeNode.value),e)):(this.maxRangeNode.value="",this.handleMagnitudeRangeValuesChange(Number.parseFloat(this.minRangeNode.value),void 0))},ref:e=>this.maxRangeNode=e})))}renderUnitSelectors(){const{strings:e}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",null,e.panels.vectorField.convertMagnitude),(0,s.h)("calcite-label",null,e.panels.vectorField.inputUnits,this.renderUnitSelector("input")),(0,s.h)("calcite-label",null,e.panels.vectorField.outputUnits,this.renderUnitSelector("output")))}renderUnitSelector(e){const{smartMappingState:t}=this,{strings:a}=t,i=(0,h.m)(t),n="output"===e&&["wind-barb","ocean-current-kn","ocean-current-m"].includes(i.style);return(0,s.h)("calcite-combobox",{disabled:n,key:"input"===e?i.inputUnit:i.outputUnit,label:"input"===e?a.panels.vectorField.inputUnits:a.panels.vectorField.outputUnits,clearDisabled:!0,scale:"s",selectionMode:"single",ref:t=>{t&&("output"===e?this.outputUnitNode=t:this.inputUnitNode=t)},onCalciteComboboxChange:()=>{"input"===e?(""===this.inputUnitNode.value?this.inputUnitNode.value=this.currentInput:this.currentInput=this.inputUnitNode.value,this.handleUnitSelectClick("input")):(""===this.outputUnitNode.value?this.outputUnitNode.value=this.currentOutput:this.currentOutput=this.outputUnitNode.value,this.handleUnitSelectClick("output"))}},this.speedUnitOptions.map((t=>this.renderUnitOption(e,t))))}renderUnitOption(e,t){const{smartMappingState:a}=this,i=(0,h.m)(a),n=this.speedUnitOptions.find((t=>"input"===e?t.key===i.inputUnit:t.key===i.outputUnit));return(0,s.h)("calcite-combobox-item",{value:t.key,textLabel:t.title,selected:!!n&&t===n})}renderFooterButtons(){return(0,s.h)("div",{class:"footer-buttons",slot:"footer"},this.renderDoneButton(),this.renderRegisterStyleButton(),this.renderCancelButton())}renderRegisterStyleButton(){return(0,s.h)("arcgis-smart-mapping-raster-preset-renderer-button",{mode:"register",onArcgisDone:e=>{const{smartMappingState:t}=this,{modules:a}=t;if((0,s.f)(this.el),"register"===e.detail){const e=(0,h.m)(t);this.originalRendererObj=a.esriLang.clone(e)}this.manageStyleButtonNode&&(0,s.f)(this.manageStyleButtonNode),(0,s.f)(this.registerStyleButtonNode)},ref:e=>this.registerStyleButtonNode=e})}renderDoneButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.done,onClick:this.handleDone,appearance:"solid",width:"full"},e.done)}renderCancelButton(){const{strings:e}=this.smartMappingState;return(0,s.h)("calcite-button",{label:e.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.cancel)}getExactBeaufortUnit(e){switch(e=e??"meter-per-second"){case"knots":return"beaufort-kn";case"meter-per-second":default:return"beaufort-m";case"mile-per-hour":return"beaufort-mi";case"kilometer-per-hour":return"beaufort-km";case"feet-per-second":return"beaufort-ft"}}resetOutputUnit(e,t){let a;switch(e){case"ocean-current-kn":case"wind-barb":a="knots";break;case"ocean-current-m":a="meter-per-second"}a&&(t.outputUnit=a)}handleSymbolScaleChange(e,t){const{smartMappingState:a}=this,s=(0,h.m)(a),i=(0,h.b)(s,"size");i.minSize=e,i.maxSize=t,(0,h.u)(a)}handleInvertSymbolsChange(e){const{smartMappingState:t}=this;(0,h.m)(t).flowRepresentation=e,(0,h.u)(t)}handleUnitSelectClick(e){const{smartMappingState:t}=this,a=(0,h.m)(t);"input"===e?a.inputUnit=this.inputUnitNode.value:(a.outputUnit=this.outputUnitNode.value,a.style.includes("beaufort")&&(a.style=this.getExactBeaufortUnit(a.outputUnit))),(0,h.u)(t)}handleMagnitudeRangeValuesChange(e,t){const{smartMappingState:a}=this;if("number"==typeof e&&Number.isNaN(e)&&(e=""),"number"==typeof t&&Number.isNaN(t)&&(t=""),e===this.minRangeNode.max&&t===this.maxRangeNode.min)return;const s=(0,h.m)(a),i=(0,h.b)(s,"size");""!==e&&(0,h.S)(e)?(e=Math.round(1e3*e)/1e3,i.minDataValue=e,this.minRangeNode.value=`${e}`,this.maxRangeNode.min=e+this.maxRangeNode.step):(i.minDataValue=void 0,this.minRangeNode.value=""),""!==t&&(0,h.S)(t)?(t=Math.round(1e3*t)/1e3,i.maxDataValue=t,this.maxRangeNode.value=`${t}`,this.minRangeNode.max=t-this.minRangeNode.step):(i.maxDataValue=void 0,this.maxRangeNode.value=""),(0,h.u)(a)}togglePopover(){const{flowItemNode:e,smartMappingState:t}=this,{strings:a}=t;this.popoverNode=document.createElement("arcgis-smart-mapping-info-popover"),this.popoverNode.smartMappingState=t,this.popoverNode.props={title:a.panels.vectorField.invertSymbols,flowItemNode:e,moreInfo:a.panels.vectorField.invertSymbolsTip},this.popoverNode.referenceElement=this.buttonNode,this.popoverNode.addEventListener("arcgisSmartMappingInfoPopoverClose",(e=>{e.stopPropagation(),this.removePopover(),this.buttonNode.setFocus()})),document.body.appendChild(this.popoverNode),this.popoverNode.setOpen(!0),this.popoverOpen=!0,setTimeout((()=>{this.documentClickHandler=e=>{(0,y.p)(e.target)||this.removePopover()},document.addEventListener("click",this.documentClickHandler)}))}removePopover(){document.body.querySelectorAll(".arcgis-smart-mapping-popover").forEach((e=>document.body.removeChild(e))),this.popoverNode=void 0,this.popoverOpen=!1,this.documentClickHandler&&(document.removeEventListener("click",this.documentClickHandler),this.documentClickHandler=void 0)}getSpeedUnitOptions(){const{strings:e}=this.smartMappingState,t=e.panels.vectorField.unitOptions;return[{key:"meter-per-second",title:t.esriMetersPerSecond,selected:!1},{key:"kilometer-per-hour",title:t.esriKilometersPerHour,selected:!1},{key:"knots",title:t.esriKnots,selected:!1},{key:"feet-per-second",title:t.esriFeetPerSecond,selected:!1},{key:"mile-per-hour",title:t.esriMilesPerHour,selected:!1}]}get el(){return(0,s.a)(this)}};Me.style=":host {\n  width: 100%;\n  display: none;\n}\n:host([selected]) {\n  display: flex;\n}\n\n.flow-item {\n  height: 100%;\n}\n\n.vector-field-block {\n  overflow-x: hidden;\n}\n\n.invert-symbol-wrapper {\n  display: flex;\n  justify-content: space-between;\n}\n\n.invert-symbol-margin {\n  margin-right: inherit;\n  margin-left: 0.35rem;\n}\n\n:dir(rtl) {\n  .invert-symbol-margin {\n    margin-left: inherit;\n    margin-right: 0.35rem;\n  }\n}\n\n.invert-symbol-switch {\n  padding-top: 6px;\n}\n\n.footer-buttons {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: var(--calcite-spacing-sm);\n}\n"},19325:(e,t,a)=>{a.d(t,{a:()=>n,b:()=>i,s:()=>r});a(56612);var s=a(76744);const i={true:"https://ndh-inf-ml-p01.esri.com/dev/mapping",vpn:"https://ndh-inf-ml-p01.esri.com/dev/mapping",aws:"https://devsummitdemowin.webgistesting.net/dev/mapping"};async function n(e,t){const{text:a}=t,{layer:i,modules:n}=e;if(!(0,s.l)(i))throw new Error("layer is not a FeatureLayer");const r={token:"",map_data:{data:i.fields.map((e=>({fieldName:e.name,alias:e.alias,dataType:e.type})))},messages:a,entry_point:"style"},o={method:"post",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}};console.log("request body: ",r);try{const{data:t}=await n.esriRequest(l(e),o);if(t.status_code&&200!==t.status_code)return console.log("*** question/response: ",JSON.stringify({question:a,response:t})),{message:t.botMessage,status:"error",type:"response"};const s=t[0],i=s.botMessage;return{message:i,status:"map_style"===s.actionType?"valid":"invalid",dataObject:s,type:"response"}}catch(e){return{message:e.message,status:"error",type:"response"}}}async function r(e,t){const{text:a}=t,{layer:i,modules:n}=e;if(!(0,s.l)(i))throw new Error("layer is not a FeatureLayer");const r=i.fields.map((e=>({fieldName:e.name,alias:e.alias,dataType:e.type}))),o={method:"post",body:JSON.stringify({token:"",map_data:{data:r},messages:a,entry_point:"style"}),headers:{"Content-Type":"application/json"}};console.log(JSON.stringify(o));try{await n.esriRequest(l(e),o)}catch(e){throw new Error("submit feedback failed")}}function l(e){const{modules:t}=e,a=t.urlUtils.urlToObject(document.URL),s=a.query||{};return a.query?.assistUrl||i[s.assist]}},84260:(e,t,a)=>{a.d(t,{u:()=>r});var s=a(11254),i=a(10465),n=a(14528);function r({propertyName:e="strings",name:t}){let a=(0,n.r)();const r=(0,i.g)(a.el),o=new i.D,c={_lang:r.lang,_t9nLocale:r.t9nLocale};a.manager.onLoad((()=>o.promise));const d=new WeakRef(a);function p(){const e=d.deref();return e||m?.(),e}a=void 0;const h=l((()=>p()?.el)),m=(0,i.s)(h,(()=>(0,s.g)("./assets")),(({t9nLocale:t,t9nStrings:a,lang:s})=>{const i=p();if(!i)return;i[e]={...a,_lang:s,_t9nLocale:t},o.resolve()}),t);return c}const l=e=>new Proxy({},{get(t,a){const s=e();if(!s)return;const i=Reflect.get(s,a,s);return"function"==typeof i?i.bind(s):i}})},93345:(e,t,a)=>{a.d(t,{c:()=>o});var s=a(11254);const i=e=>!("isConnected"in e)||e.isConnected,n=((e,t)=>{let a;return(...s)=>{a&&clearTimeout(a),a=setTimeout((()=>{a=0,e(...s)}),t)}})((e=>{for(let t of e.keys())e.set(t,e.get(t).filter(i))}),2e3),r=e=>"function"==typeof e?e():e,l=(e,t)=>{const a=e.indexOf(t);a>=0&&(e[a]=e[e.length-1],e.length--)},o=(e,t)=>{const a=((e,t=(e,t)=>e!==t)=>{const a=r(e);let s=new Map(Object.entries(a??{}));const i={dispose:[],get:[],set:[],reset:[]},n=()=>{s=new Map(Object.entries(r(e)??{})),i.reset.forEach((e=>e()))},o=e=>(i.get.forEach((t=>t(e))),s.get(e)),c=(e,a)=>{const n=s.get(e);t(a,n,e)&&(s.set(e,a),i.set.forEach((t=>t(e,a,n))))},d="undefined"==typeof Proxy?{}:new Proxy(a,{get:(e,t)=>o(t),ownKeys:e=>Array.from(s.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>s.has(t),set:(e,t,a)=>(c(t,a),!0)}),p=(e,t)=>(i[e].push(t),()=>{l(i[e],t)});return{state:d,get:o,set:c,on:p,onChange:(t,a)=>{const s=p("set",((e,s)=>{e===t&&a(s)})),i=p("reset",(()=>a(r(e)[t])));return()=>{s(),i()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(p("set",t.set)),t.get&&e.push(p("get",t.get)),t.reset&&e.push(p("reset",t.reset)),t.dispose&&e.push(p("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{i.dispose.forEach((e=>e())),n()},reset:n,forceUpdate:e=>{const t=s.get(e);i.set.forEach((a=>a(e,t,t)))}}})(e,t);return a.use((()=>{if("function"!=typeof s.d)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const a=(0,s.d)();a&&((e,t,a)=>{const s=e.get(t);s?s.includes(a)||s.push(a):e.set(t,[a])})(e,t,a)},set:t=>{const a=e.get(t);a&&e.set(t,a.filter(s.f)),n(e)},reset:()=>{e.forEach((e=>e.forEach(s.f))),n(e)}}})()),a}}}]);