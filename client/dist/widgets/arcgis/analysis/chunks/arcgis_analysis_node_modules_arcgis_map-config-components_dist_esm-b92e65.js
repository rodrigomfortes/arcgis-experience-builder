/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-b92e65.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm-b92e65"],{12512:(e,t,i)=>{i.r(t),i.d(t,{arcgis_smart_mapping_action:()=>p,arcgis_smart_mapping_attribute_input:()=>u,arcgis_smart_mapping_symbol_button:()=>m});var s=i(11254),n=(i(56612),i(76744)),r=i(14528),o=i(39020),l=i(14143),a=i(35365),d=i(17840),c=i(68474),h=i(89731);i(10465),i(69811);const p=class{constructor(e){(0,s.r)(this,e),this.manager=(0,r.u)(this),this.hideOutline=!1,this.text=void 0,this.icon=void 0,this.disabled=!1}async setFocus(){await(this.calciteActionNode?.setFocus())}disconnectedCallback(){(0,n.a9)()}render(){return(0,s.h)("calcite-action",{key:"a825eacd141a1d91dcbb4a38498b1911035c243f",class:this.hideOutline?"":"smart-mapping-action-outline",scale:"s",text:this.text,icon:this.icon,disabled:this.disabled,ref:e=>this.calciteActionNode=e,onMouseOver:()=>(0,n.ab)(this.calciteActionNode,this.text),onMouseOut:()=>(0,n.a9)(),onFocus:()=>(0,n.ab)(this.calciteActionNode,this.text),onFocusout:()=>(0,n.a9)()})}get el(){return(0,s.a)(this)}};p.style=".smart-mapping-action-outline{border:#eaeaea 1px solid}";const u=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingAttributeInputChange=(0,s.c)(this,"arcgisSmartMappingAttributeInputChange",7),this.arcgisSmartMappingAttributeInputError=(0,s.c)(this,"arcgisSmartMappingAttributeInputError",7),this.manager=(0,r.u)(this),this.smartMappingState=(0,a.u)(),this.fieldList=void 0,this.selectedField=void 0,this.label=void 0,this.mode="simple",this.popoverReferenceElement=void 0,this.hideLabel=!1}async clear(){this.currentField=void 0,(0,s.f)(this.el)}componentWillLoad(){this.currentField=this.selectedField,this.popoverReferenceElement||(this.popoverReferenceElement=(0,o.f)(this.el,"calcite-flow-item"))}componentWillUpdate(){this.currentField!==this.selectedField&&(this.currentField=this.selectedField)}render(){const{strings:e}=this.smartMappingState;return this.hideLabel?(0,s.h)("div",{class:"field-select-with-icon"},this.renderFieldButton(),"remove"===this.mode&&this.currentField&&this.renderRemoveButton(),"expression"===this.mode&&this.renderArcadeButton()):(0,s.h)("calcite-label",null,this.label||e.attributeInput.attribute,(0,s.h)("div",{class:"field-select-with-icon"},this.renderFieldButton(),"remove"===this.mode&&this.currentField&&this.renderRemoveButton(),"expression"===this.mode&&this.renderArcadeButton()))}renderArcadeButton(){const{strings:e}=this.smartMappingState,t=this.currentField?.field?e.attributeInput.useExpression:e.attributeInput.useField;return(0,s.h)(s.F,null,(0,s.h)("div",null,"\xa0"),(0,s.h)("calcite-button",{id:"smart-mapping-attribute-switch",appearance:"outline-fill",kind:"neutral",iconStart:this.currentField?.field?"code":"brackets-curly",label:t,class:"field-button",onClick:()=>{this.handleSwitchAttributeType()},ref:e=>this.switchButtonNode=e}),(0,s.h)("calcite-tooltip",{referenceElement:"smart-mapping-attribute-switch",overlayPositioning:"fixed"},t))}renderFieldButton(){const{smartMappingState:e}=this,{strings:t}=e,i="remove"!==this.mode&&"expression"!==this.mode||!this.currentField?"":"non-simple-field-button",r=!(!this.currentField?.field||1!==this.fieldList.length||"remove"===this.mode);return(0,s.h)("calcite-button",{alignment:"icon-end-space-between",appearance:"outline-fill",kind:"neutral",disabled:r,iconEnd:this.currentField?.expression?"pencil":r?void 0:"chevron-down",width:"full",class:`field-button ${i}`,onClick:()=>{this.currentField?.expression?(this.openArcadeEditorModal(this.currentField),this.fieldButtonNode?.setFocus()):this.openFieldPickList()},ref:e=>{e&&(this.fieldButtonNode=e)}},this.currentField?.field?(0,n.y)(e,this.currentField.field)?.label:this.currentField?.expression?this.currentField?.expressionTitle:t.attributeInput.chooseField)}renderRemoveButton(){const{strings:e}=this.smartMappingState;return(0,s.h)(s.F,null,(0,s.h)("div",null,"\xa0"),(0,s.h)("calcite-button",{id:"smart-mapping-attribute-switch",appearance:"outline-fill",kind:"neutral",iconStart:"x",label:e.clear,class:"field-button",onClick:()=>{this.handleRemoveField()}}),(0,s.h)("calcite-tooltip",{referenceElement:"smart-mapping-attribute-switch",overlayPositioning:"fixed"},e.clear))}async handleRemoveField(){this.currentField=null,this.arcgisSmartMappingAttributeInputChange.emit()}async handleSwitchAttributeType(){if((0,n.J)(),this.currentField?.field)if(this.lastSettings?.expression){const e={expression:this.lastSettings.expression,expressionTitle:this.lastSettings.expressionTitle,simpleFieldType:this.lastSettings.simpleFieldType};this.currentField.field=void 0,this.currentField=e,this.arcgisSmartMappingAttributeInputChange.emit(this.currentField)}else try{await this.openArcadeEditorModal(),this.fieldButtonNode?.setFocus()}catch(e){this.switchButtonNode?.setFocus()}else this.openFieldPickList()}async openArcadeEditorModal(e){const{smartMappingState:t}=this,{strings:i}=t;(0,n.J)();try{if((e=await(0,l.u)(t,e)).simpleFieldType===n.w.STRING)return void this.arcgisSmartMappingAttributeInputError.emit({message:i.attributeInput.errors.expressionMustBeNumber,type:"warning"});e.simpleFieldType===n.w.UNKNOWN&&(e.simpleFieldType=n.w.NUMBER),this.currentField&&(this.currentField.field=void 0,this.currentField.expression=e.expression,this.currentField.expressionTitle=e.expressionTitle,this.currentField.simpleFieldType=e.simpleFieldType),this.arcgisSmartMappingAttributeInputChange.emit(this.currentField)}catch(e){throw new Error("")}}openFieldPickList(){const{smartMappingState:e}=this,{layer:t,mapView:i,strings:s}=e;(0,n.J)();const r=document.createElement("arcgis-field-pick-list");r.classList.add("arcgis-smart-mapping-attribute-input-field-pick-list"),r.fields=this.fieldList.map((e=>({name:e.layerField.name,alias:e.label,type:e.simpleFieldType,description:"description"in e.layerField?e.layerField.description:void 0}))),this.currentField?(r.heading=s.replaceField,r.selectedFields=[this.currentField.field]):r.heading=s.addField,r.popoverProps={refElement:this.popoverReferenceElement,placement:"leading",popoverWidth:1.05*this.popoverReferenceElement.getBoundingClientRect().width,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!0},r.layer=t,r.mapView=i,r.showFieldInfo=!0,r.sortBy=this.lastFieldSortBy||"default",(0,n.P)(this.popoverReferenceElement,!0),document.body.appendChild(r),r.addEventListener("arcgisSortByChange",(e=>{this.lastFieldSortBy=e.detail})),r.addEventListener("arcgisClose",(t=>{if(t.detail?.selectedFields?.[0]){const i=(0,n.y)(e,t.detail.selectedFields[0]),s={field:i.layerField.name,simpleFieldType:i.simpleFieldType};this.currentField?.expression&&(this.lastSettings={expression:this.currentField.expression,expressionTitle:this.currentField.expressionTitle,simpleFieldType:this.currentField.simpleFieldType}),this.currentField=s,this.arcgisSmartMappingAttributeInputChange.emit(this.currentField)}this.fieldButtonNode?.setFocus(),document.body.removeChild(r),(0,n.P)(this.popoverReferenceElement,!1)}))}get el(){return(0,s.a)(this)}};u.style=".field-select-with-icon{display:flex;width:100%;justify-content:space-between;align-items:stretch;min-width:0}.field-button:focus{z-index:10}.non-simple-field-button{width:calc(100% - 32px)}";const m=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingSymbolButtonSymbolChange=(0,s.c)(this,"arcgisSmartMappingSymbolButtonSymbolChange",7),this.manager=(0,r.u)(this),this.resizeObserver=new ResizeObserver((e=>{const t=e.pop();this.symbolNodeWidth=t?.contentRect.width})),this.smartMappingState=(0,a.u)(),this.afterCreateSymbolDiv=(e,t)=>{if(!t)return;const{isReferenceSize:i,smartMappingState:s}=this,{modules:n}=s,{colors:r,symbol:o}=e,l=this.buttonNode,a=l?l.getBoundingClientRect().width:0;if(l&&!a)return;const d=e=>{for(;e?.childNodes?.length;)e.removeChild(e.childNodes[0])};if(r){const e=n.symbolUtils.renderColorRampPreviewHTML(r,{align:"horizontal",width:a?a-40:150,height:16});d(t),t.appendChild(e)}else if(o){const e=a?Math.round((0,h.p)(a-40)):110,s="simple-line"===o.type||"cim"===o.type&&"CIMLineSymbol"===o.data.symbol.type,r="simple-fill"===o.type||"cim"===o.type&&"CIMPolygonSymbol"===o.data.symbol.type,l="cim"===o.type&&!s&&!r,c=s?{width:e,height:"simple-line"===o.type?3:6}:r?{width:i?18:e,height:i?18:12}:l?16:14;n.symbolUtils.renderPreviewHTML(o,{size:c,symbolConfig:r?{isSquareFill:!0}:void 0}).then((e=>{d(t),t.style.height=r?i?"24px":"16px":l?"21px":"auto",t.appendChild(e)}))}},this.handleClick=async()=>{const{internalPopoverReferenceElement:e,label:t,popoverNode:i,buttonNode:s,smartMappingState:r}=this,{strings:o}=this.smartMappingState;if(i)this.onPopoverClose();else{(0,n.J)(),this.selected=!0;document.createElement("div").className="symbol-styler-div",this.popoverNode=(0,c.b)(r,{referenceElement:"string"==typeof e?document.getElementById(e)||void 0:e,heading:t||o.styler.symbolStyle}),this.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{this.onPopoverClose(),setTimeout((()=>s?.focus()),300)})),this.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{this.onPopoverClose()}));const i=this.getOnClickCall();this.symbolStylerWatchScaleHandle=await i(r,{popoverNode:this.popoverNode,onChange:()=>{(0,n.i)(r)?(0,n.u)(r):(0,n.t)(r),this.arcgisSmartMappingSymbolButtonSymbolChange.emit()}})}},this.type=void 0,this.rampType=void 0,this.label=void 0,this.hideLabel=!1,this.symbol=void 0,this.colors=void 0,this.width=void 0,this.isReferenceSize=!1,this.popoverReferenceElement=void 0,this.selected=!1,this.symbolNodeWidth=void 0}async setFocus(){this.buttonNode?.focus()}disconnectedCallback(){this.onPopoverClose(),this.resizeObserver.unobserve(this.buttonNode)}componentDidLoad(){if(this.internalPopoverReferenceElement=this.popoverReferenceElement,!this.internalPopoverReferenceElement){const e=(0,d.q)(this.el,"calcite-panel"),t=(0,d.q)(this.el,"calcite-flow-item");this.internalPopoverReferenceElement=t||e}(0,s.f)(this.el),this.resizeObserver.observe(this.buttonNode)}render(){const{label:e,width:t,hideLabel:i,smartMappingState:n}=this,{strings:r}=n;return(0,s.h)(s.H,{key:"06381dcd1d1be8cd0dda9eee37bc38f596269c32"},(0,s.h)("div",{key:"c3be85ee7e85eb2f0c3a54d5bfbbdb5a3563772b",class:"block-content-padding "+("half"===t?"half":"")},!i&&(0,s.h)("calcite-label",{key:"134ee54577651046526c1f70d5e45aff1eb0ac5e",id:"symbol-button-label"},e||r.styler.symbolStyle,this.renderSymbolButton()),i&&this.renderSymbolButton()))}renderSymbolButton(){const{rampType:e,symbol:t,colors:i,selected:r,smartMappingState:o}=this,{modules:l}=o;"raster-class-breaks"===((0,n.i)(o)?(0,n.n)(o):(0,n.k)(o))&&i?.forEach(((e,t)=>{0===e.r&&0===e.g&&0===e.b&&0===e.a&&(i[t]=new l.EsriColor([255,255,255,0]))}));const a="discrete"===e&&i?.length?i.map(((e,t)=>(0,s.h)("div",{key:`symbol-button-icon-${t}`,class:"classed-color-icon-section",style:{width:95/("type-ramp"===this.type?i.length:Math.min(10,i.length))+"%",backgroundColor:e?.toHex()??"#ffffff"}}))):null,d=!e&&(0,n.aM)(o,t),c=(0,n.I)(o)||"point",h={"symbol-selector":!0,"symbol-is-white":(0,n.T)(o,t),selected:r};return(0,s.h)("div",{class:h,onClick:this.handleClick,role:"button",tabIndex:0,"aria-labelledby":"symbol-button-label","aria-haspopup":"true","aria-expanded":!!r,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),this.handleClick())},ref:e=>this.buttonNode=e},d?this.renderTransparentSymbol(t):"discrete"===e?(0,s.h)("div",{class:"classed-color-icon","aria-hidden":"true"},a):(0,s.h)("div",{key:`${t||i}`,class:`symbol-icon ${c}`,style:this.symbolNodeWidth?{width:.95*this.symbolNodeWidth+"px"}:void 0,ref:e=>{this.afterCreateSymbolDiv({colors:i,symbol:t},e)},"aria-hidden":"true"}),(0,s.h)("div",{class:"symbol-edit-button"},(0,s.h)("calcite-icon",{scale:"s",icon:"pencil"})))}renderTransparentSymbol(e){return(0,s.h)("div",{key:e,class:"symbol-icon transparent","aria-hidden":"true",style:this.symbolNodeWidth?{width:.95*this.symbolNodeWidth+"px"}:void 0},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg"},(0,s.h)("defs",null,(0,s.h)("pattern",{id:"16cf9653474-widget-3-bg-fill",patternUnits:"userSpaceOnUse",x:"0",y:"0",width:"15",height:"15"},(0,s.h)("image",{x:"0",y:"0",width:"15",height:"15",href:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgaGVpZ2h0PSIxNiIgd2lkdGg9IjE2Ij48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNjY2MiIC8+PHBhdGggZD0iTTAgMCBMOCAwIEw4IDggTDAgOCBaIiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDgpIiAvPjxwYXRoIGQ9Ik0wIDAgTDggMCBMOCA4IEwwIDggWiIgZmlsbD0iI2NjYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCw4KSIgLz48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgsMCkiIC8+PC9zdmc+"}))),(0,s.h)("rect",{x:"0",y:"0",fill:"url(#16cf9653474-widget-3-bg-fill)",height:"100%",width:"100%"}),(0,s.h)("rect",{x:"0",y:"0",fill:"url(#16cf9653474-widget-3-ramp-fill)",height:"100%",width:"100%"})))}getOnClickCall(){const{type:e}=this;switch(e){case"background":return c.B;case"simple":return c.A;case"size":return c.z;case"color-ramp":return c.y;case"relationship-ramp":return c.x;case"geo-rss-point":return c.w.bind(this,"point");case"geo-rss-line":return c.w.bind(this,"line");case"geo-rss-polygon":return c.w.bind(this,"polygon");case"dot-density-ramp":return c.v;case"dot-density-background":return c.u;case"dot-density-value":return c.e;case"heatmap-ramp":return c.t;case"predominance-ramp":return c.q;case"above":return c.p;case"below":return c.o;case"chart-ramp":return c.n;case"type-ramp":return c.m;case"raster-flow":return l.h;case"raster-stretch":return l.g;case"raster-shaded-relief":return l.f;case"raster-class-breaks":return l.e;case"raster-unique-value":return l.d;default:return c.l}}onPopoverClose(){this.symbolStylerWatchScaleHandle?.remove(),this.selected=!1,(0,c.r)(this.popoverNode),this.popoverNode=void 0}get el(){return(0,s.a)(this)}};m.style=".half {\n  width: 49%;\n}\n\n.symbol-selector {\n  display: flex;\n  padding: 6px;\n  justify-content: space-between;\n  align-items: center;\n  border-radius: 0;\n  cursor: pointer;\n\n  background-color: var(--calcite-color-foreground-1);\n  color: var(--calcite-color-text-1);\n  border-color: var(--calcite-color-foreground-3);\n  border-width: 1px;\n  border-style: solid;\n  box-shadow: transparent 0px 0px 0px 1px inset;\n\n  &:hover {\n    box-shadow: inset 0 0 0 1px var(--calcite-color-foreground-3);\n  }\n  &:active {\n    box-shadow: inset 0 0 0 2px var(--calcite-color-foreground-3);\n  }\n  &:focus {\n    box-shadow: inset 0 0 0 2px var(--calcite-color-foreground-3);\n    outline: 2px solid var(--calcite-color-brand);\n    outline-offset: 2px;\n  }\n  &.selected {\n    box-shadow: inset 0 0 0 2px var(--calcite-color-foreground-3);\n  }\n}\n\n.symbol-icon {\n  max-height: 30px;\n  overflow: hidden;\n}\n.symbol-icon.transparent {\n  height: 15px;\n  width: 100%;\n}\n.symbol-icon.transparent svg {\n  height: 15px;\n  width: 95%;\n  stroke: #e0e0e0;\n  stroke-width: 1px;\n}\n.symbol-is-white {\n  background-color: #f3f3f3;\n}\n.symbol-edit-button {\n  padding: 1px;\n  height: 18px;\n  width: 18px;\n  border: none;\n  cursor: pointer;\n  color: var(--calcite-ui-icon-color);\n\n  &:focus {\n    outline: none;\n  }\n}\n.classed-color-icon {\n  width: 100%;\n  height: 16px;\n  overflow: hidden;\n  border-radius: 0;\n}\n.classed-color-icon-section {\n  height: 16px;\n  display: inline-block;\n}\n"},89731:(e,t,i)=>{i.d(t,{a:()=>n,p:()=>r});const s=96;function n(e){return e?e/72*s:0}function r(e){return e?72*e/s:0}}}]);