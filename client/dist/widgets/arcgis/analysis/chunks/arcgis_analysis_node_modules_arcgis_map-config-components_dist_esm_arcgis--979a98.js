/*! For license information please see arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--979a98.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_map-config-components_dist_esm_arcgis--979a98"],{14528:(e,i,t)=>{function s(e){const i=[];l=e,queueMicrotask((()=>{l===e&&(l=void 0)}));const t=e.componentWillLoad;return e.componentWillLoad=async()=>{await Promise.all(i.map((e=>e()))).then((()=>{})),await(t?.call(e))},{onLoad:e=>i.push(e)}}let l;function a(){return l}t.d(i,{r:()=>a,u:()=>s})},38310:(e,i,t)=>{t.r(i),t.d(i,{arcgis_floor_configuration_add_layers:()=>r,arcgis_floor_configuration_add_layers_flow:()=>o,arcgis_floor_configuration_replace_field:()=>n,arcgis_floor_configuration_select_fields:()=>c});var s=t(11254),l=t(84792),a=t(14528);const r=class{constructor(e){(0,s.r)(this,e),this.arcgisListChange=(0,s.c)(this,"arcgisListChange",7),this.manager=(0,a.u)(this),this.layers=void 0,this.selection=new Map,this.strings=void 0,this.view=void 0}selectionChange(){this.arcgisListChange.emit(this.selection)}render(){return(0,s.h)("arcgis-floor-configuration-layer-list",{key:"4332d16cf4b1ed260c9eec866f091f95948dc0cb",layers:(0,l.c)(this.view),multiple:!0,strings:this.strings,onArcgisListChange:e=>this.selection=e.detail})}get el(){return(0,s.a)(this)}static get watchers(){return{selection:["selectionChange"]}}},o=class{constructor(e){(0,s.r)(this,e),this.arcgisDismiss=(0,s.c)(this,"arcgisDismiss",7),this.arcgisDone=(0,s.c)(this,"arcgisDone",7),this.manager=(0,a.u)(this),this.layersForFieldSelect=[],this.layers=void 0,this.mode="add-layer",this.selectedLayers=void 0,this.strings=void 0,this.view=void 0,this.fieldSelect=!1}render(){return(0,s.h)("calcite-flow",{key:"60718bc30d3f3d6e0e139b37a79eb701f380830a"},"add-layer"===this.mode&&this.renderAddLayersPanel(),"replace-field"===this.mode&&this.renderReplaceFieldsPanel())}renderAddLayersPanel(){return(0,s.h)(s.F,null,(0,s.h)("calcite-flow-item",{heading:this.strings.addLayers,closable:!0,closed:!1,selected:"add-layer"===this.mode&&!this.fieldSelect,onCalciteFlowItemClose:e=>this.dismiss(e)},(0,s.h)("arcgis-floor-configuration-add-layers",{class:"content",layers:this.layers,view:this.view,strings:this.strings,onArcgisListChange:e=>{this.nextButtonNode&&(this.nextButtonNode.disabled=!e.detail?.length),this.layersForFieldSelect=Array.from(e.currentTarget.selection.values())}}),(0,s.h)("calcite-button",{slot:"footer",label:this.strings.cancel,width:"half",appearance:"outline-fill",onClick:e=>this.dismiss(e)},this.strings.cancel),(0,s.h)("calcite-button",{slot:"footer",label:this.strings.next,width:"half",appearance:"solid",disabled:!0,onClick:()=>{this.fieldSelect=!0},ref:e=>{e&&(this.nextButtonNode=e)}},this.strings.next)),this.renderSelectFieldsPanel())}renderReplaceFieldsPanel(){const e=this.layers[0];return(0,s.h)("calcite-flow-item",{heading:e.title||void 0,description:this.strings.replaceFloorField,closable:!0,closed:!1,selected:"replace-field"===this.mode,onCalciteFlowItemClose:e=>this.dismiss(e)},(0,s.h)("arcgis-floor-configuration-replace-field",{class:"content",view:this.view,layer:e,strings:this.strings,ref:e=>{e&&(this.replaceFieldPanelNode=e)}}),(0,s.h)("calcite-button",{slot:"footer",appearance:"solid",label:this.strings.replace,width:"full",onClick:async e=>{await this.replaceFieldPanelNode.commit(),this.done(e)}},this.strings.replace))}renderSelectFieldsPanel(){return(0,s.h)("calcite-flow-item",{closable:!0,selected:this.fieldSelect,heading:this.strings.selectFloorField,onCalciteFlowItemBack:()=>this.fieldSelect=!1},(0,s.h)("arcgis-floor-configuration-select-fields",{class:"content",layers:this.layersForFieldSelect,view:this.view,strings:this.strings,ref:e=>{e&&(this.selectFieldsPanelNode=e)}}),(0,s.h)("calcite-button",{slot:"footer",label:this.strings.cancel,appearance:"outline-fill",width:"half",onClick:e=>this.dismiss(e)},this.strings.cancel),(0,s.h)("calcite-button",{slot:"footer",label:this.strings.add,width:"half",appearance:"solid",onClick:async e=>{await(this.selectFieldsPanelNode?.commit()),this.done(e)}},this.strings.add))}done(e){e.stopPropagation(),this.arcgisDone.emit()}dismiss(e){e.stopPropagation(),this.arcgisDismiss.emit()}get el(){return(0,s.a)(this)}};o.style=".content{width:20vw;max-width:420px;min-width:240px;max-height:40vh}";const n=class{constructor(e){(0,s.r)(this,e),this.manager=(0,a.u)(this),this.layer=void 0,this.strings=void 0,this.view=void 0}async commit(){(this.el.shadowRoot?Array.from(this.el.shadowRoot.querySelectorAll("arcgis-floor-configuration-field-list")):[]).map((e=>(0,l.d)(e)))}render(){const e=this.layer;if(!e.floorInfo)return(0,s.h)(s.F,null);const i=this.findField(e.floorInfo.floorField);if(!i)return(0,s.h)(s.F,null);const t=new Map;return t.set(i.name,i),(0,s.h)("arcgis-floor-configuration-field-list",{strings:this.strings,layer:e,selection:t})}findField(e){return this.layer.fieldsIndex.get(e)}get el(){return(0,s.a)(this)}},c=class{constructor(e){(0,s.r)(this,e),this.manager=(0,a.u)(this),this.layers=void 0,this.strings=void 0,this.view=void 0}async commit(){(this.el.shadowRoot?Array.from(this.el.shadowRoot.querySelectorAll("arcgis-floor-configuration-field-select")):[]).forEach((e=>(0,l.d)(e)))}render(){const{layers:e}=this;return(0,s.h)("div",{key:"ebb723359c3e11b3c948ea46ac651bb9c4bea3c3",class:"select-field-panel"},(0,s.h)("calcite-label",{key:"c0c7b01a893afccf46be56c39d60a03212a02b6e",class:"select-message"},this.strings.selectMessage),e.map((e=>this.renderSelect(e))))}renderSelect(e){return(0,s.h)("arcgis-floor-configuration-field-select",{layer:e})}get el(){return(0,s.a)(this)}};c.style=".select-field-panel{padding:12px;background-color:white}.select-message{margin:14px 0}"},84792:(e,i,t)=>{t.d(i,{a:()=>d,b:()=>f,c:()=>h,d:()=>y,g:()=>u,r:()=>n,s:()=>r,u:()=>o});const s={facilityLayer:{facilityIdField:"FACILITY_ID",siteIdField:"SITE_ID",nameField:"NAME"},levelLayer:{levelIdField:"LEVEL_ID",facilityIdField:"FACILITY_ID",longNameField:"NAME",shortNameField:"NAME_SHORT",levelNumberField:"LEVEL_NUMBER",verticalOrderField:"VERTICAL_ORDER"},siteLayer:{siteIdField:"SITE_ID",nameField:"NAME"}};let l;const a=e=>{const i=e?.map;return l=l||i?.floorInfo||{...s},l.siteLayer=l?.siteLayer?.layerId?l.siteLayer:null,l},r=e=>{const i=e?.map,t=a(e);i&&c(t)?i.set("floorInfo",t):n(e)},o=(e,i)=>{const t=a(i),{name:l}=e,o=e.layer;if(o){const e="sublayer"===o.type;t[l]={...s[l]},t[l]&&(t[l].layerId=e?o.layer?.id:o.id,t[l].sublayerId=e?o.id:void 0)}else t[l]=void 0;r(i)},n=e=>{const i=e?.map;i&&(i.floorInfo=null)},c=e=>!(!e?.facilityLayer?.layerId||!e?.levelLayer?.layerId||e?.siteLayer&&!e?.siteLayer.layerId),d=e=>{const i=s[e];return Object.values(i)},h=e=>{const{map:i}=e,t=i?.allLayers;let s=[];return t?.forEach((e=>{const{type:i,floorInfo:t}=e;"map-image"===i?s=s.concat(e.allSublayers.filter((e=>e.fieldsIndex&&!e?.floorInfo)).toArray()):!t&&["feature","oriented-imagery"].includes(i)&&s.push(e)})),s},f=async e=>{const{map:i}=e,t=i?.allLayers,s=t?.map((async e=>await g(e))).filter((e=>"failed"!==e?.loadStatus)),l=s?await Promise.all(s):[];let a=[];return l.forEach((e=>{const{type:i,geometryType:t}=e;"map-image"===i?a=a.concat(e.allSublayers.filter((e=>e.fieldsIndex&&"esriGeometryPolygon"===e.sourceJSON?.geometryType)).toArray()):"feature"===i&&"polygon"===t&&a.push(e)})),a},g=async e=>(void 0!==e.loadAll?await e.loadAll():await e.load(),e),u=(e,i)=>{const t=i.map,s=t?.allLayers,l=a(i),r=l?.[e]?.layerId,o=l?.[e]?.sublayerId;let n=r?s?.find((e=>e.id===r)):null;return"map-image"===n?.type&&(n=n.allSublayers.find((e=>e.id===o))),n},y=e=>{const{layer:i}=e;let t;if(t="arcgis-field-list"===e?.localName||"arcgis-floor-configuration-field-list"===e?.localName?e.selection.values().next().value:e?.field,t){const e=i.floorInfo||{};e.floorField=t.name,i.set("floorInfo",e)}}}}]);