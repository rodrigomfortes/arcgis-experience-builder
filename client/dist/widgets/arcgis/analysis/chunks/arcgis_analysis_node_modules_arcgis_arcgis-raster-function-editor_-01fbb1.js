"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-01fbb1"],{33797:(e,t,i)=>{i.d(t,{C:()=>a,U:()=>r,a:()=>s,u:()=>o});const r={Scale:"s",PopoverTimer:60},a={s:"s",m:"m",l:"l"},s={absolute:"absolute",fixed:"fixed"},o=e=>e===a.s?a.m:a.l},56750:(e,t,i)=>{i.r(t),i.d(t,{rfx_color_picker:()=>g,rfx_dte_number_input:()=>w,rfx_dte_raster_input:()=>R,rfx_dtex_field_select:()=>T,rfx_grid:()=>F});var r=i(83628),a=i(56451),s=i(5839),o=(i(5294),i(13661),i(18423),i(21255),i(35431),i(92991)),l=(i(588),i(55448),i(2924),i(11840),i(52373),i(33752),i(440),i(66744),i(44345),i(33797)),n=(i(23795),i(17902),i(71802),i(32513),i(36596),i(95069)),c=i(48001),d=i(93442),h=i(74579),u=i(42335),p=i(74670);i(24360),i(71144);const g=class{constructor(e){(0,r.r)(this,e),this.rfxColorPickerPopoverClose=(0,r.c)(this,"rfxColorPickerPopoverClose"),this.rfxColorPickerPopoverOpen=(0,r.c)(this,"rfxColorPickerPopoverOpen"),this.rfxColorPickerValueChange=(0,r.c)(this,"rfxColorPickerValueChange"),this.value=[0,0,0,255],this.onColorSwatchClick=e=>{const t=e.target.value;this.value=new a.default(t).toRgba(),this.rfxColorPickerValueChange.emit({value:this.value})}}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,s.c)(this.hostElement,(0,r.a)(".")))}render(){const e=new a.default(this.value).toHex();return(0,r.h)("div",{key:"7ca60606c83f415d1d2619e84ea5a514c8fae4cb"},(0,r.h)("calcite-color-picker-swatch",{key:"28f5107554341916fb570824825adf84c7ba91c5",active:!1,color:e,id:this.hostElement.id,scale:l.U.Scale,onClick:()=>{setTimeout((()=>requestAnimationFrame((()=>{this.popoverElement.open=!0,this.popoverElement?.setFocus()}))),1)},role:"button",ref:e=>{}}),(0,r.h)("calcite-popover",{key:"bc3bb76171e330a76c22ac9d2f55c21f2abe00ac",heading:this.strings.selectColor,autoClose:!1,pointerDisabled:!0,referenceElement:this.hostElement.id,placement:"auto",overlayPositioning:l.a.fixed,scale:l.U.Scale,label:"color-picker-popover",ref:e=>{this.popoverElement=e},onCalcitePopoverClose:e=>{this.rfxColorPickerPopoverClose.emit(e)},onCalcitePopoverOpen:e=>{this.rfxColorPickerPopoverOpen.emit(e)},closable:!0},(0,r.h)("calcite-color-picker",{key:"c64043f08dd3a9044d5b974bdd8eba5b6858961a",scale:l.U.Scale,value:e,format:"auto",onCalciteColorPickerChange:this.onColorSwatchClick}),(0,r.h)("calcite-button",{key:"6c21406563ad5f2c558295f28a41457db0785788",kind:"brand",appearance:"solid",width:"auto",class:"button-spacing",onClick:e=>{e.stopPropagation(),this.popoverElement.open=!1}},this.strings.done)))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.g)(this)}};g.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.button-spacing{padding:0.5rem}";const f="invalidIntegerMessage",m="invalidDoubleMessage",b="requiredInputMessage",v="belowMinimumMessage",y="aboveMaximumMessage",x="strictlyMinimumMessage",C="strictlyMaximumMessage",k={errorMessage:"rfx-dte-number-input__error-message"},w=class{constructor(e){(0,r.r)(this,e),this.rfxNumberInputChange=(0,r.c)(this,"rfxNumberInputChange"),this.rfxNumberInputValueChange=(0,r.c)(this,"rfxNumberInputValueChange"),this.numberButtonType="vertical",this.isDisabled=!1,this.inputChanged=e=>{if(null!==e.target){const t=(e?.target).value;if(this.value=(0,n.p)(t),""===t)return;this.validate(),void 0===this.errorMessage&&this.rfxNumberInputChange.emit()}},this.inputValueChanged=e=>{if(null!==e?.target){const t=e.target.value;this.value=(0,n.p)(t),void 0!==this.defaultValue&&void 0===this.value&&(this.value=this.defaultValue,this.rfxNumberInputChange.emit()),this.validate(),void 0===this.errorMessage&&this.rfxNumberInputValueChange.emit()}},this.validateNumber=(e,t)=>{const{required:i,isFloatType:r,excludeMinValue:a,excludeMaxValue:s,min:o,max:l}=t;let c;return(0,n.i)(e)?!1!==r||Number.isInteger(e)?void 0!==o&&void 0!==e&&(e<o||!0===a&&e<=o)?c=!0===a?x:v:void 0!==l&&void 0!==e&&(e>l||!0===s&&e>=l)&&(c=!0===s?C:y):c=f:null!=e?c=!0===r?m:f:!0===i&&(c=b),c}}onValueChange(){this.validate()}onRequiredChange(){this.validate()}onValidationChange(){this.errorMessage=void 0,!1===(0,o.i)(this.value)&&this.validate()}async checkValidity(){return this.validate(),Promise.resolve(void 0===this.errorMessage||""===this.errorMessage)}async componentWillLoad(){({strings:this.strings,locale:this.locale}=await(0,s.c)(this.hostElement,(0,r.a)("."))),this.value=this.value??this.initialValue}componentDidLoad(){this.validate()}get isFloatType(){return(0,o.i)(this.numberType)||"float"===this.numberType}get formatOptions(){return{min:`${this.getDependentFieldName("min")??this.min??Number.MIN_SAFE_INTEGER}`,max:`${this.getDependentFieldName("max")??this.max??Number.MAX_SAFE_INTEGER}`}}getDependentFieldName(e){if(void 0!==this.dependentFields)return"min"===e?this.dependentFields.greaterThan??this.dependentFields.greaterThanOrEqual:"max"===e?this.dependentFields.lessThan??this.dependentFields.lessThanOrEqual:void 0}validate(){const e=this.value,t=this.validateNumber(e,this.formatValidationOptions()),i=void 0!==t?(0,o.t)(this.strings[t],this.formatOptions):void 0;this.errorMessage=i}formatValidationOptions(){return{required:this.required,isFloatType:this.isFloatType,excludeMaxValue:this.excludeMaxValue,excludeMinValue:this.excludeMinValue,max:this.max??Number.MAX_SAFE_INTEGER,min:this.min??Number.MIN_SAFE_INTEGER}}render(){const e=void 0!==this.errorMessage;return(0,r.h)("host",{key:"78e2bd8354260ad7aa3131eacce12f242f375c44"},(0,r.h)("calcite-input",{key:"85d6a916500452a6a430920eab80db73ac4852f7",type:"number",value:(0,n.s)(this.value),step:this.isFloatType?"any":1,required:this.required||void 0,min:this.min,max:this.max,status:e?"invalid":"valid",scale:l.U.Scale,groupSeparator:!0,onCalciteInputInput:this.inputChanged,onCalciteInputChange:this.inputValueChanged,numberButtonType:this.numberButtonType,placeholder:this.placeholder??this.strings.placeholder,disabled:this.isDisabled,title:this.value?.toLocaleString(this.locale)}),(0,r.h)("calcite-input-message",{key:"2ae699cfa58e39429c6430c1c8d1ce2a79560845",class:k.errorMessage,status:e?"invalid":"valid",scale:l.U.Scale,hidden:!1===e,icon:"exclamationMarkTriangle"},this.errorMessage))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.g)(this)}static get watchers(){return{value:["onValueChange"],required:["onRequiredChange"],min:["onValidationChange"],max:["onValidationChange"],excludeMaxValue:["onValidationChange"],excludeMinValue:["onValidationChange"],numberType:["onValidationChange"]}}};w.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-number-input__error-message{margin-top:0.5rem}";const L="rfx-dte-raster-input",E={layerInput:`${L}__layer-input`,layerLoadFail:`${L}__layer-load-fail`,layerValidation:`${L}__layer-input-validation-msg`},R=class{constructor(e){(0,r.r)(this,e),this.rfxArgumentChange=(0,r.c)(this,"rfxArgumentChange"),this.calciteComboboxOpen=(0,r.c)(this,"calciteComboboxOpen"),this.calciteComboboxClose=(0,r.c)(this,"calciteComboboxClose"),this.scalarValues=[],this.showNoticeForNonAnalysisLayers=!1,this.loaded=!1,this.layerLoadFailed=!1,this.layerLoading=!1,this.allowScalar=!1,this.overlayPositioning=l.a.absolute,this.maxItems=5,this.applyStyleToCombobox=e=>{this.layerSelectorCombobox=e;(0,p.n)(e,["shadowRoot","children[0]","children[2]"],(e=>{const t=document.createElement("style");t.innerHTML="div { overflow: auto !important}",e.appendChild(t),e.style.setProperty("box-shadow","0 0 16px 0 rgba(0, 0, 0, 0.16)","important")})),this.changeLoadingIconColor()}}onInputLayersChange(e){const t=(0,d.q)(e);t.length!==e.length&&(this.showNoticeForNonAnalysisLayers=!0,this.inputLayers=t)}async onRFxVariableChange(e){if(e.value)this.value=e.value;else if(this.argRFT=(0,c.p)(e),e.type===u.J.RASTER_FUNCTION_TEMPLATE)try{const e=(0,c.m)(this.argRFT,["input","uxBlocks","overrideWidget","displayName","helpTextID"]),t=(0,d.r)((0,o.J)(this.portal??o.s.portal),e);await t.load(),this.rasterRenderingLayer=t}catch(e){console.error(e?.details?.messages)}}async connectedCallback(){return await this.load(),this.loaded=!0,Promise.resolve()}async componentWillLoad(){({strings:this.strings,locale:this.locale}=await(0,s.c)(this.hostElement,(0,r.a)("."))),void 0!==this.inputLayers&&this.onInputLayersChange(this.inputLayers)}async getSelectedLayer(){return!1===this.loaded&&await this.load(),void 0!==this.value&&"object"==typeof this.value?this._getSelectedLayer(this.value):this.rfxVariable.type===u.J.RASTER_FUNCTION_TEMPLATE?this.rasterRenderingLayer:Promise.resolve(void 0)}async updateBrowsedLayer(e){return e.forEach((e=>{0===this.inputLayers.filter((t=>e.url===t.url&&e.title===t.title)).length&&this.inputLayers.push(e),this.value=(0,d.f)(e),this.rfxArgumentChange.emit({value:this.value})})),Promise.resolve(void 0)}async checkValidity({required:e}){let t=!0;return this.layerLoadFailed&&(t=!1),e&&(0,o.i)(this.value)&&(0,o.i)(this.argRFT)&&(this.errorCode="required",t=!1),Promise.resolve(t)}async load(){(0,o.i)(this.rfxVariable)||await this.onRFxVariableChange(this.rfxVariable),(0,o.i)(this.value)||await this.processValueLayer()}async processValueLayer(){if(this.rfxVariable?.type===u.J.RASTER_FUNCTION_TEMPLATE)return;if("scalar"===this.value.type?.toLowerCase())return void this.scalarValues.push(this.value);const e=this.value?.url;if((0,o.i)(e))return void(this.layerLoadFailed=!0);const t=(0,d.h)(this.value,this.inputLayers);if((0,o.i)(t)){this.layerLoading=!0;const e=await(0,d.i)(this.value);if(this.layerLoading=!1,setTimeout((()=>this.changeLoadingIconColor()),100),void 0===e)return void(this.layerLoadFailed=!0);this.inputLayers=[...this.inputLayers,e]}const i=await this._getSelectedLayer(this.value);void 0!==i&&(this.value=(0,d.f)(i)),this.inputLayers=(0,o.w)(this.inputLayers,["title","url"])}async _handleComboBoxChange(e){this.layerLoadFailed=!1,this.errorCode=void 0;const t=e.target.value;if((0,o.i)(t))this.value=void 0;else{if("browse"===t)return this.value=void 0,void this.rfxBrowseLayerClick({referenceElement:this.hostElement});if(-1!==t.indexOf("&layerName")){const e=await this._getSelectedLayer(this.getLayerNameAndUrlFromValue(t));void 0!==e&&(this.value=(0,d.f)(e))}else 1==this.allowScalar&&(this.value={type:"Scalar",value:t})}this.rfxArgumentChange.emit({value:this.value})}getLayerNameAndUrlFromValue(e){const t=e.split("&layerName=")[0];return{name:e.split("&layerName=")[1],url:t}}async _getSelectedLayer(e){const t=(0,d.b)(e.url);let i;return void 0!==e.url&&void 0!==e.name&&(i=this.inputLayers.find((i=>i.url===t&&i.title===e.name))),i&&await i.load(),i}getFormattedValueFromVariable(){if(!(0,o.i)(this.argRFT)){const e=this.argRFT.function?.name;return`<${e}.${this.strings.outputRaster}>`}return this.mode===u.M.ANALYSIS?this.getDefaultPlaceHolder():`<${this.strings.rfxVariable}: ${this.rfxVariable.name}>`}getDefaultPlaceHolder(){return this.allowScalar?this.strings.allowScalar:this.strings.selectLayer}getPlaceHolderText(){return(0,o.i)(this.rfxVariable)?this.getDefaultPlaceHolder():this.getFormattedValueFromVariable()}getValueString(e){return`${e.url}&layerName=${e.title??e.name}`}changeLoadingIconColor(){(0,p.n)(this.layerSelectorCombobox,["shadowRoot","children[0]","children[0]","children[0]","children[0]"],(e=>{e.classList.contains("placeholder-icon")?e.style.color="var(--calcite-color-brand)":e.style.color="var(--calcite-text-color)"}))}renderInputOptions(e){let t=[];return this.inputLayers&&Array.isArray(this.inputLayers)&&(t=this.inputLayers.map(((t,i)=>{const a=this.getValueString(t);if(void 0!==t?.url)return(0,r.h)("calcite-combobox-item",{key:`layer-item-${i}`,value:a,selected:a===e,textLabel:t.title,icon:"imagery"===t.type?"image-layer":"tiled-imagery-layer"})}))),0!==this.scalarValues?.length&&this.scalarValues.forEach((e=>{t.push((0,r.h)("calcite-combobox-item",{key:`layer-item-${this.inputLayers.length+1}`,value:e.value,textLabel:e.value,selected:!0}))})),t}render(){const e=(0,d.b)(this.value?.url),t=(0,o.i)(this.value)?this.value:"Scalar"===this.value?.type?this.value.value:this.getValueString({url:e,name:this.value?.name}),i=this.portal?.isPortal,a=this.portal?.sourceJSON?.helpBase||c.a.learnMoreDocBaseURL,n=(0,s.f)(a,this.locale);let p;if(!0===i){const e=c.a.learnMoreDocSupportAnalysisLayerEnterpriseHelpID,{restUrl:t}=this.portal;p=`${n}${(0,h.a)(e)}`,p=(0,s.a)(p,t)}else{const e=c.a.learnMoreDocSupportAnalysisLayerHelpID;p=(0,h.f)(n,e)}return(0,r.h)("div",{key:"cf9c3dfaa326c6af17acc74fa135e840a56d6f12",class:`esriRFxRasterInput ${E.layerInput}`},(0,r.h)("calcite-combobox",{key:"a108fec1e73ba4037caf2bff4772e062089c450b",label:"rfx-dte-raster-input-combobox",placeholder:!0===this.layerLoading?"":this.getPlaceHolderText(),selectionMode:"single",scale:l.U.Scale,disabled:void 0!==this.argRFT,allowCustomValues:this.allowScalar,value:t,onCalciteComboboxChange:e=>this._handleComboBoxChange(e),overlayPositioning:this.overlayPositioning,clearDisabled:!0,placeholderIcon:!0===this.layerLoading?"spinner":"",ref:this.applyStyleToCombobox,maxItems:this.mode===u.M.EDITOR?this.maxItems:0},(0,r.h)(r.F,{key:"f6840c7ab292817cae7f5d55ca1682fd5fc96655"},(0,r.h)("calcite-notice",{key:"af66e07553d0d52a638f582ff9626df42ac2d9d3",class:"layer-notice",scale:"s",open:this.showNoticeForNonAnalysisLayers,kind:"warning"},(0,r.h)("div",{key:"8b99cf72ac99cab7796ccc6da2adea8b5d3c49a8",slot:"message"},this.strings.layerMissing," ",(0,r.h)("calcite-link",{key:"aa7b4d4961428d34d122c85ab90bae0ed373112f",slot:"link",title:"learn more",href:p,rel:"help",target:"_blank"},this.strings.learnMore))),(0,r.h)("calcite-combobox-item",{class:"browse-layer",key:"layer-item-browse",value:"browse",textLabel:this.strings.browseLayer,icon:"search",filterDisabled:!0}),...this.renderInputOptions(t))),(0,r.h)("calcite-input-message",{key:"cae0aea6c0c21faa88bc32d8ede303ee32d8cc6f",class:E.layerLoadFail,status:"invalid",scale:l.U.Scale,hidden:!1===this.layerLoadFailed,icon:"exclamationMarkTriangle"},this.strings.layerFailedToLoad),(0,r.h)("calcite-input-message",{key:"480c16e8f4bcc60e9e386abf57ca0732531f9bb6",class:E.layerValidation,status:"invalid",scale:l.U.Scale,hidden:!0===(0,o.i)(this.errorCode),icon:"exclamationMarkTriangle"},this.strings.errorCodes[this.errorCode]))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.g)(this)}static get watchers(){return{inputLayers:["onInputLayersChange"],rfxVariable:["onRFxVariableChange"]}}};R.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-raster-input__layer-input{text-align:start}.rfx-dte-raster-input__layer-load-fail{margin-top:0.5rem;color:var(--calcite-color-status-danger)}.rfx-dte-raster-input__layer-input-validation-msg{margin-top:0.5rem}.browse-layer{--calcite-color-text-1:var(--calcite-color-text-link);--calcite-color-text-3:var(--calcite-color-text-link)}.layer-notice{overflow:hidden;margin-bottom:0.5rem}";const T=class{constructor(e){(0,r.r)(this,e),this.rfxArgumentChange=(0,r.c)(this,"rfxArgumentChange"),this.rfxFieldOptionsLoaded=(0,r.c)(this,"rfxFieldOptionsLoaded"),this.isInGrid=!1,this.showDefaultFields=!0,this.handleFieldSelectChange=e=>{const t=e.target;this.value=t.value,this.rfxArgumentChange.emit({value:this.value})}}onrasterInputVariableChange(){this.processLayerArg()}async componentWillLoad(){({strings:this.strings}=await(0,s.c)(this.hostElement,(0,r.a)("."))),await this.processLayerArg(),this.processDefaultValue()}render(){return(0,r.h)("div",{key:"a389bb56060e0ee826865c666282a3b56d7414ba"},(0,r.h)("rfx-dtex-common-select",{key:"dbf3c702c83cf4011021369bc8cee8317af0a2bb",isInGrid:this.isInGrid,mode:this.mode,options:this.options,value:this.value,placeHolderText:this.strings.selectField,onRfxArgumentChange:this.handleFieldSelectChange}))}async getSelectedRasterLayer(e){e=(0,d.b)(e);const t=this.inputLayers.find((t=>t.url===e));return t&&await t.load(),t}async processLayerArg(){if((0,o.i)(this.rasterInputVariable))if((0,o.i)(this.layerArg))this.setDefaultFieldOptions();else{const e=this.layerArg.input;e?(await this.updateFields(),e.addEventListener("rfxArgumentChange",(async()=>{await this.updateFields()}))):this.setDefaultFieldOptions()}else await this.updateFields();this.rfxFieldOptionsLoaded.emit()}async updateFields(){let e;if((0,o.i)(this.rasterInputVariable?.value)){if(!(0,o.i)(this.layerArg)){const t=this.layerArg.input;e="function"==typeof t.getSelectedLayer?await t.getSelectedLayer():void 0}}else e=await this.getSelectedRasterLayer(this.rasterInputVariable?.value?.url);if(e){if((0,o.m)(e))this.options=this.convertFieldsToOptions(e.fields),this.otherOptions&&this.addOtherOptions();else if((0,o.p)(e)||(0,o.q)(e)){const t=await e.generateRasterInfo(e.rasterFunction);if(e.sourceJSON?.hasRasterAttributeTable){const i=(0,o.p)(e)?e.serviceRasterInfo.attributeTable:t.attributeTable;(0,o.i)(i?.fields)?this.setDefaultFieldOptions():this.setFieldOptions(i.fields)}else this.setDefaultFieldOptions()}}else this.setDefaultFieldOptions();this.processDefaultValue()}addOtherOptions(){const e=[],t=this.options,i=this.otherOptions;Object.keys(i).forEach((function(t){const r={key:t,label:i[t]};e.push(r)})),t&&t.length>0?(e.forEach((function(e){t.some((function(t){if(t.key===e.key)return!0}))||t.push(e)})),this.options=t):this.options=e}setFieldOptions(e){const t=["esriFieldTypeString"],i=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].concat(t),r=this.fieldType;if(e?.length>0){const a=(e=JSON.parse(JSON.stringify(e))).filter((e=>"list"===r?t.indexOf(e.type)>-1:i.indexOf(e.type)>-1));this.options=this.convertFieldsToOptions(a)}else this.setDefaultFieldOptions()}setDefaultFieldOptions(){!0===this.showDefaultFields&&(this.options=this.isInGrid?[{key:"VALUE",label:this.strings.value}]:[{key:"VALUE",label:this.strings.value},{key:"COUNT",label:this.strings.count}])}convertFieldsToOptions(e){const t=[];return e.map((e=>{t.push({key:e.name,label:e.alias})})),t}processDefaultValue(){(0,o.i)(this.options)||this.options?.length<1||(void 0!==this.value&&null!==this.value||(this.value=this.options[0].key),this.isInGrid||this.options.some((e=>e.key===this.value))||(this.value=this.options[0].key),(0,o.i)(this.rasterInputVariable)&&(0,o.i)(this.layerArg)||this.rfxArgumentChange.emit({value:this.value}))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.g)(this)}static get watchers(){return{rasterInputVariable:["onrasterInputVariableChange"]}}},_="rfx-grid__grid-container",O="border",I="stacked",F=class{constructor(e){(0,r.r)(this,e),this.rfxGridOptionChange=(0,r.c)(this,"rfxGridOptionChange"),this.rfxGridRowClick=(0,r.c)(this,"rfxGridRowClick"),this.calciteComboboxClose=(0,r.c)(this,"calciteComboboxClose"),this.gridChildElements=[],this.openDropdown=null,this.gridOptions=[],this.canAdd=!0,this.canRemove=!0,this.hasHeader=!0,this.isStacked=!1,this.hasIdColumn=!0,this.hasBorder=!1,this.isEditable=!0,this.gridValueChange=e=>{e.stopImmediatePropagation();const t=e.type,i=e.target;let r,a,s;switch(t){case"calciteCheckboxChange":case"calciteSwitchChange":r=i.checked;break;default:r=i.value}if(i?.tagName===u.A.RFX_DTE_RASTER_INPUT){const e=(0,d.a)();e.value=(0,d.c)(r),a=e,s=i?.inputLayers,(0,o.i)(s)||(this.inputLayers=s)}const[l,n]=i.id.split("-");let c;this.gridOptions=this.gridOptions.map(((e,t)=>{if(e.id===Number.parseInt(n,10)){if(i.id.indexOf(l)>-1){this.gridLayout[l].uiType===u.G.select?e[l].value=a??r:e[l]=a??r}c=t}return e})),this.canAdd&&this.addRow(),this.rfxGridOptionChange.emit({gridOptions:this.gridOptions,rowIndex:c,columnName:l})},this.onRemoveClick=e=>{const t=e.target.id.split("-")[1],i=this.gridOptions.findIndex((e=>e.id===Number.parseInt(t,10)));this.gridOptions=this.gridOptions.filter((e=>e.id!==Number.parseInt(t,10))),this.rfxGridOptionChange.emit({gridOptions:this.gridOptions,rowIndex:i}),0===this.gridOptions.length&&(this.gridOptions=[{id:this.gridOptions.length}])},this.onGridRowClick=e=>{e.stopPropagation();const t=e.currentTarget.id.split("_")[2],i=this.gridOptions.findIndex((e=>e.uid===t||e.id===Number.parseInt(t,10)));this.rfxGridRowClick.emit({gridOptions:this.gridOptions,rowIndex:i})},this.handleDropdownToggled=e=>{const t=e.type,i=e.target;let r;switch(r="RFX-DTEX-COMMON-SELECT"===i.tagName?i.shadowRoot?.children[0]?.children[0]:i.shadowRoot?.querySelector(".esriRFxRasterInput")?.children[0],t){case"calciteComboboxOpen":this.openDropdown?.id&&this.openDropdown?.id!==i.id&&this.openDropdown.dispatchEvent(this.calciteComboboxClose.emit()),this.openDropdown=i;break;case"calciteComboboxClose":this.openDropdown?.id===i.id&&((0,o.i)(r)||(r.open=!1),this.openDropdown=null)}}}async checkValidity(){const e=[];let t;const i=this.gridChildElements.length,r=Object.keys(this.gridLayout).length;i>r&&!0===this.canAdd&&(t=this.gridChildElements.sort(((e,t)=>e.id-t.id)).slice(0,i-r));for(const i of t??this.gridChildElements){const t=i.element,r=i.required;if(t&&t.checkValidity){const i=await t.checkValidity({required:r});e.push(i)}}return Promise.resolve(e.every((e=>!0===e)))}async componentWillLoad(){({strings:this.strings}=await(0,s.c)(this.hostElement,(0,r.a)("."))),this.gridOptions.forEach((e=>{e.uid=(0,o.u)("-element-")}))}adjustValueListItemIds(){this.gridOptions.forEach(((e,t)=>{e.id=t}))}isLastRowEmpty(e){return!Object.keys(this.gridLayout).some((t=>{const i=this.gridLayout[t].uiType===u.G.select?e[t].value:e[t];return!(0,o.i)(i)}))}addRow(){const e=this.gridOptions[this.gridOptions.length-1];if(!!this.isLastRowEmpty(e))return;this.adjustValueListItemIds();const t={id:this.gridOptions.length,uid:(0,o.u)("-element-")};for(const e in this.gridLayout)if(this.gridLayout.hasOwnProperty(e)){const i=this.gridLayout[e].uiType===u.G.select,r=this.gridOptions[0][e];i&&(t[e]={...r,value:void 0})}this.gridOptions.push(t)}changeComboboxInlineWidth(e,t){(0,p.n)(e,t,(e=>{const t=document.createElement("style");t.innerHTML=".list-container {\n      inline-size: var(--calcite-dropdown-width, 100%) !important; \n      }",e.appendChild(t)}))}handleTogglePopover(e){const t=e.type,i=e.target,r=i.shadowRoot?.activeElement;switch(t){case"rfxColorPickerPopoverOpen":this.activeColorPickerPopover&&this.activeColorPickerPopover?.referenceElement!==r?.referenceElement&&(this.activeColorPickerPopover.open=!1),this.activeColorPickerPopover=r;break;case"rfxColorPickerPopoverClose":this.activeColorPickerPopover?.referenceElement===r?.referenceElement&&(this.activeColorPickerPopover=null)}}renderGridRow(e,t){const i=Number.parseInt(t,10)+1,a=Object.keys(this.gridLayout).map((t=>{const i=this.gridLayout[t];let a;a="number"==typeof e[t]?String(e[t]):e[t];switch(i.uiType){case u.G.textInput:let s=!1===i.isEditable;return"function"==typeof i.isEditable&&(s=!i.isEditable(e)),(0,r.h)("td",null,(0,r.h)("calcite-input-text",{class:i.style,scale:l.U.Scale,key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:a,onCalciteInputTextChange:this.gridValueChange,title:e[t],disabled:s,ref:t=>{(0,o.i)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case u.G.text:return(0,r.h)("td",{key:`${t}_${e.id}`,class:i.style},i.constValue||e[t]);case u.G.raster:return(0,r.h)("td",null,(0,r.h)("rfx-dte-raster-input",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,inputLayers:this.inputLayers,allowScalar:i.allowScalar,rfxVariable:e.rasterElement,value:e[t]?.value,overlayPositioning:l.a.fixed,onRfxArgumentChange:this.gridValueChange,rfxBrowseLayerClick:this.rfxBrowseLayerClick,onCalciteComboboxOpen:this.handleDropdownToggled,onCalciteComboboxClose:this.handleDropdownToggled,ref:t=>{(0,o.i)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required});(0,p.n)(t,["shadowRoot","children[0]","children[0]","children[0]"],(e=>{e.style.width="11rem"}));this.changeComboboxInlineWidth(t,["shadowRoot","children[0]","children[0]","shadowRoot","children[0]","children[2]","children[0]"])},portal:o.s.portal}));case u.G.number:const n=i.validationRule,c=`${t}Rule`,{min:d,max:h,numberType:g,excludeMaxValue:f,excludeMinValue:m,numberButtonType:b,required:v,defaultValue:y,initialValue:x}=n??e[c]??{};return i.isEditable=this.isEditable,(0,r.h)("td",null,(0,r.h)("rfx-dte-number-input",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],min:d,max:h,defaultValue:y,initialValue:x,numberType:g,numberButtonType:b??"none",excludeMaxValue:f,excludeMinValue:m,required:v,onRfxNumberInputChange:this.gridValueChange,title:e[t],isDisabled:!i.isEditable,ref:t=>{(0,o.i)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case u.G.boolean:return(0,r.h)("td",null,(0,r.h)("calcite-checkbox",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,checked:e[t],onCalciteCheckboxChange:this.gridValueChange,ref:t=>{(0,o.i)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case u.G.switch:let C=!1===i.isEditable;return"function"==typeof i.isEditable&&(C=!i.isEditable(e)),(0,r.h)("td",null,(0,r.h)("calcite-switch",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,checked:e[t],onCalciteSwitchChange:this.gridValueChange,disabled:C,ref:t=>{(0,o.i)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})}}));case u.G.field:return(0,r.h)("td",null,(0,r.h)("rfx-dtex-field-select",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,inputLayers:this.inputLayers,isInGrid:!0,rasterInputVariable:e.layer,value:e[t],onRfxArgumentChange:this.gridValueChange,ref:t=>{(0,o.i)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required});this.changeComboboxInlineWidth(t,["shadowRoot","children[0]","children[0]","shadowRoot","children[0]","children[0]","shadowRoot","children[0]","children[2]","children[0]"])}}));case u.G.color:return(0,r.h)("td",null,(0,r.h)("rfx-color-picker",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],onRfxColorPickerValueChange:this.gridValueChange,ref:t=>{(0,o.i)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required})},onRfxColorPickerPopoverClose:e=>{this.handleTogglePopover(e)},onRfxColorPickerPopoverOpen:e=>{this.handleTogglePopover(e)}}));case u.G.select:return(0,r.h)("td",null,(0,r.h)("rfx-dtex-common-select",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,options:e[t].options,value:e[t].value,allowCustomValues:i.allowCustomValues,isInGrid:!0,onCalciteComboboxOpen:this.handleDropdownToggled,onCalciteComboboxClose:this.handleDropdownToggled,onRfxArgumentChange:this.gridValueChange,ref:t=>{(0,o.i)(t)||this.gridChildElements.push({id:e.id,element:t,required:i.validationRule?.required});this.changeComboboxInlineWidth(t,["shadowRoot","children[0]","children[0]","shadowRoot","children[0]","children[2]","children[0]"])}}));case u.G.icon:return(0,r.h)("td",null,e[t]?(0,r.h)("calcite-icon",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,icon:i.icon,scale:l.C.s,textLabel:i.label}):null)}}));return!0===this.hasIdColumn&&a.unshift((0,r.h)("td",null,(0,r.h)("div",{key:`idColumn_${e.id}`},i))),!0===this.canRemove&&a.push((0,r.h)("td",null,(0,r.h)("calcite-icon",{id:`remove-${e.id}`,key:`remove-${e.id}`,scale:l.U.Scale,icon:"x",onClick:i===this.gridOptions.length?void 0:this.onRemoveClick}))),a}renderHeader(){return(0,r.h)("thead",null,(0,r.h)("tr",null,!0===this.hasIdColumn&&(0,r.h)("th",null,this.strings.id),Object.keys(this.gridLayout).map((e=>{const t=this.gridLayout[e];return(0,r.h)("th",{class:`${t.style}`},t.label)})),!0===this.canRemove&&(0,r.h)("th",null," ")))}renderGridOptions(){return this.gridChildElements=[],this.gridOptions.map(((e,t)=>(0,r.h)("tr",{id:`grid_row_${e.uid??e.id}`,key:`grid_row_${e.uid??e.id}`,onClick:t===this.gridOptions.length-1?void 0:this.onGridRowClick},this.renderGridRow(e,t))))}render(){return(0,r.h)(r.H,{key:"9ca97f8df3a1c6682800a256b5af7256ba6f5de7"},(0,r.h)("table",{key:"742ea1a7147860004901d1e66087199598dc068a",class:`${_} ${this.hasBorder?O:""} ${this.isStacked?I:""}`},this.hasHeader&&this.renderHeader(),(0,r.h)("tbody",{key:"7684136e7693fb688bee2adb4b11aefd052d8722"},...this.renderGridOptions())))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.g)(this)}};F.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-grid__grid-container{width:100%;border-collapse:collapse}.rfx-grid__grid-container div{box-sizing:border-box}.rfx-grid__grid-container body{width:100%;height:100%;margin:0;padding:0}.rfx-grid__grid-container td{padding:0.5em;text-align:center}.rfx-grid__grid-container th{background:var(--calcite-color-foreground-2);padding:0.5em;border:1px solid var(--calcite-color-foreground-3);text-align:center;font-weight:normal}.rfx-grid__grid-container.border td{border:1px solid var(--calcite-color-foreground-3)}.rfx-grid__grid-container.stacked td,.rfx-grid__grid-container.stacked th{text-align:inherit;display:block;width:auto}"},74670:(e,t,i)=>{i.d(t,{D:()=>n,J:()=>u,a:()=>d,b:()=>f,c:()=>k,d:()=>m,e:()=>b,f:()=>L,g:()=>w,h:()=>C,i:()=>c,j:()=>v,k:()=>h,l:()=>g,m:()=>l,n:()=>_,o:()=>T,p:()=>R,s:()=>E});var r=i(5294),a=(i(13661),i(18423),i(21255),i(35431),i(24360)),s=i(92991),o=(i(588),i(55448),i(2924),i(11840),i(52373),i(33752),i(440),i(66744),i(44345),i(48001));i(23795),i(17902),i(56451),i(71802),i(32513),i(36596);const l=[38,39,40,41,42,43,47,54,55,58,66,67,68,69,70,71,72,73,74,75,93,94],n="distanceLegacy",c=e=>{const t=e?.category;return!![n].includes(t)},d=e=>!0===e?.hidden,h={local:"LocalFunction"},u={RASTER_FUNCTION_TEMPLATE:"RasterFunctionTemplate",RASTER_FUNCTION_VARIABLE:"RasterFunctionVariable",ARGUMENT_ARRAY:"ArgumentArray",RECORD_SET:"RecordSet",ECD_FILE:"ECDFile"},p={MATCH_VARIABLE:"MatchVariable",UNION_DIMENSION:"UnionDimension"},g={name:"Raster",isDataset:!0,isPublic:!1,type:u.RASTER_FUNCTION_VARIABLE};function f(e){return null==e?"":e.name||e.datasetName&&e.datasetName.name}function m(e){return e.hasOwnProperty("EsriClassifierDefinitionFile")}function b(e){return e.type&&e.type.toLowerCase().indexOf(u.RECORD_SET.toLowerCase())>=0}function v(e,t){const i=t&&t.value;if(null==i)return;let r;return e.some((e=>{if(e.values&&e.values.indexOf(i)>-1)return r=e.inputArgs,!0})),r}function y(e,t){let i;if(!(0,s.i)(e)&&(i=e.rasterFunctionArguments,1===Object.keys(i).length&&!e.hasArgumentsObject))return!0;const r=t.arguments,a=r&&r.type;return!(!a||a!==u.RASTER_FUNCTION_TEMPLATE&&a!==u.RASTER_FUNCTION_VARIABLE)||void 0}function x(e,t,i){if((0,s.i)(t)||(0,s.i)(i))return;const r=e?.rasterFunctionArguments;return(0,s.i)(r)?void 0:(0,o.b)(t,r)}function C(e,t,i,r){if((0,s.i)(t)&&(0,s.i)(r))return!1;const o=x(e,r=r||t.key,i);if(!(0,s.i)(o)&&o.dataType===a.d.rasterArray)return!0;if(!t)return;const l=t.value;if(l&&l.elements){return l.elements.some((e=>e&&(e.isDataset||e.type===u.RASTER_FUNCTION_TEMPLATE||e.value&&e.value.type===u.RASTER_FUNCTION_TEMPLATE)))}l&&Array.isArray(l)&&l.some((e=>e&&e.name&&e.url))}function k(e,t,i){t.value||(t.value={elements:[],type:u.ARGUMENT_ARRAY});let r=t.value&&t.value.elements?t.value.elements:t.value;return r&&Array.isArray(r)?void 0!==i?r[i]=e:(r.push(e),i=r.length-1):(r=[e],i=0),t.value&&t.value.elements?t.value.elements=r:t.value=r,i}function w(e,t,i){let r,a;if("string"==typeof t?r=t:(r=t.key,a=t.index),(0,s.i)(r)||(0,s.i)(i))return;const o=i.arguments,l=o&&o.type,n=r&&r.toLowerCase();let c;if(y(e,i))return l!==u.RASTER_FUNCTION_TEMPLATE&&!o.isDataset||"raster"!==n?l===u.RASTER_FUNCTION_VARIABLE&&"rasters"===n&&(c=void 0!==a?function(e,t){if((0,s.i)(t)||void 0===e)return;const i=t.value&&t.value.elements?t.value.elements:t.value;return i&&i.length?i[e]:void 0}(a,o):o):c=o,c;if(c=o[r],void 0!==a&&C(e,c,i,r)){const e=c.value&&c.value.elements?c.value.elements:c.value;c=e&&e.length?e[a]:void 0}return c}function L(e,t){if((0,s.i)(t))return;const i=[],a=t.arguments,o=a&&a.type;if(y(e,t)){let e,t=r.clone(a);return e=o===u.RASTER_FUNCTION_TEMPLATE||t.isDataset?"Raster":"Rasters",(0,s.i)(t)?t={key:e}:t.key=e,i.push(t),i}return Object.keys(a).forEach((e=>{if(e===p.MATCH_VARIABLE||e===p.UNION_DIMENSION)return;let t=r.clone(a[e]);(0,s.a)(t)&&((0,s.i)(t)?t={key:e}:t.key=e,i.push(t))})),i}function E(e,t,i,r,a){if((0,s.i)(t)||(0,s.i)(i)||(0,s.i)(r))return;const o=t.arguments,l=C(e,o,t,r)&&void 0!==a;if(y(e,t))l?a=k(i,o,a):t.arguments=i;else{const e=o[r];l?a=k(i,e,a):o[r]=i}return i.value&&"Scalar"===i.value.type&&(0,s.i)(i.name)&&(i.name=l?t.function.type.toLowerCase()===h.local.toLowerCase()&&a>0?`InRaster${a+1}`:`Raster${a>0?a+1:""}`:x(e,r,t).displayName||r),{key:r,index:a}}function R(e){return e.dataType===a.d.raster||e.dataType===a.d.rfxtemplate}function T(e){return e.dataType===a.d.scalar}const _=(e,t,i)=>{let r=e;!function e(a){if(a>=t.length)return void i(r);const s=t[a];let o;if("shadowRoot"===s)o=r?.shadowRoot;else if(s.startsWith("children[")){const e=parseInt(s.match(/\d+/)[0],10);o=r.children[e]}o?(r=o,e(a+1)):requestAnimationFrame((()=>e(a)))}(0)}},95069:(e,t,i)=>{i.d(t,{a:()=>c,f:()=>n,i:()=>s,p:()=>l,s:()=>o});var r=i(5839),a=i(92991);function s(e){return null!=e&&!1===Number.isNaN(e)&&!0===Number.isFinite(e)}function o(e,t){let i;if(null!==e){const r="string"==typeof e?Number.parseFloat(e):e;s(r)?i=r:s(t)&&(i=t)}return void 0===i?"":`${i}`}function l(e){if(!(0,a.i)(e))return Number.parseFloat(e)}function n(e,t=3){if(!(0,a.i)(e))return Number.parseFloat(e.toFixed(t))}function c(e,t){let i="";if(!(0,a.i)(e)&&!Number.isNaN(e)){const a=(0,r.g)().locale;i=Intl.NumberFormat(a,t).format(Number(e))}return i}}}]);