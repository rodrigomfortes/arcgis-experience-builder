/*! For license information please see arcgis_display-order_node_modules_arcgis_imagery-components_dist_component-28f806.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_display-order_node_modules_arcgis_imagery-components_dist_component-28f806"],{192:(e,t,r)=>{r.d(t,{A:()=>i,I:()=>n,S:()=>s,a:()=>y,b:()=>S,c:()=>u,d:()=>h,e:()=>o,f:()=>b,g:()=>m,h:()=>p,i:()=>d,j:()=>f,k:()=>a,s:()=>c});var i=(e=>(e.VISIBLE="visible",e.DISPLAY_EXTENT="displayExtent",e.ALL="all",e))(i||{}),n=(e=>(e.ALL="all",e.SELECT="select",e))(n||{}),s=(e=>(e.ASC="asc",e.DESC="desc",e))(s||{}),a=(e=>(e.BRAND="brand",e.DANGER="danger",e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e))(a||{});function o(e){return"object"==typeof e&&null!==e&&"name"in e&&"AbortError"===e.name}const l=new Set(["small-integer","big-integer","integer","single","double","oid"]),c=new Set([...l,"date","string"]);function d(e){return l.has(e)}function u(e){return!!e?.domain?.codedValues}function p(e){return u(e)&&"MosaicCatalogItemCategoryDomain"===e?.domain?.name}function m(e,t=!1){if(!e)return null;const r=new Date(e),i=t?r.getUTCFullYear():r.getFullYear(),n=t?r.getUTCMonth():r.getMonth(),s=t?r.getUTCDate():r.getDate(),a=t?r.getUTCHours():r.getHours(),o=t?r.getUTCMinutes():r.getMinutes(),l=t?r.getUTCSeconds():r.getSeconds();return`${i}-${g((n+1).toString(),2,"0")}-${g(s.toString(),2,"0")} ${g(a.toString(),2,"0")}:${g(o.toString(),2,"0")}:${g(l.toString(),2,"0")}`}function g(e,t,r){for(r=r||" ";e.length<t;)e=r+e;return e}function f(e,t,r){return e+t-1>r?r:e+t-1}function h(e,t,r="en"){return"string"==typeof e&&"string"==typeof t?e.localeCompare(t,r):e<t?-1:e>t?1:0}function S(e,t){if(!e||!t)return;let r=t.assetsPath;r.endsWith("/")||(r+="/"),e?.firstElementChild?.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${r}esri/themes/light/main.css" />`)}function y(e,t){return`${e} IN (${t.map((e=>`${e}`)).join(",")})`}const b=(e,t="en")=>{const r=e.toString();if(r.includes("e")){const[e,t]=r.split("e"),i=b(Number.parseFloat(e)),n=Number.parseInt(t,10);return n<0?i-n:Math.max(0,i-n)}const i=r.indexOf(".");if(-1===i)return 0;const n=r.length-i-1;return new Intl.NumberFormat(t).formatToParts(1.1).find((e=>"decimal"===e.type))?n:0}},3287:(e,t,r)=>{r.r(t),r.d(t,{ArcgisImageryItemSortPopover:()=>c});var i=r(3174),n=r(192),s=r(4843),a=r(9722),o=r(5860);const l=r(6011).AH`.sort-popover-wrapper{display:flex;padding:1rem;min-width:320px;max-height:50vh;background-color:var(--calcite-color-foreground-1)!important}.label-wrapper{background-color:var(--calcite-color-foreground-1);padding-top:.5rem}.field-list-wrapper{overflow-y:auto}.sort-order-chip-group{padding:0 .5rem .5rem;background-color:var(--calcite-color-foreground-1)}.button-wrapper{padding:1rem .25rem .25rem;background-color:var(--calcite-color-foreground-1)}`;class c extends o.WF{constructor(){super(...arguments),this.fields=[],this.arcgisImageItemSortChangeSave=(0,o.lh)(),this.arcgisImageItemSortPopoverClose=(0,o.lh)()}static{this.properties={selectedSortField:16,selectedSortOrder:16,referenceElement:0,messages:0,fields:0,preselectedSortField:0,preselectedSortOrder:0,open:5}}static{this.styles=l}willUpdate(e){e.has("open")&&this.updateModal(this.open)}updateModal(e){e&&(this.selectedSortField=this.preselectedSortField,this.selectedSortOrder=this.preselectedSortOrder)}handleSortChangeSave(){const{selectedSortField:e,selectedSortOrder:t}=this;this.arcgisImageItemSortChangeSave.emit({sortField:e,sortOrder:t}),this.arcgisImageItemSortPopoverClose.emit()}render(){const{messages:e,open:t}=this;return a.qy`<calcite-popover auto-close .label=${e.sort} .referenceElement=${this.referenceElement} closable .heading=${e.sort} placement=leading-start overlay-positioning=fixed pointer-disabled trigger-disabled offset-distance=10 offset-skidding=50 .open=${t} @calcitePopoverClose=${()=>{this.arcgisImageItemSortPopoverClose.emit()}}><calcite-panel class="sort-popover-wrapper"><calcite-label class="label-wrapper">${e.sortByField}</calcite-label>${this.renderSortFieldList()}<calcite-label class="label-wrapper">${e.sortOrder}</calcite-label>${this.renderSortOrderChipGroup()}<div class="button-wrapper"><calcite-button width=full @click=${this.handleSortChangeSave}>${e.done}</calcite-button></div></calcite-panel></calcite-popover>`}renderSortFieldList(){const{fields:e,selectedSortField:t}=this,r=(0,s.g)(e).map((e=>a.qy`<calcite-list-item .label=${e.name} .value=${e} .selected=${e.name===t?.name}></calcite-list-item>`));return a.qy`<calcite-list .label=${this.messages.sortByField} selection-mode=single-persist class="field-list-wrapper" @calciteListChange=${e=>{const t=e.target.selectedItems.map((e=>e.value));this.selectedSortField=t[0]}}>${r}</calcite-list>`}renderSortOrderChipGroup(){const{messages:e,selectedSortField:t,selectedSortOrder:r}=this,{type:i}=t||{};let s=null;"string"===i?s=[{displayText:e.alphabetical,sortOrder:n.S.ASC},{displayText:e.reverseAlphabetical,sortOrder:n.S.DESC}]:"date"===i?s=[{displayText:e.mostRecent,sortOrder:n.S.DESC},{displayText:e.leastRecent,sortOrder:n.S.ASC}]:(0,n.i)(i)&&(s=[{displayText:e.highestValue,sortOrder:n.S.DESC},{displayText:e.lowestValue,sortOrder:n.S.ASC}]);const o=s?.map((e=>{const{displayText:t,sortOrder:i}=e;return a.qy`<calcite-chip .label=${i} .selected=${r===i} appearance=outline kind=neutral>${t}</calcite-chip>`}));return o&&o.length>0?a.qy`<calcite-chip-group class="sort-order-chip-group" .label=${e.sortOrder} selection-mode=single-persist @calciteChipGroupSelect=${e=>{const t=e.target.selectedItems.map((e=>e.label));this.selectedSortOrder=t[0]}}>${o}</calcite-chip-group>`:null}}(0,i.c)("arcgis-imagery-item-sort-popover",c)},4843:(e,t,r)=>{r.d(t,{a:()=>o,b:()=>m,c:()=>x,d:()=>f,e:()=>g,f:()=>p,g:()=>u,h:()=>y,i:()=>l,j:()=>c,k:()=>d,l:()=>b,m:()=>$,r:()=>w});var i=r(8423),n=r(2373),s=r(1552),a=r(192);function o(e){const t=e.find((e=>"best"===e.name.toLowerCase()));if(t)return t;const r=e.find((e=>"acquisitiondate"===e.name.toLowerCase()));if(r)return r;return e.find((e=>"date"===e.name.toLowerCase()))||e.find((e=>"double"===e.type||"integer"===e.type))}async function l(e,t,r){return await e.queryObjectIds(t,{signal:r})}async function c(e,t,r){t.outFields=["*"],t.returnGeometry=!0;const i=await e.queryRasters(t,{signal:r,timeout:12e4});return i?.features?.length?i:null}function d(e,t){const r=e.fields;let i=r.find((e=>"name"===e.name.toLowerCase()));return i||(i=r.find((t=>t.name===e.objectIdField))),i&&i.name!==t.name?[i,t]:[t]}function u(e){return Array.isArray(e)?e.filter((e=>a.s.has(e.type))):[]}function p(e){const{layer:t,queryField:r,queryValues:i,isIncludeOverviews:n,extent:s,selectedImageItemOids:o}=e,l=t.createQuery();if(i&&i.length>0){let e="";if("date"===r?.type&&i[0]){const t=new Date(i[0]),n=(0,a.g)(i[0],!0),s=1===i.length||i[0]===i[1]?(0,a.g)(t.setDate(t.getDate()+1),!0):(0,a.g)(i[1],!0);e=`${r.name} BETWEEN timestamp '${n}' AND timestamp '${s}'`}else{const t=i.filter((e=>"string"==typeof e||"number"==typeof e));if(1===t.length||2===t.length){const[n,s]=i,a="string"==typeof n;e=1===t.length?`${r?.name}=${a?`'${n}'`:n}`:`${r?.name} BETWEEN ${a?`'${n}'`:n} AND ${a?`'${s}'`:s}`}}l.where=e}const c="(Category = 1)";if(n)l.where=l.where?.replace(c,"");else{const e=c+(l.where?` AND (${l.where})`:"");l.where=e}let d="";return o&&o.length>0&&(d=(0,a.a)(t.objectIdField,o)),l.where=d?`${l.where} AND (${d})`:l.where,t.definitionExpression&&(l.where=l.where?`${l.where} AND (${t.definitionExpression})`:t.definitionExpression),s&&(l.geometry=s),l}function m(e){return e.extent?.clone().expand(.75)}async function g(e,t,r,i,n){if(!t)return[];const s=[{onStatisticField:t.name,outStatisticFieldName:"cnt",statisticType:"count"}],o=await h(e,r,i,s,[t.name]);if(o){const r=await e.queryRasters(o,{signal:n});if(r?.features?.length>0){const e=(0,a.i)(t.type);return r.features.map((r=>{const i=r.attributes[t.name];return e?Number(i):i}))}}return[]}async function f(e,t,r,i,n){if(!t.name)return[];const s=[{statisticType:"min",onStatisticField:t.name,outStatisticFieldName:"min_field_value"},{statisticType:"max",onStatisticField:t.name,outStatisticFieldName:"max_field_value"}],a=await h(e,r,i,s);if(a){const t=await e.queryRasters(a,{signal:n});if(t?.features?.length>0){const[e]=t.features;return[e.attributes.min_field_value,e.attributes.max_field_value]}}return[]}async function h(e,t,r,i,n=[]){const s=e.createQuery();if(s.returnGeometry=!1,t===a.A.DISPLAY_EXTENT&&(s.geometry=m(r)),t===a.A.VISIBLE){const t=await S(e,r);if(!(t.length>0))return null;s.where=(0,a.a)(e.objectIdField,t)}return e.definitionExpression&&(s.where=s.where?`${s.where} AND (${e.definitionExpression})`:e.definitionExpression),s.outStatistics=i,n.length>0&&(s.groupByFieldsForStatistics=n),s}async function S(e,t){const r=[],n=function(e,t){const{extent:r,width:n,height:a}=t,o=r.width/n,l=r.height/a,c=new i.default({x:o,y:l});c.spatialReference=r.spatialReference;const d=new s.default;d.geometry=m(t),d.returnGeometry=!0,d.pixelSize=c,d.maxItemCount=e.sourceJSON?.maxMosaicImageCount,d.returnPixelValues=!1;const u=e.mosaicRule.clone();return e.definitionExpression&&(u.where=e.definitionExpression),d.mosaicRule=u,e.useViewTime&&t.timeExtent&&(d.timeExtent=t.timeExtent),d}(e,t),a=await e.identify(n,{timeout:12e4});if(!a?.catalogItems?.features||!a?.catalogItemVisibilities)return[];for(let t=0;t<a.catalogItems.features.length;t++)a.catalogItemVisibilities[t]>0&&r.push(a.catalogItems.features[t].attributes[e.objectIdField]);return r}async function y(e,t,r){const i=await S(e,t);if(!(i.length>0))return null;r.objectIds=i,r.outFields=["*"],r.returnGeometry=!0;const n=await e.queryRasters(r,{timeout:12e4});return n?.features?.length>0?n:null}function b(e,t){if(t.length){const r=new n.default;r.method="lock-raster",r.lockRasterIds=t,e.definitionExpression&&(r.where=e.definitionExpression),e.mosaicRule=r}}function w(e,t){t&&(e.mosaicRule=t.clone())}function $(e,t,r){const{title:i}=e,n=t.name;let s="";const o=r.map((e=>e.attributes[n])).map((e=>"date"===t.type?(0,a.g)(e):e));return o.sort(((e,t)=>"number"==typeof e&&"number"==typeof t?e-t:String(e).localeCompare(String(t)))),1===o.length&&(s=`(${o[0]})`),o.length>1&&(s=`(${o[0]} - ${o[o.length-1]})`),`${i} - ${n} ${s}`}function x(e,t){return Math.abs(t.extent.center.x-e.center.x)<t.resolution&&Math.abs(t.extent.center.y-e.center.y)<t.resolution}}}]);