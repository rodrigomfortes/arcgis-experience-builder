/*! For license information please see arcgis_display-order_node_modules_arcgis_imagery-components_dist_c-b6502e.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_display-order_node_modules_arcgis_imagery-components_dist_c-b6502e"],{3393:(e,i,t)=>{t.d(i,{D:()=>l});var n=t(5662),s=t(5860),a=t(7513),o=t(2797);function l(e){const{position:i="default",dimensionInfo:t}=e,l="start"===i||"end"===i,{values:r}=t;let{selectedValue:d}=e;r&&(0,n.i)(r)&&"number"==typeof d&&(d=l?d=r.find((e=>"start"===i?e[0]===d:e[1]===d)):r.find((e=>e[0]===d))??r.find((e=>e[1]===d)));const c=d===n.u||e.selectedValue===n.u,m=c?"undefined":(0,n.f)(d,t,{intl:o,useRecurringTimeLabel:!0}),h=(e.isAscending?t.values:[...t.values].reverse()).map((e=>{const s=(0,n.f)(e,t,{intl:o,useRecurringTimeLabel:!0}),a=Array.isArray(e)?e.join(" - "):String(e),l=s===m;return{key:`${t.name}-${i}-${a}}`,value:a,label:s,selected:l}})),{messages:u}=e;e.showEnd&&h.push({key:`${t.name}-end-undefined`,value:String(n.u),label:u.extent.endUndefined,selected:c});const f=Math.max(0,h.findIndex((({selected:e})=>e)));return a.qy`<div class=${(0,s.CP)(e.className)}><arcgis-imagery-lazy-loading-select .selectedIndex=${f} .list=${h} .messages=${e.selectMessages} @arcgisChange=${i=>{i.stopPropagation();const t=i.detail.selectedValue.split(" - ").map((e=>Number(e)));e.onChange?.(1===t.length?t[0]:t)}} .containerTop=${e.containerTop}></arcgis-imagery-lazy-loading-select>${e.sortable&&function(e,i,t,s){const o=(0,n.a)(e)?i?"clock-up":"clock-down":i?"sort-ascending-arrow":"sort-descending-arrow";return a.qy`<calcite-action .icon=${o} scale=s .text=${t} slot=actions-end @click=${()=>s?.(e.name)}></calcite-action>`}(t,e.isAscending,u.display.sort,e.updateSorting)||""}</div>`}},5662:(e,i,t)=>{t.d(i,{a:()=>u,b:()=>p,c:()=>m,d:()=>f,e:()=>c,f:()=>l,g:()=>h,h:()=>d,i:()=>g,m:()=>n,u:()=>s});const n=10.9,s=Number.MAX_VALUE-1;function a(e,i){const t=new Date(e),{useFriendlyIsoFormat:n,intl:s,format:a}=i;if(n&&s)return s.formatDate(t,{...s.convertDateFormatToIntlOptions(a??"short-date-long-time"),timeZone:"UTC"});let o=new Date(e).toISOString();return o=`${o.slice(0,o.indexOf("."))}Z`,o}function o(e,i,t="long"){const n=new Date(2022,9,10);return n.setMonth(e-1),i.formatDate(n,{month:t})}function l(e,i,t={}){if(null==e)return"";const{intl:n,useRecurringTimeLabel:s}=t;if(s&&n&&!Array.isArray(e)){const t=i.unit?.toLowerCase().trim();if(function(e){return"StdTime"===e.name&&!!e.recurring}(i)&&("months"===t||"quarters"===t))return"months"===t?o(e,n):function(e,i){return`${o(3*(e-1)+1,i,"short")} - ${o(3*e,i,"short")}`}(e,n)}const l=i.values?.[i.values.length-1];return t.useStartOrEndForRangedValue&&Array.isArray(e)&&2===e.length&&Array.isArray(l)&&(e=e.join("-")===l.join("-")?e[1]:e[0]),u(i)?(t.useFriendlyIsoFormat&&!t.format&&(t={format:r(i),...t}),Array.isArray(e)?e.map((e=>a(e,t))).join(" - "):a(e,t)):Array.isArray(e)?e.map((e=>n?.formatNumber(e)??String(e))).join(" - "):n?.formatNumber(e)??String(e)}function r(e){let i=e.intervalUnit?.toLowerCase().trim()??"";const{extent:t}=e,n=e.interval??0,s=e.values?.length;if(!["years","months","days","hours"].includes(i)&&t?.length&&s){const e=(t[1]-t[0])/s,n=864e5;i=e>=365*n?"years":e>=28*n?"months":i}switch(i){case"months":i=n>11?"years":i;break;case"days":i=n>364?"years":n>27?"months":i;break;case"hours":i="days"}return"years"===i?"year":"months"===i?"short-month-year":"short-date"}function d(e,i){const t=i?.dimensions?.find((({name:i})=>i===e.name));if(!t?.extent)return e;const n=[...t.extent],{values:s}=e;if(s?.length){const i=s.filter((e=>Array.isArray(e)?null==n[1]||n[0]===n[1]?e[0]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]));if(0===i.length){const e=s[s.length-1];Array.isArray(e)&&e[1]===n[0]&&i.push(e)}return{...e,extent:n,values:i}}return{...e,extent:n}}function c(e){const{values:i,extent:t,name:n}=e;let s=i?.[0]??t?.[0];return"stdz"===n.toLowerCase()&&!e.hasRanges&&t&&Math.abs(t[1])<=Math.abs(t[0])&&(s=i?.length?i[i.length-1]:t[1]),s}function m(e){return"imagery-tile"===e.type||"wcs"===e.type?e.multidimensionalDefinition:(e.mosaicRule??e.defaultMosaicRule)?.multidimensionalDefinition}async function h(e,i=!1){if("imagery-tile"===e.type||"wcs"===e.type)return e.serviceRasterInfo?.multidimensionalInfo;const{rasterFunction:t,version:n}=e;return i||n<=10.9||!t||"none"===t.functionName?.toLowerCase()?e.serviceRasterInfo.multidimensionalInfo:(await e.generateRasterInfo(e.rasterFunction).catch((()=>e.serviceRasterInfo))).multidimensionalInfo}function u(e,i=!1){return"StdTime"===e.name&&(i||!e.recurring)}function f(e,i,t){i=d(i,t);const n=l(e.values[0],i);if(!i.values?.some((e=>n===l(e,i)))){const t=c(i);e.values=null!=t?[t]:[]}}function g(e){return Array.isArray(e[0])}function p(e){return e.variables.map((({name:e,unit:i,description:t})=>({name:e,label:i?`${e} (${i})`:e,description:t})))}},6024:(e,i,t)=>{t.d(i,{u:()=>h});var n=t(310);const s=(e,{host:i,key:t,isReactive:s},a)=>{const o=i,l=o[t]!==e.exports,r=o[t]!==a,d=a!==e.exports;l&&!r&&d&&(o[t]=e.exports);if(i===e.component){if(s){const i=e.component.manager;r&&i.W(e,o[t]),e.onUpdate((n=>{if(n.has(t)){const n=o[t];n!==e.exports&&i.W(e,n)}}))}e.O=s?void 0:t}const c=e.component.constructor.elementProperties.get(t)?.readOnly;e.watchExports((()=>{o[t]!==e.exports&&(c?(0,n.h)((()=>{o[t]=e.exports})):o[t]=e.exports)}))};t(9722);var a=t(7274);const o=e=>r(void 0,e);class l extends n.C{constructor(e,i){super(e);const t=this.exports;try{(0,n.s)(this.component);const e=i(this.component,this),s=this.exports!==t;if((0,n.i)(e)){s||this.setProvisionalExports(e);const i=e.then((e=>{this.exports=e,super.catchUpLifecycle()})).catch((e=>{this.P.reject(e),console.error(e)}));this.onLoad((async()=>await i))}else s&&void 0===e||(this.exports=e),queueMicrotask((()=>super.catchUpLifecycle()))}catch(e){this.P.reject(e),console.error(e)}}catchUpLifecycle(){}}const r=(d=l,(...e)=>{const i=(0,n.e)(),t=new d(...e),a=t.exports;(0,n.d)(i.at(-1));const o=t.component.manager;o.W(t,a),t.watchExports(o.W.bind(o,t)),(0,n.o)(t);const l=[t.component,...i].reverse();return(0,n.t)(l,(e=>void 0===e?void 0:s(t,e,a)),a)});var d;n.C;const c=(e,i)=>{if(!i)return e;const t={...e};return Object.entries(i).forEach((([i,n])=>{t[i]="object"==typeof n?c(e[i],n):n??e[i]})),t};var m=t(3174);const h=(u=m.g,(e={})=>o(((i,t)=>{const n=(0,a.kn)(i.el),s={_lang:n.lang,_t9nLocale:n.t9nLocale,_loading:!0},o=i;t.onLifecycle((()=>(0,a.hd)(i.el,(()=>u("./assets")),(({t9nLocale:e,t9nStrings:n,lang:s})=>{const a={...n,_lang:s,_t9nLocale:e,_loading:!1};t.exports=a;const r=n.componentLabel;"string"==typeof r&&"label"in i&&null==i.label&&(i.label??=r),l(o.messageOverrides)}),e.name)));const l=e=>{const i=t.exports,n=i._original??i,s=c(n,e);e&&(s._original=n),t.exports=s};return"messageOverrides"in o&&t.onUpdate((e=>{e.has("messageOverrides")&&l(o.messageOverrides)})),e.blocking?(t.setProvisionalExports(s,!1),t.ready):s})));var u},7960:(e,i,t)=>{t.d(i,{_:()=>u,K:()=>p});var n=t(7513),s=t(5987),a=t(3715);const o=(e,i)=>{const t=e._$AN;if(void 0===t)return!1;for(const e of t)e._$AO?.(i,!1),o(e,i);return!0},l=e=>{let i,t;do{if(void 0===(i=e._$AM))break;t=i._$AN,t.delete(e),e=i}while(0===t?.size)},r=e=>{for(let i;i=e._$AM;e=i){let t=i._$AN;if(void 0===t)i._$AN=t=new Set;else if(t.has(e))break;t.add(e),m(i)}};function d(e){void 0!==this._$AN?(l(this),this._$AM=e,r(this)):this._$AM=e}function c(e,i=!1,t=0){const n=this._$AH,s=this._$AN;if(void 0!==s&&0!==s.size)if(i)if(Array.isArray(n))for(let e=t;e<n.length;e++)o(n[e],!1),l(n[e]);else null!=n&&(o(n,!1),l(n));else o(this,e)}const m=e=>{e.type==a.OA.CHILD&&(e._$AP??=c,e._$AQ??=d)};class h extends a.WL{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,i,t){super._$AT(e,i,t),r(this),this.isConnected=e._$AU}_$AO(e,i=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),i&&(o(this,e),l(this))}setValue(e){if((0,s.Rt)(this._$Ct))this._$Ct._$AI(e,this);else{const i=[...this._$Ct._$AH];i[this._$Ci]=e,this._$Ct._$AI(i,this,0)}}disconnected(){}reconnected(){}}const u=()=>new f;class f{}const g=new WeakMap,p=(0,a.u$)(class extends h{render(e){return n.s6}update(e,[i]){const t=i!==this.G;return t&&void 0!==this.G&&this.rt(void 0),(t||this.lt!==this.ct)&&(this.G=i,this.ht=e.options?.host,this.rt(this.ct=e.element)),n.s6}rt(e){if(this.isConnected||(e=void 0),"function"==typeof this.G){const i=this.ht??globalThis;let t=g.get(i);void 0===t&&(t=new WeakMap,g.set(i,t)),void 0!==t.get(this.G)&&this.G.call(this.ht,void 0),t.set(this.G,e),void 0!==e&&this.G.call(this.ht,e)}else this.G.value=e}get lt(){return"function"==typeof this.G?g.get(this.ht??globalThis)?.get(this.G):this.G?.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}})},9402:(e,i,t)=>{t.r(i),t.d(i,{ArcgisImageryMultidimensionalFilter:()=>g});var n=t(3174),s=t(9619),a=t(5662),o=t(9047),l=t(6547),r=t(3393),d=t(6024),c=t(7274),m=t(9722),h=t(7960),u=t(5860);const f=t(6011).AH`:host{display:flex;flex:1 1 auto;overflow:hidden}.multidimensional-unsupported{margin:20px}.dimension-zone{padding:10px;border:1px solid var(--calcite-color-border-3);margin:10px 0}.dimension-select-container{display:flex;width:100%;align-items:center;.dimension-select{flex-grow:1}}`;class g extends u.WF{constructor(){super(...arguments),this.messages=(0,d.u)({blocking:!0}),this.refCloseButtonNode=(0,h._)(),this.refPanelNode=(0,h._)(),this.mdimSliders={},this.allVariables=[],this.displayVariables=[],this.pauseLayerUpdate=!1,this.updateSorting=e=>{const i={...this.sortDirections};i[e]="descending"===i[e]?"ascending":"descending",this.sortDirections=i},this.updateLayerMultidimensionalDefinition=(0,c.sg)((()=>{const{activeMultidimensionalDefinition:e,layer:i}=this,t=this.isImageryLayer(i);if(!(t?this.hasPropertyValueChanged(e,i.mosaicRule?.multidimensionalDefinition):this.hasPropertyValueChanged(e,i.multidimensionalDefinition)))return;const n=this.getMultidimensionalDefinition(i),s=!n||0===n.length||n[0].variableName!==e[0].variableName;if(t){const t=(i.mosaicRule??i.defaultMosaicRule).clone();if(this.isDefaultUnspecifiedVariable(e[0].variableName)){const i=e.map((e=>{const i=e.clone();return i.variableName="",i}));t.multidimensionalDefinition=i}else t.multidimensionalDefinition=e;i.mosaicRule=t}else i.multidimensionalDefinition=e;s&&this.updateLayerRenderer()}),100),this.updateLayerRenderer=async()=>{const{activeMultidimensionalDefinition:e,layer:i}=this,t=e[0].variableName,n="imagery"===i.type||"imagery-tile"===i.type?i.presetRenderers?.find((e=>"variable"===e.method&&e.value===t)):null;if(n&&"wcs"!==i.type)i.activePresetRendererName=n.name;else{const e=this.getVariableInfo(t),{renderer:n}=i;if("raster-stretch"===n?.type&&e.statistics?.length){const t=n.clone();t.customStatistics=e.statistics.map((e=>({min:e.min,max:e.max,avg:e.avg??0,stddev:e.stddev??1}))),i.renderer=t}else if("class-breaks"===n?.type&&e.histograms?.length)try{const e=n.authoringInfo?.classificationMethod||"natural-breaks",s=(await(0,l.createRenderer)({layer:i,variableName:t,numClasses:n.classBreakInfos.length,classificationMethod:"manual"===e?"natural-breaks":"defined-interval"===e?"equal-interval":e})).renderer.classBreakInfos;s.forEach(((e,i)=>{e.symbol=n.classBreakInfos[i].symbol}));const a=n.clone();a.classBreakInfos=s,i.renderer=a}catch{}}},this.updateLayerMultidimensionalSubset=(0,c.sg)((e=>{this.layer.multidimensionalSubset=e}),100),this.createTimeRef=e=>{this.mdimSliders.time=e,this.dimensionSliderSetting?.timeContainer||this.view.ui.add(e,{position:"manual"}),this.arcgisChange.emit({type:"slider-add",dimensionType:"time",dimensionName:this.animatedDimensions.time})},this.createZRef=e=>{this.mdimSliders.z=e,this.dimensionSliderSetting?.zContainer||this.view.ui.add(e,{position:"manual"}),this.arcgisChange.emit({type:"slider-add",dimensionType:"z",dimensionName:this.animatedDimensions.z})},this.sortDirections={},this.animatedDimensions={time:"",z:""},this.activeMultidimensionalDefinition=[],this.closable=!1,this.hideButtons=!1,this.showExtentSection=!1,this.showAreaOfInterest=!1,this.isDimensionListSortable=!1,this.showDimensionSliderControls=!1,this.arcgisCancel=(0,u.lh)(),this.arcgisSave=(0,u.lh)(),this.arcgisChange=(0,u.lh)()}static{this.properties={multidimensionalInfo:16,activeMultidimensionalSubset:16,sortDirections:16,animatedDimensions:16,activeMultidimensionalDefinition:16,panelHeading:1,closable:5,hideButtons:5,showExtentSection:5,showAreaOfInterest:5,isDimensionListSortable:5,showDimensionSliderControls:5,dimensionSliderSetting:0,layer:0,view:0}}static{this.styles=f}async done(){this.apply()}async setFocus(e){"dismiss-button"===e||!e&&this.closable?this.refCloseButtonNode.value?.setFocus():this.refPanelNode.value?.setFocus()}async load(){const{select:e,extent:i}=this.messages;this.selectMessages={clear:e.clearFilter,label:i.searchVariables,selectLabel:i.selectVariables};const{layer:t}=this;t.loaded?await this.initLayer(t):this.initLayer(t)}willUpdate(e){if(!this.hasUpdated)return;e.has("showDimensionSliderControls")&&this.showDimensionSliderControls&&(this.showDimensionSliderControls?this.createDimensionalSliders():this.destroyMdimSlider("both")),e.has("dimensionSliderSetting")&&this.updateSliderSetting(),e.has("layer")&&(this.multidimensionalInfo=void 0,this.watchHandleLayer?.remove(),this.watchHandleLayer=void 0,this.initLayer(this.layer));const{activeMultidimensionalDefinition:i}=this,t=e.get("activeMultidimensionalDefinition");if(e.has("activeMultidimensionalDefinition")&&i?.length&&t){this.sortDirections={},this.pauseLayerUpdate||this.updateLayerMultidimensionalDefinition(),this.arcgisChange.emit({type:"dimension-filter",multidimensionalDefinition:i,multidimensionalSubset:this.activeMultidimensionalSubset});const{time:e,z:n}=this.animatedDimensions;if(this.showDimensionSliderControls&&(e||n)&&i[0].variableName!==t[0].variableName){const t=this.getVariableInfo(i[0].variableName);t.dimensions.some((({name:i})=>i===e))||this.destroyMdimSlider("time"),t.dimensions.some((({name:e})=>e===n))||this.destroyMdimSlider("z")}}}disconnectedCallback(){super.disconnectedCallback(),this.watchHandleLayer?.remove(),this.destroyMdimSlider("both")}async initLayer(e){if(!e)return;e.loaded||await e.load();const i=await(0,a.g)(e,!0);if(!i)return;this.rawMultidimensionalInfo=i;const t=this.isImageryLayer(e);if(t){const t=await(0,a.g)(e)??i,n=t.variables?.length>1&&this.hasNewVariable(t);this.multidimensionalInfo=n?i:t}else this.multidimensionalInfo=i;this.allVariables=(0,a.b)(this.multidimensionalInfo);const n=this.getMultidimensionalDefinition(e),s=t?e.mosaicRule?.clone():void 0,o=e.renderer?.clone(),l=e.multidimensionalSubset?.clone();let r;this.originalLayerSetting={subset:l,mosaicRule:s,definition:n,renderer:o},this.activeMultidimensionalDefinition=n.map((e=>e.clone())),e.multidimensionalSubset?.subsetDefinitions?.length&&(r=e.multidimensionalSubset,r.variables.some((e=>!this.multidimensionalInfo.variables.some((i=>i.name===e))))&&(e.multidimensionalSubset=null,this.originalLayerSetting.subset=void 0,r=void 0)),this.activeMultidimensionalSubset=r,this.updateCurrentVariableInfo(this.activeMultidimensionalDefinition),this.updateSliderSetting(),this.updateDisplayVariables(),this.dimensionSliderSetting?.showOnStartUp&&this.createDimensionalSliders(),!this.watchHandleLayer&&t&&(this.watchHandleLayer=e.watch("rasterFunction",(0,c.sg)(((i,t)=>{i?.functionName!==t?.functionName&&(0,a.g)(e).then((i=>{this.hasPropertyValueChanged(i,this.multidimensionalInfo)&&this.initLayer(e)}))}),100)))}apply(){const{multidimensionalInfo:e,originalLayerSetting:i}=this;if(!e||!i)return;i.definition=this.activeMultidimensionalDefinition.map((e=>e.clone())),i.subset=this.activeMultidimensionalSubset?.clone();const{layer:t}=this;this.isImageryLayer(t)&&(i.mosaicRule=t.mosaicRule?.clone()),this.arcgisSave.emit()}cancel(){const{multidimensionalInfo:e,originalLayerSetting:i,layer:t}=this;if(!e||!i)return;const n=i.definition?.map((e=>e.clone())),s=i.subset?.clone();this.pauseLayerUpdate=!0,this.activeMultidimensionalSubset=s,this.updateDisplayVariables();const a=n??this.getNewMultidimensionalDefinition(this.allVariables[0].name);this.updateCurrentVariableInfo(a),this.activeMultidimensionalDefinition=a,this.pauseLayerUpdate=!1,this.isImageryLayer(t)?t.mosaicRule=i.mosaicRule:t.multidimensionalDefinition=n,t.renderer=i.renderer,t.multidimensionalSubset=s,this.arcgisCancel.emit()}createDimensionalSliders(){this.destroyMdimSlider("both");const{dimensions:e}=this.currentVariableInfo,i=e.find((e=>(0,a.a)(e,!0)));this.createOrUpdateMdimSlider(i);const t=e.find((e=>!(0,a.a)(e,!0)));this.createOrUpdateMdimSlider(t)}createOrUpdateMdimSlider(e){if(!e||!this.showDimensionSliderControls)return;const i=(0,a.a)(e,!0),{values:t}=e,n=!t?.length||t.length<2,{mdimSliders:s}=this,o=i?s.time:s.z;if(n)return void this.destroyMdimSlider(i?"time":"z");const l=this.getDimensionValue(e,this.activeMultidimensionalDefinition);if(o)return o.dimensionInfo=e,void(o.dimensionValue=l);const{dimensionSliderSetting:r,view:d}=this,c=i?r?.timeContainer:r?.zContainer;if(!c&&!d?.ui)return;const f=i?r?.timeClassName:r?.zClassName,g=i?this.timeSliderSetting:this.zSliderSetting,{name:p}=e,{animatedDimensions:y}=this;i?y.time=p:y.z=p;const b=document.createElement("div");c&&(c.appendChild(b),i?s.outsideTimeContainer=b:s.outsideZContainer=b),(0,m.XX)(m.qy`<arcgis-imagery-dimension-slider class=${(0,u.CP)(f)} .sliderSetting=${g} .dimensionInfo=${e} .dimensionValue=${l} @arcgisChange=${e=>this.updateDefinitionDimensionValue(e.detail.dimensionName,e.detail.value)} ${(0,h.K)(i?this.createTimeRef:this.createZRef)}></arcgis-imagery-dimension-slider>`,b)}destroyMdimSlider(e){const{animatedDimensions:i,mdimSliders:t}=this;("time"===e||"both"===e)&&(t.time&&(t.time.remove(),t.time=void 0,t.outsideTimeContainer?.remove(),t.outsideTimeContainer=void 0,this.arcgisChange.emit({type:"slider-remove",dimensionType:"time",dimensionName:i.time})),i.time=""),("z"===e||"both"===e)&&(t.z&&(t.z.remove(),t.z=void 0,t.outsideZContainer?.remove(),t.outsideZContainer=void 0,this.arcgisChange.emit({type:"slider-remove",dimensionType:"z",dimensionName:i.z})),i.z="")}getMultidimensionalDefinition(e){const i=(0,a.c)(e);return i?.length?i:this.getNewMultidimensionalDefinition(this.allVariables[0].name)}getNewMultidimensionalDefinition(e){const i=this.getVariableInfo(e).dimensions??[],t=i.map((e=>e.name)),n=this.activeMultidimensionalDefinition,s=n.map((e=>e.clone())),l=n.map((e=>e.dimensionName));return 0===t.length?(s.forEach((i=>{i.variableName=e,i.dimensionName="",i.values=[],i.isSlice=!0})),s):l.length===t.length&&t.every((e=>l.includes(e)))?(s.forEach((t=>{t.variableName=e;const n=i.find((({name:e})=>e===t.dimensionName));(0,a.d)(t,n,this.activeMultidimensionalSubset)})),s):(s.length=0,i.forEach((i=>{let t=n.find((e=>e.dimensionName===i.name))?.clone();if(t)t.variableName=e;else{const n=(0,a.e)(i);t=new o.default({variableName:e,dimensionName:i.name,values:null==n?[]:[n],isSlice:!0})}(0,a.d)(t,i,this.activeMultidimensionalSubset),s.push(t)})),s)}getVariableInfo(e){const{variables:i}=this.multidimensionalInfo;return this.isDefaultUnspecifiedVariable(e)?i[0]:i.find((i=>i.name===e))??i[0]}hasNewVariable(e){return e.variables.some((e=>!this.rawMultidimensionalInfo.variables.some((i=>i.name===e.name))))}hasPropertyValueChanged(e,i){return JSON.stringify(e??void 0)!==JSON.stringify(i??void 0)}isDefaultUnspecifiedVariable(e){return["","*",this.messages.display.defaultVariable].includes(e)}isImageryLayer(e){return"imagery"===e.type}updateDefinitionDimensionValue(e,i,t=!1){const n=this.activeMultidimensionalDefinition.map((e=>e.clone())),s=n.find((({dimensionName:i})=>i===e));if(s&&(s.values=[i]),this.activeMultidimensionalDefinition=n,!t)return;const{mdimSliders:a}=this,o=a.time?.dimensionInfo.name===e?a.time:a.z?.dimensionInfo.name===e?a.z:null;o&&(o.dimensionValue=this.getDimensionValue(o.dimensionInfo,n))}getDimensionValue(e,i){return i.find((({dimensionName:i})=>i===e.name))?.values?.[0]}updateDefinitionVariableName(e){this.isDefaultUnspecifiedVariable(e)&&(e="");const i=this.getNewMultidimensionalDefinition(e);this.updateCurrentVariableInfo(i),this.activeMultidimensionalDefinition=i}updateMultidimensionalSubset(e){this.pauseLayerUpdate||this.updateLayerMultidimensionalSubset(e),this.activeMultidimensionalSubset=e,this.updateDisplayVariables();const{activeMultidimensionalDefinition:i}=this;let t=!1,n=i;if(e?.variables?.length&&i.length){const s=this.allVariables.filter((({name:i})=>e.variables.includes(i))).map((({name:e})=>e)),a=i[0].variableName,o=""===a||e.variables.includes(a)?a:s[0];n=this.getNewMultidimensionalDefinition(o),t=this.hasPropertyValueChanged(n,i)}if(this.updateCurrentVariableInfo(n),t&&(this.activeMultidimensionalDefinition=n),this.showDimensionSliderControls){const{dimensions:e}=this.currentVariableInfo,{time:i,z:t}=this.mdimSliders;if(i){const t=e.find((({name:e})=>e===i.dimensionInfo.name));this.createOrUpdateMdimSlider(t)}if(t){const i=e.find((({name:e})=>e===t.dimensionInfo.name));this.createOrUpdateMdimSlider(i)}}const s=t?n:i;this.arcgisChange.emit({type:"dimension-filter",multidimensionalSubset:e,multidimensionalDefinition:s})}updateCurrentVariableInfo(e){const i=e[0].variableName,t=this.getVariableInfo(i),n=t.dimensions.map((e=>(0,a.h)(e,this.activeMultidimensionalSubset)));this.currentVariableInfo={...t,dimensions:n}}updateSliderSetting(){const{dimensionSliderSetting:e}=this;if(!e)return;const{playRate:i=-1}=e,t=i<=0?this.isImageryLayer(this.layer)?3e3:2e3:i;this.timeSliderSetting={playRate:t,tooltipPlacement:e.timeTooltipPlacement??"top",hideThumbTooltip:e.hideThumbTooltip},this.zSliderSetting={playRate:t,tooltipPlacement:e.zTooltipPlacement??"left",heightThresholdForCompactZ:e.heightThresholdForCompactZ,hideThumbTooltip:e.hideThumbTooltip};const{mdimSliders:n}=this;n.time&&(n.time.sliderSetting=this.timeSliderSetting),n.z&&(n.z.sliderSetting=this.zSliderSetting)}updateDisplayVariables(){const e=this.activeMultidimensionalSubset?.variables,i=e?.length?this.allVariables.filter((({name:i})=>e.includes(i))):[...this.allVariables],{layer:t,messages:n}=this;if(this.isImageryLayer(t)){const{rasterFunction:e,version:s}=t;e&&"none"!==e.functionName?.toLowerCase()&&s<=a.m&&i.unshift({...i[0],name:n.display.defaultVariable,label:n.display.defaultVariable})}this.displayVariables=i.map((({name:e,label:i})=>({value:e,label:i})))}render(){const{closable:e,hideButtons:i,panelHeading:t,showExtentSection:n,messages:s}=this,a=!this.layer?.loaded,o=t??s.title,l=!a&&null!=this.multidimensionalInfo;return m.qy`<calcite-panel .loading=${a} .heading=${o} class="panel" ${(0,h.K)(this.refPanelNode)}>${e&&this.renderClose()||""}${!a&&!l&&m.qy`<div class="multidimensional-unsupported">${s.general.unsupported}</div>`||""}${l&&n&&this.renderExtent()||""}${l&&this.renderCurrentDisplay()||""}${!i&&this.renderDoneButton()||""}${!i&&this.renderCancelButton()||""}</calcite-panel>`}renderCurrentDisplay(){const e=this.displayVariables,{layer:i}=this,t=this.isImageryLayer(i);let n=this.activeMultidimensionalDefinition[0].variableName;const{display:a}=this.messages;if(t&&""===n){const{rasterFunction:t}=i;t&&"none"!==t.functionName?.toLowerCase()&&(n=e.some((({value:e})=>"*"===e))||this.hasNewVariable(this.multidimensionalInfo)?e[0].value:a.defaultVariable)}const o=e.findIndex((({value:e})=>e===n)),l="wcs"===i.type?"none":i.rasterFunction?.functionName??"none",r=`${i.url}-${l}`;n===a.defaultVariable&&(n="");const{currentVariableInfo:d}=this,c=this.el.getBoundingClientRect().top;return m.qy`<calcite-block .heading=${a.current} collapsible open><div><calcite-label>${a.variable}${(0,s.D)(r,m.qy`<arcgis-imagery-lazy-loading-select .selectedIndex=${-1===o?0:o} .list=${e} .messages=${this.selectMessages} @arcgisChange=${e=>{e.stopPropagation();const i=e.detail.selectedValue;this.updateDefinitionVariableName(i)}} .containerTop=${c}></arcgis-imagery-lazy-loading-select>`)}</calcite-label></div>${d.dimensions.map((e=>this.renderDimension(e)))}</calcite-block>`}renderExtent(){return m.qy`<arcgis-imagery-multidimensional-subset .multidimensionalInfo=${this.multidimensionalInfo} .multidimensionalSubset=${this.activeMultidimensionalSubset} .view=${this.view} .showAreaOfInterest=${this.showAreaOfInterest} collapse-extent-section .showFilterLength=${this.allVariables[0].description?5:10} .messages=${this.messages} @arcgisChange=${e=>this.updateMultidimensionalSubset(e.detail.subset)}></arcgis-imagery-multidimensional-subset>`}renderDimensionList(e){const{name:i}=e,t=this.activeMultidimensionalDefinition.find((e=>e.dimensionName===i)),{isDimensionListSortable:n}=this,s=!n||"descending"!==this.sortDirections[i],a=this.el.getBoundingClientRect().top,o=t?.values?.[0]??e.values?.[0];return(0,r.D)({dimensionInfo:e,selectedValue:o,sortable:n,updateSorting:this.updateSorting,isAscending:s,className:"dimension-select-container",onChange:e=>this.updateDefinitionDimensionValue(i,e,!0),messages:this.messages,selectMessages:this.selectMessages,containerTop:a})}renderDimension(e){const i=this.renderDimensionList(e),t=(0,a.a)(e,!0),n=t?"time":"z",s=!e.values||e.values.length<2,{display:o}=this.messages,l="StdTime"===e.name?o.stdTimeDimension:"StdZ"===e.name?o.stdZDimension:o.generalDimension.replace("${dimensionName}",e.name);return this.showDimensionSliderControls?m.qy`<div class="dimension-zone"><calcite-label>${l}</calcite-label><calcite-label>${o.defaultPosition}${i}</calcite-label>${!s&&m.qy`<calcite-label layout=inline><calcite-switch scale=s .checked=${this.animatedDimensions[n]===e.name} .label=${o.showDimensionSlider} @calciteSwitchChange=${i=>{i.target.checked?this.createOrUpdateMdimSlider(e):this.destroyMdimSlider(t?"time":"z")}}></calcite-switch>${o.showDimensionSlider}</calcite-label>`||""}</div>`:m.qy`<div><calcite-label>${l}${i}</calcite-label></div>`}renderClose(){return m.qy`<calcite-action .text=${this.messages.general.close} icon=x slot=header-actions-end @click=${this.cancel} ${(0,h.K)(this.refCloseButtonNode)}></calcite-action>`}renderDoneButton(){const{done:e}=this.messages.general;return m.qy`<calcite-button slot=footer @click=${this.apply} appearance=solid width=half .label=${e}>${e}</calcite-button>`}renderCancelButton(){const{cancel:e}=this.messages.general;return m.qy`<calcite-button slot=footer @click=${this.cancel} appearance=outline-fill width=half .label=${e}>${e}</calcite-button>`}}(0,n.c)("arcgis-imagery-multidimensional-filter",g)},9619:(e,i,t)=>{t.d(i,{D:()=>o});var n=t(7513),s=t(3715),a=t(5987);const o=(0,s.u$)(class extends s.WL{constructor(){super(...arguments),this.key=n.s6}render(e,i){return this.key=e,i}update(e,[i,t]){return i!==this.key&&((0,a.mY)(e),this.key=i),t}})}}]);