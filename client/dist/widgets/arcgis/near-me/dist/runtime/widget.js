/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-arcgis","jimu-core","jimu-ui","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel","esri/Color","esri/symbols/support/jsonUtils","esri/core/reactiveUtils","esri/geometry/SpatialReference","esri/rest/locator","esri/geometry/Polygon","esri/widgets/Features","esri/geometry/operators/unionOperator","esri/geometry/operators/equalsOperator","esri/geometry/operators/intersectionOperator","esri/geometry/operators/geodeticAreaOperator","esri/geometry/operators/areaOperator","esri/geometry/operators/geodeticLengthOperator","esri/geometry/operators/geodesicProximityOperator","esri/geometry/operators/lengthOperator","esri/widgets/FeatureForm","esri/layers/FeatureLayer","jimu-core/react","jimu-theme","esri/core/workers/workers"],(function(e,t){var s={},i={},a={},o={},n={},r={},l={},d={},c={},u={},h={},p={},g={},y={},m={},f={},v={},b={},S={},w={},x={},I={},A={},D={},F={},C={};return{setters:[function(e){s.JimuMapViewComponent=e.JimuMapViewComponent,s.MapViewManager=e.MapViewManager,s.geometryUtils=e.geometryUtils,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.BaseWidget=e.BaseWidget,i.CONSTANTS=e.CONSTANTS,i.DataActionManager=e.DataActionManager,i.DataLevel=e.DataLevel,i.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.DataSourceTypes=e.DataSourceTypes,i.ExpressionResolverComponent=e.ExpressionResolverComponent,i.Immutable=e.Immutable,i.JimuFieldType=e.JimuFieldType,i.MessageManager=e.MessageManager,i.MessageType=e.MessageType,i.MultipleDataSourceComponent=e.MultipleDataSourceComponent,i.MutableStoreManager=e.MutableStoreManager,i.OrderRule=e.OrderRule,i.React=e.React,i.ReactResizeDetector=e.ReactResizeDetector,i.UrlManager=e.UrlManager,i.WidgetState=e.WidgetState,i.WidgetVersionManager=e.WidgetVersionManager,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.defaultMessages=e.defaultMessages,i.geometryUtils=e.geometryUtils,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,i.lodash=e.lodash,i.urlUtils=e.urlUtils,i.utils=e.utils},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Collapse=e.Collapse,a.ConfirmDialog=e.ConfirmDialog,a.Dropdown=e.Dropdown,a.DropdownButton=e.DropdownButton,a.DropdownItem=e.DropdownItem,a.DropdownMenu=e.DropdownMenu,a.Icon=e.Icon,a.Label=e.Label,a.Loading=e.Loading,a.LoadingType=e.LoadingType,a.NumericInput=e.NumericInput,a.Option=e.Option,a.Row=e.Row,a.Select=e.Select,a.Switch=e.Switch,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.WidgetPlaceholder=e.WidgetPlaceholder,a.defaultMessages=e.defaultMessages,a.richTextUtils=e.richTextUtils},function(e){o.default=e.default},function(e){n.default=e.default},function(e){r.default=e.default},function(e){l.default=e.default},function(e){d.fromJSON=e.fromJSON},function(e){c.watch=e.watch,c.when=e.when},function(e){u.default=e.default},function(e){h.locationToAddress=e.locationToAddress},function(e){p.default=e.default},function(e){g.default=e.default},function(e){y.executeMany=e.executeMany},function(e){m.execute=e.execute},function(e){f.execute=e.execute},function(e){v.execute=e.execute,v.isLoaded=e.isLoaded,v.load=e.load},function(e){b.execute=e.execute},function(e){S.execute=e.execute,S.isLoaded=e.isLoaded,S.load=e.load},function(e){w.isLoaded=e.isLoaded,w.load=e.load},function(e){x.execute=e.execute},function(e){I.default=e.default},function(e){A.default=e.default},function(e){D.default=e.default},function(e){F.colorUtils=e.colorUtils,F.getAppThemeVariables=e.getAppThemeVariables},function(e){C.default=e.default}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=F},8968:e=>{"use strict";e.exports=d},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},10624:e=>{"use strict";e.exports=r},11092:e=>{"use strict";e.exports=C},14321:e=>{"use strict";e.exports=a},15710:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.086 2H3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V4.914zM3 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4.914a1 1 0 0 0-.293-.707l-2.914-2.914A1 1 0 0 0 11.086 1zm6.875 3H4v2h5.875zM4 3a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h5.875a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm6.048 7.5a1.548 1.548 0 1 1-3.096 0 1.548 1.548 0 0 1 3.096 0M8.5 13a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5" clip-rule="evenodd"></path></svg>'},18717:e=>{"use strict";e.exports=v},20320:e=>{"use strict";e.exports=h},21625:e=>{"use strict";e.exports=y},21935:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.986 1a6.99 6.99 0 0 1 5.723 2.969l-2.551-.938a.5.5 0 1 0-.345.938l4.228 1.555.163-.944.013-.005-.009-.019.6-3.471a.5.5 0 1 0-.985-.17l-.403 2.33A8 8 0 0 0 0 7.5c-.016.277.21.501.486.501a.53.53 0 0 0 .517-.5A7 7 0 0 1 7.986 1M8.015 15a6.99 6.99 0 0 1-5.724-2.969l2.551.938a.497.497 0 0 0 .642-.296.5.5 0 0 0-.297-.642L.96 10.476l-.163.944-.013.005.009.019-.6 3.471a.5.5 0 1 0 .985.17l.403-2.33A8 8 0 0 0 16 8.5a.477.477 0 0 0-.485-.501.53.53 0 0 0-.518.5A7 7 0 0 1 8.015 15"></path></svg>'},22089:e=>{"use strict";e.exports=o},23938:e=>{"use strict";e.exports=g},24883:e=>{"use strict";e.exports=f},27442:e=>{"use strict";e.exports=l},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},31526:e=>{"use strict";e.exports=p},33142:e=>{"use strict";e.exports=w},37568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},42588:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 4.429V15h14V1L6.833 7.857zM14 3v11H2V6.114l4.182 2.51a1.2 1.2 0 0 0 1.398-.118z" clip-rule="evenodd"></path></svg>'},42735:e=>{"use strict";e.exports=m},43751:e=>{"use strict";e.exports=b},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},46420:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M6.973 11.484c0 .285.236.516.527.516a.52.52 0 0 0 .527-.516V1.976L10.6 4.473c.206.202.54.202.746 0a.51.51 0 0 0 0-.73L7.5 0 3.654 3.743a.51.51 0 0 0 0 .73c.206.202.54.202.746 0l2.573-2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},46942:(e,t)=>{var s;!function(){"use strict";var i={}.hasOwnProperty;function a(){for(var e="",t=0;t<arguments.length;t++){var s=arguments[t];s&&(e=n(e,o(s)))}return e}function o(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return a.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var s in e)i.call(e,s)&&e[s]&&(t=n(t,s));return t}function n(e,t){return t?e?e+" "+t:e+t:e}e.exports?(a.default=a,e.exports=a):void 0===(s=function(){return a}.apply(t,[]))||(e.exports=s)}()},52349:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><g fill="#000" clip-path="url(#a)"><path fill-rule="evenodd" d="M10 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m0-1a1 1 0 1 0 0-2 1 1 0 0 0 0 2" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M5 4.988c0 1.997 2.955 5.636 4.344 7.25l.068.08c.212.245.383.438.494.563l.1.113L10 13c.065.065.062.06.005-.006.04-.042.292-.31.665-.731l.012-.014C12.05 10.697 15 7.105 15 4.989A4.994 4.994 0 0 0 10 0C7.239 0 5 2.233 5 4.988m5.029 6.49-.01.01a44 44 0 0 1-1.49-1.834c-.65-.85-1.302-1.781-1.786-2.65C6.236 6.093 6 5.402 6 4.987 6 2.788 7.789 1 10 1s4 1.788 4 3.988c0 .434-.213 1.098-.664 1.944-.434.816-1.026 1.685-1.635 2.493a37 37 0 0 1-1.672 2.052" clip-rule="evenodd"></path><path d="M0 14c0-2.273 2.107-4.251 5.213-5.269q.257.443.526.882c-.86.265-1.635.605-2.296 1.002C1.794 11.605 1 12.832 1 14s.794 2.396 2.443 3.385C5.073 18.363 7.39 19 10 19s4.927-.637 6.557-1.615C18.206 16.395 19 15.168 19 14s-.794-2.395-2.443-3.385a10.4 10.4 0 0 0-2.211-.976q.265-.438.517-.883C17.927 9.781 20 11.746 20 14c0 3.314-4.477 6-10 6S0 17.314 0 14"></path><path fill-rule="evenodd" d="M6 14.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m-1 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0M15.5 16a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3m0-1a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1M11.5 16.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m-1 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h20v20H0z"></path></clipPath></defs></svg>'},52943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},53205:e=>{"use strict";e.exports=u},57687:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><g fill="#000" clip-path="url(#a)"><path d="M8 16a8 8 0 0 0 3.425-.768 2 2 0 0 1-.4-.917 7 7 0 0 1-9.699-8.431 2 2 0 0 1-.855-.595A8 8 0 0 0 8 16M16 8a7.96 7.96 0 0 1-1.505 4.672 2 2 0 0 0-.83-.559A7 7 0 0 0 3.48 2.655a2 2 0 0 0-.875-.562A8 8 0 0 1 16 8M2 5a1 1 0 1 0 0-2 1 1 0 0 0 0 2"></path><path d="M11 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2"></path><path fill-rule="evenodd" d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4m1-2a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path><path d="M14 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0M8 13a5 5 0 0 0 4.643-6.86 2 2 0 0 1-.819.683 4 4 0 1 1-2.647-2.647c.15-.33.387-.614.682-.819A5 5 0 1 0 8 13"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'},59028:e=>{"use strict";e.exports=S},59620:e=>{"use strict";e.exports=n},62243:e=>{"use strict";e.exports=c},62686:e=>{"use strict";e.exports=s},66884:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1 1v14h14V1zm9.082 13c-.005-.037-.113-.274-.122-.309a1.5 1.5 0 0 0 .718-1.267 1.2 1.2 0 0 0-.053-.358c.152-.176.263-.383.326-.607q.046.003.093.003c.3.002.593-.091.836-.266q.06.066.126.124c.42.412.977.654 1.564.68H14v2h-3.918M14 11h-.43a1.46 1.46 0 0 1-.906-.433c-.264-.23-.258-.782-.617-.782-.482 0-.52.677-1.003.677-.219 0-.38-.177-.599-.177-.193 0-.445.102-.445.293v.502c0 .424-.506.508-.506.934 0 .171.184.236.184.41 0 .58-.893.502-.893 1.08 0 .191.215.305.215.486V14H6.375q.087-.243.09-.502c0-.547-1.043-.393-1.207-.72-.407-.813.693-1.022.693-1.673 0-.16-.082-.488-.334-.513-.351-.035-.443.154-.797.154a.406.406 0 0 1-.437-.36c0-.386.308-.566.308-.952 0-.25-.102-.393-.102-.643a.62.62 0 0 1 .59-.643c.323 0 .464.264.618.54a.64.64 0 0 0 .617.308c.49 0 .798-.61.798-.977a.47.47 0 0 1 .437-.488c.347 0 .476.36.824.36.57 0 .55-.756 1.053-1.03.618-.332.438-1.052.36-1.44-.032-.169.29-.5.464-.487.72.05.412-.54.412-.823q0-.073.022-.142c.111-.332.595-.438.595-.836 0-.281-.233-.41-.233-.693a.65.65 0 0 1 .22-.44H14zM2 14V2h8.278c-.013.077-.132.356-.132.44 0 .194.038.387.112.567a1.6 1.6 0 0 0-.422.643 1.4 1.4 0 0 0-.074.442 1.7 1.7 0 0 0-.536.43 1.32 1.32 0 0 0-.32 1.091q.046.205.066.414a2 2 0 0 0-.649.67 1.46 1.46 0 0 0-.674-.166 1.45 1.45 0 0 0-1.383 1.086 1.44 1.44 0 0 0-1.086-.469 1.62 1.62 0 0 0-1.591 1.643c0 .254.113.293.084.574s-.29.535-.29 1.022a1.37 1.37 0 0 0 .984 1.29 1.58 1.58 0 0 0-.003 1.549c.143.286.636.774.534.774z"></path></svg>'},68269:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M10 2a2 2 0 1 0-4 0H5v2h6V2z"></path><path fill="#000" d="M2 3h2v1H3v11h10V4h-1V3h2v13H2z"></path><path fill="#000" d="M12 6v1H4V6zM4 9v1h8V9zM12 12v1H4v-1z"></path></svg>'},68972:e=>{"use strict";e.exports=D},71082:e=>{"use strict";e.exports=x},73387:e=>{"use strict";e.exports=I},74919:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7 2h2a2 2 0 0 1 2 2v7.817l-3 2.812-3-2.812V4a2 2 0 0 1 2-2m5 2v8.25L8 16l-4-3.75V4a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3M9 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},85633:e=>{"use strict";e.exports=A},86058:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.582 5 11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2z"></path></svg>'},86823:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M3.5 7a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m0-1a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5M7 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-1 0a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-1 0a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0M16 3.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0m-1 0a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0" clip-rule="evenodd"></path></svg>'},96807:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><g fill="#000" clip-path="url(#a)"><path fill-rule="evenodd" d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4m1-2a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path><path d="M12 8a4 4 0 1 1-2.655-3.768c.183-.31.432-.578.727-.784a5 5 0 1 0 2.905 4.07c-.286.209-.617.359-.977.432z"></path><path d="M11.5 7a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"></path><path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-1 0A7 7 0 1 1 1 8a7 7 0 0 1 14 0" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"></path></clipPath></defs></svg>'}},t={};function L(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,L),a.exports}L.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return L.d(t,{a:t}),t},L.d=(e,t)=>{for(var s in t)L.o(t,s)&&!L.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},L.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),L.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},L.p="";var M={};return L.p=window.jimuConfig.baseUrl,(()=>{"use strict";L.r(M),L.d(M,{__set_webpack_public_path__:()=>Pt,default:()=>Rt});var e,t=L(62686),s=L(79244),i=L(14321);!function(e){e.Closest="closest",e.Proximity="proximity",e.Summary="summary"}(e||(e={}));const a={_widgetLabel:"Near Me",_action_locate_label:"Set location",mapLoadingMsg:"Please wait while the map is loading",meters:"Meters",metersAbbreviation:"m",feet:"Feet",feetAbbreviation:"ft",kilometers:"Kilometers",kilometersAbbreviation:"km",miles:"Miles",milesAbbreviation:"mi",yards:"Yards",yardsAbbreviation:"yd",bufferDistance:"Distance",closestAddress:"Input location",noDataMessageDefaultText:"No results found.",noValueForDisplayField:"No value",warningMsgIfNoLayersOnMap:"This map does not contain any feature layers. Select a map with at least one feature layer.",noAnalysisLayerMsg:"Analysis is not configured for layers in this map.",noClosestAddressMsg:"No address found at this location.",analysisTakingLongerMsg:"The analysis is taking longer than expected...",point:"Point",polyline:"Polyline",polygon:"Polygon",searchByActiveMapArea:"Search by map area",updateResultsLabel:"Update results",exportBtnTitle:"Export",exportToPdf:"Export to PDF",mergeRowsLabel:"Merge rows for groups and subgroups",mergeRowsTooltip:"Merge rows for each groups and sub groups to create row span when groups are configured",a3Portrait:"A3 Portrait",a3Landscape:"A3 Landscape",a4Portrait:"A4 Portrait",a4Landscape:"A4 Landscape",letterAnsiAPortrait:"Letter ANSI A Portrait",letterAnsiALandscape:"Letter ANSI A Landscape",tabloidAnsiBPortrait:"Tabloid ANSI B Portrait",tabloidAnsiBLandscape:"Tabloid ANSI B Landscape",areaOfInterestLabel:"Area of Interest (AOI) Information",aoiValueLabel:"Area: {areaValue}",dateValueLabel:"Date: {dateValue}",defaultReportTitle:"Near Me Report",reportDimensionsMsg:"This report is designed to be printed on {paperSize} Paper",unableToPrintMapMsg:"An error occurred while printing the map(s).",totalCountLabel:"{tableTitle} | Total count: {total}",closest:"Closest",proximity:"Proximity",summary:"Summary",closestApproxDistance:"Closest Approximate Distance",mapExtentChangeInfoMsg:"The current map extent has changed. Click Update results to update the analysis.",timeoutNoResultMessage:"The number of results exceeds the limit and cannot be displayed.",timeoutTryAgainMessage:"The number of results exceeds the limit. Try a smaller area and click Update results.",approximateDistance:"Approximate Distance",ariaLabelString:"{label} {formattedDist} {distUnit}",distanceUnitLabel:"{distanceLabel} {unitLabel}",summaryIntersectValueAndUnit:"{summaryIntersectValue} {unitLabel}",refreshTooltip:"Refresh",showMoreBtnTitle:"Show More",loadingText:"Analyzing...",promptTitleMessageFromDataAction:"Are you sure that you want to analyze all the features in {layerName}?",promptBottomMessageFromDataAction:"Results may not be immediate and could take a while.",okButtonLabel:"Proceed",queryAbortedMsg:"Query Aborted",stopQueryProgressMsg:"Querying features now...Click to stop the query progress",submit:"Submit",saveTooltip:"Save",saveInputLocationLabel:"Save input location to {layerName}",saveSearchAreaLabel:"Save search area to {layerName}",formSubmissionFailedMsg:"Form submission failed"};function o(e,t,i,a,o,n){const r=e.sys.color.surface.paper;return s.css`
  background-color: ${r};
    .widget-near-me {
      width: 100%;
      height: 100%;
      padding: ${n?"0":"5px"};
      overflow: auto;
    }

    .layerContainer {
      max-height: ${t};
      overflow: auto;
      width: 100%;
      padding: 8px
    }

    .layer-Container {
      margin-bottom: 10px;
    }

    .card {
      width: 96% !important;
      margin: auto;
      margin-bottom: 0.4rem !important;
    }

    .applyTextStyle {
      font-family: ${i.fontFamily};
      font-weight: ${i.fontBold?"bold":""};
      font-style: ${i.fontItalic?"italic":""};
      text-decoration: ${i.fontUnderline?"underline":""};
      text-decoration: ${i.fontStrike?"line-through":""};
      color: ${i.fontColor};
      font-size: ${i.fontSize};
      white-space: pre-wrap;
    }

    .applyPromptTextStyle {
      font-family: ${a.fontFamily};
      font-weight: ${a.fontBold?"bold":""};
      font-style: ${a.fontItalic?"italic":""};
      text-decoration: ${a.fontUnderline?"underline":""};
      text-decoration: ${a.fontStrike?"line-through":""};
      color: ${a.fontColor};
      font-size: ${a.fontSize};
      white-space: pre-wrap;
    }

    .headingLabelStyle {
      font-family: ${null==o?void 0:o.fontFamily};
      font-weight: ${(null==o?void 0:o.fontBold)?"bold":""};
      font-style: ${(null==o?void 0:o.fontItalic)?"italic":""};
      text-decoration: ${(null==o?void 0:o.fontUnderline)?"underline":""};
      text-decoration: ${(null==o?void 0:o.fontStrike)?"line-through":""};
      color: ${null==o?void 0:o.fontColor};
      font-size: ${null==o?void 0:o.fontSize};
      margin: 0 !important;
      white-space: pre-wrap;
    }

    .map-loading-text {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      text-align: center;
      transform: translate(-50%, 50%);
      font-size: var(--calcite-font-size--2);
      color: var(--calcite-color-text-1);
    }

    .loading-text {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      z-index: 3000;
      text-align: center;
      transform: translate(-50%, 50%);
      font-size: var(--calcite-font-size--2);
      color: var(--calcite-color-text-1);
    }

    .cancel-button-pos {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, 40px);
    }

    .main-row {
      display: ${n?"none":""}
    }
  `}function n(e,t){return s.css`
    .main-row {
      flex-wrap: wrap;
      display: flex;
    }

    .closestAddressheadingLabel {
      margin: 0 !important;
      font-weight: 500;
    }

    .locate-incident {
      min-width: 140px;
      width: ${t?"50%":"100%"};
    }

    .buffer-distance {
      min-width: 140px;
      width: ${t?"50%":"100%"};
      align-items: center;
    }

    .hidden {
      display: none;
    }
  `}var r=L(30655),l=L.n(r),d=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const c=e=>{const t=window.SVG,{className:i}=e,a=d(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:l()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var u=L(52943),h=L.n(u),p=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const g=e=>{const t=window.SVG,{className:i}=e,a=p(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:h()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var y=L(46420),m=L.n(y),f=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const v=e=>{const t=window.SVG,{className:i}=e,a=f(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:m()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var b=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};const S=e=>s.DataSourceManager.getInstance().getDataSource(e);var w;!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(w||(w={}));const x=e=>{switch(e){case"feet":return w.Feet;case"miles":return w.Miles;case"kilometers":return w.Kilometers;case"meters":return w.Meters;case"yards":return w.Yards;default:return 1e3}},I=e=>{let i=null;const a=[];let o=!1;const n=t.MapViewManager.getInstance().getJimuMapViewById(e).getAllJimuLayerViews();return null==n||n.forEach((e=>{if(i=S(e.layerDataSourceId),i)if((null==i?void 0:i.type)===s.DataSourceTypes.MapService||(null==i?void 0:i.type)===s.DataSourceTypes.GroupLayer||(null==i?void 0:i.type)===s.DataSourceTypes.SubtypeGroupLayer){const e=t=>{t.getChildDataSources().forEach((t=>{(null==t?void 0:t.type)===s.DataSourceTypes.MapService||(null==t?void 0:t.type)===s.DataSourceTypes.GroupLayer||(null==t?void 0:t.type)===s.DataSourceTypes.SubtypeGroupLayer?e(t):(null==t?void 0:t.type)!==s.DataSourceTypes.FeatureLayer&&(null==t?void 0:t.type)!==s.DataSourceTypes.SubtypeSublayer||a.push(t)}))};e(i)}else if((null==i?void 0:i.type)===s.DataSourceTypes.FeatureLayer||(null==i?void 0:i.type)===s.DataSourceTypes.SubtypeSublayer)if(a.length>0){a.find((e=>e.id===i.id))||(o=!0),o&&a.push(i)}else a.push(i)})),a},A=(e,t)=>{let s=e;return"string"==typeof s&&(s=s.trim()),[null,void 0,""].includes(s)?t:s},D=()=>{const e=(0,s.getAppStore)().getState().portalSelf;return"english"===(null==e?void 0:e.units)?"miles":"kilometers"},F=e=>{const t={searchByLocation:!1,searchCurrentExtent:!1,showAllFeatures:!1};if(e){const{searchByActiveMapArea:s,includeFeaturesOutsideMapArea:i}=e;s?i?t.showAllFeatures=!0:t.searchCurrentExtent=!0:t.searchByLocation=!0}return t},C=(e,t,s)=>`${e}_output_${t}_${s}`,T=(e,t)=>b(void 0,void 0,void 0,(function*(){const i=yield(0,s.loadArcGISJSAPIModule)("esri/symbols/support/symbolUtils");i.getDisplayedSymbol(e.feature).then((s=>b(void 0,void 0,void 0,(function*(){var a,o;s.size>23&&s.set("size",23),"esriGeometryPoint"===(null===(a=e.dataSource)||void 0===a?void 0:a.getGeometryType())&&(s.height||s.width)&&(s.height<15&&s.set("height",15),s.width<15&&s.set("width",15));const n=document.createElement("div");if(n.className="w-100 h-100 d-flex justify-content-center align-items-center",yield i.renderPreviewHTML(s,{node:n}),t.current.innerHTML&&(t.current.innerHTML=""),null===(o=n.children)||void 0===o?void 0:o.length){const e=n.children[0];if(e){const s=Number(e.getAttribute("height")),i=Number(e.getAttribute("width"));i>30&&e.setAttribute("width","30"),e.setAttribute("viewBox",`0 0 ${i} ${s}`),t.current.appendChild(n)}}}))))})),j=e=>{const t=S(e),s=t&&t.getSchema(),i=(null==s?void 0:s.fields)?Object.values(null==s?void 0:s.fields):[],a=[];return i&&i.length>0&&i.forEach((e=>{a.push(e.jimuName)})),a};var O=L(46942),R=L.n(O),P=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};class E extends s.React.PureComponent{constructor(t){var o;super(t),this.layerData=[],this.dropdownRef=s.React.createRef(),this.nls=e=>{var t;const s=Object.assign({},a);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>P(this,void 0,void 0,(function*(){this.updateLayerLabelWidth(),this.props.displayMapSymbol&&T(this.props.selectedRecord,this.symbolRef),this.props.showExportButton&&(yield new Promise((e=>setTimeout(e,1e3))),yield this.buildExportOptions())})),this.buildDataSetArray=()=>P(this,void 0,void 0,(function*(){const t=C(this.props.widgetId,this.props.analysisType,this.props.analysisId),i=s.DataSourceManager.getInstance().getDataSource(t);if(this.props.analysisType===e.Summary){if(this.props.dsId){const e=s.DataSourceManager.getInstance(),t={returnGeometry:!0,outFields:["*"],where:"1=1"},a=yield i.queryAll(t),o=yield e.createDataSource((0,s.Immutable)({id:"downloadCsv_layer"+(new Date).getTime(),type:s.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,schema:i.getSchema(),label:i.getLabel()})),n=Object.assign(o.getDataSourceJson());s.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(o,(0,s.Immutable)(Object.assign(Object.assign({},n),{exportOptions:i.getExportOptions()}))),o.setSourceRecords(a.records);const r={records:a.records,dataSource:o,name:i.getLabel()};this.pushUniqueDataSet(r);const l=this.props.records[0].dataSource;this.pushUniqueDataSet({records:this.props.records,dataSource:l,name:l.getLabel(),fields:this.getFieldsToExport(this.props.analysisId)})}}else if(this.props.analysisType===e.Closest){const e={returnGeometry:!0,outFields:["*"],where:"1=1"},t=yield i.queryAll(e);this.pushUniqueDataSet({records:t.records,dataSource:i,name:i.getLabel()})}else this.pushUniqueDataSet({records:this.props.records,dataSource:i,name:i.getLabel()})})),this.pushUniqueDataSet=e=>{!this.dataSet.some((t=>t.dataSource.id===e.dataSource.id))&&this.dataSet.push(e)},this.componentDidUpdate=e=>{e.analysisIcon===this.props.analysisIcon&&e.featureCount===this.props.featureCount||this.setState({displayAnalysisIcon:!!this.props.analysisIcon,displayFeatureCount:!!this.props.featureCount},(()=>{this.updateLayerLabelWidth()})),this.props.displayMapSymbol&&e.selectedRecord!==this.props.selectedRecord&&T(this.props.selectedRecord,this.symbolRef)},this.updateLayerLabelWidth=()=>{let e;this.props.isListView?(this.state.displayAnalysisIcon&&this.state.displayFeatureCount?e=130:this.state.displayAnalysisIcon||this.state.displayFeatureCount?this.state.displayAnalysisIcon&&!this.state.displayFeatureCount?e=80:!this.state.displayAnalysisIcon&&this.state.displayFeatureCount&&(e=100):e=50,this.state.showExportButton||(e-=24),this.setState({layerLabelWidth:"calc(100% - "+e+"px)"})):this.state.displayFeatureCount?this.setState({layerLabelWidth:"calc(100% - 64px) !important"}):this.setState({layerLabelWidth:"calc(100% - 24px) !important"})},this.onToggleSelectedLayer=()=>{this.props.canToggle&&this.setState({isFeatureLayerOpen:!this.state.isFeatureLayerOpen,isIconDown:!this.state.isIconDown},(()=>{this.props.onToggle&&this.props.onToggle(this.props.index,this.state.isFeatureLayerOpen)}))},this.handleFeaturesToShow=()=>{const e=this.state.start+20;let t=this.props.children;return this.canShowMoreFeatures&&(t=this.props.children.slice(0,e),e>=this.props.children.length&&(this.canShowMoreFeatures=!1)),t},this.renderIndividualExportList=()=>{var e;const t=s.css`
       padding-top: 7px!important;
      `,a=s.css`
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          position: absolute;
          width: 60%;
          height: 60%;
          top: 20%;
          left: 20%;
          border: 2px solid var(--sys-color-secondary-light);
          border-radius: 50%;
          border-top: 2px solid var(--sys-color-primary-main);
          box-sizing: border-box;
          animation:loading 2s infinite linear;
        `;return(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(i.Dropdown,{className:"float-right",direction:"down",size:"sm",title:this.nls("exportBtnTitle"),useKeyUpEvent:!0,toggle:this.onIndividualExportToggle,isOpen:this.state.showExportOptions},(0,s.jsx)(i.DropdownButton,{size:"sm",arrow:!1,css:t,icon:!0,ref:this.dropdownRef,className:"data-action-button",onClick:this.onIndividualExportToggle,type:"tertiary","aria-label":this.nls("exportBtnTitle")},!this.state.isDropDownLoading&&(0,s.jsx)(v,{size:"m",title:this.nls("exportBtnTitle")}),this.state.isDropDownLoading&&(0,s.jsx)("div",{css:a})),(0,s.jsx)(i.DropdownMenu,null,(null===(e=this.state.actionNames)||void 0===e?void 0:e.length)>0&&this.state.actionNames.map((e=>this.createActionItem(this.state.actionNamesGroups,e,s.DataLevel.Records))))),this.state.actionElement)},this.onActionItemClick=(t,i)=>P(this,void 0,void 0,(function*(){const a="active-data-action-item",o=document.querySelector(`.${a}`);o&&o.classList.remove(a),this.dropdownRef.current.className=R()(this.dropdownRef.current.className,a);let n=null,r=this.dataSet;if("export-csv"===t.id&&this.props.analysisType===e.Proximity){const e=C(this.props.widgetId,this.props.analysisType,this.props.analysisId)+"_Count",t=s.DataSourceManager.getInstance().getDataSource(e),i={returnGeometry:!0,outFields:["*"],where:"1=1"},a={records:(yield t.queryAll(i)).records,dataSource:t,name:t.getLabel()};r=[...r,a]}n=yield s.DataActionManager.getInstance().executeDataAction(t,r,i,this.props.widgetId),null!==n&&"boolean"!=typeof n&&this.setState({actionElement:s.React.cloneElement(n,{onClose:()=>{this.setState({actionElement:null})},onConfirm:(...e)=>(!n.props.keepOpenAfterConfirm&&this.setState({actionElement:null}),n.props.onConfirm(...e))})}),this.setState({showExportOptions:!1})})),this.createActionItem=(e,t,a)=>{const o=e[t];return"export"===t&&(null==o?void 0:o.length)>0&&o.length>0?(0,s.jsx)(s.React.Fragment,{key:"exportAction"},o.map(((e,t)=>{var o;let n=e.label;if(e.widgetId){const t=(0,s.getAppStore)().getState().appConfig.widgets[e.widgetId];n=null!==(o=null==t?void 0:t.label)&&void 0!==o?o:e.label}return(0,s.jsx)(i.DropdownItem,{key:t,header:!1,onClick:()=>{this.onActionItemClick(e,a)}},n)}))):null},this.getAvailableActions=()=>P(this,void 0,void 0,(function*(){let e=null;return e=s.DataActionManager.getInstance().getSupportedActions(this.props.widgetId,this.dataSet,s.DataLevel.Records),Promise.all([e||{}])})),this.buildExportOptions=()=>P(this,void 0,void 0,(function*(){var e;this.setState({isDropDownLoading:!0});try{0===this.dataSet.length&&(yield this.buildDataSetArray());const[t]=yield this.getAvailableActions(),s=Object.keys(t);this.setState({showExportButton:null===(e=t.export)||void 0===e?void 0:e.length,actionNames:s,actionNamesGroups:t,isDropDownLoading:!1})}catch(e){console.error(e),this.setState({actionNamesGroups:{},isDropDownLoading:!1})}})),this.onIndividualExportToggle=e=>{null==e||e.stopPropagation(),this.setState({showExportOptions:!this.state.showExportOptions})},this.getFieldsToExport=e=>{var t;let s=[];const i=null===(t=this.props.analysisSettings)||void 0===t?void 0:t.layersInfo,{searchByLocation:a}=F(this.props.searchSettings);return i.forEach((t=>{var i;if(t.analysisInfo.analysisId===e)if((null===(i=t.analysisInfo.fieldsToExport)||void 0===i?void 0:i.length)>0){const e=[...t.analysisInfo.fieldsToExport];!a&&t.analysisInfo.fieldsToExport.includes("esriCTApproxDistance")&&e.splice(t.analysisInfo.fieldsToExport.indexOf("esriCTApproxDistance"),1),s=e}else s=j(t.useDataSource.dataSourceId)})),s},this.symbolRef=s.React.createRef(),this.canShowMoreFeatures=this.props.canShowMoreFeatures,this.dataSet=[],this.state={isFeatureLayerOpen:this.props.isExpanded,isIconDown:!this.props.isExpanded,label:null===(o=this.props)||void 0===o?void 0:o.label,layerLabelWidth:"",displayAnalysisIcon:!!this.props.analysisIcon,displayFeatureCount:!!this.props.featureCount,showExportButton:!1,start:0,actionNames:[],actionNamesGroups:{},isDropDownLoading:!1,actionElement:null,showExportOptions:!1}}render(){let e=(this.props.theme,t=this.state.layerLabelWidth,a=this.props.canToggle,s.css`
  .layer-title-Container {
    display: inline-flex;
    -webkit-box-align: baseline;
    align-items: center;
    width: 100%;
    cursor: ${a?"pointer":"default"};
    justify-content: space-between;
  }

  .icon {
    margin-left: 10px;
    width: 20px;
  }

  .layer-title {
    width:  ${t};
    padding: 10px 2px 10px 8px;
    font-weight: 500;
    margin-top: 2px;
  }

  .export-button .icon-btn-sizer{
    padding: 0 5px;
  }

  .count {
    width: 80px;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: auto;
    text-align: center;
    cursor: ${a?"pointer":"default"};
    font-weight: bold;
    padding-top: 3px;
  }

  .layer-title-label {
    width: 100%;
    margin: 0;
    cursor: ${a?"pointer":"default"};
    padding-top: 1px;
  }

  .row {
    margin-left: 0px;
    margin-right: 0px;
  }

  .toggle-button {
    visibility: ${a?"visible":"hidden"};
  }

  .show-more-button {
    display: grid;
  }

  .nm-border-top-color {
    border-top: 1px solid #d5d5d5;
  }
  `);var t,a;this.props.isListView||(e=function(e,t){return s.css`

  .layer-title-Container {
    display: inline-flex;
    -webkit-box-align: baseline;
    align-items: center;
    cursor: pointer;
    padding: 5px 5px 5px 0;
  }

  .card {
    width: 90% !important;
    margin: auto;
  }

  .icon {
    margin-left: 10px;
    width: 20px;
  }

  .layer-title {
    width: ${t};
    padding: 5px 2px 5px 10px;
    font-weight: 500;
    margin-top: 2px;
  }

  .count {
    width: 80px;
    overflow: hidden;
    text-overflow: ellipsis;
    margin: auto;
    text-align: center;
    cursor: pointer;
    font-weight: bold;
    padding-top: 3px;
  }

  .layer-title-label {
    width: 100%;
    margin: 0;
    cursor: pointer;
    padding-top: 1px;
  }

  .row {
    margin-left: 0px;
    margin-right: 0px;
  }

  .layer-title-map-symbol {
    margin-left: 10px;
    width: 25px;
  }

  .nm-border-top-color {
    border-top: 1px solid #d5d5d5;
  }
  `}(this.props.theme,this.state.layerLabelWidth));const o=this.handleFeaturesToShow(),n=A(this.props.label,this.nls("noValueForDisplayField")),r=this.props.intl.formatNumber(this.props.featureCount,{maximumFractionDigits:0});return(0,s.jsx)("div",{css:e,style:{border:this.props.isListView?"":"1px solid #d5d5d5"},className:this.props.isListView?"layer-Container shadow py-1 w-100":"layer-Container py-0 w-100 card rounded-sm"},(0,s.jsx)(i.Row,{flow:"wrap"},(0,s.jsx)("div",Object.assign({tabIndex:0,className:"layer-title-Container",onClick:this.onToggleSelectedLayer.bind(this),"aria-label":this.props.label,role:"button"},this.props.canToggle&&{"aria-expanded":this.state.isFeatureLayerOpen},{onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onToggleSelectedLayer()}}),this.props.displayMapSymbol&&(0,s.jsx)("div",{className:"layer-title-map-symbol",ref:this.symbolRef}),this.state.displayAnalysisIcon&&(0,s.jsx)("div",{className:"icon"},(0,s.jsx)(i.Icon,{size:"m",icon:this.props.analysisIcon})),(0,s.jsx)("div",{className:"layer-title"},(0,s.jsx)(i.Label,{className:"layer-title-label text-break",title:n},n)),this.props.isListView&&this.state.showExportButton&&this.renderIndividualExportList(),this.state.displayFeatureCount&&(0,s.jsx)(i.Label,{className:"count mx-0",title:r},r),(0,s.jsx)(i.Button,{tabIndex:-1,type:"tertiary",className:"toggle-button p-0",icon:!0,"aria-label":this.props.label},this.state.isIconDown&&(0,s.jsx)(g,{size:"m",autoFlip:!0}),!this.state.isIconDown&&(0,s.jsx)(c,{size:"m"})))),(0,s.jsx)(i.Collapse,{isOpen:this.state.isFeatureLayerOpen,className:"w-100"},o,this.canShowMoreFeatures&&(0,s.jsx)("div",{className:"show-more-button p-1 nm-border-top-color"},(0,s.jsx)(i.Button,{type:"secondary",title:this.nls("showMoreBtnTitle"),onClick:()=>{this.setState({start:o.length})}},this.nls("showMoreBtnTitle")))))}}var B=L(22089),k=L(74919),V=L.n(k),G=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const N=e=>{const t=window.SVG,{className:i}=e,a=G(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:V()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var U=L(86058),z=L.n(U),W=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const _=e=>{const t=window.SVG,{className:i}=e,a=W(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:z()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var H=L(42588),J=L.n(H),$=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const q=e=>{const t=window.SVG,{className:i}=e,a=$(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:J()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var Z=L(59620),Q=L(66884),K=L.n(Q),X=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Y=e=>{const t=window.SVG,{className:i}=e,a=X(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:K()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var ee=L(10624),te=L(27442),se=L(8968);const ie=(e,t)=>{var s;switch(t||(t="#00FFFF"),null===(s=null==e?void 0:e.geometry)||void 0===s?void 0:s.type){case"point":return ae(e,t);case"polyline":return ne(e,t);case"polygon":return re(e,t);default:return null}},ae=(e,t)=>{var s,i,a,o;const n=e.layer;let r,l,d,c,u,h,p,g,y;if(l=!1,r={type:"simple-marker",style:"square",color:[0,255,255,0],outline:{color:t||"#00FFFF",width:2}},r.size=30,null==n?void 0:n.renderer)if(n.renderer.symbol)l=!0,r=oe(r,n.renderer.symbol);else if((null===(s=n.renderer.infos)||void 0===s?void 0:s.length)>0){for(u=0;u<n.renderer.infos.length;u++)n.typeIdField?d=e.attributes[n.typeIdField]:n.renderer.attributeField&&(d=e.attributes[n.renderer.attributeField]),c=n.renderer.infos[u].value,null!=d&&""!==d&&null!=c&&""!==c&&d.toString()===c.toString()&&(l=!0,r=oe(r,n.renderer.infos[u].symbol));l||n.renderer.defaultSymbol&&(l=!0,r=oe(r,n.renderer.defaultSymbol))}if((null===(i=null==n?void 0:n.graphics)||void 0===i?void 0:i.length)>0&&n._getSymbol(e)){h=e.getShape(),(null==h?void 0:h.shape)?h.shape.hasOwnProperty("r")?(l=!0,r.size=2*h.shape.r+10):h.shape.hasOwnProperty("width")&&(l=!0,(null===(o=null===(a=n.renderer)||void 0===a?void 0:a.infos)||void 0===o?void 0:o.length)>0&&(r=oe(r,n.renderer.infos[0].symbol)),r.size=h.shape.width+10):n.renderer.visualVariables&&(p=n._getRenderer(e),g=(e=>{let t=null;return e.renderer.visualVariables&&e.renderer.visualVariables.forEach((e=>{"sizeInfo"===e.type&&(t=e)})),t})(n),g&&(y=p.getSize(e,{sizeInfo:g,shape:n._getSymbol(e),resolution:n&&n.getResolutionInMeters&&n.getResolutionInMeters()}),null!==y&&(r.size=y+10)))}return new B.default({geometry:e.geometry,symbol:r,attributes:e.attributes})},oe=(e,t)=>{let s,i,a;return t.hasOwnProperty("height")&&t.hasOwnProperty("width")&&(s=t.height,i=t.width,a=s>i?s:i,a+=10,e.size=a),t.hasOwnProperty("size")&&(!a||a<t.size)&&(e.size=t.size+10),t.hasOwnProperty("xoffset")&&(e.xoffset=t.xoffset),t.hasOwnProperty("yoffset")&&(e.yoffset=t.yoffset),e},ne=(e,t)=>{var s,i,a;const o=e.layer;let n,r,l,d;if(n=4,null==o?void 0:o.renderer)if((null===(s=o.renderer)||void 0===s?void 0:s.symbol)&&o.renderer.symbol.hasOwnProperty("width"))n=o.renderer.symbol.width;else if((null===(a=null===(i=o.renderer)||void 0===i?void 0:i.infos)||void 0===a?void 0:a.length)>0)for(d=0;d<o.renderer.infos.length;d++)o.typeIdField?r=e.attributes[o.typeIdField]:o.renderer.attributeField&&(r=e.attributes[o.renderer.attributeField]),l=o.renderer.infos[d].value,null!=r&&""!==r&&null!=l&&""!==l&&r.toString()===l.toString()&&o.renderer.infos[d].symbol.hasOwnProperty("width")&&(n=o.renderer.infos[d].symbol.width);else o.renderer.defaultSymbol&&o.renderer.defaultSymbol.hasOwnProperty("width")&&(n=o.renderer.defaultSymbol.width);const c={type:"simple-line",color:t||"#00FFFF",width:4,style:"solid",outline:{color:"#00FFFF",width:n}};return new B.default({geometry:e.geometry,symbol:c,attributes:e.attributes})},re=(e,t)=>{const s={type:"simple-fill",color:[0,255,255,0],style:"solid",outline:{color:t||"#00FFFF",width:2}};return new B.default({geometry:e.geometry,symbol:s,attributes:e.attributes})},le=(e,t)=>{let s;t||(t="#00FFFF");const i=new te.default(t),a=new te.default(t);switch(a.a=1,e){case"point":case"multipoint":s={type:"simple-marker",style:"circle",color:i,outline:{color:i,width:1}};break;case"polyline":s={type:"simple-line",color:i,width:4,style:"solid",outline:{color:i,width:1}};break;case"polygon":s={type:"simple-fill",color:i,style:"solid",outline:{color:a,width:1}}}return s},de=(e,t)=>{const s=e?se.fromJSON(e):null;if(s)return s;{const e=le("polygon",t);return e&&(e.color.a=.3),e}};var ce=L(62243);class ue extends s.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},a,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var e;const{searchCurrentExtent:t}=F(this.props.config);(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)&&(this.createSketchVmInstance(),t&&this.onSearchClicked(),ce.when((()=>{var e,t;return null===(t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.stationary}),(()=>{t&&this.props.showInfoIcon(!0)})))},this.createSketchVmInstance=()=>{var e;const t=new ee.default({view:(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)?this.props.jimuMapView.view:null,layer:new Z.default,pointSymbol:le("point",this.props.highlightColor),polylineSymbol:le("polyline",this.props.highlightColor),polygonSymbol:le("polygon",this.props.highlightColor)});t.on("create",this.onCreateComplete),this.setState({currentSketchVM:t},(()=>{"point"===this.props.activateToolOnWidgetLoad?(this.state.currentSketchVM.create("point"),this.setState({isPointActive:!0})):"polyline"===this.props.activateToolOnWidgetLoad?(this.state.currentSketchVM.create("polyline"),this.setState({isPolyLineActive:!0})):"polygon"===this.props.activateToolOnWidgetLoad?(this.state.currentSketchVM.create("polygon"),this.setState({isPolygonActive:!0})):"none"===this.props.activateToolOnWidgetLoad&&this.state.currentSketchVM.cancel()}))},this.componentDidUpdate=e=>{var t,s,i,a,o,n;if(e.jimuMapView.id!==this.props.jimuMapView.id&&this.state.currentSketchVM&&!this.state.currentSketchVM.destroyed&&(this.state.currentSketchVM.destroy(),this.createSketchVmInstance()),e.jimuMapView.view!==this.props.jimuMapView.view){const{searchCurrentExtent:e}=F(this.props.config);this.createSketchVmInstance(),e&&this.onSearchClicked(),ce.when((()=>{var e,t;return null===(t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.stationary}),(()=>{e&&this.props.showInfoIcon(!0)}))}const{searchCurrentExtent:r}=F(this.props.config);(null===(t=this.props.config)||void 0===t?void 0:t.searchByActiveMapArea)===(null===(s=e.config)||void 0===s?void 0:s.searchByActiveMapArea)&&(null===(i=this.props.config)||void 0===i?void 0:i.includeFeaturesOutsideMapArea)===(null===(a=e.config)||void 0===a?void 0:a.includeFeaturesOutsideMapArea)||r&&this.onSearchClicked(),this.props.highlightColor!==e.highlightColor&&this.state.currentSketchVM&&(this.state.isPolygonActive?this.state.currentSketchVM.set("polygonSymbol",le("polygon",this.props.highlightColor)):this.state.isPolyLineActive?this.state.currentSketchVM.set("polylineSymbol",le("polyline",this.props.highlightColor)):this.state.isPointActive&&this.state.currentSketchVM.set("pointSymbol",le("point",this.props.highlightColor))),this.props.widgetClosed!==e.widgetClosed&&(this.props.widgetClosed?(this.state.currentSketchVM&&this.state.currentSketchVM.cancel(),(null===(n=null===(o=this.props.jimuMapView.view)||void 0===o?void 0:o.popup)||void 0===n?void 0:n.close)&&this.props.jimuMapView.view.popup.close()):this.state.isPointActive?this.state.currentSketchVM.create("point"):this.state.isPolyLineActive?this.state.currentSketchVM.create("polyline"):this.state.isPolygonActive&&this.state.currentSketchVM.create("polygon")),this.props.config.sketchTools.showPoint===e.config.sketchTools.showPoint&&this.props.config.sketchTools.showPolyline===e.config.sketchTools.showPolyline&&this.props.config.sketchTools.showPolygon===e.config.sketchTools.showPolygon||(!this.props.config.sketchTools.showPoint&&this.state.isPointActive&&this.state.currentSketchVM.cancel(),!this.props.config.sketchTools.showPolyline&&this.state.isPolyLineActive&&this.state.currentSketchVM.cancel(),!this.props.config.sketchTools.showPolygon&&this.state.isPolygonActive&&this.state.currentSketchVM.cancel())},this.componentWillUnmount=()=>{var e;this.state.currentSketchVM&&(null===(e=this.state.currentSketchVM)||void 0===e||e.cancel())},this.onSearchClicked=()=>{this.props.showInfoIcon(!1),this.props.searchByMapAreaClicked(),this.clearAll()},this.onResetButtonClick=()=>{this.props.refreshClicked()},this.clearAll=()=>{var e,t;this.state.currentSketchVM&&this.state.currentSketchVM.cancel(),(null===(t=null===(e=this.props.jimuMapView.view)||void 0===e?void 0:e.popup)||void 0===t?void 0:t.close)&&this.props.jimuMapView.view.popup.close(),this.setState({isPolygonActive:!1,isPointActive:!1,isPolyLineActive:!1})},this.onDrawToolBtnChanges=e=>{switch(this.clearAll(),e){case"polygon":this.state.isPolygonActive?this.state.currentSketchVM.cancel():(this.state.currentSketchVM.set("polygonSymbol",le("polygon",this.props.highlightColor)),this.state.currentSketchVM.create("polygon"),this.setState({isPolygonActive:!0,isPointActive:!1,isPolyLineActive:!1}));break;case"point":this.state.isPointActive?this.state.currentSketchVM.cancel():(this.state.currentSketchVM.set("pointSymbol",le("point",this.props.highlightColor)),this.state.currentSketchVM.create("point"),this.state.currentSketchVM.pointSymbol.size=14,this.setState({isPolygonActive:!1,isPointActive:!0,isPolyLineActive:!1}));break;case"polyline":this.state.isPolyLineActive?this.state.currentSketchVM.cancel():(this.state.currentSketchVM.set("polylineSymbol",le("polyline",this.props.highlightColor)),this.state.currentSketchVM.create("polyline"),this.setState({isPolygonActive:!1,isPointActive:!1,isPolyLineActive:!0}));break;default:this.state.currentSketchVM.cancel()}},this.onCreateComplete=e=>{if("complete"===e.state)this.props.sketchComplete(e),this.setState({isPointActive:!1,isPolyLineActive:!1,isPolygonActive:!1});else if("cancel"===e.state){if(this.props.widgetClosed)return;this.setState({isPointActive:!1,isPolyLineActive:!1,isPolygonActive:!1})}},this.state={isPolygonActive:!1,isPointActive:!1,isPolyLineActive:!1,searchSettings:this.props.config,currentSketchVM:null,filterActionBinded:!1}}render(){const{searchCurrentExtent:e}=F(this.props.config),{sketchTools:t}=this.props.config,a=t.showPoint||t.showPolyline||t.showPolygon;return(0,s.jsx)("div",{css:(this.props.theme,s.css`
    .main-row {
      flex-wrap: wrap;
      display: flex;
    }

    .headingLabel {
      margin: 0 !important;
      font-weight: 500;
    }

    .icon-verticalLine {
      border-right: 1px solid rgba(110,110,110,.3);
    }

    .column-section {
      display: flex;
      align-items: center;
      margin: 3px 0;
    }

    .hidden {
      display: none;
    }

   .pointer {
    cursor: pointer;
   }
  `),className:"jimu-widget"},!e&&a&&(0,s.jsx)("div",{className:"w-100 d-flex locate-incident-section"},(0,s.jsx)("div",{className:"column-section pr-1"},(null==t?void 0:t.showPoint)&&(0,s.jsx)(i.Button,{type:"tertiary",className:"action-button",icon:!0,"aria-label":this.nls("point"),title:this.nls("point"),variant:this.state.isPointActive?"contained":"text",color:this.state.isPointActive?"primary":"default",onClick:()=>{this.onDrawToolBtnChanges("point")}},(0,s.jsx)(N,{size:"m"})),(null==t?void 0:t.showPolyline)&&(0,s.jsx)(i.Button,{type:"tertiary",className:"action-button",icon:!0,"aria-label":this.nls("polyline"),title:this.nls("polyline"),variant:this.state.isPolyLineActive?"contained":"text",color:this.state.isPolyLineActive?"primary":"default",onClick:()=>{this.onDrawToolBtnChanges("polyline")}},(0,s.jsx)(_,{size:"m"})),(null==t?void 0:t.showPolygon)&&(0,s.jsx)(i.Button,{type:"tertiary",className:"action-button",icon:!0,"aria-label":this.nls("polygon"),title:this.nls("polygon"),variant:this.state.isPolygonActive?"contained":"text",color:this.state.isPolygonActive?"primary":"default",onClick:()=>{this.onDrawToolBtnChanges("polygon")}},(0,s.jsx)(q,{size:"m"})))),e&&!this.props.isFilterActionBinded&&(0,s.jsx)("div",{className:"column-section shadow-sm w-100",onClick:this.onSearchClicked},(0,s.jsx)(i.Button,{className:"w-100",onClick:this.onSearchClicked,size:"default","aria-label":this.nls("searchByActiveMapArea"),title:this.nls("searchByActiveMapArea")},(0,s.jsx)(Y,{size:"m"}),(0,s.jsx)("label",{className:"mb-0 align-middle"},this.nls("updateResultsLabel")))))}}const he=[{value:"miles",label:a.miles},{value:"meters",label:a.meters},{value:"kilometers",label:a.kilometers},{value:"feet",label:a.feet},{value:"yards",label:a.yards}],pe=[{value:"meters",abbreviation:"metersAbbreviation"},{value:"feet",abbreviation:"feetAbbreviation"},{value:"kilometers",abbreviation:"kilometersAbbreviation"},{value:"miles",abbreviation:"milesAbbreviation"},{value:"yards",abbreviation:"yardsAbbreviation"}],ge={a3Portrait:{height:16.54,width:11.69},a3Landscape:{height:11.69,width:16.54},a4Portrait:{height:11.69,width:8.27},a4Landscape:{height:8.27,width:11.69},letterAnsiAPortrait:{height:11,width:8.5},letterAnsiALandscape:{height:8.5,width:11},tabloidAnsiBPortrait:{height:17,width:11},tabloidAnsiBLandscape:{height:11,width:17}},ye={a3Portrait:{height:13.5,width:11.7},a3Landscape:{height:7.7,width:16.5},a4Portrait:{height:8.5,width:8.3},a4Landscape:{height:4.8,width:11.7},letterAnsiAPortrait:{height:7.8,width:8.5},letterAnsiALandscape:{height:4.5,width:11},tabloidAnsiBPortrait:{height:14.5,width:11},tabloidAnsiBLandscape:{height:7,width:17}},me={a3Portrait:{height:2,width:11.7},a3Landscape:{height:2,width:16.5},a4Portrait:{height:2,width:8.3},a4Landscape:{height:1,width:11.7},letterAnsiAPortrait:{height:2,width:8.5},letterAnsiALandscape:{height:2,width:11},tabloidAnsiBPortrait:{height:2,width:11},tabloidAnsiBLandscape:{height:2,width:17}};var fe;!function(e){e.Portrait="Portrait",e.Landscape="Landscape"}(fe||(fe={}));e.Closest,e.Proximity,e.Summary;const ve="#f507f5",be="#FFFFFF00",Se={analysisSettings:{layersInfo:[],displayFeatureCount:!0,displayAnalysisIcon:!1,displayMapSymbols:!1,showDistFromInputLocation:!0,onlyShowLayersResult:!1,displayAllLayersResult:!1,enableProximitySearch:!1,saveFeatures:{saveInputLocation:!1,pointFeature:{enabled:!1,useDataSource:null},polylineFeature:{enabled:!1,useDataSource:null},polygonFeature:{enabled:!1,useDataSource:null},searchAreaFeature:{enabled:!1,useDataSource:null}}},searchSettings:{headingLabel:"",bufferDistance:1,distanceUnits:"",showDistanceSettings:!0,sketchTools:{showPoint:!0,showPolyline:!0,showPolygon:!0},activeToolWhenWidgetOpens:"none",searchByActiveMapArea:!1,includeFeaturesOutsideMapArea:!1,headingLabelStyle:{fontFamily:"Avenir Next",fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1,fontColor:"var(--ref-palette-black)",fontSize:"13px"},showInputAddress:!0}};var we,xe;!function(e){e.NoFormatting="noFormatting",e.Round="round",e.Truncate="truncate"}(we||(we={})),function(e){e.SumOfIntersectedArea="sumOfIntersectedArea",e.SumOfIntersectedLength="sumOfIntersectedLength"}(xe||(xe={}));xe.SumOfIntersectedLength,we.NoFormatting,xe.SumOfIntersectedArea,we.NoFormatting;var Ie;!function(e){e.SingleColor="singleColor",e.ByCategory="byCategory"}(Ie||(Ie={}));var Ae=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};class De extends s.React.PureComponent{constructor(e){var t,i;super(e),this.nls=e=>{var t;const s=Object.assign({},a);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.props.unitChanged(this.state.distanceUnit),this.getBufferGeometry()},this.componentDidUpdate=e=>{var t,s,i,a,o,n;(null===(t=this.props)||void 0===t?void 0:t.geometry)!==(null==e?void 0:e.geometry)&&this.getBufferGeometry(),(null===(s=this.props)||void 0===s?void 0:s.distanceUnit)!==e.distanceUnit&&this.setState({distanceUnit:null===(i=this.props)||void 0===i?void 0:i.distanceUnit},(()=>{this.onUnitChange(this.props.distanceUnit)})),(null===(a=this.props)||void 0===a?void 0:a.bufferDistance)!==e.bufferDistance&&this.setState({bufferDistance:null===(o=this.props)||void 0===o?void 0:o.bufferDistance},(()=>{var e;this.props.distanceChanged(null===(e=this.props)||void 0===e?void 0:e.bufferDistance),this.getBufferGeometry()})),(null==e?void 0:e.refreshButtonClicked)!==(null===(n=this.props)||void 0===n?void 0:n.refreshButtonClicked)&&this.props.refreshButtonClicked&&this.setState({bufferDistance:this.props.bufferDistance,distanceUnit:this.props.distanceUnit})},this.getBufferGeometry=()=>Ae(this,void 0,void 0,(function*(){if(this.props.geometry)if(this.state.bufferDistance&&this.state.distanceUnit&&this.state.bufferDistance>0){const e=yield s.geometryUtils.createBuffer(this.props.geometry,[this.state.bufferDistance],this.state.distanceUnit),t=Array.isArray(e)?e[0]:e;this.props.bufferComplete(t)}else this.props.bufferComplete(null)})),this.onDistanceHandleChange=e=>{this.checkIfDistanceChange=!0,this.setState({bufferDistance:null!=e?e:1})},this.onDistancePressEnter=()=>{this.numberValueInputRef.blur()},this.onDistanceBlur=()=>{this.checkIfDistanceChange&&(this.updateDistance(),this.checkIfDistanceChange=!1)},this.updateDistance=()=>{this.props.distanceChanged(this.state.bufferDistance),this.getBufferGeometry()},this.onUnitChange=e=>{const t=((e,t)=>{const s=x(t);return e>s?s:e})(this.state.bufferDistance,e);this.props.distanceChanged(t),this.props.unitChanged(e),this.setState({distanceUnit:e,bufferDistance:t},(()=>{this.getBufferGeometry()}))},this.state={distanceUnit:null===(t=this.props)||void 0===t?void 0:t.distanceUnit,bufferDistance:null===(i=this.props)||void 0===i?void 0:i.bufferDistance}}render(){var e;return(0,s.jsx)("div",{css:(null===(e=this.props)||void 0===e||e.theme,s.css`
  .headingLabel {
      margin: 0 !important;
      font-weight: 500;
    }

    .hidden {
      display: none;
    }

    .column-section {
      display: flex;
      align-items: center;
      margin: 6px 0;
    }
  `)},this.props.config.showDistanceSettings&&(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)("div",{className:"d-inline w-100 pt-1"},(0,s.jsx)("div",{className:"column-section"},(0,s.jsx)(i.NumericInput,{"aria-label":this.props.bufferHeaderLabel,className:"w-50",value:this.state.bufferDistance,size:"sm",min:0,max:x(this.state.distanceUnit),ref:e=>{this.numberValueInputRef=e},onBlur:this.onDistanceBlur,onPressEnter:this.onDistancePressEnter,onChange:this.onDistanceHandleChange}),(0,s.jsx)(i.Select,{"aria-label":this.props.bufferHeaderLabel,className:"w-50 pl-2",size:"sm",value:this.state.distanceUnit,onChange:e=>{this.onUnitChange(e.target.value)}},he.map(((e,t)=>(0,s.jsx)(i.Option,{key:t,value:e.value},this.nls(e.value)))))))))}}var Fe=L(53205),Ce=L(20320),Le=L(31526),Me=L(45508),Te=L.n(Me),je=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Oe=e=>{const t=window.SVG,{className:i}=e,a=je(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:Te()},a)):s.React.createElement("svg",Object.assign({className:o},a))},Re=(0,s.getAppStore)().getState().portalSelf;class Pe extends s.React.PureComponent{constructor(e){var s,i,o,n,r,l,d;super(e),this.nls=e=>{var t;const s=Object.assign({},a);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var e;(null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view)&&this.props.jimuMapView.view.when((()=>{this.state.searchByActiveMapArea&&this.clearAll()}))},this.componentDidUpdate=e=>{var t,s,i,a,o,n,r,l,d,c,u,h,p,g,y,m,f,v,b,S,w,x,I;if((null===(t=e.jimuMapView)||void 0===t?void 0:t.id)!==(null===(s=this.props.jimuMapView)||void 0===s?void 0:s.id)&&this.clearAll(),(null===(i=this.props.config)||void 0===i?void 0:i.searchByActiveMapArea)!==(null===(a=e.config)||void 0===a?void 0:a.searchByActiveMapArea)&&(this.clearAll(),this.setState({searchByActiveMapArea:null===(o=this.props.config)||void 0===o?void 0:o.searchByActiveMapArea})),(null===(n=e.config)||void 0===n?void 0:n.distanceUnits)!==(null===(r=this.props.config)||void 0===r?void 0:r.distanceUnits)&&this.setState({defaultDistanceUnits:(null===(l=this.props.config)||void 0===l?void 0:l.distanceUnits)?null===(d=this.props.config)||void 0===d?void 0:d.distanceUnits:D()}),(null===(c=e.config)||void 0===c?void 0:c.bufferDistance)!==(null===(u=this.props.config)||void 0===u?void 0:u.bufferDistance)&&this.setState({defaultBufferDistance:null===(h=this.props.config)||void 0===h?void 0:h.bufferDistance}),(null===(p=e.config)||void 0===p?void 0:p.showDistanceSettings)!==(null===(g=this.props.config)||void 0===g?void 0:g.showDistanceSettings)&&this.setState({showDistSettings:null===(y=this.props.config)||void 0===y?void 0:y.showDistanceSettings},(()=>{this.clearAll()})),e.highlightColor!==(null===(m=this.props)||void 0===m?void 0:m.highlightColor)){if(null===(v=null===(f=this.graphic)||void 0===f?void 0:f.geometry)||void 0===v?void 0:v.type){const e=le(this.graphic.geometry.type,this.props.highlightColor);e&&this.graphic.set("symbol",e)}if((null===(S=null===(b=this.props.bufferLayer)||void 0===b?void 0:b.graphics)||void 0===S?void 0:S.length)>0){const e=de(this.props.bufferSymbol,this.props.highlightColor);e&&this.props.bufferLayer.graphics.forEach((t=>{t.set("symbol",e)}))}}if(e.bufferSymbol!==(null===(w=this.props)||void 0===w?void 0:w.bufferSymbol)&&(null===(I=null===(x=this.props.bufferLayer)||void 0===x?void 0:x.graphics)||void 0===I?void 0:I.length)>0){const e=de(this.props.bufferSymbol,this.props.highlightColor);e&&this.props.bufferLayer.graphics.forEach((t=>{t.set("symbol",e)}))}e.msgActionGeometry!==this.props.msgActionGeometry&&this.onDrawIncidentComplete(this.props.msgActionGeometry),this.props.widgetClosed!==e.widgetClosed&&this.setState({widgetClosed:this.props.widgetClosed})},this.componentWillUnmount=()=>{this.clearAll()},this.onSketchComplete=e=>{this.onDrawIncidentComplete(e.graphic.geometry)},this.onDrawIncidentComplete=e=>{if(!e)return;this.clearAll(),this.showClosestAddress(e);const s=this.props.jimuMapView.view.spatialReference;s&&(s.isWGS84||s.isWebMercator)?t.geometryUtils.projectToSpatialReference([e],new Fe.default({wkid:4326})).then((t=>{(null==t?void 0:t.length)>0&&(this.graphic=new B.default({geometry:e,symbol:le(e.type,this.props.highlightColor),attributes:{}}),this.props.drawingLayer.add(this.graphic),this.props.incidentGraphicChange(this.graphic),this.setState({incidentGeometry:e,incidentGeometry4326:t[0],bufferGeometry:null,geodesicBuffer:null}))}),(e=>{console.log(e)})):setTimeout((()=>{this.graphic=new B.default({geometry:e,symbol:le(e.type,this.props.highlightColor),attributes:{}}),this.props.drawingLayer.add(this.graphic),this.props.incidentGraphicChange(this.graphic),this.setState({incidentGeometry:e,incidentGeometry4326:null,bufferGeometry:null,geodesicBuffer:null})}),100)},this.onSearchByMapAreaClicked=()=>{this.getMapExtentGeometry()},this.getMapExtentGeometry=()=>{var e;if(this.clearAll(),null===(e=this.props)||void 0===e?void 0:e.jimuMapView){const e=this.props.jimuMapView.view.extent,t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],s=new Le.default({spatialReference:this.props.jimuMapView.view.spatialReference});s.addRing(t),this.graphic=new B.default({geometry:s}),setTimeout((()=>{var e,t;this.setState({incidentGeometry:this.props.jimuMapView.view.center,bufferGeometry:null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view.extent,incidentGeometry4326:null,geodesicBuffer:null}),this.props.aoiComplete({incidentGeometry:this.props.jimuMapView.view.center,bufferGeometry:null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view.extent,incidentGeometry4326:null,geodesicBuffer:null,distanceUnit:this.currentDistanceUnit,bufferDistance:this.currentBufferDistance})}),50),this.updateLayerListMaxHeight()}},this.refreshButtonClicked=()=>{this.currentBufferDistance=this.state.defaultBufferDistance,this.currentDistanceUnit=this.state.defaultDistanceUnits,this.clearAll(),this.setState({refreshButtonClicked:!0},(()=>{setTimeout((()=>{this.setState({refreshButtonClicked:!1})}),50)}))},this.clearAll=()=>{var e,t;null===(e=this.props.bufferLayer)||void 0===e||e.removeAll(),null===(t=this.props.drawingLayer)||void 0===t||t.removeAll(),this.graphic=null,this.setState({bufferGeometry:null,incidentGeometry:null,incidentGeometry4326:null,geodesicBuffer:null,closestAddress:null},(()=>{this.updateLayerListMaxHeight(),this.props.clear()}))},this.onBufferComplete=e=>{e?t.geometryUtils.projectToSpatialReference([e],this.props.jimuMapView.view.spatialReference).then((t=>{var s,i;if((null==t?void 0:t.length)>0){const a=new B.default({geometry:t[0],symbol:de(this.props.bufferSymbol,this.props.highlightColor)});a&&(this.props.bufferLayer.removeAll(),null===(s=this.props.bufferLayer)||void 0===s||s.add(a),null===(i=this.props.jimuMapView)||void 0===i||i.view.goTo({center:"point"===a.geometry.type?a.geometry:a.geometry.extent.clone().expand(1.5)})),this.setState({bufferGeometry:t[0]},(()=>{this.props.aoiComplete({incidentGeometry:this.state.incidentGeometry,bufferGeometry:t[0],incidentGeometry4326:this.state.incidentGeometry4326,geodesicBuffer:e,distanceUnit:this.currentDistanceUnit,bufferDistance:this.currentBufferDistance})}))}})):this.props.aoiComplete({incidentGeometry:this.state.incidentGeometry,incidentGeometry4326:this.state.incidentGeometry4326,bufferGeometry:null,geodesicBuffer:null,distanceUnit:this.currentDistanceUnit,bufferDistance:this.currentBufferDistance})},this.onBufferDistanceChange=e=>{var t;this.currentBufferDistance=e,null===(t=this.props.bufferLayer)||void 0===t||t.removeAll()},this.onBufferUnitChange=e=>{var t;this.currentDistanceUnit=e,null===(t=this.props.bufferLayer)||void 0===t||t.removeAll()},this.getGeocodeServiceURL=()=>{var e,t,s,i,a;let o="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer";return(null===(t=null===(e=null==Re?void 0:Re.helperServices)||void 0===e?void 0:e.geocode)||void 0===t?void 0:t.length)>0&&(null===(a=null===(i=null===(s=null==Re?void 0:Re.helperServices)||void 0===s?void 0:s.geocode)||void 0===i?void 0:i[0])||void 0===a?void 0:a.url)&&(o=Re.helperServices.geocode[0].url),o},this.getClosestAddress=e=>{const t=this.getGeocodeServiceURL();return Ce.locationToAddress(t,{location:e},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>Promise.resolve(this.nls("noClosestAddressMsg"))))},this.showClosestAddress=e=>{"point"===(null==e?void 0:e.type)?this.getClosestAddress(e).then((e=>{this.setState({closestAddress:e},(()=>{this.updateLayerListMaxHeight()}))})):this.setState({closestAddress:null},(()=>{this.updateLayerListMaxHeight()}))},this.updateLayerListMaxHeight=()=>{setTimeout((()=>{this.props.updateClosestAddressState(null!==this.state.closestAddress)}),50)},this.handleShowInfoIcon=e=>{this.setState({showInfoIcon:e})};const c=this.props.config&&""!==this.props.config.distanceUnits?null===(s=this.props.config)||void 0===s?void 0:s.distanceUnits:D();this.currentBufferDistance=null!==(o=null===(i=this.props.config)||void 0===i?void 0:i.bufferDistance)&&void 0!==o?o:1,this.currentDistanceUnit=c,this.state={defaultDistanceUnits:c,defaultBufferDistance:null!==(r=null===(n=this.props.config)||void 0===n?void 0:n.bufferDistance)&&void 0!==r?r:1,bufferGeometry:null,incidentGeometry:null,incidentGeometry4326:null,geodesicBuffer:null,searchSettings:this.props.config,refreshButtonClicked:!1,closestAddress:null,searchByActiveMapArea:null===(l=this.props.config)||void 0===l?void 0:l.searchByActiveMapArea,showDistSettings:null===(d=this.props.config)||void 0===d?void 0:d.showDistanceSettings,showInfoIcon:!1,widgetClosed:this.props.widgetClosed}}render(){var e;const{searchCurrentExtent:t,searchByLocation:a}=F(this.props.config),{sketchTools:o}=this.props.config,r=o.showPoint||o.showPolyline||o.showPolygon,l=this.props.widgetWidth<306||!this.state.searchByActiveMapArea&&!this.state.showDistSettings||!this.props.headingLabel&&this.state.showDistSettings&&!r?"pb-1 buffer-distance w-100":"pb-1 buffer-distance",d=this.props.widgetWidth<306||this.state.searchByActiveMapArea?"locate-incident pb-1 w-100":"locate-incident pb-1";return(0,s.jsx)("div",{className:"pt-2 px-2",css:n(null===(e=this.props)||void 0===e||e.theme,r)},(0,s.jsx)("div",{className:t&&this.props.headingLabel?"mb-2":"hidden"},(0,s.jsx)(i.Label,{className:"headingLabelStyle mb-0"},(0,s.jsx)("span",{className:t?"align-middle":""},this.props.headingLabel),!1)),(0,s.jsx)("div",{className:a&&this.props.headingLabel?"mb-0":"hidden"},(0,s.jsx)(i.Label,{className:"headingLabelStyle mb-0"},(0,s.jsx)("span",{className:t?"align-middle":""},this.props.headingLabel))),(0,s.jsx)("div",{className:"main-row w-100"},(0,s.jsx)("div",{className:d},(0,s.jsx)(ue,{theme:this.props.theme,intl:this.props.intl,config:this.props.config,widgetClosed:this.state.widgetClosed,activateToolOnWidgetLoad:this.props.activateToolOnWidgetLoad,isFilterActionBinded:this.props.isFilterActionBinded,jimuMapView:this.props.jimuMapView,sketchComplete:this.onSketchComplete,refreshClicked:this.refreshButtonClicked,searchByMapAreaClicked:this.onSearchByMapAreaClicked,highlightColor:this.props.highlightColor,showInfoIcon:this.handleShowInfoIcon})),(0,s.jsx)("div",{className:this.state.searchByActiveMapArea?"hidden pb-1 buffer-distance":l},!this.state.searchByActiveMapArea&&(0,s.jsx)(De,{theme:this.props.theme,intl:this.props.intl,config:this.props.config,geometry:this.state.incidentGeometry4326||this.state.incidentGeometry,distanceUnit:this.state.defaultDistanceUnits,bufferDistance:this.state.defaultBufferDistance,bufferHeaderLabel:this.nls("bufferDistance"),bufferComplete:this.onBufferComplete,distanceChanged:this.onBufferDistanceChange,unitChanged:this.onBufferUnitChange,refreshButtonClicked:this.state.refreshButtonClicked}))),this.state.closestAddress&&this.props.showInputAddress&&(0,s.jsx)("div",{tabIndex:0,"aria-label":this.nls("closestAddress")+" "+this.state.closestAddress,className:"closest-address w-100 pt-1"},(0,s.jsx)(i.Label,{className:"closestAddressheadingLabel mb-0"},this.nls("closestAddress")),(0,s.jsx)("br",null),(0,s.jsx)(i.Label,{className:"mb-0 pt-1"},this.state.closestAddress)))}}var Ee=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};const Be=(e,t,i,a,o,n)=>Ee(void 0,void 0,void 0,(function*(){return new Promise((a=>{var r;if(!e)return void a([]);let l;void 0===o?l=["*"]:(l=Object.assign([],o),(null==o?void 0:o.includes("esriCTApproxDistance"))&&l.splice(o.indexOf("esriCTApproxDistance"),1));const d=null===(r=e.getSchema())||void 0===r?void 0:r.fields;if(d){const e=Object.keys(d).map((e=>e.toLowerCase()));l=l.filter((t=>e.includes(t.toLowerCase())))}const c=e.getIdField();!c||l.includes("*")||l.includes(c)||l.push(c);const u={};t&&(u.geometry=t.toJSON(),u.geometryType=t?s.utils.getGeometryType(t):void 0),u.outFields=l,u.returnGeometry=i,u.notAddFieldsToClient=!0,e.queryAll(u,n,null,{excludeQuery:{widgetId:"filter-data-record-action",dataSourceId:e.id}}).then((e=>{n.aborted?(console.error(n.reason),a([])):(null==e?void 0:e.records)?a(e.records):a([])}),(e=>{console.log(e),a([])}))}))}));var ke=L(23938),Ve=L(86823),Ge=L.n(Ve),Ne=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Ue=e=>{const t=window.SVG,{className:i}=e,a=Ne(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:Ge()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var ze=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};class We extends s.React.PureComponent{constructor(e){super(e),this.dropdownRef=s.React.createRef(),this.nls=e=>{var t;const i=Object.assign({},a,s.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:i[e]}):i[e]},this.componentDidMount=()=>ze(this,void 0,void 0,(function*(){yield this.getDataSetForActions(),!this.props.popupTitleField||this.props.popupTitleField&&this.props.isExpanded?this.createFeatureItem(this.props.ifOneAnalysisResult&&this.props.expandOnOpen,this.props.displayMapSymbol):this.props.ifOneAnalysisResult&&this.props.popupTitleField&&this.props.expandOnOpen&&this.onToggleSelectedLayer(),this.props.displayMapSymbol&&(yield new Promise((e=>setTimeout(e,100))),T(this.props.selectedRecord,this.symbolRef))})),this.componentDidUpdate=e=>{e.selectedRecord!==this.props.selectedRecord&&this.props.displayMapSymbol&&T(this.props.selectedRecord,this.symbolRef)},this.getDataSetForActions=()=>ze(this,void 0,void 0,(function*(){var e,t,i;const a=this.props.selectedRecord,o=S(this.props.selectedLayerDsId);this.recordActionNames=[],this.recordActions={},this.dataSetPlanRoute=[],this.dataSetArray=[];const n=[{dataSource:o,records:[this.props.selectedRecord],name:o.getLabel(),type:"selected"}];this.dataSetArray=n;try{[this.recordActions]=yield this.getAvailableActions(),this.recordActionNames=Object.keys(this.recordActions).filter((e=>"export"!==e))}catch(e){console.error(e),this.recordActions={}}const r=this.props.startingPointGraphic?o.buildRecord(this.props.startingPointGraphic):null;if(this.props.showPlanRoute&&"point"===(null===(t=null===(e=a.feature)||void 0===e?void 0:e.geometry)||void 0===t?void 0:t.type)&&r){this.dataSetPlanRoute=[{dataSource:o,records:[r,this.props.selectedRecord],name:o.getLabel(),type:"selected"}];const e=yield s.DataActionManager.getInstance().getSupportedActions(this.props.widgetId,this.dataSetPlanRoute,s.DataLevel.Records);(null===(i=e.PlanRoute)||void 0===i?void 0:i.length)>0&&(this.planRouteAction=e.PlanRoute[0])}})),this.getAvailableActions=()=>{let e=null,t=0;for(const e of this.dataSetArray)t+=e.records.length;return 0!==t&&(e=s.DataActionManager.getInstance().getSupportedActions(this.props.widgetId,this.dataSetArray,s.DataLevel.Records)),Promise.all([e||{}])},this.createFeature=()=>{const e=this.props.selectedRecord;if(null==e?void 0:e.feature){const t=document&&document.createElement("div");t.className="jimu-widget bg-transparent pointer",this.popUpContent.current.appendChild(t);const s=new ke.default({container:t,view:this.props.jimuMapView.view,features:[e.feature],map:this.props.jimuMapView.view.map,spatialReference:this.props.jimuMapView.view.spatialReference,visible:!0,visibleElements:{heading:!1,actionBar:!1,closeButton:!1}});ce.watch((()=>s.viewModel.title),(e=>{var t;""!==e&&(null===(t=this.featureWidgetTitle)||void 0===t?void 0:t.current)&&(this.featureWidgetTitle.current.innerHTML=e)}))}},this.displayPopupTitle=()=>{let e="";return this.props.selectedRecord&&(e=this.props.selectedRecord.getFormattedFieldValue(this.props.popupTitleField,this.props.intl)),A(e,this.nls("noValueForDisplayField"))},this.onToggleSelectedLayer=()=>{this.props.isExpanded||this.setState({isFeatureLayerOpen:!this.state.isFeatureLayerOpen,isIconRight:!this.state.isIconRight},(()=>{this.state.isFeatureLayerOpen&&!this.state.featureItem?this.createFeatureItem(!0):this.onFeatureDetailsClick()}))},this.onFeatureDetailsClick=e=>{if(e&&e.target.tagName.toLocaleLowerCase().startsWith("calcite"))return void e.stopPropagation();const t=this.props.selectedRecord;t&&(t.getFeature().geometry?this.selectOrClearRecord():t._dataSource.queryById(this.props.selectedRecord.getId()).then((e=>{this.selectOrClearRecord(e)})))},this.selectOrClearRecord=e=>{var t,s;!(null===(s=null===(t=this.popUpContent)||void 0===t?void 0:t.current)||void 0===s?void 0:s.classList.contains("record-selected"))&&this.state.isFeatureLayerOpen?this.props.selectRecord(this.props.index,this.popUpContent.current,null!=e?e:this.props.selectedRecord):this.props.clearRecord(this.props.index)},this.createFeatureItem=(e,t)=>{var a;const o=this.props.selectedRecord;let n=null;const r=this.props.intl.formatNumber(o.feature.distance,{maximumFractionDigits:2}),l=this.props.popupTitleField&&this.props.isExpanded?this.displayPopupTitle():this.nls("approximateDistance"),d=this.props.approximateDistanceUI&&(this.props.showDistFromInputLocation||this.props.popupTitleField);n=(0,s.jsx)("div",null,(t||d&&this.props.isExpanded)&&(0,s.jsx)("div",{className:"approximateDist-container nm-border-bottom-color"},t&&(0,s.jsx)("div",{className:"feature-title-map-symbol",ref:this.symbolRef}),d&&(0,s.jsx)("div",{className:"approximateDist-label"},(0,s.jsx)(i.Label,{className:"mb-0"},l)),this.props.showDistFromInputLocation&&this.props.approximateDistanceUI&&(0,s.jsx)(i.Label,{tabIndex:-1,className:"approximateDist mb-0 pt-0 font-weight-bold"},(0,s.jsx)("div",{tabIndex:0,"aria-label":this.getAriaLabelString(this.nls("approximateDistance"),r,this.props.distanceUnit)},this.getLabelForDistUnit(r,this.props.distanceUnit)))),(0,s.jsx)("div",{className:"feature-widget-title-container nm-border-bottom-color"},(0,s.jsx)("div",{ref:this.featureWidgetTitle,className:"feature-widget-title"}),this.props.showDataActions&&((null===(a=this.recordActionNames)||void 0===a?void 0:a.length)>0||this.planRouteAction)&&(0,s.jsx)("div",{className:"pr-1"},this.renderSupportedActionList())),(0,s.jsx)("div",{tabIndex:0,className:"pb-2 pointer record-container",ref:this.popUpContent,onClick:this.onFeatureDetailsClick.bind(this)})),this.setState({featureItem:n},(()=>{this.createFeature(),e&&this.onFeatureDetailsClick()}))},this.renderSupportedActionList=()=>{var e;const t=s.css`
     padding-top: 3px!important;
    `;return(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(i.Dropdown,{className:"float-right",direction:"down",size:"sm",useKeyUpEvent:!0,"aria-label":this.nls("actions")},(0,s.jsx)(i.DropdownButton,{size:"sm",arrow:!1,css:t,icon:!0,ref:this.dropdownRef,className:"data-action-button",type:"tertiary",title:this.nls("actions")},(0,s.jsx)(Ue,{size:"m"})),(0,s.jsx)(i.DropdownMenu,null,(null===(e=this.recordActionNames)||void 0===e?void 0:e.length)>0&&this.recordActionNames.map((e=>this.createActionItem(this.recordActions,e,s.DataLevel.Records))),this.planRouteAction&&this.createPlanRouteAction())))},this.createPlanRouteAction=()=>{const e=this.dataSetPlanRoute[0].dataSource.id,t=s.MutableStoreManager.getInstance().getStateValue(["dataActions",this.planRouteAction.name,e,"icon"])||this.planRouteAction.icon;return(0,s.jsx)(i.DropdownItem,{key:this.planRouteAction.id,header:!1,"aria-label":this.planRouteAction.label,onClick:e=>ze(this,void 0,void 0,(function*(){yield this.onActionItemClick(this.planRouteAction,s.DataLevel.Records)}))},(0,s.jsx)("div",{className:"d-flex align-items-center"},t&&(0,s.jsx)(s.React.Fragment,null,"string"==typeof t?(0,s.jsx)(i.Icon,{icon:t,className:"jimu-icon-auto-color"}):t),(0,s.jsx)("span",{className:"ml-2"},this.planRouteAction.label)))},this.createActionItem=(e,t,a)=>{const o=e[t];if((null==o?void 0:o.length)>0&&this.dataSetArray.length>0){if("locate"===t&&!this.props.isEnableProximitySearch)return;const e=o[0],n=this.dataSetArray[0].dataSource.id,r=s.MutableStoreManager.getInstance().getStateValue(["dataActions",e.name,n,"icon"])||e.icon;if(1===o.length)return(0,s.jsx)(i.DropdownItem,{key:e.id,header:!1,"aria-label":e.label,onClick:t=>ze(this,void 0,void 0,(function*(){yield this.onActionItemClick(e,a)}))},(0,s.jsx)("div",{className:"d-flex align-items-center"},r&&(0,s.jsx)(s.React.Fragment,null,"string"==typeof r?(0,s.jsx)(i.Icon,{icon:r,className:"jimu-icon-auto-color"}):r),(0,s.jsx)("span",{className:"ml-2"},e.label)))}return null},this.onActionItemClick=(e,t)=>ze(this,void 0,void 0,(function*(){const i="active-data-action-item",a=document.querySelector(`.${i}`);let o=null;a&&a.classList.remove(i),this.dropdownRef.current.className=(0,s.classNames)(this.dropdownRef.current.className,i),o="PlanRoute"===e.name?yield s.DataActionManager.getInstance().executeDataAction(e,this.dataSetPlanRoute,t,this.props.widgetId):yield s.DataActionManager.getInstance().executeDataAction(e,this.dataSetArray,t,this.props.widgetId),null!==o&&"boolean"!=typeof o&&this.setState({actionElement:s.React.cloneElement(o,{onClose:()=>{this.setState({actionElement:null})},onConfirm:(...e)=>(!o.props.keepOpenAfterConfirm&&this.setState({actionElement:null}),o.props.onConfirm(...e))})})})),this.getAriaLabelString=(e,t,s)=>{let i="";return i=this.props.intl.formatMessage({id:"ariaLabelString",defaultMessage:a.ariaLabelString},{label:e,formattedDist:t,distUnit:s}),i},this.getLabelForDistUnit=(e,t)=>{let s="";return s=this.props.intl.formatMessage({id:"distanceUnitLabel",defaultMessage:a.distanceUnitLabel},{distanceLabel:e,unitLabel:t}),s},this.popUpContent=s.React.createRef(),this.symbolRef=s.React.createRef(),this.featureWidgetTitle=s.React.createRef(),this.planRouteAction=null,this.recordActionNames=[],this.recordActions={},this.props.config&&(this.state={isFeatureLayerOpen:this.props.isExpanded,isIconRight:!this.props.isExpanded,title:"",isTitleLoaded:!1,featureItem:null,actionElement:null})}render(){const e=this.props.selectedRecord,t=this.displayPopupTitle();let a,o=t;void 0!==e.feature.distance&&(a=this.props.intl.formatNumber(e.feature.distance,{maximumFractionDigits:2}),o=this.getAriaLabelString(o,a,this.props.distanceUnit));const n=(r=this.props.theme,s.css`


  margin: 2px 0px;
  
  .feature-title-container {
    display: inline-flex; 
    align-items: center;
    width: 100%;
    cursor: pointer;
    justify-content: space-between;
  }

  .pointer {
    cursor: pointer;
  }

  .record-container {
    border-left: 3px solid transparent;
  }

  .record-container .esri-features .esri-features__container {
    padding: 6px 12px 12px 12px !important;
  }

  .record-selected {
    border-left: 3px solid ${null!==(d=null===(l=null==r?void 0:r.sys.color)||void 0===l?void 0:l.primary.main)&&void 0!==d?d:"#16eaf1"};
  }

  .feature-title {
    padding: 5px 2px 5px 10px;
  }

  .label-title {
    margin: 0;
    padding-top: 3px;
    word-break: break-word;
  }

  .expand-list-label-title {
    padding-left: 10px;
  }

  .approximateDist-container {
    display: inline-flex; 
    align-items: center;
    width: 100%;
    padding: 5px 10px 5px 0;
  }

  .approximateDist-label{
    width: calc(100% - 60px);
    font-weight: bold;
    padding: 2px 0 0 10px;
  }

  .approximateDist{
    margin-bottom: 0px;
    width: 100px;
    text-align: end;
    padding-top: 3px;
  }

  .donutWidth {
    right: 26%;
  }

  .feature-title-map-symbol {
    margin-left: 10px;
    width: 20px;
  }

  .feature-widget-title-container {
    display: inline-flex; 
    align-items: center;
    width: 100%;
    padding: 5px 0px 4px 0;
  }

  .feature-widget-title {
    width: calc(100% - 44px);
    font-weight: bold;
    font-size: 14px;
    word-break: break-word;
    word-wrap: break-word;
    margin-left: 10px;
  }

  .nm-border-bottom-color {
    border-bottom: 1px solid #d5d5d5;
  }
  `);var r,l,d;return(0,s.jsx)("div",{style:{borderTop:"1px solid #d5d5d5"},className:"feature-container w-100 m-0",css:n},this.props.selectedFeatureLength>0&&this.props.popupTitleField&&!this.props.isExpanded&&(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(i.Row,{flow:"wrap"},(0,s.jsx)("div",{className:!this.props.approximateDistanceUI&&this.state.isFeatureLayerOpen?"feature-title-container nm-border-bottom-color":"feature-title-container",onClick:this.onToggleSelectedLayer.bind(this),tabIndex:0,role:"button","aria-label":o,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.props.isExpanded||this.onToggleSelectedLayer()},onMouseOver:()=>{this.props.highlightFeature(e,!0)},onMouseLeave:()=>{this.props.highlightFeature(e,!1)}},(0,s.jsx)("div",{className:"d-inline-flex"},this.props.displayMapSymbol&&(0,s.jsx)("div",{className:"feature-title-map-symbol",ref:this.symbolRef}),(0,s.jsx)("div",{className:"feature-title"},(0,s.jsx)(i.Label,{className:this.props.isExpanded?"label-title expand-list-label-title":"label-title"},t))),(0,s.jsx)("div",{className:"d-inline-flex"},void 0!==e.feature.distance&&this.props.showDistFromInputLocation&&(0,s.jsx)(i.Label,{className:"approximateDist pr-1"},this.getLabelForDistUnit(a,this.props.distanceUnit)),(0,s.jsx)(i.Button,{tabIndex:-1,type:"tertiary",icon:!0,role:"button","aria-expanded":this.state.isFeatureLayerOpen,className:"actionButton p-0"},this.state.isIconRight&&(0,s.jsx)(g,{size:"m",autoFlip:!0}),!this.state.isIconRight&&(0,s.jsx)(c,{size:"m"}))))),(0,s.jsx)(i.Collapse,{isOpen:this.state.isFeatureLayerOpen,className:"w-100"},this.state.featureItem)),this.props.popupTitleField&&this.props.isExpanded&&this.state.featureItem,1===this.props.selectedFeatureLength&&!this.props.popupTitleField&&this.state.featureItem,this.state.actionElement)}}var _e=L(21625),He=L(42735),Je=L(24883),$e=L(18717),qe=L(43751),Ze=L(59028),Qe=L(33142),Ke=L(71082),Xe=L(73387),Ye=L(21935),et=L.n(Ye),tt=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const st=e=>{const t=window.SVG,{className:i}=e,a=tt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:et()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var it=L(15710),at=L.n(it),ot=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const nt=e=>{const t=window.SVG,{className:i}=e,a=ot(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:at()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var rt=L(9044),lt=L.n(rt),dt=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const ct=e=>{const t=window.SVG,{className:i}=e,a=dt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:lt()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var ut=L(85633),ht=L(68972);class pt extends ht.default.PureComponent{constructor(e){super(e),this.componentDidMount=()=>{this.updateTextColor()},this.componentDidUpdate=e=>{e.fieldColor!==this.props.fieldColor&&this.updateTextColor()},this.updateTextColor=()=>{const e=this.getTextColor(this.props.fieldColor);this.setState({textColor:e})},this.onResize=({width:e,height:t})=>{e>0&&setTimeout((()=>{if(e<280)this.setState({fieldLabelWidth:"100%"});else{const e=this.summaryValue.current.offsetWidth+9,t=this.summaryField.current.offsetWidth,s=this.summaryCardParent.current.offsetWidth-16;(t+e<=s||s===t+8)&&e>0&&this.setState({fieldLabelWidth:"calc(100% - "+e+"px)"})}}),50)},this.getTextColor=e=>(299*parseInt(e.substr(1,2),16)+587*parseInt(e.substr(3,2),16)+114*parseInt(e.substr(4,2),16))/1e3<60?"#FFFFFF":"#000000",this.summaryValue=ht.default.createRef(),this.summaryField=ht.default.createRef(),this.summaryCardParent=ht.default.createRef(),this.widgetConRef=ht.default.createRef(),this.state={textColor:"",fieldLabelWidth:""}}render(){return(0,s.jsx)("div",{ref:this.widgetConRef,css:(this.props.theme,e=this.props.fieldColor,t=this.state.textColor,a=this.state.fieldLabelWidth,s.css`

  .summaryCard {
    margin: auto;
    width: 96%;
    align-items: center;
    display: flex;
    flex-flow: row wrap;
  }

  .field {
    width: ${a};
    font-weight: 500;
  }

  .summary-value {
    font-size: large;
  }

  .summaryBgColor {
    background-color: ${e};
  }

  .textColor {
    color: ${t};
  }`)},(0,s.jsx)(i.Row,{flow:"wrap"},(0,s.jsx)("div",{className:"summaryCard pl-2 pr-2 pt-5 pb-5 mb-2 rounded-lg summaryBgColor shadow-sm",ref:this.summaryCardParent},(0,s.jsx)("div",{ref:this.summaryField,className:"field textColor text-break mr-2"},(0,s.jsx)("label",{className:"w-100 mb-0"},this.props.fieldLabel)),this.props.summaryDisplayValue&&(0,s.jsx)("div",{ref:this.summaryValue},(0,s.jsx)("div",{className:"font-weight-bold summary-value textColor"},this.props.summaryDisplayValue)))),(0,s.jsx)(s.ReactResizeDetector,{targetRef:this.widgetConRef,handleWidth:!0,handleHeight:!0,onResize:this.onResize}));var e,t,a}}var gt=L(1888);class yt extends ht.default.PureComponent{constructor(e){super(e),this.componentDidMount=()=>{this.updateSummaryValue()},this.componentDidUpdate=e=>{e.sumOfAreaOrLengthValue!==this.props.sumOfAreaOrLengthValue&&this.updateSummaryValue()},this.updateSummaryValue=()=>{if(this.props.useDataSource&&this.props.summaryFieldInfos){this.resolvedSummaryValues=[];const e=[];this.props.summaryFieldInfos.forEach((t=>{var s;let i;const a=t.summaryFieldInfo;Object.prototype.hasOwnProperty.call(t.summaryFieldInfo,"summaryBy")?(i=null===(s=this.props.sumOfAreaOrLengthValue)||void 0===s?void 0:s.toString(),e.push(i),this.resolvedSummaryValues.push(i),1===this.props.summaryFieldInfos.length&&this.onTextExpResolveChange({})):(i=this.getExpressionString(a),e.push(i))})),this.setState({formattedExpression:e.join("")})}},this.getExpressionString=e=>{try{let t=JSON.stringify(e);t=encodeURIComponent(t);const{parts:i}=e;let a="",o="";null==i||i.forEach((e=>{const{dataSourceId:t}=e;if(t&&(a=t),""!==a)return!1}));const n=s.utils.getUUID();this.resolvedSummaryValues.push(n);const r=document&&document.createElement("exp");return r.setAttribute("data-uniqueid",n),r.setAttribute("data-dsid",a),r.setAttribute("data-expression",t),r.innerHTML=e.name,o+=r.outerHTML,o}catch(e){return console.error(e),""}},this.onTextExpResolveChange=e=>{const t={},i=[];this.resolvedSummaryValues.forEach(((a,o)=>{var n;let r=a;if(r=(null===(n=e[a])||void 0===n?void 0:n.isSuccessful)?e[a].value:this.props.summaryFieldInfos[o].fieldLabel,void 0!==r){const e=this.props.summaryFieldInfos[o];t[e.fieldLabel.replace(/ /g,"")]=r,i.push((0,s.jsx)(pt,{widgetId:this.props.widgetId,theme:this.props.theme,fieldLabel:e.fieldLabel,fieldColor:gt.colorUtils.getThemeColorVariableValue(this.props.singleFieldColor?this.props.singleFieldColor:e.fieldColor,this.props.theme),summaryDisplayValue:r,key:o}))}})),this.setState({summaryFieldCards:i}),this.props.onSummaryFieldsResolved(t)},this.resolvedSummaryValues=[],this.state={formattedExpression:null,summaryFieldCards:[]}}render(){const e={};return e[this.props.useDataSource.dataSourceId]=this.props.records,(0,s.jsx)(ht.default.Fragment,null,this.props.useDataSource&&this.state.formattedExpression&&(0,s.jsx)(ht.default.Fragment,null,0===this.state.summaryFieldCards.length&&(0,s.jsx)(s.ExpressionResolverComponent,{useDataSources:(0,s.Immutable)([this.props.useDataSource]),expression:i.richTextUtils.getAllExpressions(this.state.formattedExpression),records:e,onChange:this.onTextExpResolveChange,widgetId:this.props.widgetId}),this.state.summaryFieldCards))}}var mt=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};class ft extends s.WidgetVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.13.0",description:"To avoid crash, reset the previous configuration from beta release",upgrader:e=>{let t=e;if(t=t.setIn(["generalSettings","promptTextMessage"],""),t=t.setIn(["generalSettings","promptTextMsgStyleSettings"],{fontFamily:"Avenir Next",fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1,fontColor:"var(--ref-palette-black)",fontSize:"12px"}),t.configInfo)for(const e in t.configInfo)t=t.setIn(["configInfo",e],Se);return t}},{version:"1.14.0",description:"Upgrade search settings and analysis settings config",upgrader:e=>{let t=e;if(t.configInfo)for(const s in t.configInfo){const i=e.configInfo[s].searchSettings;t=t.setIn(["configInfo",s,"searchSettings","showInputAddress"],!0),t=t.setIn(["configInfo",s,"searchSettings","headingLabelStyle"],{fontFamily:"Avenir Next",fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1,fontColor:"var(--ref-palette-black)",fontSize:"13px"}),t=t.setIn(["configInfo",s,"searchSettings","sketchTools"],{showPoint:i.showSketchTools,showPolyline:i.showSketchTools,showPolygon:i.showSketchTools}),t=t.setIn(["configInfo",s,"analysisSettings","displayMapSymbols"],!1),t=t.setIn(["configInfo",s,"analysisSettings","showDistFromInputLocation"],i.showDistFromInputLocation),t=t.setIn(["configInfo",s,"analysisSettings","onlyShowLayersResult"],i.onlyShowLayersResult)}return t}},{version:"1.15.0",description:"Upgrade analysis setting config for fieldsToExport, group, sub-group and use data sources with fields",upgradeFullInfo:!0,upgrader:t=>mt(this,void 0,void 0,(function*(){let i=t.widgetJson.config;const a={subGroupFeaturesByField:"",subGroupFeaturesOrder:s.OrderRule.Asc,sortSubGroupsByCount:!1,noValueSubGroupLabel:""},o=[],n=[];if(i.configInfo){const e=s.DataSourceManager.getInstance();for(const t in i.configInfo)i.configInfo[t].analysisSettings.layersInfo.length>0&&i.configInfo[t].analysisSettings.layersInfo.forEach((t=>(t.useDataSource&&!n.includes(t.useDataSource.dataSourceId)&&(n.push(t.useDataSource.dataSourceId),o.push(e.createDataSourceByUseDataSource(t.useDataSource))),!1)))}if(yield Promise.allSettled(o),i.configInfo)for(const s in i.configInfo)i.configInfo[s].analysisSettings.layersInfo.length>0&&i.configInfo[s].analysisSettings.layersInfo.forEach(((o,n)=>{if(i=i.setIn(["configInfo",s,"analysisSettings","layersInfo",n,"analysisInfo","fieldsToExport"],j(o.useDataSource.dataSourceId)),o.analysisInfo.analysisType!==e.Summary&&(i=i.setIn(["configInfo",s,"analysisSettings","layersInfo",n,"analysisInfo","includeApproxDistance"],!1)),o.analysisInfo.analysisType===e.Proximity){const e=t.widgetJson.config.configInfo[s].analysisSettings.layersInfo[n].analysisInfo.sortGroupsByCount;i=i.setIn(["configInfo",s,"analysisSettings","layersInfo",n,"analysisInfo","groupFeatures","sortGroupsByCount"],e),i=i.setIn(["configInfo",s,"analysisSettings","layersInfo",n,"analysisInfo","groupFeatures","noValueGroupLabel"],""),i=i.setIn(["configInfo",s,"analysisSettings","layersInfo",n,"analysisInfo","subGroupFeatures"],a)}return!1}));let r=t.widgetJson.set("config",i);r=r.set("useDataSources",((t,s)=>{const i=t;let a=[];a||(a=[]);let o=[];s&&(o=s.map((e=>e.value)));for(const t in i)if(!s||o.includes(t)){const s=i[t].analysisSettings.layersInfo;null==s||s.forEach((s=>{var i,o,n,r,l,d,c,u,h;const p=s.analysisInfo,g=a.filter((e=>e.dataSourceId===s.useDataSource.dataSourceId));let y=(null==g?void 0:g.length)>0?g[0]:{dataSourceId:s.useDataSource.dataSourceId,mainDataSourceId:s.useDataSource.mainDataSourceId,rootDataSourceId:t,fields:[]};s.useDataSource.dataViewId&&(y={dataSourceId:s.useDataSource.dataSourceId,mainDataSourceId:s.useDataSource.mainDataSourceId,dataViewId:s.useDataSource.dataViewId,rootDataSourceId:t,fields:[]}),(p.analysisType===e.Closest||p.analysisType===e.Proximity||p.analysisType===e.Summary)&&(null===(i=p.fieldsToExport)||void 0===i?void 0:i.length)>0&&p.fieldsToExport.forEach((e=>{!y.fields.includes(e)&&"esriCTApproxDistance"!==e&&y.fields.push(e)})),p.analysisType===e.Proximity&&(null===(o=p.displayField)||void 0===o?void 0:o.length)>0&&!y.fields.includes(p.displayField)&&y.fields.push(p.displayField),(null===(r=null===(n=p.sortFeatures)||void 0===n?void 0:n.sortFeaturesByField)||void 0===r?void 0:r.length)>0&&!y.fields.includes(p.sortFeatures.sortFeaturesByField)&&y.fields.push(p.sortFeatures.sortFeaturesByField),(null===(d=null===(l=p.groupFeatures)||void 0===l?void 0:l.groupFeaturesByField)||void 0===d?void 0:d.length)>0&&!y.fields.includes(p.groupFeatures.groupFeaturesByField)&&y.fields.push(p.groupFeatures.groupFeaturesByField),(null===(u=null===(c=p.subGroupFeatures)||void 0===c?void 0:c.subGroupFeaturesByField)||void 0===u?void 0:u.length)>0&&!y.fields.includes(p.subGroupFeatures.subGroupFeaturesByField)&&y.fields.push(p.subGroupFeatures.subGroupFeaturesByField),p.analysisType===e.Summary&&(null===(h=p.summaryFields)||void 0===h||h.forEach((e=>{var t;null===(t=e.summaryFieldInfo.parts)||void 0===t||t.forEach((e=>{e.jimuFieldName&&!y.fields.includes(e.jimuFieldName)&&y.fields.push(e.jimuFieldName)}))}))),0===g.length&&a.push(y)}))}return a})(r.config.configInfo));return Object.assign(Object.assign({},t),{widgetJson:r})}))},{version:"1.16.0",description:"Upgrade analysis settings config",upgrader:t=>mt(this,void 0,void 0,(function*(){let i=t;const a=[],o=[],n=s.DataSourceManager.getInstance();if(i.configInfo)for(const e in i.configInfo)i=i.setIn(["configInfo",e,"analysisSettings","displayAllLayersResult"],!1),i.configInfo[e].analysisSettings.layersInfo.length>0&&i.configInfo[e].analysisSettings.layersInfo.forEach(((e,t)=>(e.useDataSource&&!o.includes(e.useDataSource.dataSourceId)&&(o.push(e.useDataSource.dataSourceId),a.push(n.createDataSourceByUseDataSource(e.useDataSource))),!1)));if(yield Promise.allSettled(a),i.configInfo)for(const t in i.configInfo)i=i.setIn(["configInfo",t,"analysisSettings","displayAllLayersResult"],!1),i=i.setIn(["configInfo",t,"analysisSettings","enableProximitySearch"],!1),i.configInfo[t].analysisSettings.layersInfo.length>0&&i.configInfo[t].analysisSettings.layersInfo.forEach(((s,a)=>{const o=n.getDataSource(s.useDataSource.dataSourceId);return"esriGeometryPolygon"!==(null==o?void 0:o.getGeometryType())||s.analysisInfo.analysisType!==e.Closest&&s.analysisInfo.analysisType!==e.Proximity||(i=i.setIn(["configInfo",t,"analysisSettings","layersInfo",a,"analysisInfo","returnIntersectedPolygons"],!1)),!1}));return i}))},{version:"1.17.0",description:"Upgrade analysis settings config in results section",upgrader:e=>{let t=e;const s={saveInputLocation:!1,pointFeature:{enabled:!1,useDataSource:null},polylineFeature:{enabled:!1,useDataSource:null},polygonFeature:{enabled:!1,useDataSource:null},searchAreaFeature:{enabled:!1,useDataSource:null}};if(t.configInfo)for(const e in t.configInfo)t=t.setIn(["configInfo",e,"analysisSettings","saveFeatures"],s);return t}},{version:"1.18.0",description:"Upgrade general settings config",upgrader:e=>mt(this,void 0,void 0,(function*(){let t=e;const i=yield(0,s.loadArcGISJSAPIModules)(["esri/Color"]),a=gt.colorUtils.getThemeColorVariableValue(t.generalSettings.highlightColor,(0,gt.getAppThemeVariables)()),o=new i[0](a);o.a=.3;const n=new i[0](a);n.a=1;const r={type:"esriSFS",color:o,outline:{type:"esriSLS",color:n,width:1.5,style:"esriSLSSolid"},style:"esriSFSSolid"};if(t&&(t=t.setIn(["generalSettings","searchAreaSymbol"],r),t=t.setIn(["generalSettings","keepResultsWhenClosed"],!0),t.configInfo))for(const e in t.configInfo)t=t.setIn(["configInfo",e,"searchSettings","activeToolWhenWidgetOpens"],"none");return t}))}]}}const vt=new ft;var bt=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};const St=Object.keys(ge);class wt extends s.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},a,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.handleLegendCreation()},this.getPageSizeInPixels=(e,t)=>({Height:ge[e].height*t,Width:ge[e].width*t}),this.getMapSizeInPixels=(e,t)=>({Height:ye[e].height*t,Width:ye[e].width*t}),this.getLegendSizeInPixels=(e,t)=>({Height:me[e].height*t,Width:me[e].width*t}),this.getPageWidthInPixels=()=>{let e;if(this.reportArea){const t=this.reportArea.layout;e=this.getPageSizeInPixels(t,this.reportArea.dpi)}return e.Width},this.getReportSizeMessage=()=>{const e=this.reportArea.layout,t=this.nls(e),s=" ("+ge[e].width+"'' X "+ge[e].height+"'') ";return this.props.intl.formatMessage({id:"reportDimensionsMsg",defaultMessage:a.reportDimensionsMsg},{paperSize:t+s})},this.handleLegendCreation=()=>{var e,s;null!=this.props.mapView.view&&(null===(s=null===(e=this.props.mapView)||void 0===e?void 0:e.view)||void 0===s||s.when((e=>bt(this,void 0,void 0,(function*(){var s;null!=this.legend&&(this.legend.destroy(),this.legend=null);const i=document.createElement("div"),[a]=yield(0,t.loadArcGISJSAPIModules)(["esri/widgets/Legend"]);this.legend=new a({container:i,view:e,respectLayerDefinitionExpression:!0,style:{type:"card",layout:"side-by-side"}}),"ready"!==(null===(s=this.legend.viewModel)||void 0===s?void 0:s.state)?ce.watch((()=>{var e;return null===(e=this.legend.viewModel)||void 0===e?void 0:e.state}),(e=>{"ready"===e&&this.setState({enableExportButton:!0})})):this.setState({enableExportButton:!0})})))))},this.formatAndRenderTables=(e,t)=>{const s=t.data,i=this.state.mergeRowsEnabled?t.groupFieldCol:null,o=this.state.mergeRowsEnabled?t.subgroupFieldCol:null;let n,r,l,d,c=3;if(s.maxNoOfCols&&(c=s.maxNoOfCols),s.cols.length>c){s.cols.length-c<=2&&(c=s.cols.length)}for(n=0,r=s.cols.length;n<r;n+=c){const r={cols:[],rows:[],title:"",totalCount:0,groupFieldCol:void 0,subgroupFieldCol:void 0};let u=n+c,h=!1;if(0===n){const e=this.props.intl.formatMessage({id:"totalCountLabel",defaultMessage:a.totalCountLabel},{tableTitle:t.title,total:t.totalCount});r.title=e}else r.title="";const p=s.cols.length-u;p<=2&&p>0&&(u+=p,h=!0),l=s.cols.slice(n,u),d=[];for(let e=0;e<s.rows.length;e++)d.push(s.rows[e].slice(n,u));r.cols=l,r.rows=d;const g=document.createElement("div");if(g.className="esriCTSectionTitle",g.innerHTML=r.title,e.appendChild(g),0===n&&(null!=i&&(r.groupFieldCol=i),null!=o&&(r.subgroupFieldCol=o)),this.renderTable(e,r,t.data.showRowIndex),h)break}return e},this.renderTable=(e,t,s)=>{const i=document.createElement("table");i.className="esriCTTable",i.style.width="100%",e.appendChild(i);const a=document.createElement("tbody");i.appendChild(a);const o=document.createElement("tr");if(a.appendChild(o),s){const e=document.createElement("th");e.innerHTML="#",e.style.width="50px",e.style.wordBreak="break-word",e.style.padding="4px",o.appendChild(e)}t.cols.forEach((e=>{const t=document.createElement("th");t.innerHTML=e,t.style.wordBreak="break-word",t.style.padding="4px",o.appendChild(t)})),t.rows.forEach(((e,t)=>{const i=document.createElement("tr");if(a.appendChild(i),s){const e=document.createElement("td");e.style.padding="4px",e.style.wordBreak="break-word",e.style.wordBreak="normal",e.innerHTML=t+1,i.appendChild(e)}e.forEach((e=>{const t=document.createElement("td");t.style.padding="4px",e===this.nls("noData")&&(t.style.fontStyle="italic"),t.innerHTML=e,i.appendChild(t)}))})),void 0!==t.groupFieldCol&&this.addRowSpans(i,[t.subgroupFieldCol,t.groupFieldCol])},this.renderHtmlContent=()=>{const e=document.createElement("div");let t;return this.props.reportData.forEach((s=>{t=this.formatAndRenderTables(e,s)})),t},this.onTemplateChange=e=>{this.setState({template:e.target.value});const t=St.filter((t=>e.target.value===t));this.reportArea.layout=t[0],t[0].includes(fe.Portrait)?this.reportArea.orientation=fe.Portrait:this.reportArea.orientation=fe.Landscape},this.titleLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({templateTitle:null!=t?t:t.trim()})}},this.getReportTemplate=()=>bt(this,void 0,void 0,(function*(){var e,t,s,i,a,o,n,r;const l=this.state.templateTitle,d=this.getPageWidthInPixels(),c=this.getLegendSizeInPixels(this.reportArea.layout,this.reportArea.dpi).Height-8,u=Math.trunc(d/200),h=["200px"];for(let e=1;e<u;e++)h.push("200px");const p=this.getReportSizeMessage(),g=this.renderHtmlContent();this.scaleBar=this.handleScaleBar(),this.compass=this.handleCompass(),this.attribution=this.handleAttribution();const y=yield this.viewScreenshot(),m=`${this.props.folderUrl}dist/runtime/assets/js/print.js`;let f="28px",v="18px";switch(this.reportArea.layout){case"a3Portrait":case"a4Landscape":case"letterAnsiALandscape":f="28px",v="27px";break;case"a3Landscape":f="42px",v="40px";break;case"a4Portrait":f="20px",v="18px";break;case"letterAnsiAPortrait":f="20px",v="19px";break;case"tabloidAnsiBPortrait":f="26px",v="25px";break;case"tabloidAnsiBLandscape":f="41px",v="40px"}return`\n      <!DOCTYPE HTML>\n      <html lang="en" dir="ltr">\n        <head id="reportHead">\n            <meta charset="utf-8">\n            <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">\n            <title></title>\n            \x3c!-- Report prev page css --\x3e\n            <style type="text/css">\n                .esriCTReportMapWait {\n                    height: 5px;\n                    width: 100%;\n                    position: relative;\n                    overflow: hidden;\n                    background-color: #ddd;\n                }\n\n                .esriCTReportMapWait:before {\n                    display: block;\n                    position: absolute;\n                    content: "";\n                    left: -200px;\n                    width: 200px;\n                    height: 5px;\n                    background-color: #2980b9;\n                    animation: loading 2s linear infinite;\n                }\n\n                .display-none {\n                  display: none;\n                }\n\n                .esrCTAOIInfoDiv {\n                  position: relative;\n                  margin-top: 8px;\n                }\n\n                .jimu-rtl .esrCTAOIInfoDiv {\n                  direction: rtl;\n                }\n\n                .esriAOITitle {\n                  font-size: 18px;\n                  font-weight: bold;\n                  color: #000000;\n                  width: 100%;\n                }\n\n                .esriCTAOITitleInput {\n                  font-size: 18px;\n                  font-weight: bold;\n                  color: #000000;\n                  width: 100%;\n                  border: none;\n                  padding: 0px;\n                }\n\n                .esriCTAOIArea {\n                  visibility: ${this.props.showAreaOfInterest?"visible":"hidden"};\n                  margin: 10px 0;\n                  font-size: 16px;\n                }\n\n                .esriCTAOIInputArea {\n                  border: none;\n                  font-size: 16px;\n                  width: 100%;\n                  padding: 0px;\n                }\n\n                .esriCTPrintLocaleDateDiv {\n                  margin: 10px 0;\n                  font-size: 16px;\n                }\n\n                .esriCTLocaleDateInputTitle {\n                  height: 30px;\n                  line-height: 30px;\n                  border: none;\n                  font-size: 16px;\n                  width: 100%;\n                  padding: 0px;\n                }\n\n                .compassContainer {\n                  display: ${(null===(e=this.compass)||void 0===e?void 0:e.innerHTML)?"block":"none"};\n                  position: absolute;\n                  top: 45px;\n                  left: 45px;\n                  background: #fff;\n                  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);\n                  --calcite-ui-icon-color: #000;\n                  border-radius: 50%;\n                }\n\n                .compassContainer .esri-compass {\n                  border-radius: 50%;\n                }\n\n                .compassContainer .esri-compass__icon.esri-icon-compass {\n                  color: #000;\n                }\n\n                .compassContainer .esri-widget--button {\n                  text-align: center;\n                  flex-flow: row;\n                  justify-content: center;\n                  align-items: center;\n                  width: 32px;\n                  height: 32px;\n                  margin: 0;\n                  padding: 0;\n                  font-size: 12px;\n                  transition: background-color .125s ease-in-out;\n                  display: flex;\n                  overflow: hidden;\n                }\n\n                .compassContainer .esri-compass__icon-container {\n                  justify-content: center;\n                  display: flex;\n                }\n\n                .scaleBarContainer {\n                  display: ${"3d"!==this.props.mapView.view.type&&(null===(t=this.scaleBar)||void 0===t?void 0:t.innerHTML)?"block":"none"};\n                  position: absolute;\n                  bottom: 4px;\n                  left: ${v};\n                }\n\n                .print__scale-bar-container .esri-scale-bar__label {\n                  color: #323232;\n                  font-size: 10px;\n                  padding: 0 4px;\n                }\n\n                .scaleBarContainer .esri-scale-bar__bar-container:nth-child(1n+3) {\n                    display: none;\n                }\n\n                .scaleBarContainer .esri-scale-bar__line--bottom {\n                  width: ${this.scaleWidth} !important;\n                  border-top: 2px solid #323232;\n                  \n                }\n\n                .scaleBarContainer .esri-scale-bar__label-container .esri-scale-bar__label {\n                  border-left: 1px solid #323232;\n                  border-right: 2px solid #323232;\n                  background-color: rgba(255, 255, 255, 0.66);\n                }\n\n                .scaleBarContainer .esri-scale-bar__line--top:before,\n                .scaleBarContainer .esri-scale-bar__line--top:after,\n                .scaleBarContainer .esri-scale-bar__line--bottom:before,\n                .scaleBarContainer .esri-scale-bar__line--bottom:after {\n                    background-color: #323232;\n                    border-right: 2px solid #323232;\n                }\n\n                .scale-attribution {\n                  position: absolute;\n                  bottom: 5px;\n                  right: ${f};\n                  text-align: right;\n                  max-width: calc(100% - ${"2d"===this.props.mapView.view.type?"300px":"80px"});\n\t\t              display: ${(null===(s=this.attribution)||void 0===s?void 0:s.innerHTML)?"block":"none"};\n                }\n\n                .attribution-group {\n                  width: 100%;\n                  display: flex;\n                  align-items: flex-start;\n                }\n\n                .shell-attribution {\n                  width: 100% !important;\n                  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.20);\n                }\n\n                .attribution-ui {\n                  pointer-events: auto;\n                  position: relative;\n                }\n\n                .attributionContainer {\n                  position: relative;\n                  color: #323232;\n                  background-color: rgba(255, 255, 255, 0.65);\n                  flex-flow: column;\n                  justify-content: space-between;\n                  align-items: center;\n                  font-size: 12px;\n                  line-height: 16px;\n                  display: flex;\n                }\n\n                .attributionContainer .esri-attribution__sources {\n                  flex: 1 0;\n                  align-self: flex-start;\n                  padding: 0 5px;\n                  font-weight: 300;\n                  overflow: hidden;\n                }\n\n                .attributionContainer .esri-attribution__powered-by {\n                  text-align: right;\n                  white-space: nowrap;\n                  align-self: flex-end;\n                  padding: 0 5px;\n                  font-weight: 400;\n                }\n\n                .printLegendContainer {\n                    background: #fff;\n                    width: 98%;\n                    max-height: ${this.state.limitLegend?c+"px":"auto"};\n                    margin: 20px 2%;\n                    display: block;\n                    overflow: ${this.state.limitLegend?"hidden":"initial"};\n                }\n\n                .jimu-rtl .printLegendContainer {\n                    direction: rtl;\n                }\n\n                .esri-legend {\n                    overflow: hidden auto;\n                }\n\n                .esri-widget {\n                    --esri-widget-padding-x: 15px;\n                    --esri-widget-padding-y: 12px;\n                    --esri-widget-padding: var(--esri-widget-padding-y) var(--esri-widget-padding-x);\n                    box-sizing: border-box;\n                    color: #323232;\n                    background-color: #fff;\n                    font-family: Avenir Next, Helvetica Neue, helvetica, arial, sans-serif;\n                    font-size: 14px;\n                    line-height: 1.3em;\n                }\n\n                .printLegendContainer .esri-legend--card {\n                    border: none;\n                    gap: 6pt 12pt;\n                    display: grid;\n                    grid-template-columns: ${h.join(" ")};\n                }\n\n                .esri-legend--card,\n                .esri-legend--card__service-content {\n                    flex-flow: row wrap;\n                }\n\n                .esri-legend--card__service-content {\n                    height: calc(100% - 60px);\n                    display: flex;\n                }\n\n                .printLegendContainer .esri-widget>*:not(.esri-scale-bar.esri-widget > *) {\n                    background: #fff;\n                    color: #323232;\n                }\n\n                .esri-legend--card {\n                    transition: max-width .25s ease-in-out;\n                    display: flex;\n                    position: relative;\n                }\n\n                .printLegendContainer .esri-legend--card__section {\n                    padding: 0pt 0 0pt;\n                    min-width: unset;\n                }\n\n                .printLegendContainer .esri-legend--card__section:first-child {\n                    border-left: none;\n                }\n\n                .esri-legend--card__section {\n                    font-size: 12px;\n                    overflow: visible;\n                }\n\n                .printLegendContainer .esri-legend--card__service {\n                    border: none;\n                    flex: 0 1 auto;\n                    break-inside: avoid;\n                }\n\n                section.esri-legend--card__service.esri-legend--card__group-layer-child {\n                    margin: ${this.props.isRTL?"10px 10px 0 0":"10px 0 0 10px"}\n                }\n\n                .esri-legend--card__service {\n                    min-width: fit-content;\n                }\n\n                .printLegendContainer .esri-legend--card__service-caption-container {\n                    padding: 0;\n                    border-bottom: none;\n                }\n\n                .esri-legend--card__service-caption-container {\n                    font-weight: 600;\n                }\n\n                .printLegendContainer .esri-legend--card__service-caption-text {\n                    padding-bottom: 4px;\n                    word-break: break-word;\n                }\n\n                .esri-legend--card__service-caption-text {\n                    margin: 0;\n                    overflow: auto;\n                }\n\n                .esri-legend--card__label-container {\n                    margin-bottom: 10px;\n                    flex-wrap: wrap;\n                    display: flex;\n                    column-gap: 20px;\n                    row-gap: 10px;\n                }\n                \n                .esri-legend--card__label-element {\n                    min-height: 23px;\n                    min-width: 30px;\n                }\n\n                .esriCTReportMapImg {\n                    margin-top: 10px;\n                    border: 1px solid black;\n                }\n\n                @keyframes loading {\n                    from {\n                        left: -200px;\n                        width: 30%;\n                    }\n\n                    50% {\n                        width: 30%;\n                    }\n\n                    70% {\n                        width: 70%;\n                    }\n\n                    80% {\n                        left: 50%;\n                    }\n\n                    95% {\n                        left: 120%;\n                    }\n\n                    to {\n                        left: 100%;\n                    }\n                }\n\n                .esriCTHTMLData {\n                    position: relative;\n                    width: 100%;\n                    height: auto;\n                }\n\n                .jimu-rtl .esriCTHTMLData {\n                    direction: rtl;\n                }\n\n                .esriCTTable {\n                    margin-top: 10px;\n                    padding: 0;\n                    border-collapse: collapse;\n                    border-spacing: 0;\n                    width: 100%;\n                    page-break-inside: avoid;\n                    table-layout: fixed;\n                }\n\n                .jimu-rtl .esriCTTable {\n                    direction: rtl;\n                }\n\n                .esriCTTable th {\n                    border: 1px solid gray;\n                    background-color: ${this.props.theme.ref.palette.primary[100]};\n                    word-wrap: break-word;\n                }\n\n                .esriCTTable td {\n                    border: 1px solid gray;\n                    word-wrap: break-word;\n                }\n\n                .esriCTSectionTitle {\n                    font-size: 18px;\n                    font-weight: bold;\n                    margin: 15px 0px;\n                    width: calc(100% - 10px);\n                    word-break: break-all;\n                }\n\n                .jimu-rtl .esriCTSectionTitle {\n                    direction: rtl;\n                }\n\n                .jimu-rtl .esriCTReportMap .esriCTSectionTitle {\n                    float: none;\n                }\n\n                .esriCTReportLogo {\n                    float: left;\n                    max-width: calc(50% - 10px);\n                    margin: auto 10px auto 0;\n                    max-height: 90%;\n                    position: absolute;\n                    top: 0;\n                    bottom: 0;\n                }\n\n                .jimu-rtl .esriCTReportLogo {\n                    float: right;\n                    margin: auto 0 auto 10px;\n                }\n\n                .esriCTPrintTitleDiv {\n                    height: 56px;\n                    float: left;\n                    width: 100%;\n                }\n\n                .jimu-rtl .esriCTPrintTitleDiv {\n                    float: right;\n                    direction: rtl;\n                }\n\n                .esriCTInputTitle {\n                    height: 55px;\n                    line-height: 55px;\n                    border: none;\n                    font-size: 25px;\n                    width: 100%;\n                    padding: 0px;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    white-space: nowrap;\n                }\n\n                .esriCTInputTitle::-ms-clear {\n                    display: none;\n                }\n\n                .esriCTReportMain {\n                    background: #FFF;\n                    border: solid 1px #000;\n                    margin: 0 auto;\n                    padding: 20px;\n                    width: 797px;\n                }\n\n                .esriCTReportMap {\n                    text-align: center;\n                }\n\n                .esriCTReportLandscapeMapImg {\n                    max-width: 80%;\n                }\n\n                .esriCTReportMapFail {\n                    height: 50px;\n                }\n\n                .esriCTPrintPage {\n                    padding: 30px 0;\n                    margin: 20px auto;\n                    font-family: arial, sans-serif;\n                    font-size: 13px;\n                }\n\n                .jimu-rtl {\n                    padding: 30px 0;\n                    margin: 20px auto;\n                    font-family: arial, sans-serif;\n                    font-size: 13px;\n                }\n\n                .esriCTReportBar {\n                    width: 100%;\n                    position: fixed;\n                    left: 0;\n                    top: 0;\n                    z-index: 6;\n                    height: 50px;\n                    background: #e2f1fc;\n                    border-bottom: 1px solid #000;\n                }\n\n                .jimu-rtl .esriCTReportBar {\n                    left: inherit;\n                    right: 0;\n                }\n\n                .esriCTPrintButton,\n                .esriCTCloseButton {\n                    color: #444;\n                    font-family: Verdana, Helvetica, sans-serif;\n                    font-size: 12px;\n                    -moz-border-radius: 3px;\n                    -webkit-border-radius: 3px;\n                    border-radius: 3px;\n                    border: 1px solid #8b8b8b;\n                    box-shadow: none;\n                    -webkit-box-shadow: none;\n                    background: #F2F2F2;\n                    background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\n                    background: -moz-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\n                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #F2F2F2), color-stop(100%, #D1D1D1));\n                    background: -webkit-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\n                    background: -o-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\n                    background: -ms-linear-gradient(top, #F2F2F2 0%, #D1D1D1 100%);\n                    background: linear-gradient(to bottom, #F2F2F2 0%, #D1D1D1 100%);\n                    filter: progid: DXImageTransform.Microsoft.gradient(startColorstr='#F2F2F2', endColorstr='#D1D1D1', GradientType=0);\n                    margin: 10px 20px;\n                    line-height: 16px;\n                    display: block;\n                    padding: 5px 10px;\n                    outline: 0;\n                    text-decoration: none;\n                    cursor: pointer;\n                    font-weight: 400;\n                    white-space: nowrap;\n                    float: right;\n                }\n\n                .jimu-rtl .esriCTPrintButton,\n                .jimu-rtl .esriCTCloseButton {\n                    float: left;\n                }\n\n                .esriCTPrintButton:hover,\n                .esriCTPrintButton:focus,\n                .esriCTCloseButton:hover,\n                .esriCTCloseButton:focus {\n                    background: #E5E6E6;\n                    background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlNWU1ZTUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\n                    background: -moz-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\n                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #E5E6E6), color-stop(100%, #A0A1A1));\n                    background: -webkit-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\n                    background: -o-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\n                    background: -ms-linear-gradient(top, #E5E6E6 0%, #A0A1A1 100%);\n                    background: linear-gradient(to bottom, #E5E6E6 0%, #A0A1A1 100%);\n                    filter: progid: DXImageTransform.Microsoft.gradient(startColorstr='#E5E6E6', endColorstr='#A0A1A1', GradientType=0);\n                }\n\n                .esriCTReportHeader {\n                    display: block;\n                    width: 100%;\n                    height: 60px;\n                    border-bottom: 1px solid #000;\n                    margin-bottom: 5px;\n                    position: relative;\n                }\n\n                .esriCTReportBarMsg {\n                    text-align: center;\n                    margin-top: 16px;\n                }\n\n                .jimu-rtl .esriCTReportBarMsg {\n                    direction: rtl;\n                }\n\n                .esriCTHidden {\n                    display: none;\n                }\n            </style>\n            \x3c!-- Media print css --\x3e\n            <style type="text/css" media="print">\n                .esriCTPrintPage {\n                    padding: 0;\n                    color: #000;\n                    margin: 0;\n                    float: none;\n                    background: #fff url(none);\n                }\n\n                .esriCTTable {\n                    border-spacing: 0;\n                    margin-top: 10px;\n                    padding: 0;\n                    width: 100%;\n                    page-break-inside: avoid;\n                    table-layout: fixed;\n                }\n\n                .printLegendContainer {\n                  page-break-after: always;\n                }\n\n                .esriCTPageBreak {\n                    page-break-after: always;\n                }\n\n                .esriCTReportBar {\n                    display: none;\n                }\n\n                .esriCTReportMain {\n                    border: none;\n                }\n\n                .esriCTTable th {\n                    border: 1px solid gray;\n                    background-color: ${this.props.theme.ref.palette.primary[100]};\n                    -webkit-print-color-adjust: exact;\n                    color-adjust: exact;\n                    word-wrap: break-word;\n                }\n\n                .esriCTTable td {\n                    border: 1px solid gray;\n                }\n\n                .esriCTTable tr {\n                    page-break-inside: avoid;\n                    page-break-after: auto;\n                }\n            </style>\n        </head>\n\n        <body id="reportBody" class=${this.props.isRTL?"jimu-rtl":"esriCTPrintPage"}>\n          <div class="esriCTReportBar">\n            <div id="closeButton" class="esriCTCloseButton" title="Close">${this.nls("close")}</div>\n            <div id="printButton" class="esriCTPrintButton" title="Print">${this.nls("print")}</div>\n            <div id="reportBarMsg" class="esriCTReportBarMsg">${p}</div>\n          </div>\n          <div id="reportMain" style="width: ${d}px" class="esriCTReportMain">\n            <div id="reportHeader" class="esriCTReportHeader">\n              <img id="reportLogo" class="esriCTReportLogo esriCTHidden" src="">\n              <div id="printTitleDiv" class="esriCTPrintTitleDiv">\n                <div class="esriCTInputTitle">${l}</div>\n              </div>\n            </div>\n            <div class='esrCTAOIInfoDiv'>\n              <div class='esriAOITitle'>\n               <input class='esriCTAOITitleInput' tabindex='0' type='text' value='${this.nls("areaOfInterestLabel")}' role='textbox' aria-label=${this.nls("areaOfInterestLabel")}>\n              </div>\n              <div class='esriCTAOIArea'>\n                <input class='esriCTAOIInputArea' tabindex='0' type='text' value='${this.aoiValueLabel()}' role='textbox' aria-label='${this.aoiValueLabel()}'>\n              </div>\n              <div class='esriCTPrintLocaleDateDiv'>\n                <input type='text' tabindex='0' class='esriCTLocaleDateInputTitle' value='${this.dateValueLabel()}' role='textbox' aria-label='${this.dateValueLabel()}'>\n              </div>\n            </div>\n            <div style="text-align: center;position: relative;">\n              <img class='esriCTReportMapImg' src=${y}></img>\n              <div class="compassContainer">${null===(i=this.compass)||void 0===i?void 0:i.innerHTML}</div>\n              <div class="scaleBarContainer">${null===(a=this.scaleBar)||void 0===a?void 0:a.innerHTML}</div>\n              <div class="scale-attribution">\n                <div class="attribution-group">\n                  <div class="shell-attribution">\n                    <div class="attribution-ui">\n                      <div class="attributionContainer">${null===(o=this.attribution)||void 0===o?void 0:o.innerHTML}</div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div id="legendDiv" class=${this.state.legendEnabled?"printLegendContainer":"display-none"}>\n              ${null===(r=null===(n=this.legend)||void 0===n?void 0:n.container)||void 0===r?void 0:r.innerHTML}\n            </div>\n            <div id="reportData">${g.innerHTML}</div>\n          </div>\n          <script src='${m}'><\/script>\n        </body>\n      </html>\n    `})),this.aoiValueLabel=()=>{let e="";return e=this.props.intl.formatMessage({id:"aoiValueLabel",defaultMessage:a.aoiValueLabel},{areaValue:this.props.aoiValue}),e},this.dateValueLabel=()=>{let e="";const t=new Date(Date.now());return e=this.props.intl.formatMessage({id:"dateValueLabel",defaultMessage:a.dateValueLabel},{dateValue:null==t?void 0:t.toString()}),e},this.exportOnClick=()=>bt(this,void 0,void 0,(function*(){this.props.onReportExported();const e=yield this.getReportTemplate(),t=new Blob([e],{type:"text/html"}),s=URL.createObjectURL(t);window.open(s,"_blank")})),this.handleAttribution=()=>{var e,t,s,i,a,o;if(null!=this.props.mapView.view){const n=this.props.mapView.jimuMapTools.filter((e=>"Attribution"===e.name)),r=null===(t=null===(e=null==n?void 0:n[0])||void 0===e?void 0:e.instance)||void 0===t?void 0:t.container;if((null===(o=null===(a=null===(i=null===(s=null==n?void 0:n[0])||void 0===s?void 0:s.instance)||void 0===i?void 0:i.container)||void 0===a?void 0:a.className)||void 0===o?void 0:o.includes("esri-attribution"))&&null!=r&&"string"!=typeof r)return r.cloneNode(!0)}},this.handleCompass=()=>{var e,t,s,i,a,o;if(null!=this.props.mapView.view){const n=this.props.mapView.jimuMapTools.filter((e=>"Compass"===e.name)),r=null===(t=null===(e=null==n?void 0:n[0])||void 0===e?void 0:e.instance)||void 0===t?void 0:t.container;if((null===(o=null===(a=null===(i=null===(s=null==n?void 0:n[0])||void 0===s?void 0:s.instance)||void 0===i?void 0:i.container)||void 0===a?void 0:a.className)||void 0===o?void 0:o.includes("esri-compass"))&&null!=r&&"string"!=typeof r){const e=r.cloneNode(!0);return e.children[0].children[0].children[0].innerHTML='<svg aria-hidden="true" fill="currentColor" height="25" width="25" xmlns="http://www.w3.org/2000/svg" class=" svg " viewBox="0 0 24 24">\x3c!--?lit$499456230$--\x3e\x3c!----\x3e<path d="M12 22.981l4.12-11.49L12 1.149 7.88 11.49zM9.125 12h5.75L12 20.019z"></path>\x3c!----\x3e</svg>',e}}},this.handleScaleBar=()=>{var e,t,s,i,a,o;if(null!=this.props.mapView.view){const n=this.props.mapView.jimuMapTools.filter((e=>"ScaleBar"===e.name)),r=null===(t=null===(e=null==n?void 0:n[0])||void 0===e?void 0:e.instance)||void 0===t?void 0:t.container;if((null===(o=null===(a=null===(i=null===(s=null==n?void 0:n[0])||void 0===s?void 0:s.instance)||void 0===i?void 0:i.container)||void 0===a?void 0:a.className)||void 0===o?void 0:o.includes("esri-scale-bar"))&&null!=r&&"string"!=typeof r)return r.cloneNode(!0)}},this.viewScreenshot=()=>bt(this,void 0,void 0,(function*(){const e=this.getMapSizeInPixels(this.reportArea.layout,this.reportArea.dpi),t=this.getLegendSizeInPixels(this.reportArea.layout,this.reportArea.dpi),s=e.Width,i=this.state.legendEnabled?e.Height:e.Height+t.Height+30;return this.screenshot=yield this.props.mapView.view.takeScreenshot({width:s/100*95,height:i/100*95}),this.handleScaleBarSize(),this.screenshot.dataUrl})),this.handleScaleBarSize=()=>{if(this.scaleBar){const e=this.scaleBar.querySelector(".esri-scale-bar__line--bottom");this.scaleWidth=this.getScaleBarWidth(e)}},this.getScaleBarWidth=e=>{if(null!=e&&null!=this.screenshot){const t=this.screenshot.data.width/2;return Number(e.style.width.replace("px",""))/t*100}return null},this.onLegendOptionChange=e=>{this.setState({legendEnabled:e.target.checked})},this.onMergeRowsOptionChange=e=>{this.setState({mergeRowsEnabled:e.target.checked})},this.reportArea={layout:"a4Portrait",orientation:fe.Portrait,dpi:96},this.legend=null,this.scaleBar=null,this.screenshot=null,this.scaleWidth=null,this.compass=null,this.attribution=null,this.state={enableExportButton:!1,template:"a4Portrait",templateTitle:this.nls("defaultReportTitle"),legendEnabled:!0,mergeRowsEnabled:!1,limitLegend:!0}}addRowSpans(e,t){if(!e)return;const s=e.rows;t.forEach(((e,i)=>{var a,o,n;const r=0===i;if(null==e)return;let l=null,d=null,c=0;for(let i=0;i<s.length;i++){const u=s[i].cells[e];let h=null;if(!u)continue;r&&(h=s[i].cells[t[1]].textContent);const p=u.textContent;p!==l||r&&h!==d?(i>c&&(null===(a=s[c])||void 0===a?void 0:a.cells[e])&&(s[c].cells[e].rowSpan=i-c),l=p,d=h,c=i,s.length>c&&c>=0&&e>=0&&(null===(n=null===(o=s[c])||void 0===o?void 0:o.cells)||void 0===n?void 0:n[e])&&(s[c].cells[e].rowSpan=s.length-c)):u&&u.remove&&u.remove()}}))}render(){return(0,s.jsx)("div",{style:{width:200}},(0,s.jsx)("div",null,(0,s.jsx)(i.Label,{"aria-label":this.nls("template"),className:"text-break"},this.nls("template"))),(0,s.jsx)("div",null,(0,s.jsx)(i.Select,{"aria-label":this.nls("template"),className:"pt-1",name:"template",size:"sm",value:this.state.template,onChange:this.onTemplateChange},St.map((e=>(0,s.jsx)(i.Option,{role:"option","aria-label":this.nls(e),key:e,value:e},this.nls(e)))))),(0,s.jsx)("div",{className:"pt-3"},(0,s.jsx)(i.Label,{"aria-label":this.nls("title"),className:"text-break"},this.nls("title"))),(0,s.jsx)("div",null,(0,s.jsx)(i.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("title"),title:this.state.templateTitle,size:"sm",value:this.state.templateTitle,onChange:this.titleLabelChange})),(0,s.jsx)("div",{className:"pt-3 d-flex"},(0,s.jsx)(i.Label,{className:"w-100 pr-2"},this.nls("LegendLabel")),(0,s.jsx)(i.Switch,{role:"switch","aria-label":this.nls("LegendLabel"),title:this.nls("LegendLabel"),checked:this.state.legendEnabled,onChange:this.onLegendOptionChange})),this.props.isGroupingEnabled&&(0,s.jsx)("div",{className:"pt-3 d-flex"},(0,s.jsx)(i.Label,{"aria-label":this.nls("mergeRowsLabel"),className:"w-100 d-flex"},(0,s.jsx)("div",{className:"flex-grow-1 text-break"},this.nls("mergeRowsLabel"))),(0,s.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("mergeRowsTooltip"),title:this.nls("mergeRowsTooltip"),showArrow:!0,placement:"top"},(0,s.jsx)("div",{className:"title3 text-default mr-4 d-inline"},(0,s.jsx)(Oe,null))),(0,s.jsx)(i.Switch,{role:"switch",className:"mt-1","aria-label":this.nls("mergeRowsLabel"),title:this.nls("mergeRowsLabel"),checked:this.state.mergeRowsEnabled,onChange:this.onMergeRowsOptionChange})),(0,s.jsx)("div",{className:"pt-3"},(0,s.jsx)(i.Button,{role:"button",disabled:!this.state.enableExportButton,className:"text-break w-100",size:"default",type:"primary",onClick:this.exportOnClick},this.nls("exportBtnTitle"))))}}var xt=L(37568),It=L.n(xt),At=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Dt=e=>{const t=window.SVG,{className:i}=e,a=At(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:It()},a)):s.React.createElement("svg",Object.assign({className:o},a))};var Ft=L(11092),Ct=function(e,t,s,i){return new(s||(s=Promise))((function(a,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function r(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}l((i=i.apply(e,t||[])).next())}))};const Lt=L(52349),Mt=L(96807),Tt=L(57687),jt=L(68269);class Ot extends s.BaseWidget{constructor(o){super(o),this.aoiToolRef=s.React.createRef(),this.dropdownRef=s.React.createRef(),this.widgetConRef=s.React.createRef(),this.abortControllerRef=[],this.nls=e=>{var t;const s=Object.assign({},a,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>Ct(this,void 0,void 0,(function*(){var e,t,s;Ze.isLoaded()||(yield Ze.load()),$e.isLoaded()||(yield $e.load()),Qe.isLoaded()||(yield Qe.load()),(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedDataSource)&&this.props.selectedDataSource?this.setState({promptForDataAction:!0}):(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.selectedIncidentLocation)&&this.geometriesByDsIdFromAction(null===(s=this.props)||void 0===s?void 0:s.selectedIncidentLocation)})),this.componentDidUpdate=(e,i)=>{var a,o,n,r,l,d,c,u,h,p,g,y,m,f,v,b,S,w,x,A,D,C,L,M,T,j,O,R,P,E,B,k,V,G,N,U,z,W,_,H;const J=null===(n=null===(o=null===(a=(0,s.getAppStore)())||void 0===a?void 0:a.getState())||void 0===o?void 0:o.widgetsRuntimeInfo[this.props.id])||void 0===n?void 0:n.state;if(J===s.WidgetState.Opened||!J||J===s.WidgetState.Hidden){if(null===(r=this.props)||void 0===r?void 0:r.selectedIncidentLocation){const t=null===(l=this.props)||void 0===l?void 0:l.selectedIncidentLocation;!t||e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedIncidentLocation&&(null===(d=null==e?void 0:e.mutableStatePropsVersion)||void 0===d?void 0:d.selectedIncidentLocation)===(null===(c=this.props.mutableStatePropsVersion)||void 0===c?void 0:c.selectedIncidentLocation)||this.geometriesByDsIdFromAction(t)}(null===(u=this.props)||void 0===u?void 0:u.selectedDataSource)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedDataSource&&(null===(h=null==e?void 0:e.mutableStatePropsVersion)||void 0===h?void 0:h.selectedDataSource)===(null===(p=this.props.mutableStatePropsVersion)||void 0===p?void 0:p.selectedDataSource)||this.setState({promptForDataAction:!0}))}if(this.props.state===e.state||J!==s.WidgetState.Closed&&J!==s.WidgetState.Hidden||(this.setState({widgetClosed:!0}),this.props.config.generalSettings.keepResultsWhenClosed||null===(y=null===(g=this.aoiToolRef)||void 0===g?void 0:g.current)||void 0===y||y.clearAll()),this.props.state!==e.state&&J===s.WidgetState.Opened&&this.setState({widgetClosed:!1}),e.useMapWidgetIds!==this.props.useMapWidgetIds){const e=t.MapViewManager.getInstance().getJimuMapViewById(null===(m=this.state.jimuMapView)||void 0===m?void 0:m.id);e&&this.setState({jimuMapView:e})}if((null===(f=i.state)||void 0===f?void 0:f.activeDataSource)!==this.state.activeDataSource&&this.setState({activeDataSource:this.state.activeDataSource}),this.state.activeDataSource){const t=null===(v=this.props.config.configInfo)||void 0===v?void 0:v[this.state.activeDataSource],a=null===(b=e.config.configInfo)||void 0===b?void 0:b[this.state.activeDataSource];if(s.lodash.isDeepEqual(null==a?void 0:a.searchSettings,null==t?void 0:t.searchSettings)||(this.didSearchSettingsChanged(null==a?void 0:a.searchSettings,null==t?void 0:t.searchSettings)?(this.resetFeatureForm(),this.setState({aoiGeometries:null,searchSettings:null==t?void 0:t.searchSettings,showExportOptions:!1},(()=>{this.isValidLayerConfigured();const{searchCurrentExtent:e,showAllFeatures:t}=F(this.state.searchSettings);e&&this.checkIfFilterMessageActionBinded(),t&&this.state.jimuMapView?(this.onClear(),this.queryLayers(),this.resizeLayerListHeight()):this.setState({showNoResultsFoundMsg:!1,queryAborted:!1,displayLayerAccordion:[]})}))):this.setState({searchSettings:null==t?void 0:t.searchSettings},(()=>{this.resizeLayerListHeight();const{searchCurrentExtent:e}=F(this.state.searchSettings);e&&this.checkIfFilterMessageActionBinded()}))),this.didAnalysisSettingsChanged(null===(S=null==a?void 0:a.analysisSettings)||void 0===S?void 0:S.layersInfo,null===(w=null==t?void 0:t.analysisSettings)||void 0===w?void 0:w.layersInfo)||(null===(x=null==a?void 0:a.analysisSettings)||void 0===x?void 0:x.displayAnalysisIcon)!==(null===(A=null==t?void 0:t.analysisSettings)||void 0===A?void 0:A.displayAnalysisIcon)||(null===(D=null==a?void 0:a.analysisSettings)||void 0===D?void 0:D.displayFeatureCount)!==(null===(C=null==t?void 0:t.analysisSettings)||void 0===C?void 0:C.displayFeatureCount)||(null===(L=null==a?void 0:a.analysisSettings)||void 0===L?void 0:L.displayMapSymbols)!==(null===(M=null==t?void 0:t.analysisSettings)||void 0===M?void 0:M.displayMapSymbols)||(null===(T=null==a?void 0:a.analysisSettings)||void 0===T?void 0:T.showDistFromInputLocation)!==(null===(j=null==t?void 0:t.analysisSettings)||void 0===j?void 0:j.showDistFromInputLocation)||(null===(O=null==a?void 0:a.analysisSettings)||void 0===O?void 0:O.onlyShowLayersResult)!==(null===(R=null==t?void 0:t.analysisSettings)||void 0===R?void 0:R.onlyShowLayersResult)||(null===(P=null==a?void 0:a.analysisSettings)||void 0===P?void 0:P.displayAllLayersResult)!==(null===(E=null==t?void 0:t.analysisSettings)||void 0===E?void 0:E.displayAllLayersResult)||(null===(B=null==a?void 0:a.analysisSettings)||void 0===B?void 0:B.enableProximitySearch)!==(null===(k=null==t?void 0:t.analysisSettings)||void 0===k?void 0:k.enableProximitySearch)||!s.lodash.isDeepEqual(null===(V=null==a?void 0:a.analysisSettings)||void 0===V?void 0:V.saveFeatures,null===(G=null==t?void 0:t.analysisSettings)||void 0===G?void 0:G.saveFeatures)){let e=this.state.isLayerAvailable;if(!e){this.availableLayersIds=[];const t=I(this.state.jimuMapView.id);t.length>0&&t.forEach((e=>{var t;(null===(t=null==e?void 0:e.layerDefinition)||void 0===t?void 0:t.geometryType)&&this.availableLayersIds.push(e.id)})),e=this.availableLayersIds.length>0}this.setState({analysisSettings:null==t?void 0:t.analysisSettings,isLayerAvailable:e,onWidgetLoadShowLoadingIndicator:!1},(()=>{var e,o,n,r,l,d,c,u,h,p,g,y,m;s.lodash.isDeepEqual(null===(e=null==a?void 0:a.analysisSettings)||void 0===e?void 0:e.saveFeatures,null===(o=null==t?void 0:t.analysisSettings)||void 0===o?void 0:o.saveFeatures)||this.resetFeatureForm(),this.state.displayLayerAccordion.length>0&&(null===(n=null==a?void 0:a.analysisSettings)||void 0===n?void 0:n.displayAllLayersResult)!==(null===(r=null==t?void 0:t.analysisSettings)||void 0===r?void 0:r.displayAllLayersResult)?null===(l=null==t?void 0:t.analysisSettings)||void 0===l||l.layersInfo.forEach((e=>{var t;if(this.availableLayersIds.includes(e.useDataSource.dataSourceId)||e.useDataSource.dataViewId&&this.availableLayersIds.includes(e.useDataSource.mainDataSourceId)){const s=null===(t=this.state.jimuMapView.getJimuLayerViewByDataSourceId(e.useDataSource.dataSourceId))||void 0===t?void 0:t.layer;s&&!s.visible&&this.state.analysisSettings.displayAllLayersResult&&(s.visible=!0)}})):(this.isValidLayerConfigured(),(null===(d=this.state.analysisSettings)||void 0===d?void 0:d.onlyShowLayersResult)!==(null===(c=i.analysisSettings)||void 0===c?void 0:c.onlyShowLayersResult)?this.onOnlyShowLayerResultsChanged():this.isLayerQueryNeeded(null===(u=null==a?void 0:a.analysisSettings)||void 0===u?void 0:u.layersInfo,null===(h=null==t?void 0:t.analysisSettings)||void 0===h?void 0:h.layersInfo)?(this.onRefreshResult(),(null===(p=this.state.searchSettings)||void 0===p?void 0:p.searchByActiveMapArea)&&(null===(g=this.aoiToolRef.current)||void 0===g||g.getMapExtentGeometry())):(this.setState({dataSetArray:[]},(()=>{this.displayAnalysisLayerInfo()})),(null===(y=this.state.searchSettings)||void 0===y?void 0:y.searchByActiveMapArea)&&(null===(m=this.aoiToolRef.current)||void 0===m||m.getMapExtentGeometry())))}))}}if(s.lodash.isDeepEqual(e.config.generalSettings,this.props.config.generalSettings)||this.setState({generalSettings:this.props.config.generalSettings}),e.enableDataAction===this.props.enableDataAction&&s.lodash.isDeepEqual(this.props.dataActions,e.dataActions)||this.setState({showExportButton:void 0===this.props.enableDataAction||this.props.enableDataAction},(()=>{this.setState({dataSetArray:[]}),this.displayAnalysisLayerInfo()})),this.selectedPopupContainer&&(null===(U=null===(N=e.theme)||void 0===N?void 0:N.sys.color)||void 0===U?void 0:U.primary.main)!==(null===(W=null===(z=this.props.theme)||void 0===z?void 0:z.sys.color)||void 0===W?void 0:W.primary.main)&&(this.selectedPopupContainer.style.borderColor=null===(H=null===(_=this.props.theme)||void 0===_?void 0:_.sys.color)||void 0===H?void 0:H.primary.main),e.theme.ref.typeface.htmlFontSize!==this.props.theme.ref.typeface.htmlFontSize&&this.resizeLayerListHeight(),!s.lodash.isDeepEqual(e.messageConfigs,this.props.messageConfigs)||!s.lodash.isDeepEqual(e.useDataSources,this.props.useDataSources)){const{searchCurrentExtent:e}=F(this.state.searchSettings);e&&this.checkIfFilterMessageActionBinded()}},this.checkIfFilterMessageActionBinded=()=>{var e;let t=!1;for(const i in this.props.messageConfigs){const a=this.props.messageConfigs[i];if(this.props.useMapWidgetIds.includes(null==a?void 0:a.widgetId)&&(null==a?void 0:a.messageType)===s.MessageType.ExtentChange){const s=this.props.useDataSources.map((e=>e.dataSourceId));null===(e=a.actions)||void 0===e||e.some((e=>{var i;if("filter data record action"===e.actionName&&(null===(i=e.useDataSources)||void 0===i?void 0:i.length)){if(e.useDataSources.filter((e=>s.includes(e.dataSourceId))).length)return t=!0,!0}return!1}))}}this.setState({isFilterActionBinded:t})},this.componentWillUnmount=()=>{this.onClear()},this.getSelectedFeatureRecordsOnLoad=()=>Ct(this,void 0,void 0,(function*(){var e,t,i,a;const o=s.UrlManager.getInstance(),n=s.urlUtils.getDataSourceInfosFromUrlParams(o.getQueryObject(),o.getHashObject()),r=[];for(const o in n){let l=o;const d=s.DataSourceManager.getInstance().getDataSource(o);if((null==d?void 0:d.type)===s.DataSourceTypes.SubtypeGroupLayer){l=(yield d.getSublayerDataSourceByRecordId((null===(e=n[o])||void 0===e?void 0:e.selection).ids[0])).id}const c=null===(t=n[o])||void 0===t?void 0:t.selection;((null===(i=null==c?void 0:c.ids)||void 0===i?void 0:i.length)||(null===(a=null==c?void 0:c.queryParams)||void 0===a?void 0:a.geometry))&&r.push(l)}r.length>0&&this.setState({dsToGetSelectedOnLoad:r})})),this.onDataSourceInfoChange=e=>{if(!e||Object.values(e).some((e=>!("selectedIds"in e))))return;const t={};Object.keys(e).forEach((e=>{var i;const a=s.DataSourceManager.getInstance().getDataSource(e);if(!a)return;const o=a.getSelectedRecords();for(const s of o){const a=null===(i=s.getFeature())||void 0===i?void 0:i.geometry;a&&(t[e]||(t[e]=[]),t[e].push(a))}})),Object.keys(t).length>0&&(this.skipHighlightRecordsOnMap=!0,this.geometriesByDsIdFromAction(t)),this.setState({dsToGetSelectedOnLoad:[]})},this.getAllFeaturesFromSelectedDs=()=>{var e;const t=new AbortController;this.abortControllerRef.push(t);const s={};let i="";i=null===(e=this.props.selectedDataSource)||void 0===e?void 0:e.id,s[i]||(s[i]=[]),this.setState({loadingAllFeaturesFromDs:!0,analysisTakingLongerTime:!1},(()=>{let e,a=setTimeout((()=>{a&&(clearTimeout(a),a=null),this.setState({analysisTakingLongerTime:!0})}),1e4);this.props.useDataSources.forEach((t=>{var s;t.dataSourceId===this.props.selectedDataSource.id&&(e=null!==(s=t.fields)&&void 0!==s?s:[])})),Be(this.props.selectedDataSource,null,!0,this.state.jimuMapView.view.spatialReference,e,t.signal).then((e=>{a&&(clearTimeout(a),a=null),(null==e?void 0:e.length)>0?(e.forEach((e=>{s[i].push(e.feature.geometry)})),this.geometriesByDsIdFromAction(s)):this.setState({loadingAllFeaturesFromDs:!1,analysisTakingLongerTime:!1})}),(()=>{a&&(clearTimeout(a),a=null),this.setState({loadingAllFeaturesFromDs:!1,analysisTakingLongerTime:!1})}))}))},this.analyzeAllFeatures=()=>{this.setState({promptForDataAction:!1}),this.getAllFeaturesFromSelectedDs()},this.onCancelButtonClicked=()=>{this.setState({promptForDataAction:!1,loadingAllFeaturesFromDs:!1})},this.geometriesByDsIdFromAction=e=>{Object.keys(e).forEach((t=>{this.geometriesFromAction[t]=e[t]})),this.actionTimeout&&clearTimeout(this.actionTimeout),this.actionTimeout=setTimeout((()=>Ct(this,void 0,void 0,(function*(){const e={point:[],polyline:[],polygon:[]},i=[],a=Object.keys(this.geometriesFromAction),o=s.DataSourceManager.getInstance();a.forEach((t=>{const a=null==o?void 0:o.getDataSource(t);if(null==a?void 0:a.getGeometryType()){const o=s.dataSourceUtils.changeRestAPIGeometryTypeToJSAPIGeometryType(a.getGeometryType());i.includes(o)||i.push(o),e[o]=e[o].concat(this.geometriesFromAction[t])}}));let n=null;if(1===i.length)n=e[i[0]].length>1?_e.executeMany(e[i[0]]):e[i[0]][0];else if(i.length>1){const s=e.point.concat(e.polyline),i=(yield t.geometryUtils.createBuffer(s,[.1],"meters")).concat(e.polygon);n=_e.executeMany(i)}this.recordSelectedFromAction(n),this.geometriesFromAction={}}))),1e3)},this.recordSelectedFromAction=e=>Ct(this,void 0,void 0,(function*(){var s,i;const{searchByLocation:a}=F(this.state.searchSettings);if(a){const a=null===(i=null===(s=this.state.jimuMapView)||void 0===s?void 0:s.view)||void 0===i?void 0:i.spatialReference;if(a){const s=yield t.geometryUtils.projectToSpatialReference([e],a);(null==s?void 0:s.length)>0&&s[0]&&this.setState({msgActionGeometry:s[0]})}}})),this.isValidLayerConfigured=()=>{var t,s,i,a,o;let n;const{showAllFeatures:r,searchCurrentExtent:l}=F(this.state.searchSettings);(r||l)&&(null===(s=null===(t=this.state.analysisSettings)||void 0===t?void 0:t.layersInfo)||void 0===s?void 0:s.length)>0&&(n=null===(i=this.state.analysisSettings)||void 0===i?void 0:i.layersInfo.filter((t=>{const s=t.analysisInfo.analysisType;return s===e.Proximity||s===e.Summary}))),n&&this.hasValidDsIds()?this.setState({isAnalysisLayerConfigured:(null==n?void 0:n.length)>0}):this.setState({isAnalysisLayerConfigured:this.hasValidDsIds()&&(null===(o=null===(a=this.state.analysisSettings)||void 0===a?void 0:a.layersInfo)||void 0===o?void 0:o.length)>0},(()=>{this.state.isAnalysisLayerConfigured||this.onClear()}))},this.hasValidDsIds=()=>{var e,t;let s=!1;return null===(t=null===(e=this.state.analysisSettings)||void 0===e?void 0:e.layersInfo)||void 0===t||t.some(((e,t)=>!!(this.availableLayersIds.includes(e.useDataSource.dataSourceId)||e.useDataSource.dataViewId&&this.availableLayersIds.includes(e.useDataSource.mainDataSourceId))&&(s=!0,s))),s},this.didAnalysisSettingsChanged=(e,t)=>{let i=!1;return null==t||t.some(((t,a)=>{var o,n,r;return(!e||t.useDataSource.dataSourceId!==(null===(o=e[a])||void 0===o?void 0:o.useDataSource.dataSourceId)||t.label!==(null===(n=e[a])||void 0===n?void 0:n.label)||!s.lodash.isDeepEqual(t.analysisInfo,null===(r=e[a])||void 0===r?void 0:r.analysisInfo))&&(i=!0,!0)})),(null==t?void 0:t.length)!==(null==e?void 0:e.length)||i},this.didSearchSettingsChanged=(e,t)=>{let s=!1;return e&&t&&t.includeFeaturesOutsideMapArea===e.includeFeaturesOutsideMapArea&&t.bufferDistance===e.bufferDistance&&t.distanceUnits===e.distanceUnits&&t.searchByActiveMapArea===e.searchByActiveMapArea?s:(s=!0,!0)},this.isLayerQueryNeeded=(t,i)=>{let a=!1;return null==i||i.some(((i,o)=>{var n,r,l,d;return(!t||i.useDataSource.dataSourceId!==(null===(n=t[o])||void 0===n?void 0:n.useDataSource.dataSourceId)||(i.analysisInfo.analysisType===e.Closest||i.analysisInfo.analysisType===e.Proximity)&&i.analysisInfo.returnIntersectedPolygons!==(null===(r=t[o])||void 0===r?void 0:r.analysisInfo.returnIntersectedPolygons)||!s.lodash.isDeepEqual(i.analysisInfo.fieldsToExport,null===(l=t[o])||void 0===l?void 0:l.analysisInfo.fieldsToExport)||i.analysisInfo.includeApproxDistance!==(null===(d=t[o])||void 0===d?void 0:d.analysisInfo.includeApproxDistance))&&(a=!0,!0)})),(null==i?void 0:i.length)!==(null==t?void 0:t.length)||a},this.loadConfiguredDataSources=e=>{var t,i,a,o,n;const r=s.DataSourceManager.getInstance().getDataSource(e),l=[],d=[];return null===(n=null===(o=null===(a=null===(i=null===(t=this.props.config)||void 0===t?void 0:t.configInfo)||void 0===i?void 0:i[e])||void 0===a?void 0:a.analysisSettings)||void 0===o?void 0:o.layersInfo)||void 0===n||n.forEach((e=>{!d.includes(e.useDataSource.dataSourceId)&&d.push(e.useDataSource.dataSourceId)})),d.forEach((e=>{l.push(new Promise(((t,s)=>{try{(null==r?void 0:r.isDataSourceSet())&&(null==r||r.createDataSourceById(e).then((e=>{t(e)}),(()=>{t(null)})))}catch(e){t(null)}})))})),l},this.onActiveViewChange=e=>Ct(this,void 0,void 0,(function*(){var t;if(this.availableLayersIds=[],!e||!e.view)return void this.setState({isLayerAvailable:!1,loadingAllFeaturesFromDs:!1});this.setState({onWidgetLoadShowLoadingIndicator:!0}),yield Promise.all(this.loadConfiguredDataSources(e.dataSourceId));const s=I(e.id);s.length>0?(s.forEach((e=>{var t;(null===(t=null==e?void 0:e.layerDefinition)||void 0===t?void 0:t.geometryType)&&this.availableLayersIds.push(e.id)})),this.availableLayersIds.length?this.setState({isLayerAvailable:!0,onWidgetLoadShowLoadingIndicator:!1}):this.setState({isLayerAvailable:!1})):this.setState({isLayerAvailable:!1}),this.mapView=e.view,this.state.jimuMapView&&(this.onClear(),this.setState({analysisSettings:null})),e&&(null===(t=e.jimuMapTools)||void 0===t||t.forEach((e=>{(null==e?void 0:e.instance)&&"Search"===e.name&&e.instance.on("select-result",(e=>{var t,s;(null===(s=null===(t=null==e?void 0:e.result)||void 0===t?void 0:t.feature)||void 0===s?void 0:s.geometry)&&this.recordSelectedFromAction(e.result.feature.geometry)}))})),this.setState({jimuMapView:e},(()=>{this.createGraphicsLayers(),null===e.dataSourceId?this.setState({activeDataSource:null}):(this.state.jimuMapView.dataSourceId||this.props.config.configInfo[this.state.jimuMapView.dataSourceId])&&this.setState({activeDataSource:this.state.jimuMapView.dataSourceId},(()=>{this.setConfigForDataSources()}))})))})),this.setConfigForDataSources=()=>{if(""!==this.state.jimuMapView.dataSourceId){const e=this.props.config.configInfo[this.state.jimuMapView.dataSourceId];this.setState({searchSettings:null==e?void 0:e.searchSettings,analysisSettings:null==e?void 0:e.analysisSettings},(()=>{this.isValidLayerConfigured();const{showAllFeatures:e,searchByLocation:t,searchCurrentExtent:s}=F(this.state.searchSettings);s&&this.checkIfFilterMessageActionBinded(),t&&this.getSelectedFeatureRecordsOnLoad(),e&&this.state.jimuMapView&&this.state.analysisSettings&&(this.queryLayers(),this.resizeLayerListHeight())}))}},this.onAoiComplete=e=>{this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={},this.setState({aoiGeometries:e},(()=>{this.calculateAoiForPrint(e),this.queryLayers()}))},this.calculateAoiForPrint=e=>{this.aoiValue="";const{searchByLocation:t}=F(this.state.searchSettings);if(t&&null!==e.bufferGeometry&&"polygon"===e.bufferGeometry.type){const t=e.bufferGeometry.spatialReference;let s;s=4326===t.wkid||t.isWebMercator||t.isGeographic?$e.execute(e.bufferGeometry,{unit:"square-"+e.distanceUnit}):qe.execute(e.bufferGeometry,{unit:"square-"+e.distanceUnit}),this.aoiValue=this.props.intl.formatNumber(s,{maximumFractionDigits:2})+" "+this.getSelectedUnitsAbbr(e.distanceUnit)+"&sup2"}},this.onClear=()=>{var e,t,i;this.destroyHighlightGraphicsLayer(),null===(e=this.flashLayer)||void 0===e||e.removeAll(),this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={},this.resetFeatureForm(),this.resetFilters(),this.clearMessageAction(),null===(i=null===(t=this.props)||void 0===t?void 0:t.outputDataSources)||void 0===i||i.forEach((e=>{var t;null===(t=this.getOutputDataSource(e))||void 0===t||t.setStatus(s.DataSourceStatus.NotReady)})),this.setState({aoiGeometries:null,displayLayerAccordion:[],isClosestAddressShowing:!1,msgActionGeometry:null,showNoResultsFoundMsg:!1,queryAborted:!1})},this.onRefreshResult=e=>{var t,i,a,o;this.destroyHighlightGraphicsLayer(),null===(t=this.flashLayer)||void 0===t||t.removeAll(),this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={};const{searchByLocation:n}=F(this.state.searchSettings);!e&&n&&(null===(i=this.state.analysisSettings)||void 0===i?void 0:i.onlyShowLayersResult)&&this.resetFilters(),this.clearMessageAction(),null===(o=null===(a=this.props)||void 0===a?void 0:a.outputDataSources)||void 0===o||o.forEach((e=>{var t;null===(t=this.getOutputDataSource(e))||void 0===t||t.setStatus(s.DataSourceStatus.NotReady)})),this.setState({dataSetArray:[],showExportOptions:!1,showFeatureForm:!1,currentPage:1},(()=>{this.queryLayers(e)}))},this.getAnalysisTypeIcon=t=>{let s;return t===e.Closest&&(s=Mt),t===e.Proximity&&(s=Tt),t===e.Summary&&(s=jt),s},this.getFieldObj=e=>({name:e.name.replace(/\./g,"_").replace(/\(/g,"_").replace(/\)/g,"_"),alias:e.alias,type:e.type}),this.getAllFeaturesDistance=(e,t,s)=>Ct(this,void 0,void 0,(function*(){return new Promise(((i,a)=>{if(e){const o=[];for(let e=0;e<t.length;e++)t[e].feature.geometry&&o.push(t[e].feature.geometry.toJSON());if(o.length>0){let t;const n=`${this.props.context.folderUrl}dist/runtime/assets/workers/worker-distance-utils.js`;Ft.default.open(n).then((i=>{t=i;const a=new AbortController;this.abortControllerRef.push(a);const n=e.toJSON();return i.invoke("getDistance",{selectedGeometryJson:n,intersectedGeometryJsonArray:o,distanceUnit:s},{signal:a.signal})})).then((e=>{null==t||t.close(),t=null,i(e)}),(e=>{null==t||t.close(),t=null,a(e)}))}}else i([])}))})),this.getFeaturesDistance=e=>Ct(this,void 0,void 0,(function*(){return new Promise((t=>{var s;const{showAllFeatures:i,searchCurrentExtent:a}=F(this.state.searchSettings),o=D(),n=i||a?o:(null===(s=this.state.aoiGeometries)||void 0===s?void 0:s.distanceUnit)||this.state.searchSettings.distanceUnits||o,r=this.state.aoiGeometries.incidentGeometry4326||this.state.aoiGeometries.incidentGeometry;let l;this.getAllFeaturesDistance(r,e,n).then((s=>{if(l=s,!l)return void t(null);const i=this.getSelectedUnitsAbbr(n);for(let t=0;t<e.length;t++){const s=e[t].feature;if(r&&s.geometry){s.distance=l[t];const e=this.props.intl.formatNumber(s.distance,{maximumFractionDigits:2})+" "+i;s.attributes?s.attributes.esriCTApproxDistance=e:s.attributes={esriCTApproxDistance:e}}else s.distance=0}t(e)}),(()=>{t(null)}))}))})),this.getSortedSubGroupFeatures=(t,i,a,o)=>{var n,r;let l="distance",d=!1,c=!1,u="",h=[];const p=i.analysisInfo;if(p.analysisType===e.Proximity&&(!p.sortFeaturesByDistance&&(null===(n=p.sortFeatures)||void 0===n?void 0:n.sortFeaturesByField)&&(l=p.sortFeatures.sortFeaturesByField,c=!0),p.groupFeaturesEnabled&&""!==p.groupFeatures.groupFeaturesByField&&""!==p.subGroupFeatures.subGroupFeaturesByField&&(d=!0,u=p.subGroupFeatures.subGroupFeaturesByField)),p.analysisType===e.Proximity&&a&&!c&&(l=o),d)for(let e=0;e<t.length;e++){const s=t[e],a=s.feature.attributes[u],o=s.getFormattedFieldValue(u,this.props.intl),n="subGroup_"+i.useDataSource.dataSourceId+"_"+u+"_"+a;let r,l=!0;if(h.length>0)for(let e=0;e<h.length;e++){const t=h[e];if(n===t.id&&a===t.value){l=!1,r=t;break}}l?h.push({id:n,value:a,count:1,label:o}):(h.forEach((e=>{e.id===n&&(r=e)})),r.count+=1)}if(d&&h.length>0){let e="";e=p.subGroupFeatures.sortSubGroupsByCount?"count":"value";const t=this.divideGroupsByEmptyValue(h,e);h=t.groupsWithNonEmptyValue.sort(this.sortGroups(e,p.subGroupFeatures.subGroupFeaturesOrder));const i=t.groupsWithEmptyValue.sort(this.sortGroups(e,p.subGroupFeatures.subGroupFeaturesOrder));h=e&&p.subGroupFeatures.subGroupFeaturesOrder===s.OrderRule.Desc?i.concat(h):h.concat(i)}if(p.analysisType===e.Proximity){const e=this.sortRecords(t,l);t=e.notEmptyRecordsArr.sort(this.sortFeatureList(l,p.analysisType,o));const i=e.emptyRecordArr.sort(this.sortFeatureList(l,p.analysisType,o));t=c&&(null===(r=null==p?void 0:p.sortFeatures)||void 0===r?void 0:r.sortFeaturesOrder)===s.OrderRule.Desc?i.concat(t):t.concat(i)}else t=t.sort(this.sortFeatureList(l,p.analysisType));return d&&h.length>0&&h.forEach((e=>{t.forEach((t=>{const s=t;e.value===s.feature.attributes[u]&&(e.features||(e.features=[]),e.features.push(t))}))})),{features:t,featuresSubGroup:h}},this.getSortedFeatures=(t,i,a,o)=>{var n,r;let l="distance",d=!1,c=!1,u="",h=[];const p=i.analysisInfo;if(p.analysisType===e.Proximity&&(!p.sortFeaturesByDistance&&(null===(n=p.sortFeatures)||void 0===n?void 0:n.sortFeaturesByField)&&(l=p.sortFeatures.sortFeaturesByField,c=!0),p.groupFeaturesEnabled&&""!==p.groupFeatures.groupFeaturesByField&&(d=!0,u=p.groupFeatures.groupFeaturesByField)),p.analysisType===e.Proximity&&a&&!c&&(l=o),d)for(let e=0;e<t.length;e++){const s=t[e],a=s.feature.attributes[u],o=s.getFormattedFieldValue(u,this.props.intl),n="group_"+i.useDataSource.dataSourceId+"_"+u+"_"+a;let r,l=!0;if(h.length>0)for(let e=0;e<h.length;e++){const t=h[e];if(n===t.id&&a===t.value){l=!1,r=t;break}}l?h.push({id:n,value:a,count:1,label:o}):(h.forEach((e=>{e.id===n&&(r=e)})),r.count+=1)}if(d&&h.length>0){let e="";e=p.groupFeatures.sortGroupsByCount?"count":"value";const t=this.divideGroupsByEmptyValue(h,e);h=t.groupsWithNonEmptyValue.sort(this.sortGroups(e,p.groupFeatures.groupFeaturesOrder));const i=t.groupsWithEmptyValue.sort(this.sortGroups(e,p.groupFeatures.groupFeaturesOrder));h=e&&p.groupFeatures.groupFeaturesOrder===s.OrderRule.Desc?i.concat(h):h.concat(i)}if(p.analysisType===e.Proximity){const e=this.sortRecords(t,l);t=e.notEmptyRecordsArr.sort(this.sortFeatureList(l,p.analysisType,o));const i=e.emptyRecordArr.sort(this.sortFeatureList(l,p.analysisType,o));t=c&&(null===(r=null==p?void 0:p.sortFeatures)||void 0===r?void 0:r.sortFeaturesOrder)===s.OrderRule.Desc?i.concat(t):t.concat(i)}else t=t.sort(this.sortFeatureList(l,p.analysisType));return d&&h.length>0&&(h.forEach((e=>{t.forEach((t=>{const s=t;e.value===s.feature.attributes[u]&&(e.features||(e.features=[]),e.features.push(t))}))})),""!==p.subGroupFeatures.subGroupFeaturesByField&&p.subGroupFeatures.subGroupFeaturesByField!==u&&h.forEach((e=>{e.subGroupInfo=this.getSortedSubGroupFeatures(e.features,i,!1,o)}))),{features:t,featuresGroup:h}},this.sortRecords=(e,t)=>{const s=[],i=[];return e.forEach(((e,a)=>{const o=e,n="distance"===t?o.feature[t]:o.feature.attributes[t];null==n||""===n?s.push(e):i.push(e)})),{emptyRecordArr:s,notEmptyRecordsArr:i}},this.divideGroupsByEmptyValue=(e,t)=>{const s=[],i=[];return e.forEach((e=>{const a=e[t];null==a||""===a?s.push(e):i.push(e)})),{groupsWithEmptyValue:s,groupsWithNonEmptyValue:i}},this.sortGroups=(e,t)=>(i,a)=>{if(i[e]===a[e]||null===i[e]&&null===a[e]){if(i.value<a.value)return t===s.OrderRule.Desc?-1:1;if(i.value>a.value)return t===s.OrderRule.Desc?1:-1}return i[e]<a[e]?-1:i[e]>a[e]?1:0},this.sortFeatureList=(t,s,i)=>(a,o)=>{let n=a.feature;let r=o.feature;const l=n,d=r;if("distance"!==t&&(n=n.attributes,r=r.attributes),s===e.Proximity&&(n[t]===r[t]||null===n[t]&&null===r[t]))if("distance"!==t)if(l.distance!==d.distance){if(l.distance<d.distance)return-1;if(l.distance>d.distance)return 1}else{if(n[i]<r[i])return-1;if(n[i]>r[i])return 1}else{if(n.attributes[i]<r.attributes[i])return-1;if(n.attributes[i]>r.attributes[i])return 1}return n[t]<r[t]?-1:n[t]>r[t]?1:void 0},this.getSelectedUnitsAbbr=e=>{const t=pe.find((t=>t.value===e));return this.nls(t.abbreviation)},this.displayApproximateDistanceUI=t=>{let s=!1;const i=t.analysisInfo,a=t.analysisInfo.analysisType,{searchByLocation:o}=F(this.state.searchSettings);return o&&(a===e.Closest||a===e.Proximity&&i.expandOnOpen&&i.expandFeatureDetails)&&(s=!0),s},this.createGraphicsLayers=()=>{var e,t,s;this.bufferLayer&&this.bufferLayer.destroy(),this.drawingLayer&&this.drawingLayer.destroy(),this.flashLayer&&this.flashLayer.destroy(),this.highlightLayer&&this.highlightLayer.destroy(),this.bufferLayer=new Z.default({listMode:"hide"}),this.drawingLayer=new Z.default({listMode:"hide"}),this.highlightLayer=new Z.default({listMode:"hide"}),this.flashLayer=new Z.default({listMode:"hide",effect:"bloom(0.8, 1px, 0)"}),null===(s=null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map)||void 0===s||s.addMany([this.bufferLayer,this.drawingLayer,this.flashLayer,this.highlightLayer])},this.clearMessageAction=()=>{var e,t,i,a,o,n,r,l,d;(null===(e=this.selectedRecord)||void 0===e?void 0:e.dataSource)&&this.selectedRecord.dataSource.dataViewId!==s.CONSTANTS.SELECTION_DATA_VIEW_ID&&s.MessageManager.getInstance().publishMessage(new s.DataRecordsSelectionChangeMessage(this.props.id,[],[null===(i=null===(t=this.selectedRecord)||void 0===t?void 0:t.dataSource)||void 0===i?void 0:i.id])),this.selectedPopupContainer&&(this.selectedPopupContainer.style.borderColor=be),null===(o=null===(a=this.selectedPopupContainer)||void 0===a?void 0:a.classList)||void 0===o||o.remove("record-selected"),(null===(r=null===(n=this.selectedRecord)||void 0===n?void 0:n.dataSource)||void 0===r?void 0:r.dataViewId)!==s.CONSTANTS.SELECTION_DATA_VIEW_ID&&(null===(d=null===(l=this.selectedRecord)||void 0===l?void 0:l.dataSource)||void 0===d||d.clearSelection()),this.selectedRecord=null,this.selectedPopupContainer=null,this.selectedRecordsKey=""},this.selectMessageAction=e=>{var t,i,a,o,n,r,l;this.selectedPopupContainer&&(this.selectedPopupContainer.style.borderColor=null===(i=null===(t=this.props.theme)||void 0===t?void 0:t.sys.color)||void 0===i?void 0:i.primary.main),null===(o=null===(a=this.selectedPopupContainer)||void 0===a?void 0:a.classList)||void 0===o||o.add("record-selected"),(null===(n=null==e?void 0:e.dataSource)||void 0===n?void 0:n.dataViewId)!==s.CONSTANTS.SELECTION_DATA_VIEW_ID&&(s.MessageManager.getInstance().publishMessage(new s.DataRecordsSelectionChangeMessage(this.props.id,[e],[null===(r=e.dataSource)||void 0===r?void 0:r.id])),this.skipHighlightRecordsOnMap||(this.skipDsInfoChange=!0,null===(l=e.dataSource)||void 0===l||l.selectRecordsByIds([e.getId()],[e]))),this.skipHighlightRecordsOnMap=!1,this.selectedRecord=e},this.highlightFeatureOnMap=(e,t)=>{var s,i,a;if(t){this.highlightLayer.removeAll(),null===(s=this.state.jimuMapView)||void 0===s||s.view.map.reorder(this.highlightLayer,(null===(i=this.state.jimuMapView)||void 0===i?void 0:i.view.map.layers.length)-1);const t=ie(e.getFeature(),"#FFFF00");null===(a=this.highlightLayer)||void 0===a||a.add(t)}else this.highlightLayer.removeAll()},this.executeSelectMessageAction=(e,t,s)=>{this.selectedRecordsKey===e?this.clearMessageAction():this.selectedRecordsKey!==e&&(this.selectedRecordsKey&&this.clearMessageAction(),this.selectedPopupContainer=t,this.selectedRecordsKey=e,this.selectMessageAction(s))},this.executeClearMessageAction=e=>{this.selectedRecordsKey===e&&this.clearMessageAction()},this.createFeatureSet=(t,i,a,o,n,r)=>{var l,d,c,u,h,p,g,y,m;const f=[];let v=[];const b=i.analysisInfo;let w,x="";const I=void 0===this.props.enableDataAction||this.props.enableDataAction;if(b.analysisType===e.Proximity&&""!==b.displayField)x=b.displayField;else{const e=i.useDataSource.dataSourceId,t=S(e);x=(e=>{var t;let s="";const i=null==e?void 0:e.getLayerDefinition(),a=null==e?void 0:e.getIdField();return s=a||((null==i?void 0:i.displayField)?i.displayField:null===(t=null==i?void 0:i.fields)||void 0===t?void 0:t[0].name),s})(t)}const A=i.analysisInfo.analysisType!==e.Proximity||b.expandOnOpen&&b.expandFeatureDetails;v=t;const{searchByLocation:D,searchCurrentExtent:C}=F(this.state.searchSettings);if(D?(w=this.getSortedFeatures(v,i,!1,a),v=w.features):(w=this.getSortedFeatures(v,i,!0,a),v=w.features),b.analysisType===e.Closest&&v.length>1){let e=[];const t=v[0].feature.geometry;(null===(d=null===(l=this.state.aoiGeometries)||void 0===l?void 0:l.incidentGeometry)||void 0===d?void 0:d.type)===t.type&&(e=v.filter((e=>He.execute(e.feature.geometry,this.state.aoiGeometries.incidentGeometry)))),v=e.length>0?e.splice(0,1):v.splice(0,1)}b.analysisType===e.Proximity&&(!b.sortFeaturesByDistance&&(null===(c=b.sortFeatures)||void 0===c?void 0:c.sortFeaturesByField)&&b.sortFeatures.sortFeaturesOrder===s.OrderRule.Desc&&(v=v.reverse()),b.groupFeaturesEnabled&&(b.groupFeatures.groupFeaturesOrder===s.OrderRule.Desc||b.groupFeatures.sortGroupsByCount)&&(w.featuresGroup=w.featuresGroup.reverse()));const L=S(i.useDataSource.dataSourceId);if(b.analysisType===e.Proximity&&(null===(u=null==w?void 0:w.featuresGroup)||void 0===u?void 0:u.length)>0){const t=(null===(h=this.state.analysisSettings)||void 0===h?void 0:h.displayMapSymbols)&&"unique-value"===(null===(g=null===(p=L.layer)||void 0===p?void 0:p.renderer)||void 0===g?void 0:g.type)&&b.groupFeatures.groupFeaturesByField===(null===(m=null===(y=L.layer)||void 0===y?void 0:y.renderer)||void 0===m?void 0:m.field);w.featuresGroup.forEach(((a,l)=>{var d,c,u;!b.sortFeaturesByDistance&&(null===(d=b.sortFeatures)||void 0===d?void 0:d.sortFeaturesByField)&&b.sortFeatures.sortFeaturesOrder===s.OrderRule.Desc&&(a.features=a.features.reverse());const h=[];a.subGroupInfo?((b.subGroupFeatures.subGroupFeaturesOrder===s.OrderRule.Desc||b.subGroupFeatures.sortSubGroupsByCount)&&(a.subGroupInfo.featuresSubGroup=a.subGroupInfo.featuresSubGroup.reverse()),a.subGroupInfo.featuresSubGroup.forEach(((a,d)=>{var c,u,p;const g=[];!b.sortFeaturesByDistance&&(null===(c=b.sortFeatures)||void 0===c?void 0:c.sortFeaturesByField)&&b.sortFeatures.sortFeaturesOrder===s.OrderRule.Desc&&(a.features=a.features.reverse()),a.features.forEach(((t,c)=>{var u,h,p;g.push((0,s.jsx)(We,{index:l+"_"+d+"_"+n+"_"+c,key:n+"_"+d+"_"+c,widgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,config:this.props.config,jimuMapView:this.state.jimuMapView,popupTitleField:b.analysisType===e.Proximity?x:null,selectedRecord:t,showPlanRoute:this.canShowPlanRouteButton(t,b.analysisType,D),distanceUnit:D||C?this.getSelectedUnitsAbbr(o):null,selectedFeatureLength:a.features.length,ifOneAnalysisResult:r,isExpanded:A,expandOnOpen:b.expandOnOpen,approximateDistanceUI:this.displayApproximateDistanceUI(i),showDistFromInputLocation:null===(u=this.state.analysisSettings)||void 0===u?void 0:u.showDistFromInputLocation,displayMapSymbol:null===(h=this.state.analysisSettings)||void 0===h?void 0:h.displayMapSymbols,isEnableProximitySearch:null===(p=this.state.analysisSettings)||void 0===p?void 0:p.enableProximitySearch,showDataActions:I&&D,isGroup:!0,selectRecord:this.executeSelectMessageAction,clearRecord:this.executeClearMessageAction,graphicLayer:this.flashLayer,selectedLayerDsId:i.useDataSource.dataSourceId,startingPointGraphic:this.incidentGraphic,highlightFeature:this.highlightFeatureOnMap}))})),h.push((0,s.jsx)(E,{theme:this.props.theme,key:d,index:d,intl:this.props.intl,label:null!==(u=a.label)&&void 0!==u?u:b.subGroupFeatures.noValueSubGroupLabel,analysisIcon:null,featureCount:(null===(p=this.state.analysisSettings)||void 0===p?void 0:p.displayFeatureCount)?a.count:null,isExpanded:A,dsId:i.useDataSource.dataSourceId,analysisId:i.analysisInfo.analysisId,analysisType:b.analysisType,isListView:!1,canShowMoreFeatures:(null==a?void 0:a.count)>20,selectedRecord:a.features[0],displayMapSymbol:t,canToggle:!0},g))}))):a.features.forEach(((t,a)=>{var d,c,u;h.push((0,s.jsx)(We,{index:l+"_"+n+"_"+a,key:n+"_"+a,widgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,config:this.props.config,jimuMapView:this.state.jimuMapView,popupTitleField:b.analysisType===e.Proximity?x:null,selectedRecord:t,showPlanRoute:this.canShowPlanRouteButton(t,b.analysisType,D),distanceUnit:D||C?this.getSelectedUnitsAbbr(o):null,selectedFeatureLength:v.length,ifOneAnalysisResult:r,isExpanded:A,expandOnOpen:b.expandOnOpen,approximateDistanceUI:this.displayApproximateDistanceUI(i),showDistFromInputLocation:null===(d=this.state.analysisSettings)||void 0===d?void 0:d.showDistFromInputLocation,displayMapSymbol:null===(c=this.state.analysisSettings)||void 0===c?void 0:c.displayMapSymbols,isEnableProximitySearch:null===(u=this.state.analysisSettings)||void 0===u?void 0:u.enableProximitySearch,showDataActions:I&&D,isGroup:!0,selectRecord:this.executeSelectMessageAction,clearRecord:this.executeClearMessageAction,graphicLayer:this.flashLayer,selectedLayerDsId:i.useDataSource.dataSourceId,startingPointGraphic:this.incidentGraphic,highlightFeature:this.highlightFeatureOnMap}))})),f.push((0,s.jsx)(E,{theme:this.props.theme,key:l,index:l,intl:this.props.intl,label:null!==(c=a.label)&&void 0!==c?c:b.groupFeatures.noValueGroupLabel,analysisIcon:null,featureCount:(null===(u=this.state.analysisSettings)||void 0===u?void 0:u.displayFeatureCount)?a.count:null,isExpanded:A,dsId:i.useDataSource.dataSourceId,analysisId:i.analysisInfo.analysisId,analysisType:b.analysisType,isListView:!1,canShowMoreFeatures:(null==a?void 0:a.count)>20,selectedRecord:a.features[0],displayMapSymbol:t,canToggle:!0},h))}))}else v.forEach(((t,a)=>{var l,d,c;f.push((0,s.jsx)(We,{intl:this.props.intl,widgetId:this.props.id,index:n+"_"+a,key:n+"_"+a,theme:this.props.theme,config:this.props.config,popupTitleField:b.analysisType===e.Proximity?x:null,jimuMapView:this.state.jimuMapView,selectedRecord:t,distanceUnit:D||C?this.getSelectedUnitsAbbr(o):null,showPlanRoute:this.canShowPlanRouteButton(t,b.analysisType,D),selectedFeatureLength:v.length,ifOneAnalysisResult:r,isExpanded:A,expandOnOpen:b.expandOnOpen,approximateDistanceUI:this.displayApproximateDistanceUI(i),showDistFromInputLocation:null===(l=this.state.analysisSettings)||void 0===l?void 0:l.showDistFromInputLocation,displayMapSymbol:null===(d=this.state.analysisSettings)||void 0===d?void 0:d.displayMapSymbols,isEnableProximitySearch:null===(c=this.state.analysisSettings)||void 0===c?void 0:c.enableProximitySearch,showDataActions:I&&D,isGroup:!1,selectRecord:this.executeSelectMessageAction,clearRecord:this.executeClearMessageAction,highlightFeature:this.highlightFeatureOnMap,startingPointGraphic:this.incidentGraphic,selectedLayerDsId:i.useDataSource.dataSourceId,graphicLayer:this.flashLayer}))}));return{items:f,count:v.length,layerInfo:i,records:v,allowExport:!1,featuresAndGroup:w}},this.canShowPlanRouteButton=(t,s,i)=>{var a,o;return this.incidentGraphic&&"point"===(null===(o=null===(a=null==t?void 0:t.feature)||void 0===a?void 0:a.geometry)||void 0===o?void 0:o.type)&&i&&s!==e.Summary},this.getRecords=e=>Ct(this,void 0,void 0,(function*(){const t=e.useDataSource.dataSourceId,s=S(e.useDataSource.dataSourceId);if(!s)return Promise.resolve();return new Promise(((e,i)=>{var a;const o=new AbortController;this.abortControllerRef.push(o);let n=null;const{searchByLocation:r,searchCurrentExtent:l}=F(this.state.searchSettings);let d,c=!1;(r||l)&&(l||(c=!0),n=(null===(a=this.state.aoiGeometries)||void 0===a?void 0:a.bufferGeometry)?this.state.aoiGeometries.bufferGeometry:this.state.aoiGeometries.incidentGeometry),this.props.useDataSources.forEach((e=>{var t;e.dataSourceId===s.id&&(d=null!==(t=e.fields)&&void 0!==t?t:[])})),Be(s,n,c,this.state.jimuMapView.view.spatialReference,d,o.signal).then((s=>Ct(this,void 0,void 0,(function*(){r&&(null==s?void 0:s.length)>0&&!(s=yield this.getFeaturesDistance(s))?e(null):(this.featuresByDsId[t]=s,e(s))}))),(t=>{e(null)}))}))})),this.performAnalysis=(t,s,i)=>Ct(this,void 0,void 0,(function*(){const a=t.useDataSource.dataSourceId,o=S(a),n=yield o.allowToExportData();return new Promise(((r,l)=>{var d,c;const u=null==o?void 0:o.getIdField();let h=null;const{showAllFeatures:p,searchByLocation:g,searchCurrentExtent:y}=F(this.state.searchSettings);if((g||y)&&(h=(null===(d=this.state.aoiGeometries)||void 0===d?void 0:d.bufferGeometry)?this.state.aoiGeometries.bufferGeometry:null===(c=this.state.aoiGeometries)||void 0===c?void 0:c.incidentGeometry),this.featuresByDsId.hasOwnProperty(a)){let l=[...this.featuresByDsId[a]];g&&t.analysisInfo.returnIntersectedPolygons&&"esriGeometryPolygon"===o.getGeometryType()&&(l=l.filter((e=>{var t;return Je.execute(null===(t=this.state.aoiGeometries)||void 0===t?void 0:t.incidentGeometry,e.feature.geometry)})),this.featuresByAnalysisId[s]=l);let d={items:[],count:l.length,layerInfo:t,records:l,allowExport:n};const c=D(),m=p||y?c:this.state.aoiGeometries.distanceUnit||this.state.searchSettings.distanceUnits||c;l.length>0?t.analysisInfo.analysisType===e.Summary?(d=this.summaryAnalysis(l,t,m,h,s),d.allowExport=n,r(d)):(t.analysisInfo.analysisType===e.Closest&&g||t.analysisInfo.analysisType===e.Proximity)&&(d=this.createFeatureSet(l,t,u,m,s,i),d.allowExport=n,r(d)):r(d)}}))})),this.summaryAnalysis=(e,t,i,a,o)=>{var n,r;const l=[];let d;d=null;const c=t.analysisInfo,u=t.label,{showAllFeatures:h,searchCurrentExtent:p}=F(this.state.searchSettings),g=h||p;return c.summaryFields.length>0?(c.summaryFields.forEach(((t,s)=>{var o,n;g&&t.summaryFieldInfo.hasOwnProperty("summaryBy")||((null===(o=t.summaryFieldInfo)||void 0===o?void 0:o.summaryBy)===xe.SumOfIntersectedArea&&(d=this.getArea(e,a,i),d=this.getSummaryDisplayValue(d,t.summaryFieldInfo,i,!0)),(null===(n=t.summaryFieldInfo)||void 0===n?void 0:n.summaryBy)===xe.SumOfIntersectedLength&&(d=this.getLength(e,a,i),d=this.getSummaryDisplayValue(d,t.summaryFieldInfo,i,!1)))})),g&&1===c.summaryFields.length&&(null===(r=null===(n=c.summaryFields[0])||void 0===n?void 0:n.summaryFieldInfo)||void 0===r?void 0:r.hasOwnProperty("summaryBy"))?this.updateSummaryOutputDS(u,t.useDataSource.dataSourceId,c.summaryFields,o,e.length):l.push((0,s.jsx)(yt,{key:o,widgetId:this.props.widgetId,records:e,theme:this.props.theme,useDataSource:t.useDataSource,summaryFieldInfos:c.summaryFields,sumOfAreaOrLengthValue:d,singleFieldColor:c.isSingleColorMode?c.singleFieldColor:null,onSummaryFieldsResolved:s=>{this.updateSummaryOutputDS(u,t.useDataSource.dataSourceId,c.summaryFields,o,e.length,s)}}))):this.updateSummaryOutputDS(u,t.useDataSource.dataSourceId,c.summaryFields,o,e.length),{items:l,count:e.length,layerInfo:t,records:e,allowExport:!1}},this.updateSummaryOutputDS=(t,s,i,a,o,n)=>{const r=n?Object.assign({},n):{};this.summaryAttributes=r;const l=C(this.props.widgetId,e.Summary,a);r.esriCTCOUNT=o,this.buildOutputDsResultsForSummary(t,s,i,a,l,r)},this.getSummaryDisplayValue=(e,t,s,i)=>{const a={useGrouping:t.showSeparator,notation:"standard"};let o;if(t.numberFormattingOption===we.Round)a.maximumFractionDigits=t.significantDigits,a.minimumFractionDigits=t.significantDigits,o=this.props.intl.formatNumber(e,a);else if(t.numberFormattingOption===we.Truncate){if(a.minimumSignificantDigits=t.significantDigits,!isNaN(e)&&null!==e){const s=t.significantDigits;o=new RegExp(s>0?"^\\d*[.]?\\d{0,"+s+"}":"^\\d*").exec(e.toString())[0]}o=this.props.intl.formatNumber(Number(o),a)}else o=this.props.intl.formatNumber(e,a);let n=this.getSelectedUnitsAbbr(s);return i&&(n+="\xb2"),this.summaryIntersectValueAndUnitLabel(o,n)},this.summaryIntersectValueAndUnitLabel=(e,t)=>{let s="";return s=this.props.intl.formatMessage({id:"summaryIntersectValueAndUnit",defaultMessage:a.summaryIntersectValueAndUnit},{summaryIntersectValue:e,unitLabel:t}),s},this.getArea=(e,t,s)=>{let i=0;const a="square-"+s;return e.forEach((e=>{const s=e;let o;if(o=t?Je.execute(s.feature.geometry,t):s.feature.geometry,null!==o){const e=o.spatialReference;4326===e.wkid||e.isWebMercator||e.isGeographic?i+=$e.execute(o,{unit:a}):i+=qe.execute(o,{unit:a})}})),i},this.getLength=(e,t,s)=>{let i=0;const a=s;return e.forEach((e=>{const s=e;let o;if(o=t?Je.execute(s.feature.geometry,t):s.feature.geometry,null!==o){const e=o.spatialReference;4326===e.wkid||e.isWebMercator||e.isGeographic?i+=Ze.execute(o,{unit:a}):i+=Ke.execute(o,{unit:a})}})),i},this.resizeLayerListHeight=()=>{var e,t,s;if(null===(e=this.divRef)||void 0===e?void 0:e.current){const{searchByLocation:e,showAllFeatures:i,searchCurrentExtent:a}=F(this.state.searchSettings),o=null===(s=null===(t=this.divRef)||void 0===t?void 0:t.current)||void 0===s?void 0:s.offsetHeight,n="125%"===this.props.theme.ref.typeface.htmlFontSize?35:27;let r=o;e||a?r=o+n:i&&("125%"===this.props.theme.ref.typeface.htmlFontSize?o<=34?r=35:o>34&&(r=o+n):o<=28?r=28:o>28&&(r=o+n)),this.setState({listMaxHeight:"calc(100% - "+r+"px)"})}},this.createHighlightGraphicsForLayer=(e,t,s,i)=>{var a,o,n;if(s){const s=new Z.default({listMode:"hide",visible:t});this.highlightGraphicsLayers.push(s),null===(a=this.state.jimuMapView)||void 0===a||a.view.map.addMany([s]),null===(o=this.state.jimuMapView)||void 0===o||o.view.map.reorder(this.flashLayer,(null===(n=this.state.jimuMapView)||void 0===n?void 0:n.view.map.layers.length)-1),e.forEach((e=>{const t=e.getFeature(),a=ie(t,gt.colorUtils.getThemeColorVariableValue(i,this.props.theme));s&&a&&s.add(a)}))}else this.highlightGraphicsLayers.push(null)},this.destroyHighlightGraphicsLayer=()=>{this.highlightGraphicsLayers.forEach((e=>{e&&(e.removeAll(),e.destroy())})),this.highlightGraphicsLayers=[]},this.onLayerToggle=(e,t)=>{var s;if((null===(s=this.highlightGraphicsLayers)||void 0===s?void 0:s.length)>0&&this.highlightGraphicsLayers[e]){const s=this.highlightGraphicsLayers[e];s&&(s.visible=!!t)}},this.queryLayers=s.lodash.debounce((e=>{this.setState({showNoResultsFoundMsg:!1,queryAborted:!1,displayLayerAccordion:[],analysisTakingLongerTime:!1},(()=>{var t,s,i;let a=setTimeout((()=>{a&&(clearTimeout(a),a=null),this.setState({analysisTakingLongerTime:!0})}),1e4);this.destroyHighlightGraphicsLayer();const{showAllFeatures:o,searchByLocation:n,searchCurrentExtent:r}=F(this.state.searchSettings);!e&&n&&(null===(t=this.state.analysisSettings)||void 0===t?void 0:t.onlyShowLayersResult)&&this.resetFilters(),this.clearMessageAction();const l=[],d=[];(o||(n||r)&&this.state.aoiGeometries)&&this.state.jimuMapView&&(null===(i=null===(s=this.state.analysisSettings)||void 0===s?void 0:s.layersInfo)||void 0===i?void 0:i.length)>0&&this.state.analysisSettings.layersInfo.forEach((e=>{var t;if(this.availableLayersIds.includes(e.useDataSource.dataSourceId)||e.useDataSource.dataViewId&&this.availableLayersIds.includes(e.useDataSource.mainDataSourceId)){const s=null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId;s&&!d.includes(s)&&(d.push(s),this.featuresByDsId[s]||l.push(this.getRecords(e)))}})),Promise.all(l).then((()=>{this.abortControllerRef=[],a&&(clearTimeout(a),a=null),this.setState({analysisTakingLongerTime:!1},(()=>{setTimeout((()=>{this.displayAnalysisLayerInfo(e)}),500)}))}))}))}),300),this.getFieldsToExport=e=>{var t;let s=[];const i=null===(t=this.state.analysisSettings)||void 0===t?void 0:t.layersInfo,{searchByLocation:a}=F(this.state.searchSettings);return i.forEach((t=>{var i;if(t.analysisInfo.analysisId===e)if((null===(i=t.analysisInfo.fieldsToExport)||void 0===i?void 0:i.length)>0){const e=[...t.analysisInfo.fieldsToExport];!a&&t.analysisInfo.fieldsToExport.includes("esriCTApproxDistance")&&e.splice(t.analysisInfo.fieldsToExport.indexOf("esriCTApproxDistance"),1),s=e}else s=j(t.useDataSource.dataSourceId)})),s},this.displayAnalysisLayerInfo=t=>{var i;const a=[];this.setState({dataSetArray:[]}),this.state.displayLayerAccordion.length>0&&(this.setState({showNoResultsFoundMsg:!1,queryAborted:!1,displayLayerAccordion:[]}),this.destroyHighlightGraphicsLayer(),this.clearMessageAction());const o=[],n=null===(i=this.state.analysisSettings)||void 0===i?void 0:i.layersInfo,{showAllFeatures:r,searchByLocation:l,searchCurrentExtent:d}=F(this.state.searchSettings);if((r||(l||d)&&this.state.aoiGeometries)&&this.state.jimuMapView&&(null==n?void 0:n.length)>0){let i=0;n.forEach(((t,s)=>{var a,o,n;const r=null!==(a=t.analysisInfo.analysisId)&&void 0!==a?a:s.toString(),l=null!==(o=this.featuresByAnalysisId[r])&&void 0!==o?o:this.featuresByDsId[t.useDataSource.dataSourceId];t.analysisInfo.analysisType===e.Closest?(null==l?void 0:l.length)>0&&(i+=1):i+=null!==(n=null==l?void 0:l.length)&&void 0!==n?n:0}));const c=1===i;n.forEach(((t,s)=>{var i;if((!r&&!d||t.analysisInfo.analysisType!==e.Closest)&&(this.availableLayersIds.includes(t.useDataSource.dataSourceId)||t.useDataSource.dataViewId&&this.availableLayersIds.includes(t.useDataSource.mainDataSourceId))){const e=null!==(i=t.analysisInfo.analysisId)&&void 0!==i?i:s.toString();o.push(this.performAnalysis(t,e,c))}})),Promise.all(o).then((i=>{i.length&&(this.analysisLayersResults=i),i.forEach(((i,o)=>{var n,r,d,c,u;if(i){const t=null!==(n=i.layerInfo.analysisInfo.analysisId)&&void 0!==n?n:o.toString(),s=C(this.props.widgetId,i.layerInfo.analysisInfo.analysisType,t);i.layerInfo.analysisInfo.analysisType===e.Summary?0===i.count&&this.updateSummaryOutputDS(i.layerInfo.label,i.layerInfo.useDataSource.dataSourceId,i.layerInfo.analysisInfo.summaryFields,t,0):this.buildOutputDsResults(i.layerInfo.label,s,i.records,i)}if((null==i?void 0:i.count)>0){let n=!0;"summary"===i.layerInfo.analysisInfo.analysisType&&0===i.items.length&&(n=!1);const h=i.layerInfo.useDataSource.dataSourceId,p=this.state.showExportButton&&i.allowExport,g=i.layerInfo.analysisInfo.expandOnOpen;if(this.closestFeaturesByIndexAndDsId[a.length+"_"+h]=i.records,!t&&l&&(null===(r=this.state.analysisSettings)||void 0===r?void 0:r.onlyShowLayersResult)&&(this.checkOnlyClosestConfiguredForDS(h)?this.filterToOnlyShowResultFeatures(h,i.records):this.filterToOnlyShowResultFeatures(h)),l){let e=!0,t=ve;e=i.layerInfo.analysisInfo.highlightResultsOnMap,t=i.layerInfo.analysisInfo.highlightColorOnMap,this.createHighlightGraphicsForLayer(i.records,g,e,t)}const y=null!==(d=this.featuresByAnalysisId[i.layerInfo.analysisInfo.analysisId])&&void 0!==d?d:this.featuresByDsId[h];a.push((0,s.jsx)(E,{theme:this.props.theme,key:o,intl:this.props.intl,widgetId:this.props.widgetId,label:i.layerInfo.label,analysisIcon:(null===(c=this.state.analysisSettings)||void 0===c?void 0:c.displayAnalysisIcon)?this.getAnalysisTypeIcon(i.layerInfo.analysisInfo.analysisType):null,featureCount:(null===(u=this.state.analysisSettings)||void 0===u?void 0:u.displayFeatureCount)?null==i?void 0:i.count:null,isExpanded:g,isListView:!0,index:a.length,dsId:h,analysisId:i.layerInfo.analysisInfo.analysisId,analysisType:i.layerInfo.analysisInfo.analysisType,showExportButton:p,onToggle:this.onLayerToggle,records:y,searchSettings:this.state.searchSettings,analysisSettings:this.state.analysisSettings,canShowMoreFeatures:i.layerInfo.analysisInfo.analysisType===e.Proximity&&(null==i?void 0:i.count)>20,canToggle:n},i.items))}}));const o=this.getSaveFeaturesConfig(a.length>0);this.setState({showSaveIcon:o.anyInputFeatureEnabled||o.onlySearchAreaEnabled,displayLayerAccordion:a,showNoResultsFoundMsg:0===a.length,loadingAllFeaturesFromDs:!1},(()=>{this.state.displayLayerAccordion.length>0&&n.forEach(((e,t)=>{var s;if(this.availableLayersIds.includes(e.useDataSource.dataSourceId)||e.useDataSource.dataViewId&&this.availableLayersIds.includes(e.useDataSource.mainDataSourceId)){const t=null===(s=this.state.jimuMapView.getJimuLayerViewByDataSourceId(e.useDataSource.dataSourceId))||void 0===s?void 0:s.layer;t&&!t.visible&&this.state.analysisSettings.displayAllLayersResult&&(t.visible=!0)}}))}))}))}},this.getSaveFeaturesConfig=e=>{var t,s,i,a,o,n,r,l,d;const c={anyInputFeatureEnabled:!1,onlySearchAreaEnabled:!1};if(e&&(!(null===(t=this.state.searchSettings)||void 0===t?void 0:t.searchByActiveMapArea)||!(null===(s=this.state.searchSettings)||void 0===s?void 0:s.includeFeaturesOutsideMapArea))){if(null===(a=null===(i=this.state.analysisSettings)||void 0===i?void 0:i.saveFeatures)||void 0===a?void 0:a.saveInputLocation){switch(this.state.aoiGeometries.incidentGeometry.type){case"point":c.anyInputFeatureEnabled=this.state.analysisSettings.saveFeatures.pointFeature.enabled&&!!this.state.analysisSettings.saveFeatures.pointFeature.useDataSource;break;case"polyline":c.anyInputFeatureEnabled=this.state.analysisSettings.saveFeatures.polylineFeature.enabled&&!!this.state.analysisSettings.saveFeatures.polylineFeature.useDataSource;break;case"polygon":c.anyInputFeatureEnabled=this.state.analysisSettings.saveFeatures.polygonFeature.enabled&&!!this.state.analysisSettings.saveFeatures.polygonFeature.useDataSource}}c.anyInputFeatureEnabled||(c.onlySearchAreaEnabled=(null===(o=this.state.aoiGeometries)||void 0===o?void 0:o.bufferDistance)>0&&(null===(r=null===(n=this.state.analysisSettings.saveFeatures)||void 0===n?void 0:n.searchAreaFeature)||void 0===r?void 0:r.enabled)&&!!(null===(d=null===(l=this.state.analysisSettings.saveFeatures)||void 0===l?void 0:l.searchAreaFeature)||void 0===d?void 0:d.useDataSource))}return c},this.buildOutputDsResults=(t,i,a,o)=>Ct(this,void 0,void 0,(function*(){var n,r,l,d;yield new Promise((e=>setTimeout(e,500)));const{showAllFeatures:c,searchCurrentExtent:u}=F(this.state.searchSettings);let h=this.getOutputDataSource(i);const p=s.DataSourceManager.getInstance(),g=p.getDataSource(o.layerInfo.useDataSource.dataSourceId);if(h||(h=yield p.createDataSource(i)),!h)return;const y=h.getSchema(),m=this.getFieldsToExport(o.layerInfo.analysisInfo.analysisId),f=y,v=Object.assign({},h.getDataSourceJson());(u||c)&&delete v.geometryType,p.updateDataSourceByDataSourceJson(h,(0,s.Immutable)(Object.assign(Object.assign({},v),{disableExport:!o.allowExport,exportOptions:g.getExportOptions()})));const b=Object.keys(null==f?void 0:f.fields).filter((e=>m.includes(e)||o.layerInfo.analysisInfo.includeApproxDistance)).reduce(((e,t)=>(e[t]=null==y?void 0:y.fields[t],e)),{}),S=[];for(const e in b){const t={fieldName:b[e].name,label:b[e].alias};S.push(t)}const w=this.getOutputDataSource(i),x=Object.assign(Object.assign({},s.dataSourceUtils.getLayerDefinitionIntersection(g.getLayerDefinition(),w)),{timeInfo:null});null==w||w.setLayerDefinition(x);const I=yield s.dataSourceUtils.createJSAPIFeatureLayerByRecords(w,a,null,{id:i+"_layer",title:i,popupTemplate:{title:null!==(n=null!=t?t:h.getLabel())&&void 0!==n?n:i,fieldInfos:S,content:[{type:"fields",fieldInfos:S}]},visible:!1,listMode:"hide",customParameters:{moveFeaturesToCenterWhenPrinting:!0}}).then((e=>e.layer));if((u||c)&&(Object.defineProperty(I,"isTable",{writable:!0}),I.isTable=!0),I&&w&&(w.layer=I),o.allowExport){const s=this.state.dataSetArray;s.push({records:a,dataSource:h,name:h.getLabel(),fields:m}),o.layerInfo.analysisInfo.analysisType===e.Proximity&&this.buildOutputDataSetForProximityCount(o,t,a,h,i),yield this.updateDataActionDataSet(s)}null===(r=this.getOutputDataSource(i))||void 0===r||r.setStatus(s.DataSourceStatus.Unloaded),null===(l=this.getOutputDataSource(i))||void 0===l||l.setCountStatus(s.DataSourceStatus.Unloaded),null===(d=this.getOutputDataSource(i))||void 0===d||d.addSourceVersion()})),this.buildOutputDataSetForProximityCount=(e,t,i,a,o)=>{var n,r,l,d,c;const u=[{alias:"OBJECTID",type:"double",name:"OBJECTID"},{alias:this.nls("layer"),type:"string",name:"layerName"},{alias:this.nls("count"),type:"double",name:"esriCTProximityLayerCount"}],h={OBJECTID:0};h.layerName=t,h.esriCTProximityLayerCount=i.length;const p={type:"point",x:null===(r=null===(n=this.state.jimuMapView)||void 0===n?void 0:n.view)||void 0===r?void 0:r.extent.center.x,y:null===(d=null===(l=this.state.jimuMapView)||void 0===l?void 0:l.view)||void 0===d?void 0:d.extent.center.y,spatialReference:{wkid:this.mapView.spatialReference.wkid}},g=new B.default({attributes:h,geometry:p}),y=[];u.forEach((e=>{e.name&&y.push({fieldName:e.name,label:e.alias})}));const m=new ut.default({id:o+"_layer",title:o,fields:u,geometryType:"point",source:[g],objectIdField:"OBJECTID",popupTemplate:{title:null!==(c=null!=t?t:a.getLabel())&&void 0!==c?c:o,fieldInfos:y,content:[{type:"fields",fieldInfos:y}]},visible:!1,listMode:"hide",customParameters:{moveFeaturesToCenterWhenPrinting:!0}}),f={},v=[{alias:"OBJECTID",type:s.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"},{alias:this.nls("layer"),type:s.JimuFieldType.String,jimuName:"layerName",name:"layerName"},{alias:this.nls("count"),type:s.JimuFieldType.Number,jimuName:"esriCTProximityLayerCount",name:"esriCTProximityLayerCount"}];null==v||v.forEach(((e,t)=>{0===t?f.OBJECTID=e:"esriCTProximityLayerCount"===(null==e?void 0:e.name)?f.esriCTProximityLayerCount=e:f[null==e?void 0:e.jimuName]=e}));const b=o+"_Count",S=t+" ("+this.nls(e.layerInfo.analysisInfo.analysisType)+" "+this.nls("count")+")",w=s.DataSourceManager.getInstance();w.getDataSource(b)&&w.destroyDataSource(b),e.allowExport&&w.createDataSource((0,s.Immutable)({id:b,type:s.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,schema:{idField:"OBJECTID",fields:f,label:S},layer:m})).then((e=>{const t=e.buildRecord(g);e.setSourceRecords([t]);const s={records:[t],dataSource:e,name:S};this.proximityCountDataSetArr.push(s)}))},this.buildOutputDsResultsForSummary=(e,t,i,a,o,n)=>Ct(this,void 0,void 0,(function*(){var r,l,d,c,u,h,p,g;let y=this.getOutputDataSource(o);if(y||(y=yield s.DataSourceManager.getInstance().createDataSource(o)),!y)return;const m=s.DataSourceManager.getInstance(),f=null==m?void 0:m.getDataSource(t),v=yield f.allowToExportData(),b=Object.assign(y.getDataSourceJson());s.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(y,(0,s.Immutable)(Object.assign(Object.assign({},b),{disableExport:!v,exportOptions:f.getExportOptions()})));const S=this.getFieldsToExport(a),w=[{alias:"OBJECTID",type:"double",name:"OBJECTID"},{alias:this.nls("count"),type:"double",name:"esriCTCOUNT"}],x={OBJECTID:0};n.hasOwnProperty("esriCTCOUNT")&&(x.esriCTCOUNT=n.esriCTCOUNT),i.forEach((e=>{const t=e.fieldLabel.replace(/ /g,"");w.push({alias:e.fieldLabel,type:"string",name:t}),n.hasOwnProperty(t)&&(x[t]=n[t])}));const I={type:"point",x:null===(l=null===(r=this.state.jimuMapView)||void 0===r?void 0:r.view)||void 0===l?void 0:l.extent.center.x,y:null===(c=null===(d=this.state.jimuMapView)||void 0===d?void 0:d.view)||void 0===c?void 0:c.extent.center.y,spatialReference:{wkid:this.mapView.spatialReference.wkid}},A=new B.default({attributes:x,geometry:I}),D=[];w.forEach((e=>{e.name&&D.push({fieldName:e.name,label:e.alias})}));const F=new ut.default({id:o+"_layer",title:o,fields:w,geometryType:"point",source:[A],objectIdField:"OBJECTID",popupTemplate:{title:null!==(u=null!=e?e:y.getLabel())&&void 0!==u?u:o,fieldInfos:D,content:[{type:"fields",fieldInfos:D}]},visible:!1,listMode:"hide",customParameters:{moveFeaturesToCenterWhenPrinting:!0}}),C=this.getOutputDataSource(o);let L;C.layer=F;const M=C.layer.createQuery();M.outSpatialReference=this.mapView.spatialReference,M.returnGeometry=!0,M.outFields=["*"],M.where="1=1",C.layer.queryFeatures(M).then((e=>Ct(this,void 0,void 0,(function*(){var i;(null===(i=e.features)||void 0===i?void 0:i.length)>0&&(L=e.features.map((e=>C.buildRecord(e))));const a=this.state.dataSetArray,o=this.featuresByDsId[t];v&&a.push({records:n.esriCTCOUNT>0?L:[],dataSource:y,name:y.getLabel()}),v&&m.createDataSource((0,s.Immutable)({id:"downloadCsv_output"+(new Date).getTime(),type:s.DataSourceTypes.FeatureLayer,isDataInDataSourceInstance:!0,schema:f.getSchema(),exportOptions:f.getExportOptions()})).then((e=>{const t=Object.assign(e.getDataSourceJson());s.DataSourceManager.getInstance().updateDataSourceByDataSourceJson(e,(0,s.Immutable)(Object.assign(Object.assign({},t),{disableExport:!v,exportOptions:f.getExportOptions()}))),e.setSourceRecords(o);const i={records:o,dataSource:e,name:f.getLabel(),fields:S};a.push(i)})),yield this.updateDataActionDataSet(a)})))),null===(h=this.getOutputDataSource(o))||void 0===h||h.setStatus(s.DataSourceStatus.Unloaded),null===(p=this.getOutputDataSource(o))||void 0===p||p.setCountStatus(s.DataSourceStatus.Unloaded),null===(g=this.getOutputDataSource(o))||void 0===g||g.addSourceVersion()})),this.getOutputDataSource=e=>s.DataSourceManager.getInstance().getDataSource(e),this.onResize=({width:e,height:t})=>{this.setState({widgetWidth:e}),this.resizeLayerListHeight()},this.updateClosestAddressState=e=>{this.setState({isClosestAddressShowing:e},(()=>{this.resizeLayerListHeight()}))},this.onOnlyShowLayerResultsChanged=()=>{var e;(null===(e=this.state.analysisSettings)||void 0===e?void 0:e.onlyShowLayersResult)?this.featuresByDsId&&Object.keys(this.featuresByDsId).forEach((e=>{let t;this.checkOnlyClosestConfiguredForDS(e)&&this.closestFeaturesByIndexAndDsId&&Object.keys(this.closestFeaturesByIndexAndDsId).some((s=>s.split(/_(.*)/s)[1]===e&&(t=this.closestFeaturesByIndexAndDsId[s],!0))),this.filterToOnlyShowResultFeatures(e,t)})):this.resetFilters(!0)},this.filterToOnlyShowResultFeatures=(e,t)=>{var s,i,a;if((null===(s=this.state.analysisSettings)||void 0===s?void 0:s.onlyShowLayersResult)&&e&&this.featuresByDsId[e]){const s=S(e);if(s){const o=t||this.featuresByDsId[e],n=null==s?void 0:s.getIdField(),r=[];o.forEach((e=>{var t;r.push(null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes[n])}));let l={};r.length>0?l={where:"((("+n+" IN ("+r.join(",")+"))))"}:0===r.length&&(l={where:"1=2"}),null===(a=(i=s).updateQueryParams)||void 0===a||a.call(i,l,this.props.id),this.filtersAppliedOnDsId.includes(e)||this.filtersAppliedOnDsId.push(e)}}},this.resetFilters=e=>{var t;const s={where:"1=1",sqlExpression:null};((null===(t=this.state.analysisSettings)||void 0===t?void 0:t.onlyShowLayersResult)||e)&&this.state.jimuMapView&&(this.filtersAppliedOnDsId.forEach((e=>{var t,i;const a=S(e);a&&(null===(i=(t=a).updateQueryParams)||void 0===i||i.call(t,s,this.props.id))})),this.filtersAppliedOnDsId=[])},this.checkOnlyClosestConfiguredForDS=t=>{var s;const i=[];return null===(s=this.state.analysisSettings)||void 0===s||s.layersInfo.forEach((e=>{t===e.useDataSource.dataSourceId&&i.push(e.analysisInfo.analysisType)})),!i.includes(e.Proximity)&&!i.includes(e.Summary)},this.onResetButtonClick=()=>{var e;null===(e=this.aoiToolRef.current)||void 0===e||e.refreshButtonClicked(),this.setState({showExportOptions:!1,showFeatureForm:!1,currentPage:1})},this.onSaveInputLocationClick=()=>{const e=this.getSaveFeaturesConfig(!0);this.setState({showFeatureForm:!0,currentPage:e.onlySearchAreaEnabled?2:1},(()=>{let e;e=1===this.state.currentPage?this.state.aoiGeometries.incidentGeometry.type:this.state.aoiGeometries.bufferGeometry.type,this.initializeForm(e)}))},this.getLayerToSaveFeature=e=>{let t;if(2===this.state.currentPage)t=this.state.analysisSettings.saveFeatures.searchAreaFeature.useDataSource.dataSourceId;else switch(e){case"point":t=this.state.analysisSettings.saveFeatures.pointFeature.useDataSource.dataSourceId;break;case"polyline":t=this.state.analysisSettings.saveFeatures.polylineFeature.useDataSource.dataSourceId;break;case"polygon":t=this.state.analysisSettings.saveFeatures.polygonFeature.useDataSource.dataSourceId}return S(t).layer},this.initializeForm=e=>{if(1===this.state.currentPage&&this.incidentGeomfeatureForm)return;if(2===this.state.currentPage&&this.bufferGeomfeatureForm)return;const t=this.getLayerToSaveFeature(e),s="polygon"===e&&2===this.state.currentPage?this.state.aoiGeometries.bufferGeometry:this.state.aoiGeometries.incidentGeometry,i="polygon"===e&&2===this.state.currentPage?"buffer-feature-form":"incident-feature-form",a=new B.default({geometry:s}),o=new Xe.default({container:i,layer:t,feature:a});1===this.state.currentPage?this.incidentGeomfeatureForm=o:this.bufferGeomfeatureForm=o,this.handleFormSubmit()},this.handleFormSubmit=()=>{const e=new Promise((e=>{var t;null===(t=this.incidentGeomfeatureForm)||void 0===t||t.on("submit",(t=>{t.invalid.length?this.pageChanged(1):this.bufferGeomfeatureForm?e(!0):this.submitForm()}))})),t=new Promise((t=>{var s;null===(s=this.bufferGeomfeatureForm)||void 0===s||s.on("submit",(s=>{this.incidentGeomfeatureForm?e.then((()=>{s.invalid.length?this.pageChanged(2):t(!0)})):s.invalid.length?this.pageChanged(2):this.submitForm()}))}));Promise.all([e,t]).then((()=>{this.submitForm()}))},this.resetFeatureForm=()=>{this.state.showFeatureForm&&(this.incidentGeomfeatureForm=void 0,this.bufferGeomfeatureForm=void 0,this.setState({showFeatureForm:!1,currentPage:1,formFailedMsg:""}))},this.pageChanged=e=>{this.setState({currentPage:e},(()=>{this.initializeForm(1===this.state.currentPage?this.state.aoiGeometries.incidentGeometry.type:this.state.aoiGeometries.bufferGeometry.type)}))},this.submitBtnClicked=()=>{this.incidentGeomfeatureForm&&this.incidentGeomfeatureForm.submit(),this.bufferGeomfeatureForm&&this.bufferGeomfeatureForm.submit()},this.submitForm=()=>Ct(this,void 0,void 0,(function*(){this.setState({isSubmittingForm:!0});try{if(this.incidentGeomfeatureForm){const e=this.incidentGeomfeatureForm.layer;this.incidentGeomfeatureForm.feature.attributes=this.incidentGeomfeatureForm.getValues(),yield e.applyEdits({addFeatures:[this.incidentGeomfeatureForm.feature]})}if(this.bufferGeomfeatureForm)try{const e=this.bufferGeomfeatureForm.layer;this.bufferGeomfeatureForm.feature.attributes=this.bufferGeomfeatureForm.getValues(),yield e.applyEdits({addFeatures:[this.bufferGeomfeatureForm.feature]}),this.incidentGeomfeatureForm=void 0,this.bufferGeomfeatureForm=void 0,this.setState({showFeatureForm:!1,currentPage:1,isSubmittingForm:!1,formFailedMsg:""})}catch(e){console.error(e),this.setState({formFailedMsg:e.message,showFeatureForm:!0,isSubmittingForm:!1},(()=>{this.handleFormSubmit()}))}else this.incidentGeomfeatureForm=void 0,this.bufferGeomfeatureForm=void 0,this.setState({showFeatureForm:!1,isSubmittingForm:!1,currentPage:1,formFailedMsg:""})}catch(e){console.error(e),this.setState({formFailedMsg:e.message,isSubmittingForm:!1},(()=>{this.pageChanged(1),this.handleFormSubmit()}))}})),this.stopLoading=()=>{this.abortControllerRef.forEach((e=>{e.abort()})),this.onResetButtonClick(),this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={},this.setState({queryAborted:!0,loadingAllFeaturesFromDs:!1})},this.getPromptMessageString=e=>{let t="";return t=this.props.intl.formatMessage({id:"promptTitleMessageFromDataAction",defaultMessage:a.promptTitleMessageFromDataAction},{layerName:e}),t},this.getSaveInputLocationHeaderString=e=>{let t="";return t=this.props.intl.formatMessage({id:"saveInputLocationLabel",defaultMessage:a.saveInputLocationLabel},{layerName:e}),t},this.getSaveSearchAreaLabelHeaderString=e=>{let t="";return t=this.props.intl.formatMessage({id:"saveSearchAreaLabel",defaultMessage:a.saveSearchAreaLabel},{layerName:e}),t},this.onBatchExportToggle=()=>Ct(this,void 0,void 0,(function*(){if(this.state.showExportOptions)this.setState({showExportOptions:!this.state.showExportOptions});else{this.setState({isDropDownLoading:!0});try{const[e]=yield this.getAvailableActions(),t=Object.keys(e);this.setState({actionNames:t,actionNamesGroups:e})}catch(e){console.error(e),this.setState({actionNamesGroups:{}})}this.setState({showExportOptions:!this.state.showExportOptions}),this.setState({isDropDownLoading:!1})}})),this.getAvailableActions=()=>{let e=null;return 0!==this.getRecordsCount()&&(e=s.DataActionManager.getInstance().getSupportedActions(this.props.widgetId,this.state.dataSetArray,s.DataLevel.Records)),Promise.all([e||{}])},this.getRecordsCount=()=>{var e;let t=0;for(const s of this.state.dataSetArray)t+=null===(e=s.records)||void 0===e?void 0:e.length;return t},this.renderFormForSavingInputLocation=()=>{var e;const t=(null===(e=this.state.analysisSettings)||void 0===e?void 0:e.saveFeatures.searchAreaFeature.enabled)&&!!this.state.analysisSettings.saveFeatures.searchAreaFeature.useDataSource&&this.state.aoiGeometries.bufferDistance>0,a=this.state.currentPage,o=t&&1===a?this.nls("next"):this.nls("submit"),n=1===a?this.state.aoiGeometries.incidentGeometry.type:this.state.aoiGeometries.bufferGeometry.type,r=this.getLayerToSaveFeature(n),l=1===a?this.getSaveInputLocationHeaderString(r.title):this.getSaveSearchAreaLabelHeaderString(r.title),d=s.css`
        display: flex;
        flex-direction: column;
        height: 100%;
        `,c=s.css`
        position: sticky;
        top: 0;
        display: flex;
        `,u=s.css`
        flex-shrink: 0;
        `,h=s.css`
        overflow-wrap: anywhere;
        font-weight: bold;
        font-size: var(--calcite-font-size--1);
        `,p=s.css`
        border-left: ${2===a?"1px solid rgb(213, 213, 213)":"none"};
        `,g=s.css`
        flex: 1;
        overflow-y: auto;
        border-top: 1px solid rgb(213, 213, 213);
        border-bottom: 1px solid rgb(213, 213, 213);
        `,y=s.css`
        position: sticky;
        bottom: 5px;
        display: flex;
        `,m=s.css`
        border-radius: 0px !important;
       `;return(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)("div",{css:d},(0,s.jsx)("div",{css:c},2===this.state.currentPage&&this.incidentGeomfeatureForm&&(0,s.jsx)(i.Button,{css:u,"aria-label":this.nls("back"),type:"tertiary",icon:!0,onClick:()=>{2===a?this.pageChanged(1):this.resetFeatureForm()}},(0,s.jsx)(Dt,{autoFlip:!0})),(0,s.jsx)("span",{css:p},(0,s.jsx)("div",{css:h,className:"m-2 pt-1"},l))),(0,s.jsx)("div",{css:g,className:"mb-3"},this.state.formFailedMsg&&(0,s.jsx)(i.Alert,{style:{width:"100%"},"aria-live":"polite",closable:!0,form:"basic",onClose:()=>{this.setState({formFailedMsg:""})},open:!0,shape:"none",size:"medium",text:this.state.formFailedMsg,title:this.nls("formSubmissionFailedMsg"),type:"error",variant:"contained",withIcon:!0}),(0,s.jsx)("div",{style:{display:1===a?"block":"none"},id:"incident-feature-form"}),(0,s.jsx)("div",{style:{display:2===a?"block":"none"},id:"buffer-feature-form"})),(0,s.jsx)("div",{css:y,className:"px-3"},(0,s.jsx)(i.Button,{block:!0,role:"button","aria-label":this.nls("cancel"),title:this.nls("cancel"),size:"default",type:"secondary",css:m,onClick:this.resetFeatureForm},this.nls("cancel")),(0,s.jsx)(i.Button,{block:!0,role:"button","aria-label":o,title:o,size:"default",type:"primary",css:m,onClick:()=>{2===a?this.submitBtnClicked():t&&1===a?this.pageChanged(2):this.submitBtnClicked()}},o))))},this.renderBatchExportList=()=>{var e;const{searchByLocation:t}=F(this.state.searchSettings);let a=!1;t&&(a=!0);const o=(0,s.getAppStore)().getState().appContext.isRTL,n=[];let r,l=!1;(this.analysisLayersResults.length||this.summaryAttributes)&&(r=this.createPrintReportData(n)),this.analysisLayersResults.forEach((e=>{var t,s;e.layerInfo.analysisInfo.groupFeaturesEnabled&&""!==e.layerInfo.analysisInfo.groupFeatures.groupFeaturesByField&&(null===(s=null===(t=e.featuresAndGroup)||void 0===t?void 0:t.featuresGroup)||void 0===s?void 0:s.length)>0&&(l=!0)}));const d=s.css`
     padding-top: 7px!important;
    `,c=s.css`
        @keyframes loading {
          0% {transform: rotate(0deg); };
          100% {transform: rotate(360deg)};
        }
        position: absolute;
        width: 60%;
        height: 60%;
        top: 20%;
        left: 20%;
        border: 2px solid var(--sys-color-secondary-light);
        border-radius: 50%;
        border-top: 2px solid var(--sys-color-primary-main);
        box-sizing: border-box;
        animation:loading 2s infinite linear;
      `;return(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(i.Dropdown,{className:"float-right",direction:"down",size:"sm","aria-label":this.nls("exportBtnTitle"),useKeyUpEvent:!0,toggle:this.onBatchExportToggle,isOpen:this.state.showExportOptions},(0,s.jsx)(i.DropdownButton,{size:"sm",arrow:!1,css:d,icon:!0,ref:this.dropdownRef,className:"data-action-button",onClick:this.onBatchExportToggle,type:"tertiary",title:this.nls("exportBtnTitle")},!this.state.isDropDownLoading&&(0,s.jsx)(v,{size:"m"}),this.state.isDropDownLoading&&(0,s.jsx)("div",{css:c})),(0,s.jsx)(i.DropdownMenu,null,(0,s.jsx)(i.Dropdown,{key:this.state.actionNames.length+1,direction:"right",isSubMenuItem:!0},(0,s.jsx)(i.DropdownButton,{size:"sm",type:"default",arrowRight:!0,onClick:this.onExportPdfOptionClick},(0,s.jsx)("div",{className:"d-flex align-items-center"},(0,s.jsx)("span",null,this.nls("exportToPdf")))),(0,s.jsx)(i.DropdownMenu,null,(0,s.jsx)("div",{onClick:this.pdfPopupClick,className:"p-3 w-100"},(0,s.jsx)(wt,{theme:this.props.theme,intl:this.props.intl,mapView:this.state.jimuMapView,reportData:r,showAreaOfInterest:a,aoiValue:this.aoiValue,isGroupingEnabled:l,isRTL:o,folderUrl:this.props.context.folderUrl,onReportExported:this.onExportPdfClick})))),(null===(e=this.state.actionNames)||void 0===e?void 0:e.length)>0&&this.state.actionNames.map((e=>this.createActionItem(this.state.actionNamesGroups,e,s.DataLevel.Records))))),this.state.actionElement)},this.onExportPdfOptionClick=()=>{var e,t;const{searchByLocation:s}=F(this.state.searchSettings);if(s){const s=(null===(e=this.state.aoiGeometries)||void 0===e?void 0:e.bufferGeometry)?this.state.aoiGeometries.bufferGeometry:this.state.aoiGeometries.incidentGeometry;null===(t=this.state.jimuMapView)||void 0===t||t.view.goTo({center:"point"===s.type?s:s.extent.clone().expand(1.5)})}},this.onExportPdfClick=()=>{this.setState({showExportOptions:!1})},this.pdfPopupClick=e=>{e.stopPropagation()},this.createPrintReportData=t=>{const s=t,i=!0;return this.analysisLayersResults.forEach((t=>{var a,o,n,r,l,d,c,u,h;const p=[],g=[];let y=[];if(t.allowExport)if(t.layerInfo.analysisInfo.analysisType===e.Summary){const i=C(this.props.widgetId,e.Summary,t.layerInfo.analysisInfo.analysisId),n=this.getOutputDataSource(i),r=null===(o=null===(a=null==n?void 0:n.layer)||void 0===a?void 0:a.source)||void 0===o?void 0:o.at(0),l=[];t.layerInfo.analysisInfo.summaryFields.forEach((e=>{const t=e.fieldLabel.replace(/ /g,"");(null==r?void 0:r.attributes.hasOwnProperty(t))&&(p.push(e.fieldLabel),l.push(r.attributes[t]))})),(null==r?void 0:r.attributes.esriCTCOUNT)>0&&0===p.length&&0===l.length&&(p.push(this.nls("count")),l.push(r.attributes.esriCTCOUNT)),g.push(l),s.push({data:{cols:p,rows:g,showRowIndex:!0},title:t.layerInfo.label,totalCount:t.records.length,maxNoOfCols:5})}else{const e=this.getFieldsToExport(t.layerInfo.analysisInfo.analysisId),a=t.layerInfo.analysisInfo;let o=t.records,m=null,f=null;a.groupFeaturesEnabled&&""!==a.groupFeatures.groupFeaturesByField&&(null===(r=null===(n=t.featuresAndGroup)||void 0===n?void 0:n.featuresGroup)||void 0===r?void 0:r.length)>0&&(o=[],null===(l=t.featuresAndGroup)||void 0===l||l.featuresGroup.forEach((e=>{var t,s;(null===(s=null===(t=e.subGroupInfo)||void 0===t?void 0:t.featuresSubGroup)||void 0===s?void 0:s.length)>0?e.subGroupInfo.featuresSubGroup.forEach((e=>{o.push(...e.features)})):o.push(...e.features)})));let v="",b="",S="",w="";for(const t in null===(d=o[0])||void 0===d?void 0:d.feature.attributes){let s;const i=o[0].feature.layer.fields;if(e.includes(t)){if("esriCTApproxDistance"===t)s=this.nls("closestApproxDistance");else if(void 0!==t){s=(null===(c=i.filter((e=>e.name===t))[0])||void 0===c?void 0:c.alias)||t}void 0!==s&&(p.includes(s)||(t===(null===(u=a.groupFeatures)||void 0===u?void 0:u.groupFeaturesByField)||t===(null===(h=a.subGroupFeatures)||void 0===h?void 0:h.subGroupFeaturesByField)?(t===a.groupFeatures.groupFeaturesByField&&(m=1,v=s,S=t),""!==a.subGroupFeatures.subGroupFeaturesByField&&t===a.subGroupFeatures.subGroupFeaturesByField&&(f=2,b=s,w=t)):(p.push(s),y.push(t))))}}S&&w&&S===w&&(b="",f=null,w=""),w&&(p.unshift(b),y.unshift(w)),S&&(p.unshift(v),y.unshift(S)),o.forEach((t=>{const s=[];y.length||(y=Object.keys(t.feature.attributes)),y.forEach((i=>{var a;if(e.includes(i)){let e=null!==(a=t.getFormattedFieldValue(i,this.props.intl))&&void 0!==a?a:"";void 0!==e&&""!==e&&null!==e&&""!==e.toString().trim()||(e=this.nls("noData")),s.push(e)}})),g.push(s)})),s.push({data:{cols:p,rows:g,showRowIndex:i},title:t.layerInfo.label,totalCount:t.records.length,maxNoOfCols:5,groupFieldCol:m,subgroupFieldCol:f})}})),s},this.onActionItemClick=(e,t)=>Ct(this,void 0,void 0,(function*(){const i="active-data-action-item",a=document.querySelector(`.${i}`);a&&a.classList.remove(i),this.dropdownRef.current.className=(0,s.classNames)(this.dropdownRef.current.className,i);let o=this.state.dataSetArray;"export-csv"===e.id&&this.proximityCountDataSetArr.length>0&&(o=[...o,this.proximityCountDataSetArr[0]]);const n=yield s.DataActionManager.getInstance().executeDataAction(e,o,t,this.props.widgetId);null!==n&&"boolean"!=typeof n&&this.setState({actionElement:s.React.cloneElement(n,{onClose:()=>{this.setState({actionElement:null})},onConfirm:(...e)=>(!n.props.keepOpenAfterConfirm&&this.setState({actionElement:null}),n.props.onConfirm(...e))})}),this.setState({showExportOptions:!1})})),this.createActionItem=(e,t,a)=>{const o=e[t];return"export"===t&&(null==o?void 0:o.length)>0&&this.state.dataSetArray.length>0&&o.length>0?(0,s.jsx)(s.React.Fragment,{key:"exportAction"},o.map(((e,t)=>{var o;let n=e.label;if(e.widgetId){const t=(0,s.getAppStore)().getState().appConfig.widgets[e.widgetId];n=null!==(o=null==t?void 0:t.label)&&void 0!==o?o:e.label}return(0,s.jsx)(i.DropdownItem,{key:t,header:!1,onClick:()=>Ct(this,void 0,void 0,(function*(){yield this.onActionItemClick(e,a)}))},n)}))):null},this.onIncidentGraphicChange=e=>{this.incidentGraphic="point"===e.geometry.type?e:null},this.onQueryRequired=(e,t)=>{if(t)for(const i in e){const a=e[i],o=null==t?void 0:t[i];if(!a||s.lodash.isDeepEqual(null==a?void 0:a.widgetQueries,null==o?void 0:o.widgetQueries))return(null==a?void 0:a.sourceVersion)!==(null==o?void 0:o.sourceVersion)?void this.updateOnDSInfoChange():void 0;let n=!1;if(a.widgetQueries){const{showAllFeatures:e,searchByLocation:t}=F(this.state.searchSettings),i=Object.keys(a.widgetQueries);(e||t)&&i.includes("filter-data-record-action")&&i.splice(i.indexOf("filter-data-record-action"),1),i.some((e=>{var t,i;return!(e===this.props.id||s.lodash.isDeepEqual(null===(t=null==a?void 0:a.widgetQueries)||void 0===t?void 0:t[e],null===(i=null==o?void 0:o.widgetQueries)||void 0===i?void 0:i[e]))&&(n=!0,!0)}))}n&&this.updateOnDSInfoChange()}},this.updateOnDSInfoChange=s.lodash.debounce((()=>{var e,t;if(this.skipDsInfoChange)return void(this.skipDsInfoChange=!1);const{showAllFeatures:s,searchByLocation:i,searchCurrentExtent:a}=F(this.state.searchSettings);s||i?this.onRefreshResult(!0):a&&(null===(t=null===(e=this.aoiToolRef)||void 0===e?void 0:e.current)||void 0===t||t.onSearchByMapAreaClicked())}),1e3),this.renderDataSourceComponent=()=>{var e;const t=[];return null===(e=this.props.useDataSources)||void 0===e||e.forEach(((e,i)=>{t.push((0,s.jsx)(s.DataSourceComponent,{key:i,useDataSource:e,onQueryRequired:this.onQueryRequired,widgetId:this.props.id}))})),t},this.divRef=s.React.createRef(),this.featuresByDsId={},this.featuresByAnalysisId={},this.closestFeaturesByIndexAndDsId={},this.highlightGraphicsLayers=[],this.geometriesFromAction={},this.actionTimeout=null,this.filtersAppliedOnDsId=[],this.selectedPopupContainer=null,this.selectedRecordsKey="",this.selectedRecord=null,this.incidentGraphic=null,this.skipHighlightRecordsOnMap=!1,this.skipDsInfoChange=!1,this.analysisLayersResults={},this.summaryAttributes={},this.proximityCountDataSetArr=[],this.aoiValue="",this.state={jimuMapView:null,searchSettings:null,activeDataSource:null,analysisSettings:null,generalSettings:this.props.config.generalSettings,aoiGeometries:null,displayLayerAccordion:[],isClosestAddressShowing:!1,isMapAreaWarningMsgShowing:!1,listMaxHeight:"",noResultsFoundMsg:""!==this.props.config.generalSettings.noResultsFoundText?this.props.config.generalSettings.noResultsFoundText:this.nls("noDataMessageDefaultText"),showNoResultsFoundMsg:!1,queryAborted:!1,msgActionGeometry:null,showExportButton:void 0===this.props.enableDataAction||this.props.enableDataAction,isLayerAvailable:!0,isAnalysisLayerConfigured:!0,widgetWidth:null,loadingAllFeaturesFromDs:!1,promptForDataAction:!1,showExportOptions:!1,dataSetArray:[],actionNames:[],actionNamesGroups:{},isDropDownLoading:!1,actionElement:null,dataSetUpdated:!1,onWidgetLoadShowLoadingIndicator:!0,isFilterActionBinded:!1,analysisTakingLongerTime:!1,showSaveIcon:!1,showFeatureForm:!1,currentPage:1,formFailedMsg:"",isSubmittingForm:!1,widgetClosed:!1,dsToGetSelectedOnLoad:[]}}updateDataActionDataSet(e){return new Promise((t=>{this.setState({dataSetArray:e,dataSetUpdated:!this.state.dataSetUpdated},(()=>{t()}))}))}render(){var e,a,n,r,l,d,c,u,h,p,g,y,m,f,v,b,S;const{showAllFeatures:w,searchByLocation:x,searchCurrentExtent:I}=F(this.state.searchSettings);if(!(null===(e=this.props.useMapWidgetIds)||void 0===e?void 0:e[0]))return(0,s.jsx)(i.WidgetPlaceholder,{icon:Lt,widgetId:this.props.id,message:this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:this.nls("_widgetLabel")})});const A=!this.state.onWidgetLoadShowLoadingIndicator&&(!(null===(a=this.state)||void 0===a?void 0:a.jimuMapView)||this.state.loadingAllFeaturesFromDs||0===this.state.displayLayerAccordion.length&&!this.state.showNoResultsFoundMsg&&(w||(x||I)&&this.state.aoiGeometries)&&(null===(n=this.state.analysisSettings)||void 0===n?void 0:n.layersInfo.length)>0&&null!==this.state.jimuMapView)&&!this.state.queryAborted,D=this.state.analysisTakingLongerTime?this.nls("analysisTakingLongerMsg"):this.nls("loadingText"),C=[];return(null===(r=this.state.dsToGetSelectedOnLoad)||void 0===r?void 0:r.length)>0&&this.state.dsToGetSelectedOnLoad.forEach((e=>{var t,i;const a=s.DataSourceManager.getInstance().getDataSource(e);a&&C.push({dataSourceId:e,mainDataSourceId:null===(t=a.getMainDataSource())||void 0===t?void 0:t.id,rootDataSourceId:null===(i=a.getRootDataSource())||void 0===i?void 0:i.id})})),(0,s.jsx)("div",{ref:this.widgetConRef,css:o(this.props.theme,this.state.listMaxHeight,this.state.generalSettings.noResultMsgStyleSettings,this.state.generalSettings.promptTextMsgStyleSettings,null===(l=this.state.searchSettings)||void 0===l?void 0:l.headingLabelStyle,this.state.showFeatureForm),className:"jimu-widget"},(0,s.jsx)(t.JimuMapViewComponent,{useMapWidgetId:null===(d=this.props.useMapWidgetIds)||void 0===d?void 0:d[0],onActiveViewChange:this.onActiveViewChange}),this.renderDataSourceComponent(),C.length>0&&(0,s.jsx)(s.MultipleDataSourceComponent,{useDataSources:(0,s.Immutable)([...C]),onDataSourceInfoChange:this.onDataSourceInfoChange,widgetId:this.props.id}),(0,s.jsx)("div",{className:"widget-near-me"},this.state.showFeatureForm&&this.renderFormForSavingInputLocation(),this.state.isSubmittingForm&&(0,s.jsx)(i.Loading,{type:i.LoadingType.Donut}),(0,s.jsx)("div",{className:"main-row w-100 h-100"},(0,s.jsx)("div",{ref:this.divRef},(x||I)&&this.state.jimuMapView&&this.state.isLayerAvailable&&this.state.isAnalysisLayerConfigured&&(0,s.jsx)(Pe,{ref:this.aoiToolRef,theme:this.props.theme,intl:this.props.intl,widgetClosed:this.state.widgetClosed,activateToolOnWidgetLoad:this.state.searchSettings.activeToolWhenWidgetOpens,isFilterActionBinded:this.state.isFilterActionBinded,headingLabel:null===(c=this.state.searchSettings)||void 0===c?void 0:c.headingLabel,showInputAddress:null===(u=this.state.searchSettings)||void 0===u?void 0:u.showInputAddress,config:this.state.searchSettings,highlightColor:gt.colorUtils.getThemeColorVariableValue(this.state.generalSettings.highlightColor,this.props.theme),bufferSymbol:this.state.generalSettings.searchAreaSymbol,jimuMapView:this.state.jimuMapView,aoiComplete:this.onAoiComplete,clear:this.onClear,bufferLayer:this.bufferLayer,drawingLayer:this.drawingLayer,updateClosestAddressState:this.updateClosestAddressState,incidentGraphicChange:this.onIncidentGraphicChange,msgActionGeometry:this.state.msgActionGeometry,widgetWidth:this.state.widgetWidth}),w&&this.state.jimuMapView&&this.state.isLayerAvailable&&this.state.isAnalysisLayerConfigured&&(0,s.jsx)(i.Label,{className:"headingLabelStyle px-2 pt-2"},null===(h=this.state.searchSettings)||void 0===h?void 0:h.headingLabel),((null===(p=this.state.displayLayerAccordion)||void 0===p?void 0:p.length)>0||0===this.state.displayLayerAccordion.length&&this.state.showNoResultsFoundMsg&&(w||x&&this.state.aoiGeometries)&&(null===(g=this.state.analysisSettings)||void 0===g?void 0:g.layersInfo.length)>0&&this.state.isAnalysisLayerConfigured)&&this.state.isLayerAvailable&&(x||w)&&this.state.jimuMapView&&(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)("div",{className:"float-right"},(0,s.jsx)(i.Button,{type:"tertiary","aria-label":this.nls("refreshTooltip"),icon:!0,title:this.nls("refreshTooltip"),onClick:()=>{this.onRefreshResult(!1)}},(0,s.jsx)(st,null))),x&&(0,s.jsx)("div",{className:"float-right"},(0,s.jsx)(i.Button,{type:"tertiary","aria-label":this.nls("clear"),icon:!0,title:this.nls("clear"),onClick:this.onResetButtonClick},(0,s.jsx)(ct,null))),this.state.showSaveIcon&&(0,s.jsx)("div",{className:"float-right"},(0,s.jsx)(i.Button,{type:"tertiary","aria-label":this.nls("saveTooltip"),icon:!0,title:this.nls("saveTooltip"),onClick:this.onSaveInputLocationClick},(0,s.jsx)(nt,null)))),(null===(y=this.state.displayLayerAccordion)||void 0===y?void 0:y.length)>0&&this.state.isLayerAvailable&&(x||w)&&this.state.jimuMapView&&this.state.showExportButton&&this.getRecordsCount()>0&&(0,s.jsx)(s.React.Fragment,null,this.renderBatchExportList()),(null===(m=this.state.displayLayerAccordion)||void 0===m?void 0:m.length)>0&&this.state.isLayerAvailable&&I&&this.state.jimuMapView&&this.state.showExportButton&&this.getRecordsCount()>0&&(0,s.jsx)("div",{className:"pr-1"},this.renderBatchExportList())),(0,s.jsx)("div",{className:"layerContainer"},this.state.onWidgetLoadShowLoadingIndicator&&this.state.isLayerAvailable&&(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(i.Loading,{type:i.LoadingType.Donut}),(0,s.jsx)("p",{className:"map-loading-text pt-4"},this.nls("mapLoadingMsg"))),A&&(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(i.Loading,{type:i.LoadingType.Donut}),(this.state.loadingAllFeaturesFromDs||(null===(f=this.state.analysisSettings)||void 0===f?void 0:f.layersInfo.length)>0)&&(0,s.jsx)("p",{className:"loading-text pt-4"},D,this.state.analysisTakingLongerTime&&(0,s.jsx)(i.Button,{role:"button","aria-label":this.nls("commonModalCancel"),title:this.nls("stopQueryProgressMsg"),size:"default",type:"default",className:"cancel-button-pos",onClick:this.stopLoading},this.nls("commonModalCancel")))),this.state.displayLayerAccordion.length>0&&this.state.jimuMapView&&this.state.isLayerAvailable&&(0,s.jsx)(s.React.Fragment,null,this.state.displayLayerAccordion),!A&&0===this.state.displayLayerAccordion.length&&(!this.state.showNoResultsFoundMsg||this.state.queryAborted)&&(null===(v=this.state.analysisSettings)||void 0===v?void 0:v.layersInfo.length)>0&&this.state.jimuMapView&&this.state.isAnalysisLayerConfigured&&this.state.isLayerAvailable&&(0,s.jsx)("div",{className:"applyPromptTextStyle"},this.state.generalSettings.promptTextMessage),!A&&0===this.state.displayLayerAccordion.length&&(w||(x||I)&&this.state.aoiGeometries)&&(null===(b=this.state.analysisSettings)||void 0===b?void 0:b.layersInfo.length)>0&&this.state.jimuMapView&&this.state.isAnalysisLayerConfigured&&this.state.isLayerAvailable&&this.state.showNoResultsFoundMsg&&!this.state.queryAborted&&(0,s.jsx)("div",{className:"applyTextStyle"},this.state.generalSettings.noResultsFoundText),!this.state.isAnalysisLayerConfigured&&this.state.isLayerAvailable&&(0,s.jsx)(i.Alert,{tabIndex:0,withIcon:!0,size:"small",type:"info",className:"w-100 shadow mb-1 m-0"},(0,s.jsx)("div",{className:"flex-grow-1 text-break settings-text-level"},this.nls("noAnalysisLayerMsg"))),!this.state.isLayerAvailable&&(0,s.jsx)(i.Alert,{tabIndex:0,withIcon:!0,size:"small",type:"info",className:"w-100 shadow mb-1 m-0"},(0,s.jsx)("div",{className:"flex-grow-1 text-break settings-text-level"},this.nls("warningMsgIfNoLayersOnMap")))))),(0,s.jsx)(s.ReactResizeDetector,{targetRef:this.widgetConRef,handleWidth:!0,handleHeight:!0,onResize:this.onResize}),this.state.promptForDataAction&&(0,s.jsx)(i.ConfirmDialog,{level:"info",title:this.getPromptMessageString(null===(S=this.props.selectedDataSource)||void 0===S?void 0:S.getLabel()),hasNotShowAgainOption:!1,content:this.nls("promptBottomMessageFromDataAction"),confirmLabel:this.nls("okButtonLabel"),cancelLabel:this.nls("commonModalCancel"),onConfirm:this.analyzeAllFeatures.bind(this),onClose:this.onCancelButtonClicked.bind(this)}))}}Ot.versionManager=vt,Ot.mapExtraStateProps=(e,t)=>{var s,i,a;return{selectedIncidentLocation:null===(s=null==t?void 0:t.mutableStateProps)||void 0===s?void 0:s.selectedIncidentLocation,selectedDataSource:null===(i=null==t?void 0:t.mutableStateProps)||void 0===i?void 0:i.selectedDataSource,messageConfigs:null===(a=null==e?void 0:e.appConfig)||void 0===a?void 0:a.messageConfigs}};const Rt=Ot;function Pt(e){L.p=e}})(),M})())}}}));