System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/widgets/Directions","esri/layers/RouteLayer","esri/rest/support/PointBarrier","esri/rest/support/PolylineBarrier","esri/rest/support/PolygonBarrier","jimu-core/react","jimu-theme"],(function(e,t){var n={},o={},r={},i={},a={},l={},s={},u={},c={},d={};return{setters:[function(e){n.DataSourceManager=e.DataSourceManager,n.DataSourceStatus=e.DataSourceStatus,n.MutableStoreManager=e.MutableStoreManager,n.React=e.React,n.ReactRedux=e.ReactRedux,n.ServiceManager=e.ServiceManager,n.UtilityManager=e.UtilityManager,n.css=e.css,n.dataSourceUtils=e.dataSourceUtils,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.jsx=e.jsx,n.loadArcGISJSAPIModule=e.loadArcGISJSAPIModule},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){r.Alert=e.Alert,r.WidgetPlaceholder=e.WidgetPlaceholder,r.defaultMessages=e.defaultMessages},function(e){i.default=e.default},function(e){a.default=e.default},function(e){l.default=e.default},function(e){s.default=e.default},function(e){u.default=e.default},function(e){c.useEffect=e.useEffect},function(e){d.styled=e.styled}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=d},10037:e=>{"use strict";e.exports=s},14321:e=>{"use strict";e.exports=r},17183:e=>{"use strict";e.exports=u},41556:e=>{"use strict";e.exports=a},62686:e=>{"use strict";e.exports=o},68972:e=>{"use strict";e.exports=c},70326:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M1.414 10 10 1.414 18.586 10 10 18.586zm-.707.707a1 1 0 0 1 0-1.414L9.293.707a1 1 0 0 1 1.414 0l8.586 8.586a1 1 0 0 1 0 1.414l-8.586 8.586a1 1 0 0 1-1.414 0zm14.19-2.041-3.314 3.352a9 9 0 0 0-.398-1.126l2.918-2.832zM7.71 8H10V7H6v4h1V8.706l1.33 1.325C9.483 11.3 10 11.987 10 14.5v.5h1v-.5c.16-2.227-.537-3.43-1.948-5.16z" clip-rule="evenodd"></path></svg>'},77375:e=>{"use strict";e.exports=l},79244:e=>{"use strict";e.exports=n},92491:e=>{"use strict";e.exports=i}},t={};function v(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,v),r.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var n in t)v.o(t,n)&&!v.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var p={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(p),v.d(p,{__set_webpack_public_path__:()=>J,default:()=>T});var e,t=v(79244),n=v(62686),o=v(14321),r=v(92491),i=v(41556),a=v(77375),l=v(10037),s=v(17183);!function(e){e.Imperial="imperial",e.Metric="metric"}(e||(e={}));const u={includeDefaultSources:!1,locationEnabled:!1,maxSuggestions:6};var c=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};function d(e){return`${e}_output_stop`}function g(e){return`${e}_output_direction_point`}function f(e){return`${e}_output_direction_line`}function y(e){return`${e}_output_route`}function m(){var n;return"english"===(null===(n=(0,t.getAppStore)().getState().user)||void 0===n?void 0:n.units)?e.Imperial:e.Metric}function h(e){var n;return e?null===(n=t.UtilityManager.getInstance().getUtilityJson(e.utilityId))||void 0===n?void 0:n.url:null}function S(e,n){return c(this,void 0,void 0,(function*(){const o=yield(0,t.loadArcGISJSAPIModule)("esri/rest/locator"),r=n.dataConfig.map((e=>h(e.useUtility))).asMutable().map((t=>o.locationToAddress(t,{location:e})));let i=null;for(const e of r)try{const{address:t}=yield e;if(t){i=t;break}}catch(e){console.error(e)}if(!i){const{address:t}=yield o.locationToAddress("https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",{location:e});i=t}return i}))}const b={_widgetLabel:"Directions",_action_DirectionsFrom_label:"Directions from",_action_DirectionsTo_label:"Directions to",_action_PlanRoute_label:"Plan route",outOfCredit:"Cannot load route service. This may be due to the service not being accessible.",namedInvalidUtilMsg:"{label} not available.",namedNeedLoginUtilMsg:"Sorry, you don't have permission to access {label}."};var w=v(70326),M=v.n(w),x=v(68972),I=v(1888),_=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};const D=t.UtilityManager.getInstance(),P=I.styled.div`
  display: flex;
  .jimu-alert-panel {
    flex: 1;
    margin: 2px;
  }
`;function U(e){const{useUtilities:n}=e,[r,i]=t.React.useState(null),[a,l]=t.React.useState(null),s=t.hooks.useTranslation(b,o.defaultMessages),[u,c]=t.React.useState(!0),[d,v]=t.React.useState(!0),p=t.ReactRedux.useSelector((e=>e.resourceSessions));return(0,x.useEffect)((()=>{!function(){_(this,void 0,void 0,(function*(){const e=[],t=[];if(n)for(let o=0;o<n.length;o++){const r=D.getLabelOfUseUtility(n[o]),i=D.getUtilityJson(n[o].utilityId),{success:a,isSignInError:l}=yield D.checkUtilityStatus(i);a||(l?t.push(r):e.push(r))}const o=t.length>0?s("namedNeedLoginUtilMsg",{label:t.join(", ")}):null;o!==a&&l(o);const u=e.length>0?s("namedInvalidUtilMsg",{label:e.join(", ")}):null;u!==r&&i(u)}))}()}),[r,a,s,n,p,null==e?void 0:e.useUtilities]),t.React.createElement("div",{className:"util-alert-wrapper d-flex flex-column position-absolute w-100",style:{bottom:0}},r&&t.React.createElement(P,null,t.React.createElement(o.Alert,{closable:!0,form:"basic",onClose:()=>{v(!1)},open:d,text:r,withIcon:!0})),a&&t.React.createElement(P,null,t.React.createElement(o.Alert,{closable:!0,form:"basic",onClose:()=>{c(!1)},open:u,text:a,withIcon:!0})))}var C=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};const{useEffect:R,useState:A,useRef:E,useCallback:j,useMemo:L}=t.React,T=e=>{var v,p;const{config:w,id:x}=e,{searchConfig:I,routeConfig:_}=w,D="dark"===(null===(v=e.theme)||void 0===v?void 0:v.sys.color.mode),P=null===(p=e.useMapWidgetIds)||void 0===p?void 0:p[0],[T,G]=A(null),J=E(null),[N,$]=A(Math.random()),H=E(null),z=E(null),W=E(null),q=t.hooks.useTranslation(b,o.defaultMessages),K=L((()=>q("findAddressOrPlace")),[q]),[Q,X]=A(!1),Y=t.ReactRedux.useSelector((e=>e.resourceSessions)),Z=j((e=>{G(e)}),[]),ee=j((()=>C(void 0,void 0,void 0,(function*(){if(Q&&z.current&&e.mutableStateProps){const{directionsFromPoint:n,directionsToPoint:o,routeStops:r}=e.mutableStateProps;if(n){const o=yield S(n,I);return z.current.layer.stops.at(0).geometry=n,z.current.layer.stops.at(0).name=o,void t.MutableStoreManager.getInstance().updateStateValue(e.widgetId,"directionsFromPoint",null)}if(o){const n=yield S(o,I),r=z.current.layer.stops.length;return z.current.layer.stops.at(r-1).geometry=o,z.current.layer.stops.at(r-1).name=n,void t.MutableStoreManager.getInstance().updateStateValue(e.widgetId,"directionsToPoint",null)}if(r){const n=r,o=yield Promise.all(n.map((e=>C(void 0,void 0,void 0,(function*(){const t=yield S(e,I);return{geometry:e,name:t}})))));return z.current.layer.stops.removeAll(),z.current.layer.stops.addMany(o),void t.MutableStoreManager.getInstance().updateStateValue(e.widgetId,"routeStops",null)}yield z.current.viewModel.load(),z.current.viewModel.layer.stops.filter((e=>null!==e.geometry)).length>=2&&(yield z.current.viewModel.getDirections())}}))),[Q,e.mutableStateProps,e.widgetId,I]);return R((()=>{!function(){var e,n;if(P&&(null==_?void 0:_.useUtility)&&(null===(e=null==I?void 0:I.dataConfig)||void 0===e?void 0:e.length)>0){const e=null===(n=(0,t.getAppStore)().getState().appConfig)||void 0===n?void 0:n.utilities,o=I.dataConfig.some((t=>!!t.useDataSource||e[t.useUtility.utilityId])),r=!!(e&&e[_.useUtility.utilityId]&&o);X(!(!_||!r))}else X(!1)}()}),[P,null==_?void 0:_.useUtility,null==I?void 0:I.dataConfig,_,null==e?void 0:e.useUtilities]),R((()=>{ee()})),R((()=>{!function(){C(this,void 0,void 0,(function*(){var n;if(J.current===Y||!(null==e?void 0:e.useUtilities))return;const o=J.current;J.current=Y;const r=null===(n=null==e?void 0:e.useUtilities)||void 0===n?void 0:n.map((e=>{var n;return null===(n=t.UtilityManager.getInstance().getUtilityJson(e.utilityId))||void 0===n?void 0:n.url})),i=yield Promise.all(r.map((e=>t.ServiceManager.getInstance().fetchArcGISServerInfo(e)))),a=new Set;for(let e=0;e<r.length;e++)a.add(i[e].owningSystemUrl||r[e]);const l=[...a],s=Object.keys(Y||{});for(const e of l){if(Y[e]&&Y[e]!==(null==o?void 0:o[e]))return void $(Math.random());for(const t of s)if(e.includes(t)&&Y[t]!==(null==o?void 0:o[t]))return void $(Math.random())}}))}()}),[null==e?void 0:e.useUtilities,Y]),R((()=>{function n(){var e,t,n;if(null===(t=null===(e=z.current)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map){const e=z.current.view.map.findLayerById(x);e&&T&&T.view.map.remove(e),z.current.destroy()}H.current&&(H.current.innerHTML="");try{const e=null===(n=document.querySelector("calcite-panel.esri-save-layer"))||void 0===n?void 0:n.parentElement;e&&"CALCITE-POPOVER"===e.tagName.toUpperCase()&&document.body.removeChild(e)}catch(e){}}return Q&&(null==T?void 0:T.view)&&H.current?function o(v){return C(this,void 0,void 0,(function*(){var p,S,b,M,P,U;n();const R=h(null==_?void 0:_.useUtility),A=yield function(e,n){return c(this,void 0,void 0,(function*(){var o,r,i;const a=Object.assign({},u),l=(null===(o=null==e?void 0:e.generalConfig)||void 0===o?void 0:o.hint)||n;if(l&&(a.allPlaceholder=l),"number"==typeof(null===(r=null==e?void 0:e.suggestionConfig)||void 0===r?void 0:r.maxSuggestions)&&(a.maxSuggestions=e.suggestionConfig.maxSuggestions),"boolean"==typeof(null===(i=null==e?void 0:e.suggestionConfig)||void 0===i?void 0:i.isUseCurrentLoation)&&(a.locationEnabled=e.suggestionConfig.isUseCurrentLoation),Array.isArray(null==e?void 0:e.dataConfig)){const o=null==e?void 0:e.dataConfig.asMutable({deep:!0}).map((e=>c(this,void 0,void 0,(function*(){var o,r;if(e.useUtility){const t={url:h(e.useUtility),name:e.label,placeholder:e.hint||n,withinViewEnabled:null!==(o=e.searchInCurrentMapExtent)&&void 0!==o&&o};return e.enableCountryCode&&(t.countryCode=e.countryCode),Promise.resolve(t)}if(e.useDataSource){const o=yield t.DataSourceManager.getInstance().createDataSourceByUseDataSource(e.useDataSource),i=t.dataSourceUtils.getJSAPILayer(o);if(!i)return null;const a={layer:i,searchFields:e.searchFields.map((e=>e.name)),outFields:e.displayFields.map((e=>e.name)),suggestionTemplate:e.displayFields.map((e=>`{${e.name}}`)).join(", "),searchTemplate:e.displayFields.map((e=>`{${e.name}}`)).join(", "),name:e.label,placeholder:e.hint||n,withinViewEnabled:null!==(r=e.searchInCurrentMapExtent)&&void 0!==r&&r};return Promise.resolve(a)}}))));yield Promise.all(o).then((e=>{a.sources=e.filter((e=>!!e))}))}return Promise.resolve(a)}))}(I,K),E=yield function(){return C(this,void 0,void 0,(function*(){var e;if(!T)return null;const t=null===(e=null==_?void 0:_.barrierLayers)||void 0===e?void 0:e[T.id];if(!t)return null;const n={points:[],polylines:[],polygons:[]};for(const e of t){const t=yield T.whenJimuLayerViewLoaded(e);let o=t.getLayerDataSource();const r=t.layerDataSourceId;o||(o=yield T.getMapDataSource().createDataSourceById(r));const{records:i}=yield o.query({where:"1=1",returnGeometry:!0});switch(o.getGeometryType()){case"esriGeometryPoint":{const e=i.map((e=>new a.default({geometry:e.getGeometry()})));n.points.push(...e);break}case"esriGeometryPolyline":{const e=i.map((e=>new l.default({geometry:e.getGeometry()})));n.polylines.push(...e);break}case"esriGeometryPolygon":{const e=i.map((e=>new s.default({geometry:e.getGeometry()})));n.polygons.push(...e);break}}}return n}))}(),j=document.createElement("div");j.className="directions-container",D&&(j.className+=" dark-theme"),H.current&&(H.current.innerHTML="",H.current.appendChild(j));const L=`${e.label} - ${q("route")}`,k=new i.default({id:x,url:R,title:L,pointBarriers:null==E?void 0:E.points,polylineBarriers:null==E?void 0:E.polylines,polygonBarriers:null==E?void 0:E.polygons});"boolean"!=typeof w.showRuntimeLayers||w.showRuntimeLayers||(k.listMode="hide"),z.current=new r.default({id:x,layer:k,container:j,view:null==T?void 0:T.view,searchProperties:A,unit:null!==(p=null==w?void 0:w.unit)&&void 0!==p?p:m(),visibleElements:{printButton:!1}});const G=z.current.view.map.findLayerById(x);G&&(null===(b=null===(S=null==T?void 0:T.view)||void 0===S?void 0:S.map)||void 0===b||b.remove(G)),null===(P=null===(M=null==T?void 0:T.view)||void 0===M?void 0:M.map)||void 0===P||P.add(k),null===(U=null==w?void 0:w.enableRouteSaving)||void 0===U||U||(z.current.visibleElements={printButton:!1,saveAsButton:!1,saveButton:!1,layerDetails:!1}),z.current.viewModel.routeParameters.returnRoutes=!0,z.current.viewModel.routeParameters.returnDirections=!0,z.current.viewModel.routeParameters.returnStops=!0,z.current.viewModel.reset=()=>{o(!0)},ee(),B(x),W.current=z.current.watch("lastRoute",(()=>{e.autoHeight&&(H.current.style.maxHeight="750px"),z.current.lastRoute?function(e,n){C(this,void 0,void 0,(function*(){var o,r,i;try{const a=yield t.DataSourceManager.getInstance().createDataSource(d(e)),l=yield t.DataSourceManager.getInstance().createDataSource(y(e)),s=yield t.DataSourceManager.getInstance().createDataSource(g(e)),u=yield t.DataSourceManager.getInstance().createDataSource(f(e));yield V(a,"point",O(null===(o=n.stops)||void 0===o?void 0:o.toArray())),yield V(l,"polyline",O(n.routeInfo?[n.routeInfo]:[])),yield V(s,"point",O(null===(r=n.directionPoints)||void 0===r?void 0:r.toArray())),yield V(u,"polyline",O(null===(i=n.directionLines)||void 0===i?void 0:i.toArray())),F(a),F(l),F(s),F(u)}catch(e){console.log("Failed to create directions output data sources. ",e)}}))}(x,z.current.lastRoute):B(x)})),function(e){C(this,void 0,void 0,(function*(){!e&&_&&(_.presetStart||_.presetEnd)&&(_.presetStart&&(z.current.layer.stops.at(0).name=_.presetStart.name,z.current.layer.stops.at(0).geometry=_.presetStart.geometry),_.presetEnd&&(z.current.layer.stops.at(1).name=_.presetEnd.name,z.current.layer.stops.at(1).geometry=_.presetEnd.geometry),yield z.current.viewModel.load(),_.presetStart&&_.presetEnd&&z.current.getDirections())}))}(v)}))}():n(),()=>{var e;null===(e=W.current)||void 0===e||e.remove(),n()}}),[x,null==T?void 0:T.view,I,K,Q,D,e.autoHeight,ee,N,e.label,q,null==w?void 0:w.showRuntimeLayers,null==w?void 0:w.unit,T,_,null==w?void 0:w.enableRouteSaving]),(0,t.jsx)("div",{className:"widget-directions jimu-widget"},Q?(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(n.JimuMapViewComponent,{useMapWidgetId:P,onActiveViewChange:Z}),(0,t.jsx)("div",{ref:H,css:k}),(0,t.jsx)(U,{useUtilities:e.useUtilities})):(0,t.jsx)(o.WidgetPlaceholder,{widgetId:x,icon:M(),name:q("_widgetLabel")}))},k=t.css`
  width: 100% !important;
  height: 100% !important;
  .directions-container{
    width: 100% !important;
    height: 100% !important;
    overflow: scroll;
    .esri-search{
      .esri-search__container{
        .esri-search__sources-button{
          z-index: 0;
          border-top: none;
          border-right: solid 1px var(--ref-palette-neutral-400);
          border-bottom: none;
          border-left: none;
          margin-right: 1px;
          margin-bottom: 2px;
        }
        .esri-search__input-container{
          margin: auto;
          .esri-search__clear-button{
            z-index: 0;
            right: 1px;
          }
        }
      }
      .esri-search--multiple-sources {
        .esri-search__sources-button {
          border-right: inherit;
        }
        .esri-search__input {
          border: 1px solid #959595;
        }
      }
    }
    .esri-directions__panel-content{
      padding: 0 0 20px 0;
      div[role='button'] {
        cursor: unset;
      }
    }
    .esri-directions__add-stop-button{
      --calcite-ui-text-1: var(--ref-palette-neutral-1200);
    }
    &.dark-theme img.esri-directions__maneuver-icon{
      filter: invert(100%);
    }
  }
`;function B(e){return C(this,void 0,void 0,(function*(){try{const n=yield t.DataSourceManager.getInstance().createDataSource(d(e)),o=yield t.DataSourceManager.getInstance().createDataSource(y(e)),r=yield t.DataSourceManager.getInstance().createDataSource(g(e)),i=yield t.DataSourceManager.getInstance().createDataSource(f(e));G(n),G(o),G(r),G(i)}catch(e){console.log("Failed to create directions output data sources. ",e)}}))}function G(e){e&&(e.setStatus(t.DataSourceStatus.NotReady),e.setCountStatus(t.DataSourceStatus.NotReady))}function F(e){e&&(e.setStatus(t.DataSourceStatus.Unloaded),e.setCountStatus(t.DataSourceStatus.Unloaded))}function V(e,t,n){return C(this,void 0,void 0,(function*(){e&&(yield e.setSourceFeatures(n,{id:e.id,geometryType:t}))}))}function O(e){return e?e.map((e=>null==e?void 0:e.toGraphic())).filter((e=>!!e)):[]}function J(e){v.p=e}})(),p})())}}}));