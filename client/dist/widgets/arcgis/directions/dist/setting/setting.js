System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/utility-selector","jimu-arcgis","jimu-theme","jimu-ui/advanced/map"],(function(e,t){var i={},n={},o={},r={},a={},l={},s={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.JSAPILayerTypes=e.JSAPILayerTypes,i.React=e.React,i.SupportedUtilityType=e.SupportedUtilityType,i.UtilityManager=e.UtilityManager,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.jsx=e.jsx,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,i.lodash=e.lodash,i.polished=e.polished},function(e){n.AlertPopup=e.AlertPopup,n.Badge=e.Badge,n.Button=e.Button,n.CollapsablePanel=e.CollapsablePanel,n.Loading=e.Loading,n.Option=e.Option,n.Select=e.Select,n.Switch=e.Switch,n.Tooltip=e.Tooltip,n.defaultMessages=e.defaultMessages},function(e){o.JimuLayerViewSelectorDropdown=e.JimuLayerViewSelectorDropdown,o.MapWidgetSelector=e.MapWidgetSelector,o.SearchDataSetting=e.SearchDataSetting,o.SearchDataType=e.SearchDataType,o.SearchGeneralSetting=e.SearchGeneralSetting,o.SearchSuggestionSetting=e.SearchSuggestionSetting,o.SettingRow=e.SettingRow,o.SettingSection=e.SettingSection},function(e){r.UtilitySelector=e.UtilitySelector,r.addNewUtility=e.addNewUtility,r.extractService=e.extractService},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent,a.MapViewManager=e.MapViewManager},function(e){l.Global=e.Global,l.useTheme=e.useTheme},function(e){s.JimuMap=e.JimuMap}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=l},14321:e=>{"use strict";e.exports=n},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},48993:e=>{"use strict";e.exports=s},53195:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 3.307V15l5.722-2.117 4.528 1.937L16 12.693V1l-5.722 2.117L5.75 1.18zm1 10.286V3.974l4-1.48v9.619zm5-1.65 4 1.711V4.057L6 2.346zm5 1.563V3.887l4-1.48v9.619z" clip-rule="evenodd"></path></svg>'},60044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 15 15"><path fill="#000" fill-rule="evenodd" d="M7 0h1v4H7zM0 8V7h4v1zm11-1v1h4V7zm-4 4h1v4H7zm2-5H6v3h3z" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=a},71371:e=>{"use strict";e.exports=r},72529:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027 0A8 8 0 1 1 0 8a8 8 0 0 1 8.027-8m-2.07 1.303A7 7 0 0 0 2.256 4h1.6a8.3 8.3 0 0 1 2.103-2.697M3.453 5H1.674a7 7 0 0 0-.656 2.5H3.01q.06-1.336.441-2.5m.56 2.5a8.1 8.1 0 0 1 .5-2.5H7.5v2.5zm-1.001 1H1.018c.062.89.291 1.733.656 2.5h1.778a9.3 9.3 0 0 1-.441-2.5M4.512 11a8.1 8.1 0 0 1-.5-2.5H7.5V11zm-.657 1h-1.6a7 7 0 0 0 3.702 2.697A8.3 8.3 0 0 1 3.855 12M7.5 14.61V12H4.985q.869 1.516 2.515 2.61M7.5 4V1.39Q5.854 2.484 4.985 4zm2.543 10.697A7 7 0 0 0 13.745 12h-1.6a8.3 8.3 0 0 1-2.102 2.697M12.548 11h1.778c.365-.767.594-1.61.656-2.5H12.99a9.3 9.3 0 0 1-.441 2.5m-.56-2.5a8.1 8.1 0 0 1-.5 2.5H8.5V8.5zm1.001-1h1.993a7 7 0 0 0-.656-2.5h-1.778q.381 1.164.441 2.5M11.488 5q.434 1.146.5 2.5H8.5V5zm.657-1h1.6a7 7 0 0 0-3.703-2.697Q11.408 2.473 12.145 4M8.5 1.39Q10.146 2.484 11.015 4H8.5zM8.5 12h2.515q-.869 1.516-2.515 2.61z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},79298:e=>{"use strict";e.exports=o}},t={};function u(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,u),o.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var i in t)u.o(t,i)&&!u.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{__set_webpack_public_path__:()=>Q,default:()=>z});var e=u(79244),t=u(14321),i=u(79298),n=u(71371),o=u(31027),r=u.n(o),a=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const l=t=>{const i=window.SVG,{className:n}=t,o=a(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",n);return i?e.React.createElement(i,Object.assign({className:l,src:r()},o)):e.React.createElement("svg",Object.assign({className:l},o))};var s=u(53195),d=u.n(s),p=u(72529),g=u.n(p);const v={routeSettings:"Route Settings",searchSettings:"Search settings",generalSettings:"General settings",routeUrl:"Route URL",outputStops:"Stops",outputRoute:"Route",outputDirectionPoints:"Direction points",outputDirectionLines:"Direction lines",unitSystem:"Unit system",barrierLayers:"Barrier layers",barrierDescription:"Supports up to 250 point barriers, 500 polyline barrier intersections, and 2,000 polygon barrier intersections per routing request.",showRoutesInLayerLists:"Show routes in layer lists",enableRouteSaving:"Enable route saving",presetStops:"Preset stops",specifyStops:"Specify stops",startPoint:"Start point",endPoint:"End point"};var f;!function(e){e.Imperial="imperial",e.Metric="metric"}(f||(f={}));const m={includeDefaultSources:!1,locationEnabled:!1,maxSuggestions:6};var h=function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{s(n.next(e))}catch(e){r(e)}}function l(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}s((n=n.apply(e,t||[])).next())}))};function y(e){return`${e}_output_stop`}function S(e){return`${e}_output_direction_point`}function w(e){return`${e}_output_direction_line`}function b(e){return`${e}_output_route`}function x(t){if(!t)return null;const i={};return t.forEach((t=>{i[t.name]=e.dataSourceUtils.convertFieldToJimuField(t,null)})),i}function j(){var t;return"english"===(null===(t=(0,e.getAppStore)().getState().user)||void 0===t?void 0:t.units)?f.Imperial:f.Metric}function C(t){var i;return t?null===(i=e.UtilityManager.getInstance().getUtilityJson(t.utilityId))||void 0===i?void 0:i.url:null}var M=u(62686),I=u(45508),O=u.n(I),R=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const P=t=>{const i=window.SVG,{className:n}=t,o=R(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return i?e.React.createElement(i,Object.assign({className:r,src:O()},o)):e.React.createElement("svg",Object.assign({className:r},o))};var D=u(1888),U=u(48993),N=u(60044),L=u.n(N),T=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const E=t=>{const i=window.SVG,{className:n}=t,o=T(t,["className"]),r=(0,e.classNames)("jimu-icon jimu-icon-component",n);return i?e.React.createElement(i,Object.assign({className:r,src:L()},o)):e.React.createElement("svg",Object.assign({className:r},o))};var _=function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{s(n.next(e))}catch(e){r(e)}}function l(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}s((n=n.apply(e,t||[])).next())}))};const A=(t,i)=>e.css`
    .stops-selector-alert-popup {
      justify-content: center;
      max-width: max-content !important;
      .stops-selector-alert-popup__content {
        width: ${window.innerHeight-200}px;
        height: ${window.innerHeight-300}px;
        display: flex;
        flex-direction: column;
        .jimu-map {
          cursor: ${i?"crosshair":""}
        }
        .search-widget-container {
          --calcite-color-foreground-1: #444;
          display: flex;
          min-height: 32px;
          max-height: 32px;
          overflow: hidden;
          justify-content: space-between;
          align-items: center;
          margin-top: 0.75rem;
          .stops-label {
            width: 178px;
          }
          .locate-button.locating {
            background-color: var(--sys-color-primary-main);
          }
          .search-widget-container__content {
            margin-left: 16px;
            flex: 1;
            .esri-search {
              width: 100%;
            }
          }
        }
      }
    }
  `;function V(i){var n,o,r,a,l,s,u,c,d,p;const[g,f]=e.React.useState(!1),[y,S]=e.React.useState(null),w=e.React.useRef(null),b=e.React.useRef(null),x=e.React.useRef(null),j=e.React.useRef(null),[M,I]=e.React.useState(!1),[O,R]=e.React.useState(!1),P=e.hooks.useTranslation(v),N=((0,D.useTheme)(),e.React.useRef(null)),L=e.React.useRef(null),T=e.React.useRef(null),V=e.React.useRef(null),k=e.React.useRef(null),F=e.React.useRef(null),[J,B]=e.React.useState(!1),[G,H]=e.React.useState(!1),[z,W]=e.React.useState(!1),$=()=>{f(!0)},q=e.React.useCallback(((e,t)=>{let n=i.directionsProps.config;n=n.setIn(["routeConfig","presetStart"],e?{name:e.name,geometry:e.graphic.geometry.toJSON()}:null),n=n.setIn(["routeConfig","presetEnd"],t?{name:t.name,geometry:t.graphic.geometry.toJSON()}:null),i.directionsProps.onSettingChange({id:i.directionsProps.id,config:n})}),[i.directionsProps]),Q=e.React.useCallback((e=>t=>{if(!G)return;const i=t.result,n=i.feature.geometry,o=i.name,r=new(0,V.current)({geometry:n,symbol:{type:"simple-marker",color:e?"#00FF00":"#FF0000",size:12,outline:{color:"white",width:1}}});e&&L.current&&y.view.graphics.remove(L.current.graphic),!e&&T.current&&y.view.graphics.remove(T.current.graphic),e?L.current={graphic:r,name:o}:T.current={graphic:r,name:o},y.view.graphics.add(r)}),[null===(n=null==y?void 0:y.view)||void 0===n?void 0:n.graphics,G]),Z=e.React.useCallback((e=>()=>{var t,i;e&&L.current&&(null===(t=null==y?void 0:y.view)||void 0===t||t.graphics.remove(L.current.graphic),L.current=null),!e&&T.current&&(null===(i=null==y?void 0:y.view)||void 0===i||i.graphics.remove(T.current.graphic),T.current=null)}),[null===(o=null==y?void 0:y.view)||void 0===o?void 0:o.graphics]),K=e=>t=>{e?(R(!1),I(!M)):(I(!1),R(!O))};e.React.useEffect((()=>{!function(){_(this,void 0,void 0,(function*(){if(G)return;const[t,i,n]=yield(0,e.loadArcGISJSAPIModules)(["esri/Graphic","esri/geometry/support/jsonUtils","esri/widgets/Search"]);V.current=t,F.current=i,k.current=n,H(!0)}))}()}),[G]),e.React.useEffect((()=>{!function(){var e,t,n,o;if(!J||!G)return;const r=null===(t=null===(e=null==i?void 0:i.directionsProps.config)||void 0===e?void 0:e.routeConfig)||void 0===t?void 0:t.presetStart,a=null===(o=null===(n=null==i?void 0:i.directionsProps.config)||void 0===n?void 0:n.routeConfig)||void 0===o?void 0:o.presetEnd;if(r){const e=F.current.fromJSON(r.geometry);x.current.search(e)}if(a){const e=F.current.fromJSON(a.geometry);j.current.search(e)}}()}),[J,null===(a=null===(r=null==i?void 0:i.directionsProps.config)||void 0===r?void 0:r.routeConfig)||void 0===a?void 0:a.presetEnd,null===(s=null===(l=null==i?void 0:i.directionsProps.config)||void 0===l?void 0:l.routeConfig)||void 0===s?void 0:s.presetStart,G]),e.React.useEffect((()=>{(null==y?void 0:y.view)&&G&&(N.current&&N.current.remove(),N.current=y.view.on("click",(function(e){return _(this,void 0,void 0,(function*(){if(!(M||O))return;const t=e.mapPoint;M&&L.current&&y.view.graphics.remove(L.current.graphic),O&&T.current&&y.view.graphics.remove(T.current.graphic),yield M?x.current.search(t):j.current.search(t),M?I(!1):R(!1)}))})))}),[null==y?void 0:y.view,O,M,i.directionsProps.config.searchConfig,G]),e.hooks.useEffectWithPreviousValues((t=>{const[n,o]=t;!function(){_(this,void 0,void 0,(function*(){if(!y||!G)return;if(n===y&&o===i.directionsProps.config.searchConfig)return;const t=k.current,r=document.createElement("div");r.className="search-container",w.current.innerHTML="",w.current.appendChild(r);const a=document.createElement("div");a.className="search-container",b.current.innerHTML="",b.current.appendChild(a);const l=yield function(t,i){return h(this,void 0,void 0,(function*(){var n,o,r;const a=Object.assign({},m),l=(null===(n=null==t?void 0:t.generalConfig)||void 0===n?void 0:n.hint)||i;if(l&&(a.allPlaceholder=l),"number"==typeof(null===(o=null==t?void 0:t.suggestionConfig)||void 0===o?void 0:o.maxSuggestions)&&(a.maxSuggestions=t.suggestionConfig.maxSuggestions),"boolean"==typeof(null===(r=null==t?void 0:t.suggestionConfig)||void 0===r?void 0:r.isUseCurrentLoation)&&(a.locationEnabled=t.suggestionConfig.isUseCurrentLoation),Array.isArray(null==t?void 0:t.dataConfig)){const n=null==t?void 0:t.dataConfig.asMutable({deep:!0}).map((t=>h(this,void 0,void 0,(function*(){var n,o;if(t.useUtility){const e={url:C(t.useUtility),name:t.label,placeholder:t.hint||i,withinViewEnabled:null!==(n=t.searchInCurrentMapExtent)&&void 0!==n&&n};return t.enableCountryCode&&(e.countryCode=t.countryCode),Promise.resolve(e)}if(t.useDataSource){const n=yield e.DataSourceManager.getInstance().createDataSourceByUseDataSource(t.useDataSource),r=e.dataSourceUtils.getJSAPILayer(n);if(!r)return null;const a={layer:r,searchFields:t.searchFields.map((e=>e.name)),outFields:t.displayFields.map((e=>e.name)),suggestionTemplate:t.displayFields.map((e=>`{${e.name}}`)).join(", "),searchTemplate:t.displayFields.map((e=>`{${e.name}}`)).join(", "),name:t.label,placeholder:t.hint||i,withinViewEnabled:null!==(o=t.searchInCurrentMapExtent)&&void 0!==o&&o};return Promise.resolve(a)}}))));yield Promise.all(n).then((e=>{a.sources=e.filter((e=>!!e))}))}return Promise.resolve(a)}))}(i.directionsProps.config.searchConfig,P("findAddressOrPlace"));x.current=new t({view:y.view,container:r,sources:l.sources,includeDefaultSources:!1,locationEnabled:!1,popupEnabled:!1}),j.current=new t({view:y.view,container:a,sources:l.sources,includeDefaultSources:!1,locationEnabled:!1,popupEnabled:!1}),yield Promise.all([x.current.when(),j.current.when()]),B(!0),x.current.on("select-result",Q(!0)),j.current.on("select-result",Q(!1)),x.current.on("search-clear",Z(!0)),j.current.on("search-clear",Z(!1))}))}()}),[y,i.directionsProps.config.searchConfig,Q,P,G]);const X=i.jimuMapConfig?i.jimuMapConfig.set("toolConfig",{canZoom:!0,canHome:!0,canSearch:!1,canCompass:!0}):(0,e.Immutable)({}),Y=M||O,ee=(null===(c=null===(u=i.directionsProps.config)||void 0===u?void 0:u.routeConfig)||void 0===c?void 0:c.presetStart)||(null===(p=null===(d=i.directionsProps.config)||void 0===d?void 0:d.routeConfig)||void 0===p?void 0:p.presetEnd);return(0,e.jsx)("div",{css:A(0,Y)},(0,e.jsx)(D.Global,{styles:A(0,Y)}),ee?(0,e.jsx)(t.Badge,{dot:!0,color:"error"},(0,e.jsx)(t.Button,{onClick:$},i.buttonLabel)):(0,e.jsx)(t.Button,{onClick:$},i.buttonLabel),(0,e.jsx)(t.AlertPopup,{className:"stops-selector-alert-popup",isOpen:g,title:i.title,onClickOk:()=>{q(L.current,T.current),f(!1),B(!1),W(!1)},onClickClose:()=>{L.current=null,T.current=null,f(!1),B(!1),W(!1)}},!z&&(0,e.jsx)(t.Loading,null),(0,e.jsx)("div",{className:"stops-selector-alert-popup__content",style:{visibility:z?"visible":"hidden"}},(0,e.jsx)("div",{className:"w-100 h-100 jimu-map",style:{backgroundColor:"gray",marginBottom:"0.75rem"}},(0,e.jsx)(U.JimuMap,{id:i.id+"editor",useDataSources:i.useDataSources,jimuMapConfig:X,onActiveViewChange:e=>_(this,void 0,void 0,(function*(){S(e),yield e.whenJimuMapViewLoaded(),W(!0)}))})),(0,e.jsx)("div",{className:"search-widget-container"},(0,e.jsx)("div",{className:"stops-label"},P("startPoint")),(0,e.jsx)("div",{className:"d-flex search-widget-container__content"},(0,e.jsx)("div",{ref:w,className:"w-100 d-flex"}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("locate-button",M?"locating":""),icon:!0,onClick:K(!0)},(0,e.jsx)(E,null)))),(0,e.jsx)("div",{className:"search-widget-container"},(0,e.jsx)("div",{className:"stops-label"},P("endPoint")),(0,e.jsx)("div",{className:"d-flex search-widget-container__content"},(0,e.jsx)("div",{ref:b,className:"w-100 d-flex"}),(0,e.jsx)(t.Button,{className:(0,e.classNames)("locate-button",O?"locating":""),icon:!0,onClick:K(!1)},(0,e.jsx)(E,null)))))))}var k=function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{s(n.next(e))}catch(e){r(e)}}function l(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,l)}s((n=n.apply(e,t||[])).next())}))};const{useMemo:F,useEffect:J,useState:B}=e.React,G={maxSuggestions:6},H=[e.SupportedUtilityType.Routing],z=o=>{var r,a,s,u,c,p,m,h,C,I,O;const{onSettingChange:R,id:D,config:U,useMapWidgetIds:N,useUtilities:L,portalUrl:T}=o,E=e.hooks.useTranslation(v,t.defaultMessages),_=null==U?void 0:U.routeConfig,A=null===(r=U.searchConfig)||void 0===r?void 0:r.dataConfig,z=null===(a=U.searchConfig)||void 0===a?void 0:a.generalConfig,Q=F((()=>{var t;return(0,e.Immutable)(G).merge((null===(t=U.searchConfig)||void 0===t?void 0:t.suggestionConfig)||{})}),[null===(s=U.searchConfig)||void 0===s?void 0:s.suggestionConfig]),Z=e.React.useRef(null),[K,X]=B(null),[Y,ee]=B(!1),[te,ie]=B(null);J((()=>{Z.current=U}),[U]);const ne=e.React.useCallback((t=>{var i,n,o;if(!e.lodash.isDeepEqual(t,A)){const e=Z.current.setIn(["searchConfig","dataConfig"],t);R({id:D,config:e,useUtilities:$(null===(n=null===(i=Z.current)||void 0===i?void 0:i.routeConfig)||void 0===n?void 0:n.useUtility,null===(o=null==t?void 0:t.filter((e=>!!e.useUtility)).map((e=>e.useUtility)))||void 0===o?void 0:o.asMutable())})}}),[D,A,R]),oe=e=>t=>{0===t.length?R({id:D,config:U.setIn(["routeConfig","barrierLayers"],U.getIn(["routeConfig","barrierLayers"]).without(e))}):R({id:D,config:U.setIn(["routeConfig","barrierLayers",e],t)})},re=t=>{var i;return!(t.type===e.JSAPILayerTypes.FeatureLayer&&["point","polyline","polygon"].includes(null===(i=t.layer)||void 0===i?void 0:i.geometryType))},ae=F((()=>(null==N?void 0:N.length)>0),[N]),le=`${D}-desc`;return J((()=>{var t;const i=A&&function(e,t){return e.filter((e=>!!e.useDataSource||t.some((t=>{var i;return t.utilityId===(null===(i=null==e?void 0:e.useUtility)||void 0===i?void 0:i.utilityId)}))))}(A,L),n=_&&function(e,t){if(e&&e.useUtility&&t.some((t=>t.utilityId===e.useUtility.utilityId)))return e;return e.without("useUtility")}(_,L);e.lodash.isDeepEqual(i,A)&&e.lodash.isDeepEqual(n,_)||R({id:D,config:U.setIn(["searchConfig","dataConfig"],i).setIn(["routeConfig"],n),useUtilities:$(null==n?void 0:n.useUtility,null===(t=null==i?void 0:i.map((e=>e.useUtility)))||void 0===t?void 0:t.asMutable())})}),[U,D,R,_,A,L]),J((()=>{if(K)return;const t=function(t){var i;const o=null===(i=(0,e.getAppStore)().getState().portalSelf)||void 0===i?void 0:i.helperServices;return(0,n.extractService)(o,e.SupportedUtilityType.Routing,null,null,t)}(E);if(!t||0===t.length)return;const i=t[0];(0,n.addNewUtility)(i);const o=e.UtilityManager.getInstance().getIdOfOrgUtility(i.name,i.url,i.index,i.label);!K&&o&&X(o)}),[K,E]),e.hooks.useEffectWithPreviousValues((e=>{var t,i,n;const[o]=e;if((!(null==o?void 0:o.routeConfig)||(null==U?void 0:U.routeConfig))&&K&&!(null==U?void 0:U.routeConfig)&&!Y){const e={utilityId:K};R({id:D,config:U.setIn(["routeConfig","useUtility"],e),useUtilities:$(e,null===(n=null===(i=null===(t=U.searchConfig)||void 0===t?void 0:t.dataConfig)||void 0===i?void 0:i.map((e=>e.useUtility)))||void 0===n?void 0:n.asMutable())}),ee(!0)}}),[U,Y,K,D,R,E]),(0,e.jsx)("div",{className:"widget-setting-directions jimu-widget-setting",css:W},(0,e.jsx)(i.SettingSection,{title:E("selectMapWidget"),className:(0,e.classNames)({"border-0":!ae})},(0,e.jsx)(i.SettingRow,null,(0,e.jsx)(i.MapWidgetSelector,{onSelect:t=>k(void 0,void 0,void 0,(function*(){const i=yield function(t,i,n){return k(this,void 0,void 0,(function*(){var o,r,a,l;if(!i||0===i.length)return Promise.resolve([]);try{const[i,s,u,c]=yield(0,e.loadArcGISJSAPIModules)(["esri/rest/support/Stop","esri/rest/support/DirectionPoint","esri/rest/support/DirectionLine","esri/rest/support/RouteInfo"]);return[{id:y(t),label:n("outputStops"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPoint",schema:{idField:(null===(o=i.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===o?void 0:o.name)||"__OBJECTID",fields:Object.assign({},x(i.fields))}},{id:S(t),label:n("outputDirectionPoints"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPoint",schema:{idField:(null===(r=s.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===r?void 0:r.name)||"__OBJECTID",fields:Object.assign({},x(s.fields))}},{id:w(t),label:n("outputDirectionLines"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPolyline",schema:{idField:(null===(a=u.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===a?void 0:a.name)||"__OBJECTID",fields:Object.assign({},x(u.fields))}},{id:b(t),label:n("outputRoute"),type:e.DataSourceTypes.FeatureLayer,isOutputFromWidget:!0,geometryType:"esriGeometryPolyline",schema:{idField:(null===(l=c.fields.find((e=>"esriFieldTypeOID"===e.type)))||void 0===l?void 0:l.name)||"__OBJECTID",fields:Object.assign({},x(c.fields))}}]}catch(e){return console.warn("Failed to create output data source in directions widget. ",e),Promise.resolve([])}}))}(D,t,E);R({id:D,useMapWidgetIds:t},i)})),useMapWidgetIds:N}))),ae?(0,e.jsx)("div",null,(0,e.jsx)(M.JimuMapViewComponent,{useMapWidgetId:null==N?void 0:N[0],onViewsChange:e=>{const t=1===Object.keys(e).length&&Object.keys(e)[0]===`${null==N?void 0:N[0]}-`;ie(t?null:e)}}),(0,e.jsx)(i.SettingSection,{role:"group","aria-label":E("routeSettings"),title:E("routeSettings")},(0,e.jsx)(i.SettingRow,{flow:"wrap",label:E("routeUrl")},(0,e.jsx)(n.UtilitySelector,{useUtilities:(0,e.Immutable)((null==_?void 0:_.useUtility)&&(null==L?void 0:L.some((e=>_.useUtility.utilityId===e.utilityId)))?[_.useUtility]:[]),onChange:e=>{var t,i,n,o,r;(null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.utilityId)!==(null===(i=null==_?void 0:_.useUtility)||void 0===i?void 0:i.utilityId)&&R({id:D,config:U.setIn(["routeConfig","useUtility"],null==e?void 0:e[0]),useUtilities:$(null==e?void 0:e[0],null===(r=null===(o=null===(n=U.searchConfig)||void 0===n?void 0:n.dataConfig)||void 0===o?void 0:o.map((e=>e.useUtility)))||void 0===r?void 0:r.asMutable())})},showRemove:!0,closePopupOnSelect:!0,types:H,"aria-describedby":le})),(0,e.jsx)(i.SettingRow,{className:"mt-0"},(0,e.jsx)("i",{className:"text-break example-url",id:le},E("exampleUrl",{url:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World"}))),(0,e.jsx)(i.SettingRow,{flow:"wrap",label:E("presetStops")},(0,e.jsx)(V,{directionsProps:o,buttonLabel:E("specifyStops"),title:E("specifyStops"),id:null===(u=o.useMapWidgetIds)||void 0===u?void 0:u[0],jimuMapConfig:(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets[null===(c=o.useMapWidgetIds)||void 0===c?void 0:c[0]].config,useDataSources:(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets[null===(p=o.useMapWidgetIds)||void 0===p?void 0:p[0]].useDataSources})),te&&(0,e.jsx)(i.SettingRow,{flow:"no-wrap",label:E("barrierLayers")},(0,e.jsx)(t.Tooltip,{title:E("barrierDescription")},(0,e.jsx)(t.Button,{icon:!0,variant:"text",disableHoverEffect:!0,disableRipple:!0,className:"p-0"},(0,e.jsx)(P,null)))),(0,e.jsx)(i.SettingRow,{flow:"wrap",className:"mt-2"},te&&(function(e){if(!e)return!1;return Object.keys(e).length>1}(te)?Object.keys(te).map((n=>{var o,r;return(0,e.jsx)(t.CollapsablePanel,{leftIcon:"2d"===te[n].view.type?d():g(),key:n,label:q(n)},(0,e.jsx)(i.JimuLayerViewSelectorDropdown,{jimuMapViewId:n,onChange:oe(n),selectedValues:null===(r=null===(o=null==_?void 0:_.barrierLayers)||void 0===o?void 0:o[n])||void 0===r?void 0:r.asMutable(),isMultiSelection:!0,autoHeight:!0,disableLayers:re}))})):(0,e.jsx)(i.JimuLayerViewSelectorDropdown,{jimuMapViewId:Object.keys(te)[0],onChange:oe(Object.keys(te)[0]),selectedValues:null===(h=null===(m=null==_?void 0:_.barrierLayers)||void 0===m?void 0:m[Object.keys(te)[0]])||void 0===h?void 0:h.asMutable(),isMultiSelection:!0,autoHeight:!0,disableLayers:re})))),(0,e.jsx)(i.SettingSection,{role:"group","aria-label":E("searchSettings"),title:E("searchSettings"),className:"search-settings"},(0,e.jsx)(i.SearchDataSetting,{id:D,datasourceConfig:A,createOutputDs:!1,portalUrl:T,searchDataSettingType:i.SearchDataType.Both,onSettingChange:ne,autoSelectAllOrgGeocodeService:!0,hideIconSetting:!0,hideEnableFiltering:!0,showSearchInCurrentMapExtentSetting:!0,supportedDsTypes:[e.AllDataSourceTypes.FeatureLayer],hideDs:t=>"esriGeometryPoint"!==e.DataSourceManager.getInstance().getDataSource(t.id).getGeometryType()}),(0,e.jsx)(i.SearchGeneralSetting,{id:D,hint:null==z?void 0:z.hint,onGeneralSettingChange:(t,i)=>{var n;if("string"==typeof i&&i!==(null==z?void 0:z.hint)){const o=((null===(n=U.searchConfig)||void 0===n?void 0:n.generalConfig)||(0,e.Immutable)({})).setIn(t,i);R({id:D,config:U.setIn(["searchConfig","generalConfig"],o)})}}}),(0,e.jsx)(i.SearchSuggestionSetting,{id:D,settingConfig:Q,onSettingChange:t=>{e.lodash.isDeepEqual(t,Q)||R({id:D,config:U.setIn(["searchConfig","suggestionConfig"],t)})},hideRecentSearchSetting:!0})),(0,e.jsx)(i.SettingSection,{role:"group","aria-label":E("generalSettings"),title:E("generalSettings"),className:"general-settings"},(0,e.jsx)(i.SettingRow,{flow:"wrap",tag:"label",label:E("unitSystem")},(0,e.jsx)(t.Select,{value:null!==(C=null==U?void 0:U.unit)&&void 0!==C?C:j(),onChange:e=>{const t=e.target.value;R({id:D,config:U.set("unit",t)})}},(0,e.jsx)(t.Option,{value:f.Metric},E("unitsLabelMetric")),(0,e.jsx)(t.Option,{value:f.Imperial},E("unitsLabelImperial")))),(0,e.jsx)(i.SettingRow,{tag:"label",label:E("enableRouteSaving")},(0,e.jsx)(t.Switch,{checked:null===(I=null==U?void 0:U.enableRouteSaving)||void 0===I||I,onChange:e=>{const t=e.target.checked;R({id:D,config:U.set("enableRouteSaving",t)})}})),(0,e.jsx)(i.SettingRow,{tag:"label",label:E("showRoutesInLayerLists")},(0,e.jsx)(t.Switch,{checked:null===(O=null==U?void 0:U.showRuntimeLayers)||void 0===O||O,onChange:e=>{const t=e.target.checked;R({id:D,config:U.set("showRuntimeLayers",t)})}})))):(0,e.jsx)("div",{className:"d-flex justify-content-center align-items-center placeholder-container"},(0,e.jsx)("div",{className:"text-center"},(0,e.jsx)(l,{size:48,className:"d-inline-block placeholder-icon mb-2"}),(0,e.jsx)("p",{className:"placeholder-hint"},E("selectMapHint")))))},W=e.css`
.route-url-input{
  min-height: ${e.polished.rem(100)}
}
.example-url{
  font-size: ${e.polished.rem(12)};
  color: var(--ref-palette-neutral-1000);
}
.warning-icon{
  color: var(--sys-color-error-main);
}
.warning-hint{
  width: calc(100% - 20px);
  margin: 0 4px;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--sys-color-error-main);
}
.placeholder-container{
  height: calc(100% - 100px);
  .placeholder-hint{
    font-size: ${e.polished.rem(14)};
    font-weight: 500;
    color: var(--ref-palette-neutral-1000);
    max-width: ${e.polished.rem(160)};
  }
  .placeholder-icon{
    color: var(--ref-palette-neutral-800);
  }
}
.search-settings{
  >div>div {
    padding-left: 0 !important;
    padding-right: 0 !important;
    padding-top: 0 !important;
    border: 0 !important;
  }
}
`;function $(e,t){return[e].concat(t).filter((e=>!!e))}function q(e){return M.MapViewManager.getInstance().getJimuMapViewById(e).getMapDataSource().getLabel()}function Q(e){u.p=e}})(),c})())}}}));