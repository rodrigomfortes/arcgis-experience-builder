System.register(["jimu-core","jimu-theme","jimu-ui"],(function(t,e){var s={},o={},l={};return{setters:[function(t){s.React=t.React,s.SessionManager=t.SessionManager,s.UrlProtocol=t.UrlProtocol,s.css=t.css,s.esri=t.esri,s.jsx=t.jsx,s.portalUrlUtils=t.portalUrlUtils,s.urlUtils=t.urlUtils,s.utils=t.utils},function(t){o.styled=t.styled},function(t){l.Button=t.Button,l.ButtonGroup=t.ButtonGroup,l.Checkbox=t.Checkbox,l.Dropdown=t.Dropdown,l.DropdownButton=t.DropdownButton,l.DropdownItem=t.DropdownItem,l.DropdownMenu=t.DropdownMenu,l.FormFeedback=t.FormFeedback,l.FormGroup=t.FormGroup,l.InputGroup=t.InputGroup,l.Label=t.Label,l.TextInput=t.TextInput}],execute:function(){t((()=>{var t={244:t=>{"use strict";t.exports=s},321:t=>{"use strict";t.exports=l},348:function(t,e){var s,o,l;o=[e,t],s=function(t,e){"use strict";var s={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function o(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function l(t){try{delete window[t]}catch(e){window[t]=void 0}}function n(t){var e=document.getElementById(t);e&&document.getElementsByTagName("head")[0].removeChild(e)}function a(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=t,r=e.timeout||s.timeout,i=e.jsonpCallback||s.jsonpCallback,c=void 0;return new Promise((function(s,d){var u=e.jsonpCallbackFunction||o(),p=i+"_"+u;window[u]=function(t){s({ok:!0,json:function(){return Promise.resolve(t)}}),c&&clearTimeout(c),n(p),l(u)},a+=-1===a.indexOf("?")?"?":"&";var h=document.createElement("script");h.setAttribute("src",""+a+i+"="+u),e.charset&&h.setAttribute("charset",e.charset),e.nonce&&h.setAttribute("nonce",e.nonce),e.referrerPolicy&&h.setAttribute("referrerPolicy",e.referrerPolicy),e.crossorigin&&h.setAttribute("crossorigin","true"),h.id=p,document.getElementsByTagName("head")[0].appendChild(h),c=setTimeout((function(){d(new Error("JSONP request to "+t+" timed out")),l(u),n(p),window[u]=function(){l(u)}}),r),h.onerror=function(){d(new Error("JSONP request to "+t+" failed")),l(u),n(p),c&&clearTimeout(c)}}))}e.exports=a},void 0===(l="function"==typeof s?s.apply(e,o):s)||(t.exports=l)},888:t=>{"use strict";t.exports=o}},e={};function n(s){var o=e[s];if(void 0!==o)return o.exports;var l=e[s]={exports:{}};return t[s].call(l.exports,l,l.exports,n),l.exports}n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.p="";var a={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(a),n.d(a,{LoadStatus:()=>j,__set_webpack_public_path__:()=>k,default:()=>M});var t=n(244),e=n(321);const s="Sign in",o="Portal URL",l="Client ID",r="Specify the URL to your ArcGIS Online organization or ArcGIS Enterprise",i="Provide the Client ID for Experience Builder registered in the organization you specify above",c="Please enter the full URL of your ArcGIS Online organization or ArcGIS Enterprise, for example,",d="Unable to access",u="Your application domain is not allowed via Cross-Origin Resource Sharing (CORS) to access",p="A server with the specified hostname could not be found.",h="Restrict to Enterprise resources only";var f,g=n(348);!function(t){t.InvalidPortalUrl="InvalidPortalUrl",t.UnableToCorsAccess="UnableToCorsAccess",t.UnableToAccess="UnableToAccess"}(f||(f={}));class m{constructor(){this.validPortalInfos=[]}getDefaultProtalInfo(t){return{isValid:!1,invalidMessage:"",isWebTier:!1,supportsOAuth:!0,tokenInfo:{token:null,expires:null,ssl:!1,server:"",userId:""},url:this.getStandardPortalUrl(t),clientId:void 0}}getValidPortalInfo(e){let s=null;return this.validPortalInfos.some((o=>!!t.portalUrlUtils.isSamePortalUrl(e,o.url)&&(s=o,!0))),s}getStandardPortalUrl(e){if(!e)return"";const s=0===e.toLowerCase().indexOf("http://"),o=0===e.toLowerCase().indexOf("https://");return s||o||(e=t.urlUtils.setProtocol(e,t.UrlProtocol.Https)),e=t.portalUrlUtils.getStandardPortalUrl(e),e=t.urlUtils.setProtocol(e,t.UrlProtocol.Https)}validatePortalUrl(t){const e=this.getDefaultProtalInfo(t);return/www\.arcgis\.com/gi.test(t)?(e.isValid=!1,e.invalidMessage=f.InvalidPortalUrl):e.isValid=!0,e}fetcher(t,e){return fetch(t,e)}generateToken(e){const s=t.urlUtils.setProtocol(`${t.portalUrlUtils.getPortalRestUrl(e)}/generateToken?f=json`,t.UrlProtocol.Https);return this.fetcher(s,{cache:"no-cache",credentials:"include"}).then((t=>t.json())).then((t=>t),(t=>null))}getPortalSelfInfo(e){const s=t.urlUtils.setProtocol(`${t.portalUrlUtils.getPortalRestUrl(e)}/portals/self?f=json`,t.UrlProtocol.Https);return this.fetcher(s,{cache:"no-cache",credentials:"include"}).then((t=>t.json())).then((t=>t)).catch((t=>g(s,{jsonpCallback:"callback",timeout:3e3}).then((t=>({invalidPortalSelf:!0,invalidMessage:f.UnableToCorsAccess}))).catch((t=>({invalidPortalSelf:!0,invalidMessage:f.UnableToAccess})))))}getPortalInfo(e){const s=this.getDefaultProtalInfo(e);return this.getPortalSelfInfo(e).then((t=>{if(t&&!t.invalidPortalSelf&&(t.isPortal||t.urlKey))return s.isValid=!0,s.supportsOAuth=t.supportsOAuth,s.tokenInfo.userId=t.user?t.user.username:"",this.validPortalInfos.push(s),this.generateToken(e);s.isValid=!1,s.invalidMessage=(null==t?void 0:t.invalidMessage)||f.UnableToAccess})).then((o=>(o&&o.token&&(s.tokenInfo.token=o.token,s.tokenInfo.expires=o.expires,s.tokenInfo.ssl=o.ssl,s.tokenInfo.server=t.portalUrlUtils.getPortalRestUrl(e),s.isWebTier=!0,s.supportsOAuth=!1),s)))}validatePortal(t){if(!t)return Promise.reject(new Error("Portal URL is empty."));let e;const s=this.getStandardPortalUrl(t);let o=this.getValidPortalInfo(s);return o?e=Promise.resolve(o):(o=this.validatePortalUrl(s),e=o.isValid?this.getPortalInfo(s):Promise.resolve(o)),e}}var I=n(888);const{useEffect:P,useState:v,Fragment:U}=t.React,x=s=>{const{intl:o,selectedPortalInfo:l}=s,[n,a]=v(!1),[r,i]=v(!1);P((()=>{const t=!d(l.url)&&l.isValid;i(t)}),[l]),P((()=>{c(!1)}),[r]);const c=e=>{t.utils.setLocalStorage("restrictEnterpriseOnly",`${e}`),a(e)},d=e=>!e||t.portalUrlUtils.isAGOLDomain(e);return(0,t.jsx)(U,null,r&&(0,t.jsx)("div",{className:"mt-3"},(0,t.jsx)(e.Label,{className:"d-flex align-item-center"},(0,t.jsx)(e.Checkbox,{onChange:()=>{c(!n)},checked:n,className:"mr-2"}),(0,t.jsx)("div",null,o.formatMessage({id:"restrictEnterpriseOnly",defaultMessage:h})))))};var j,w=function(t,e,s,o){return new(s||(s=Promise))((function(l,n){function a(t){try{i(o.next(t))}catch(t){n(t)}}function r(t){try{i(o.throw(t))}catch(t){n(t)}}function i(t){var e;t.done?l(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}i((o=o.apply(t,e||[])).next())}))};!function(t){t.Pending="Pending",t.Fulfilled="Fulfilled",t.Rejected="Rejected"}(j||(j={}));const b="https://myorg.maps.arcgis.com",S="https://myportal.company.com/arcgis";class y extends t.React.PureComponent{constructor(e){super(e),this.onPortalUrlInputChange=t=>{var e,s;const o=this.portalValidator.getDefaultProtalInfo(null===(e=null==t?void 0:t.target)||void 0===e?void 0:e.value);o.url=null===(s=null==t?void 0:t.target)||void 0===s?void 0:s.value,this.setState({selectedPortalInfo:o})},this.onClientIdInputChange=t=>{var e;this.setState({selectedPortalInfo:Object.assign(Object.assign({},this.state.selectedPortalInfo),{clientId:null===(e=null==t?void 0:t.target)||void 0===e?void 0:e.value})})},this.checkPortalUrlOnAccept=t=>w(this,void 0,void 0,(function*(){try{let e;return t?(this.setState({loadStatus:j.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(t),showUrlList:!1}),e=yield this.portalValidator.validatePortal(t)):e=this.portalValidator.getDefaultProtalInfo(),this.setState({selectedPortalInfo:e,loadStatus:j.Fulfilled}),!e||e.invalidMessage?{valid:!1}:{valid:!0}}catch(t){return this.setState({loadStatus:j.Rejected}),{valid:!1}}})),this.onSignInBtnClick=()=>{if(!this.state.selectedPortalInfo.isValid)return;const t={portalUrl:this.state.selectedPortalInfo.url,clientId:this.clientIdInput.current.value,supportsOAuth:this.state.selectedPortalInfo.supportsOAuth,isWebTier:this.state.selectedPortalInfo.isWebTier};this.addSigninInfo(t).then((()=>{this.signIn(t)}))},this.onUrlListBtnClick=()=>{this.setState({showUrlList:!this.state.showUrlList})},this.onUrlListItemClick=t=>{this.selectPortalUrl(t)},this.portalValidator=new m,this.state={signinInfos:[],showUrlList:!1,loadStatus:j.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo()},this.urlInput=t.React.createRef(),this.clientIdInput=t.React.createRef()}componentDidMount(){this.fetchSigninInfo()}getDefaultPortalUrl(e){const s=window.jimuConfig.hostEnv||"dev",o=`${t.urlUtils.getFixedRootPath()}builder/setting.json`;return window.fetch(o).then((t=>t.json())).then((t=>{const o=(window.jimuConfig.isDevEdition?t.devEnv:t.env)[s];return o&&o.portalUrl||e[0]&&e[0].portalUrl||""}))}fetchSigninInfo(){const t=`${window.location.origin}${window.jimuConfig.mountPath}signininfo`;return window.fetch(t,{cache:"no-cache"}).then((t=>t.json())).then((t=>(this.setState({signinInfos:t}),this.getDefaultPortalUrl(t).then((t=>{this.selectPortalUrl(t)})),t))).catch((t=>(console.error(t),t)))}addSigninInfo(t){const e=`${window.location.origin}${window.jimuConfig.mountPath}signinInfo`;return window.fetch(e,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then((t=>t.json())).catch((t=>{console.error(t)}))}getSigninInfo(e){let s=null;return this.state.signinInfos.some((o=>!!t.portalUrlUtils.isSamePortalUrl(o.portalUrl,e)&&(s=o,!0))),s}OAuthSignIn(e){const s=e.portalUrl+"/sharing/rest/";t.SessionManager.getInstance().signIn({desUrl:s,clientId:e.clientId,popup:!1})}webTierSignIn(){const e=this.state.selectedPortalInfo.tokenInfo,s=t.esri.restRequest.ArcGISIdentityManager.fromCredential(e,{hasPortal:!1,hasServer:!1,server:""});t.SessionManager.getInstance().writeAuthInfo(s),window.location.href="/"}signIn(t){t.supportsOAuth?this.OAuthSignIn(t):this.state.selectedPortalInfo.isWebTier&&this.webTierSignIn()}validatePortal(t){return this.portalValidator.validatePortal(t)}selectPortalUrl(t,e){t?(this.setState({loadStatus:j.Pending,selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(t),showUrlList:!1}),this.validatePortal(t).then((t=>{this.setState(Object.assign({selectedPortalInfo:t,loadStatus:j.Fulfilled},e))})).catch((()=>{this.setState({loadStatus:j.Rejected})}))):this.setState({selectedPortalInfo:this.portalValidator.getDefaultProtalInfo(),loadStatus:j.Fulfilled})}render(){const n=(0,I.styled)(e.Button)`
      display: block;
      margin: 0 auto;
    `,a=this.state.signinInfos.map(((s,o)=>(0,t.jsx)(e.DropdownItem,{key:o,active:!!t.portalUrlUtils.isSamePortalUrl(s.portalUrl,this.state.selectedPortalInfo.url),onClick:()=>{this.onUrlListItemClick(s.portalUrl)}},s.portalUrl))),h=this.getSigninInfo(this.state.selectedPortalInfo.url);let g,m,P;if(g=void 0!==this.state.selectedPortalInfo.clientId?this.state.selectedPortalInfo.clientId:h&&h.clientId||"",this.state.selectedPortalInfo.url||this.state.loadStatus===j.Pending||(m=(0,t.jsx)("div",null,(0,t.jsx)("div",null,b),(0,t.jsx)("div",null,S))),this.state.selectedPortalInfo&&this.state.selectedPortalInfo.invalidMessage&&this.state.loadStatus!==j.Pending)if(this.state.selectedPortalInfo.invalidMessage===f.InvalidPortalUrl)P=(0,t.jsx)("div",null,(0,t.jsx)("div",null,this.props.intl.formatMessage({id:"invalidPortalUrlMessage",defaultMessage:c})),(0,t.jsx)("div",{className:"sample-url"},b),(0,t.jsx)("div",{className:"sample-url"},S));else if(this.state.selectedPortalInfo.invalidMessage===f.UnableToCorsAccess){const e=this.props.intl.formatMessage({id:"unableToCorsAccessMessage",defaultMessage:u});P=(0,t.jsx)("div",null,(0,t.jsx)("div",null,`${e} ${this.state.selectedPortalInfo.url}`))}else{const e=this.props.intl.formatMessage({id:"unableToAccessMessage",defaultMessage:d}),s=this.props.intl.formatMessage({id:"invalidHostNameMessage",defaultMessage:p});P=(0,t.jsx)("div",null,(0,t.jsx)("div",null,`${e} ${this.state.selectedPortalInfo.url}`),(0,t.jsx)("div",null,s))}const v=this.state.selectedPortalInfo&&this.state.selectedPortalInfo.supportsOAuth?"displayed":"hidden";let U="hidden",w=!1;this.state.loadStatus===j.Pending&&(w=!0,U="displayed");const y=!this.state.selectedPortalInfo.isValid;return(0,t.jsx)("div",{css:(M=this.props.theme,this.props.isRTL,t.css`
    max-width: 700px;
    margin: 0 auto;
    .portal-url-input{
      margin-right: 1px;
    }
    .portal-clientId.hidden{
      display: none;
    }
    .portal-clientId .jimu-input {
      input:-webkit-autofill,
      input:-webkit-autofill:focus {
        transition: background-color 0s 600000s, color 0s 600000s !important;
      }
    }
    .loading-panel {
      position: absolute;
      width: 15px;
      background-color: ${M.ref.palette.neutral[200]};

      .jimu-secondary-loading {
        left: 2px;
        top: 12px;
      }

      .jimu-secondary-loading, .jimu-secondary-loading:before, .jimu-secondary-loading:after {
        width: 2px;
        height: 5px;
        left: -27px;
      }
      .jimu-secondary-loading:before {
        left: -5px;
      }
      .jimu-secondary-loading:after {
        left: 5px;
      }
    }

    .loading-panel.hidden {
      display: none;
    }

    .dropdown-menu {
      width: 700px;
    }

    .description, .message {
      color: ${M.ref.palette.neutral[1e3]};
      width: auto;
    }

    .invalid-message {
      .sample-url {
        color: ${M.ref.palette.primary[600]};
      }
    }
    .loading-con {
      margin-left: -1px;
    }
  `),className:"widget-set-portalurl"},(0,t.jsx)("div",{className:"mt-6 mb-2"},(0,t.jsx)(e.Label,{id:"portalUrlLabel",className:"description"}," ",this.props.intl.formatMessage({id:"portalUrlDescription",defaultMessage:r})," "),(0,t.jsx)(e.ButtonGroup,{className:"w-100"},(0,t.jsx)(e.InputGroup,null,(0,t.jsx)(e.TextInput,{"aria-describedby":"portalUrlMessage1 portalUrlMessage2","aria-labelledby":"portalUrlLabel",className:"portal-url-input",disabled:w,size:"lg",placeholder:this.props.intl.formatMessage({id:"portalUrl",defaultMessage:o}),min:0,max:100,type:"text",checkValidityOnAccept:this.checkPortalUrlOnAccept,value:this.state.selectedPortalInfo.url||"",onChange:this.onPortalUrlInputChange,ref:this.urlInput}),(0,t.jsx)("div",{className:"d-flex loading-con"},(0,t.jsx)("div",{className:`loading-panel ${U}`},(0,t.jsx)("div",{className:"jimu-secondary-loading"})))),(0,t.jsx)(e.Dropdown,{activeIcon:!0,className:"dropdown",isOpen:this.state.showUrlList,toggle:this.onUrlListBtnClick},(0,t.jsx)(e.DropdownButton,{style:{width:"auto"},icon:!0}),(0,t.jsx)(e.DropdownMenu,{className:"dropdown-menu",zIndex:55,style:{width:"700px"},alignment:"end"},a)))),(0,t.jsx)(e.FormFeedback,{id:"portalUrlMessage1",className:"message mx-2",valid:!0}," ",m," "),(0,t.jsx)(e.FormFeedback,{id:"portalUrlMessage2",className:"message invalid-message mx-2",valid:!0}," ",P," "),(0,t.jsx)(e.FormGroup,{className:`portal-clientId mt-6 ${v}`},(0,t.jsx)(e.Label,{className:"description",for:"clientIdText"}," ",this.props.intl.formatMessage({id:"clientIdDescription",defaultMessage:i})," "),(0,t.jsx)(e.TextInput,{disabled:w,size:"lg",type:"password",name:"text",id:"clientIdText",placeholder:this.props.intl.formatMessage({id:"clientId",defaultMessage:l}),value:g,ref:this.clientIdInput,onChange:this.onClientIdInputChange})),(0,t.jsx)(x,{selectedPortalInfo:this.state.selectedPortalInfo,intl:this.props.intl}),(0,t.jsx)(n,{disabled:w||y,size:"lg",onClick:()=>{this.onSignInBtnClick()}},this.props.intl.formatMessage({id:"portalUrlSignIn",defaultMessage:s})));var M}}y.mapExtraStateProps=t=>({isRTL:t.appContext.isRTL});const M=y;function k(t){n.p=t}})(),a})())}}}));