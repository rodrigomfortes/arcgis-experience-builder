var StatusMessage,__awaiter=this&&this.__awaiter||function(t,o,a,u){return new(a=a||Promise)(function(n,e){function i(t){try{r(u.next(t))}catch(t){e(t)}}function s(t){try{r(u.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(i,s)}r((u=u.apply(t,o||[])).next())})},__generator=this&&this.__generator||function(i,s){var r,o,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=t(0),c.throw=t(1),c.return=t(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function t(n){return function(t){var e=[n,t];if(r)throw new TypeError("Generator is already executing.");for(;u=c&&e[c=0]?0:u;)try{if(r=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(a=0<(a=u.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3]))u.label=e[1];else if(6===e[0]&&u.label<a[1])u.label=a[1],a=e;else{if(!(a&&u.label<a[2])){a[2]&&u.ops.pop(),u.trys.pop();continue}u.label=a[2],u.ops.push(e)}}e=s.call(i,u)}catch(t){e=[6,t],o=0}finally{r=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},path=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDownloadStatus=getDownloadStatus,exports.DownloadAppZip=DownloadAppZip,exports.download=download,exports.zipApp=zipApp,require("path")),fs=require("fs-extra"),AdmZip=require("adm-zip"),child_process_1=require("child_process"),uuid_1=require("uuid"),i18n_utils_1=(require("../../../global"),require("../i18n-utils")),utils_1=require("../../utils"),utils_2=require("./utils"),lodash=(require("isomorphic-form-data"),require("lodash")),downloadTimes=((t=>{t.Start="Start",t.CopyingCode="Copying code",t.CompilingWidget="Compiling the custom widgets",t.GeneratingZip="Generating a zip file",t.Fail="Fail",t.Completed="completed"})(StatusMessage=StatusMessage||{}),0),prodDistFolder="dist-download",isReleasePackage=fs.existsSync(path.join(utils_2.CLIENT_PATH,utils_2.DIST_FOLDER,"widgets/widgets-info-existed.json"));function getDownloadStatus(i,t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(t){switch(t.label){case 0:return e=i.params.appId,n=i.query.uuid,[4,getDownloadStatusByAppId(e,n)];case 1:return e=t.sent(),n=downloadTimes,"001"!==e.code&&null!=e&&e.code||(n=null),i.body={status:e,cdnNumber:n},[2]}})})}function getDownloadStatusByAppId(i,s){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(t){return null!=(e=getPathOfDownloadStatus(i,s))&&e.startsWith(utils_2.SERVER_PATH)?(n={},fs.existsSync(e)&&(n=JSON.parse(fs.readFileSync(e,"utf8"))||{}),[2,Promise.resolve(n)]):[2]})})}function DownloadAppZip(u,t){return __awaiter(this,void 0,void 0,function(){var e,n,i,s,r,o,a;return __generator(this,function(t){switch(t.label){case 0:return[4,(0,utils_1.checkToken)(u.query.token)];case 1:return(e=t.sent(),n=u.params.appId,i=u.query.uuid,null!=(s=path.join(utils_2.SERVER_PATH,"temp"))&&s.startsWith(utils_2.SERVER_PATH))?(r=path.join(s,"".concat(n,"-").concat(i,".zip")),null!=s&&s.startsWith(s)?[4,getDownloadStatusByAppId(n,i)]:[2]):[2];case 2:return o=t.sent(),removeDownloadStatus(n,i),e?"006"===o.code?u.body="The app has not been packaged yet.":null!=r&&r.startsWith(s)&&(fs.existsSync(r)?(a=new AdmZip(r),u.response.set("Content-disposition","attachment; filename="+(o.fileName||n)+".zip"),u.body=a.toBuffer(),removeTemporaryAppInTempFolder(n,i)):u.body="No app zip."):u.body="Please log in.",[2]}})})}function download(r,o){return __awaiter(this,void 0,void 0,function(){var e,n,i,s;return __generator(this,function(t){switch(t.label){case 0:return[4,(0,utils_1.checkToken)(r.query.token)];case 1:if(!t.sent())return r.body="Please log in.",[2];e=r.params.appId,n=r.query.clientId,s=r.query.locale?null==(s=r.query.locale)?void 0:s.split(","):[],i=(0,uuid_1.v1)(),removeDownloadStatus(e,i),setDownloadStatus(e,"001",i);try{r.body={uuid:i,message:"Create zip for app..."},createZipForApp(e,n,i,{locales:s})}catch(t){console.error(t)}return[4,o()];case 2:return t.sent(),[2]}})})}function zipApp(t,e,n){return __awaiter(this,arguments,void 0,function(e,n,i,s){var r,o,a;return void 0===s&&(s={}),__generator(this,function(t){switch(t.label){case 0:if(fs.existsSync(n))throw Error("".concat(n," exists, please use a new name."));return s.locales||(s.locales=[]),r=(0,uuid_1.v1)(),[4,createZipForApp(e,i,r,s)];case 1:if(a=t.sent(),o=a.message,a=a.zip,o)throw Error(o);if(a)return a.writeZip(n,function(t){if(removeTemporaryAppInTempFolder(e,r),t)throw t;console.log("Done.")}),[2];throw Error("Failed to create zip file.")}})})}function createZipForApp(E,v,w,T){return __awaiter(this,void 0,void 0,function(){var e,n,i,s,r,o,a,u,c,l,p,f,h,d,_,g,j,y,m,S;return __generator(this,function(t){switch(t.label){case 0:return(e=path.join(utils_2.SERVER_PATH,"temp"),n=path.join(utils_2.SERVER_PATH,"public/apps",E),i=path.join(e,"".concat(E,"-").concat(w)),null!=e&&e.startsWith(utils_2.SERVER_PATH)&&null!=n&&n.startsWith(utils_2.SERVER_PATH)&&null!=i&&i.startsWith(utils_2.SERVER_PATH))?(s=T.locales.map(function(t){return t.toLowerCase()}),fs.existsSync(n)?(a=(o=JSON).parse,[4,fs.readFile(path.join(n,"config.json"),"utf-8")]):[2,(0,i18n_utils_1.getMessage)("notFound",s[0]||"en").then(function(t){return setDownloadStatus(E,"006",w,t),{message:t,fileName:null,zip:null}})]):[2];case 1:return r=a.apply(o,[t.sent()]),T.configModifier&&(r=modifyAppConfig(r,T)),l=(c=JSON).parse,[4,fs.readFile(path.join(n,"info.json"),"utf-8")];case 2:return(u=l.apply(c,[t.sent()]),null!=(p=path.join(n,"download-times.json"))&&p.startsWith(utils_2.SERVER_PATH))?fs.existsSync(p)?(h=parseInt,[4,fs.readFile(p,"utf-8")]):[3,4]:[2];case 3:return f=h.apply(void 0,[t.sent()]),[3,5];case 4:f=0,t.label=5;case 5:return downloadTimes=f,d=++downloadTimes,fs.writeFileSync(p,d+"","utf-8"),!0===r.__not_publish?[2,(0,i18n_utils_1.getMessage)("notPublished",s[0]||"en").then(function(t){return setDownloadStatus(E,"006",w,t),{message:t,fileName:null,zip:null}})]:[4,fs.pathExists(i)];case 6:return t.sent()?[4,fs.remove(i)]:[3,8];case 7:t.sent(),t.label=8;case 8:return[4,fs.ensureDir(i)];case 9:return t.sent(),setDownloadStatus(E,"002",w),[4,compileWidgets(r)];case 10:return t.sent(),setDownloadStatus(E,"003",w),[4,copyAppCode(i,r,u.title,s,d)];case 11:return t.sent(),g=(_=JSON).parse,[4,fs.readFile((0,utils_1.getBuilderSettingFilePath)(),"utf-8")];case 12:return(S=g.apply(_,[t.sent()]),null!=(S=S.devEnv[global.hostEnv])&&S.isWebTier?r.attributes.isWebTier=!0:r.attributes.isWebTier=!1,r.attributes.clientId=v||"",S=u.typeKeywords.includes(utils_2.TYPE_KEYWORDS_OF_EXPRESS_APP),r.attributes.express=S,r.attributes.title=u.title,r.attributes.description=u.snippet,r.attributes.type=u.type,r.attributes.thumbnail=(null==u?void 0:u.thumbnail)||null,null!=(S=path.join(i,getCDNString(d)))&&S.startsWith(utils_2.SERVER_PATH))?[4,fs.writeFile(path.join(S,"config.json"),JSON.stringify(r,null,2),"utf-8")]:[2];case 13:return t.sent(),[4,fs.copy(path.join(n,"resources"),path.join(S,"resources"))];case 14:return(t.sent(),fs.existsSync(path.join(n,"thumbnail")))?[4,fs.copy(path.join(n,"thumbnail"),path.join(S,"thumbnail"))]:[3,16];case 15:t.sent(),t.label=16;case 16:return(setDownloadStatus(E,"004",w),(j=new AdmZip).addLocalFolder(i),y=encodeURI(u.title),null!=(m=path.join(e,"".concat(E,"-").concat(w,".zip")))&&m.startsWith(utils_2.SERVER_PATH))?fs.existsSync(m)?[4,fs.remove(m)]:[3,18]:[2];case 17:t.sent(),t.label=18;case 18:return fs.writeFile(m,j.toBuffer()),setDownloadStatus(E,"005",w,null,y),[2,Promise.resolve({message:null,fileName:y,zip:j})]}})})}function modifyAppConfig(e,n){if("function"==typeof n.configModifier)try{e=n.configModifier(e)}catch(t){console.error("Modify app config error.",t)}else Object.keys(n.configModifier).forEach(function(t){void 0===lodash.get(e,t)?console.error("The ".concat(t," is not found in the app config.")):lodash.set(e,t,n.configModifier[t])});return e}function copyAppCode(s,a,u,c,l){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,o=this;return __generator(this,function(t){switch(t.label){case 0:return null!=s&&s.startsWith(utils_2.SERVER_PATH)?(e=path.join(utils_2.CLIENT_PATH,utils_2.DIST_FOLDER),n=path.join(utils_2.CLIENT_PATH,prodDistFolder),[4,fs.copy(path.join(e,"experience/index.html"),path.join(s,"index.html"))]):[2];case 1:return t.sent(),[4,fs.copy(path.join(e,"experience/web.config"),path.join(s,"web.config"))];case 2:return t.sent(),[4,fixIndexFile(path.join(s,"index.html"),u,l,c)];case 3:return(t.sent(),"production"===process.env.NODE_ENV&&fs.existsSync(path.join(e,"service-worker.prod.js")))?[4,fs.copy(path.join(e,"service-worker.prod.js"),path.join(s,"service-worker.js"))]:[3,5];case 4:return t.sent(),[3,7];case 5:return[4,fs.copy(path.join(e,"service-worker.js"),path.join(s,"service-worker.js"))];case 6:t.sent(),t.label=7;case 7:return null!=(r=path.join(s,getCDNString(l)))&&r.startsWith(utils_2.SERVER_PATH)?[4,fs.copy(path.join(e,"experience/index.js"),path.join(r,"index.js"))]:[2];case 8:return t.sent(),[4,fs.copy(path.join(e,"experience/assets"),path.join(r,"assets"))];case 9:return t.sent(),[4,fs.copy(path.join(e,"service-worker-registration.js"),path.join(r,"service-worker-registration.js"))];case 10:return t.sent(),[4,fixServiceWorkerFile(path.join(r,"service-worker-registration.js"))];case 11:return t.sent(),[4,copyJimuFolder(r,c)];case 12:return t.sent(),[4,copyComponents(r)];case 13:return t.sent(),[4,fs.copy(path.join(e,a.theme),path.join(r,a.theme))];case 14:return t.sent(),i=(0,utils_2.getWidgetsUriFromAppConfig)(a),[4,copyWidgets(e,r,n,i,c)];case 15:return(t.sent(),"production"===process.env.NODE_ENV&&fs.existsSync(path.join(n,utils_2.WIDGET_INFO_PATH)))?[4,fs.copy(path.join(n,utils_2.WIDGET_INFO_PATH),path.join(r,utils_2.WIDGET_INFO_PATH))]:[3,17];case 16:return t.sent(),[3,19];case 17:return fs.existsSync(path.join(e,utils_2.WIDGET_INFO_PATH))?[4,fs.copy(path.join(e,utils_2.WIDGET_INFO_PATH),path.join(r,utils_2.WIDGET_INFO_PATH))]:[3,19];case 18:t.sent(),t.label=19;case 19:return"production"===process.env.NODE_ENV&&fs.existsSync(path.join(n,utils_2.WIDGET_CHUNKS_PATH))?[4,fs.copy(path.join(n,utils_2.WIDGET_CHUNKS_PATH),path.join(r,utils_2.WIDGET_CHUNKS_PATH))]:[3,21];case 20:return t.sent(),[3,23];case 21:return fs.existsSync(path.join(e,utils_2.WIDGET_CHUNKS_PATH))?[4,fs.copy(path.join(e,utils_2.WIDGET_CHUNKS_PATH),path.join(r,utils_2.WIDGET_CHUNKS_PATH))]:[3,23];case 22:t.sent(),t.label=23;case 23:return fs.existsSync(path.join(e,utils_2.WIDGET_SHARED_CODE_PATH))?[4,fs.copy(path.join(e,utils_2.WIDGET_SHARED_CODE_PATH),path.join(r,utils_2.WIDGET_SHARED_CODE_PATH))]:[3,25];case 24:t.sent(),t.label=25;case 25:return"production"===process.env.NODE_ENV&&fs.existsSync(path.join(n,utils_2.WIDGET_SHARED_CODE_PATH))?[4,fs.copy(path.join(n,utils_2.WIDGET_SHARED_CODE_PATH),path.join(r,utils_2.WIDGET_SHARED_CODE_PATH))]:[3,27];case 26:t.sent(),t.label=27;case 27:return[4,Promise.all(i.coreWidgetsUri.concat(i.customWidgetsUri).map(function(s){return __awaiter(o,void 0,void 0,function(){var e,n,i;return __generator(this,function(t){return e=path.join(r,s,"src"),n=path.join(r,s,"tests"),i=[],fs.existsSync(e)&&i.push(fs.remove(e)),fs.existsSync(n)&&i.push(fs.remove(n)),[2,Promise.all(i)]})})}))];case 28:return t.sent(),[2]}})})}function compileWidgets(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return"production"!==process.env.NODE_ENV||!isReleasePackage||0===(0,utils_2.getWidgetsUriFromAppConfig)(e).customWidgetsUri.length?[2,Promise.resolve()]:((0,child_process_1.execSync)("npm run build:for-download",{cwd:utils_2.CLIENT_PATH}),[2])})})}function fixIndexFile(n,i,s,r){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return null!=n&&n.startsWith(utils_2.SERVER_PATH)?[4,fs.readFile(n,"utf-8")]:[2];case 1:return e=(e=t.sent()).replace(/<base.*\/>/,'<base href="./'.concat(getCDNString(s),'/"/>')).replace('"isOutOfExb": false','"isOutOfExb": true').replace('"isDevEdition": false','"isDevEdition": true').replace('"useStructuralUrl": true','"useStructuralUrl": false').replace(/"buildNumber": ".*"/,'"buildNumber": "'.concat(s,'"')).replace('"appFolderName": "experience"','"appFolderName": "."').replace('<script src="../jimu-core/init.js"><\/script>','<script src="./jimu-core/init.js"><\/script>').replace("<title>Experience</title>","<title>".concat(i,"</title>")).replace('"downloadLocales": null','"downloadLocales": ["'.concat(r.join('","'),'"]')),[4,fs.writeFile(n,e,"utf-8")];case 2:return t.sent(),[2]}})})}function fixServiceWorkerFile(n){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return null!=n&&n.startsWith(utils_2.SERVER_PATH)?[4,fs.readFile(n,"utf-8")]:[2];case 1:return e=(e=t.sent()).replace("register(window.jimuConfig.mountPath + 'service-worker.js')","register('../../service-worker.js')"),[4,fs.writeFile(n,e,"utf-8")];case 2:return t.sent(),[2]}})})}function getCDNString(t){return"cdn/".concat(t)}function translationsFolderFilter(t,e,n){return 0===n.length||!t.includes("translations")||!fs.existsSync(path.join(t,"default.ts"))}function copyJimuFolder(r,o){return __awaiter(this,void 0,void 0,function(){var n,e,i,s=this;return __generator(this,function(t){switch(t.label){case 0:return(n=path.join(utils_2.CLIENT_PATH,utils_2.DIST_FOLDER),null!=r&&r.startsWith(utils_2.SERVER_PATH))?(i=(e=["jimu-core","jimu-ui","jimu-layouts","jimu-arcgis","jimu-theme","jimu-for-builder","jimu-data-source"]).map(function(e){return __awaiter(s,void 0,void 0,function(){return __generator(this,function(t){return[2,fs.copy(path.join(n,e),path.join(r,e),{filter:function(t,e){return translationsFolderFilter(t,e,o)}})]})})}),[4,Promise.all(i)]):[2];case 1:return(t.sent(),0<o.length)?[4,copyJimuTranslations(r,o,e)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function copyJimuTranslations(s,r,e){return __awaiter(this,void 0,void 0,function(){var n,i;return __generator(this,function(t){return n=path.join(utils_2.CLIENT_PATH,utils_2.DIST_FOLDER),i=[],r&&null!=s&&s.startsWith(utils_2.SERVER_PATH)&&(e.forEach(function(e){var t="".concat(e,"/lib/translations/default.ts");fs.existsSync(path.join(n,t))&&i.push(fs.copy(path.join(n,t),path.join(s,t))),r.forEach(function(t){t="".concat(e,"/lib/translations/").concat(t,".js");fs.existsSync(path.join(n,t))&&i.push(fs.copy(path.join(n,t),path.join(s,t)))})}),Promise.all(i)),[2]})})}function copyComponents(n){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return e=path.join(utils_2.CLIENT_PATH,utils_2.DIST_FOLDER),null!=n&&n.startsWith(utils_2.SERVER_PATH)&&(fs.copy(path.join(e,"calcite-components"),path.join(n,"calcite-components")),fs.copy(path.join(e,"arcgis-map-components"),path.join(n,"arcgis-map-components")),fs.copy(path.join(e,"arcgis-charts-components"),path.join(n,"arcgis-charts-components")),fs.copy(path.join(e,"arcgis-coding-components"),path.join(n,"arcgis-coding-components"))),[2]})})}function copyWidgets(i,s,r,e,o){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(t){switch(t.label){case 0:return n=[],e.coreWidgetsUri.forEach(function(t){n=n.concat(copyWidget(i,s,o,t))}),e.customWidgetsUri.forEach(function(t){var e="production"===process.env.NODE_ENV&&isReleasePackage?r:i;n=n.concat(copyWidget(e,s,o,t))}),[4,Promise.all(n)];case 1:return t.sent(),[2]}})})}function copyWidget(i,s,r,o){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(t){switch(t.label){case 0:return(e=[],null!=s&&s.startsWith(utils_2.SERVER_PATH))?fs.existsSync(path.join(i,o,"download-files-filter.js"))?(n=require(path.join(i,o,"download-files-filter.js")).default,e.push(fs.copy(path.join(i,o),path.join(s,o),{filter:function(t,e){return n(t,e,r)},overwrite:!0})),[2,e]):(e.push(fs.copy(path.join(i,o),path.join(s,o),{filter:function(t,e){return translationsFolderFilter(t,e,r)},overwrite:!0})),[4,Promise.all(e)]):[2];case 1:return t.sent(),0<r.length&&e.push(copyWidgetTranslations(i,s,r,o)),[2,e]}})})}function copyWidgetTranslations(n,i,t,s){var e,r,o=[];if(null!=i&&i.startsWith(utils_2.SERVER_PATH))return e="dist/runtime/translations/default.ts",fs.existsSync(path.join(n,s,r="dist/setting/translations/default.ts"))&&o.push(fs.copy(path.join(n,s,r),path.join(i,s,r),{overwrite:!0})),fs.existsSync(path.join(n,s,e))&&o.push(fs.copy(path.join(n,s,e),path.join(i,s,e),{overwrite:!0})),t.forEach(function(t){var e="dist/runtime/translations/".concat(t,".js"),t="dist/setting/translations/".concat(t,".js");fs.existsSync(path.join(n,s,e))&&o.push(fs.copy(path.join(n,s,e),path.join(i,s,e),{overwrite:!0})),fs.existsSync(path.join(n,s,t))&&o.push(fs.copy(path.join(n,s,t),path.join(i,s,t),{overwrite:!0}))}),o}function setDownloadStatus(r,o,a,u,c){return __awaiter(this,void 0,void 0,function(){var e,n,i,s;return __generator(this,function(t){switch(t.label){case 0:if(!r||!o)return[2];switch(o){case"001":e=StatusMessage.Start;break;case"002":e=StatusMessage.CopyingCode;break;case"003":e=StatusMessage.CompilingWidget;break;case"004":e=StatusMessage.GeneratingZip;break;case"005":e=StatusMessage.Completed;break;case"006":e=StatusMessage.Fail}return[4,getDownloadStatusByAppId(r,a)];case 1:return i=t.sent(),n=null==i?void 0:i.hasCustomWidget,i.hasOwnProperty("hasCustomWidget")?[3,3]:[4,checkIsHasCustomWidgets(r)];case 2:n=t.sent(),t.label=3;case 3:return(i={message:e,code:o},u&&(i.error=u),c&&(i.fileName=c),i.hasCustomWidget=n,null!=(s=getPathOfDownloadStatus(r,i.uuid=a))&&s.startsWith(utils_2.SERVER_PATH))?(fs.writeFileSync(s,JSON.stringify(i,null,2)),[2,i]):[2]}})})}function getPathOfDownloadStatus(t,e){var n=path.join(utils_2.SERVER_PATH,"temp");if(null!=n&&n.startsWith(utils_2.SERVER_PATH))return fs.ensureDirSync(n),t="download-status-".concat(t,"-").concat(e),path.join(n,t)}function removeDownloadStatus(t,e){t=getPathOfDownloadStatus(t,e);null!=t&&t.startsWith(utils_2.SERVER_PATH)&&fs.existsSync(t)&&fs.removeSync(t)}function removeTemporaryAppInTempFolder(i,s){setTimeout(function(){var t=path.join(utils_2.SERVER_PATH,"temp"),e=path.join(t,"".concat(i,"-").concat(s)),n=path.join(t,"".concat(i,"-").concat(s,".zip"));null!=t&&t.startsWith(utils_2.SERVER_PATH)&&null!=e&&e.startsWith(t)&&null!=n&&n.startsWith(t)&&(fs.existsSync(e)&&fs.removeSync(e),fs.existsSync(n))&&fs.removeSync(n)},2e3)}function checkIsHasCustomWidgets(o){return __awaiter(this,void 0,void 0,function(){var e,n,i,s,r;return __generator(this,function(t){switch(t.label){case 0:return null!=(e=path.join(utils_2.SERVER_PATH,"public/apps",o))&&e.startsWith(utils_2.SERVER_PATH)?(i=(n=JSON).parse,[4,fs.readFile(path.join(e,"config.json"),"utf-8")]):[2,Promise.resolve(!1)];case 1:return(e=i.apply(n,[t.sent()]))?(s=(0,utils_2.getWidgetsUriFromAppConfig)(e),r=!1,0<s.customWidgetsUri.length&&(r=!0),[2,Promise.resolve(r)]):[2,Promise.resolve(!1)]}})})}